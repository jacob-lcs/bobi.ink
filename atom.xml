<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bobi.ink</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://bobi.ink/"/>
  <updated>2019-05-12T09:40:23.122Z</updated>
  <id>https://bobi.ink/</id>
  
  <author>
    <name>Ivan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“01 - ç±»å‹æ£€æŸ¥</title>
    <link href="https://bobi.ink/2019/05/10/react-component-design-01/"/>
    <id>https://bobi.ink/2019/05/10/react-component-design-01/</id>
    <published>2019-05-09T16:00:00.000Z</published>
    <updated>2019-05-12T09:40:23.122Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç³»åˆ—å¼•è¨€"><a href="#ç³»åˆ—å¼•è¨€" class="headerlink" title="ç³»åˆ—å¼•è¨€"></a>ç³»åˆ—å¼•è¨€</h2><p>æœ€è¿‘å‡†å¤‡åŸ¹è®­æ–°äºº, ä¸ºäº†æ–¹ä¾¿æ–°äººè¾ƒå¿«å…¥æ‰‹ React å¼€å‘å¹¶ç¼–å†™é«˜è´¨é‡çš„ç»„ä»¶ä»£ç , æˆ‘æ ¹æ®è‡ªå·±çš„å®è·µç»éªŒå¯¹<strong> React ç»„ä»¶è®¾è®¡çš„ç›¸å…³å®è·µå’Œè§„èŒƒ</strong>æ•´ç†äº†ä¸€äº›æ–‡æ¡£, å°†éƒ¨åˆ†ç« èŠ‚åˆ†äº«äº†å‡ºæ¥. ç”±äºç»éªŒæœ‰é™, æ–‡ç« å¯èƒ½ä¼šæœ‰æŸäº›é”™è¯¯, å¸Œæœ›å¤§å®¶æŒ‡å‡º, äº’ç›¸äº¤æµ.</p><p>ç”±äºç¯‡å¹…å¤ªé•¿, æ‰€ä»¥æ‹†åˆ†ä¸ºå‡ ç¯‡æ–‡ç« . ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä¸»é¢˜:</p><ul><li><a href="./">01 ç±»å‹æ£€æŸ¥</a></li><li>02 ç»„ä»¶çš„ç»„ç»‡ å¾…æ›´æ–°</li><li>03 æ ·å¼çš„ç®¡ç† å¾…æ›´æ–°</li><li>04 ç»„ä»¶çš„æ€ç»´ å¾…æ›´æ–°</li><li>05 çŠ¶æ€ç®¡ç† å¾…æ›´æ–°</li></ul><h2 id="ç±»å‹æ£€æŸ¥"><a href="#ç±»å‹æ£€æŸ¥" class="headerlink" title="ç±»å‹æ£€æŸ¥"></a>ç±»å‹æ£€æŸ¥</h2><p>é™æ€ç±»å‹æ£€æŸ¥å¯¹äºå½“ä»Šçš„å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šä¸å¯æˆ–ç¼º, å°¤å…¶æ˜¯å¤§å‹é¡¹ç›®. <strong>å®ƒå¯ä»¥åœ¨å¼€å‘æ—¶å°±é¿å…è®¸å¤šç±»å‹é—®é¢˜, å‡å°‘ä½çº§é”™è¯¯çš„; å¦å¤–é€šè¿‡ç±»å‹æ™ºèƒ½æç¤º, å¯ä»¥æé«˜ç¼–ç çš„æ•ˆç‡; æœ‰åˆ©äºä¹¦å†™è‡ªæè¿°çš„ä»£ç (ç±»å‹å³æ–‡æ¡£); æ–¹ä¾¿ä»£ç é‡æ„(é…åˆ IDE å¯ä»¥è‡ªåŠ¨é‡æ„)</strong>. å¯¹äºé™æ€ç±»å‹æ£€æŸ¥çš„å¥½å¤„è¿™é‡Œå°±ä¸äºˆèµ˜è¿°, è¯»è€…å¯ä»¥æŸ¥çœ‹è¿™ä¸ªå›ç­”<a href="https://www.zhihu.com/question/28016252/answer/39056940" target="_blank" rel="noopener">flow.js/typescript è¿™ç±»å®šä¹‰å‚æ•°ç±»å‹çš„æ„ä¹‰ä½•åœ¨ï¼Ÿ</a>.</p><p>Javascript çš„ç±»å‹æ£€æŸ¥å™¨ä¸»è¦æœ‰<a href="https://www.typescriptlang.org" target="_blank" rel="noopener">Typescript</a>å’Œ<a href="https://flow.org" target="_blank" rel="noopener">Flow</a>, ç¬”è€…ä¸¤è€…éƒ½ç”¨è¿‡, Typescript æ›´å¼ºå¤§ä¸€äº›, å¯ä»¥é¿å…å¾ˆå¤šå‘, æœ‰æ›´å¥½çš„ç”Ÿæ€(ä¾‹å¦‚ç¬¬ä¸‰æ–¹åº“ç±»å‹å£°æ˜), è€Œä¸” VSCode å†…ç½®æ”¯æŒ. è€Œå¯¹äº Flow, è¿ Facebook è‡ªå·±çš„å¼€æºé¡¹ç›®(å¦‚ Yarn, Jest)éƒ½æŠ›å¼ƒäº†å®ƒ, æ‰€ä»¥ä¸å»ºè®®å…¥å‘. æ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä½¿ç”¨ Typescript(v3.3) å¯¹ React ç»„ä»¶è¿›è¡Œç±»å‹æ£€æŸ¥å£°æ˜</p><p>å»ºè®®é€šè¿‡å®˜æ–¹æ–‡æ¡£æ¥<a href="https://www.typescriptlang.org" target="_blank" rel="noopener">å­¦ä¹  Typescript</a>. ç¬”è€…æ­¤å‰ä¹Ÿæ•´ç†äº† Typescript ç›¸å…³çš„<a href="https://github.com/ivan-94/mindnodes/tree/master/è¯­è¨€/Typescript" target="_blank" rel="noopener">æ€ç»´å¯¼å›¾(mindnode)</a></p><blockquote><p>å½“ç„¶ Flow ä¹Ÿæœ‰æŸäº› Typescript æ²¡æœ‰çš„ç‰¹æ€§: <a href="https://github.com/niieani/typescript-vs-flowtype" target="_blank" rel="noopener">typescript-vs-flowtype</a></p></blockquote><blockquote><p>React ç»„ä»¶ç±»å‹æ£€æŸ¥ä¾èµ–äº<code>@types/react</code>å’Œ<code>@types/react-dom</code></p></blockquote><blockquote><p>ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨è¯•ç”¨ <br> <a href="https://codesandbox.io/s/5vx5wwmkvx?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit typescript-react-playground"></a></p></blockquote><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#ç³»åˆ—å¼•è¨€">ç³»åˆ—å¼•è¨€</a></li><li><a href="#ç±»å‹æ£€æŸ¥">ç±»å‹æ£€æŸ¥</a><ul><li><a href="#1-å‡½æ•°ç»„ä»¶">1. å‡½æ•°ç»„ä»¶</a><ul><li><a href="#1ï¸âƒ£-ä½¿ç”¨componentnameprops-å½¢å¼å£°æ˜-props-ç±»å‹-å¹¶å¯¼å‡º">1ï¸âƒ£ <strong>ä½¿ç”¨<code>{ComponentName}Props</code> å½¢å¼å£°æ˜ Props ç±»å‹, å¹¶å¯¼å‡º</strong></a></li><li><a href="#2ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨fcfunctioncomponentçš„ç®€å†™ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶">2ï¸âƒ£ <strong>ä¼˜å…ˆä½¿ç”¨<code>FC</code>(<code>FunctionComponent</code>çš„ç®€å†™)ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶</strong></a></li><li><a href="#3ï¸âƒ£-ä¸è¦ç›´æ¥ä½¿ç”¨export-defaultå¯¼å‡ºç»„ä»¶">3ï¸âƒ£ <strong>ä¸è¦ç›´æ¥ä½¿ç”¨<code>export default</code>å¯¼å‡ºç»„ä»¶</strong>.</a></li><li><a href="#4ï¸âƒ£-é»˜è®¤-props-å£°æ˜">4ï¸âƒ£ <strong>é»˜è®¤ props å£°æ˜</strong></a></li><li><a href="#5ï¸âƒ£-æ³›å‹å‡½æ•°ç»„ä»¶">5ï¸âƒ£ <strong>æ³›å‹å‡½æ•°ç»„ä»¶</strong></a></li><li><a href="#6ï¸âƒ£-å­ç»„ä»¶å£°æ˜">6ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></a></li><li><a href="#7ï¸âƒ£-forwarding-refs">7ï¸âƒ£ <strong>Forwarding Refs</strong></a></li></ul></li><li><a href="#2-ç±»ç»„ä»¶">2. ç±»ç»„ä»¶</a><ul><li><a href="#1ï¸âƒ£-ç»§æ‰¿-reactcomponent-æˆ–-reactpurecomponent">1ï¸âƒ£ <strong>ç»§æ‰¿ React.Component æˆ– React.PureComponent</strong></a></li><li><a href="#2ï¸âƒ£-ä½¿ç”¨static-defaultpropså®šä¹‰é»˜è®¤-props">2ï¸âƒ£ <strong>ä½¿ç”¨<code>static defaultProps</code>å®šä¹‰é»˜è®¤ props</strong></a></li><li><a href="#3ï¸âƒ£-å­ç»„ä»¶å£°æ˜">3ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></a></li><li><a href="#4ï¸âƒ£-æ³›å‹">4ï¸âƒ£ <strong>æ³›å‹</strong></a></li></ul></li><li><a href="#3-é«˜é˜¶ç»„ä»¶">3. é«˜é˜¶ç»„ä»¶</a></li><li><a href="#4-render-props">4. Render Props</a></li><li><a href="#5-context">5. Context</a></li><li><a href="#6-æ‚é¡¹">6. æ‚é¡¹</a><ul><li><a href="#1ï¸âƒ£-ä½¿ç”¨handleeventå‘½åäº‹ä»¶å¤„ç†å™¨">1ï¸âƒ£ <strong>ä½¿ç”¨<code>handle{Event}</code>å‘½åäº‹ä»¶å¤„ç†å™¨</strong>.</a></li><li><a href="#2ï¸âƒ£-ä½¿ç”¨-typesreact-å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹">2ï¸âƒ£ <strong>ä½¿ç”¨ @types/react å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹</strong></a></li><li><a href="#3ï¸âƒ£-è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹">3ï¸âƒ£ <strong>è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹</strong></a></li><li><a href="#4ï¸âƒ£-è·å–åŸç”Ÿå…ƒç´ -props-å®šä¹‰">4ï¸âƒ£ <strong>è·å–åŸç”Ÿå…ƒç´  props å®šä¹‰</strong></a></li><li><a href="#5ï¸âƒ£-ä¸è¦ä½¿ç”¨-reactproptypes">5ï¸âƒ£ <strong>ä¸è¦ä½¿ç”¨ React.PropTypes</strong></a></li><li><a href="#6ï¸âƒ£-styled-components">6ï¸âƒ£ <strong>styled-components</strong></a></li><li><a href="#7ï¸âƒ£-ä¸ºæ²¡æœ‰æä¾›-typescript-å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜">7ï¸âƒ£ <strong>ä¸ºæ²¡æœ‰æä¾› Typescript å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜</strong></a></li><li><a href="#8ï¸âƒ£-ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡">8ï¸âƒ£ <strong>ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡</strong></a></li><li><a href="#9ï¸âƒ£-å¼€å¯-strict-æ¨¡å¼">9ï¸âƒ£ <strong>å¼€å¯ strict æ¨¡å¼</strong></a></li></ul></li><li><a href="#æ‰©å±•èµ„æ–™">æ‰©å±•èµ„æ–™</a></li></ul></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h3 id="1-å‡½æ•°ç»„ä»¶"><a href="#1-å‡½æ•°ç»„ä»¶" class="headerlink" title="1. å‡½æ•°ç»„ä»¶"></a>1. å‡½æ•°ç»„ä»¶</h3><p>React Hooks å‡ºç°å, å‡½æ•°ç»„ä»¶æœ‰äº†æ›´å¤šå‡ºé•œç‡. ç”±äºå‡½æ•°ç»„ä»¶åªæ˜¯æ™®é€šå‡½æ•°, å®ƒéå¸¸å®¹æ˜“è¿›è¡Œç±»å‹å£°æ˜</p><p><br></p><h4 id="1ï¸âƒ£-ä½¿ç”¨-ComponentName-Props-å½¢å¼å£°æ˜-Props-ç±»å‹-å¹¶å¯¼å‡º"><a href="#1ï¸âƒ£-ä½¿ç”¨-ComponentName-Props-å½¢å¼å£°æ˜-Props-ç±»å‹-å¹¶å¯¼å‡º" class="headerlink" title="1ï¸âƒ£ ä½¿ç”¨{ComponentName}Props å½¢å¼å£°æ˜ Props ç±»å‹, å¹¶å¯¼å‡º"></a>1ï¸âƒ£ <strong>ä½¿ç”¨<code>{ComponentName}Props</code> å½¢å¼å£°æ˜ Props ç±»å‹, å¹¶å¯¼å‡º</strong></h4><p><br></p><h4 id="2ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨FC-FunctionComponentçš„ç®€å†™-ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶"><a href="#2ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨FC-FunctionComponentçš„ç®€å†™-ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶" class="headerlink" title="2ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨FC(FunctionComponentçš„ç®€å†™)ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶"></a>2ï¸âƒ£ <strong>ä¼˜å…ˆä½¿ç”¨<code>FC</code>(<code>FunctionComponent</code>çš„ç®€å†™)ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶</strong></h4><p>è¿™ä¸ªç±»å‹å®šä¹‰äº†é»˜è®¤çš„ props(å¦‚ children)ä»¥åŠä¸€äº›é™æ€å±æ€§(å¦‚ defaultProps)</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜Propsç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyComponentProps &#123;</span><br><span class="line">  className?: <span class="built_in">string</span>;</span><br><span class="line">  style?: React.CSSProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyComponent: FC&lt;MyComponentProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello react&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ™®é€šå‡½æ•°æ¥è¿›è¡Œç»„ä»¶å£°æ˜, ä¸‹æ–‡ä¼šçœ‹åˆ°è¿™ç§å½¢å¼æ›´åŠ çµæ´»:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyComponentProps &#123;</span><br><span class="line">  className?: <span class="built_in">string</span>;</span><br><span class="line">  style?: React.CSSProperties;</span><br><span class="line">  <span class="comment">// æ‰‹åŠ¨å£°æ˜children</span></span><br><span class="line">  children?: React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">props: MyComponentProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello react&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="3ï¸âƒ£-ä¸è¦ç›´æ¥ä½¿ç”¨export-defaultå¯¼å‡ºç»„ä»¶"><a href="#3ï¸âƒ£-ä¸è¦ç›´æ¥ä½¿ç”¨export-defaultå¯¼å‡ºç»„ä»¶" class="headerlink" title="3ï¸âƒ£ ä¸è¦ç›´æ¥ä½¿ç”¨export defaultå¯¼å‡ºç»„ä»¶."></a>3ï¸âƒ£ <strong>ä¸è¦ç›´æ¥ä½¿ç”¨<code>export default</code>å¯¼å‡ºç»„ä»¶</strong>.</h4><p>è¿™ç§æ–¹å¼å¯¼å‡ºçš„ç»„ä»¶åœ¨<code>React Inspector</code>æŸ¥çœ‹æ—¶ä¼šæ˜¾ç¤ºä¸º<code>Unknown</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props: &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello react&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœéå¾—è¿™ä¹ˆåš, è¯·ä½¿ç”¨<code>å‘½å function</code> å®šä¹‰:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">props: &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;xxx&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="4ï¸âƒ£-é»˜è®¤-props-å£°æ˜"><a href="#4ï¸âƒ£-é»˜è®¤-props-å£°æ˜" class="headerlink" title="4ï¸âƒ£ é»˜è®¤ props å£°æ˜"></a>4ï¸âƒ£ <strong>é»˜è®¤ props å£°æ˜</strong></h4><p>å®é™…ä¸Šæˆªæ­¢ç›®å‰å¯¹äºä¸Šé¢çš„ä½¿ç”¨<code>FC</code>ç±»å‹å£°æ˜çš„å‡½æ•°ç»„ä»¶å¹¶<a href="https://github.com/Microsoft/TypeScript/issues/27425" target="_blank" rel="noopener">ä¸èƒ½å®Œç¾æ”¯æŒ defaultProps</a>:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HelloProps &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Hello: FC&lt;HelloProps&gt; = <span class="function">(<span class="params">&#123; name &#125;</span>) =&gt;</span> &lt;div&gt;Hello &#123;name&#125;!&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Hello.defaultProps = &#123; name: 'TJ' &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ âŒ! missing name</span></span><br><span class="line"><span class="regexp">&lt;Hello /</span>&gt;;</span><br></pre></td></tr></table></figure><p>ç¬”è€…ä¸€èˆ¬å–œæ¬¢è¿™æ ·å­å£°æ˜é»˜è®¤ props:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HelloProps &#123;</span><br><span class="line">  name?: <span class="built_in">string</span>; <span class="comment">// å£°æ˜ä¸ºå¯é€‰å±æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨å¯¹è±¡é»˜è®¤å±æ€§å€¼è¯­æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Hello: FC&lt;HelloProps&gt; = <span class="function">(<span class="params">&#123; name = 'TJ' &#125;</span>) =&gt;</span> &lt;div&gt;Hello &#123;name&#125;!&lt;<span class="regexp">/div&gt;;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœéå¾—ä½¿ç”¨ defaultProps, å¯ä»¥è¿™æ ·å­å£°æ˜ ğŸ‘‡. Typescript å¯ä»¥æ¨æ–­å’Œåœ¨å‡½æ•°ä¸Šå®šä¹‰çš„å±æ€§, è¿™ä¸ªç‰¹æ€§åœ¨ Typescript <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-1.html#properties-declarations-on-functions" target="_blank" rel="noopener">3.1</a>å¼€å§‹æ”¯æŒ.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropsWithChildren &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HelloProps &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥ä½¿ç”¨å‡½æ•°å‚æ•°å£°æ˜</span></span><br><span class="line"><span class="comment">// PropsWithChildrenåªæ˜¯æ‰©å±•äº†children, å®Œå…¨å¯ä»¥è‡ªå·±å£°æ˜</span></span><br><span class="line"><span class="comment">// type PropsWithChildren&lt;P&gt; = P &amp; &#123;</span></span><br><span class="line"><span class="comment">//    children?: ReactNode;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">const</span> Hello = <span class="function">(<span class="params">&#123; name &#125;: PropsWithChildren&lt;HelloProps&gt;</span>) =&gt;</span> &lt;div&gt;Hello &#123;name&#125;!&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Hello.defaultProps = &#123; name: 'TJ' &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ âœ… ok!</span></span><br><span class="line"><span class="regexp">&lt;Hello /</span>&gt;;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¹Ÿéå¸¸ç®€æ´, åªä¸è¿‡ defaultProps çš„ç±»å‹å’Œç»„ä»¶æœ¬èº«çš„ props æ²¡æœ‰å…³è”æ€§, è¿™ä¼šä½¿å¾— defaultProps æ— æ³•å¾—åˆ°ç±»å‹çº¦æŸ, æ‰€ä»¥å¿…è¦æ—¶è¿›ä¸€æ­¥æ˜¾å¼å£°æ˜ defaultProps çš„ç±»å‹:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello.defaultProps = &#123; name: <span class="string">'TJ'</span> &#125; <span class="keyword">as</span> Partial&lt;HelloProps&gt;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="5ï¸âƒ£-æ³›å‹å‡½æ•°ç»„ä»¶"><a href="#5ï¸âƒ£-æ³›å‹å‡½æ•°ç»„ä»¶" class="headerlink" title="5ï¸âƒ£ æ³›å‹å‡½æ•°ç»„ä»¶"></a>5ï¸âƒ£ <strong>æ³›å‹å‡½æ•°ç»„ä»¶</strong></h4><p>æ³›å‹åœ¨ä¸€ä¸‹åˆ—è¡¨å‹æˆ–å®¹å™¨å‹çš„ç»„ä»¶ä¸­æ¯”è¾ƒå¸¸ç”¨, ç›´æ¥ä½¿ç”¨<code>FC</code>æ— æ³•æ»¡è¶³éœ€æ±‚:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ListProps&lt;T&gt; &#123;</span><br><span class="line">  visible: <span class="built_in">boolean</span>;</span><br><span class="line">  list: T[];</span><br><span class="line">  renderItem: <span class="function">(<span class="params">item: T, index: <span class="built_in">number</span></span>) =&gt;</span> React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">List</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: ListProps&lt;T&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;List</span><br><span class="line">      list=&#123;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</span><br><span class="line">      renderItem=&#123;<span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/*è‡ªåŠ¨æ¨æ–­iä¸ºnumberç±»å‹*/</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="6ï¸âƒ£-å­ç»„ä»¶å£°æ˜"><a href="#6ï¸âƒ£-å­ç»„ä»¶å£°æ˜" class="headerlink" title="6ï¸âƒ£ å­ç»„ä»¶å£°æ˜"></a>6ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></h4><p>ä½¿ç”¨<code>Parent.Child</code>å½¢å¼çš„ JSX å¯ä»¥è®©èŠ‚ç‚¹çˆ¶å­å…³ç³»æ›´åŠ ç›´è§‚, å®ƒç±»ä¼¼äºä¸€ç§å‘½åç©ºé—´çš„æœºåˆ¶, å¯ä»¥é¿å…å‘½åå†²çª. ç›¸æ¯”<code>ParentChild</code>è¿™ç§å‘½åæ–¹å¼, <code>Parent.Child</code>æ›´ä¸ºä¼˜é›…äº›. å½“ç„¶ä¹Ÿæœ‰å¯èƒ½è®©ä»£ç å˜å¾—å•°å—¦.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropsWithChildren &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LayoutProps &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LayoutHeaderProps &#123;&#125; <span class="comment">// é‡‡ç”¨ParentChildPropså½¢å¼å‘½å</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LayoutFooterProps &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params">props: PropsWithChildren&lt;LayoutProps&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div className=<span class="string">"layout"</span>&gt;&#123;props.children&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ä½œä¸ºçˆ¶ç»„ä»¶çš„å±æ€§</span></span><br><span class="line"><span class="regexp">Layout.Header = (props: PropsWithChildren&lt;LayoutHeaderProps&gt;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &lt;div className="header"&gt;&#123;props.children&#125;&lt;/</span>div&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Layout.Footer = <span class="function">(<span class="params">props: PropsWithChildren&lt;LayoutFooterProps&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div className=<span class="string">"footer"</span>&gt;&#123;props.children&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ Test</span></span><br><span class="line"><span class="regexp">&lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Layout.Header&gt;header&lt;/</span>Layout.Header&gt;</span><br><span class="line">  &lt;Layout.Footer&gt;footer&lt;<span class="regexp">/Layout.Footer&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Layout&gt;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="7ï¸âƒ£-Forwarding-Refs"><a href="#7ï¸âƒ£-Forwarding-Refs" class="headerlink" title="7ï¸âƒ£ Forwarding Refs"></a>7ï¸âƒ£ <strong>Forwarding Refs</strong></h4><p><code>React.forwardRef</code> åœ¨ 16.3 æ–°å¢, å¯ä»¥ç”¨äºè½¬å‘ ref, é€‚ç”¨äº HOC å’Œå‡½æ•°ç»„ä»¶.</p><p>å‡½æ•°ç»„ä»¶åœ¨ 16.8.4 ä¹‹å‰æ˜¯ä¸æ”¯æŒ ref çš„, é…åˆ forwardRef å’Œ useImperativeHandle å¯ä»¥è®©å‡½æ•°ç»„ä»¶å‘å¤–æš´éœ²æ–¹æ³•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************</span></span><br><span class="line"><span class="comment"> * MyModal.tsx</span></span><br><span class="line"><span class="comment"> ****************************/</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useImperativeHandle, FC, useRef, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyModalProps &#123;</span><br><span class="line">  title?: React.ReactNode;</span><br><span class="line">  onOk?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  onCancel?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æš´éœ²çš„æ–¹æ³•, é€‚ç”¨`&#123;ComponentName&#125;Methods`å½¢å¼å‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyModalMethods &#123;</span><br><span class="line">  show(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyModal = React.forwardRef&lt;MyModalMethods, MyModalProps&gt;<span class="function">(<span class="params">(<span class="params">props, ref</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> [visible, setVisible] = useState(<span class="params"></span>);</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// åˆå§‹åŒ–refæš´éœ²çš„æ–¹æ³•</span></span></span></span><br><span class="line"><span class="function"><span class="params">  useImperativeHandle(<span class="params">ref, (<span class="params"></span>) =&gt; (<span class="params">&#123;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">    show: (<span class="params"></span>) =&gt; setVisible(<span class="params"><span class="literal">true</span></span>),</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">  &#125;</span>)</span>);</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">return</span> &lt;Modal visible=&#123;visible&#125;&gt;...&lt;/Modal&gt;;</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">/*******************</span></span><br><span class="line"><span class="function"> * <span class="params">Test</span>.<span class="params">tsx</span></span></span><br><span class="line"><span class="function"> *******************/</span></span><br><span class="line"><span class="function"><span class="params">const</span> <span class="params">Test</span>: <span class="params">FC</span>&lt;&#123;&#125;&gt; = <span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> modal = useRef&lt;MyModalMethods | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> confirm = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (modal.current) &#123;</span><br><span class="line">      modal.current.show();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleOk = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;confirm&#125;&gt;show&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;MyModal ref=&#123;modal&#125; onOk=&#123;handleOk&#125; /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="2-ç±»ç»„ä»¶"><a href="#2-ç±»ç»„ä»¶" class="headerlink" title="2. ç±»ç»„ä»¶"></a>2. ç±»ç»„ä»¶</h3><p>ç›¸æ¯”å‡½æ•°, åŸºäºç±»çš„ç±»å‹æ£€æŸ¥å¯èƒ½ä¼šæ›´å¥½ç†è§£(ä¾‹å¦‚é‚£äº›ç†Ÿæ‚‰ä¼ ç»Ÿé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„å¼€å‘è€…).</p><h4 id="1ï¸âƒ£-ç»§æ‰¿-React-Component-æˆ–-React-PureComponent"><a href="#1ï¸âƒ£-ç»§æ‰¿-React-Component-æˆ–-React-PureComponent" class="headerlink" title="1ï¸âƒ£ ç»§æ‰¿ React.Component æˆ– React.PureComponent"></a>1ï¸âƒ£ <strong>ç»§æ‰¿ React.Component æˆ– React.PureComponent</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¦–å…ˆå¯¼å‡ºPropså£°æ˜, åŒæ ·æ˜¯&#123;ComponentName&#125;Propså½¢å¼å‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> CounterProps &#123;</span><br><span class="line">  defaultCount: <span class="built_in">number</span>; <span class="comment">// å¯é€‰props, ä¸éœ€è¦?ä¿®é¥°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»„ä»¶çŠ¶æ€, ä¸éœ€è¦æš´éœ²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> State &#123;</span><br><span class="line">  count: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç±»æ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * ç»§æ‰¿React.Component, å¹¶å£°æ˜Propså’ŒStateç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;CounterProps, State&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é»˜è®¤å‚æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    defaultCount: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–State</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> state = &#123;</span><br><span class="line">    count: <span class="keyword">this</span>.props.defaultCount,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å£°æ˜å‘¨æœŸæ–¹æ³•</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å»ºè®®é è¿‘componentDidMount, èµ„æºæ¶ˆè´¹å’Œèµ„æºé‡Šæ”¾é è¿‘åœ¨ä¸€èµ·, æ–¹ä¾¿review</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> componentWillUnmount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidCatch() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidUpdate(prevProps: CounterProps, prevState: State) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¸²æŸ“å‡½æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.count&#125;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.increment&#125;&gt;Increment&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;this.decrement&#125;&gt;Decrement&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span>**</span><br><span class="line">   * â‘  ç»„ä»¶ç§æœ‰æ–¹æ³•, ä¸æš´éœ²</span><br><span class="line">   * â‘¡ ä½¿ç”¨ç±»å®ä¾‹å±æ€§+ç®­å¤´å‡½æ•°å½¢å¼ç»‘å®š<span class="keyword">this</span></span><br><span class="line">   *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">  private increment = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    this.setState((&#123; count &#125;) =&gt; (&#123; count: count + 1 &#125;));</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  private decrement = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    this.setState((&#123; count &#125;) =&gt; (&#123; count: count - 1 &#125;));</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="2ï¸âƒ£-ä½¿ç”¨static-defaultPropså®šä¹‰é»˜è®¤-props"><a href="#2ï¸âƒ£-ä½¿ç”¨static-defaultPropså®šä¹‰é»˜è®¤-props" class="headerlink" title="2ï¸âƒ£ ä½¿ç”¨static defaultPropså®šä¹‰é»˜è®¤ props"></a>2ï¸âƒ£ <strong>ä½¿ç”¨<code>static defaultProps</code>å®šä¹‰é»˜è®¤ props</strong></h4><p>Typescript <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-0.html#support-for-defaultprops-in-jsx" target="_blank" rel="noopener">3.0</a>å¼€å§‹æ”¯æŒå¯¹ä½¿ç”¨ defaultProps å¯¹ JSX props è¿›è¡Œæ¨æ–­, åœ¨ defaultProps ä¸­å®šä¹‰çš„ props å¯ä»¥ä¸éœ€è¦â€™?â€™å¯é€‰æ“ä½œç¬¦ä¿®é¥°. ä»£ç å¦‚ä¸Š ğŸ‘†</p><p><br></p><h4 id="3ï¸âƒ£-å­ç»„ä»¶å£°æ˜"><a href="#3ï¸âƒ£-å­ç»„ä»¶å£°æ˜" class="headerlink" title="3ï¸âƒ£ å­ç»„ä»¶å£°æ˜"></a>3ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></h4><p>ç±»ç»„ä»¶å¯ä»¥ä½¿ç”¨é™æ€å±æ€§å½¢å¼å£°æ˜å­ç»„ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Layout <span class="keyword">extends</span> React.Component&lt;LayoutProps&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Header = Header;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Footer = Footer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div className=<span class="string">"layout"</span>&gt;&#123;<span class="keyword">this</span>.props.children&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="4ï¸âƒ£-æ³›å‹"><a href="#4ï¸âƒ£-æ³›å‹" class="headerlink" title="4ï¸âƒ£ æ³›å‹"></a>4ï¸âƒ£ <strong>æ³›å‹</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> List&lt;T&gt; <span class="keyword">extends</span> React.Component&lt;ListProps&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> render() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="3-é«˜é˜¶ç»„ä»¶"><a href="#3-é«˜é˜¶ç»„ä»¶" class="headerlink" title="3. é«˜é˜¶ç»„ä»¶"></a>3. é«˜é˜¶ç»„ä»¶</h3><p>åœ¨ React Hooks å‡ºæ¥ä¹‹å‰, é«˜é˜¶ç»„ä»¶æ˜¯ React çš„ä¸€ä¸ªé‡è¦é€»è¾‘å¤ç”¨æ–¹å¼. ç›¸æ¯”è¾ƒè€Œè¨€é«˜é˜¶ç»„ä»¶æ¯”è¾ƒé‡, ä¸”éš¾ä»¥ç†è§£, å®¹æ˜“é€ æˆ<code>åµŒå¥—åœ°ç‹±(wrapper)</code>. å¦å¤–å¯¹ Typescript ç±»å‹åŒ–ä¹Ÿä¸å‹å¥½(ä»¥å‰ä¼šä½¿ç”¨<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/9c1c7e78a9a2b4af8e2cda842c3693f67bb9e42d/types/react-router/index.d.ts#L137" target="_blank" rel="noopener">Omit</a>æ¥è®¡ç®—å¯¼å‡ºçš„ props). æ‰€ä»¥æ–°é¡¹ç›®è¿˜æ˜¯å»ºè®®ä½¿ç”¨ React Hooks.</p><p>ä¸€ä¸ªç®€å•çš„é«˜é˜¶ç»„ä»¶:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜æ³¨å…¥çš„Props</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeProps &#123;</span><br><span class="line">  primary: <span class="built_in">string</span>;</span><br><span class="line">  secondary: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»™æŒ‡å®šç»„ä»¶æ³¨å…¥'ä¸»é¢˜'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">withTheme</span>&lt;<span class="title">P</span>&gt;(<span class="params">Component: React.ComponentType&lt;P &amp; ThemeProps&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * WithTheme è‡ªå·±æš´éœ²çš„Props</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">interface</span> OwnProps &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é«˜é˜¶ç»„ä»¶çš„props, å¿½ç•¥ThemeProps, å¤–éƒ¨ä¸éœ€è¦ä¼ é€’è¿™äº›å±æ€§</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">type</span> WithThemeProps = P &amp; OwnProps;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é«˜é˜¶ç»„ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> WithTheme = <span class="function">(<span class="params">props: WithThemeProps</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‡è®¾themeä»contextä¸­è·å–</span></span><br><span class="line">    <span class="keyword">const</span> fakeTheme: ThemeProps = &#123;</span><br><span class="line">      primary: <span class="string">'red'</span>,</span><br><span class="line">      secondary: <span class="string">'blue'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &lt;Component &#123;...fakeTheme&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  WithTheme.displayName = <span class="string">`withTheme<span class="subst">$&#123;Component.displayName&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> WithTheme;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="keyword">const</span> Foo: FC&lt;&#123; a: <span class="built_in">number</span> &#125; &amp; ThemeProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &lt;div style=&#123;&#123; color: props.primary &#125;&#125; /&gt;;</span><br><span class="line"><span class="keyword">const</span> FooWithTheme = withTheme(Foo);</span><br><span class="line">() =&gt; &#123;</span><br><span class="line">  &lt;FooWithTheme a=&#123;<span class="number">1</span>&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†é‡æ„ä¸€ä¸‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½å–å‡ºé€šç”¨çš„é«˜é˜¶ç»„ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> HOC&lt;InjectedProps, OwnProps = &#123;&#125;&gt; = &lt;P&gt;(</span><br><span class="line">  Component: React.ComponentType&lt;P &amp; InjectedProps&gt;,</span><br><span class="line">) =&gt; React.ComponentType&lt;P &amp; OwnProps&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜æ³¨å…¥çš„Props</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeProps &#123;</span><br><span class="line">  primary: <span class="built_in">string</span>;</span><br><span class="line">  secondary: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withTheme: HOC&lt;ThemeProps&gt; = <span class="function"><span class="params">Component</span> =&gt;</span> props =&gt; &#123;</span><br><span class="line">  <span class="comment">// å‡è®¾themeä»contextä¸­è·å–</span></span><br><span class="line">  <span class="keyword">const</span> fakeTheme: ThemeProps = &#123;</span><br><span class="line">    primary: <span class="string">'red'</span>,</span><br><span class="line">    secondary: <span class="string">'blue'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &lt;Component &#123;...fakeTheme&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é«˜é˜¶ç»„ä»¶è¿˜æœ‰ä¸€äº›ç—›ç‚¹:</p><ul><li>æ— æ³•å®Œç¾åœ°ä½¿ç”¨ ref(è¿™å·²ä¸ç®—ä»€ä¹ˆç—›ç‚¹)<ul><li>åœ¨ React.forwardRef å‘å¸ƒä¹‹å‰, æœ‰ä¸€äº›åº“ä¼šä½¿ç”¨ innerRef æˆ–è€… wrapperRef, è½¬å‘ç»™å°è£…çš„ç»„ä»¶çš„ ref.</li><li>æ— æ³•æ¨æ–­ ref å¼•ç”¨ç»„ä»¶çš„ç±»å‹, éœ€è¦æ˜¾å¼å£°æ˜.</li></ul></li><li>é«˜é˜¶ç»„ä»¶ç±»å‹æŠ¥é”™å¾ˆéš¾ç†è§£</li></ul><p><br></p><hr><p><br></p><h3 id="4-Render-Props"><a href="#4-Render-Props" class="headerlink" title="4. Render Props"></a>4. Render Props</h3><p>React çš„ props(åŒ…æ‹¬ children)å¹¶æ²¡æœ‰é™å®šç±»å‹, å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°. äºæ˜¯å°±æœ‰äº† render props, è¿™æ˜¯å’Œé«˜é˜¶ç»„ä»¶ä¸€æ ·å¸¸è§çš„æ¨¡å¼:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeConsumerProps &#123;</span><br><span class="line">  children: <span class="function">(<span class="params">theme: Theme</span>) =&gt;</span> React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeConsumer = <span class="function">(<span class="params">props: ThemeConsumerProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fakeTheme = &#123; primary: <span class="string">'red'</span>, secondary: <span class="string">'blue'</span> &#125;;</span><br><span class="line">  <span class="keyword">return</span> props.children(fakeTheme);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line">&lt;ThemeConsumer&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; primary &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div style=&#123;&#123; color: primary &#125;&#125; /&gt;;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&lt;<span class="regexp">/ThemeConsumer&gt;;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="5-Context"><a href="#5-Context" class="headerlink" title="5. Context"></a>5. Context</h3><p>Context æä¾›äº†ä¸€ç§è·¨ç»„ä»¶é—´çŠ¶æ€å…±äº«æœºåˆ¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useContext &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Theme &#123;</span><br><span class="line">  primary: <span class="built_in">string</span>;</span><br><span class="line">  secondary: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜Contextçš„ç±»å‹, ä»¥&#123;Name&#125;ContextValueå‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeContextValue &#123;</span><br><span class="line">  theme: Theme;</span><br><span class="line">  onThemeChange: <span class="function">(<span class="params">theme: Theme</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºContext, å¹¶è®¾ç½®é»˜è®¤å€¼, ä»¥&#123;Name&#125;Contextå‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeContext = React.createContext&lt;ThemeContextValue&gt;(&#123;</span><br><span class="line">  theme: &#123;</span><br><span class="line">    primary: <span class="string">'red'</span>,</span><br><span class="line">    secondary: <span class="string">'blue'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  onThemeChange: noop,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Provider, ä»¥&#123;Name&#125;Providerå‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeProvider: FC&lt;&#123; theme: Theme; onThemeChange: <span class="function">(<span class="params">theme: Theme</span>) =&gt;</span> <span class="built_in">void</span> &#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ThemeContext.Provider value=&#123;&#123; theme: props.theme, onThemeChange: props.onThemeChange &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * æš´éœ²hooks, ä»¥use&#123;Name&#125;å‘½å</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">export function useTheme() &#123;</span></span><br><span class="line"><span class="regexp">  return useContext(ThemeContext);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="6-æ‚é¡¹"><a href="#6-æ‚é¡¹" class="headerlink" title="6. æ‚é¡¹"></a>6. æ‚é¡¹</h3><h4 id="1ï¸âƒ£-ä½¿ç”¨handle-Event-å‘½åäº‹ä»¶å¤„ç†å™¨"><a href="#1ï¸âƒ£-ä½¿ç”¨handle-Event-å‘½åäº‹ä»¶å¤„ç†å™¨" class="headerlink" title="1ï¸âƒ£ ä½¿ç”¨handle{Event}å‘½åäº‹ä»¶å¤„ç†å™¨."></a>1ï¸âƒ£ <strong>ä½¿ç”¨<code>handle{Event}</code>å‘½åäº‹ä»¶å¤„ç†å™¨</strong>.</h4><p>å¦‚æœå­˜åœ¨å¤šä¸ªç›¸åŒäº‹ä»¶å¤„ç†å™¨, åˆ™æŒ‰ç…§<code>handle{Type}{Event}</code>å‘½å, ä¾‹å¦‚ handleNameChange.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> EventDemo: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback&lt;React.MouseEventHandler&gt;(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    evt.preventDefault();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;button onClick=&#123;handleClick&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="2ï¸âƒ£-ä½¿ç”¨-types-react-å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹"><a href="#2ï¸âƒ£-ä½¿ç”¨-types-react-å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹" class="headerlink" title="2ï¸âƒ£ ä½¿ç”¨ @types/react å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹"></a>2ï¸âƒ£ <strong>ä½¿ç”¨ @types/react å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹</strong></h4><p><code>@types/react</code>å†…ç½®äº†ä»¥ä¸‹äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹ ğŸ‘‡</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> EventHandler&lt;E <span class="keyword">extends</span> SyntheticEvent&lt;<span class="built_in">any</span>&gt;&gt; = &#123; bivarianceHack(event: E): <span class="built_in">void</span> &#125;[<span class="string">'bivarianceHack'</span>];</span><br><span class="line"><span class="keyword">type</span> ReactEventHandler&lt;T = Element&gt; = EventHandler&lt;SyntheticEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> ClipboardEventHandler&lt;T = Element&gt; = EventHandler&lt;ClipboardEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> CompositionEventHandler&lt;T = Element&gt; = EventHandler&lt;CompositionEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> DragEventHandler&lt;T = Element&gt; = EventHandler&lt;DragEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> FocusEventHandler&lt;T = Element&gt; = EventHandler&lt;FocusEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> FormEventHandler&lt;T = Element&gt; = EventHandler&lt;FormEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> ChangeEventHandler&lt;T = Element&gt; = EventHandler&lt;ChangeEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> KeyboardEventHandler&lt;T = Element&gt; = EventHandler&lt;KeyboardEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> MouseEventHandler&lt;T = Element&gt; = EventHandler&lt;MouseEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> TouchEventHandler&lt;T = Element&gt; = EventHandler&lt;TouchEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> PointerEventHandler&lt;T = Element&gt; = EventHandler&lt;PointerEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> UIEventHandler&lt;T = Element&gt; = EventHandler&lt;UIEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> WheelEventHandler&lt;T = Element&gt; = EventHandler&lt;WheelEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> AnimationEventHandler&lt;T = Element&gt; = EventHandler&lt;AnimationEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> TransitionEventHandler&lt;T = Element&gt; = EventHandler&lt;TransitionEvent&lt;T&gt;&gt;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç®€æ´åœ°å£°æ˜äº‹ä»¶å¤„ç†å™¨ç±»å‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ChangeEventHandler &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> EventDemo: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å¯ä»¥é™å®šå…·ä½“Targetçš„ç±»å‹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> handleChange = useCallback&lt;ChangeEventHandler&lt;HTMLInputElement&gt;&gt;(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(evt.target.value);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;input onChange=&#123;handleChange&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="3ï¸âƒ£-è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹"><a href="#3ï¸âƒ£-è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹" class="headerlink" title="3ï¸âƒ£ è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹"></a>3ï¸âƒ£ <strong>è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹</strong></h4><p>å’ŒåŸç”Ÿ html å…ƒç´ ä¸€æ ·, è‡ªå®šä¹‰ç»„ä»¶åº”è¯¥æš´éœ²è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨ç±»å‹, å°¤å…¶æ˜¯è¾ƒä¸ºå¤æ‚çš„äº‹ä»¶å¤„ç†å™¨, è¿™æ ·å¯ä»¥é¿å…å¼€å‘è€…æ‰‹åŠ¨ä¸ºæ¯ä¸ªäº‹ä»¶å¤„ç†å™¨çš„å‚æ•°å£°æ˜ç±»å‹</p><p>è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨ç±»å‹ä»¥<code>{ComponentName}{Event}Handler</code>å‘½å. ä¸ºäº†å’ŒåŸç”Ÿäº‹ä»¶å¤„ç†å™¨ç±»å‹åŒºåˆ†, ä¸ä½¿ç”¨<code>EventHandler</code>å½¢å¼çš„åç¼€</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UploadValue &#123;</span><br><span class="line">  url: <span class="built_in">string</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  size: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> UploadChangeHandler = <span class="function">(<span class="params">value?: UploadValue, file?: File</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UploadProps &#123;</span><br><span class="line">  value?: UploadValue;</span><br><span class="line">  onChange?: UploadChangeHandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Upload: FC&lt;UploadProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;...&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="4ï¸âƒ£-è·å–åŸç”Ÿå…ƒç´ -props-å®šä¹‰"><a href="#4ï¸âƒ£-è·å–åŸç”Ÿå…ƒç´ -props-å®šä¹‰" class="headerlink" title="4ï¸âƒ£ è·å–åŸç”Ÿå…ƒç´  props å®šä¹‰"></a>4ï¸âƒ£ <strong>è·å–åŸç”Ÿå…ƒç´  props å®šä¹‰</strong></h4><p>æœ‰äº›åœºæ™¯æˆ‘ä»¬å¸Œæœ›åŸç”Ÿå…ƒç´ æ‰©å±•ä¸€ä¸‹ä¸€äº› props. æ‰€æœ‰åŸç”Ÿå…ƒç´  props éƒ½ç»§æ‰¿äº†<code>React.HTMLAttributes</code>, æŸäº›ç‰¹æ®Šå…ƒç´ ä¹Ÿä¼šæ‰©å±•äº†è‡ªå·±çš„å±æ€§, ä¾‹å¦‚<code>InputHTMLAttributes</code>. å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/eafef8bd049017b3998939de2edbab5d8a96423b/types/react/index.d.ts#L203" target="_blank" rel="noopener"><code>React.createElement</code></a>æ–¹æ³•çš„å®ç°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fixClass</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">T</span> <span class="title">extends</span> <span class="title">Element</span> = <span class="title">HTMLDivElement</span>,</span></span><br><span class="line"><span class="function">  <span class="title">Attribute</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">HTMLAttributes</span>&lt;<span class="title">T</span>&gt; = <span class="title">React</span>.<span class="title">HTMLAttributes</span>&lt;<span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function">&gt;(<span class="params">cls: <span class="built_in">string</span>, <span class="keyword">type</span>: keyof React.ReactHTML = 'div'</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> FixedClassName: FC&lt;Attribute&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(<span class="keyword">type</span>, &#123; ...props, className: <span class="string">`<span class="subst">$&#123;cls&#125;</span> <span class="subst">$&#123;props.className&#125;</span>`</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> FixedClassName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Test</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> Container = fixClass(<span class="string">'card'</span>);</span><br><span class="line"><span class="keyword">const</span> Header = fixClass(<span class="string">'card__header'</span>, <span class="string">'header'</span>);</span><br><span class="line"><span class="keyword">const</span> Body = fixClass(<span class="string">'card__body'</span>, <span class="string">'main'</span>);</span><br><span class="line"><span class="keyword">const</span> Footer = fixClass(<span class="string">'card__body'</span>, <span class="string">'footer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Test = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &lt;Header&gt;header&lt;<span class="regexp">/Header&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Body&gt;header&lt;/</span>Body&gt;</span><br><span class="line">      &lt;Footer&gt;footer&lt;<span class="regexp">/Footer&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Container&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="5ï¸âƒ£-ä¸è¦ä½¿ç”¨-React-PropTypes"><a href="#5ï¸âƒ£-ä¸è¦ä½¿ç”¨-React-PropTypes" class="headerlink" title="5ï¸âƒ£ ä¸è¦ä½¿ç”¨ React.PropTypes"></a>5ï¸âƒ£ <strong>ä¸è¦ä½¿ç”¨ React.PropTypes</strong></h4><p>æœ‰äº† Typescript ä¹‹åå¯ä»¥å®‰å…¨åœ°çº¦æŸ Props å’Œ State, æ²¡æœ‰å¿…è¦å¼•å…¥ React.PropTypes, è€Œä¸”å®ƒçš„è¡¨è¾¾èƒ½åŠ›æ¯”è¾ƒå¼±</p><p><br></p><h4 id="6ï¸âƒ£-styled-components"><a href="#6ï¸âƒ£-styled-components" class="headerlink" title="6ï¸âƒ£ styled-components"></a>6ï¸âƒ£ <strong>styled-components</strong></h4><p>styled-components æ˜¯ç›®å‰æœ€æµè¡Œçš„<code>CSS-in-js</code>åº“, Typescript åœ¨ 2.9 æ”¯æŒæ³›å‹<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-9.html#generic-type-arguments-in-generic-tagged-templates" target="_blank" rel="noopener"><code>æ ‡ç­¾æ¨¡æ¿</code></a>. è¿™æ„å‘³ç€å¯ä»¥ç®€å•åœ°å¯¹ styled-components åˆ›å»ºçš„ç»„ä»¶è¿›è¡Œç±»å‹çº¦æŸ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾èµ–äº@types/styled-components</span></span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components/macro'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Title = styled.h1&lt;&#123; active?: <span class="built_in">boolean</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; (props.active ? 'red' : 'gray')&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±•å·²æœ‰ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> NewHeader = styled(Header)&lt;&#123; customColor: <span class="built_in">string</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; props.customColor&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p>äº†è§£æ›´å¤š<a href="https://www.styled-components.com/docs/api#typescript" target="_blank" rel="noopener">styled-components å’Œ Typescript</a></p><p><br></p><h4 id="7ï¸âƒ£-ä¸ºæ²¡æœ‰æä¾›-Typescript-å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜"><a href="#7ï¸âƒ£-ä¸ºæ²¡æœ‰æä¾›-Typescript-å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜" class="headerlink" title="7ï¸âƒ£ ä¸ºæ²¡æœ‰æä¾› Typescript å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜"></a>7ï¸âƒ£ <strong>ä¸ºæ²¡æœ‰æä¾› Typescript å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜</strong></h4><p>ç¬”è€…ä¸€èˆ¬ä¹ æƒ¯åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹(å’Œ tsconfig.json åŒåœ¨ä¸€ä¸ªç›®å½•ä¸‹)æ”¾ç½®ä¸€ä¸ª<code>global.d.ts</code>. æ”¾ç½®é¡¹ç›®çš„å…¨å±€å£°æ˜æ–‡ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /global.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ¨¡å—å£°æ˜</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> 'awesome-react-component' &#123;</span><br><span class="line">  <span class="comment">// ä¾èµ–å…¶ä»–æ¨¡å—çš„å£°æ˜æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> Foo: React.FC&lt;&#123; a: <span class="built_in">number</span>; b: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº†è§£æ›´å¤š<a href="https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html" target="_blank" rel="noopener">å¦‚ä½•å®šä¹‰å£°æ˜æ–‡ä»¶</a></p><p><br></p><h4 id="8ï¸âƒ£-ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡"><a href="#8ï¸âƒ£-ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡" class="headerlink" title="8ï¸âƒ£ ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡"></a>8ï¸âƒ£ <strong>ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡</strong></h4><p>ç›®å‰ç¤¾åŒºæœ‰å¤šç§ react ç»„ä»¶æ–‡æ¡£ç”Ÿæˆæ–¹æ¡ˆ, ä¾‹å¦‚<a href="https://www.docz.site" target="_blank" rel="noopener"><code>docz</code></a>, <a href="https://github.com/styleguidist/react-docgen-typescript" target="_blank" rel="noopener"><code>styleguidist</code></a>è¿˜æœ‰<a href="https://github.com/storybooks/storybook" target="_blank" rel="noopener">storybook</a>. å®ƒä»¬åº•å±‚éƒ½ä½¿ç”¨<a href="https://github.com/styleguidist/react-docgen-typescript" target="_blank" rel="noopener">react-docgen-typescript</a>å¯¹ Typescript è¿›è¡Œè§£æ. å°±ç›®å‰è€Œè¨€, å®ƒè¿˜æœ‰äº›å‘, è€Œä¸”è§£ææ¯”è¾ƒæ…¢. ä¸ç®¡ä¸å¦¨ç¢æˆ‘ä»¬ä½¿ç”¨å®ƒçš„é£æ ¼å¯¹ä»£ç è¿›è¡Œæ³¨é‡Š:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Propsæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ColumnProps <span class="keyword">extends</span> React.HTMLAttributes&lt;any&gt; &#123;</span><br><span class="line">  <span class="comment">/** prop1 description */</span></span><br><span class="line">  prop1?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** prop2 description */</span></span><br><span class="line">  prop2: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * prop3 description</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  prop3: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">/** prop4 description */</span></span><br><span class="line">  prop4: <span class="string">'option1'</span> | <span class="string">'option2'</span> | <span class="string">'option3'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹ç»„ä»¶è¿›è¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Column <span class="keyword">extends</span> Component&lt;ColumnProps, &#123;&#125;&gt; &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;Column&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="9ï¸âƒ£-å¼€å¯-strict-æ¨¡å¼"><a href="#9ï¸âƒ£-å¼€å¯-strict-æ¨¡å¼" class="headerlink" title="9ï¸âƒ£ å¼€å¯ strict æ¨¡å¼"></a>9ï¸âƒ£ <strong>å¼€å¯ strict æ¨¡å¼</strong></h4><p>ä¸ºäº†çœŸæ­£æŠŠ Typescript ç”¨èµ·æ¥, åº”è¯¥å§‹ç»ˆå¼€å¯ strict æ¨¡å¼, é¿å…ä½¿ç”¨ any ç±»å‹å£°æ˜.</p><p><br></p><hr><p><br></p><h3 id="æ‰©å±•èµ„æ–™"><a href="#æ‰©å±•èµ„æ–™" class="headerlink" title="æ‰©å±•èµ„æ–™"></a>æ‰©å±•èµ„æ–™</h3><ul><li><a href="https://github.com/piotrwitek/react-redux-typescript-guide" target="_blank" rel="noopener">piotrwitek/react-redux-typescript-guide</a></li><li><a href="https://www.zhihu.com/question/279911703" target="_blank" rel="noopener">TypeScript å¦‚ä½•å®Œç¾åœ°ä¹¦å†™ React ä¸­çš„ HOCï¼Ÿ</a></li><li><a href="https://www.typescriptlang.org/docs/home.html" target="_blank" rel="noopener">Typescript å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://basarat.gitbooks.io/typescript/docs/why-typescript.html" target="_blank" rel="noopener">Typescript-deep-dive</a></li><li><a href="https://github.com/ivan-94/mindnodes/tree/master/è¯­è¨€/Typescript" target="_blank" rel="noopener">Typescript æ€ç»´å¯¼å›¾</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç³»åˆ—å¼•è¨€&quot;&gt;&lt;a href=&quot;#ç³»åˆ—å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;ç³»åˆ—å¼•è¨€&quot;&gt;&lt;/a&gt;ç³»åˆ—å¼•è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘å‡†å¤‡åŸ¹è®­æ–°äºº, ä¸ºäº†æ–¹ä¾¿æ–°äººè¾ƒå¿«å…¥æ‰‹ React å¼€å‘å¹¶ç¼–å†™é«˜è´¨é‡çš„ç»„ä»¶ä»£ç , æˆ‘æ ¹æ®è‡ªå·±çš„å®è·µç»éªŒå¯¹&lt;strong&gt; 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Rxå»ºæ¨¡å…¥é—¨</title>
    <link href="https://bobi.ink/2019/04/19/rxjs-by-example/"/>
    <id>https://bobi.ink/2019/04/19/rxjs-by-example/</id>
    <published>2019-04-18T16:00:00.000Z</published>
    <updated>2019-04-21T12:08:02.515Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rx çš„å“åº”å¼ç¼–ç¨‹æ€ç»´æ¥å¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œå»ºæ¨¡, ä½ ä¼šäº†è§£åˆ°å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿å’Œä¸šåŠ¡æŠ½è±¡èƒ½åŠ›, å­¦ä¼šå°†ç°æœ‰çš„ä¸šåŠ¡æµç¨‹ä»¥æ•°æ®æµçš„æ–¹å¼è¡¨è¾¾å‡ºæ¥. ä½ çš„å·¥å…·åº“ä¸­ä¸èƒ½å°‘äº† Rx è¿™ä»¶åˆ©å™¨.</p><p>Rx å­¦ä¹ æ›²çº¿é™¡å³­æ˜¯æ€»æ‰€å‘¨çŸ¥çš„, æˆ‘ä»¬æ¥è§¦çš„å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€æˆ–æ¡†æ¶éƒ½æ˜¯é¢å‘å¯¹è±¡çš„. åœ¨é¢å¯¹ Rx è¿™å“åº”å¼ç¼–ç¨‹çš„æ–¹å¼, ä¼šè§‰å¾—æ— ä»å…¥æ‰‹,<br>ç¬”è€…ä¹Ÿæ˜¯ Rx çš„åˆå­¦è€…, æ‹œè¯»è¿‡å¤šæ¬¡<a href="https://www.zhihu.com/people/sharpmaster/posts" target="_blank" rel="noopener">å¾é£</a>Rx çš„ç›¸å…³æ–‡ç« , åŸºæœ¬ä¸Šéƒ½æ˜¯äº‘é‡Œé›¾é‡Œ. ä¸»è¦åŸå› è¿˜æ˜¯æ€ç»´æ²¡æœ‰è½¬æ¢è¿‡æ¥.</p><p>å¦‚æœä½ ä¸ç†è§£å“åº”å¼ç¼–ç¨‹çš„å¥¥å¦™ï¼Œæ˜¯å¾ˆéš¾åœ¨<strong>â€˜é¢å‘åœºæ™¯ç¼–ç¨‹â€™</strong>æ—¶è€ƒè™‘åˆ° Rx çš„ä¼˜åŠ¿. ç¬”è€…ä¸€èˆ¬éµå¾ªâ€™é¢å‘åœºæ™¯ç¼–ç¨‹â€™, å³åœ¨å¯¹åº”çš„åœºæ™¯è€ƒè™‘ä¸åŒçš„æŠ€æœ¯æˆ–æ¡†æ¶. å¯èƒ½æ˜¯ç—›ç‚¹è¿˜æ²¡æœ‰åˆ°éš¾ä»¥å¿å—çš„åœ°æ­¥ï¼Œæˆ–è®¸æ˜¯ç°æœ‰åº”ç”¨è¿˜ä¸å¤Ÿå¤æ‚ï¼Œæˆ‘ç›®å‰ä¸ºæ­¢è¿˜æ²¡æ¥è§¦åˆ°å¿…é¡»è¦åº”ç”¨ Rx çš„åœºæ™¯.</p><p>æˆ‘è§‰å¾—åº”è¯¥åè¿‡æ¥ï¼Œé‡‡å–åˆ»æ„å­¦ä¹ çš„æ–¹å¼æ¥å­¦ä¹  Rx, ä»¥æµçš„æ–¹å¼æ¥æ€è€ƒï¼Œå†å°†å…¶æ”¾åœ¨ç°æœ‰çš„åœºæ™¯ä¸­çœ‹æ˜¯å¦æœ‰æ›´ç®€æ´çš„è§£å†³æ–¹æ¡ˆæˆ–åŒ–å­¦ååº”.<br>ä¸å¾—ä¸è¯´å†™ Rx æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„äº‹æƒ…ã€‚ ä½†ä¹Ÿè¦è®¤è¯†åˆ° Rx ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œæ­£å¦‚å¾ˆå¤šæ•™ç¨‹æ‰€è¯´çš„ Rx æ“…é•¿å¤æ‚çš„å¼‚æ­¥åè°ƒï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚åˆï¼Œä¸€äº›é—®é¢˜æœ‰æ›´ç®€æ´çš„è§£å†³æ–¹æ¡ˆ</p><p><br></p><h2 id="Rx-çš„å»ºæ¨¡è¿‡ç¨‹"><a href="#Rx-çš„å»ºæ¨¡è¿‡ç¨‹" class="headerlink" title="Rx çš„å»ºæ¨¡è¿‡ç¨‹"></a>Rx çš„å»ºæ¨¡è¿‡ç¨‹</h2><p>å¯¹äº Rx çš„å…¥é—¨è€…, å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æµç¨‹, ä¸€æ­¥ä¸€æ­¥å°†ä¸šåŠ¡é€»è¾‘è½¬æ¢ä¸º Rx æ•°æ®æµæ¥è¿›è¡Œè¡¨è¾¾.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æµç¨‹å›¾ -&gt; æ•°æ®æµæŠ½è±¡ -&gt; å®ç°</span><br></pre></td></tr></table></figure><h3 id="â‘ -æµç¨‹å›¾"><a href="#â‘ -æµç¨‹å›¾" class="headerlink" title="â‘  æµç¨‹å›¾"></a><code>â‘  æµç¨‹å›¾</code></h3><p>é¦–å…ˆä»æµç¨‹å›¾å¼€å§‹, è¿™ä¸ªé˜¶æ®µæ²¡ä»€ä¹ˆç‰¹åˆ«çš„, ä¸ç®¡æ˜¯å“åº”å¼ç¼–ç¨‹è¿˜æ˜¯å…¶ä»–èŒƒå¼, ç¼–ç ä¹‹å‰éƒ½éœ€è¦ç¼•æ¸…ä¸šåŠ¡é€»è¾‘.</p><p>è¿™ä¸ªé˜¶æ®µä½¿ç”¨<code>æµç¨‹å›¾</code>æ¥æè¿°æŠ€æœ¯æ— å…³çš„äº‹åŠ¡è¿‡ç¨‹, è®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…æ™°, ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬è¯†åˆ«ä¸šåŠ¡æµç¨‹çš„ä¸»ä½“å’Œå…³é”®äº‹ä»¶.</p><blockquote><p>ä»€ä¹ˆæ˜¯ä¸šåŠ¡é€»è¾‘? <a href="https://en.wikipedia.org/wiki/Business_logic" target="_blank" rel="noopener">wiki</a> ä¸Šè¿™æ ·å®šä¹‰:<br><strong>Business logic</strong> or domain logic is that part of the program which encodes the real-world business rules that determine how data can be created, displayed, stored, and changed. It prescribes how business objects interact with one another, and enforces the routes and the methods by which business objects are accessed and updated.<br><br> <strong>Business Rules</strong> describe the operations, definitions and constraints that apply to an organization. The operations collectively form a process; every business uses these processes to form systems that get things done.</p></blockquote><p><br><br><br></p><h3 id="â‘¡-æ•°æ®æµæŠ½è±¡"><a href="#â‘¡-æ•°æ®æµæŠ½è±¡" class="headerlink" title="â‘¡ æ•°æ®æµæŠ½è±¡"></a><code>â‘¡ æ•°æ®æµæŠ½è±¡</code></h3><p>Rx çš„ä¸–ç•Œé‡Œé¢<em>ä¸€åˆ‡çš†æµ</em>, æ¢å¥è¯è¯´å°±æ˜¯<strong>é¢å‘æµç¼–ç¨‹</strong>. å’Œ<em>é¢å‘å¯¹è±¡ç¼–ç¨‹</em>æŠŠç°å®ä¸–ç•Œçš„å®ä½“æŠ½è±¡ä¸ºå¯¹è±¡ä¸€æ ·. å“åº”å¼ç¼–ç¨‹å°†ä¸šåŠ¡ä¸­çš„<em>å˜åŠ¨å®ä½“</em>(<em>æƒ³ä¸åˆ°æ›´å¥½çš„è¯, æˆ–è€…å˜é‡?</em>)æŠ½è±¡ä¸ºæµ</p><p><strong>(1)é¦–å…ˆéœ€è¦è¯†åˆ«ä»€ä¹ˆæ˜¯<em>å˜åŠ¨å®ä½“</em></strong>? å˜åŠ¨å®ä½“ä¸€èˆ¬æ˜¯æ•°æ®æµçš„æºå¤´, å®ƒé©±åŠ¨ç€ä¸šåŠ¡èµ°å‘. åƒæ²³æµä¸€æ ·, æºå¤´å¯èƒ½ä¸åªä¸€ä¸ª. æˆ‘è®¤ä¸ºå˜åŠ¨å®ä½“è‡³å°‘å…·å¤‡ä»¥ä¸‹ç‰¹å¾ä¹‹ä¸€:</p><ul><li>å®ƒæ˜¯å˜åŠ¨çš„. ä¾‹å¦‚é¼ æ ‡çš„ä½ç½®, å•†å“çš„ä»·æ ¼, éšç€æ—¶é—´çš„è¿ç§»çŠ¶æ€ä¼šè¿›è¡Œå˜åŠ¨</li><li>å®ƒæ˜¯ä¸šåŠ¡çš„â€™è¾“å…¥â€™. å˜åŠ¨å®ä½“æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„è¾“å…¥(å¤–éƒ¨äº‹ä»¶)æˆ–è€…æ˜¯å¦ä¸€ä¸ªæµ(è¡ç”Ÿ)çš„è¾“å…¥.</li><li>å®ƒæ˜¯ä¸šåŠ¡çš„å‚ä¸è€…(æˆ–è€…è¯´ä¸šåŠ¡çš„ä¸»ä½“).</li><li>å®ƒè¡¨ç¤ºä¸šåŠ¡çš„çŠ¶æ€. ä¾‹å¦‚ä¸€ä¸ª todo åˆ—è¡¨, è¿™æ˜¯ä¸€ä¸ªçº¯çŠ¶æ€çš„æµ</li></ul><p><strong>(2)æ¥ç€è¯†åˆ«<em>å˜åŠ¨å®ä½“</em>ä¹‹é—´çš„å…³ç³»</strong>. ä¸»ä½“ä¹‹é—´çš„å…³ç³»ä¹Ÿå°±æ˜¯æµä¹‹é—´çš„å…³ç³», è¿™æ˜¯ Rx å»ºæ¨¡çš„æ ¸å¿ƒ. åªæœ‰ç†è§£äº†ä¸»ä½“ä¹‹é—´çš„å…³ç³», æ‰èƒ½å°†ä¸»ä½“ä¸ä¸šåŠ¡æµç¨‹ä¸²è”èµ·æ¥, æ‰èƒ½çœŸæ­£åœ°ä½¿ç”¨æ•°æ®æµçš„æ–¹å¼å°†ä¸šåŠ¡è¡¨è¾¾å‡ºæ¥. åœ¨<a href="https://www.jianshu.com/p/c95e29854cb1" target="_blank" rel="noopener">é‡æ–°ç†è§£å“åº”å¼ç¼–ç¨‹</a>ä¸€æ–‡ä¸­å¯¹â€™å“åº”å¼ç¼–ç¨‹â€™çš„å®šä¹‰å’Œç¬”è€…çš„ç†è§£éå¸¸å¥‘åˆ:</p><blockquote><p>å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é€šè¿‡å¼‚æ­¥å’Œæ•°æ®æµæ¥æ„å»ºäº‹åŠ¡å…³ç³»çš„ç¼–ç¨‹æ¨¡å‹ . äº‹åŠ¡å…³ç³»æ˜¯å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒç†å¿µ, â€œæ•°æ®æµâ€å’Œâ€œå¼‚æ­¥â€æ˜¯å®ç°è¿™ä¸ªæ ¸å¿ƒç†å¿µçš„å…³é”®.</p></blockquote><p>è¿™ç§å…³ç³»å’Œé¢å‘å¯¹è±¡çš„ç±»å…³ç³»æ˜¯ä¸ä¸€æ ·çš„, é¢å‘å¯¹è±¡çš„å…³ç³»ä¸€èˆ¬æ˜¯æŒ‡ä¾èµ–å…³ç³». è€Œ<strong>æ•°æ®æµä¹‹é—´å…³ç³», æ˜¯ä¸šåŠ¡ä¹‹é—´çš„å®é™…å…³ç³»</strong>, æ¯”å¦‚æµç¨‹ b ä¾èµ–æµç¨‹ a, æ•°æ®æµæ˜¯å˜åŠ¨å®ä½“ä¹‹é—´çš„æ²Ÿé€šæ¡¥æ¢.</p><p>ä¸€èˆ¬ä»¥ä¸‹é¢çš„æ–¹æ³•æ¥æ„å»ºæµä¹‹é—´çš„å…³ç³»:</p><ul><li>åˆ†æ²»: å°†ä¸šåŠ¡åˆ’åˆ†ä¸ºå¤šä¸ªæ¨¡å—(æµ), ä¸€ä¸ªå¤§çš„æµæ€»æ˜¯ç”±å°çš„æµç»„æˆ, å°çš„æµèŒè´£æ›´å•ä¸€, æ›´å®¹æ˜“ç†è§£å’Œæµ‹è¯•</li><li>å˜æ¢: å°†æµæ˜ å°„ä¸ºå¦å¤–ä¸€ä¸ªæµ. ä¸€èˆ¬ç”¨äºçŠ¶æ€å˜æ›´æˆ–ä¸šåŠ¡è¡ç”Ÿ(é«˜é˜¶æµå˜æ¢)</li><li>åˆå¹¶: åƒæ²³æµä¸€æ ·, æ•°æ®æµæœ€ç»ˆæ˜¯éœ€è¦æ±‡èšåœ¨ä¸€èµ·æ³¨å…¥å¤§æµ·çš„. æ‹†åˆ†å’Œåˆå¹¶çš„æ–¹å¼éƒ½æ˜¯ä¾èµ–äºæ‰€è¦è¡¨è¾¾çš„ä¸šåŠ¡é€»è¾‘</li></ul><p>æ€»çš„æ¥è¯´å˜åŠ¨å®ä½“ä¸€èˆ¬å°±æ˜¯ä¸šåŠ¡çš„â€™<strong>è¾“å…¥</strong>â€˜, æˆ‘ä»¬é¦–å…ˆæŠŠå®ƒä»¬ç¡®å®šä¸ºæµ, å†æ ¹æ®å…³ç³»è¡ç”Ÿå‡ºå…¶ä»–æµ(<strong>è¾“å‡º</strong>). å¯¹äºæµæœ¬èº«æ¥è¯´, <strong>æœ¬è´¨ä¸Šåªæœ‰è¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»</strong>:</p><p><img src="/images/03/stream.png" alt="stream"></p><p>ä¾‹å¦‚ increment$å’Œdecrement$å°±æ˜¯ action$çš„è¾“å…¥, action$å°±æ˜¯ count$çš„è¾“å…¥, ä»¥æ­¤ç±»æ¨. <strong>å“åº”å¼ç¼–ç¨‹å°†å¤æ‚ä¸šåŠ¡å…³ç³»è½¬æ¢æˆåŸå§‹çš„è¾“å‡º/è¾“å‡ºå…³ç³»</strong></p><p><strong>(3)ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„çº¦æŸ</strong>. ä¸€èˆ¬æ¥è¯´, æˆ‘ä»¬è¯´çš„å“åº”å¼ç¼–ç¨‹æŒ‡çš„æ˜¯<code>å‡½æ•°å¼å“åº”å¼ç¼–ç¨‹(Functional reactive programming FRP)</code>, æ‰€ä»¥éœ€è¦ç¬¦åˆå‡½æ•°å¼çš„ä¸€äº›çº¦æŸ:</p><ul><li><code>çº¯å‡½æ•°(Pure)</code>: å‡½æ•°åªæ˜¯è¾“å…¥å‚æ•°åˆ°è¾“å‡ºç»“æœçš„æ˜ å°„, ä¸è¦äº§ç”Ÿå‰¯ä½œç”¨<ul><li>æ²¡æœ‰å…±äº«çŠ¶æ€: ä¸ä¾èµ–å¤–éƒ¨å˜é‡æ¥ç»´æŠ¤æµç¨‹çš„çŠ¶æ€.</li><li>å¹‚ç­‰æ€§: å¹‚ç­‰æ€§åœ¨å¤æ‚æµç¨‹ä¸­å¾ˆé‡è¦, è¿™ä½¿å¾—æ•´ä¸ªæµç¨‹å¯è¢«é‡è¯•</li><li>æ²¡æœ‰å‰¯ä½œç”¨: å¯é¢„æµ‹, å¯æµ‹è¯•.</li></ul></li><li><code>ä¸å¯å˜æ€§(Immuatability)</code>: æ•°æ®ä¸€æ—¦äº§ç”Ÿ, å°±è‚¯å®šå®ƒçš„å€¼ä¸ä¼šå˜åŒ–, è¿™æœ‰åˆ©äºä»£ç çš„ç†è§£. æ˜“äºå¹¶å‘</li><li><code>å£°æ˜å¼(Declarative)</code>:<ul><li>å‡½æ•°å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹ç›¸æ¯”æœ‰è¾ƒé«˜çš„æŠ½è±¡çº§åˆ«, ä»–å¯ä»¥è®©ä½ ä¸“æ³¨äºå®šä¹‰ä¸äº‹ä»¶ç›¸äº’ä¾å­˜çš„ä¸šåŠ¡é€»è¾‘, è€Œä¸æ˜¯åœ¨å®ç°ç»†èŠ‚ä¸Š. æ¢å¥è¯è¯´, å‡½æ•°å¼ç¼–ç¨‹å®šä¹‰å…³ç³», è€Œå‘½ä»¤å¼ç¼–ç¨‹å®šä¹‰æ­¥éª¤</li><li>é›†ä¸­çš„é€»è¾‘. Rx è‡ªç„¶è€Œç„¶åœ¨ä¸€å¤„å®šä¹‰é€»è¾‘, é¿å…å…¶ä»–èŒƒå¼é€»è¾‘åˆ†æ•£åœ¨ä»£ç åº“çš„å„ä¸ªåœ°æ–¹. å¦å¤– Rx çš„ Observable é€šè¿‡è®¢é˜…æ¥åˆ›å»ºèµ„æº, é€šè¿‡å–æ¶ˆè®¢é˜…æ¥é‡Šæ”¾èµ„æº, ä¸€èˆ¬å¼€å‘å‡ ä¹ä¸éœ€è¦å»å…³å¿ƒèµ„æºçš„ç”Ÿå‘½å‘¨æœŸ, ä¾‹å¦‚æ—¶é—´å™¨.</li></ul></li></ul><p>è¿™ä¸ªé˜¶æ®µå°†ç¬¬ä¸€ä¸ªé˜¶æ®µçš„æµç¨‹å›¾è½¬æ¢ä¸º Rx <code>å¼¹ç å›¾(Marble Diagrams)</code>è¡¨ç¤º, å¼¹ç å›¾å¯ä»¥æè¿°æµä¹‹é—´å…³ç³», è¡¨ç°â€™æ—¶é—´â€™çš„æµé€, è®©å¤æ‚çš„æ•°æ®æµæ›´å®¹æ˜“ç†è§£</p><p><br><br><br></p><h3 id="â‘¢-å®ç°"><a href="#â‘¢-å®ç°" class="headerlink" title="â‘¢ å®ç°"></a><code>â‘¢ å®ç°</code></h3><p>è¿™ä¸ªé˜¶æ®µå°±æ˜¯æŠŠå¼¹ç å›¾ç¿»è¯‘ä¸ºå®ç°ä»£ç , æ ¹æ®éœ€æ±‚åœ¨ rxjs å·¥å…·ç®±ä¸­æŸ¥æ‰¾åˆé€‚çš„æ“ä½œç¬¦. å½“ç¼•æ¸…äº†ä¸šåŠ¡é€»è¾‘, ä½¿ç”¨æ•°æ®æµè¿›è¡Œå»ºæ¨¡å,<br>ä»£ç å®ç°å°±æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…äº†.</p><blockquote><p>å¯ä»¥é…åˆ Rxjs å®˜æ–¹çš„<a href="https://rxjs.dev/operator-decision-tree" target="_blank" rel="noopener">æ“ä½œç¬¦å†³ç­–æ ‘</a>é€‰æ‹©åˆé€‚çš„æ“ä½œç¬¦</p></blockquote><p><br></p><hr><p><br></p><p>ä¸‹é¢ä½¿ç”¨ä¾‹å­æ¥ä½“ä¼š Rx çš„ç¼–ç¨‹æ€ç»´:</p><h2 id="Example-1-c-a-b"><a href="#Example-1-c-a-b" class="headerlink" title="Example 1: c := a + b"></a>Example 1: c := a + b</h2><p>è¿™æ˜¯æœ€ç®€å•çš„å®ä¾‹, æˆ‘ä»¬æœŸæœ›å½“ a å’Œ b å˜åŠ¨æ—¶èƒ½å¤Ÿå“åº”åˆ° c, æˆ‘ä»¬æŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤å¯¹è¿™ä¸ªéœ€æ±‚è¿›è¡Œå»ºæ¨¡:</p><ul><li><p><code>æµç¨‹</code>:</p><p><img src="/images/03/process-02.png" alt="c=a+b"></p></li><li><p><code>æ•°æ®æµæŠ½è±¡</code>: ä»ä¸Šå¯ä»¥è¯†åˆ«å‡ºä¸¤ä¸ªå˜åŠ¨çš„å®ä½“ a å’Œ b, æ‰€ä»¥ a å’Œ b éƒ½å¯ä»¥è§†ä½œæµ, é‚£ä¹ˆ c å°±æ˜¯ a å’Œ b è¡ç”Ÿå‡ºæ¥çš„æµ, è¡¨ç¤º a å’Œ b çš„å®æ—¶åŠ æ³•ç»“æœ, ä½¿ç”¨å¼¹ç å›¾æ¥æè¿°ä¸‰è€…çš„å…³ç³»:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">a$</span>: ----1------------2---------------</span><br><span class="line"><span class="meta">b$</span>: --2-------4------------6------8------</span><br><span class="line">              \ (a + b) /</span><br><span class="line"><span class="meta">c$</span>: ----3-----5------6-----8------10-----</span><br></pre></td></tr></table></figure></li><li><p><code>ä»£ç å®ç°</code>: ç”±å¼¹ç å›¾å¯ä»¥çœ‹å‡º, c$æµçš„è¾“å‡ºå€¼å°±æ˜¯a$å’Œ b$è¾“å‡ºå€¼çš„å®æ—¶è®¡ç®—ç»“æœ, ä¹Ÿå°±æ˜¯è¯´c$æ¥æ”¶æ¥è‡ª a$å’Œb$ çš„æœ€æ–°æ•°æ®, è¾“å‡ºä»–ä»¬çš„å’Œ.<br>å¦å¤–ç”±åŸæœ¬çš„ä¸¤ä¸ªæµåˆå¹¶ä¸ºå•ä¸ªæµ, åœ¨ rxjs å·¥å…·ç®±ä¸­å¯ä»¥æ‰¾åˆ°<code>combineLatest</code>æ“ä½œç¬¦ç¬¦åˆè¯¥åœºæ™¯. ä»£ç å®ç°å¦‚ä¸‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a$ = interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">const</span> b$ = interval(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">a$.pipe(combineLatest(b$))</span><br><span class="line">  .pipe(map(<span class="function">(<span class="params">[a, b]</span>) =&gt;</span> a + b))</span><br><span class="line">  .subscribe(<span class="function"><span class="params">sum</span> =&gt;</span> <span class="built_in">console</span>.log(sum));</span><br></pre></td></tr></table></figure></li></ul><p><br></p><hr><p><br></p><h2 id="Example-2-å…ƒç´ æ‹–æ‹½çš„ä¾‹å­"><a href="#Example-2-å…ƒç´ æ‹–æ‹½çš„ä¾‹å­" class="headerlink" title="Example 2: å…ƒç´ æ‹–æ‹½çš„ä¾‹å­"></a>Example 2: å…ƒç´ æ‹–æ‹½çš„ä¾‹å­</h2><p>å…ƒç´ æ‹–æ‹½ä¹Ÿæ˜¯ Rx çš„ç»å…¸ä¾‹å­çš„çš„ä¾‹å­. å‡è®¾æˆ‘ä»¬éœ€è¦å…ˆç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æ”¯æŒå…ƒç´ æ‹–æ‹½ç§»åŠ¨.</p><p><code>æµç¨‹å›¾</code></p><p><img src="/images/03/process-01.png" alt></p><p><code>æ•°æ®æµæŠ½è±¡</code></p><p>è¿™é‡Œä½¿ç”¨åˆ†æ²»çš„æ–¹æ³•, å°†æµç¨‹è¿›è¡Œä¸€æ­¥æ­¥æ‹†è§£, ç„¶åä½¿ç”¨å¼¹ç å›¾çš„å½¢å¼è¿›è¡Œæè¿°.</p><p>ç”±ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥è¯†åˆ«å‡ºæ¥, down, move ä»¥åŠ up éƒ½æ˜¯<code>å˜åŠ¨å®ä½“</code>, æˆ‘ä»¬å¯ä»¥å°†ä»–ä»¬è§†ä½œâ€™æµâ€™.</p><p>â‘  down/move/up éƒ½æ˜¯æŠ½è±¡çš„äº‹ä»¶, åœ¨æ¡Œé¢ç«¯ä¸‹æ˜¯ mousedown/mousemove/mouseup, ç§»åŠ¨ç«¯ä¸‹å¯¹åº”çš„æ˜¯<br>touchstart/touchmove/touchend. æˆ‘ä»¬ä¸åŒºåˆ†è¿™äº›äº‹ä»¶, ä¾‹å¦‚æ¥æ”¶åˆ° mousedown æˆ– touchstart äº‹ä»¶éƒ½è®¤ä¸ºæ˜¯ä¸€ä¸ªâ€™downâ€™äº‹ä»¶. æ‰€ä»¥äº‹ä»¶ç›‘å¬çš„æ•°æ®æµå¦‚:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1</span><br><span class="line"><span class="meta">mousedown$</span> : ---d----------d--------</span><br><span class="line"><span class="meta">touchstart$</span>: -s---s-----------s-----</span><br><span class="line">        \(merge)/</span><br><span class="line"><span class="meta">down$</span>      : -s-d-s--------d--s-----</span><br></pre></td></tr></table></figure><p>move å’Œ up äº‹ä»¶åŒç†</p><p>â‘¡ æ¥ä¸‹æ¥è¦è¯†åˆ« up$, move$, down$ ä¸‰ä¸ªæ•°æ®æµä¹‹é—´çš„å…³ç³», down äº‹ä»¶è§¦å‘åæˆ‘ä»¬æ‰ä¼šå»ç›‘å¬ move å’Œ up äº‹ä»¶, ä¹Ÿå°±æ˜¯è¯´ç”± down$å¯ä»¥è¡ç”Ÿå‡º move$å’Œ up$æµ. åœ¨ up äº‹ä»¶è§¦å‘åæ•´ä¸ªæµç¨‹å°±ç»ˆæ­¢. up$æµå†³å®šäº†æ•´ä¸ªæµç¨‹çš„ç”Ÿå‘½å‘¨æœŸçš„ç»“æŸ</p><p>ä½¿ç”¨å¼¹ç å›¾çš„æè¿°ä¸‰è€…çš„å…³ç³»å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 2</span><br><span class="line"><span class="meta">down$</span>: -----d-------------------------</span><br><span class="line">             \</span><br><span class="line"><span class="meta">up$</span>  :        ----------u|</span><br><span class="line"><span class="meta">move$</span>:        -m--m--m---|</span><br></pre></td></tr></table></figure><p>â‘¢ ä¸€ä¸ªæ‹–æ‹½ç»“æŸåè¿˜å¯ä»¥é‡æ–°å†å‘èµ·æ‹–æ‹½, å³æˆ‘ä»¬ä¼šæŒç»­ç›‘å¬ down äº‹ä»¶. ä¸Šé¢çš„æµç¨‹è¿˜è§„å®šå¦‚æœå½“å‰æ‹–æ‹½è¿˜æœªç»“æŸ,<br>å…¶ä»– down äº‹ä»¶åº”è¯¥è¢«å¿½ç•¥, åœ¨ç§»åŠ¨ç«¯ä¸‹å¤šç‚¹è§¦æ‘¸æ˜¯å¯èƒ½å¯¼è‡´å¤šä¸ª down äº‹ä»¶è§¦å‘çš„.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 3</span><br><span class="line"><span class="meta">down$</span>: ---d---d--d---------d------    # ä¸­é—´ä¸¤ä¸ªäº‹ä»¶å› ä¸ºæ‹–æ‹½æœªå®Œæˆè¢«å¿½ç•¥</span><br><span class="line">           \                \</span><br><span class="line"><span class="meta">up$</span>:        -----u|          ------u|</span><br><span class="line"><span class="meta">move$</span>:      -m-mm-|          m-m-m--|</span><br></pre></td></tr></table></figure><p><code>å®ç°</code>:</p><p>æœ‰äº†å¼¹ç å›¾å, å°±æ˜¯æŠŠç¿»è¯‘é—®é¢˜äº†, ç°åœ¨å°±æ‰“å¼€ rxjs çš„å·¥å…·ç®±, æ‰¾æ‰¾æœ‰ä»€ä¹ˆåˆé€‚çš„å·¥å…·.</p><p>é¦–å…ˆæ˜¯æŠ½è±¡äº‹ä»¶çš„å¤„ç†. ç”±#1 å¯ä»¥çœ‹å‡º, è¿™å°±æ˜¯ä¸€ä¸ªæ•°æ®æµåˆå¹¶, è¿™ä¸ªé€‚åˆä½¿ç”¨<code>merge</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">merge(fromEvent(el, <span class="string">'touchstart'</span>), fromEvent(el, <span class="string">'mousedown'</span>));</span><br></pre></td></tr></table></figure><p>down$æµçš„åˆ‡æ¢å¯ä»¥ä½¿ç”¨<code>exhaustMap</code>æ“ä½œç¬¦, è¿™ä¸ªæ“ä½œç¬¦å¯ä»¥å°†è¾“å‡ºå€¼æ˜ å°„ä¸ºObservable, æœ€åå†ä½¿ç”¨exhaustæ“ä½œç¬¦å¯¹Observableè¿›è¡Œåˆå¹¶.<br>è¿™å¯ä»¥æ»¡è¶³æˆ‘ä»¬â€™å½“ä¸€ä¸ªæ‹–æ‹½æœªç»“æŸæ—¶, æ–°å‘èµ·çš„ down$è¾“å‡ºä¼šè¢«å¿½ç•¥, ç›´åˆ°æ‹–æ‹½å®Œç»“â€™çš„éœ€æ±‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">down$</span><br><span class="line">  .pipe(</span><br><span class="line">    exhaustMap(<span class="function"><span class="params">evt</span> =&gt;</span> <span class="comment">/* è½¬æ¢ä¸ºæ–°çš„Observableæµ */</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ exhaustMap æ¥å°† down$è¾“å‡ºå€¼è½¬æ¢ä¸ºmove$ æµ, å¹¶åœ¨ up$ è¾“å‡ºåç»“æŸ, å¯ä»¥ä½¿ç”¨<code>takeUntil</code>æ“ä½œç¬¦:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">down$</span><br><span class="line">  .pipe(</span><br><span class="line">    exhaustMap(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">      evt.preventDefault();</span><br><span class="line">      <span class="keyword">if</span> (evt.type === <span class="string">'mousedown'</span>) &#123;</span><br><span class="line">        <span class="comment">// é¼ æ ‡æ§åˆ¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123; clientX, clientY &#125; = evt <span class="keyword">as</span> MouseEvent;</span><br><span class="line">        <span class="keyword">return</span> mouseMove$.pipe(</span><br><span class="line">          map(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">              deltaX: (evt <span class="keyword">as</span> MouseEvent).clientX - clientX,</span><br><span class="line">              deltaY: (evt <span class="keyword">as</span> MouseEvent).clientY - clientY,</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;),</span><br><span class="line">          takeUntil(mouseUp$),</span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è§¦æ‘¸äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123; touches &#125; = evt <span class="keyword">as</span> TouchEvent;</span><br><span class="line">        <span class="keyword">const</span> touch = touches[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">const</span> &#123; clientX, clientY &#125; = touch;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> getTouch = <span class="function">(<span class="params">evt: TouchEvent</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> touches = <span class="built_in">Array</span>.from(evt.changedTouches);</span><br><span class="line">          <span class="keyword">return</span> touches.find(<span class="function"><span class="params">t</span> =&gt;</span> t.identifier === touch.identifier);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> touchFilter = filter(<span class="function">(<span class="params">e: Event</span>) =&gt;</span> !!getTouch(e <span class="keyword">as</span> TouchEvent));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> touchMove$.pipe(</span><br><span class="line">          touchFilter,</span><br><span class="line">          map(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> touch = getTouch(evt <span class="keyword">as</span> TouchEvent)!;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">              deltaX: touch.clientX - clientX,</span><br><span class="line">              deltaY: touch.clientY - clientY,</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;),</span><br><span class="line">          takeUntil(touchUp$.pipe(touchFilter)),</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">  )</span><br><span class="line">  .subscribe(<span class="function"><span class="params">delta</span> =&gt;</span> &#123;</span><br><span class="line">    el.style.transform = <span class="string">`translate(<span class="subst">$&#123;delta.deltaX&#125;</span>px, <span class="subst">$&#123;delta.deltaY&#125;</span>px)`</span>;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h2 id="Example-3-Todos"><a href="#Example-3-Todos" class="headerlink" title="Example 3: Todos"></a>Example 3: Todos</h2><p>å¦‚æœä½¿ç”¨ rxjs æ¥åˆ›å»º Todos åº”ç”¨, é¦–å…ˆæ˜¯<code>æµç¨‹å›¾</code>:</p><p><img src="/images/03/process-03.png" alt></p><p><code>æ•°æ®æµæŠ½è±¡</code>:</p><p>é¦–å…ˆè¯†åˆ«å˜åŠ¨çš„å®ä½“, å˜åŠ¨çš„å®ä½“å°±æ˜¯ todos åˆ—è¡¨, æ‰€ä»¥å¯ä»¥è®¤ä¸º todos åˆ—è¡¨å°±æ˜¯ä¸€ä¸ªæµ. å®ƒä» localStorage ä¸­æ¢å¤<br>åˆå§‹åŒ–çŠ¶æ€. ç”±<code>æ–°å¢</code>, <code>åˆ é™¤</code>ç­‰äº‹ä»¶è§¦å‘çŠ¶æ€æ”¹å˜, è¿™äº›äº‹ä»¶ä¹Ÿå¯ä»¥è§†ä½œæµ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">add$</span>:      --a-----a------</span><br><span class="line"><span class="meta">modify$</span>:   ----m----------</span><br><span class="line"><span class="meta">remove$</span>    -------r-------</span><br><span class="line"><span class="meta">complete$</span>: ------c----c---</span><br><span class="line">             \(merge)/</span><br><span class="line"><span class="meta">update$</span>    --a-m-cra--c--- # å„ç§äº‹ä»¶åˆå¹¶ä¸ºupdate$æµ</span><br><span class="line">              \(reduce)/</span><br><span class="line"><span class="meta">todos$</span>:    i-u-u-uuu--u---- # i ä¸ºåˆå§‹åŒ–æ•°æ®, update$çš„è¾“å‡ºå°†è§¦å‘é‡æ–°è®¡ç®—çŠ¶æ€</span><br></pre></td></tr></table></figure><p>todos$æµä¼šå“åº”åˆ° view ä¸Š, å¦ä¸€æ–¹é¢éœ€è¦æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨. ä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªå¤šæ’­æµ.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">todos$</span>: i-u-u-uuu--u---- #</span><br><span class="line">          \(debounce)/</span><br><span class="line"><span class="meta">save$</span>   i--u--u---u----- # å­˜å‚¨æµ, ä½¿ç”¨debounceæ¥é¿å…é¢‘ç¹å­˜å‚¨</span><br></pre></td></tr></table></figure><p>å¹¶è¡Œæ¸²æŸ“åˆ°é¡µé¢:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">todos$</span>: i-u-u-uuu--u---- #</span><br><span class="line">       \(render)/</span><br><span class="line"><span class="meta">dom$</span>:   i--u--u---u----- # domæ¸²æŸ“, å‡è®¾ä¹Ÿæ˜¯æµ(cycle.jså°±æ˜¯å¦‚æ­¤)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå®ä¾‹çš„æ•°æ®æµå’Œ Redux çš„æ¨¡å‹éå¸¸åƒ, add$, modify$, remove$å’Œcomplete$å°±æ˜¯ Action, todos æµä¼šä½¿ç”¨<br>ç±»ä¼¼ Reducer çš„æœºåˆ¶æ¥å¤„ç†è¿™äº› Action ç”Ÿæˆæ–°çš„ State</p><p><img src="/images/03/redux.png" alt="redux"></p><p><code>ä»£ç å®ç°</code>:</p><p>é¦–å…ˆ add$, modify$ä»¥åŠ remove$å’Œcomplete$å¯ä»¥åˆ†åˆ«ä½¿ç”¨ä¸€ä¸ª Subject å¯¹è±¡æ¥è¡¨ç¤º, ç”¨äºæ¥æ”¶å¤–éƒ¨äº‹ä»¶. å…¶å®è¿˜å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªæµ,<br>å®ƒä»¬çš„åŒºåˆ«åªæ˜¯å‚æ•°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Action&lt;T = any&gt; &#123;</span><br><span class="line">  <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line">  payload: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> INIT_ACTION = <span class="string">'INIT'</span>; <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">const</span> ADD_ACTION = <span class="string">'ADD'</span>;</span><br><span class="line"><span class="keyword">const</span> REMOVE_ACTION = <span class="string">'REMOVE'</span>;</span><br><span class="line"><span class="keyword">const</span> MODIFY_ACTION = <span class="string">'MODIFY'</span>;</span><br><span class="line"><span class="keyword">const</span> COMPLETE_ACTION = <span class="string">'COMPLETE'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> update$ = <span class="keyword">new</span> Subject&lt;Action&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">value: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: ADD_ACTION,</span><br><span class="line">    payload: value,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">id: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: REMOVE_ACTION,</span><br><span class="line">    payload: id,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complete</span>(<span class="params">id: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: COMPLETE_ACTION,</span><br><span class="line">    payload: id,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">modify</span>(<span class="params">id: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: MODIFY_ACTION,</span><br><span class="line">    payload: &#123; id, value &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºtodos$æµ, å¯¹update$ çš„è¾“å‡ºè¿›è¡Œ reduce:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–Store</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initialStore</span>(<span class="params"></span>): <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> value = <span class="built_in">window</span>.localStorage.getItem(STORAGE_KEY);</span><br><span class="line">  <span class="keyword">return</span> value ? <span class="built_in">JSON</span>.parse(value) : &#123; list: [] &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todos$ = update$.pipe(</span><br><span class="line">  <span class="comment">// ä»INIT_ACTION è§¦å‘scanåˆå§‹åŒ–</span></span><br><span class="line">  startWith(&#123; <span class="keyword">type</span>: INIT_ACTION &#125; <span class="keyword">as</span> Action),</span><br><span class="line">  <span class="comment">// reducer</span></span><br><span class="line">  scan&lt;Action, Store&gt;<span class="function">(<span class="params">(<span class="params">state, &#123; <span class="keyword">type</span>, payload &#125;</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> produce(<span class="params">state, draftState =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">let</span> idx: <span class="built_in">number</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">switch</span> (<span class="params"><span class="keyword">type</span></span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> ADD_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          draftState.list.push(<span class="params">&#123;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">            id: <span class="built_in">Date</span>.now(<span class="params"></span>).toString(<span class="params"></span>),</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">            value: payload,</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">          &#125;</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> MODIFY_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          idx = draftState.list.findIndex(<span class="params">i =&gt; i.id === payload.id</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">idx !== -1</span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            draftState.list[idx].value = payload.value;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> REMOVE_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          idx = draftState.list.findIndex(<span class="params">i =&gt; i.id === payload</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">idx !== -1</span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            draftState.list.splice(<span class="params">idx, 1</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> COMPLETE_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          idx = draftState.list.findIndex(<span class="params">i =&gt; i.id === payload</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">idx !== -1</span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            draftState.list[idx].completed = <span class="literal">true</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">default</span>:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, initialStore(<span class="params"></span>)</span>),</span></span><br><span class="line"><span class="function">  // æ”¯æŒå¤šæ’­</span></span><br><span class="line"><span class="function">  <span class="params">shareReplay</span><span class="params">()</span>,</span></span><br><span class="line"><span class="function">);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// æŒä¹…åŒ–</span></span><br><span class="line"><span class="function"><span class="params">todos</span>$.<span class="params">pipe</span>(<span class="params">debounceTime(<span class="params">1000</span>)</span>).<span class="params">subscribe</span>(<span class="params">store =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="built_in">window</span>.localStorage.setItem(<span class="params">STORAGE_KEY, <span class="built_in">JSON</span>.stringify(<span class="params">store</span>)</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>);</span></span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šä¾‹å­: å¾é£åœ¨<a href="https://github.com/xufei/blog/issues/44" target="_blank" rel="noopener">â€œRxJS å…¥é—¨æŒ‡å¼•å’Œåˆæ­¥åº”ç”¨&gt;â€</a>æåˆ°äº†ä¸€ä¸ªâ€å¹¸ç¦äººç”Ÿâ€çš„ä¾‹å­, æŒºæœ‰æ„æ€, è¯»è€…å¯ä»¥å°è¯•å¯¹å…¶è¿›è¡Œå»ºæ¨¡</p></blockquote><p><br></p><hr><p><br></p><p>ç»è¿‡ä¸Šè¿°è¿‡ç¨‹, å¯ä»¥æ·±åˆ»ä½“ä¼šåˆ°<em>å‡½æ•°å“åº”å¼ç¼–ç¨‹</em>çš„<strong>ä¼˜åŠ¿</strong>:</p><ul><li><strong>æ•°æ®æµæŠ½è±¡äº†å¾ˆå¤šç°å®é—®é¢˜</strong>. ä¹Ÿå°±è¯´æ•°æ®æµå¯¹ä¸šåŠ¡é€»è¾‘çš„è¡¨è¾¾èƒ½åŠ›æµç¨‹å›¾åŸºæœ¬ä¸€è‡´. å¯ä»¥è¯´å¼¹ç å›¾æ˜¯æµç¨‹å›¾çš„ç›´è§‚ç¿»è¯‘, è€Œ Rx ä»£ç åˆ™æ˜¯å¼¹ç å›¾çš„ç›´è§‚ç¿»è¯‘. ä½¿ç”¨ Rx ä»¥å£°æ˜å¼å½¢å¼ç¼–å†™ä»£ç , å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç†è§£, å› ä¸ºå®ƒä»¬æ¥è¿‘ä¸šåŠ¡æµç¨‹.</li><li><strong>æŠŠå¤æ‚çš„é—®é¢˜åˆ†è§£æˆç®€å•çš„é—®é¢˜çš„ç»„åˆ</strong>. Rx ç¼–ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®æµçš„åˆ†æ²»å’Œåˆå¹¶</li></ul><h2 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h2><ul><li><a href="https://www.jianshu.com/p/c95e29854cb1" target="_blank" rel="noopener">é‡æ–°ç†è§£å“åº”å¼ç¼–ç¨‹</a></li><li><a href="https://zhuanlan.zhihu.com/p/53009201" target="_blank" rel="noopener">ã€å“åº”å¼ç¼–ç¨‹çš„æ€ç»´è‰ºæœ¯ã€‘å“åº”å¼ Vs é¢å‘å¯¹è±¡</a></li><li><a href="http://www.uml.org.cn/zjjs/201008021.asp" target="_blank" rel="noopener">ç»†è¯´ä¸šåŠ¡é€»è¾‘</a></li><li><a href="https://en.wikipedia.org/wiki/Reactive_programming" target="_blank" rel="noopener">Reactive programming</a></li><li><a href="https://github.com/xufei/blog/issues/44" target="_blank" rel="noopener">RxJS å…¥é—¨æŒ‡å¼•å’Œåˆæ­¥åº”ç”¨</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rx çš„å“åº”å¼ç¼–ç¨‹æ€ç»´æ¥å¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œå»ºæ¨¡, ä½ ä¼šäº†è§£åˆ°å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿å’Œä¸šåŠ¡æŠ½è±¡èƒ½åŠ›, å­¦ä¼šå°†ç°æœ‰çš„ä¸šåŠ¡æµç¨‹ä»¥æ•°æ®æµçš„æ–¹å¼è¡¨è¾¾å‡ºæ¥. ä½ çš„å·¥å…·åº“ä¸­ä¸èƒ½å°‘äº† Rx è¿™ä»¶åˆ©å™¨.&lt;/p&gt;
&lt;p&gt;Rx å­¦ä¹ æ›²çº¿é™¡å³­æ˜¯æ€»æ‰€å‘¨çŸ¥çš„, æˆ‘ä»¬æ¥è§¦çš„å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€æˆ–æ¡†æ¶éƒ½
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Yarn Plug&#39;n&#39;Playå¯å¦åŠ©ä½ è„±ç¦»node_modulesè‹¦æµ·?</title>
    <link href="https://bobi.ink/2019/04/08/plug-n-play/"/>
    <id>https://bobi.ink/2019/04/08/plug-n-play/</id>
    <published>2019-04-07T16:00:00.000Z</published>
    <updated>2019-04-07T04:18:21.737Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ Yarn(v1.12+)çš„ Plugâ€™nâ€™Play æœºåˆ¶æ¥å–ä»£ node_modules. ç›®å‰è¿™è¿˜æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ç‰¹æ€§.</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p><img src="/images/node_modules-hole.png" alt="node_modules"></p><p><code>node_modules</code>æ—©å°±æˆä¸ºçš„å…¨æ°‘åæ§½çš„å¯¹è±¡, å…¶ä»–è¯­è¨€çš„å¼€å‘è€…çœ‹åˆ° node_modules å¯¹ Node å°±æœ›è€Œç¥›æ­¥äº†,<br>ç”¨ä¸€ä¸ªå­—æ¥å½¢å®¹çš„è¯å°±æ˜¯â€™é‡!â€™.</p><blockquote><p>å¦‚æœä¸äº†è§£ Node æ¨¡å—æŸ¥æ‰¾æœºåˆ¶, è¯·ç‚¹å‡»<a href="http://www.ruanyifeng.com/blog/2015/05/require.html" target="_blank" rel="noopener">require() æºç è§£è¯»</a></p></blockquote><p>ä¸€ä¸ªç®€å•çš„å‰ç«¯é¡¹ç›®(<em>create-react-app</em>)çš„å¤§å°å’Œæ–‡ä»¶æ•°:</p><center><br>  <img src="/images/front-end-project.png" alt="frontend-project" width="400"><br></center><p>è€Œ macOS çš„<code>/Library</code>ç›®å½•çš„å¤§å°çš„æ–‡ä»¶æ•°:</p><center><br>  <img src="/images/mac-library.png" alt="macos library" width="400"><br></center><p>ä¸€è¡Œ<code>hello world</code>å°±éœ€è¦å®‰è£… 130MB ä»¥ä¸Šçš„ä¾èµ–æ¨¡å—, è€Œä¸”æ–‡ä»¶æ•°æ˜¯<strong>32,313</strong>. ç›¸æ¯”ä¹‹ä¸‹ macOS çš„<code>/Library</code><br>çš„ç©ºé—´å ç”¨ 9.02GB, æ–‡ä»¶æ•°åªæ˜¯å‰è€…çš„ä¸¤å€(<strong>67,890</strong>). ç»¼ä¸Šå¯ä»¥çœ‹å‡º node_modules çš„ç‰¹ç‚¹æ˜¯:</p><ul><li>ç›®å½•æ ‘ç»“æ„å¤æ‚</li><li>æ–‡ä»¶æ•°è¾ƒå¤šä¸”éƒ½æ¯”è¾ƒå°</li><li>ä¾èµ–å¤š, ä¸€ä¸ªç®€å•çš„é¡¹ç›®å°±è¦å®‰è£…å¥½å‡ å¨ä¾èµ–</li></ul><p>æ‰€ä»¥è¯´ node_modules å¯¹äºæœºæ¢°ç¡¬ç›˜æ¥è¯´æ˜¯ä¸ªå™©æ¢¦, è®°å¾—æœ‰ä¸€æ¬¡ä¸€ä¸ªåŒäº‹åˆ é™¤ node_modules ä¸€ä¸ªä¸‹åˆéƒ½æ²¡æå®š.<br>å¯¹äºå‰ç«¯å¼€å‘è€…æ¥è¯´, æˆ‘ä»¬æœ‰ N ä¸ªéœ€è¦<code>npm install</code>çš„é¡¹ç›® ğŸ˜¹.</p><p>é™¤æ­¤ä¹‹å¤–, Node çš„æ¨¡å—æœºåˆ¶è¿˜æœ‰ä»¥ä¸‹<strong>ç¼ºç‚¹</strong>:</p><ul><li><p>Node æœ¬èº«å¹¶æ²¡æœ‰æ¨¡å—çš„æ¦‚å¿µ, å®ƒåœ¨è¿è¡Œæ—¶è¿›è¡ŒæŸ¥æ‰¾å’ŒåŠ è½½. è¿™ä¸ªç¼ºç‚¹å’Œ<em>â€˜åŠ¨æ€è¯­è¨€ä¸é™æ€è¯­è¨€çš„ä¼˜åŠ£å¯¹æ¯”â€™</em>ç›¸ä¼¼,<br>ä½ å¯èƒ½åœ¨å¼€å‘ç¯å¢ƒè¿è¡Œå¾—å¥½å¥½çš„, å¯èƒ½åˆ°äº†çº¿ä¸Šå°±è¿è¡Œä¸äº†äº†, åŸå› æ˜¯ä¸€ä¸ªæ¨¡å—æ²¡æœ‰æ·»åŠ åˆ° package.json</p></li><li><p>Node æ¨¡å—çš„æŸ¥æ‰¾ç­–ç•¥éå¸¸æµªè´¹. è¿™ä¸ªç¼ºç‚¹åœ¨å¤§éƒ¨åˆ†å‰ç«¯é¡¹ç›®ä¸­å¯ä»¥è¿›è¡Œä¼˜åŒ–,<br>æ¯”å¦‚ webpack å°±å¯ä»¥é™å®šåªåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ node_modules ä¸­æŸ¥æ‰¾, ä½†æ˜¯å¯¹äºåµŒå¥—çš„ä¾èµ–, ä¾ç„¶éœ€è¦ 2 æ¬¡ä»¥ä¸Šçš„æŸ¥æ‰¾</p></li><li><p>node_modules ä¸èƒ½æœ‰æ•ˆåœ°å¤„ç†é‡å¤çš„åŒ…. ä¸¤ä¸ªåç§°ç›¸åŒä½†æ˜¯ä¸åŒç‰ˆæœ¬çš„åŒ…æ˜¯ä¸èƒ½åœ¨ä¸€ä¸ªç›®å½•ä¸‹å…±å­˜çš„.<br>æ‰€ä»¥ä¼šå¯¼è‡´åµŒå¥—çš„ node_modules, è€Œä¸”è¿™äº›é¡¹ç›®â€™ä¾èµ–çš„ä¾èµ–â€™æ˜¯æ— æ³•å’Œé¡¹ç›®æˆ–å…¶ä»–ä¾èµ–å…±äº«çš„:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> â‘  å‡è®¾é¡¹ç›®ä¾èµ–a,b,cä¸‰ä¸ªæ¨¡å—, ä¾èµ–æ ‘ä¸º:</span><br><span class="line"><span class="meta">#</span>  +- a</span><br><span class="line"><span class="meta">#</span>    +- react@15</span><br><span class="line"><span class="meta">#</span>  +- b</span><br><span class="line"><span class="meta">#</span>    +- react@16</span><br><span class="line"><span class="meta">#</span>  +- c</span><br><span class="line"><span class="meta">#</span>    +- react@16</span><br><span class="line"><span class="meta">#</span> yarnå®‰è£…æ—¶ä¼šæŒ‰ç…§é¡¹ç›®è¢«ä¾èµ–çš„æ¬¡æ•°ä½œä¸ºæƒé‡, å°†ä¾èµ–æå‡(hoisting),</span><br><span class="line"><span class="meta">#</span> å®‰è£…åçš„node_modulesç»“æ„ä¸º:</span><br><span class="line">  .</span><br><span class="line">  â””â”€â”€ node_modules</span><br><span class="line">   Â Â  â”œâ”€â”€ a</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">   Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react  # @15</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â”œâ”€â”€ b</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â”œâ”€â”€ c</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â””â”€â”€ react  # @16 è¢«ä¾èµ–äº†ä¸¤æ¬¡, æ‰€ä»¥è¿›è¡Œæå‡</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> â‘¡ ç°åœ¨å‡è®¾åœ¨â‘ çš„åŸºç¡€ä¸Š, æ ¹é¡¹ç›®ä¾èµ–äº†react@15, å¯¹äºé¡¹ç›®è‡ªå·±çš„ä¾èµ–è‚¯å®šæ˜¯è¦æ”¾åœ¨node_modulesæ ¹ç›®å½•çš„,</span><br><span class="line"><span class="meta">#</span> ç”±äºä¸€ä¸ªç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåç›®å½•, æ‰€ä»¥react@16æ²¡æœ‰çš„æå‡æœºä¼š. </span><br><span class="line"><span class="meta">#</span> å®‰è£…ånode_moduelsç»“æ„ä¸º</span><br><span class="line">  .</span><br><span class="line">  â””â”€â”€ node_modules</span><br><span class="line">   Â Â  â”œâ”€â”€ a</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json # react@15 æå‡</span><br><span class="line">   Â Â  â”œâ”€â”€ b</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">   Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react  # @16</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â”œâ”€â”€ c</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">   Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react  # @16</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â””â”€â”€ react  # @15</span><br><span class="line"><span class="meta">#</span> ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡º, react@16å‡ºç°äº†é‡å¤</span><br></pre></td></tr></table></figure></li></ul><p>ä¸ºæ­¤ Yarn é›†æˆäº†<code>Plug&#39;n&#39;Play</code>(ç®€ç§° pnp), ä¸­æ–‡åç§°å¯ä»¥ç§°ä¸ºâ€™å³æ’å³ç”¨â€™, æ¥è§£å†³ node_modulesâ€™åœ°ç‹±â€™.</p><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><p>æŒ‰ç…§æ™®é€šçš„æŒ‰ç…§æµç¨‹, Yarn ä¼šç”Ÿæˆä¸€ä¸ª node_modules ç›®å½•, ç„¶å Node æŒ‰ç…§å®ƒçš„æ¨¡å—æŸ¥æ‰¾è§„åˆ™åœ¨ node_modules ç›®å½•ä¸­æŸ¥æ‰¾.<br>ä½†å®é™…ä¸Š Node å¹¶ä¸çŸ¥é“è¿™ä¸ªæ¨¡å—æ˜¯ä»€ä¹ˆ, å®ƒåœ¨ node_modules æŸ¥æ‰¾, æ²¡æ‰¾åˆ°å°±åœ¨çˆ¶ç›®å½•çš„ node_modules æŸ¥æ‰¾, ä»¥æ­¤ç±»æ¨.<br>è¿™ä¸ªæ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„.</p><p><strong>ä½†æ˜¯ Yarn ä½œä¸ºä¸€ä¸ªåŒ…ç®¡ç†å™¨, å®ƒçŸ¥é“ä½ çš„é¡¹ç›®çš„ä¾èµ–æ ‘. é‚£èƒ½ä¸èƒ½è®© Yarn å‘Šè¯‰ Node? è®©å®ƒç›´æ¥åˆ°æŸä¸ªç›®å½•å»åŠ è½½æ¨¡å—.<br>è¿™æ ·å³å¯ä»¥æé«˜ Node æ¨¡å—çš„æŸ¥æ‰¾æ•ˆç‡, ä¹Ÿå¯ä»¥å‡å°‘ node_modules æ–‡ä»¶çš„æ‹·è´. è¿™å°±æ˜¯<code>Plug&#39;n&#39;Play</code>çš„åŸºæœ¬åŸç†.</strong></p><p>åœ¨ pnp æ¨¡å¼ä¸‹, Yarn ä¸ä¼šåˆ›å»º node_modules ç›®å½•, å–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ª<code>.png.js</code>æ–‡ä»¶, è¿™æ˜¯ä¸€ä¸ª node ç¨‹åº,<br>è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†é¡¹ç›®çš„ä¾èµ–æ ‘ä¿¡æ¯, æ¨¡å—æŸ¥æ‰¾ç®—æ³•, ä¹ŸåŒ…å«äº†æ¨¡å—æŸ¥æ‰¾å™¨çš„ patch ä»£ç (åœ¨ Node ç¯å¢ƒ, è¦†ç›– Module._load æ–¹æ³•).</p><p><br></p><p>ä½¿ç”¨ pnp æœºåˆ¶çš„ä»¥ä¸‹<strong>ä¼˜ç‚¹</strong>:</p><ul><li>æ‘†è„± node_modules.<ul><li>æ—¶é—´ä¸Š: ç›¸æ¯”è¾ƒåœ¨çƒ­ç¼“å­˜(hot cache)ç¯å¢ƒä¸‹è¿è¡Œ<code>yarn install</code>èŠ‚çœ 70%çš„æ—¶é—´</li><li>ç©ºé—´ä¸Š: pnp æ¨¡å¼ä¸‹, æ‰€æœ‰ npm æ¨¡å—éƒ½ä¼šå­˜æ”¾åœ¨å…¨å±€çš„ç¼“å­˜ç›®å½•ä¸‹, ä¾èµ–æ ‘æ‰å¹³åŒ–, é¿å…æ‹·è´å’Œé‡å¤</li></ul></li><li>æé«˜æ¨¡å—åŠ è½½æ•ˆç‡. Node ä¸ºäº†æŸ¥æ‰¾æ¨¡å—, éœ€è¦è°ƒç”¨å¤§é‡çš„ stat å’Œ readdir ç³»ç»Ÿè°ƒç”¨.<br>pnp é€šè¿‡ Yarn è·å–æˆ–è€…æ¨¡å—ä¿¡æ¯, ç›´æ¥å®šä½æ¨¡å—</li><li>ä¸å†å—é™äº node_modules åŒåæ¨¡å—ä¸åŒç‰ˆæœ¬ä¸èƒ½åœ¨åŒä¸€ç›®å½•</li></ul><blockquote><p>åœ¨ Mac ä¸‹ Yarn çš„å®‰è£…é€Ÿåº¦éå¸¸å¿«, çƒ­ç¼“å­˜ä¸‹ä»…éœ€å‡ ç§’. åŸå› æ˜¯ SSD + APFS çš„ Copy-on-write æœºåˆ¶.<br>è¿™ä½¿å¾—æ–‡ä»¶çš„æ‹·è´ä¸ç”¨å ç”¨ç©ºé—´, ç›¸å½“äºåˆ›å»ºä¸€ä¸ªé“¾æ¥. æ‰€ä»¥æ‹·è´å’Œåˆ é™¤çš„é€Ÿåº¦éå¸¸å¿«.<br>ä½†æ˜¯ node_modules å¤æ‚çš„ç›®å½•ç»“æ„å’Œè¶…å¤šçš„æ–‡ä»¶, ä»ç„¶éœ€è¦è°ƒç”¨å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨, è¿™ä¹Ÿä¼šæ‹–æ…¢å®‰è£…è¿‡ç¨‹.<br><br><br>ğŸ’¡ å¦‚æœè§‰å¾— pnp ç¹çæˆ–ä¸å¯é , é‚£å°±èµ¶ç´§ç”¨ä¸Š SSD é…åˆæ”¯æŒ Copy-on-write çš„æ–‡ä»¶ç³»ç»Ÿ.</p></blockquote><p><br></p><p>ä½¿ç”¨ pnp çš„<strong>é£é™©</strong>:</p><p>ç›®å‰å‰ç«¯ç¤¾åŒºçš„å„ç§å·¥å…·éƒ½ä¾èµ–äº node_modules æ¨¡å—æŸ¥æ‰¾æœºåˆ¶. ä¾‹å¦‚</p><ul><li>Node</li><li>Electron, electron-builder ç­‰ç­‰</li><li>Webpack</li><li>Typescript: å®šä½ç±»å‹å£°æ˜æ–‡ä»¶</li><li>Babel: å®šä½æ’ä»¶å’Œ preset</li><li>Eslint: å®šä½æ’ä»¶å’Œ preset, rules</li><li>Jest</li><li>ç¼–è¾‘å™¨, å¦‚ VsCode</li><li>â€¦ğŸ˜¿</li></ul><p>pnp ä¸€ä¸ªéå¸¸æ–°çš„ä¸œè¥¿, åœ¨å»å¹´ 9 æœˆä»½(2018)é¢ä¸–. è¦è®©è¿™äº›å·¥å…·å’Œ pnp é›†æˆæ˜¯ä¸ªä¸å°çš„æŒ‘æˆ˜, è€Œä¸”è¿™äº›è¿™äº›å·¥å…·<br>å’Œ pnp éƒ½æ˜¯åœ¨ä¸æ–­è¿­ä»£çš„, pnp è¿˜ä¸ç¨³å®š, æœªæ¥å¯èƒ½å˜åŒ–, è¿™ä¹Ÿä¼šå¸¦æ¥æŸäº›ç»´æŠ¤æ–¹é¢çš„è´Ÿæ‹….</p><p>é™¤äº†æ¨¡å—æŸ¥æ‰¾æœºåˆ¶, æœ‰ä¸€äº›å·¥å…·æ˜¯ç›´æ¥åœ¨ node_modules ä¸­åšå…¶ä»–äº‹æƒ…çš„, æ¯”å¦‚ç¼“å­˜, å­˜æ”¾ä¸´æ—¶è¯ä¹¦. ä¾‹å¦‚<code>cache-loader</code>, <code>webpack-dev-server</code></p><h2 id="å¼€å¯-pnp"><a href="#å¼€å¯-pnp" class="headerlink" title="å¼€å¯ pnp"></a>å¼€å¯ pnp</h2><p>å¦‚æœåªæ˜¯å•çº¯çš„ Node é¡¹ç›®, è¿å…¥è¿‡ç¨‹è¿˜ç®—æ¯”è¾ƒç®€å•. é¦–å…ˆåœ¨<code>package.json</code>å¼€å¯ pnp å®‰è£…æ¨¡å¼:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"installConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"pnp"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å®‰è£…ä¾èµ–:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add express</span><br></pre></td></tr></table></figure><p>å®‰è£…åé¡¹ç›®æ ¹ç›®å½•å°±ä¼šå‡ºç°ä¸€ä¸ª<code>.pnp.js</code>æ–‡ä»¶. ä¸‹ä¸€æ­¥ç¼–å†™ä»£ç :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'Hello World!'</span>));</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>));</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯è¿è¡Œ Node ä»£ç äº†, å¦‚æœç›´æ¥<code>node index.js</code>ä¼šæŠ¥<code>Error: Cannot find module &#39;express&#39;</code>å¼‚å¸¸.<br>è¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰ patch Node çš„æ¨¡å—æŸ¥æ‰¾å™¨. å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn node</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æˆ–è€…</span><br><span class="line"></span><br><span class="line">node --require="./.pnp.js" index.js</span><br></pre></td></tr></table></figure><blockquote><p><code>.pnp.js</code>æ–‡ä»¶ä¸åº”è¯¥æäº¤åˆ°ç‰ˆæœ¬åº“, è¿™ä¸ªæ–‡ä»¶é‡Œé¢åŒ…å«äº†ç¡¬ç¼–ç çš„ç¼“å­˜ç›®å½•. åœ¨ Yarn v2 ä¸­ä¼šè¿›è¡Œé‡æ„</p></blockquote><h2 id="æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®"><a href="#æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®" class="headerlink" title="æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®?"></a>æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®?</h2><p>pnp é›†æˆæ— éå°±æ˜¯é‡æ–°å®ç°ç°æœ‰å·¥å…·çš„æ¨¡å—æŸ¥æ‰¾æœºåˆ¶. éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„å‘å±•, ä¸€ä¸ªå‰ç«¯é¡¹ç›®ä¼šé›†æˆéå¸¸å¤šçš„å·¥å…·,<br>å¦‚æœè¿™äº›å·¥å…·æ²¡æ³•é€‚é…, å¯ä»¥è¯´ pnp å¾ˆéš¾å¾€å‰èµ°. ç„¶è€Œè¿™å¹¶ä¸æ˜¯ pnp èƒ½å¤Ÿæ§åˆ¶çš„, éœ€è¦è¿™äº›å·¥å…·å¼€å‘è€…çš„é…åˆ.</p><p>ç¤¾åŒºä¸Šä¸å°‘é¡¹ç›®å·²ç»é›†æˆäº† pnp:</p><ul><li><a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a></li><li><a href="https://github.com/gatsbyjs/gatsby" target="_blank" rel="noopener">gastby</a></li></ul><p><br></p><h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>å¯¹äº Node, pnp æ˜¯å¼€ç®±å³ç”¨çš„, ç›´æ¥ä½¿ç”¨<code>--require=&quot;./.pnp.js&quot;</code>å¯¼å…¥<code>.pnp.js</code>æ–‡ä»¶å³å¯,<br><code>.pnp.js</code>ä¼šå¯¹ Node çš„ Module å¯¹è±¡è¿›è¡Œ patch, é‡æ–°å®ç°æ¨¡å—æŸ¥æ‰¾æœºåˆ¶</p><h3 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h3><p>Webpack ä½¿ç”¨çš„æ¨¡å—æŸ¥æ‰¾å™¨æ˜¯<a href="https://github.com/webpack/enhanced-resolve" target="_blank" rel="noopener"><code>enhanced-resolve</code></a>, å¯ä»¥é€šè¿‡<a href="https://github.com/arcanis/pnp-webpack-plugin" target="_blank" rel="noopener"><code>pnp-webpack-plugin</code></a>æ’ä»¶æ¥æ‰©å±•<code>enhanced-resolve</code><br>æ¥æ”¯æŒ pnp.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PnpWebpackPlugin = <span class="built_in">require</span>(<span class="string">`pnp-webpack-plugin`</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•æ¨¡å—æŸ¥æ‰¾å™¨</span></span><br><span class="line">    plugins: [PnpWebpackPlugin],</span><br><span class="line">  &#125;,</span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•loaderæ¨¡å—æŸ¥æ‰¾å™¨.</span></span><br><span class="line">    plugins: [PnpWebpackPlugin.moduleLoader(<span class="built_in">module</span>)],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="jest"><a href="#jest" class="headerlink" title="jest"></a>jest</h3><p><a href="http://jestjs.io" target="_blank" rel="noopener">jest</a>æ”¯æŒé€šè¿‡<code>resolver</code>æ¥é…ç½®æŸ¥æ‰¾å™¨:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolver: <span class="built_in">require</span>.resolve(<span class="string">`jest-pnp-resolver`</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Typescript"><a href="#Typescript" class="headerlink" title="Typescript"></a>Typescript</h3><p>Typescript ä¹Ÿä½¿ç”¨è‡ªå·±çš„æ¨¡å—æŸ¥æ‰¾å™¨, TSå›¢é˜Ÿä¸ºäº†æ€§èƒ½æ–¹é¢çš„è€ƒè™‘, æš‚æ—¶ä¸å…è®¸ç¬¬ä¸‰æ–¹å·¥å…·æ¥æ‰©å±•æŸ¥æ‰¾å™¨. ä¹Ÿå°±æ˜¯è¯´<strong>æš‚æ—¶ä¸èƒ½ç”¨</strong>.</p><p>åœ¨è¿™ä¸ª<a href="https://github.com/Microsoft/TypeScript/issues/28289" target="_blank" rel="noopener">issue</a>ä¸­, æœ‰äººæå‡ºä½¿ç”¨<code>&quot;moduleResolution&quot;: &quot;yarnpnp&quot;</code>æˆ–è€…ä½¿ç”¨ç±»ä¼¼<a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener"><code>ts-loader</code></a>çš„<a href="https://github.com/arcanis/pnp-webpack-plugin/blob/b09fbdc2a9f16dc3837454b8d367963b1a30655f/index.js#L141" target="_blank" rel="noopener"><code>resolveModuleName</code></a>çš„æ–¹å¼æ”¯æŒ pnp æ¨¡å—æŸ¥æ‰¾.</p><p>TS å›¢é˜Ÿçš„å›åº”æ˜¯: pnp(æˆ–è€… npm çš„ tink)è¿˜æ˜¯æ—©æœŸé˜¶æ®µ, æœªæ¥å¯èƒ½ä¼šæœ‰å˜åŒ–, ä¾‹å¦‚<code>.pnp.js</code>æ–‡ä»¶, æ˜¾ç„¶ä¸åˆé€‚é‚£ä¹ˆæ—©å…¥å‘.<br>å¦å¤–ä¸ºäº†ä¼˜åŒ–å’Œæ§åˆ¶ç¼–è¯‘å™¨æ€§èƒ½, TS ä¹Ÿæ²¡æœ‰è®¡åˆ’åœ¨ç¼–è¯‘æœŸé—´æš´éœ²æ¥å£ç»™ç¬¬ä¸‰æ–¹æ‰§è¡Œä»£ç .</p><p>æ‰€ä»¥ç°åœ¨ Typescript è‡³ä»Šä¹Ÿæ²¡æœ‰ç±»ä¼¼ babel çš„æ’ä»¶æœºåˆ¶. é™¤éè‡ªå·±å®ç°ä¸€ä¸ªâ€™TS compiler hostâ€™, ä¾‹å¦‚<code>ts-loader</code>å°±è‡ªå·±æ‰©å±•äº†æ’ä»¶æœºåˆ¶å’Œæ¨¡å—æŸ¥æ‰¾æœºåˆ¶, æ¥æ”¯æŒç±»ä¼¼<a href="https://github.com/Brooooooklyn/ts-import-plugin" target="_blank" rel="noopener">ts-import-plugin</a>ç­‰æ’ä»¶, å› æ­¤<code>ts-loader</code>ç°åœ¨æ˜¯æ”¯æŒ pnp çš„:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PnpWebpackPlugin = <span class="built_in">require</span>(<span class="string">`pnp-webpack-plugin`</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        loader: <span class="built_in">require</span>.resolve(<span class="string">'ts-loader'</span>),</span><br><span class="line">        options: PnpWebpackPlugin.tsLoaderOptions(),</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p>æ€»ç»“, <strong><code>Typescript</code>æš‚æ—¶ä¸æ”¯æŒ</strong>, ä¸”è¿‘æœŸä¹Ÿæ²¡æœ‰å¼€å‘è®¡åˆ’, æ‰€ä»¥<code>VsCode</code>ä¹Ÿåˆ«æŒ‡æœ›äº†. <a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/181" target="_blank" rel="noopener"><code>fork-ts-checker-webpack-plugin</code></a>ä¹Ÿè¿˜æ²¡è·Ÿä¸Š. æ˜¾ç„¶ Typescript æ˜¯ pnp çš„ç¬¬ä¸€æ‹¦è·¯è™</p><p><br></p><h3 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h3><ul><li><a href="https://github.com/arcanis/rollup-plugin-pnp-resolve" target="_blank" rel="noopener">rollup-plugin-pnp-resolve</a></li><li><a href="https://yarnpkg.com/en/package/resolve" target="_blank" rel="noopener">resolve</a>: babel, gulp</li><li><a href="https://github.com/yarnpkg/yarn/pull/6449" target="_blank" rel="noopener">eslint</a>: åˆ° v6 æ‰èƒ½<a href="https://github.com/yarnpkg/berry/issues/8" target="_blank" rel="noopener">å®Œç¾æ”¯æŒ</a>.</li><li><a href="https://github.com/facebook/flow/issues/7014" target="_blank" rel="noopener">flow</a></li><li><a href="https://github.com/facebook/create-react-app/pull/5136" target="_blank" rel="noopener">create-react-app</a> æ”¯æŒ pnp, ä½†æ˜¯ Typescript æ¨¡å¼ä¸‹ä¸æ”¯æŒ</li><li>electron: æš‚æ—¶æ²¡æœ‰ç›¸å…³çš„æ¶ˆæ¯. å¯¹äºä¸€ä¸ªelectronåº”ç”¨æ¥è¯´, ä¾èµ–æ˜¯è‡ªåŒ…å«çš„, æ‰€ä»¥pnpå¯èƒ½ä¸é€‚åˆè¯¥åœºæ™¯</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»¼ä¸Š, pnp æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆ, å¯ä»¥è§£å†³ Node æ¨¡å—æœºåˆ¶çš„ç©ºé—´å’Œæ—¶é—´çš„æ•ˆç‡é—®é¢˜. ä½†æ˜¯åœ¨ç°é˜¶æ®µ, å®ƒè¿˜ä¸æ˜¯æˆç†Ÿ, æœ‰<br>å¾ˆå¤šå‘è¦è¸©, ä¸”å’Œç¤¾åŒºå„ç§å·¥å…·é›†æˆå­˜åœ¨ä¸å°‘é—®é¢˜. æ‰€ä»¥è¿˜ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨.</p><p>æ‰€ä»¥ç›®å‰é˜¶æ®µå¯¹äºæ™®é€šå¼€å‘è€…æ¥è¯´, å¦‚æœè¦æå‡npmå®‰è£…é€Ÿåº¦, è¿˜æ˜¯å¾—ä¸ŠSSD+Copy-On-Write!ğŸ˜‚</p><p>ä¸‹é¢æ˜¯å„ç§é¡¹ç›®çš„é›†æˆæƒ…å†µ(âœ…(æ”¯æŒ)|ğŸš§(è®¡åˆ’ä¸­æˆ–ä¸å®Œç¾)|âŒ(ä¸æ”¯æŒ)):</p><table><thead><tr><th>é¡¹ç›®</th><th></th></tr></thead><tbody><tr><td>Webpack</td><td>âœ…</td></tr><tr><td>rollup</td><td>âœ…</td></tr><tr><td>browserify</td><td>âœ…</td></tr><tr><td>gulp</td><td>âœ…</td></tr><tr><td>jest</td><td>âœ…</td></tr><tr><td>Node</td><td>âœ…</td></tr><tr><td>Typescript/VScode IntelliSense</td><td>âŒ</td></tr><tr><td>eslint</td><td>ğŸš§</td></tr><tr><td>flow</td><td>ğŸš§</td></tr><tr><td>create-react-app</td><td>ğŸš§</td></tr><tr><td>ts-loader</td><td>âœ…</td></tr><tr><td>fork-ts-checker-webpack-plugin</td><td>ğŸš§</td></tr></tbody></table><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/yarnpkg/rfcs/blob/master/accepted/0000-plug-an-play.md" target="_blank" rel="noopener">Plugâ€™nâ€™Play Whitepaper</a> pnpçš„è®ºæ–‡</li><li><a href="https://medium.freecodecamp.org/getting-rid-of-node-modules-with-yarn-plugn-play-a490e5e747d7" target="_blank" rel="noopener">How to get rid of node_modules with Yarn Plugâ€™nâ€™Play</a></li><li><a href="https://yarnpkg.com/en/docs/pnp" target="_blank" rel="noopener">Yarn å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/yarnpkg/pnp-sample-app" target="_blank" rel="noopener">pnp-sample-app</a> pnp å®˜æ–¹ç¤ºä¾‹</li><li><a href="https://github.com/yarnpkg/yarn/issues/6953" target="_blank" rel="noopener">Yarnâ€™s Future - v2 and beyond</a></li><li><a href="https://medium.com/@thomasreggi/yarn-plugn-play-1c398bf3e417" target="_blank" rel="noopener">Hacker News Discussion</a></li></ul><p>ç›¸å…³ issues:</p><ul><li><a href="https://github.com/yarnpkg/yarn/issues/6388" target="_blank" rel="noopener">Yarn Plug â€˜N Play should generate a static manifest file, not <code>.pnp.js</code></a></li><li><a href="https://github.com/Microsoft/TypeScript/issues/28289" target="_blank" rel="noopener">Typescript: Add new moduleResolution option: <code>yarn-pnp</code></a></li><li><a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/181" target="_blank" rel="noopener">fork-ts-checker-webpack-plugin: Custom resolveModuleName</a></li></ul><p>å…¶ä»–æ–¹æ¡ˆ</p><ul><li><a href="https://github.com/npm/tink" target="_blank" rel="noopener">npm tink</a>: a dependency unwinder for javascript</li><li><a href="https://github.com/pnpm/pnpm" target="_blank" rel="noopener">pnpm</a> Fast, disk space efficient package manager</li><li><a href="https://yarnpkg.com/en/docs/workspaces" target="_blank" rel="noopener">Yarn Workspaces</a> å¤šä¸ªé¡¹ç›®å…±æœ‰ä¾èµ–</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½¿ç”¨ Yarn(v1.12+)çš„ Plugâ€™nâ€™Play æœºåˆ¶æ¥å–ä»£ node_modules. ç›®å‰è¿™è¿˜æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ç‰¹æ€§.&lt;/p&gt;
&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Rxjs æ“ä½œç¬¦å†³ç­–æ ‘ - Mindnode</title>
    <link href="https://bobi.ink/2019/04/06/rx-operations/"/>
    <id>https://bobi.ink/2019/04/06/rx-operations/</id>
    <published>2019-04-05T16:00:00.000Z</published>
    <updated>2019-04-06T09:27:17.301Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Mindnode</strong> æ˜¯ macOS ä¸‹ä¸€ä¸ªç¾è§‚ç®€æ´çš„æ€ç»´å¯¼å›¾å·¥å…·, å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å­¦ä¹ /æ•´ç†å·¥å…·, æœ¬æ–‡åˆ—ä¸¾äº†è¿‘æ—¥å­¦ä¹ <code>rxjs</code>æ‰€æ•´ç†å‡ºæ¥çš„æ€ç»´å¯¼å›¾.</p><blockquote><p>å›¾ç‰‡è¾ƒå¤§, åŠ è½½å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´. å»ºè®®å³å‡»å›¾ç‰‡åœ¨æ–°çš„ Tab ä¸­æŸ¥çœ‹</p></blockquote><blockquote><p>Mindodeé¡¹ç›®<a href="https://github.com/ivan-94/mindnodes/tree/master/rxjs/æ“ä½œç¬¦" target="_blank" rel="noopener">åœ°å€</a>, å¯ä»¥åœ¨è¿™ä¸ªé¡¹ç›®è·å–åŸå§‹çš„Mindodeæ–‡ä»¶.</p></blockquote><h2 id="å­¦ä¹ èµ„æº"><a href="#å­¦ä¹ èµ„æº" class="headerlink" title="å­¦ä¹ èµ„æº"></a>å­¦ä¹ èµ„æº</h2><ul><li><a href="https://rxjs.dev" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://rxmarbles.com/#distinctUntilChanged" target="_blank" rel="noopener">å¯äº¤äº’çš„å¼¹ç å›¾</a> ç›´è§‚åœ°ç†è§£æ“ä½œç¬¦çš„åŠŸèƒ½</li><li><a href="https://rxjs-cn.github.io/learn-rxjs-operators/" target="_blank" rel="noopener">reactive.how</a> å­¦ä¹ å“åº”å¼ç¼–ç¨‹çš„åŠ¨ç”»å¡ç‰‡</li><li><a href="https://rxjs-cn.github.io/learn-rxjs-operators/" target="_blank" rel="noopener">å­¦ä¹ RxJSæ“ä½œç¬¦</a></li><li><a href="https://www.amazon.cn/dp/B07CXZ9D8N/ref=sr_1_1?__mk_zh_CN=äºšé©¬é€Šç½‘ç«™&amp;keywords=rxjs&amp;qid=1554539743&amp;s=gateway&amp;sr=8-1" target="_blank" rel="noopener">book: æ·±å…¥æµ…å‡ºRxJS</a></li></ul><h2 id="åˆ›å»ºæ“ä½œç¬¦"><a href="#åˆ›å»ºæ“ä½œç¬¦" class="headerlink" title="åˆ›å»ºæ“ä½œç¬¦"></a>åˆ›å»ºæ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/åˆ›å»ºæ“ä½œç¬¦.png" alt="åˆ›å»ºæ“ä½œç¬¦"></p><h2 id="è¿‡æ»¤æ“ä½œç¬¦"><a href="#è¿‡æ»¤æ“ä½œç¬¦" class="headerlink" title="è¿‡æ»¤æ“ä½œç¬¦"></a>è¿‡æ»¤æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/è¿‡æ»¤.png" alt="è¿‡æ»¤æ“ä½œç¬¦"></p><h2 id="è½¬æ¢æ“ä½œç¬¦"><a href="#è½¬æ¢æ“ä½œç¬¦" class="headerlink" title="è½¬æ¢æ“ä½œç¬¦"></a>è½¬æ¢æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/è½¬æ¢.png" alt="è½¬æ¢æ“ä½œç¬¦"></p><h2 id="ç»„åˆæ“ä½œç¬¦"><a href="#ç»„åˆæ“ä½œç¬¦" class="headerlink" title="ç»„åˆæ“ä½œç¬¦"></a>ç»„åˆæ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/ç»„åˆ.png" alt="ç»„åˆæ“ä½œç¬¦"></p><h2 id="åˆ†ç»„æ“ä½œç¬¦"><a href="#åˆ†ç»„æ“ä½œç¬¦" class="headerlink" title="åˆ†ç»„æ“ä½œç¬¦"></a>åˆ†ç»„æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/åˆ†ç»„.png" alt="åˆ†ç»„æ“ä½œç¬¦"></p><h2 id="é”™è¯¯å¤„ç†æ“ä½œç¬¦"><a href="#é”™è¯¯å¤„ç†æ“ä½œç¬¦" class="headerlink" title="é”™è¯¯å¤„ç†æ“ä½œç¬¦"></a>é”™è¯¯å¤„ç†æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/é”™è¯¯å¤„ç†.png" alt="é”™è¯¯å¤„ç†æ“ä½œç¬¦"></p><h2 id="è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦"><a href="#è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦" class="headerlink" title="è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦"></a>è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®.png" alt="è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦"></p><h2 id="å¤šæ’­æ“ä½œç¬¦"><a href="#å¤šæ’­æ“ä½œç¬¦" class="headerlink" title="å¤šæ’­æ“ä½œç¬¦"></a>å¤šæ’­æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/å¤šæ’­.png" alt="å¤šæ’­æ“ä½œç¬¦"></p><h2 id="é«˜é˜¶-Observable-æ“ä½œç¬¦"><a href="#é«˜é˜¶-Observable-æ“ä½œç¬¦" class="headerlink" title="é«˜é˜¶ Observable æ“ä½œç¬¦"></a>é«˜é˜¶ Observable æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/é«˜é˜¶Observable.png" alt="é«˜é˜¶Observableæ“ä½œç¬¦"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;Mindnode&lt;/strong&gt; æ˜¯ macOS ä¸‹ä¸€ä¸ªç¾è§‚ç®€æ´çš„æ€ç»´å¯¼å›¾å·¥å…·, å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å­¦ä¹ /æ•´ç†å·¥å…·, æœ¬æ–‡åˆ—ä¸¾äº†è¿‘æ—¥å­¦ä¹ &lt;code&gt;rxjs&lt;/code&gt;æ‰€æ•´ç†å‡ºæ¥çš„æ€ç»´å¯¼å›¾.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å›¾ç‰‡è¾ƒå¤§, åŠ è½½å¯èƒ½éœ€è¦ä¸€
      
    
    </summary>
    
      <category term="Mindnode" scheme="https://bobi.ink/categories/Mindnode/"/>
    
    
  </entry>
  
</feed>
