<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bobi.ink</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://bobi.ink/"/>
  <updated>2019-08-24T14:25:35.093Z</updated>
  <id>https://bobi.ink/</id>
  
  <author>
    <name>Ivan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Typescriptç‰ˆå›¾è§£Functor , Applicative å’Œ Monad</title>
    <link href="https://bobi.ink/2019/08/22/ts-fam/"/>
    <id>https://bobi.ink/2019/08/22/ts-fam/</id>
    <published>2019-08-21T16:00:00.000Z</published>
    <updated>2019-08-24T14:25:35.093Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯ç»å…¸çš„<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" target="_blank" rel="noopener">Functors, Applicatives, And Monads In Pictures</a>çš„Typescriptç¿»è¯‘ç‰ˆæœ¬ã€‚</p><p>Functor/Applicative/Monadæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€äº›æ¯”è¾ƒâ€˜åŸºç¡€â€™çš„æ¦‚å¿µï¼Œåæ­£æˆ‘æ˜¯ä¸è®¤åŒâ€˜åŸºç¡€â€™è¿™ä¸ªè¯´æ³•çš„ï¼Œç¬”è€…ä¹Ÿé˜…è¯»è¿‡å¾ˆå¤šç±»ä¼¼ä»‹ç»Monadçš„æ–‡ç« ï¼Œæœ€åéƒ½ä¸äº†äº†ä¹‹ï¼Œè¿™äº›æ¦‚å¿µæ˜¯æ¯”è¾ƒéš¾ä»¥ç†è§£çš„ï¼Œè€Œä¸”å¹³æ—¶ç¼–ç¨‹å®è·µä¸­ä¹Ÿå¾ˆéš¾ä¼šæ¥è§¦åˆ°è¿™äº›ä¸œè¥¿ã€‚</p><p>åæ¥æ‹œè¯»äº†<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" target="_blank" rel="noopener">Functors, Applicatives, And Monads In Pictures</a>, ä¸é”™ï¼Œå¥½åƒæ‡‚äº†ã€‚äºæ˜¯è‡ªå·±æƒ³é€šè¿‡ç¿»è¯‘ï¼Œå†æ·±å…¥æ¶ˆåŒ–æ¶ˆåŒ–è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä½¿ç”¨<code>Typescript</code>ä½œä¸ºæè¿°è¯­è¨€ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ä¼šæ›´å¥½ç†è§£ã€‚</p><p>æœ‰ç†è§£ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ•¬è¯·æŒ‡æ­£. å¼€å§‹å§ï¼</p><p><br></p><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å€¼:</p><p><img src="/images/ts-fam/value.png" alt></p><p>ä¾‹å¦‚è¿™äº›</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>        <span class="comment">// number</span></span><br><span class="line"><span class="string">'string'</span> <span class="comment">// string</span></span><br></pre></td></tr></table></figure><p>å¤§å®¶éƒ½çŸ¥é“æ€ä¹ˆå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°è¿™ä¸ªå€¼ä¸Šé¢:</p><p><img src="/images/ts-fam/value_apply.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// So easy</span></span><br><span class="line"><span class="keyword">const</span> add3 = <span class="function">(<span class="params">val: <span class="built_in">number</span></span>) =&gt;</span> val + <span class="number">3</span></span><br><span class="line"><span class="built_in">console</span>.log(add3(<span class="number">2</span>)) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•äº†. æˆ‘ä»¬æ¥æ‰©å±•ä¸€ä¸‹, è®©ä»»æ„çš„å€¼æ˜¯å¯ä»¥åŒ…è£…åœ¨ä¸€ä¸ª<strong>ä¸Šä¸‹æ–‡(context)</strong>å½“ä¸­. ç°åœ¨çš„æƒ…å†µä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªå¯ä»¥æŠŠå€¼æ”¾è¿›å»çš„ç›’å­:</p><p><img src="/images/ts-fam/value_and_context.png" alt></p><p>ç°åœ¨ä½ <strong>æŠŠä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°è¿™ä¸ªåŒ…è£…å€¼çš„æ—¶å€™, æ ¹æ®å…¶ä¸Šä¸‹æ–‡ç±»å‹ä½ ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ</strong>. è¿™å°±æ˜¯ <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, <code>Arrow</code> ä¹‹ç±»æ¦‚å¿µçš„åŸºç¡€. </p><p><code>Maybe</code> å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ•°æ®ç±»å‹, å®ƒå®šä¹‰äº†ä¸¤ç§ç›¸å…³çš„â€˜<strong>ä¸Šä¸‹æ–‡</strong>â€™, Maybeæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªâ€˜ä¸Šä¸‹æ–‡â€™(é™¤äº†å€¼ï¼Œå…¶ä»–ç±»å‹éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Ÿ):</p><p><img src="/images/ts-fam/context.png" alt></p><p>åŸæ–‡åŸºäºHaskellï¼Œå®ƒçš„Maybeç±»å‹æœ‰ä¸¤ä¸ªä¸Šä¸‹æ–‡Just(è“è‰²ç›’å­)å’ŒNone(çº¢è‰²ç©ºç›’å­)ã€‚ä»¿é€ Haskellåœ¨Typescriptä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>å¯é€‰ç±»å‹(Maybe)</code>æ¥è¡¨ç¤º:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Maybe&lt;T&gt; = Just&lt;T&gt; | Nothing <span class="comment">// Just è¡¨ç¤ºå€¼â€˜å­˜åœ¨â€™ï¼ŒNothingè¡¨ç¤ºç©ºå€¼ï¼Œç±»ä¼¼äºnullã€undefinedçš„æ¦‚å¿µ</span></span><br></pre></td></tr></table></figure><p>Justå’ŒNothingçš„åŸºæœ¬ç»“æ„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬åªç”¨Noneæ¥å–ä»£null, è¿™é‡Œæˆ‘ä»¬å°†Noneä½œä¸ºä¸€ä¸ªå€¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> None &#123;&#125;</span><br><span class="line"><span class="comment">// å¯¹åº”Noneçš„ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Nothing = <span class="keyword">typeof</span> None</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯Nothingï¼Œè¿™é‡Œä½¿ç”¨Typescriptçš„ `Type Guards`</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isNothing = (val: <span class="built_in">any</span>): val is Nothing =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> val === None</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Justç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">static</span> of&lt;T&gt;(val: T) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Just(val)</span><br><span class="line">  &#125;</span><br><span class="line">  value: T</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">value: T</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a: Maybe&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">a = None;</span><br><span class="line">a = Just.of(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><blockquote><p>è¯´å®åœ¨è¿™ä¸ªå®ç°æœ‰ç‚¹æŒ«, ä½†æ˜¯ä¸ºäº†æ›´åŠ è´´è¿‘åŸæ–‡æè¿°ï¼Œæš‚ä¸”ä½¿ç”¨è¿™ä¸ªå®ç°ã€‚ä¹‹å‰è€ƒè™‘è¿‡çš„ä¸€ä¸ªç‰ˆæœ¬æ˜¯ä¸‹é¢è¿™æ ·çš„, å› ä¸ºæ— æ³•ç»™å®ƒä»¬æ‰©å±•æ–¹æ³•ï¼Œå°±æ”¾å¼ƒäº†è¿™ä¸ªæ–¹æ¡ˆ:<br>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Optional&lt;T&gt; = NonNullable&lt;T&gt; | nul</span><br><span class="line"><span class="keyword">let</span> a: Optional&lt;<span class="built_in">number</span>&gt; = <span class="number">1</span>;</span><br><span class="line">a = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p></blockquote><p><br></p><p>å¾ˆå¿«æˆ‘ä»¬ä¼šçœ‹åˆ°å¯¹ä¸€ä¸ª <code>Just&lt;a&gt;</code> å’Œä¸€ä¸ª Nothing æ¥è¯´, å‡½æ•°åº”ç”¨æœ‰ä½•ä¸åŒ. é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ Functor!</p><p><br><br><br></p><h2 id="functors"><a href="#functors" class="headerlink" title="Functors"></a>Functors</h2><p>å½“ä¸€ä¸ªå€¼è¢«åŒ…è£…åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­æ—¶, ä½ å°±ä¸èƒ½æ‹¿æ™®é€šå‡½æ•°æ¥åº”ç”¨äº†:</p><p><img src="/images/ts-fam/no_fmap_ouch.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">let</span> a: Just&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add3 = <span class="function">(<span class="params">v: <span class="built_in">number</span></span>) =&gt;</span> v + <span class="number">3</span></span><br><span class="line">add3(a) <span class="comment">// âŒ ç±»å‹â€œJust&lt;number&gt;â€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œnumberâ€çš„å‚</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™, è¯¥ <code>fmap</code> å‡ºåœºäº†. fmap ç¿©ç¿©è€Œæ¥ï¼Œä»å®¹åº”å¯¹ä¸Šä¸‹æ–‡(fmap is from the street, fmap is hip to contexts). è¿˜æœ‰è°? fmap çŸ¥é“æ€æ ·å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å€¼ä¸Š. <strong>ä½ å¯ä»¥å¯¹ä»»ä½•ä¸€ä¸ªç±»å‹ä¸º Functor çš„ç±»å‹ä½¿ç”¨ fmap</strong>ï¼Œ æ¢å¥è¯è¯´ï¼ŒFunctoréƒ½å®šä¹‰äº†fmap.</p><p>æ¯”å¦‚è¯´, æƒ³ä¸€ä¸‹ä½ æƒ³æŠŠ add3 åº”ç”¨åˆ° Just 2. ç”¨ fmap:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">2</span>).fmap(add3) <span class="comment">// Just 5</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/fmap_apply.png" alt></p><p><strong>ğŸ’¥å˜­ï¼</strong> fmap å‘æˆ‘ä»¬å±•ç¤ºäº†å®ƒçš„æˆæœã€‚ ä½†æ˜¯ fmap æ€ä¹ˆçŸ¥é“å¦‚ä½•åº”ç”¨è¯¥å‡½æ•°çš„å‘¢ï¼Ÿ</p><p><br></p><h2 id="ç©¶ç«Ÿä»€ä¹ˆæ˜¯-functor-å‘¢ï¼Ÿ"><a href="#ç©¶ç«Ÿä»€ä¹ˆæ˜¯-functor-å‘¢ï¼Ÿ" class="headerlink" title="ç©¶ç«Ÿä»€ä¹ˆæ˜¯ Functor å‘¢ï¼Ÿ"></a>ç©¶ç«Ÿä»€ä¹ˆæ˜¯ Functor å‘¢ï¼Ÿ</h2><p>åœ¨ Haskell ä¸­ <code>Functor</code> æ˜¯ä¸€ä¸ª<a href="http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101" target="_blank" rel="noopener">ç±»å‹ç±»(typeclass)</a>ã€‚ å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><p><img src="/images/ts-fam/functor_def.png" alt></p><p>åœ¨Typescriptä¸­ï¼Œ ä¸€ä¸ªFunctorè®¤ä¸ºæ˜¯<strong>å®šä¹‰äº†fmapçš„ä»»æ„ç±»å‹</strong>. çœ‹çœ‹<code>fmap</code>æ˜¯å¦‚ä½•å·¥ä½œçš„:</p><p><img src="/images/ts-fam/fmap_def.png" alt></p><ol><li>ä¸€ä¸ªFunctorç±»å‹çš„ fa, ä¾‹å¦‚Just 2</li><li>fa å®šä¹‰äº†ä¸€ä¸ªfmap, fmap æ¥å—ä¸€ä¸ªå‡½æ•°fnï¼Œä¾‹å¦‚add3</li><li>fmap ç›´åˆ°å¦‚ä½•å°†faåº”ç”¨åˆ°fnä¸­ï¼Œ è¿”å›ä¸€ä¸ªFunctorç±»å‹çš„ fb. <strong>faå’Œfbçš„åŒ…è£…ä¸Šä¸‹æ–‡ç±»å‹ä¸€æ ·</strong>, ä¾‹å¦‚faæ˜¯Just, é‚£ä¹ˆfbä¹Ÿæ˜¯Just; åä¹‹faæ˜¯Nothingï¼Œfbä¹Ÿæ˜¯Nothing;</li></ol><p>ç”¨Typescriptçš„å‡½æ•°ç­¾åæè¿°ä¸€ä¸‹ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;Functor T&gt;.fmap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">val: T</span>) =&gt; U</span>): &lt;<span class="params">Functor</span> <span class="params">U</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">2</span>).fmap(add3) <span class="comment">// Just 5</span></span><br></pre></td></tr></table></figure><p>è€Œ fmap ç¥å¥‡åœ°åº”ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸º Maybe æ˜¯ä¸€ä¸ª Functor, å®ƒæŒ‡å®šäº† fmap å¦‚ä½•åº”ç”¨åˆ° Just ä¸Šä¸ Nothing ä¸Š:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// å®ç°fmap</span></span><br><span class="line">  fmap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">val: T</span>) =&gt; U</span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">Just</span>.<span class="params">of</span>(<span class="params">fn(<span class="params"><span class="keyword">this</span>.value</span>)</span>)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="params">class</span> <span class="params">None</span> &#123;</span></span><br><span class="line"><span class="function">  // <span class="params">None</span> æ¥å—ä»»ä½•å‡½æ•°éƒ½è¿”å›<span class="params">None</span></span></span><br><span class="line"><span class="function">  <span class="params">static</span> <span class="params">fmap</span>(<span class="params">fn: <span class="built_in">any</span></span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">None</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>å½“æˆ‘ä»¬å†™ <code>Just.of(2).fmap(add3)</code> æ—¶ï¼Œè¿™æ˜¯å¹•åå‘ç”Ÿçš„äº‹æƒ…ï¼š</p><p><img src="/images/ts-fam/fmap_just.png" alt></p><p>é‚£ä¹ˆç„¶åï¼Œå°±åƒè¿™æ ·ï¼Œfmapï¼Œè¯·å°† add3 åº”ç”¨åˆ° Nothing ä¸Šå¦‚ä½•ï¼Ÿ</p><p><img src="/images/ts-fam/fmap_nothing.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">None.fmap(add3) <span class="comment">// Nothing</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/bill.png" alt></p><p>å°±åƒã€Šé»‘å®¢å¸å›½ã€‹ä¸­çš„ Morpheusï¼Œfmap çŸ¥é“éƒ½è¦åšä»€ä¹ˆï¼›å¦‚æœä½ ä» Nothing å¼€å§‹ï¼Œé‚£ä¹ˆä½ ä¼šä»¥ Nothing ç»“æŸï¼ fmap æ˜¯ç¦…ã€‚</p><p>ç°åœ¨å®ƒå‘Šè¯‰æˆ‘ä»¬äº† Maybe æ•°æ®ç±»å‹å­˜åœ¨çš„æ„ä¹‰ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯åœ¨ä¸€ä¸ªæ²¡æœ‰ Maybe çš„è¯­è¨€ä¸­å¤„ç†ä¸€ä¸ªæ•°æ®åº“è®°å½•çš„æ–¹å¼, æ¯”å¦‚Javascript:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> post = Post.findByID(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> (post != <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> post.title</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†fmapå:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾findPostè¿”å›Maybe&lt;Article&gt;</span></span><br><span class="line">findPost(<span class="number">1</span>).fmap(getPostTitle)</span><br></pre></td></tr></table></figure><p>å¦‚æœ findPost è¿”å›ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±ä¼šé€šè¿‡ getPostTitle è·å–å…¶æ ‡é¢˜ã€‚ å¦‚æœå®ƒè¿”å› Nothingï¼Œæˆ‘ä»¬å°±ä¹Ÿè¿”å› Nothingï¼ è¾ƒä¹‹å‰ç®€æ´äº†å¾ˆå¤šå¯¹å§?</p><blockquote><p>Typescriptæœ‰äº†Optional Chainingåï¼Œå¤„ç†nullä¹Ÿå¯ä»¥å¾ˆç®€æ´:<br> <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">findPost(<span class="number">1</span>)?.title <span class="comment">// å¼‚æ›²åŒå·¥</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>åŸæ–‡è¿˜æœ‰å®šä¹‰äº†ä¸€ä¸ªfmapçš„é‡è½½æ“ä½œç¬¦ç‰ˆæœ¬ï¼Œå› ä¸ºJavaScriptä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œæ‰€ä»¥è¿™é‡Œç®€å•å¸¦è¿‡<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getPostTitle &lt;$&gt; findPost(1) // ä½¿ç”¨æ“ä½œç¬¦é‡è½½&lt;$&gt; æ¥ç®€åŒ–fmap. ç­‰ä»·äºä¸Šé¢çš„ä»£ç </span><br></pre></td></tr></table></figure></p></blockquote><p><br></p><p>å†çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼šå¦‚æœå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°ä¸€ä¸ª Arrayï¼ˆHaksell ä¸­æ˜¯ Listï¼‰ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><img src="/images/ts-fam/fmap_list.png" alt></p><p>Array ä¹Ÿæ˜¯ functorï¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(add3) <span class="comment">// [4, 5, 6]. faæ˜¯Arrayï¼Œè¾“å‡ºfbä¹Ÿæ˜¯Arrayï¼Œç¬¦åˆFunctorçš„å®šä¹‰å§ï¼Œæ‰€ä»¥Javascriptçš„mapå°±æ˜¯fmapï¼ŒArrayå°±æ˜¯Functor</span></span><br></pre></td></tr></table></figure><p><br></p><p>å¥½äº†ï¼Œå¥½äº†ï¼Œæœ€åä¸€ä¸ªç¤ºä¾‹ï¼šå¦‚æœå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> multiply3 = <span class="function">(<span class="params">v: <span class="built_in">number</span></span>) =&gt;</span> v * <span class="number">3</span></span><br><span class="line"><span class="keyword">const</span> add3 = <span class="function">(<span class="params">v: <span class="built_in">number</span></span>) =&gt;</span> v + <span class="number">3</span></span><br><span class="line"></span><br><span class="line">add3.fmap(multiply3) <span class="comment">// â“</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š</p><p><img src="/images/ts-fam/function_with_value.png" alt></p><p>è¿™æ˜¯ä¸€ä¸ªåº”ç”¨åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸Šçš„å‡½æ•°ï¼š</p><p><img src="/images/ts-fam/fmap_function.png" alt></p><p>å…¶ç»“æœæ˜¯åˆä¸€ä¸ªå‡½æ•°ï¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…ä½œç¤ºä¾‹ï¼Œä¸è¦æ¨¡ä»¿</span></span><br><span class="line"><span class="keyword">interface</span> Function &#123;</span><br><span class="line">  fmap&lt;V, T, U&gt;<span class="function">(<span class="params"><span class="keyword">this</span>: (<span class="params">val: V</span>) =&gt; T, fn: (<span class="params">val: T</span>) =&gt; U</span>): (<span class="params">val: V</span>) =&gt;</span> U</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Function</span>.prototype.fmap = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">v</span> =&gt;</span> fn(<span class="keyword">this</span>(v))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å‡½æ•°ä¹Ÿæ˜¯ Functorï¼ å¯¹ä¸€ä¸ªå‡½æ•°ä½¿ç”¨ fmapï¼Œå…¶å®å°±æ˜¯å‡½æ•°ç»„åˆ(compose)ï¼ ä¹Ÿå°±æ˜¯è¯´: <code>f.fmap(g)</code> ç­‰ä»·äº <code>compose(f, g)</code></p><p><br></p><h3 id="functoræ€»ç»“"><a href="#functoræ€»ç»“" class="headerlink" title="Functoræ€»ç»“"></a>Functoræ€»ç»“</h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çŸ¥é“Functorå…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆéš¾ä»¥ç†è§£, ä¸€ä¸ªFunctorå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Functor T&gt;.fmap(fn: (v: T) =&gt; U): &lt;Functor U&gt;</span><br></pre></td></tr></table></figure><p>Functorä¼šå®šä¹‰ä¸€ä¸ªâ€˜fmapâ€™æ“ä½œï¼Œè¿™ä¸ªfmapæ¥å—ä¸€ä¸ªå‡½æ•°fnï¼Œfnæ¥æ”¶çš„æ˜¯å…·ä½“çš„å€¼ï¼Œè¿”å›å¦ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œä¾‹å¦‚ä¸Šé¢çš„add3. <strong>fmapå†³å®šå¦‚ä½•æ¥åº”ç”¨fnåˆ°æºFunctor(a)</strong>ï¼Œ è¿”å›ä¸€ä¸ªæ–°çš„Functor(b)ã€‚ ä¹Ÿå°±æ˜¯fmapçš„æºå’Œè¾“å‡ºçš„å€¼â€˜ä¸Šä¸‹æ–‡â€™ç±»å‹æ˜¯ä¸€æ ·çš„ã€‚æ¯”å¦‚</p><ul><li><code>Just -&gt; fmap -&gt; Just</code></li><li><code>Nothing -&gt; fmap -&gt; Nothing</code></li><li><code>Maybe -&gt; fmap -&gt; Maybe</code></li><li><code>Array -&gt; fmap -&gt; Array</code></li></ul><p><br><br><br></p><h2 id="applicative"><a href="#applicative" class="headerlink" title="Applicative"></a>Applicative</h2><p>ç°åœ¨ç»ƒåˆ°äºŒé‡å¤©äº†ã€‚ Applicative åˆæå‡äº†ä¸€ä¸ªå±‚æ¬¡ã€‚</p><p>å¯¹äº Applicativeï¼Œæˆ‘ä»¬çš„å€¼ä¾ç„¶å’Œ Functor ä¸€æ ·åŒ…è£…åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­</p><p><img src="/images/ts-fam/value_and_context.png" alt></p><p>ä¸ä¸€æ ·çš„æ˜¯ï¼Œæˆ‘ä»¬<strong>å°†Functorä¸­çš„å‡½æ•°(ä¾‹å¦‚add3)ä¹ŸåŒ…è£…åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­</strong>ï¼</p><p><img src="/images/ts-fam/function_and_context.png" alt></p><p>å—¯ã€‚ æˆ‘ä»¬ç»§ç»­æ·±å…¥ã€‚ Applicative å¹¶æ²¡æœ‰å¼€ç©ç¬‘ã€‚ä¸åƒHaskellï¼ŒTypescriptå¹¶æ²¡æœ‰å†…ç½®æ–¹å¼æ¥å¤„ç†Applicativeã€‚æˆ‘ä»¬å¯ä»¥ç»™éœ€è¦æ”¯æŒApplicativeçš„ç±»å‹å®šä¹‰ä¸€ä¸ªapplyå‡½æ•°ã€‚<strong>applyå‡½æ•°çŸ¥é“æ€ä¹ˆå°†<code>åŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>åŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å€¼</code></strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> None &#123;</span><br><span class="line">  <span class="keyword">static</span> apply(fn: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> None;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨æ–¹æ³•é‡è½½ï¼Œè®©Typescriptæ›´å¥½æ¨æ–­</span></span><br><span class="line">  <span class="comment">// å¦‚æœå€¼å’Œå‡½æ•°éƒ½æ˜¯Justç±»å‹ï¼Œç»“æœä¹Ÿæ˜¯Justç±»å‹</span></span><br><span class="line">  apply&lt;U&gt;<span class="function">(<span class="params">fn: Just&lt;(<span class="params">a: T</span>) =&gt; U&gt;</span>): <span class="params">Just</span>&lt;<span class="params">U</span>&gt;;</span></span><br><span class="line"><span class="function">  // å¦‚æœå‡½æ•°æ˜¯<span class="params">Nothing</span>ç±»å‹ï¼Œç»“æœæ˜¯<span class="params">Nothing</span>.</span></span><br><span class="line"><span class="function">  // ä¸¥æ ¼ä¸Š<span class="params">apply</span>åªåº”è¯¥æ¥æ”¶åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç±»å‹çš„å‡½æ•°ï¼Œå³<span class="params">Just</span>,</span></span><br><span class="line"><span class="function">  // å› ä¸º<span class="params">Maybe</span>æ˜¯<span class="params">Typescript</span>çš„<span class="params">Union</span>ç±»å‹ï¼Œæ²¡åŠæ³•ç»™å®ƒæ‰©å±•æ–¹æ³•ï¼Œè¿™é‡Œå°†<span class="params">Maybe</span>å’Œ<span class="params">Just</span>æ··åœ¨ä¸€èµ·äº†</span></span><br><span class="line"><span class="function">  <span class="params">apply</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: Nothing</span>): <span class="params">Nothing</span>;</span></span><br><span class="line"><span class="function">  // å¦‚æœå€¼å’Œå‡½æ•°éƒ½æ˜¯<span class="params">Maybe</span>ç±»å‹, è¿”å›ä¸€ä¸ª<span class="params">Maybe</span>ç±»å‹</span></span><br><span class="line"><span class="function">  <span class="params">apply</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: Maybe&lt;(<span class="params">a: T</span>) =&gt; U&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">U</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params">!isNothing(<span class="params">fn</span>)</span>) &#123;</span></span><br><span class="line"><span class="function">      <span class="params">return</span> <span class="params">Just</span>.<span class="params">of</span>(<span class="params">fn.value(<span class="params"><span class="keyword">this</span>.value</span>)</span>);</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">None</span>.<span class="params">apply</span>(<span class="params">fn</span>);</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>å†æ¥çœ‹çœ‹æ•°ç»„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…ä½œç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">interface</span> Array&lt;T&gt; &#123;</span><br><span class="line">  apply&lt;U&gt;<span class="function">(<span class="params">fns: <span class="built_in">Array</span>&lt;(<span class="params">e: T</span>) =&gt; U&gt;</span>): <span class="params">U</span>[]</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// æ¥æ”¶ä¸€ä¸ªå‡½æ•°â€˜æ•°ç»„(<span class="params">ä¸Šä¸‹æ–‡</span>)â€™ï¼Œè¿”å›ä¸€ä¸ªåº”ç”¨äº†â€˜å‡½æ•°â€™çš„æ–°çš„æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="params">Array</span>.<span class="params">prototype</span>.<span class="params">apply</span> = <span class="params">function</span>&lt;<span class="params">T</span>, <span class="params">U</span>&gt;(<span class="params">fns: <span class="built_in">Array</span>&lt;(<span class="params">e: T</span>) =&gt; U&gt;</span>) &#123;</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">res</span>: <span class="params">U</span>[] = []</span></span><br><span class="line"><span class="function">  <span class="params">for</span> (<span class="params"><span class="keyword">const</span> fn of fns</span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">this</span>.<span class="params">forEach</span>(<span class="params">el =&gt; res.push(<span class="params">fn(<span class="params">el</span>)</span>)</span>)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">  <span class="params">return</span> <span class="params">res</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>åœ¨Haskellä¸­ï¼Œä½¿ç”¨<code>&lt;*&gt;</code>æ¥è¡¨ç¤ºapplyæ“ä½œ: <code>Just (+3) &lt;*&gt; Just 2 == Just 5</code>. Typescriptä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œæ‰€ä»¥å¿½ç•¥.</p><p>Justç±»å‹çš„Applicativeåº”ç”¨å›¾è§£ï¼š</p><p><img src="/images/ts-fam/applicative_just.png" alt></p><p>æ•°ç»„ç±»å‹çš„Applicativeåº”ç”¨å›¾è§£ï¼š</p><p><img src="/images/ts-fam/applicative_list.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(num.apply([multiply2, add3]))</span><br><span class="line"><span class="comment">// [2, 4, 6, 4, 5, 6]</span></span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œæœ‰ Applicative èƒ½åšåˆ°è€Œ Functor ä¸èƒ½åšåˆ°çš„äº‹æƒ…</strong>ã€‚ å¦‚ä½•å°†ä¸€ä¸ªæ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°åº”ç”¨åˆ°ä¸¤ä¸ªå·²åŒ…è£…çš„å€¼ä¸Šï¼Ÿ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªå‚æ•°çš„Curryå‹åŠ æ³•å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> curriedAddition = <span class="function">(<span class="params">a: <span class="built_in">number</span></span>) =&gt;</span> (b: <span class="built_in">number</span>) =&gt; a + b</span><br><span class="line"></span><br><span class="line">Just.of(<span class="number">5</span>).fmap(curriedAddition) <span class="comment">// è¿”å› `Just.of((b: number) =&gt; 5 + b)`</span></span><br><span class="line"><span class="comment">// Ok ç»§ç»­</span></span><br><span class="line">Just.of(<span class="number">4</span>).fmap(Just.of(<span class="function">(<span class="params">b: <span class="built_in">number</span></span>) =&gt;</span> <span class="number">5</span> + b))  <span class="comment">// âŒä¸è¡Œäº†ï¼ŒæŠ¥é”™äº†ï¼ŒFunctoræ²¡åŠæ³•å¤„ç†åŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„fn</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯Applicativeå¯ä»¥ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">5</span>).fmap(curriedAddition) <span class="comment">// è¿”å› `Just.of((b: number) =&gt; 5 + b)`</span></span><br><span class="line"><span class="comment">// âœ…å½“å½“å½“</span></span><br><span class="line">Just.of(<span class="number">3</span>).apply(Just.of(<span class="function">(<span class="params">b: <span class="built_in">number</span></span>) =&gt;</span> <span class="number">5</span> + b)) <span class="comment">// Just.of(8)</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™Applicative æŠŠ Functor æ¨åˆ°ä¸€è¾¹ã€‚ â€œå¤§äººç‰©å¯ä»¥ä½¿ç”¨å…·æœ‰ä»»æ„æ•°é‡å‚æ•°çš„å‡½æ•°ï¼Œâ€å®ƒè¯´ã€‚ â€œè£…å¤‡äº† &lt;$&gt;(fmap) ä¸ &lt;*&gt;(apply) ä¹‹åï¼Œæˆ‘å¯ä»¥æ¥å—å…·æœ‰ä»»æ„ä¸ªæ•°æœªåŒ…è£…å€¼å‚æ•°çš„ä»»æ„å‡½æ•°ã€‚ ç„¶åæˆ‘ä¼ ç»™å®ƒæ‰€æœ‰å·²åŒ…è£…çš„å€¼ï¼Œè€Œæˆ‘ä¼šå¾—åˆ°ä¸€ä¸ªå·²åŒ…è£…çš„å€¼å‡ºæ¥ï¼ å•Šå•Šå•Šå•Šå•Šï¼â€</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">3</span>).apply(Just.of(<span class="number">5</span>).fmap(curriedAddition)) <span class="comment">// è¿”å› `Just.of(8)`</span></span><br></pre></td></tr></table></figure><p><br></p><h3 id="applicativeæ€»ç»“"><a href="#applicativeæ€»ç»“" class="headerlink" title="Applicativeæ€»ç»“"></a>Applicativeæ€»ç»“</h3><p>æˆ‘ä»¬é‡ç”³ä¸€ä¸ªApplicativeçš„å®šä¹‰, <strong>å¦‚æœFunctorè¦æ±‚å®ç°fmapçš„è¯ï¼ŒApplicativeå°±æ˜¯è¦æ±‚å®ç°apply</strong>ï¼Œapplyç¬¦åˆä»¥ä¸‹å®šä¹‰:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// è¿™æ˜¯Functorçš„fmapå®šä¹‰</span><br><span class="line">&lt;Functor T&gt;.fmap(fn: (v: T) =&gt; U): &lt;Functor U&gt;</span><br><span class="line"></span><br><span class="line">// è¿™æ˜¯Applicativeçš„applyå®šä¹‰ï¼Œå’Œä¸Šé¢å¯¹æ¯”ï¼Œfnå˜æˆäº†ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å‡½æ•°</span><br><span class="line">&lt;Applicative T&gt;.apply(fn: &lt;Applicative (v: T) =&gt; U&gt;): &lt;Applicative U&gt;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="monad"><a href="#monad" class="headerlink" title="Monad"></a>Monad</h2><p>ç»ˆäºç»ƒåˆ°ä¸‰é‡å¤©äº†ï¼ç»§ç»­â›½åŠ æ²¹ï¸</p><p>å¦‚ä½•å­¦ä¹  Monad å‘¢ï¼š</p><ol><li>ä½ è¦å–å¾—è®¡ç®—æœºç§‘å­¦åšå£«å­¦ä½ã€‚</li><li>ç„¶åæŠŠå®ƒæ‰”æ‰ï¼Œå› ä¸ºåœ¨æœ¬æ–‡ä½ å¹¶ä¸éœ€è¦å®ƒï¼</li></ol><p>Monad å¢åŠ äº†ä¸€ä¸ªæ–°çš„è½¬å˜ã€‚</p><p><code>Functor</code> å°†ä¸€ä¸ª<code>å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šï¼š</p><p><img src="/images/ts-fam/fmap.png" alt></p><p><code>Applicative</code> å°†ä¸€ä¸ª<code>å·²åŒ…è£…çš„å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šï¼š</p><p><img src="/images/ts-fam/applicative.png" alt></p><p>Monad å°†ä¸€ä¸ª<code>è¿”å›å·²åŒ…è£…å€¼çš„å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚ Monad å®šä¹‰ä¸€ä¸ªå‡½æ•°<code>flatMap</code>ï¼ˆåœ¨ Haskell ä¸­æ˜¯ä½¿ç”¨æ“ä½œç¬¦ <code>&gt;&gt;=</code> æ¥åº”ç”¨Monadï¼Œè¯»ä½œâ€œbindâ€ï¼‰æ¥åšè¿™ä¸ªã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸ªç¤ºä¾‹ã€‚ è€æ­æ¡£ Maybe æ˜¯ä¸€ä¸ª Monadï¼š</p><p><img src="/images/ts-fam/context.png" alt></p><p>å‡è®¾ <code>half</code> æ˜¯ä¸€ä¸ªåªé€‚ç”¨äºå¶æ•°çš„å‡½æ•°ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„: "è¿”å›å·²åŒ…è£…å€¼"çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">half</span>(<span class="params">value: <span class="built_in">number</span></span>): <span class="title">Maybe</span>&lt;<span class="title">number</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value % <span class="number">2</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Just.of(value / <span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> None</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/half.png" alt></p><p>å¦‚æœæˆ‘ä»¬å–‚ç»™å®ƒä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¼šæ€æ ·ï¼Ÿ</p><p><img src="/images/ts-fam/half_ouch.png" alt></p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨flatMap(Haskell ä¸­çš„&gt;&gt;=)æ¥å°†æˆ‘ä»¬å·²åŒ…è£…çš„å€¼å¡è¿›è¯¥å‡½æ•°ã€‚ è¿™æ˜¯ &gt;&gt;= çš„ç…§ç‰‡ï¼š</p><p><img src="/images/ts-fam/plunger.jpg" alt></p><p>ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œæ–¹å¼ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">3</span>).flatMap(half) <span class="comment">// =&gt; Nothing, Haskellä¸­ä½¿ç”¨æ“ä½œç¬¦è¿™æ ·æ“ä½œ: Just 3 &gt;&gt;= half</span></span><br><span class="line">Just.of(<span class="number">4</span>).flatMap(half) <span class="comment">// =&gt; Just 2</span></span><br><span class="line">None.flatMap(half)       <span class="comment">// =&gt; Nothing</span></span><br></pre></td></tr></table></figure><p>å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å†çœ‹çœ‹flatMapçš„æ–¹æ³•ç­¾å:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Maybe</span></span><br><span class="line">Maybe&lt;T&gt;.flatMap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">val: T</span>) =&gt; Maybe&lt;U&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">U</span>&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="params">Array</span></span></span><br><span class="line"><span class="function"><span class="params">Array</span>&lt;<span class="params">T</span>&gt;.<span class="params">flatMap</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: (<span class="params">val: T</span>) =&gt; U[]</span>): <span class="params">U</span>[]</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/bind_def.png" alt></p><p><strong>Arrayæ˜¯ä¸€ä¸ªMonad</strong>, Javascriptçš„Arrayçš„flatMapå·²ç»æ­£å¼æˆä¸ºæ ‡å‡†ï¼Œ çœ‹çœ‹å®ƒçš„ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">arr1.map(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]); </span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br><span class="line"></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]);</span><br><span class="line"><span class="comment">// [2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// only one level is flattened</span></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [[x * <span class="number">2</span>]]);</span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br></pre></td></tr></table></figure><p><br></p><p>Maybe ä¹Ÿæ˜¯ä¸€ä¸ª Monadï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> None &#123;</span><br><span class="line">  <span class="keyword">static</span> flatMap(fn: <span class="built_in">any</span>): Nothing &#123;</span><br><span class="line">    <span class="keyword">return</span> None;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// å’Œä¸Šé¢çš„applyå·®ä¸å¤š</span></span><br><span class="line">  <span class="comment">// ä½¿ç”¨æ–¹æ³•é‡è½½ï¼Œè®©Typescriptæ›´å¥½æ¨æ–­</span></span><br><span class="line">  <span class="comment">// å¦‚æœå‡½æ•°è¿”å›Justç±»å‹ï¼Œç»“æœä¹Ÿæ˜¯Justç±»å‹</span></span><br><span class="line">  flatMap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">a: T</span>) =&gt; Just&lt;U&gt;</span>): <span class="params">Just</span>&lt;<span class="params">U</span>&gt;;</span></span><br><span class="line"><span class="function">  // å¦‚æœå‡½æ•°è¿”å›å€¼æ˜¯<span class="params">Nothing</span>ç±»å‹ï¼Œç»“æœæ˜¯<span class="params">Nothing</span>.</span></span><br><span class="line"><span class="function">  <span class="params">flatMap</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: (<span class="params">a: T</span>) =&gt; Nothing</span>): <span class="params">Nothing</span>;</span></span><br><span class="line"><span class="function">  // å¦‚æœå‡½æ•°è¿”å›å€¼æ˜¯<span class="params">Maybe</span>ç±»å‹, è¿”å›ä¸€ä¸ª<span class="params">Maybe</span>ç±»å‹</span></span><br><span class="line"><span class="function">  <span class="params">flatMap</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: (<span class="params">a: T</span>) =&gt; Maybe&lt;U&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">U</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">fn</span>(<span class="params"><span class="keyword">this</span>.value</span>)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="params">Just</span>.<span class="params">of</span>(<span class="params">3</span>).<span class="params">flatMap</span>(<span class="params">half</span>) // <span class="params">Nothing</span></span></span><br><span class="line"><span class="function"><span class="params">Just</span>.<span class="params">of</span>(<span class="params">4</span>).<span class="params">flatMap</span>(<span class="params">half</span>) // <span class="params">Just</span>.<span class="params">of</span>(<span class="params">4</span>)</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ Just 3 è¿ä½œçš„æƒ…å†µï¼</p><p><img src="/images/ts-fam/monad_just.png" alt></p><p>å¦‚æœä¼ å…¥ä¸€ä¸ª Nothing å°±æ›´ç®€å•äº†ï¼š</p><p><img src="/images/ts-fam/monad_nothing.png" alt></p><p>ä½ è¿˜å¯ä»¥å°†è¿™äº›è°ƒç”¨ä¸²è”èµ·æ¥ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">20</span>).flatMap(half).flatMap(half).flatMap(falf) <span class="comment">// =&gt; Nothing</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/monad_chain.png" alt><br><img src="/images/ts-fam/whoa.png" alt></p><p><br></p><p>å¾ˆç‚«é…·å“ˆï¼æ‰€ä»¥æˆ‘ä»¬ç°åœ¨çŸ¥é“Maybeæ—¢æ˜¯ä¸€ä¸ªFunctorã€Applicativeï¼Œè¿˜æ˜¯ä¸€ä¸ªMonadã€‚</p><p>åŸæ–‡è¿˜ç¤ºèŒƒäº†å¦ä¸€ä¸ªä¾‹å­: <code>IO</code> Monad, æˆ‘ä»¬è¿™é‡Œå°±ç®€å•äº†è§£ä¸€ä¸‹</p><p><img src="/images/ts-fam/io.png" alt></p><p>IOçš„ç­¾åå¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> IO&lt;T&gt; &#123;</span><br><span class="line">  val: T</span><br><span class="line">  <span class="comment">// å…·ä½“å®ç°æˆ‘ä»¬æš‚ä¸å…³å¿ƒ</span></span><br><span class="line">  flatMap(fn: <span class="function">(<span class="params">val: T</span>) =&gt;</span> IO&lt;U&gt;): IO&lt;U&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ¥çœ‹ä¸‰ä¸ªå‡½æ•°ã€‚ getLine æ²¡æœ‰å‚æ•°, ç”¨æ¥è·å–ç”¨æˆ·è¾“å…¥ï¼š</p><p><img src="/images/ts-fam/getLine.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLine</span>(<span class="params"></span>): <span class="title">IO</span>&lt;<span class="title">string</span>&gt;</span></span><br></pre></td></tr></table></figure><p>readFile æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ–‡ä»¶åï¼‰å¹¶è¿”å›è¯¥æ–‡ä»¶çš„å†…å®¹ï¼š</p><p><img src="/images/ts-fam/readFile.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">filename: <span class="built_in">string</span></span>): <span class="title">IO</span>&lt;<span class="title">string</span>&gt;</span></span><br></pre></td></tr></table></figure><p>putStrLn è¾“å‡ºå­—ç¬¦ä¸²åˆ°æ§åˆ¶å°ï¼š</p><p><img src="/images/ts-fam/putStrLn.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">putStrLn</span>(<span class="params">str: <span class="built_in">string</span></span>): <span class="title">IO</span>&lt;<span class="title">void</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰è¿™ä¸‰ä¸ªå‡½æ•°éƒ½æ¥å—æ™®é€šå€¼ï¼ˆæˆ–æ— å€¼ï¼‰å¹¶è¿”å›ä¸€ä¸ªå·²åŒ…è£…çš„å€¼ï¼Œå³IOã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ flatMap å°†å®ƒä»¬ä¸²è”èµ·æ¥ï¼</p><p><img src="/images/ts-fam/monad_io.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">getLine().flatMap(readFile).flatMap(putStrLn)</span><br></pre></td></tr></table></figure><p>å¤ªæ£’äº†ï¼ å‰æ’å åº§æ¥çœ‹ monad å±•ç¤ºï¼æˆ‘ä»¬ä¸éœ€è¦åœ¨å–æ¶ˆåŒ…è£…å’Œé‡æ–°åŒ…è£… IO monad çš„å€¼ä¸Šæµªè´¹æ—¶é—´. flatMap ä¸ºæˆ‘ä»¬åšäº†é‚£äº›å·¥ä½œ!</p><p>Haskell è¿˜ä¸º monad æä¾›äº†è¯­æ³•ç³–, å«åš do è¡¨è¾¾å¼:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">foo</span> = <span class="keyword">do</span></span><br><span class="line">    filename &lt;- getLine</span><br><span class="line">    contents &lt;- readFile filename</span><br><span class="line">    putStrLn contents</span><br></pre></td></tr></table></figure><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>functor æ˜¯å®ç°äº† <code>fmap</code> çš„æ•°æ®ç±»å‹ã€‚</li><li>applicative æ˜¯å®ç°äº† <code>apply</code> çš„æ•°æ®ç±»å‹ã€‚</li><li>monad æ˜¯å®ç°äº† <code>flatMap</code> çš„æ•°æ®ç±»å‹ã€‚</li><li>Maybe å®ç°äº†è¿™ä¸‰è€…ï¼Œæ‰€ä»¥å®ƒæ˜¯ functorã€ applicativeã€ ä»¥åŠ monadã€‚</li></ol><p>è¿™ä¸‰è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p><img src="/images/ts-fam/recap.png" alt></p><ol><li><strong>functor</strong>: å¯é€šè¿‡ fmap å°†ä¸€ä¸ª<code>å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚</li><li><strong>applicative</strong>: å¯é€šè¿‡ apply å°†ä¸€ä¸ª<code>å·²åŒ…è£…çš„å‡½æ•°</code>åº”ç”¨åˆ°<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚</li><li><strong>monad</strong>: å¯é€šè¿‡ flatMap å°†ä¸€ä¸ª<code>è¿”å›å·²åŒ…è£…å€¼çš„å‡½æ•°</code>åº”ç”¨åˆ°<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚</li></ol><p>ç»¼åˆèµ·æ¥çœ‹çœ‹å®ƒä»¬çš„ç­¾åï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// è¿™æ˜¯Functorçš„fmapå®šä¹‰</span><br><span class="line">&lt;Functor T&gt;.fmap(fn: (v: T) =&gt; U): &lt;Functor U&gt;</span><br><span class="line"></span><br><span class="line">// è¿™æ˜¯Applicativeçš„applyå®šä¹‰ï¼Œå’Œä¸Šé¢å¯¹æ¯”ï¼Œfnå˜æˆäº†ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å‡½æ•°</span><br><span class="line">&lt;Applicative T&gt;.apply(fn: &lt;Applicative (v: T) =&gt; U&gt;): &lt;Applicative U&gt;</span><br><span class="line"></span><br><span class="line">// Monadçš„å®šä¹‰, è€Œæ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œ è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å€¼</span><br><span class="line">&lt;Monad T&gt;.flatmap(fn: (v: T) =&gt; &lt;Monad U&gt;): &lt;Monad U&gt;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œäº²çˆ±çš„æœ‹å‹ï¼ˆæˆ‘è§‰å¾—æˆ‘ä»¬ç°åœ¨æ˜¯æœ‹å‹äº†ï¼‰ï¼Œæˆ‘æƒ³æˆ‘ä»¬éƒ½åŒæ„ monad æ˜¯ä¸€ä¸ªç®€å•ä¸”é«˜æ˜çš„ä¸»æ„ï¼ˆSMART IDEA(tm)ï¼‰ã€‚ ç°åœ¨ä½ å·²ç»é€šè¿‡è¿™ç¯‡æŒ‡å—æ¶¦æ¹¿äº†ä½ çš„å£å“¨ï¼Œä¸ºä»€ä¹ˆä¸æ‹‰ä¸Š Mel Gibson å¹¶æŠ“ä½æ•´ä¸ªç“¶å­å‘¢ã€‚ å‚é˜…ã€ŠHaskell è¶£å­¦æŒ‡å—ã€‹çš„ã€Šæ¥çœ‹çœ‹å‡ ç§ Monadã€‹ã€‚ å¾ˆå¤šä¸œè¥¿æˆ‘å…¶å®æ©é¥°äº†å› ä¸º Miran æ·±å…¥è¿™æ–¹é¢åšå¾—å¾ˆæ£’.</p><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>æœ¬æ–‡åœ¨<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" target="_blank" rel="noopener">åŸæ–‡</a>çš„åŸºç¡€ä¸Š, å‚è€ƒäº†ä¸‹åˆ—è¿™äº›ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†æ¬¡æ„Ÿè°¢è¿™äº›ä½œè€…:</p><ul><li><a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html#translations" target="_blank" rel="noopener">Functors, Applicatives, And Monads In Pictures</a> - åŸæ–‡</li><li><a href="http://www.mokacoding.com/blog/functor-applicative-monads-in-pictures/" target="_blank" rel="noopener">Swift Functors, Applicatives, and Monads in Pictures</a> - Swiftç‰ˆæœ¬, æœ¬æ–‡ä¸»è¦å‚è€ƒè¿™ç¯‡æ–‡ç« </li><li><a href="https://hltj.me/kotlin/2017/08/25/kotlin-functor-applicative-monad-cn.html" target="_blank" rel="noopener">Kotlin ç‰ˆå›¾è§£ Functorã€Applicative ä¸ Monad</a> - Kotlinç‰ˆæœ¬ï¼Œç¿»è¯‘éå¸¸æ£’</li><li><a href="http://jiyinyiyong.github.io/monads-in-pictures/" target="_blank" rel="noopener">Functor, Applicative, ä»¥åŠ Monad çš„å›¾ç‰‡é˜é‡Š</a> - ä¸­æ–‡ç‰ˆæœ¬ï¼Œ<strong>é¢˜å¶</strong>ç¿»è¯‘</li><li><a href="https://medium.com/@lettier/your-easy-guide-to-monads-applicatives-functors-862048d61610" target="_blank" rel="noopener">Your easy guide to Monads, Applicatives, &amp; Functors</a> - Mediumä¸Šä¸€ç¯‡åŠ¨å›¾å›¾è§£Monadçš„æ–‡ç« ï¼Œå†™å¾—ä¹Ÿä¸é”™. è¯»å®Œæœ¬æ–‡å¯ä»¥å†è¯»è¿™ç¯‡æ–‡ç« </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡æ˜¯ç»å…¸çš„&lt;a href=&quot;http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Functo
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>2019å¹´äº†ï¼Œæ•´ç†äº†Nä¸ªå®ç”¨æ¡ˆä¾‹å¸®ä½ å¿«é€Ÿè¿ç§»åˆ°React Hooks(æ”¶è—æ…¢æ…¢çœ‹ç³»åˆ—)</title>
    <link href="https://bobi.ink/2019/08/10/react-hooks/"/>
    <id>https://bobi.ink/2019/08/10/react-hooks/</id>
    <published>2019-08-09T16:00:00.000Z</published>
    <updated>2019-08-18T06:14:32.162Z</updated>
    
    <content type="html"><![CDATA[<p><br></p><p><img src="/images/react-hooks/cover.png" alt></p><p><br></p><p>åœ¨<a href="https://www.youtube.com/channel/UCz5vTaEhvh7dOHEyd1efcaQ" target="_blank" rel="noopener">React Conf 2018</a>å®£å¸ƒReact Hooksåï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´å¼€å§‹å°è¯•ä½¿ç”¨React Hooksï¼Œç°åœ¨æ–°é¡¹ç›®åŸºæœ¬ä¸å†™Classç»„ä»¶äº†ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒç¡®å®è®©æˆ‘çš„å¼€å‘æ•ˆç‡æé«˜äº†å¾ˆå¤šï¼Œæ”¹å˜äº†å·²æœ‰çš„ç»„ä»¶å¼€å‘æ€ç»´å’Œæ¨¡å¼.</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-3" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a>ä¸­å·²ç»æ€»ç»“è¿‡<strong>React Hooksçš„æ„ä¹‰ï¼Œä»¥åŠä¸€äº›åº”ç”¨åœºæ™¯</strong>ã€‚</p><p>é‚£è¿™ç¯‡æ–‡ç« å°±å®Œå…¨æ˜¯ä»‹ç»<strong>React Hooksçš„åº”ç”¨å®ä¾‹</strong>ï¼Œåˆ—ä¸¾äº†æˆ‘ä½¿ç”¨React Hooksçš„ä¸€äº›å®è·µã€‚ å¸Œæœ›é€šè¿‡è¿™äº›æ¡ˆä¾‹ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿç†Ÿç»ƒï¼Œå¹¶è¿ç§»åˆ°React Hookså¼€å‘æ¨¡å¼. </p><blockquote><p><strong>æ–‡ç« ç¯‡å¹…å¾ˆé•¿ï¼Œå»ºè®®æ”¶è—ä¸çœ‹, è‡³å°‘çœ‹çœ‹ç›®å½•å§</strong></p></blockquote><p><br></p><p>æŠŠä¹‹å‰æ–‡ç« æ•´ç†çš„<code>React Hooksåº”ç”¨åœºæ™¯</code>æ€»ç»“æ‹¿è¿‡æ¥, æœ¬æ–‡åŸºæœ¬æŒ‰ç…§<strong>è¿™ä¸ªèŒƒå›´è¿›è¡Œç»„ç»‡</strong>:</p><p><img src="/images/react-hooks/apply.png" alt></p><p><br></p><p><strong>å¦‚æœä½ æƒ³è¦äº†è§£React Hooksçš„åŸç†å¯ä»¥é˜…è¯»è¿™äº›æ–‡ç« </strong>:</p><ul><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fmedium.com%2F%40ryardley%2Freact-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a></li><li><a href="https://juejin.im/post/5cfa29e151882539c33e4f5e#heading-8" target="_blank" rel="noopener">ä»Preactä¸­äº†è§£ç»„ä»¶å’ŒhooksåŸºæœ¬åŸç†</a></li></ul><p><br></p><p><strong>ç›®å½•ç´¢å¼•</strong></p><!-- TOC --><ul><li><a href="#1-ç»„ä»¶çŠ¶æ€"><strong>1. ç»„ä»¶çŠ¶æ€</strong></a><ul><li><a href="#1-1-usesetstate-æ¨¡æ‹Ÿä¼ ç»Ÿçš„setstate">1-1 useSetState æ¨¡æ‹Ÿä¼ ç»Ÿçš„setState</a></li><li><a href="#1-2-usereducer-reduxé£æ ¼çŠ¶æ€ç®¡ç†">1-2 useReducer Reduxé£æ ¼çŠ¶æ€ç®¡ç†</a></li><li><a href="#1-3-useforceupdate-å¼ºåˆ¶é‡æ–°æ¸²æŸ“">1-3 useForceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“</a></li><li><a href="#1-4-usestorage-ç®€åŒ–localstorageå­˜å–">1-4 useStorage ç®€åŒ–localStorageå­˜å–</a></li><li><a href="#1-5-userefstate-å¼•ç”¨stateçš„æœ€æ–°å€¼">1-5 useRefState å¼•ç”¨stateçš„æœ€æ–°å€¼</a><ul><li><a href="#1-5-1-æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—">1-5-1 æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—?</a></li></ul></li><li><a href="#1-6-userefprops-å¼•ç”¨æœ€æ–°çš„props">1-6 useRefProps å¼•ç”¨æœ€æ–°çš„Props</a></li><li><a href="#1-7-useinstance-å®ä¾‹å˜é‡å­˜å–">1-7 useInstance â€˜å®ä¾‹â€™å˜é‡å­˜å–</a></li><li><a href="#1-9-useprevious-è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼">1-9 usePrevious è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼</a></li><li><a href="#1-10-useimmer-ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ">1-10 useImmer ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ</a></li><li><a href="#1-11-å°è£…å·¥å…·hooksç®€åŒ–stateçš„æ“ä½œ">1-11 å°è£…â€™å·¥å…·Hooksâ€™ç®€åŒ–Stateçš„æ“ä½œ</a><ul><li><a href="#1-11-1-usetoggle-å¼€å…³">1-11-1 useToggle å¼€å…³</a></li><li><a href="#1-11-2-usearray-ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ">1-11-2 useArray ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ</a></li></ul></li></ul></li><li><a href="#2-æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°"><strong>2. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong></a><ul><li><a href="#2-1-useonmount-æ¨¡æ‹Ÿcomponentdidmount">2-1 useOnMount æ¨¡æ‹ŸcomponentDidMount</a></li><li><a href="#2-2-useonunmount-æ¨¡æ‹Ÿcomponentwillunmount">2-2 useOnUnmount æ¨¡æ‹ŸcomponentWillUnmount</a></li><li><a href="#2-3-useonupdate-æ¨¡æ‹Ÿcomponentdidupdate">2-3 useOnUpdate æ¨¡æ‹ŸcomponentDidUpdate</a></li></ul></li><li><a href="#3-äº‹ä»¶å¤„ç†"><strong>3. äº‹ä»¶å¤„ç†</strong></a><ul><li><a href="#3-1-usechange-ç®€åŒ–onchangeè¡¨å•åŒå‘ç»‘å®š">3-1 useChange ç®€åŒ–onChangeè¡¨å•åŒå‘ç»‘å®š</a></li><li><a href="#3-2-usebind-ç»‘å®šå›è°ƒå‚æ•°">3-2 useBind ç»‘å®šå›è°ƒå‚æ•°</a></li><li><a href="#3-3-è‡ªå®šä¹‰äº‹ä»¶å°è£…">3-3 è‡ªå®šä¹‰äº‹ä»¶å°è£…</a><ul><li><a href="#3-3-1-useactive">3-3-1 useActive</a></li><li><a href="#3-3-2-usetouch-æ‰‹åŠ¿äº‹ä»¶å°è£…">3-3-2 useTouch æ‰‹åŠ¿äº‹ä»¶å°è£…</a></li><li><a href="#3-3-3-usedraggable-æ‹–æ‹½äº‹ä»¶å°è£…">3-3-3 useDraggable æ‹–æ‹½äº‹ä»¶å°è£…</a></li><li><a href="#3-3-4-react-events-é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…">3-3-4 react-events é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…</a></li></ul></li><li><a href="#3-4-usesubscription-é€šç”¨äº‹ä»¶æºè®¢é˜…">3-4 useSubscription é€šç”¨äº‹ä»¶æºè®¢é˜…</a></li><li><a href="#3-5-useobservable-hookså’Œrxjsä¼˜é›…çš„ç»“åˆrxjs-hooks">3-5 useObservable Hookså’ŒRxJSä¼˜é›…çš„ç»“åˆ(rxjs-hooks)</a></li><li><a href="#3-6-useeventemitter-å¯¹æ¥eventemitter">3-6 useEventEmitter å¯¹æ¥eventEmitter</a></li></ul></li><li><a href="#4-contextçš„å¦™ç”¨"><strong>4. Contextçš„å¦™ç”¨</strong></a><ul><li><a href="#4-1-usetheme-ä¸»é¢˜é…ç½®">4-1 useTheme ä¸»é¢˜é…ç½®</a></li><li><a href="#4-2-unstated-ç®€å•çŠ¶æ€ç®¡ç†å™¨">4-2 unstated ç®€å•çŠ¶æ€ç®¡ç†å™¨</a></li><li><a href="#4-3-usei18n-å›½é™…åŒ–">4-3 useI18n å›½é™…åŒ–</a></li><li><a href="#4-4-userouter-ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®">4-4 useRouter ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®</a></li><li><a href="#4-5-react-hook-form-hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±">4-5 react-hook-form Hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±?</a></li></ul></li><li><a href="#5-å‰¯ä½œç”¨å°è£…"><strong>5. å‰¯ä½œç”¨å°è£…</strong></a><ul><li><a href="#5-1-usetimeout-è¶…æ—¶ä¿®æ”¹çŠ¶æ€">5-1 useTimeout è¶…æ—¶ä¿®æ”¹çŠ¶æ€</a></li><li><a href="#5-2-useonlinestatus-ç›‘å¬åœ¨çº¿çŠ¶æ€">5-2 useOnlineStatus ç›‘å¬åœ¨çº¿çŠ¶æ€</a></li></ul></li><li><a href="#6-å‰¯ä½œç”¨è¡ç”Ÿ"><strong>6. å‰¯ä½œç”¨è¡ç”Ÿ</strong></a><ul><li><a href="#6-1-usetitle-è®¾ç½®æ–‡æ¡£title">6-1 useTitle è®¾ç½®æ–‡æ¡£title</a></li><li><a href="#6-2-usedebounce">6-2 useDebounce</a></li><li><a href="#6-3-usethrottle">6-3 useThrottle</a></li></ul></li><li><a href="#7-ç®€åŒ–ä¸šåŠ¡é€»è¾‘"><strong>7. ç®€åŒ–ä¸šåŠ¡é€»è¾‘</strong></a><ul><li><a href="#7-1-usepromise-å°è£…å¼‚æ­¥è¯·æ±‚">7-1 usePromise å°è£…å¼‚æ­¥è¯·æ±‚</a></li><li><a href="#7-2-usepromiseeffect-è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚">7-2 usePromiseEffect è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚</a></li><li><a href="#7-3-useinfinitelist-å®ç°æ— é™åŠ è½½åˆ—è¡¨">7-3 useInfiniteList å®ç°æ— é™åŠ è½½åˆ—è¡¨</a></li><li><a href="#7-4-usepoll-ç”¨hookå®ç°è½®è¯¢">7-4 usePoll ç”¨hookå®ç°è½®è¯¢</a></li><li><a href="#7-5-ä¸šåŠ¡é€»è¾‘æŠ½ç¦»">7-5 ä¸šåŠ¡é€»è¾‘æŠ½ç¦»</a></li></ul></li><li><a href="#8-å¼€è„‘æ´"><strong>8. å¼€è„‘æ´</strong></a><ul><li><a href="#8-1-usescript-hooks--suspend--â¤ï¸">8-1 useScript: Hooks + Suspend = â¤ï¸</a></li><li><a href="#8-2-usemodal-æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†">8-2 useModal æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†</a></li></ul></li><li><a href="#react-hooks-æŠ€æœ¯åœ°å›¾"><strong>React Hooks æŠ€æœ¯åœ°å›¾</strong></a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li></ul><!-- /TOC --><p><br></p><h2 id="1-ç»„ä»¶çŠ¶æ€"><a href="#1-ç»„ä»¶çŠ¶æ€" class="headerlink" title="1. ç»„ä»¶çŠ¶æ€"></a><strong>1. ç»„ä»¶çŠ¶æ€</strong></h2><p>Reactæä¾›äº†ä¸€ä¸ªå¾ˆåŸºæœ¬çš„ç»„ä»¶çŠ¶æ€è®¾ç½®Hook:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = useState(initialState);</span><br></pre></td></tr></table></figure><p><a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usestate" target="_blank" rel="noopener">useState</a>è¿”å›<strong>ä¸€ä¸ªstateï¼Œä»¥åŠæ›´æ–°stateçš„å‡½æ•°</strong>. setStateå¯ä»¥æ¥å—ä¸€ä¸ªæ–°çš„å€¼ï¼Œä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“.</p><blockquote><p><strong>Reactä¼šç¡®ä¿setStateå‡½æ•°æ˜¯ç¨³å®šçš„ï¼Œä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜</strong>ã€‚ä¸‹é¢çš„useReducerçš„dispatchå‡½æ•°ã€useRefçš„currentå±æ€§ä¹Ÿä¸€æ ·ã€‚<br><strong>è¿™å°±æ„å‘³ç€setStateã€dispatchã€ref.current, å¯ä»¥å®‰å…¨åœ°åœ¨useEffectã€useMemoã€ useCallbackä¸­å¼•ç”¨</strong></p></blockquote><p><br></p><h3 id="1-1-usesetstate-æ¨¡æ‹Ÿä¼ ç»Ÿçš„setstate"><a href="#1-1-usesetstate-æ¨¡æ‹Ÿä¼ ç»Ÿçš„setstate" class="headerlink" title="1-1 useSetState æ¨¡æ‹Ÿä¼ ç»Ÿçš„setState"></a>1-1 useSetState æ¨¡æ‹Ÿä¼ ç»Ÿçš„setState</h3><p>useStateå’ŒClassç»„ä»¶çš„setStateä¸å¤ªä¸€æ ·.</p><p>Classç»„ä»¶çš„stateå±æ€§ä¸€èˆ¬æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨setStateæ—¶ï¼Œä¼šæµ…æ‹·è´åˆ°stateå±æ€§, å¹¶è§¦å‘æ›´æ–°, æ¯”å¦‚:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    name: <span class="string">'_sx_'</span>,</span><br><span class="line">    age: <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleIncrementAge = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åªæ›´æ–°age</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;<span class="attr">age</span>: <span class="keyword">this</span>.state.age + <span class="number">1</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è€Œ<strong>useStateä¼šç›´æ¥è¦†ç›–stateå€¼</strong>ã€‚ä¸ºäº†å®ç°å’ŒsetStateä¸€æ ·çš„æ•ˆæœ, å¯ä»¥è¿™æ ·å­åš:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;name: <span class="string">'sx'</span>, age: <span class="number">10</span>&#125;</span><br><span class="line"><span class="keyword">const</span> MyComp: FC = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(initialState)</span><br><span class="line">  <span class="keyword">const</span> handleIncrementAge = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// setStateæ–¹æ³•æ”¯æŒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–æœ€æ–°çš„stateå€¼</span></span><br><span class="line">    <span class="comment">// ç„¶åä½¿ç”¨...æ“ä½œç¬¦å®ç°å¯¹è±¡æµ…æ‹·è´</span></span><br><span class="line">    setState(<span class="function">(<span class="params">prevState</span>) =&gt;</span> (&#123;...preState, age: prevState.age + <span class="number">1</span>&#125;) )</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Okï¼Œç°åœ¨æŠŠå®ƒå°è£…æˆé€šç”¨çš„hooksï¼Œåœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨ã€‚è¿™æ—¶å€™å°±ä½“ç°å‡ºæ¥Hookså¼ºå¤§çš„é€»è¾‘æŠ½è±¡èƒ½åŠ›ï¼š<strong>Hooks æ—¨åœ¨è®©ç»„ä»¶çš„å†…éƒ¨é€»è¾‘ç»„ç»‡æˆå¯å¤ç”¨çš„æ›´å°å•å…ƒï¼Œè¿™äº›å•å…ƒå„è‡ªç»´æŠ¤ä¸€éƒ¨åˆ†ç»„ä»¶â€˜çŠ¶æ€å’Œé€»è¾‘â€™</strong></p><p>çœ‹çœ‹æˆ‘ä»¬çš„<code>useSetState</code>, æˆ‘ä¼šä½¿ç”¨Typescriptè¿›è¡Œä»£ç ç¼–å†™:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useSetState</span>&lt;<span class="title">S</span> <span class="title">extends</span> <span class="title">object</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  initalState: S | ((</span>) =&gt; <span class="title">S</span>),</span></span><br><span class="line">): [S, (state: Partial&lt;S&gt; | ((state: S) =&gt; Partial&lt;S&gt;)) =&gt; void] &#123;</span><br><span class="line">  <span class="keyword">const</span> [_state, _setState] = useState&lt;S&gt;(initalState)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setState = useCallback(<span class="function">(<span class="params">state: Partial&lt;S&gt; | ((state: S</span>) =&gt;</span> Partial&lt;S&gt;)) =&gt; &#123;</span><br><span class="line">    _setState(<span class="function">(<span class="params">prev: S</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> nextState = state</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> state === <span class="string">'function'</span>) &#123;</span><br><span class="line">        nextState = state(prev)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123; ...prev, ...nextState &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [_state, setState]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ------</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UseSetState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useSetState&lt;&#123; <span class="attr">name</span>: string; age: number &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">'sx'</span>, <span class="attr">age</span>: <span class="number">1</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> incrementAge = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setState(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123; <span class="attr">age</span>: prev.age + <span class="number">1</span> &#125;))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div onClick=&#123;incrementAge&#125;&gt;</span><br><span class="line">      &#123;state.name&#125;: &#123;state.age&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>hookså‘½åä»¥<code>use</code>ä¸ºå‰ç¼€</p></blockquote><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-2-usereducer-reduxé£æ ¼çŠ¶æ€ç®¡ç†"><a href="#1-2-usereducer-reduxé£æ ¼çŠ¶æ€ç®¡ç†" class="headerlink" title="1-2 useReducer Reduxé£æ ¼çŠ¶æ€ç®¡ç†"></a>1-2 useReducer Reduxé£æ ¼çŠ¶æ€ç®¡ç†</h3><p>å¦‚æœç»„ä»¶çŠ¶æ€æ¯”è¾ƒå¤æ‚ï¼Œæ¨èä½¿ç”¨useReduceræ¥ç®¡ç†çŠ¶æ€ã€‚å¦‚æœä½ ç†Ÿæ‚‰Reduxï¼Œä¼šå¾ˆä¹ æƒ¯è¿™ç§æ–¹å¼ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰åˆå§‹çŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰Reducer</span></span><br><span class="line"><span class="comment">// ruduceræ¥å—å½“å‰stateï¼Œä»¥åŠä¸€ä¸ªç”¨æˆ·æ“ä½œï¼Œè¿”å›ä¸€ä¸ª'æ–°'çš„state</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'increment'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.count + <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'decrement'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.count - <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å›stateï¼Œä»¥åŠdispatchå‡½æ•°</span></span><br><span class="line">  <span class="comment">// dispatchå‡½æ•°å¯ä»¥è§¦å‘reduceræ‰§è¡Œï¼Œç»™reducerä¼ é€’æŒ‡ä»¤å’Œè½½è·</span></span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;state.count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; dispatch(&#123;<span class="attr">type</span>: <span class="string">'increment'</span>&#125;)&#125;&gt;+<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">      &lt;button onClick=&#123;() =&gt; dispatch(&#123;<span class="attr">type</span>: <span class="string">'decrement'</span>&#125;)&#125;&gt;-<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>äº†è§£æ›´å¤šreducerçš„æ€æƒ³å¯ä»¥å‚è€ƒ<a href="https://redux.js.org/basics/reducers" target="_blank" rel="noopener">Reduxæ–‡æ¡£</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-3-useforceupdate-å¼ºåˆ¶é‡æ–°æ¸²æŸ“"><a href="#1-3-useforceupdate-å¼ºåˆ¶é‡æ–°æ¸²æŸ“" class="headerlink" title="1-3 useForceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“"></a>1-3 useForceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“</h3><p>Classç»„ä»¶å¯ä»¥é€šè¿‡<code>forceUpdate</code>å®ä¾‹æ–¹æ³•æ¥è§¦å‘å¼ºåˆ¶é‡æ–°æ¸²æŸ“ã€‚ä½¿ç”¨useStateä¹Ÿå¯ä»¥æ¨¡æ‹Ÿç›¸åŒçš„æ•ˆæœï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useForceUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [, setValue] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é€’å¢stateå€¼ï¼Œå¼ºåˆ¶Reactè¿›è¡Œé‡æ–°æ¸²æŸ“</span></span><br><span class="line">    setValue(<span class="function"><span class="params">val</span> =&gt;</span> (val + <span class="number">1</span>) % (<span class="built_in">Number</span>.MAX_SAFE_INTEGER - <span class="number">1</span>))</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ForceUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> forceUpdate = useForceUpdate()</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    somethingChange(forceUpdate)</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-4-usestorage-ç®€åŒ–localstorageå­˜å–"><a href="#1-4-usestorage-ç®€åŒ–localstorageå­˜å–" class="headerlink" title="1-4 useStorage ç®€åŒ–localStorageå­˜å–"></a>1-4 useStorage ç®€åŒ–localStorageå­˜å–</h3><p>é€šè¿‡è‡ªå®šä¹‰Hooksï¼Œå¯ä»¥å°†çŠ¶æ€ä»£ç†åˆ°å…¶ä»–æ•°æ®æºï¼Œæ¯”å¦‚localStorageã€‚ ä¸‹é¢æ¡ˆä¾‹å±•ç¤ºå¦‚æœä½¿ç”¨Hookså°è£…å’Œç®€åŒ–localStorageçš„å­˜å–:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useCallback, Dispatch, SetStateAction &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useStorage</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  key: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// é»˜è®¤å€¼</span></span></span></span><br><span class="line"><span class="function"><span class="params">  defaultValue?: T | (() =&gt; T),</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// æ˜¯å¦åœ¨çª—å£å…³é—­åä¿æŒæ•°æ®</span></span></span></span><br><span class="line"><span class="function"><span class="params">  keepOnWindowClosed: <span class="built_in">boolean</span> = <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): [<span class="title">T</span> | <span class="title">undefined</span>, <span class="title">Dispatch</span>&lt;<span class="title">SetStateAction</span>&lt;<span class="title">T</span>&gt;&gt;, (<span class="params"></span>) =&gt; <span class="title">void</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> storage = keepOnWindowClosed ? localStorage : sessionStorage</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è¯•ä»Storageæ¢å¤å€¼</span></span><br><span class="line">  <span class="keyword">const</span> getStorageValue = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> storageValue = storage.getItem(key)</span><br><span class="line">      <span class="keyword">if</span> (storageValue != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(storageValue)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (defaultValue) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">        <span class="keyword">const</span> value = <span class="keyword">typeof</span> defaultValue === <span class="string">'function'</span> ? <span class="function">(<span class="params">defaultValue <span class="keyword">as</span> (<span class="params"></span>) =&gt; T</span>)<span class="params">()</span> : <span class="params">defaultValue</span></span></span><br><span class="line"><span class="function">        <span class="params">storage</span>.<span class="params">setItem</span>(<span class="params">key, <span class="built_in">JSON</span>.stringify(<span class="params">value</span>)</span>)</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">value</span></span></span><br><span class="line"><span class="function">      &#125;</span></span><br><span class="line"><span class="function">    &#125; <span class="params">catch</span> (<span class="params">err</span>) &#123;</span></span><br><span class="line"><span class="function">      <span class="params">console</span>.<span class="params">warn</span>(<span class="params">`useStorage æ— æ³•è·å–$&#123;key&#125;: `, err</span>)</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">undefined</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">const</span> [<span class="params">value</span>, <span class="params">setValue</span>] = <span class="params">useState</span>&lt;<span class="params">T</span> | <span class="params">undefined</span>&gt;(<span class="params">getStorageValue</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // æ›´æ–°ç»„ä»¶çŠ¶æ€å¹¶ä¿å­˜åˆ°<span class="params">Storage</span></span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">save</span> = <span class="params">useCallback</span>&lt;<span class="params">Dispatch</span>&lt;<span class="params">SetStateAction</span>&lt;<span class="params">T</span>&gt;&gt;&gt;(<span class="params">value =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    setValue(<span class="params">prev =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">const</span> finalValue = <span class="keyword">typeof</span> value === '<span class="keyword">function</span>' ? (<span class="params">value <span class="keyword">as</span> (<span class="params">prev: T | <span class="literal">undefined</span></span>) =&gt; T</span>)(<span class="params">prev</span>) : value</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      storage.setItem(<span class="params">key, <span class="built_in">JSON</span>.stringify(<span class="params">finalValue</span>)</span>)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">return</span> finalValue</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // ç§»é™¤çŠ¶æ€</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">clear</span> = <span class="params">useCallback</span>(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    storage.removeItem(<span class="params">key</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    setValue(<span class="params"><span class="literal">undefined</span></span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> [<span class="params">value</span>, <span class="params">save</span>, <span class="params">clear</span>]</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// --------</span></span><br><span class="line"><span class="function">// <span class="params">EXAMPLE</span></span></span><br><span class="line"><span class="function">// --------</span></span><br><span class="line"><span class="function"><span class="params">function</span> <span class="params">Demo</span><span class="params">()</span> &#123;</span></span><br><span class="line"><span class="function">  // ä¿å­˜ç™»å½•çŠ¶æ€</span></span><br><span class="line"><span class="function">  <span class="params">const</span> [<span class="params">use</span>, <span class="params">setUser</span>, <span class="params">clearUser</span>] = <span class="params">useStorage</span>(<span class="params">'user'</span>)</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">handleLogin</span> = (<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">    setUser(user)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleLogout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearUser()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-5-userefstate-å¼•ç”¨stateçš„æœ€æ–°å€¼"><a href="#1-5-userefstate-å¼•ç”¨stateçš„æœ€æ–°å€¼" class="headerlink" title="1-5 useRefState å¼•ç”¨stateçš„æœ€æ–°å€¼"></a>1-5 useRefState å¼•ç”¨stateçš„æœ€æ–°å€¼</h3><p><br></p><p><img src="/images/react-hooks/vue-api.png" alt></p><p><br></p><p>ä¸Šå›¾æ˜¯ä»Šå¹´å…­æœˆä»½<a href="https://vue.w3ctech.com" target="_blank" rel="noopener">VueConf</a>ï¼Œå°¤é›¨æºªçš„Slideæˆªå›¾ï¼Œä»–å¯¹æ¯”äº†Vueæœ€æ–°çš„<a href="https://zhuanlan.zhihu.com/p/68477600" target="_blank" rel="noopener">FunctionBase API</a>å’ŒReact Hook. å®ƒ<strong>æŒ‡å‡ºReact Hooksæœ‰å¾ˆå¤šé—®é¢˜</strong>:</p><ul><li>æ¯ä¸ªHooksåœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æ¸²æŸ“éƒ½è¦é‡æ–°åˆ›å»ºé—­åŒ…å’Œå¯¹è±¡</li><li>éœ€è¦ç†è§£é—­åŒ…å˜é‡</li><li>å†…å®¹å›è°ƒ/å¯¹è±¡ä¼šå¯¼è‡´çº¯ç»„ä»¶propsæ¯”å¯¹å¤±æ•ˆ, å¯¼è‡´ç»„ä»¶æ°¸è¿œæ›´æ–°</li></ul><p><br></p><p>é—­åŒ…å˜é‡é—®é¢˜æ˜¯ä½ æŒæ¡React Hooksè¿‡ç¨‹ä¸­çš„é‡è¦ä¸€å…³ã€‚é—­åŒ…é—®é¢˜æ˜¯æŒ‡ä»€ä¹ˆå‘¢ï¼Ÿä¸¾ä¸ªç®€å•çš„ä¾‹å­, Counter:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;: <span class="tag">&lt;<span class="name">ComplexButton</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncr&#125;</span>&gt;</span>increment<span class="tag">&lt;/<span class="name">ComplexButton</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾ComplexButtonæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç»„ä»¶ï¼Œæ¯ä¸€æ¬¡ç‚¹å‡»å®ƒï¼Œæˆ‘ä»¬ä¼šé€’å¢countï¼Œä»è€Œè§¦å‘ç»„å°†é‡æ–°æ¸²æŸ“ã€‚<strong>å› ä¸ºCounteræ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°ç”ŸæˆhandleIncrï¼Œæ‰€ä»¥ä¹Ÿä¼šå¯¼è‡´ComplexButtoné‡æ–°æ¸²æŸ“ï¼Œä¸ç®¡ComplexButtonä½¿ç”¨äº†<code>PureComponent</code>è¿˜æ˜¯ä½¿ç”¨<code>React.memo</code>åŒ…è£…</strong>ã€‚</p><p><br></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>Reactä¹Ÿæä¾›äº†ä¸€ä¸ª<code>useCallback</code> Hook, ç”¨æ¥â€˜ç¼“å­˜â€™å‡½æ•°, ä¿æŒå›è°ƒçš„ä¸å˜æ€§</strong>. æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;: <span class="tag">&lt;<span class="name">ComplexButton</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncr&#125;</span>&gt;</span>increment<span class="tag">&lt;/<span class="name">ComplexButton</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯æœ‰bugçš„ï¼Œä¸è¿‡æ€ä¹ˆç‚¹å‡»ï¼Œcountä¼šä¸€ç›´æ˜¾ç¤ºä¸º1ï¼</p><p>å†ä»”ç»†é˜…è¯»useCallbackçš„æ–‡æ¡£ï¼ŒuseCallbackæ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œå½“è¿™äº›å€¼å˜åŠ¨æ—¶æ›´æ–°ç¼“å­˜çš„å‡½æ•°, <strong>useCallbackçš„å†…éƒ¨é€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> memoFn, memoArgs</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useCallback</span>(<span class="params">fn, args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå˜åŠ¨åˆ™æ›´æ–°ç¼“å­˜å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (!isEqual(memoArgs, args)) &#123;</span><br><span class="line">    memoArgs = args</span><br><span class="line">    <span class="keyword">return</span> (memoFn = fn)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> memoFn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ok, ç°åœ¨ç†è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šä¸€ç›´æ˜¾ç¤º1ï¼Ÿ</p><p><img src="/images/react-hooks/usecallback.png" alt></p><p>é¦–æ¬¡æ¸²æŸ“æ—¶ç¼“å­˜äº†é—­åŒ…ï¼Œè¿™æ—¶å€™é—­åŒ…æ•è·çš„countå€¼æ˜¯0ã€‚åœ¨åç»­çš„é‡æ–°æ¸²æŸ“ä¸­ï¼Œå› ä¸ºuseCallbackç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„å€¼æ²¡æœ‰å˜åŠ¨ï¼ŒhandleIncré—­åŒ…ä¼šæ°¸è¿œè¢«ç¼“å­˜ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ¯æ¬¡ç‚¹å‡»ï¼Œcountåªèƒ½ä¸º1.</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œè®©æˆ‘ä»¬åœ¨countå˜åŠ¨æ—¶ï¼Œè®©useCallbackæ›´æ–°ç¼“å­˜å‡½æ•°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>)</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;&#123;count&#125;: &lt;ComplexButton onClick=&#123;handleIncr&#125;&gt;increment&lt;<span class="regexp">/ComplexButton&gt;&lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚æœuseCallbackä¾èµ–å¾ˆå¤šå€¼ï¼Œä½ çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š<code>useCallback(fn, [a, b, c, d, e])</code>. åæ­£æˆ‘æ˜¯æ— æ³•æ¥å—è¿™ç§ä»£ç çš„ï¼Œå¾ˆå®¹æ˜“é—æ¼, è€Œä¸”å¯ç»´æŠ¤æ€§å¾ˆå·®ï¼Œå°½ç®¡é€šè¿‡<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener">ESLintæ’ä»¶</a>å¯ä»¥æ£€æŸ¥è¿™äº›é—®é¢˜**ã€‚</p><p><br></p><p>å…¶å®é€šè¿‡<a href="https://reactjs.org/docs/hooks-reference.html#useref" target="_blank" rel="noopener"><code>useRef</code></a> Hookï¼Œå¯ä»¥è®©æˆ‘ä»¬åƒClassç»„ä»¶ä¸€æ ·ä¿å­˜ä¸€äº›â€˜å®ä¾‹å˜é‡â€™, Reactä¼šä¿è¯useRefè¿”å›å€¼çš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä»»ä½•åœ°æ–¹å®‰å…¨åœ°å¼•ç”¨refã€‚</p><p>åŸºäºè¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬å°è¯•å°è£…ä¸€ä¸ª<code>useRefState</code>, å®ƒåœ¨useStateçš„åŸºç¡€ä¸Šæ‰©å±•äº†ä¸€ä¸ªè¿”å›å€¼ï¼Œç”¨äºè·å–stateçš„æœ€æ–°å€¼:</p><p><br></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useCallback, Dispatch, SetStateAction, MutableRefObject &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRefState</span>(<span class="params">initialState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ins = useRef()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">typeof</span> initialState === <span class="string">'function'</span> ? initialState() : initialState</span><br><span class="line">    ins.current = value</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setValue = useCallback(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'function'</span>) &#123;</span><br><span class="line">      setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> finalValue = value(prevState)</span><br><span class="line">        ins.current = finalValue</span><br><span class="line">        <span class="keyword">return</span> finalValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ins.current = value</span><br><span class="line">      setState(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, setValue, ins]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount, countRef] = useRefState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(countRef.current + <span class="number">1</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨ç»„ä»¶å¸è½½æ—¶ä¿å­˜å½“å‰çš„count</span></span><br><span class="line">      saveCount(countRef.current)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;&#123;count&#125;: &lt;ComplexButton onClick=&#123;handleIncr&#125;&gt;increment&lt;<span class="regexp">/ComplexButton&gt;&lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://reactjs.org/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener"><code>useEffect</code></a>ã€<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo</code></a>å’Œ<code>useCallback</code>ä¸€æ ·å­˜åœ¨é—­åŒ…å˜é‡é—®é¢˜ï¼Œå®ƒä»¬å’ŒuseCallbackä¸€ä¸ªæ”¯æŒæŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œå½“è¿™ä¸ªå‚æ•°å˜åŒ–æ—¶æ‰§è¡Œå‰¯ä½œç”¨ã€‚</p></blockquote><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-5-1-æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—"><a href="#1-5-1-æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—" class="headerlink" title="1-5-1 æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—?"></a>1-5-1 æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—?</h4><p>å‡½æ•°ç»„ä»¶å’ŒClassç»„ä»¶ä¸ä¸€æ ·çš„æ˜¯ï¼Œå‡½æ•°ç»„ä»¶å°†æ‰€æœ‰çŠ¶æ€å’Œé€»è¾‘éƒ½æ”¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸­, æ¯ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¼šé‡å¤åˆ›å»ºå¤§é‡çš„é—­åŒ…ã€å¯¹è±¡ã€‚è€Œä¼ ç»Ÿçš„Classç»„ä»¶çš„renderå‡½æ•°åˆ™è¦ç®€æ´å¾ˆå¤šï¼Œä¸€èˆ¬åªæ”¾ç½®JSXæ¸²æŸ“é€»è¾‘ã€‚ç›¸æ¯”å¤§å®¶éƒ½è·Ÿæˆ‘ä¸€æ ·ï¼Œä¼šæ€€ç–‘å‡½æ•°ç»„ä»¶çš„æ€§èƒ½é—®é¢˜</p><p>æˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ˜¯æ€ä¹ˆå›åº”çš„ï¼š</p><p><img src="/images/react-hooks/fn-perf.png" alt></p><p><br></p><p>æˆ‘åœ¨SegmentFaultçš„<a href="https://segmentfault.com/q/1010000019644156/a-1020000019706666" target="_blank" rel="noopener"><strong>react functionç»„ä»¶ä¸classç»„ä»¶æ€§èƒ½é—®é¢˜</strong></a>ä¹Ÿè¿›è¡Œäº†è¯¦ç»†çš„å›ç­”, ç»“è®ºæ˜¯:</p><blockquote><p>ç›®å‰è€Œè¨€ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„æ•ˆç‡æ˜¯ä¸ç›¸ä¸Šä¸‹çš„ã€‚ä½†æ˜¯å‡½æ•°ç»„ä»¶æ˜¯æœªæ¥ï¼Œè€Œä¸”è¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼ŒReactå›¢é˜Ÿä¼šç»§ç»­ä¼˜åŒ–å®ƒã€‚è€Œç±»ç»„ä»¶ä¼šé€æ¸é€€å‡ºå†å²</p></blockquote><p>ä¸ºäº†æé«˜å‡½æ•°ç»„ä»¶çš„æ€§èƒ½ï¼Œå¯ä»¥åœ¨è¿™äº›åœ°æ–¹åšä¸€äº›<strong>ä¼˜åŒ–</strong>:</p><ul><li><p>èƒ½å¦å°†å‡½æ•°æå–ä¸ºé™æ€çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1ï¸âƒ£ä¾‹å¦‚å°†ä¸ä¾èµ–äºç»„ä»¶çŠ¶æ€çš„å›è°ƒæŠ½å–ä¸ºé™æ€æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> goback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  history.go(<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//const goback = () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//  history.go(-1)</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;goback&#125;</span>&gt;</span>back<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ï¸âƒ£ æŠ½ç¦»useStateçš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> returnEmptyObject = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> returnEmptyArray = <span class="function"><span class="params">()</span> =&gt;</span> []</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(returnEmptyObject)</span><br><span class="line">  <span class="keyword">const</span> [arr, setArr] = useState(returnEmptyArray)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç®€åŒ–ç»„ä»¶çš„å¤æ‚åº¦ï¼ŒåŠ¨é™åˆ†ç¦»</p></li><li>å†æ‹†åˆ†æ›´ç»†ç²’åº¦çš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä½¿ç”¨React.memoç¼“å­˜</li></ul><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-6-userefprops-å¼•ç”¨æœ€æ–°çš„props"><a href="#1-6-userefprops-å¼•ç”¨æœ€æ–°çš„props" class="headerlink" title="1-6 useRefProps å¼•ç”¨æœ€æ–°çš„Props"></a>1-6 useRefProps å¼•ç”¨æœ€æ–°çš„Props</h3><p>ç°å®é¡¹ç›®ä¸­ä¹Ÿæœ‰å¾ˆå¤šè¿™ç§åœºæ™¯: æˆ‘ä»¬æƒ³<strong>åœ¨ç»„ä»¶çš„ä»»ä½•åœ°æ–¹è·å–æœ€æ–°çš„propså€¼</strong>ï¼Œè¿™ä¸ªåŒæ ·å¯ä»¥é€šè¿‡useRefæ¥å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useRefProps</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: T</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;T&gt;(props)</span><br><span class="line">  <span class="comment">// æ¯æ¬¡é‡æ–°æ¸²æŸ“è®¾ç½®å€¼</span></span><br><span class="line">  ref.current = props</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ref</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyButton</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> propsRef = useRefProps(props)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ°¸ä¹…ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; onClick &#125; = propsRef.current</span><br><span class="line">    <span class="keyword">if</span> (onClick) &#123;</span><br><span class="line">      onClick()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ComplexButton</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">ComplexButton</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-7-useinstance-â€˜å®ä¾‹â€™å˜é‡å­˜å–"><a href="#1-7-useinstance-â€˜å®ä¾‹â€™å˜é‡å­˜å–" class="headerlink" title="1-7 useInstance â€˜å®ä¾‹â€™å˜é‡å­˜å–"></a>1-7 useInstance â€˜å®ä¾‹â€™å˜é‡å­˜å–</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>&lt;<span class="title">T</span>&gt;(<span class="params">initial?: T | (() =&gt; T)</span>): <span class="title">initial</span> <span class="title">is</span> (<span class="params"></span>) =&gt; <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> initial === <span class="string">'function'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useInstance</span>&lt;<span class="title">T</span> <span class="title">extends</span> </span>&#123;&#125;&gt;<span class="function">(<span class="params">initial?: T | (<span class="params">(<span class="params"></span>) =&gt; T</span>)</span>) &#123;</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">instance</span> = <span class="params">useRef</span>&lt;<span class="params">T</span>&gt;<span class="params">()</span></span></span><br><span class="line"><span class="function">  // åˆå§‹åŒ–</span></span><br><span class="line"><span class="function">  <span class="params">if</span> (<span class="params">instance.current == <span class="literal">null</span></span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params">initial</span>) &#123;</span></span><br><span class="line"><span class="function">      <span class="params">instance</span>.<span class="params">current</span> = <span class="params">isFunction</span>(<span class="params">initial</span>) ? <span class="params">initial</span><span class="params">()</span> : <span class="params">initial</span></span></span><br><span class="line"><span class="function">    &#125; <span class="params">else</span> &#123;</span></span><br><span class="line"><span class="function">      <span class="params">instance</span>.<span class="params">current</span> = &#123;&#125; <span class="params">as</span> <span class="params">T</span></span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> <span class="params">instance</span>.<span class="params">current</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// ---------</span></span><br><span class="line"><span class="function">// <span class="params">EXAMPLE</span></span></span><br><span class="line"><span class="function">// ---------</span></span><br><span class="line"><span class="function"><span class="params">function</span> <span class="params">Demo</span><span class="params">()</span> &#123;</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">inst</span> = <span class="params">useInstance</span>(<span class="params">&#123; count: 1 &#125;</span>)</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">update</span> = <span class="params">useForceUpdate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="params">useEffect</span>(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> timer = setInterval(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// åƒç±»ç»„ä»¶ä¸€æ ·ï¼Œè¿›è¡Œâ€˜å®ä¾‹å˜é‡â€™å­˜å‚¨</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// åœ¨å‡½æ•°ç»„ä»¶çš„ä»»æ„åœ°æ–¹å¼•ç”¨</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// åªä¸è¿‡æ›´æ–°è¿™äº›æ•°æ®ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      inst.count++</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;, 1000</span>)</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> (<span class="params"></span>) =&gt; clearInterval(<span class="params">timer</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      count: &#123;inst.count&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;button onClick=&#123;update&#125;&gt;åˆ·æ–°&lt;/button&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ä¸è¦æ»¥ç”¨</p></blockquote><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-9-useprevious-è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼"><a href="#1-9-useprevious-è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼" class="headerlink" title="1-9 usePrevious è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼"></a>1-9 usePrevious è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼</h3><p>åœ¨Classç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨<code>shouldComponentUpdate</code>æˆ–<code>componentDidUpdate</code>è¿™ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å¯¹propsæˆ–stateè¿›è¡Œæ¯”å¯¹ï¼Œæ¥å†³å®šåšæŸäº›äº‹æƒ…ï¼Œä¾‹å¦‚é‡æ–°å‘èµ·è¯·æ±‚ã€ç›‘å¬äº‹ä»¶ç­‰ç­‰.</p><p>Hooksä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨useEffectæˆ–useMemoæ¥å“åº”çŠ¶æ€å˜åŒ–ï¼Œè¿›è¡ŒçŠ¶æ€æˆ–å‰¯ä½œç”¨è¡ç”Ÿ. æ‰€ä»¥ä¸Šè¿°æ¯”å¯¹çš„åœºæ™¯åœ¨Hooksä¸­å¾ˆå°‘è§ã€‚ä½†ä¹Ÿä¸æ˜¯ä¸å¯èƒ½ï¼ŒReactå®˜æ–¹æ¡ˆä¾‹ä¸­å°±æœ‰ä¸€ä¸ª<code>usePrevious</code>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePrevious</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef();</span><br><span class="line">  <span class="comment">// useEffectä¼šåœ¨å®Œæˆè¿™æ¬¡'æ¸²æŸ“'ä¹‹åæ‰§è¡Œ</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ref.current = value;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> ref.current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="keyword">const</span> calculation = count * <span class="number">100</span>;</span><br><span class="line"><span class="keyword">const</span> prevCalculation = usePrevious(calculation);</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-10-useimmer-ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ"><a href="#1-10-useimmer-ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ" class="headerlink" title="1-10 useImmer ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ"></a>1-10 useImmer ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ</h3><p>è¿™ä¸ªæ¡ˆä¾‹æ¥æºäº<a href="https://github.com/immerjs/use-immer" target="_blank" rel="noopener">use-immer</a>, ç»“åˆ<a href="https://github.com/mweststrate/immer" target="_blank" rel="noopener">immer.js</a>å’ŒHooksæ¥ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ, çœ‹çœ‹ä»£ç ç¤ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [person, updatePerson] = useImmer(&#123;</span><br><span class="line">  name: <span class="string">"Michel"</span>,</span><br><span class="line">  age: <span class="number">33</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  updatePerson(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">    draft.name = name;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">becomeOlder</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  updatePerson(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">    draft.age++;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¹Ÿéå¸¸ç®€å•:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useImmer</span>(<span class="params">initialValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [val, updateValue] = useState(initialValue);</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    val,</span><br><span class="line">    useCallback(<span class="function"><span class="params">updater</span> =&gt;</span> &#123;</span><br><span class="line">      updateValue(produce(updater));</span><br><span class="line">    &#125;, [])</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç®€æ´çš„Hooksé…åˆç®€æ´çš„Immerï¼Œç®€ç›´å®Œç¾</strong></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-11-å°è£…â€™å·¥å…·hooksâ€™ç®€åŒ–stateçš„æ“ä½œ"><a href="#1-11-å°è£…â€™å·¥å…·hooksâ€™ç®€åŒ–stateçš„æ“ä½œ" class="headerlink" title="1-11 å°è£…â€™å·¥å…·Hooksâ€™ç®€åŒ–Stateçš„æ“ä½œ"></a>1-11 å°è£…â€™å·¥å…·Hooksâ€™ç®€åŒ–Stateçš„æ“ä½œ</h3><p>Hooksåªæ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥çµæ´»åœ°è‡ªå®šä¹‰ã€‚ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­ï¼Œåˆ©ç”¨è‡ªå®šä¹‰Hooksæ¥ç®€åŒ–å¸¸è§çš„æ•°æ®æ“ä½œåœºæ™¯</p><p><br></p><h4 id="1-11-1-usetoggle-å¼€å…³"><a href="#1-11-1-usetoggle-å¼€å…³" class="headerlink" title="1-11-1 useToggle å¼€å…³"></a>1-11-1 useToggle å¼€å…³</h4><p>å®ç°booleanå€¼åˆ‡æ¢</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useToggle</span>(<span class="params">initialValue?: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(!!initialValue)</span><br><span class="line">  <span class="keyword">const</span> toggler = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setValue(<span class="function"><span class="params">value</span> =&gt;</span> !value), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [value, toggler]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [enable, toggleEnable] = useToggle()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;Switch value=&#123;enable&#125; onClick=&#123;toggleEnable&#125;&gt;&lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-11-2-usearray-ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ"><a href="#1-11-2-usearray-ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ" class="headerlink" title="1-11-2 useArray ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ"></a>1-11-2 useArray ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ</h4><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useArray</span>&lt;<span class="title">T</span>&gt;(<span class="params">initial?: T[] | (() =&gt; T[]), idKey: <span class="built_in">string</span> = 'id'</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(initial || [])</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value,</span><br><span class="line">    setValue,</span><br><span class="line">    push: useCallback(<span class="function"><span class="params">a</span> =&gt;</span> setValue(<span class="function"><span class="params">v</span> =&gt;</span> [...v, a]), []),</span><br><span class="line">    clear: useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setValue(<span class="function"><span class="params">()</span> =&gt;</span> []), []),</span><br><span class="line">    removeById: useCallback(<span class="function"><span class="params">id</span> =&gt;</span> setValue(<span class="function"><span class="params">arr</span> =&gt;</span> arr.filter(<span class="function"><span class="params">v</span> =&gt;</span> v &amp;&amp; v[idKey] !== id)), []),</span><br><span class="line">    removeIndex: useCallback(</span><br><span class="line">      index =&gt;</span><br><span class="line">        setValue(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">          v.splice(index, <span class="number">1</span>)</span><br><span class="line">          <span class="keyword">return</span> v</span><br><span class="line">        &#125;),</span><br><span class="line">      [],</span><br><span class="line">    ),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;value, push, removeById&#125; = useArray&lt;&#123;id: <span class="built_in">number</span>, name: <span class="built_in">string</span>&#125;&gt;()</span><br><span class="line">  <span class="keyword">const</span> handleAdd = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    push(&#123;id: <span class="built_in">Math</span>.random(), name: getName()&#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;div&gt;&#123;value.map(<span class="function"><span class="params">i</span> =&gt;</span> &lt;span key=&#123;i.id&#125; onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> removeById(i.id)&#125;&gt;&#123;i.name&#125;&lt;<span class="regexp">/span&gt;)&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;button onClick=&#123;handleAdd&#125;&gt;add&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™äºç¯‡å¹…ï¼Œå…¶ä»–æ•°æ®ç»“æ„, ä¾‹å¦‚Setã€Map, å°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å‘æŒ¥æƒ³è±¡åŠ›.</p><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="2-æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°"><a href="#2-æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°" class="headerlink" title="2. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°"></a><strong>2. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong></h2><p>ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ“ä½œä¾èµ–äº<code>useEffect</code> Hook. <strong>Reactåœ¨å‡½æ•°ç»„ä»¶ä¸­åˆ»æ„æ·¡åŒ–äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œè€Œæ›´å…³æ³¨â€˜æ•°æ®çš„å“åº”â€™</strong>.</p><p><code>useEffect</code>åç§°æ„å›¾éå¸¸æ˜æ˜¾ï¼Œå°±æ˜¯<strong>ä¸“é—¨ç”¨æ¥ç®¡ç†ç»„ä»¶çš„å‰¯ä½œç”¨</strong>ã€‚å’ŒuseCallbackä¸€æ ·ï¼ŒuseEffectæ”¯æŒä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‘ŠçŸ¥Reactåœ¨è¿™äº›å€¼å‘ç”Ÿå˜åŠ¨æ—¶æ‰æ‰§è¡Œçˆ¶ä½œç”¨. åŸç†å¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> memoCallback = &#123;<span class="attr">fn</span>: <span class="literal">undefined</span>, <span class="attr">disposer</span>: <span class="literal">undefined</span>&#125;</span><br><span class="line"><span class="keyword">let</span> memoArgs</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">fn, args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå˜åŠ¨åˆ™æ‰§è¡Œå‰¯ä½œç”¨</span></span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span> || !isEqual(memoArgs, args)) &#123;</span><br><span class="line">    memoArgs = args</span><br><span class="line">    memoCallback.fn = fn</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¾è¿›é˜Ÿåˆ—ç­‰å¾…è°ƒåº¦æ‰§è¡Œ</span></span><br><span class="line">    pushIntoEffectQueue(memoCallback)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰¯ä½œç”¨æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªä¼šåœ¨ç»„ä»¶å®Œæˆæ¸²æŸ“ï¼Œåœ¨å¸ƒå±€(layout)å’Œç»˜åˆ¶(paint)ä¹‹åè¢«æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯useLayoutEffect, æ‰§è¡Œçš„æ—¶æœºä¼šæ›´æ—©ä¸€äº›</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queueExecute</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…ˆæ‰§è¡Œæ¸…ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (callback.disposer) &#123;</span><br><span class="line">    callback.disposer()</span><br><span class="line">  &#125;</span><br><span class="line">  callback.disposer = callback.fn()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å…³äºuseEffectå®˜ç½‘æœ‰è¯¦å°½çš„<a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener">æè¿°</a>; Dan Abramovä¹Ÿå†™äº†ä¸€ç¯‡<a href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">useEffect å®Œæ•´æŒ‡å—</a>, æ¨èğŸ‘ã€‚</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-1-useonmount-æ¨¡æ‹Ÿcomponentdidmount"><a href="#2-1-useonmount-æ¨¡æ‹Ÿcomponentdidmount" class="headerlink" title="2-1 useOnMount æ¨¡æ‹ŸcomponentDidMount"></a>2-1 useOnMount æ¨¡æ‹ŸcomponentDidMount</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useOnMount</span>(<span class="params">fn: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fn()</span><br><span class="line">  &#125;, []) <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º[], è¡¨ç¤ºä¸å¿…å¯¹ä»»ä½•æ•°æ®ï¼Œ æ‰€ä»¥åªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  useOnMount(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> loadList()</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">// log</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>å¦‚æœéœ€è¦åœ¨æŒ‚è½½/çŠ¶æ€æ›´æ–°æ—¶è¯·æ±‚ä¸€äº›èµ„æºã€å¹¶ä¸”éœ€è¦åœ¨å¸è½½æ—¶é‡Šæ”¾è¿™äº›èµ„æºï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨useEffectï¼Œå› ä¸ºè¿™äº›é€»è¾‘æœ€å¥½æ”¾åœ¨ä¸€èµ·, æ–¹ä¾¿ç»´æŠ¤å’Œç†è§£</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½†æ˜¯useEffectä¼ å…¥çš„å‡½æ•°ä¸æ”¯æŒasync/await(è¿”å›Promise)</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¯·æ±‚èµ„æº</span></span><br><span class="line">  <span class="keyword">const</span> subscription = props.source.subscribe();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscription.unsubscribe();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-2-useonunmount-æ¨¡æ‹Ÿcomponentwillunmount"><a href="#2-2-useonunmount-æ¨¡æ‹Ÿcomponentwillunmount" class="headerlink" title="2-2 useOnUnmount æ¨¡æ‹ŸcomponentWillUnmount"></a>2-2 useOnUnmount æ¨¡æ‹ŸcomponentWillUnmount</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useOnUnmount</span>(<span class="params">fn: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        fn()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-3-useonupdate-æ¨¡æ‹Ÿcomponentdidupdate"><a href="#2-3-useonupdate-æ¨¡æ‹Ÿcomponentdidupdate" class="headerlink" title="2-3 useOnUpdate æ¨¡æ‹ŸcomponentDidUpdate"></a>2-3 useOnUpdate æ¨¡æ‹ŸcomponentDidUpdate</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useOnUpdate</span>(<span class="params">fn: () =&gt; <span class="built_in">void</span>, dep?: <span class="built_in">any</span>[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef(&#123; fn, mounted: <span class="literal">false</span> &#125;)</span><br><span class="line">  ref.current.fn = fn</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é¦–æ¬¡æ¸²æŸ“ä¸æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (!ref.current.mounted) &#123;</span><br><span class="line">      ref.current.mounted = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ref.current.fn()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  useOnUpdate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dosomethingwith(props.a)</span><br><span class="line">  &#125;, [props.a])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;...&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>å…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„æ¨¡æ‹Ÿ:</p><ul><li><code>shouldComponentUpdate</code> - React.memoåŒ…è£¹ç»„ä»¶</li><li><code>componentDidCatch</code> - æš‚ä¸æ”¯æŒ</li></ul><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="3-äº‹ä»¶å¤„ç†"><a href="#3-äº‹ä»¶å¤„ç†" class="headerlink" title="3. äº‹ä»¶å¤„ç†"></a><strong>3. äº‹ä»¶å¤„ç†</strong></h2><h3 id="3-1-usechange-ç®€åŒ–onchangeè¡¨å•åŒå‘ç»‘å®š"><a href="#3-1-usechange-ç®€åŒ–onchangeè¡¨å•åŒå‘ç»‘å®š" class="headerlink" title="3-1 useChange ç®€åŒ–onChangeè¡¨å•åŒå‘ç»‘å®š"></a>3-1 useChange ç®€åŒ–onChangeè¡¨å•åŒå‘ç»‘å®š</h3><p>è¡¨å•å€¼çš„åŒå‘ç»‘å®šåœ¨é¡¹ç›®ä¸­éå¸¸å¸¸è§ï¼Œé€šå¸¸æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = useCallback&lt;React.ChangeEventHandler&lt;HTMLInputElement&gt;&gt;(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    setValue(evt.target.value)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;input value=&#123;value&#125; onChange=&#123;handleChange&#125; /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ç»´æŠ¤å¤šä¸ªè¡¨å•ï¼Œè¿™ç§ä»£ç å°±ä¼šå˜å¾—éš¾ä»¥æ¥å—ã€‚å¹¸å¥½æœ‰Hooksï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–è¿™äº›ä»£ç :</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useChange</span>&lt;<span class="title">S</span>&gt;(<span class="params">initial?: S | (() =&gt; S)</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;S | <span class="literal">undefined</span>&gt;(initial)</span><br><span class="line">  <span class="keyword">const</span> onChange = useCallback(<span class="function"><span class="params">e</span> =&gt;</span> setValue(e.target.value), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value,</span><br><span class="line">    setValue,</span><br><span class="line">    onChange,</span><br><span class="line">    <span class="comment">// ç»‘å®šåˆ°åŸç”Ÿäº‹ä»¶</span></span><br><span class="line">    bindEvent: &#123;</span><br><span class="line">      onChange,</span><br><span class="line">      value,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç»‘å®šåˆ°è‡ªå®šä¹‰ç»„ä»¶</span></span><br><span class="line">    bind: &#123;</span><br><span class="line">      onChange: setValue,</span><br><span class="line">      value,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> userName = useChange(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">const</span> password = useChange(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input &#123;...userName.bindEvent&#125; /&gt;</span><br><span class="line">      &lt;input <span class="keyword">type</span>=<span class="string">"password"</span> &#123;...password.bindEvent&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-2-usebind-ç»‘å®šå›è°ƒå‚æ•°"><a href="#3-2-usebind-ç»‘å®šå›è°ƒå‚æ•°" class="headerlink" title="3-2 useBind ç»‘å®šå›è°ƒå‚æ•°"></a>3-2 useBind ç»‘å®šå›è°ƒå‚æ•°</h3><p>ç»‘å®šä¸€äº›å›è°ƒå‚æ•°ï¼Œå¹¶åˆ©ç”¨useMemoç»™ä¸‹çº§ä¼ é€’ä¸€ä¸ªç¼“å­˜çš„å›è°ƒ, é¿å…é‡æ–°æ¸²æŸ“:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useBind</span>(<span class="params">fn?: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>, ...args: <span class="built_in">any</span>[]</span>): (<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt; <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;fn &amp;&amp; fn.bind(<span class="literal">null</span>, ...args)&#125;, args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;id, onClick&#125; = props</span><br><span class="line">  <span class="keyword">const</span> handleClick = useBind(onClick, id)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;ComplexComponent onClick=&#123;handleClick&#125;&gt;&lt;<span class="regexp">/ComplexComponent&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ç­‰ä»·äº</span></span><br><span class="line"><span class="regexp">function Demo(props) &#123;</span></span><br><span class="line"><span class="regexp">  const &#123;id, onClick&#125; = props</span></span><br><span class="line"><span class="regexp">  const handleClick = useCallback(() =&gt; onClick(id), [id])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return &lt;ComplexComponent onClick=&#123;handleClick&#125;&gt;&lt;/</span>ComplexComponent&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-3-è‡ªå®šä¹‰äº‹ä»¶å°è£…"><a href="#3-3-è‡ªå®šä¹‰äº‹ä»¶å°è£…" class="headerlink" title="3-3 è‡ªå®šä¹‰äº‹ä»¶å°è£…"></a>3-3 è‡ªå®šä¹‰äº‹ä»¶å°è£…</h3><p>Hooksä¹Ÿå¯ä»¥ç”¨äºå°è£…ä¸€äº›é«˜çº§äº‹ä»¶æˆ–è€…ç®€åŒ–äº‹ä»¶çš„å¤„ç†ï¼Œæ¯”å¦‚æ‹–æ‹½ã€æ‰‹åŠ¿ã€é¼ æ ‡Active/Hoverç­‰ç­‰ï¼›</p><p><br></p><h4 id="3-3-1-useactive"><a href="#3-3-1-useactive" class="headerlink" title="3-3-1 useActive"></a>3-3-1 useActive</h4><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­, useActive, åœ¨é¼ æ ‡æŒ‰ä¸‹æ—¶è®¾ç½®çŠ¶æ€ä¸ºtrueï¼Œé¼ æ ‡é‡Šæ”¾æ—¶æ¢å¤ä¸ºfalse:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useActive</span>(<span class="params">refEl: React.RefObject&lt;HTMLElement&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="literal">false</span>)</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleMouseDown = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setValue(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handleMouseUp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setValue(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DOM äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (refEl &amp;&amp; refEl.current) &#123;</span><br><span class="line">      refEl.current.addEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line">      refEl.current.addEventListener(<span class="string">'mouseup'</span>, handleMouseUp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (refEl &amp;&amp; refEl.current) &#123;</span><br><span class="line">        refEl.current.removeEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line">        refEl.current.removeEventListener(<span class="string">'mouseup'</span>, handleMouseUp)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> elRef = useRef(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> active = useActive(inputRef)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div ref=&#123;elRef&#125;&gt;&#123;active ? <span class="string">"Active"</span> : <span class="string">"Nop"</span>&#125;&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="3-3-2-usetouch-æ‰‹åŠ¿äº‹ä»¶å°è£…"><a href="#3-3-2-usetouch-æ‰‹åŠ¿äº‹ä»¶å°è£…" class="headerlink" title="3-3-2 useTouch æ‰‹åŠ¿äº‹ä»¶å°è£…"></a>3-3-2 useTouch æ‰‹åŠ¿äº‹ä»¶å°è£…</h4><p>æ›´å¤æ‚çš„è‡ªå®šä¹‰äº‹ä»¶, ä¾‹å¦‚æ‰‹åŠ¿ã€‚é™äºç¯‡å¹…å°±ä¸åˆ—ä¸¾å®ƒä»¬çš„å®ç°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å®ƒä»¬çš„Demo:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;ref&#125; = useTouch(&#123;</span><br><span class="line">    onTap: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">/* ç‚¹å‡» */</span> &#125;,</span><br><span class="line">    onLongTap: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">/* é•¿æŒ‰ */</span> &#125;,</span><br><span class="line">    onRotate: <span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">/* æ—‹è½¬ */</span>&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div className=<span class="string">"box"</span> ref=&#123;ref&#125;&gt;&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>useTouchçš„å®ç°å¯ä»¥å‚è€ƒ<a href="https://github.com/GDJiaMi/hooks/blob/master/src/useTouch.ts" target="_blank" rel="noopener">useTouch.ts</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="3-3-3-usedraggable-æ‹–æ‹½äº‹ä»¶å°è£…"><a href="#3-3-3-usedraggable-æ‹–æ‹½äº‹ä»¶å°è£…" class="headerlink" title="3-3-3 useDraggable æ‹–æ‹½äº‹ä»¶å°è£…"></a>3-3-3 useDraggable æ‹–æ‹½äº‹ä»¶å°è£…</h4><p>æ‹–æ‹½ä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„è‡ªå®šä¹‰äº‹ä»¶, ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥æºäº<a href="https://stackblitz.com/edit/usedraggable" target="_blank" rel="noopener">è¿™é‡Œ</a></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useDraggable</span>(<span class="params">ref: React.RefObject&lt;HTMLElement&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [&#123; dx, dy &#125;, setOffset] = useState(&#123; dx: <span class="number">0</span>, dy: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ref.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`[useDraggable] refæœªæ³¨å†Œåˆ°ç»„ä»¶ä¸­`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> el = ref.current</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleMouseDown = <span class="function">(<span class="params">event: MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> startX = event.pageX - dx</span><br><span class="line">      <span class="keyword">const</span> startY = event.pageY - dy</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> handleMouseMove = <span class="function">(<span class="params">event: MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> newDx = event.pageX - startX</span><br><span class="line">        <span class="keyword">const</span> newDy = event.pageY - startY</span><br><span class="line">        setOffset(&#123; dx: newDx, dy: newDy &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">document</span>.addEventListener(<span class="string">'mousemove'</span>, handleMouseMove)</span><br><span class="line">      <span class="built_in">document</span>.addEventListener(</span><br><span class="line">        <span class="string">'mouseup'</span>,</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">          <span class="built_in">document</span>.removeEventListener(<span class="string">'mousemove'</span>, handleMouseMove)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; once: <span class="literal">true</span> &#125;,</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    el.addEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      el.removeEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [dx, dy])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ref.current) &#123;</span><br><span class="line">      ref.current.style.transform = <span class="string">`translate3d(<span class="subst">$&#123;dx&#125;</span>px, <span class="subst">$&#123;dy&#125;</span>px, 0)`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [dx, dy])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el = useRef();</span><br><span class="line">  useDraggable(el);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;div className=<span class="string">"box"</span> ref=&#123;el&#125; /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è¿è¡Œ<a href="https://stackblitz.com/edit/usedraggable" target="_blank" rel="noopener">ä¾‹å­</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="3-3-4-react-events-é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…"><a href="#3-3-4-react-events-é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…" class="headerlink" title="3-3-4 react-events é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…"></a>3-3-4 react-events é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…</h4><p>æˆ‘åœ¨<a href="https://juejin.im/post/5d44e3745188255d5861d654" target="_blank" rel="noopener">&lt;è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)&gt;</a>ä»‹ç»äº†<code>React-Events</code>è¿™ä¸ª<strong>å®éªŒæ€§</strong>çš„APIã€‚å½“è¿™ä¸ªAPIæˆç†Ÿåï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºå®ƒæ¥å®ç°æ›´ä¼˜é›…çš„é«˜çº§äº‹ä»¶çš„å°è£…ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PressResponder, usePressListener &#125; <span class="keyword">from</span> <span class="string">'react-events/press'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  <span class="keyword">const</span> listener = usePressListener(&#123;  <span class="comment">// âš›ï¸ é€šè¿‡hooksåˆ›å»ºResponder</span></span><br><span class="line">    onPressStart,</span><br><span class="line">    onPress,</span><br><span class="line">    onPressEnd,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div listeners=&#123;listener&#125;&gt;</span><br><span class="line">      &#123;subtrees&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-4-usesubscription-é€šç”¨äº‹ä»¶æºè®¢é˜…"><a href="#3-4-usesubscription-é€šç”¨äº‹ä»¶æºè®¢é˜…" class="headerlink" title="3-4 useSubscription é€šç”¨äº‹ä»¶æºè®¢é˜…"></a>3-4 useSubscription é€šç”¨äº‹ä»¶æºè®¢é˜…</h3><p>Reactå®˜æ–¹ç»´æŠ¤äº†ä¸€ä¸ª<a href="https://github.com/facebook/react/tree/master/packages/use-subscription" target="_blank" rel="noopener">use-subscription</a>åŒ…ï¼Œæ”¯æŒä½¿ç”¨Hooksçš„å½¢å¼æ¥ç›‘å¬äº‹ä»¶æº. äº‹ä»¶æºå¯ä»¥æ˜¯DOMäº‹ä»¶ã€RxJSçš„Observableç­‰ç­‰.</p><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›‘å¬rxjs behaviorSubject</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> subscription = useMemo(</span><br><span class="line">    () =&gt; (&#123;</span><br><span class="line">      getCurrentValue: <span class="function"><span class="params">()</span> =&gt;</span> behaviorSubject.getValue(),</span><br><span class="line">      subscribe: <span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å½“äº‹ä»¶è§¦å‘æ—¶è°ƒç”¨callback</span></span><br><span class="line">        <span class="keyword">const</span> subscription = behaviorSubject.subscribe(callback);</span><br><span class="line">        <span class="comment">// å’ŒuseEffectä¸€æ ·ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°æ¥å–æ¶ˆè®¢é˜…</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> subscription.unsubscribe();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// åœ¨behaviorSubjectå˜åŒ–åé‡æ–°è®¢é˜…</span></span><br><span class="line">    [behaviorSubject]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = useSubscription(subscription);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¥çœ‹çœ‹å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useSubscription</span>&lt;<span class="title">T</span>&gt;(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  getCurrentValue,</span></span></span><br><span class="line"><span class="function"><span class="params">  subscribe,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// è·å–å½“å‰å€¼</span></span></span></span><br><span class="line"><span class="function"><span class="params">  getCurrentValue?: () =&gt; T</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// ç”¨äºè®¢é˜…äº‹ä»¶æº</span></span></span></span><br><span class="line"><span class="function"><span class="params">  subscribe: (callback: <span class="built_in">Function</span>) =&gt; () =&gt; <span class="built_in">void</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(<span class="function"><span class="params">()</span> =&gt;</span> (&#123; getCurrentValue, subscribe, value: getCurrentValue() &#125;))</span><br><span class="line">  <span class="keyword">let</span> valueToReturn = state.value</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–°getCurrentValueå’Œsubscribe</span></span><br><span class="line">  <span class="keyword">if</span> (state.getCurrentValue !== getCurrentValue || state.subscribe !== subscribe) &#123;</span><br><span class="line">    valueToReturn = getCurrentValue()</span><br><span class="line">    setState(&#123; getCurrentValue, subscribe, value: valueToReturn &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> didUnsubscribe = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> checkForUpdates = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (didUnsubscribe) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥getCurrentValueå’Œsubscribeæ˜¯å¦å˜åŠ¨</span></span><br><span class="line">        <span class="comment">// setStateæ—¶å¦‚æœè¿”å›å€¼æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“</span></span><br><span class="line">        <span class="keyword">if</span> (prevState.getCurrentValue !== getCurrentValue || prevState.subscribe !== subscribe) &#123;</span><br><span class="line">          <span class="keyword">return</span> prevState</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å€¼æ²¡å˜åŠ¨</span></span><br><span class="line">        <span class="keyword">const</span> value = getCurrentValue()</span><br><span class="line">        <span class="keyword">if</span> (prevState.value === value) &#123;</span><br><span class="line">          <span class="keyword">return</span> prevState</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123; ...prevState, value &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> unsubscribe = subscribe(checkForUpdates)</span><br><span class="line">    checkForUpdates()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      didUnsubscribe = <span class="literal">true</span></span><br><span class="line">      unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [getCurrentValue, subscribe])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> valueToReturn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¹Ÿä¸å¤æ‚ï¼Œç”šè‡³å¯ä»¥è¯´æœ‰ç‚¹å•°å—¦.</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-5-useobservable-hookså’Œrxjsä¼˜é›…çš„ç»“åˆ-rxjs-hooks"><a href="#3-5-useobservable-hookså’Œrxjsä¼˜é›…çš„ç»“åˆ-rxjs-hooks" class="headerlink" title="3-5 useObservable Hookså’ŒRxJSä¼˜é›…çš„ç»“åˆ(rxjs-hooks)"></a>3-5 useObservable Hookså’ŒRxJSä¼˜é›…çš„ç»“åˆ(rxjs-hooks)</h3><p>å¦‚æœè¦é…åˆRxJSä½¿ç”¨ï¼ŒLeetCodeå›¢é˜Ÿå°è£…äº†ä¸€ä¸ª<a href="https://github.com/LeetCode-OpenSource/rxjs-hooks/blob/master/README.md" target="_blank" rel="noopener">rxjs-hooks</a>åº“ï¼Œç”¨èµ·æ¥åˆ™è¦ä¼˜é›…å¾ˆå¤š, éå¸¸æ¨è:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> value = useObservable(<span class="function"><span class="params">()</span> =&gt;</span> interval(<span class="number">500</span>).pipe(map(<span class="function">(<span class="params">val</span>) =&gt;</span> val * <span class="number">3</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Incremental <span class="built_in">number</span>: &#123;value&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-6-useeventemitter-å¯¹æ¥eventemitter"><a href="#3-6-useeventemitter-å¯¹æ¥eventemitter" class="headerlink" title="3-6 useEventEmitter å¯¹æ¥eventEmitter"></a>3-6 useEventEmitter å¯¹æ¥eventEmitter</h3><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-3" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a>è¿™ç¯‡æ–‡ç« é‡Œé¢æè¿‡ï¼š<strong>è‡ªå®šä¹‰ hook å’Œå‡½æ•°ç»„ä»¶çš„ä»£ç ç»“æ„åŸºæœ¬ä¸€è‡´, æ‰€ä»¥æœ‰æ—¶å€™hooks å†™ç€å†™ç€åŸæ¥è¶Šåƒç»„ä»¶, ç»„ä»¶å†™ç€å†™ç€è¶Šåƒ hooks. æˆ‘è§‰å¾—å¯ä»¥è®¤ä¸ºç»„ä»¶å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ hook, åªä¸è¿‡å®ƒè¾“å‡º Virtual DOM</strong></p><p>Hooksè·Ÿç»„ä»¶ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘å’ŒçŠ¶æ€çš„èšåˆå•å…ƒã€‚å¯ä»¥ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ã€æœ‰è‡ªå·±çš„â€™ç”Ÿå‘½å‘¨æœŸâ€™.</p><p><code>useEventEmitter</code>å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå¯ä»¥ç‹¬ç«‹åœ°ç»´æŠ¤å’Œé‡Šæ”¾è‡ªå·±çš„èµ„æº:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="function"><span class="keyword">function</span><span class="title">ReturnObject</span> = (<span class="params"></span>) =&gt; (<span class="params">&#123;&#125;</span>)</span></span><br><span class="line"><span class="function"><span class="title">const</span> <span class="function"><span class="keyword">function</span><span class="title">ReturnArray</span> = (<span class="params"></span>) =&gt; []</span></span></span><br><span class="line"><span class="function"><span class="function"></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="title">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useEventEmitter</span>(<span class="params">emmiter: EventEmitter</span>) </span>&#123;</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">disposers</span> = <span class="title">useRef</span>&lt;<span class="title">Function</span>[]&gt;(<span class="params">[]</span>)</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">listeners</span> = <span class="title">useRef</span>&lt;</span>&#123; [<span class="title">name</span>: <span class="title">string</span>]: <span class="title">Function</span> &#125;&gt;(<span class="params">&#123;&#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">const</span> <span class="title">on</span> = <span class="title">useCallback</span>(<span class="params">&lt;P&gt;(name: <span class="built_in">string</span>, cb: (data: P) =&gt; <span class="built_in">void</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">if</span> (!(name <span class="keyword">in</span> listeners.current)) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">const</span> call = (...args: <span class="built_in">any</span>[]) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> fn = listeners.current[name]</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">if</span> (fn) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">          fn(...args)</span></span></span><br><span class="line"><span class="function"><span class="params">        &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="comment">// ç›‘å¬eventEmitter</span></span></span></span><br><span class="line"><span class="function"><span class="params">      emmiter.on(name, call)</span></span></span><br><span class="line"><span class="function"><span class="params">      disposers.current.push(() =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        emmiter.off(name, call)</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;)</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    listeners.current[name] = cb</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">useEffect</span>(<span class="params">() =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// èµ„æºé‡Šæ”¾</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> () =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      disposers.current.forEach(i =&gt; i())</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">return</span> </span>&#123;</span><br><span class="line">    on,</span><br><span class="line">    emit: emmiter.emit,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; on, emit &#125; = useEventEmitter(eventBus)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº‹ä»¶ç›‘å¬</span></span><br><span class="line">  on(<span class="string">'someEvent'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// äº‹ä»¶è§¦å‘</span></span><br><span class="line">    emit(<span class="string">'anotherEvent'</span>, someData)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div onClick=&#123;handleClick&#125;&gt;...&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><p>æ›´å¤šè„‘æ´ï¼š</p><ul><li><a href="https://github.com/mfrachet/use-socketio" target="_blank" rel="noopener">use-socketio</a></li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="4-contextçš„å¦™ç”¨"><a href="#4-contextçš„å¦™ç”¨" class="headerlink" title="4. Contextçš„å¦™ç”¨"></a><strong>4. Contextçš„å¦™ç”¨</strong></h2><p>é€šè¿‡<a href="https://reactjs.org/docs/hooks-reference.html#usecontext" target="_blank" rel="noopener"><code>useContext</code></a>å¯ä»¥æ–¹ä¾¿åœ°å¼•ç”¨Contextã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¸Šçº§<code>Context.Provider</code>çš„valueå˜åŒ–ï¼Œä½¿ç”¨useContextçš„ç»„ä»¶å°±ä¼šè¢«å¼ºåˆ¶é‡æ–°æ¸²æŸ“ã€‚</p><h3 id="4-1-usetheme-ä¸»é¢˜é…ç½®"><a href="#4-1-usetheme-ä¸»é¢˜é…ç½®" class="headerlink" title="4-1 useTheme ä¸»é¢˜é…ç½®"></a>4-1 useTheme ä¸»é¢˜é…ç½®</h3><p>åŸæœ¬éœ€è¦ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ³¨å…¥æˆ–Context.Consumerè·å–çš„Contextå€¼ï¼Œç°åœ¨å˜å¾—éå¸¸ç®€æ´ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼ ç»Ÿæ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// é€šè¿‡é«˜é˜¶ç»„ä»¶æ³¨å…¥</span></span><br><span class="line">withTheme(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–åˆ©ç”¨Context.Consumer</span></span><br><span class="line"><span class="keyword">const</span> MyComponentWithTheme = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;ThemeContext.Consumer&gt;</span><br><span class="line">    &#123;<span class="function"><span class="params">value</span> =&gt;</span> &lt;MyComponent theme=&#123;value&#125; &#123;...props&#125;&gt;&lt;<span class="regexp">/MyComponent&gt;&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>ThemeContext.Consumer&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hooksæ–¹å¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useContext, FC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext&lt;object&gt;(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeProvider: FC&lt;&#123; theme: object &#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;ThemeContext.Provider value=&#123;props.theme&#125;&gt;&#123;props.children&#125;&lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export function useTheme&lt;T extends object&gt;(): T &#123;</span></span><br><span class="line"><span class="regexp">  return useContext(ThemeContext)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ---------</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ EXAMPLE</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ---------</span></span><br><span class="line"><span class="regexp">const theme = &#123;</span></span><br><span class="line"><span class="regexp">  primary: '#000',</span></span><br><span class="line"><span class="regexp">  secondary: '#444',</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ThemeProvider theme=&#123;theme&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;...&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/ThemeProvider&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Button: FC = props =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const t = useTheme&lt;typeof theme&gt;()</span></span><br><span class="line"><span class="regexp">  const style = &#123;</span></span><br><span class="line"><span class="regexp">    color: t.primary,</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  return &lt;button style=&#123;style&#125;&gt;&#123;props.children&#125;&lt;/</span>button&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-2-unstated-ç®€å•çŠ¶æ€ç®¡ç†å™¨"><a href="#4-2-unstated-ç®€å•çŠ¶æ€ç®¡ç†å™¨" class="headerlink" title="4-2 unstated ç®€å•çŠ¶æ€ç®¡ç†å™¨"></a>4-2 unstated ç®€å•çŠ¶æ€ç®¡ç†å™¨</h3><p>Hooks + Context ä¹Ÿå¯ä»¥ç”¨äºå®ç°ç®€å•çš„çŠ¶æ€ç®¡ç†ã€‚</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5ce3ee436fb9a07f070e0220#heading-2" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“05 - çŠ¶æ€ç®¡ç†</a>å°±æåˆ°è¿‡<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fjamiebuilds%2Funstated-next" target="_blank" rel="noopener">unstated-next</a>ï¼Œ è¿™ä¸ªåº“åªæœ‰ä¸»ä½“ä»£ç åå‡ è¡Œï¼Œ<strong>åˆ©ç”¨äº†Reactæœ¬èº«çš„æœºåˆ¶æ¥å®ç°çŠ¶æ€ç®¡ç†</strong>.</p><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> &#123; createContainer &#125; <span class="keyword">from</span> <span class="string">"unstated-next"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useCounter</span>(<span class="params">initialState = 0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = useState(initialState)</span><br><span class="line">  <span class="keyword">let</span> decrement = <span class="function"><span class="params">()</span> =&gt;</span> setCount(count - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> increment = <span class="function"><span class="params">()</span> =&gt;</span> setCount(count + <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123; count, decrement, increment &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Counter = createContainer(useCounter)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CounterDisplay</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> counter = Counter.useContainer()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;counter.decrement&#125;&gt;-&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;&#123;counter.count&#125;&lt;/</span>span&gt;</span><br><span class="line">      &lt;button onClick=&#123;counter.increment&#125;&gt;+&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹å®ƒçš„æºç :</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createContainer</span>(<span class="params">useHook</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åªæ˜¯åˆ›å»ºä¸€ä¸ªContext</span></span><br><span class="line"><span class="keyword">let</span> Context = React.createContext(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> value = useHook(props.initialState)</span><br><span class="line"><span class="keyword">return</span> &lt;Context.Provider value=&#123;value&#125;&gt;&#123;props.children&#125;&lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function useContainer() &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ åªæ˜¯ä½¿ç”¨useContext</span></span><br><span class="line"><span class="regexp">let value = React.useContext(Context)</span></span><br><span class="line"><span class="regexp">if (value === null) &#123;</span></span><br><span class="line"><span class="regexp">throw new Error("Component must be wrapped with &lt;Container.Provider&gt;")</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">return value</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">return &#123; Provider, useContainer &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export function useContainer(container) &#123;</span></span><br><span class="line"><span class="regexp">return container.useContainer()</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œä½ ä¼šè¯´ï¼Œæˆ‘é ï¼Œå°±è¿™æ ·? è¿™ä¸ªåº“æ„Ÿè§‰å•¥äº‹æƒ…éƒ½æ²¡å¹²å•Š?</p><p>éœ€è¦æ³¨æ„çš„æ˜¯, <strong>Contextä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œå®ƒä½œä¸ºçŠ¶æ€ç®¡ç†æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„ç¼ºé™·</strong>ï¼Œæˆ‘åœ¨<a href="https://juejin.im/post/5d045350f265da1b695d5bf2#heading-14" target="_blank" rel="noopener">æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a>æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹:<br><strong>å®ƒæ˜¯å¯ä»¥ç©¿é€React.memoæˆ–è€…shouldComponentUpdateçš„æ¯”å¯¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdate</strong></p><p>æ‰€ä»¥å¦‚æœä½ æ‰“ç®—ä½¿ç”¨Contextä½œä¸ºçŠ¶æ€ç®¡ç†ï¼Œä¸€å®šè¦æ³¨æ„è§„é¿è¿™ä¸€ç‚¹. å®ƒå¯èƒ½ä¼šå¯¼è‡´ç»„ä»¶é¢‘ç¹é‡æ–°æ¸²æŸ“.</p><p><br></p><p>å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ:</p><ul><li><a href="https://github.com/ctrlplusb/easy-peasy" target="_blank" rel="noopener">easy-peasy</a></li><li><a href="https://github.com/dai-shi/react-hooks-global-state" target="_blank" rel="noopener">react-hooks-global-state</a></li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-3-usei18n-å›½é™…åŒ–"><a href="#4-3-usei18n-å›½é™…åŒ–" class="headerlink" title="4-3 useI18n å›½é™…åŒ–"></a>4-3 useI18n å›½é™…åŒ–</h3><p>I18næ˜¯å¦ä¸€ä¸ªContextçš„å…¸å‹ä½¿ç”¨åœºæ™¯ã€‚<a href="https://github.com/formatjs/react-intl/blob/master/docs/API.md#useintl-hook-currently-available-in-300-beta" target="_blank" rel="noopener">react-intl</a>å’Œ<a href="https://react.i18next.com/latest/usetranslation-hook" target="_blank" rel="noopener">react-i18next</a>éƒ½ä¸æ—¶ä¿±è¿›ï¼Œæ¨å‡ºäº†è‡ªå·±çš„Hook API, <strong>åŸºæœ¬ä¸ŠåŸæœ¬ä½¿ç”¨é«˜é˜¶ç»„ä»¶(HOC)å®ç°çš„åŠŸèƒ½éƒ½å¯ä»¥ç”¨Hooksä»£æ›¿ï¼Œè®©ä»£ç å˜å¾—æ›´åŠ ç®€æ´</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useTranslation &#125; <span class="keyword">from</span> <span class="string">'react-i18next'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; t, i18n &#125; = useTranslation();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;t('my translated text')&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-4-userouter-ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®"><a href="#4-4-userouter-ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®" class="headerlink" title="4-4 useRouter ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®"></a>4-4 useRouter ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®</h3><p>React Hooks æ¨å‡ºå·²ç»æ¥è¿‘ä¸€å¹´ï¼ŒReactRouterç«Ÿç„¶è¿˜æ²¡æœ‰æ­£å¼æ¨å‡ºHook APIã€‚ä¸è¿‡å®ƒä»¬ä¹Ÿæä¸Šäº†è®¡åˆ’ â€”â€” <a href="https://reacttraining.com/blog/reach-react-router-future/" target="_blank" rel="noopener">The Future of React Router and @reach/router</a>ï¼Œ5.Xç‰ˆæœ¬ä¼šæ¨å‡ºHook API. æˆ‘ä»¬æš‚æ—¶å…ˆçœ‹çœ‹ä¸€äº›ä»£ç ç¤ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¿é—®è·¯ç”±å˜é‡</span></span><br><span class="line">  <span class="keyword">const</span> &#123; userId &#125; = useParams()</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePageViews</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¿é—®locationå¯¹è±¡</span></span><br><span class="line">  <span class="comment">// åŸæœ¬å¯¹äºéè·¯ç”±ç»„ä»¶ï¼Œéœ€è¦è®¿é—®è·¯ç”±ä¿¡æ¯éœ€è¦é€šè¿‡withRouteré«˜é˜¶ç»„ä»¶æ³¨å…¥</span></span><br><span class="line">  <span class="keyword">const</span> &#123; location &#125; = useLocation()</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>, location.pathname)</span><br><span class="line">  &#125;, [location])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ç­‰ç­‰å§!</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-5-react-hook-form-hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±"><a href="#4-5-react-hook-form-hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±" class="headerlink" title="4-5 react-hook-form Hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±?"></a>4-5 react-hook-form Hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±?</h3><p><a href="https://github.com/react-hook-form/react-hook-form" target="_blank" rel="noopener">react-hook-form</a>æ˜¯Hooks+Formçš„å…¸å‹æ¡ˆä¾‹ï¼Œæ¯”è¾ƒç¬¦åˆæˆ‘ç†æƒ³ä¸­çš„è¡¨å•ç®¡ç†æ–¹å¼:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useForm <span class="keyword">from</span> <span class="string">'react-hook-form'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; register, handleSubmit, errors &#125; = useForm(); <span class="comment">// initialise the hook</span></span><br><span class="line">  <span class="keyword">const</span> onSubmit = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;; <span class="comment">// callback when validation pass</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;handleSubmit(onSubmit)&#125;&gt;</span><br><span class="line">      &lt;input name=<span class="string">"firstname"</span> ref=&#123;register&#125; /&gt; &#123;<span class="comment">/* register an input */</span>&#125;</span><br><span class="line">      </span><br><span class="line">      &lt;input name=<span class="string">"lastname"</span> ref=&#123;register(&#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;)&#125; /&gt;</span><br><span class="line">      &#123;errors.lastname &amp;&amp; <span class="string">'Last name is required.'</span>&#125;</span><br><span class="line">      </span><br><span class="line">      &lt;input name=<span class="string">"age"</span> ref=&#123;register(&#123; <span class="attr">pattern</span>: <span class="regexp">/\d+/</span> &#125;)&#125; /&gt;</span><br><span class="line">      &#123;errors.age &amp;&amp; <span class="string">'Please enter number for age.'</span>&#125;</span><br><span class="line">      </span><br><span class="line">      &lt;input type=<span class="string">"submit"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="5-å‰¯ä½œç”¨å°è£…"><a href="#5-å‰¯ä½œç”¨å°è£…" class="headerlink" title="5. å‰¯ä½œç”¨å°è£…"></a><strong>5. å‰¯ä½œç”¨å°è£…</strong></h2><p>æˆ‘ä»¬å¯ä»¥<strong>åˆ©ç”¨Hooksæ¥å°è£…æˆ–ç›‘å¬ç»„ä»¶å¤–éƒ¨çš„å‰¯ä½œç”¨ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºç»„ä»¶çš„çŠ¶æ€</strong>ã€‚</p><p><br></p><h3 id="5-1-usetimeout-è¶…æ—¶ä¿®æ”¹çŠ¶æ€"><a href="#5-1-usetimeout-è¶…æ—¶ä¿®æ”¹çŠ¶æ€" class="headerlink" title="5-1 useTimeout è¶…æ—¶ä¿®æ”¹çŠ¶æ€"></a>5-1 useTimeout è¶…æ—¶ä¿®æ”¹çŠ¶æ€</h3><p>useTimeoutç”±ç”¨æˆ·è§¦å‘ï¼Œåœ¨æŒ‡å®šæ—¶é—´åæ¢å¤çŠ¶æ€. æ¯”å¦‚å¯ä»¥ç”¨äºâ€™çŸ­æœŸç¦ç”¨â€™æŒ‰é’®, é¿å…é‡å¤ç‚¹å‡»:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [disabled, start] = useTimeout(<span class="number">5000</span>)</span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    start()</span><br><span class="line">    dosomething()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;Button onClick=&#123;handleClick&#125; disabled=&#123;disabled&#125;&gt;ç‚¹æˆ‘&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTimeout</span>(<span class="params">ms: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [ready, setReady] = useState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> timerRef = useRef&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> start = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearTimeout(timerRef.current)</span><br><span class="line">    setReady(<span class="literal">true</span>)</span><br><span class="line">    timerRef.current = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setReady(<span class="literal">false</span>)</span><br><span class="line">    &#125;, ms)</span><br><span class="line">  &#125;, [ms])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stop = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearTimeout(timeRef.current)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useOnUnmount(stop)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [ready, start, stop]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-2-useonlinestatus-ç›‘å¬åœ¨çº¿çŠ¶æ€"><a href="#5-2-useonlinestatus-ç›‘å¬åœ¨çº¿çŠ¶æ€" class="headerlink" title="5-2 useOnlineStatus ç›‘å¬åœ¨çº¿çŠ¶æ€"></a>5-2 useOnlineStatus ç›‘å¬åœ¨çº¿çŠ¶æ€</h3><p>å‰¯ä½œç”¨å°è£…ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„æ¡ˆä¾‹å°±æ˜¯ç›‘å¬ä¸»æœºçš„åœ¨çº¿çŠ¶æ€ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOnlineStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> navigator.onLine === <span class="string">'boolean'</span> ? navigator.onLine : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useOnlineStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [onlineStatus, setOnlineStatus] = useState(getOnlineStatus())</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> online = <span class="function"><span class="params">()</span> =&gt;</span> setOnlineStatus(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> offline = <span class="function"><span class="params">()</span> =&gt;</span> setOnlineStatus(<span class="literal">false</span>)</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'online'</span>, online)</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'offline'</span>, offline)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">'online'</span>, online)</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">'offline'</span>, offline)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> onlineStatus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> onlineStatus = useOnlineStatus();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;ç½‘ç»œçŠ¶æ€: &#123;onlineStatus ? <span class="string">"åœ¨çº¿"</span> : <span class="string">"ç¦»çº¿"</span>&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿˜æœ‰å¾ˆå¤šæ¡ˆä¾‹, è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•å»å®ç°ï¼Œæ¯”å¦‚:</p><ul><li>useDeviceOrientation ç›‘å¬è®¾å¤‡æ–¹å‘</li><li>useGeolocation ç›‘å¬GPSåæ ‡å˜åŒ–</li><li>useScrollPosition ç›‘å¬æ»šåŠ¨ä½ç½®</li><li>useMotion ç›‘å¬è®¾å¤‡è¿åŠ¨</li><li>useMediaDevice ç›‘å¬åª’ä½“è®¾å¤‡</li><li>useDarkMode å¤œé—´æ¨¡å¼ç›‘å¬</li><li>useKeyBindings ç›‘å¬å¿«æ·é”®</li><li>â€¦.</li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="6-å‰¯ä½œç”¨è¡ç”Ÿ"><a href="#6-å‰¯ä½œç”¨è¡ç”Ÿ" class="headerlink" title="6. å‰¯ä½œç”¨è¡ç”Ÿ"></a><strong>6. å‰¯ä½œç”¨è¡ç”Ÿ</strong></h2><p><strong>å’Œ<code>å‰¯ä½œç”¨å°è£…</code>ç›¸åï¼Œå‰¯ä½œç”¨è¡ç”Ÿæ˜¯æŒ‡å½“ç»„ä»¶çŠ¶æ€å˜åŒ–æ—¶ï¼Œè¡ç”Ÿå‡ºå…¶ä»–å‰¯ä½œç”¨. ä¸¤è€…çš„æ–¹å‘æ˜¯ç›¸åçš„</strong>.</p><p>å‰¯ä½œç”¨è¡ç”Ÿä¸»è¦ä¼šç”¨åˆ°useEffectï¼Œä½¿ç”¨useEffectæ¥å“åº”çŠ¶æ€çš„å˜åŒ–.</p><h3 id="6-1-usetitle-è®¾ç½®æ–‡æ¡£title"><a href="#6-1-usetitle-è®¾ç½®æ–‡æ¡£title" class="headerlink" title="6-1 useTitle è®¾ç½®æ–‡æ¡£title"></a>6-1 useTitle è®¾ç½®æ–‡æ¡£title</h3><p>useTitleæ˜¯æœ€ç®€å•çš„ï¼Œå½“ç»™å®šçš„å€¼å˜åŒ–æ—¶ï¼Œæ›´æ–°<code>document.title</code></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTitle</span>(<span class="params">t: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = t</span><br><span class="line">  &#125;, [t])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  useTitle(props.isEdit ? <span class="string">'ç¼–è¾‘'</span> : <span class="string">'æ–°å¢'</span>)</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-2-usedebounce"><a href="#6-2-usedebounce" class="headerlink" title="6-2 useDebounce"></a>6-2 useDebounce</h3><p>å†æ¥ä¸ªå¤æ‚ä¸€ç‚¹çš„ï¼ŒuseDebounceï¼šå½“æŸäº›çŠ¶æ€å˜åŒ–æ—¶ï¼Œå®ƒä¼šå»¶è¿Ÿæ‰§è¡ŒæŸäº›æ“ä½œï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useDebounce</span>(<span class="params">fn: () =&gt; <span class="built_in">void</span>, args?: <span class="built_in">any</span>[], ms: <span class="built_in">number</span> = 100, skipMount?: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> mounted = useRef(<span class="literal">false</span>)</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è·³è¿‡æŒ‚è½½æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (skipMount &amp;&amp; !mounted.current) &#123;</span><br><span class="line">      mounted.current = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> timer = setTimeout(fn, ms)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœargså˜åŒ–ï¼Œå…ˆæ¸…é™¤è®¡æ—¶å™¨</span></span><br><span class="line">      clearTimeout(timer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="keyword">const</span> returnEmptyArray = <span class="function"><span class="params">()</span> =&gt;</span> []</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = useState(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState(returnEmptyArray)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æœç´¢</span></span><br><span class="line">  <span class="keyword">const</span> handleSearch = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    setList(<span class="keyword">await</span> fetchList(query))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“queryå˜åŒ–æ—¶æ‰§è¡Œæœç´¢</span></span><br><span class="line">  useDebounce(handleSearch, [query], <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;SearchBar value=&#123;query&#125; onChange=&#123;setQuery&#125; /&gt;</span><br><span class="line">    &lt;Result list=&#123;list&#125;&gt;&lt;<span class="regexp">/Result&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-3-usethrottle"><a href="#6-3-usethrottle" class="headerlink" title="6-3 useThrottle"></a>6-3 useThrottle</h3><p>åŒç†å¯ä»¥å®ç°useThrottle, ä¸‹é¢çš„ä¾‹å­æ¥æºäº<a href="https://github.com/streamich/react-use/blob/master/src/useThrottleFn.ts" target="_blank" rel="noopener">react-use</a>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useThrottleFn = &lt;T&gt;<span class="function">(<span class="params">fn: (<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt; T, ms: <span class="built_in">number</span> = 200, args: <span class="built_in">any</span>[]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState&lt;T&gt;(<span class="literal">null</span> <span class="keyword">as</span> <span class="built_in">any</span>);</span><br><span class="line">  <span class="keyword">const</span> timeout = useRef&lt;<span class="built_in">any</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> nextArgs = useRef(<span class="literal">null</span>) <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">  <span class="keyword">const</span> hasNextArgs = useRef(<span class="literal">false</span>) <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!timeout.current) &#123;</span><br><span class="line">      setState(fn(...args));</span><br><span class="line">      <span class="keyword">const</span> timeoutCallback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasNextArgs.current) &#123;</span><br><span class="line">          hasNextArgs.current = <span class="literal">false</span>;</span><br><span class="line">          setState(fn(...nextArgs.current));</span><br><span class="line">          timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          timeout.current = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      nextArgs.current = args;</span><br><span class="line">      hasNextArgs.current = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, args);</span><br><span class="line"></span><br><span class="line">  useOnUnmount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearTimeout(timeout.current);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="7-ç®€åŒ–ä¸šåŠ¡é€»è¾‘"><a href="#7-ç®€åŒ–ä¸šåŠ¡é€»è¾‘" class="headerlink" title="7. ç®€åŒ–ä¸šåŠ¡é€»è¾‘"></a><strong>7. ç®€åŒ–ä¸šåŠ¡é€»è¾‘</strong></h2><p><strong>80%çš„ç¨‹åºå‘˜80%çš„æ—¶é—´åœ¨å†™ä¸šåŠ¡ä»£ç </strong>. æœ‰äº†Hooksï¼ŒReactå¼€å‘è€…å¦‚è·è‡³å®. ç»„ä»¶çš„ä»£ç å¯ä»¥å˜å¾—å¾ˆç²¾ç®€ï¼Œä¸”è¿™äº›Hookså¯ä»¥æ–¹ä¾¿åœ°åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨:</p><p><img src="/images/react-hooks/hooks-transform.png" alt></p><p><br></p><p>ä¸‹é¢ä»‹ç»ï¼Œå¦‚ä½•åˆ©ç”¨Hooksæ¥ç®€åŒ–ä¸šåŠ¡ä»£ç </p><h3 id="7-1-usepromise-å°è£…å¼‚æ­¥è¯·æ±‚"><a href="#7-1-usepromise-å°è£…å¼‚æ­¥è¯·æ±‚" class="headerlink" title="7-1 usePromise å°è£…å¼‚æ­¥è¯·æ±‚"></a>7-1 usePromise å°è£…å¼‚æ­¥è¯·æ±‚</h3><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œè¯•è¯•å°è£…ä¸€ä¸‹promiseï¼Œç®€åŒ–ç®€å•é¡µé¢å¼‚æ­¥è¯·æ±‚çš„æµç¨‹. å…ˆæ¥çœ‹çœ‹usePromiseçš„ä½¿ç”¨ç¤ºä¾‹ï¼Œæˆ‘ç†æƒ³ä¸­çš„usePromiseåº”è¯¥é•¿è¿™æ ·:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Demo() &#123;</span><br><span class="line">  const list = usePromise(async (id: string) =&gt; &#123;</span><br><span class="line">    return fetchList(id)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return (&lt;div&gt;</span><br><span class="line">    &#123;/* è§¦å‘è¯·æ±‚ */&#125;</span><br><span class="line">    &lt;button onClick=&#123;() =&gt; list.callIgnoreError(&apos;myId&apos;)&#125;&gt;Get List&lt;/button&gt;</span><br><span class="line">    &#123;/* é”™è¯¯ä¿¡æ¯å±•ç¤ºå’Œé‡è¯• */&#125;</span><br><span class="line">    &#123;!!list.error &amp;&amp; &lt;ErrorMessage error=&#123;list.error&#125; retry=&#123;list.retry&#125;&gt;åŠ è½½å¤±è´¥:&lt;/ErrorMessage&gt;&#125;</span><br><span class="line">    &#123;/* åŠ è½½çŠ¶æ€ */&#125;</span><br><span class="line">    &lt;Loader loading=&#123;list.loading&#125;&gt;</span><br><span class="line">      &#123;/* è¯·æ±‚ç»“æœ */&#125;</span><br><span class="line">      &lt;Result value=&#123;list.value&#125;&gt;&lt;/Result&gt;</span><br><span class="line">    &lt;/Loader&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>usePromiseæ˜¯æˆ‘ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¸€ä¸ªHooksï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒå®Œæ•´çš„ä»£ç ï¼ŒåŒ…æ‹¬Typescriptæ³¨è§£éƒ½è´´å‡ºæ¥ï¼Œä¾›å¤§å®¶å‚è€ƒå‚è€ƒ:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰usePromiseçš„è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Res&lt;T, S&gt; &#123;</span><br><span class="line">  loading: <span class="built_in">boolean</span></span><br><span class="line">  error?: <span class="built_in">Error</span></span><br><span class="line">  value?: S</span><br><span class="line">  setValue: <span class="function">(<span class="params">v: S</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  call: T</span><br><span class="line">  callIgnoreError: T</span><br><span class="line">  reset: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  retry: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰usePromise å‚æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UsePromiseOptions &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœpromiseæ­£åœ¨åŠ è½½ä¸­åˆ™è·³è¿‡ï¼Œé»˜è®¤ä¸ºtrue</span></span><br><span class="line">  skipOnLoading?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‡ ä¸‹é¢æ˜¯ä¸€å †Typescriptå‡½æ•°é‡è½½å£°æ˜ï¼Œä¸ºäº†æ–¹ä¾¿Typescriptæ¨æ–­æ³›å‹å˜é‡. å°ç™½å¯ä»¥è·³è¿‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>&gt;(<span class="params">action: () =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params"></span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>&gt;(<span class="params">action: (arg0: A) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">B</span>&gt;(<span class="params">action: (arg0: A, arg1: B) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A, arg1: B</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>&gt;(<span class="params"> action: (arg0: A, arg1: B, arg2: C) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A, arg1: B, arg2: C</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>&gt;(<span class="params">action: (arg0: A, arg1: B, arg2: C, arg3: D) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A, arg1: B, arg2: C, arg3: D</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>(<span class="params">action: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">...args: <span class="built_in">any</span></span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">any</span>&gt;, <span class="title">any</span>&gt;</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">// ğŸ‘† ä¸Šé¢æ˜¯ä¸€å †<span class="title">Typescript</span>å‡½æ•°é‡è½½å£°æ˜ï¼Œå¯ä»¥è·³è¿‡</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">/**</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"> * æ¥å—ä¸€ä¸ª<span class="title">action</span>ï¼Œç”¨äºæ‰§è¡Œå¼‚æ­¥æ“ä½œ</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"> */</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>(<span class="params"></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  action: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;,</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  option: UsePromiseOptions = &#123; skipOnLoading: <span class="literal">true</span> &#125;,</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span>): <span class="title">Res</span>&lt;(<span class="params">...args: <span class="built_in">any</span></span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">any</span>&gt;, <span class="title">any</span>&gt; </span>&#123;</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">actionRef</span> = <span class="title">useRefProps</span>(<span class="params">action</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">optionRef</span> = <span class="title">useRefProps</span>(<span class="params">option</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> [<span class="title">loading</span>, <span class="title">setLoading</span>, <span class="title">loadingRef</span>] = <span class="title">useRefState</span>(<span class="params"><span class="literal">false</span></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">taskIdRef</span> = <span class="title">useRef</span>&lt;<span class="title">number</span>&gt;(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">argsRef</span> = <span class="title">useRef</span>&lt;<span class="title">any</span>[]&gt;(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> [<span class="title">value</span>, <span class="title">setValue</span>] = <span class="title">useState</span>(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> [<span class="title">error</span>, <span class="title">setError</span>, <span class="title">errorRef</span>] = <span class="title">useRefState</span>&lt;<span class="title">Error</span> | <span class="title">undefined</span>&gt;(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">caller</span> = <span class="title">useCallback</span>(<span class="params"><span class="keyword">async</span> (...args: <span class="built_in">any</span>[]) =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    argsRef.current = args</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">if</span> (loadingRef.current &amp;&amp; optionRef.current.skipOnLoading) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">const</span> taskId = getUid()</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    taskIdRef.current = taskId</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="comment">// å·²ç»æœ‰æ–°çš„ä»»åŠ¡åœ¨æ‰§è¡Œäº†ï¼Œä»€ä¹ˆéƒ½ä¸åš</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">const</span> shouldContinue = () =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (taskId !== taskIdRef.current) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        <span class="keyword">return</span> <span class="literal">false</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span> <span class="literal">true</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">try</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      setLoading(<span class="literal">true</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      setError(<span class="literal">undefined</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">const</span> res = <span class="keyword">await</span> actionRef.current(...args)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (!shouldContinue()) <span class="keyword">return</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      setValue(res)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span> res</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125; <span class="keyword">catch</span> (err) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (shouldContinue()) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        setError(err)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">throw</span> err</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125; <span class="keyword">finally</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (shouldContinue()) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        setLoading(<span class="literal">false</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  &#125;, []</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  // ä¸æŠ›å‡ºå¼‚å¸¸</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">callIgnoreError</span> = <span class="title">useCallback</span>(<span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">async</span> (...args: <span class="built_in">any</span>[]) =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">try</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        <span class="keyword">return</span> <span class="keyword">await</span> caller(...args)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125; <span class="keyword">catch</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        <span class="comment">// ignore</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;,</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    [caller],</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  </span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">reset</span> = <span class="title">useCallback</span>(<span class="params">() =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    setLoading(<span class="literal">false</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    setValue(<span class="literal">undefined</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    setError(<span class="literal">undefined</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  &#125;, []</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  // å¤±è´¥åé‡è¯•</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">retry</span> = <span class="title">useCallback</span>(<span class="params">() =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">if</span> (argsRef.current &amp;&amp; errorRef.current) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span> callIgnoreError(...argsRef.current)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(`not call yet`)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  &#125;, []</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">return</span> </span>&#123;</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">loading</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">error</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">call</span>: <span class="title">caller</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">callIgnoreError</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">value</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">setValue</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">reset</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">retry</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  &#125;</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">&#125;</span></span></span></span></span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-2-usepromiseeffect-è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚"><a href="#7-2-usepromiseeffect-è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚" class="headerlink" title="7-2 usePromiseEffect è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚"></a>7-2 usePromiseEffect è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚</h3><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯åœ¨ç»„ä»¶ä¸€æŒ‚è½½æˆ–è€…æŸäº›çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨è¿›è¡Œä¸€æ­¥è¯·æ±‚çš„ï¼Œæˆ‘ä»¬åœ¨usePromiseçš„åŸºç¡€ä¸Šï¼Œç»“åˆuseEffectæ¥å®ç°è‡ªåŠ¨è°ƒç”¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸ºäº†ç¼©çŸ­ç¯‡å¹…ï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘è·ŸusePromiseä¸€æ ·çš„å‡½æ•°é‡è½½äº†</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">usePromiseEffect</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  action: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">Promise</span>&lt;T&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  args?: <span class="built_in">any</span>[],</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prom = usePromise(action)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨useEffectç›‘å¬å‚æ•°å˜åŠ¨å¹¶æ‰§è¡Œ</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    prom.callIgnoreError.apply(<span class="literal">null</span>, args)</span><br><span class="line">  &#125;, args)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> prom</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åœ¨æŒ‚è½½æˆ–è€…idå˜åŒ–æ—¶è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">const</span> list = usePromiseEffect(<span class="function">(<span class="params">id</span>) =&gt;</span> fetchById(id), [id])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒusePromise</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œåº”è¯¥æƒŠå¹Hooksçš„æŠ½è±¡èƒ½åŠ›äº†å§ï¼ğŸ˜¸</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-3-useinfinitelist-å®ç°æ— é™åŠ è½½åˆ—è¡¨"><a href="#7-3-useinfinitelist-å®ç°æ— é™åŠ è½½åˆ—è¡¨" class="headerlink" title="7-3 useInfiniteList å®ç°æ— é™åŠ è½½åˆ—è¡¨"></a>7-3 useInfiniteList å®ç°æ— é™åŠ è½½åˆ—è¡¨</h3><p>è¿™é‡Œä¾‹å­åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹ŸæåŠè¿‡</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useInfiniteList</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  fn: (params: &#123; offset: <span class="built_in">number</span>; pageSize: <span class="built_in">number</span>; list: T[] &#125;) =&gt; <span class="built_in">Promise</span>&lt;T[]&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pageSize: <span class="built_in">number</span> = 20,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;T[]&gt;(returnEmptyArray)</span><br><span class="line">  <span class="comment">// åˆ—è¡¨æ˜¯å¦å…¨éƒ¨åŠ è½½å®Œæ¯•</span></span><br><span class="line">  <span class="keyword">const</span> [hasMore, setHasMore, hasMoreRef] = useRefState(<span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// åˆ—è¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">  <span class="keyword">const</span> [empty, setEmpty] = useState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> promise = usePromise(<span class="function"><span class="params">()</span> =&gt;</span> fn(&#123; list, offset: list.length, pageSize &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> load = useCallback(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!hasMoreRef.current) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> promise.call()</span><br><span class="line">    <span class="keyword">if</span> (res.length &lt; pageSize) &#123;</span><br><span class="line">      setHasMore(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setList(<span class="function"><span class="params">l</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.length === <span class="number">0</span> &amp;&amp; l.length === <span class="number">0</span>) &#123;</span><br><span class="line">        setEmpty(<span class="literal">true</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> [...l, ...res]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºåˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> clean = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setList([])</span><br><span class="line">    setHasMore(<span class="literal">true</span>)</span><br><span class="line">    setEmpty(<span class="literal">false</span>)</span><br><span class="line">    promise.reset()</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ·æ–°åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> refresh = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clean()</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      load()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    list,</span><br><span class="line">    hasMore,</span><br><span class="line">    empty,</span><br><span class="line">    loading: promise.loading,</span><br><span class="line">    error: promise.error,</span><br><span class="line">    load,</span><br><span class="line">    refresh,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Item &#123;</span><br><span class="line">  id: <span class="built_in">number</span></span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; load, list, hasMore, refresh &#125; = useInfiniteList&lt;Item&gt;<span class="function">(<span class="params"><span class="keyword">async</span> (<span class="params">&#123; offset, pageSize &#125;</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> list = []</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">for</span> (<span class="params"><span class="keyword">let</span> i = offset; i &lt; offset + pageSize; i++</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">if</span> (<span class="params">i === 200</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">break</span></span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      list.push(<span class="params">&#123; id: i, name: `$&#123;i&#125;-----` &#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> list</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">useEffect</span>(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    load(<span class="params"></span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;div className="App"&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;button onClick=&#123;refresh&#125;&gt;Refresh&lt;/button&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#123;list.map(<span class="params">i =&gt; (<span class="params"></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">        &lt;div key=&#123;i.id&#125;&gt;&#123;i.name&#125;&lt;/div&gt;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">      </span>)</span>)&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#123;hasMore ? &lt;button onClick=&#123;load&#125;&gt;Load more&lt;/button&gt; : &lt;div&gt;No more&lt;/div&gt;&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-4-usepoll-ç”¨hookå®ç°è½®è¯¢"><a href="#7-4-usepoll-ç”¨hookå®ç°è½®è¯¢" class="headerlink" title="7-4 usePoll ç”¨hookå®ç°è½®è¯¢"></a>7-4 usePoll ç”¨hookå®ç°è½®è¯¢</h3><p>ä¸‹é¢ä½¿ç”¨Hookså®ç°ä¸€ä¸ªå®šæ—¶è½®è¯¢å™¨</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UsePollOptions&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å†³å®šæ˜¯å¦è¦ç»§ç»­è½®è¯¢</span></span><br><span class="line"><span class="comment">   * @param arg ä¸Šä¸€æ¬¡è½®è¯¢è¿”å›çš„å€¼</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  condition: <span class="function">(<span class="params">arg?: T, error?: <span class="built_in">Error</span></span>) =&gt;</span> <span class="built_in">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è½®è¯¢æ“ä½œ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  poller: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Promise</span>&lt;T&gt;</span><br><span class="line">  onError?: <span class="function">(<span class="params">err: <span class="built_in">Error</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è½®è¯¢é—´éš”. é»˜è®¤ 5000</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  duration?: <span class="built_in">number</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç›‘å¬çš„å‚æ•°ï¼Œå½“è¿™äº›å‚æ•°å˜åŒ–æ—¶ï¼Œé‡æ–°æ£€æŸ¥è½®è¯¢æ¡ä»¶ï¼Œå†³å®šæ˜¯å¦ç»§ç»­è½®è¯¢</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  args?: <span class="built_in">any</span>[]</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ˜¯å¦ç«‹å³è½®è¯¢</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  immediately?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ç°é¡µé¢è½®è¯¢æœºåˆ¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">usePoll</span>&lt;<span class="title">T</span> = <span class="title">any</span>&gt;(<span class="params">options: UsePollOptions&lt;T&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [polling, setPolling, pollingRef] = useRefState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState&lt;<span class="built_in">Error</span>&gt;()</span><br><span class="line">  <span class="keyword">const</span> state = useInstance&lt;&#123; timer?: <span class="built_in">number</span>; unmounted?: <span class="built_in">boolean</span> &#125;&gt;(&#123;&#125;)</span><br><span class="line">  <span class="keyword">const</span> optionsRef = useRefProps(options)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> poll = useCallback(<span class="keyword">async</span> (immediate?: <span class="built_in">boolean</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å·²ç»å¸è½½ï¼Œæˆ–å…¶ä»–è½®è¯¢å™¨æ­£åœ¨è½®è¯¢</span></span><br><span class="line">    <span class="keyword">if</span> (state.unmounted || pollingRef.current) <span class="keyword">return</span></span><br><span class="line">    setPolling(<span class="literal">true</span>)</span><br><span class="line">    state.timer = <span class="built_in">window</span>.setTimeout(</span><br><span class="line">      <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (state.unmounted) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> res: T | <span class="literal">undefined</span></span><br><span class="line">          <span class="keyword">let</span> error: <span class="built_in">Error</span> | <span class="literal">undefined</span></span><br><span class="line">          setError(<span class="literal">undefined</span>)</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            res = <span class="keyword">await</span> optionsRef.current.poller()</span><br><span class="line">          &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            error = err</span><br><span class="line">            setError(err)</span><br><span class="line">            <span class="keyword">if</span> (optionsRef.current.onError) &#123;</span><br><span class="line">              optionsRef.current.onError(err)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å‡†å¤‡ä¸‹ä¸€æ¬¡è½®è¯¢</span></span><br><span class="line">          <span class="keyword">if</span> (!state.unmounted &amp;&amp; (<span class="keyword">await</span> optionsRef.current.condition(res, error))) &#123;</span><br><span class="line">            setTimeout(poll)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          !state.unmounted &amp;&amp; setPolling(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      immediate ? <span class="number">0</span> : optionsRef.current.duration || <span class="number">5000</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useOnUpdate(</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> optionsRef.current.condition()) poll(options.immediately)</span><br><span class="line">    &#125;,</span><br><span class="line">    options.args || [],</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  useOnUnmount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    state.unmounted = <span class="literal">true</span></span><br><span class="line">    clearTimeout(state.timer)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; polling, error &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = useState(<span class="string">')</span></span><br><span class="line"><span class="string">  const [result, setResult] = useState&lt;Result&gt;()</span></span><br><span class="line"><span class="string">  usePoll(&#123;</span></span><br><span class="line"><span class="string">    poller: await() =&gt; &#123;</span></span><br><span class="line"><span class="string">      const res =await fetch(query)</span></span><br><span class="line"><span class="string">      setResult(res)</span></span><br><span class="line"><span class="string">      return res</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    condition: async () =&gt; &#123;</span></span><br><span class="line"><span class="string">      return query !== '</span><span class="string">'</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    args: [query],</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // ...</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-5-ä¸šåŠ¡é€»è¾‘æŠ½ç¦»"><a href="#7-5-ä¸šåŠ¡é€»è¾‘æŠ½ç¦»" class="headerlink" title="7-5 ä¸šåŠ¡é€»è¾‘æŠ½ç¦»"></a>7-5 ä¸šåŠ¡é€»è¾‘æŠ½ç¦»</h3><p>é€šè¿‡ä¸Šé¢çš„æ¡ˆä¾‹å¯ä»¥çœ‹åˆ°, Hookséå¸¸é€‚åˆç”¨äºæŠ½ç¦»é‡å¤çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>åœ¨<a href="https://juejin.im/post/5cd8fb916fb9a03218556fc1#heading-6" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“02 - ç»„ä»¶çš„ç»„ç»‡</a>ä»‹ç»äº†å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»ï¼ŒHooksæ—¶ä»£ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥è‡ªç„¶åœ°å°†é€»è¾‘éƒ½æ”¾ç½®åˆ°Hooksä¸­ï¼Œå®ç°é€»è¾‘å’Œè§†å›¾çš„åˆ†ç¦»</strong>ã€‚</p><p>æŠ½ç¦»çš„åä¸šåŠ¡é€»è¾‘å¯ä»¥å¤ç”¨äºä¸åŒçš„â€™å±•ç¤ºå¹³å°â€™, ä¾‹å¦‚ web ç‰ˆå’Œ native ç‰ˆ:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Login/</span><br><span class="line">  useLogin.ts   // å°†æ‰€æœ‰é€»è¾‘éƒ½æŠ½å–åˆ°Hooksä¸­</span><br><span class="line">  index.web.tsx // åªä¿ç•™è§†å›¾</span><br><span class="line">  index.tsx</span><br></pre></td></tr></table></figure><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="8-å¼€è„‘æ´"><a href="#8-å¼€è„‘æ´" class="headerlink" title="8. å¼€è„‘æ´"></a><strong>8. å¼€è„‘æ´</strong></h2><p>ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ï¼Œä¸çŸ¥é“æ€ä¹ˆåˆ†ç±»ã€‚ä½œè€…æƒ³è±¡åŠ›éå¸¸ä¸°å¯Œ!</p><h3 id="8-1-usescript-hooks-suspend-â¤ï¸"><a href="#8-1-usescript-hooks-suspend-â¤ï¸" class="headerlink" title="8-1 useScript: Hooks + Suspend = â¤ï¸"></a>8-1 useScript: Hooks + Suspend = â¤ï¸</h3><p>è¿™ä¸ªæ¡ˆä¾‹æ¥æºäº<a href="https://github.com/palmerhq/the-platform#usescript" target="_blank" rel="noopener">the-platform</a>, ä½¿ç”¨scriptæ ‡ç­¾æ¥åŠ è½½å¤–éƒ¨è„šæœ¬:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„: è¿™è¿˜æ˜¯å®éªŒæ€§ç‰¹æ€§</span></span><br><span class="line"><span class="keyword">import</span> &#123;createResource&#125; <span class="keyword">from</span> <span class="string">'react-cache'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ScriptResource = createResource(<span class="function">(<span class="params">src: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    script.src = src;</span><br><span class="line">    script.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(script);</span><br><span class="line">    script.onerror = reject;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useScript</span>(<span class="params">options: &#123; src: <span class="built_in">string</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ScriptResource.read(src);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useScript &#125; <span class="keyword">from</span> <span class="string">'the-platform'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Example = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   useScript(&#123; src: <span class="string">'bundle.js'</span> &#125;);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Suspend</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;Suspense fallback=&#123;<span class="string">'loading...'</span>&#125;&gt;&lt;Example&gt;&lt;<span class="regexp">/Example&gt;&lt;/</span>Suspense&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†è¿˜å¯ä»¥å®ç°</p><ul><li><a href="https://github.com/palmerhq/the-platform/blob/master/src/Stylesheet.tsx" target="_blank" rel="noopener">useStylesheet</a> ç”¨äºåŠ è½½æ ·å¼è¡¨</li><li><a href="https://github.com/CharlesStover/fetch-suspense" target="_blank" rel="noopener">fetch-suspense</a></li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="8-2-usemodal-æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†"><a href="#8-2-usemodal-æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†" class="headerlink" title="8-2 useModal æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†"></a>8-2 useModal æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†</h3><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-6" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a>ä¹Ÿä¸¾åˆ°ä¸€ä¸ªä½¿ç”¨<code>Hooks + Context</code>æ¥å·§å¦™å®ç°æ¨¡æ€æ¡†ç®¡ç†çš„ä¾‹å­ã€‚</p><p>å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Contextæ¥æ¸²æŸ“æ¨¡æ€æ¡†, å¾ˆç®€å•, ModalContext.Providerç»™ä¸‹çº§ç»„ä»¶æš´éœ²ä¸€ä¸ªrenderæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥ä¼ é€’éœ€è¦æ¸²æŸ“çš„æ¨¡æ€æ¡†ç»„ä»¶å’Œprops:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ€æ¡†ç»„ä»¶è¦å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> BaseModalProps &#123;</span><br><span class="line">  visible: <span class="built_in">boolean</span></span><br><span class="line">  onHide: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> ModalContextValue &#123;</span><br><span class="line">  render(Component: React.ComponentType&lt;<span class="built_in">any</span>&gt;, props: <span class="built_in">any</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Context = React.createContext&lt;ModalContextValue&gt;(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"useModal å¿…é¡»åœ¨ModalRenderer ä¸‹çº§"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ€æ¡†æ¸²æŸ“å™¨</span></span><br><span class="line"><span class="keyword">const</span> ModalRenderer: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [modal, setModal] = useState&lt;</span><br><span class="line">    | &#123; Comp: React.ComponentType&lt;<span class="built_in">any</span>&gt;; props: <span class="built_in">any</span>; visible?: <span class="built_in">boolean</span> &#125;</span><br><span class="line">    | <span class="literal">undefined</span></span><br><span class="line">  &gt;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> hide = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setModal(<span class="function"><span class="params">prev</span> =&gt;</span> prev &amp;&amp; &#123; ...prev, visible: <span class="literal">false</span> &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”±ä¸‹çº§ç»„ä»¶è°ƒç”¨ï¼Œä¼ é€’éœ€è¦æ¸²æŸ“çš„ç»„ä»¶å’Œprops</span></span><br><span class="line">  <span class="keyword">const</span> render = useCallback&lt;ModalContextValue[<span class="string">"render"</span>]&gt;<span class="function">(<span class="params">(<span class="params">Comp, props</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    setModal(<span class="params">&#123; Comp, props, visible: <span class="literal">true</span> &#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">value</span> = <span class="params">useMemo</span>(<span class="params">(<span class="params"></span>) =&gt; (<span class="params">&#123;render&#125;</span>), []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;Context.Provider value=&#123;value&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#123;props.children&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;div className="modal-container"&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">        &#123;<span class="comment">/*æ¨¡æ€æ¡†æ¸²æŸ“ */</span>&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">        &#123;!!modal &amp;&amp;</span></span></span><br><span class="line"><span class="function"><span class="params">          React.createElement(<span class="params">modal.Comp, &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            ...modal.props,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            visible: modal.visible,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            onHide: hide,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span>)&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;/div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/Context.Provider&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹Hooksçš„å®ç°, ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨useContextæ¥è®¿é—®ModalContextï¼Œ å¹¶è°ƒç”¨renderæ–¹æ³•:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useModal</span>&lt;<span class="title">P</span> <span class="title">extends</span> <span class="title">BaseModalProps</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  Modal: React.ComponentType&lt;P&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> renderer = useContext(Context)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> useCallback(</span><br><span class="line">    (props: Omit&lt;P, keyof BaseModalProps&gt;) =&gt; &#123;</span><br><span class="line">      renderer.render(Modal, props || &#123;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    [Modal],</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyModal: FC&lt;BaseModalProps &amp; &#123; a: <span class="built_in">number</span> &#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Modal visible=&#123;props.visible&#125; onOk=&#123;props.onHide&#125; onCancel=&#123;props.onHide&#125;&gt;</span><br><span class="line">      &#123;props.a&#125;</span><br><span class="line">    &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Home: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const showMyModal = useModal(MyModal)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const handleShow = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ æ˜¾ç¤ºæ¨¡æ€æ¡†</span></span><br><span class="line"><span class="regexp">    showMyModal(&#123;</span></span><br><span class="line"><span class="regexp">      a: 123,</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      showMyModal: &lt;button onClick=&#123;handleShow&#125;&gt;show&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯è¿è¡Œçš„å®Œæ•´ç¤ºä¾‹å¯ä»¥çœ‹<a href="https://codesandbox.io/s/lryom9617l?fontsize=14" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="react-hooks-æŠ€æœ¯åœ°å›¾"><a href="#react-hooks-æŠ€æœ¯åœ°å›¾" class="headerlink" title="React Hooks æŠ€æœ¯åœ°å›¾"></a><strong>React Hooks æŠ€æœ¯åœ°å›¾</strong></h2><p><strong>å…¨å®¶æ¡¶å’ŒHooksçš„ç»“åˆ</strong>:</p><ul><li><a href="https://react-redux.js.org/api/hooks" target="_blank" rel="noopener">Redux + Hooks</a></li><li><a href="https://github.com/mobxjs/mobx-react-lite" target="_blank" rel="noopener">Mobx + Hooks</a></li><li><a href="https://www.react-spring.io/docs/hooks/basics" target="_blank" rel="noopener">ReactSpring + Hooks</a></li><li><a href="https://www.apollographql.com/docs/react/api/react-hooks/" target="_blank" rel="noopener">Appoll</a></li><li><a href="https://react.i18next.com/latest/usetranslation-hook" target="_blank" rel="noopener">react-i18next</a></li><li><a href="https://reacttraining.com/blog/reach-react-router-future/" target="_blank" rel="noopener">react-router</a> Come in soon</li></ul><p><br></p><p><strong>ä¸€äº›æœ‰è¶£çš„Hooksé›†åˆ</strong>:</p><ul><li><a href="https://github.com/palmerhq/the-platform#usescript" target="_blank" rel="noopener">the-platform</a></li><li><a href="https://github.com/streamich/react-use" target="_blank" rel="noopener">react-use</a></li><li><a href="https://github.com/rehooks/ideas/issues" target="_blank" rel="noopener">rehooks/ideas</a> ä¸€èµ·å¼€è„‘æ´</li><li><a href="https://github.com/kitze/react-hanger" target="_blank" rel="noopener">react-hanger</a></li></ul><p><br></p><p><strong>Awesome</strong></p><ul><li><a href="https://github.com/rehooks/awesome-react-hooks" target="_blank" rel="noopener">Awesome React Hooks</a></li><li><a href="https://www.hooks.guide/rehooks/useComponentSize" target="_blank" rel="noopener">Hooks.Guide</a></li><li><a href="https://usehooks.com/" target="_blank" rel="noopener">useHooks</a></li></ul><p><br></p><p><strong>FAQ</strong></p><ul><li><a href="https://zh-hans.reactjs.org/docs/hooks-faq.html" target="_blank" rel="noopener">å®˜æ–¹Hooks FAQ</a> å¯ä»¥è§£ç­”å¤§éƒ¨åˆ†çš„ç–‘é—®</li></ul><p><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ç¯‡å¹…å¾ˆé•¿ã€ä»£ç å¾ˆå¤šã€‚èƒ½æ»‘åˆ°è¿™é‡Œç›¸å½“ä¸å®¹æ˜“, ç»™ä½ ç‚¹ä¸ªèµã€‚</p><p>ä½ ç”¨React Hooké‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¼€è¿‡ä»€ä¹ˆè„‘æ´ï¼Œä¸‹æ–¹è¯„è®ºå‘Šè¯‰æˆ‘.</p><p>æ¬¢è¿å…³æ³¨æˆ‘, å’Œæˆ‘äº¤æµ. æˆ‘æœ‰ç¤¾æ, ä½†æƒ³å¤šäº¤äº›åœˆå†…æœ‹å‹(<code>atob(&#39;YmxhbmstY2FybmV5&#39;)</code>, å¤‡æ³¨æ˜é‡‘ï¼Œæˆ‘ä¸å–èŒ¶ï¼Œè¿‘æœŸä¹Ÿä¸æ¢å·¥ä½œ)</p><p>æœ¬æ–‡å®Œ!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/react-hooks/cover.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;https://www.youtube.com/channel/UCz5vTaEhvh7dOHEyd
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>100æ¥è¡Œä»£ç , è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªæ¨¡æ¿å¼•æ“</title>
    <link href="https://bobi.ink/2019/08/09/ejs/"/>
    <id>https://bobi.ink/2019/08/09/ejs/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-14T01:29:53.703Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€å¼ å›¾è¯´æ˜Ejsæ¨¡æ¿å¼•æ“çš„åŸç†</p><p><img src="/images/ejs/ejs.png" alt></p><p><br></p><p>ä¸Šé¢ä¸€å¼ å›¾ï¼Œå·²ç»å¤§æ¦‚æŠŠä¸€ä¸ªç®€å•æ¨¡æ¿å¼•æ“(è¿™é‡Œä»¥<a href="https://ejs.co/" target="_blank" rel="noopener">EJS</a>ä¸ºä¾‹)çš„åŸç†è§£é‡Šå¾—ä¸ƒä¸ƒå…«å…«äº†ã€‚æœ¬æ–‡å°†æè¿°ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“æ˜¯æ€ä¹ˆè¿ä½œçš„ï¼ŸåŒ…å«å®ç°çš„å…³é”®æ­¥éª¤ã€ä»¥åŠå…¶èƒŒåçš„æ€æƒ³ã€‚</p><p>åŸºæœ¬ä¸Šæ¨¡æ¿å¼•æ“çš„å¥—è·¯ä¹Ÿå°±è¿™æ ·äº†ï¼Œä½†è¿™äº›æ€æƒ³æ˜¯é€šç”¨çš„ï¼Œæ¯”å¦‚ä½ åœ¨çœ‹vueçš„æ¨¡æ¿ç¼–è¯‘å™¨æºç ã€ä¹Ÿå¯ä»¥å¥—ç”¨è¿™äº›æ€æƒ³å’Œæ–¹æ³•.</p><p><br></p><h2 id="åŸºæœ¬apiè®¾è®¡"><a href="#åŸºæœ¬apiè®¾è®¡" class="headerlink" title="åŸºæœ¬APIè®¾è®¡"></a>åŸºæœ¬APIè®¾è®¡</h2><p>æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„EJS, è¿™ä¸ªæ¨¡æ¿å¼•æ“æ”¯æŒè¿™äº›æ ‡ç­¾:</p><ul><li><p><code>&lt;% script %&gt;</code> - è„šæœ¬æ‰§è¡Œ. ä¸€èˆ¬ç”¨äºæ§åˆ¶è¯­å¥ï¼Œä¸ä¼šè¾“å‡ºå€¼ ä¾‹å¦‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">user</span>) &#123; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>some thing<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>&lt;%= expression %&gt;</code> - è¾“å‡ºè¡¨è¾¾å¼çš„å€¼ï¼Œä½†æ˜¯ä¼šè½¬ä¹‰HTML:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;%= title %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>&lt;%- expression %&gt;</code> -  å’Œ<code>&lt;%= expr %&gt;</code>ä¸€æ ·ï¼Œåªä¸è¿‡ä¸ä¼šå¯¹HTMLè¿›è¡Œè½¬ä¹‰</p></li><li><code>&lt;%%</code> å’Œ<code>%%&gt;</code> - è¡¨ç¤ºæ ‡ç­¾è½¬ä¹‰, æ¯”å¦‚<code>&lt;%%</code>ä¼šè¾“å‡ºä¸º<code>&lt;%</code></li><li><code>&lt;%# æ³¨é‡Š %&gt;</code> - ä¸ä¼šæœ‰å†…å®¹è¾“å‡º</li></ul><p><br></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¨¡æ¿ç¤ºä¾‹ï¼Œä¸‹æ–‡ä¼šåŸºäºè¿™ä¸ªæ¨¡æ¿è¿›è¡Œè®²è§£:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">title</span> %&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%%</span> è½¬ä¹‰ %%&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%#</span> è¿™é‡Œæ˜¯æ³¨é‡Š %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%-</span> <span class="attr">before</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">show</span>) &#123; %&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>root<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p><strong>åŸºæœ¬APIè®¾è®¡</strong></p><p>æˆ‘ä»¬å°†æ¨¡æ¿è§£æå’Œæ¸²æŸ“ç›¸å…³çš„é€»è¾‘æ”¾åˆ°ä¸€ä¸ªTemplateç±»ä¸­ï¼Œå®ƒçš„åŸºæœ¬æ¥å£å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Template &#123;</span><br><span class="line">  <span class="keyword">public</span> template: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">private</span> tokens: <span class="built_in">string</span>[] = [];</span><br><span class="line">  <span class="keyword">private</span> source: <span class="built_in">string</span> = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">private</span> state?: State;</span><br><span class="line">  <span class="keyword">private</span> fn?: <span class="built_in">Function</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">template: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.template = template;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¨¡æ¿ç¼–è¯‘</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> compile() &#123;</span><br><span class="line">    <span class="keyword">this</span>.parseTemplateText();</span><br><span class="line">    <span class="keyword">this</span>.transformTokens();</span><br><span class="line">    <span class="keyword">this</span>.wrapit();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¸²æŸ“æ–¹æ³•ï¼Œç”±ç”¨æˆ·æŒ‡å®šä¸€ä¸ªå¯¹è±¡æ¥æ¸²æŸ“å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> render(local: object) &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * tokenè§£æ</span></span><br><span class="line"><span class="comment">   * å°†&lt;% if (codintion) &#123; %&gt;</span></span><br><span class="line"><span class="comment">   * è§£æä¸ºtokenæ•°ç»„ï¼Œä¾‹å¦‚['&lt;%', ' if (condition) &#123; ', '%&gt;']</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> parseTemplateText() &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†Tokenè½¬æ¢ä¸ºJavascriptè¯­å¥</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> transformTokens() &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†ä¸Šä¸€ä¸ªæ­¥éª¤è½¬æ¢å‡ºæ¥çš„Javascriptè¯­å¥ï¼Œå°è£…æˆä¸€ä¸ªæ¸²æŸ“æ–¹æ³•</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> wrapit() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="tokenè§£æ"><a href="#tokenè§£æ" class="headerlink" title="tokenè§£æ"></a>tokenè§£æ</h2><p>ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰çš„å¼€å§‹æ ‡ç­¾(start tag)å’Œç»“æŸæ ‡ç­¾(end tag)éƒ½è§£æå‡ºæ¥ï¼Œæˆ‘ä»¬æœŸæœ›çš„è§£æç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">"\n&lt;html&gt;\n  &lt;head&gt;"</span>,</span><br><span class="line">  <span class="string">"&lt;%="</span>,</span><br><span class="line">  <span class="string">" title "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"&lt;/head&gt;\n  &lt;body&gt;\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%%"</span>,</span><br><span class="line">  <span class="string">" è½¬ä¹‰ "</span>,</span><br><span class="line">  <span class="string">"%%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%#"</span>,</span><br><span class="line">  <span class="string">" è¿™é‡Œæ˜¯æ³¨é‡Š "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%-"</span>,</span><br><span class="line">  <span class="string">" before "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%"</span>,</span><br><span class="line">  <span class="string">" if (show) &#123; "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n      &lt;div&gt;root&lt;/div&gt;\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%"</span>,</span><br><span class="line">  <span class="string">" &#125; "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n  &lt;/body&gt;\n&lt;/html&gt;\n"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬çš„æ¨¡æ¿å¼•æ“è¯­æ³•éå¸¸ç®€å•, å‹æ ¹å°±ä¸éœ€è¦è§£ææˆä»€ä¹ˆæŠ½è±¡è¯­æ³•æ ‘(AST)(å³çœå»äº†è¯­æ³•è§£æ, åªè¿›è¡Œè¯æ³•è§£æ). ç›´æ¥é€šè¿‡<code>æ­£åˆ™è¡¨è¾¾å¼</code>å°±å¯ä»¥å®ç°å°†æ ‡ç­¾æŠ½å–å‡ºæ¥ã€‚</p><p>å…ˆå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼, ç”¨æ¥åŒ¹é…æˆ‘ä»¬æ‰€æœ‰æ”¯æŒçš„æ ‡ç­¾ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &lt;%% %%&gt; ç”¨äºè½¬ä¹‰</span></span><br><span class="line"><span class="comment">// &lt;% è„šæœ¬</span></span><br><span class="line"><span class="comment">// &lt;%= è¾“å‡ºè„šæœ¬å€¼</span></span><br><span class="line"><span class="comment">// &lt;%- è¾“å‡ºè„šæœ¬å€¼ï¼Œunescape</span></span><br><span class="line"><span class="comment">// &lt;%# æ³¨é‡Š</span></span><br><span class="line"><span class="comment">// %&gt; ç»“æŸæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> REGEXP = <span class="regexp">/(&lt;%%|%%&gt;|&lt;%=|&lt;%-|&lt;%#|&lt;%|%&gt;)/</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é€ä¸ªè¿›è¡ŒåŒ¹é…ï¼Œå°†å­—ç¬¦ä¸²æ‹†åˆ†å‡ºæ¥. ä»£ç ä¹Ÿå¾ˆç®€å•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">parseTemplateText() &#123;</span><br><span class="line">  <span class="keyword">let</span> str = <span class="keyword">this</span>.template;</span><br><span class="line">  <span class="keyword">const</span> arr = <span class="keyword">this</span>.tokens;</span><br><span class="line">  <span class="comment">// é€šè¿‡execæ–¹æ³•å¯ä»¥è·å–åŒ¹é…çš„ä½ç½®, å¦‚æœåŒ¹é…å¤±è´¥åˆ™è¿”å›null</span></span><br><span class="line">  <span class="keyword">let</span> res = REGEXP.exec(str);</span><br><span class="line">  <span class="keyword">let</span> index;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (res) &#123;</span><br><span class="line">    index = res.index;</span><br><span class="line">    <span class="comment">// å‰ç½®å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> (index !== <span class="number">0</span>) &#123;</span><br><span class="line">      arr.push(str.substring(<span class="number">0</span>, index));</span><br><span class="line">      str = str.slice(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    arr.push(res[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// æˆªæ–­å­—ç¬¦ä¸²ï¼Œç»§ç»­åŒ¹é…</span></span><br><span class="line">    str = str.slice(res[<span class="number">0</span>].length);</span><br><span class="line">    res = REGEXP.exec(str);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (str) &#123;</span><br><span class="line">    arr.push(str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="ç®€å•çš„è¯­æ³•æ£€æŸ¥"><a href="#ç®€å•çš„è¯­æ³•æ£€æŸ¥" class="headerlink" title="ç®€å•çš„è¯­æ³•æ£€æŸ¥"></a>ç®€å•çš„è¯­æ³•æ£€æŸ¥</h2><p>Okï¼Œå°†æ ‡ç­¾è§£æå‡ºæ¥åï¼Œå°±å¯ä»¥å¼€å§‹å‡†å¤‡å°†å®ƒä»¬è½¬æ¢ç§°ä¸ºâ€˜æ¸²æŸ“â€™å‡½æ•°äº†.</p><p>é¦–å…ˆè¿›è¡Œä¸€ä¸‹<strong>ç®€å•çš„è¯­æ³•æ£€æŸ¥</strong>ï¼Œæ£€æŸ¥æ ‡ç­¾æ˜¯å¦<strong>é—­åˆ</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> start = <span class="string">"&lt;%"</span>;           <span class="comment">// å¼€å§‹æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> end = <span class="string">"%&gt;"</span>;             <span class="comment">// ç»“æŸæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> escpStart = <span class="string">"&lt;%%"</span>;      <span class="comment">// å¼€å§‹æ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line"><span class="keyword">const</span> escpEnd = <span class="string">"%%&gt;"</span>;        <span class="comment">// ç»“æŸæ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line"><span class="keyword">const</span> escpoutStart = <span class="string">"&lt;%="</span>;   <span class="comment">// è½¬ä¹‰çš„è¡¨è¾¾å¼è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> unescpoutStart = <span class="string">"&lt;%-"</span>; <span class="comment">// ä¸è½¬ä¹‰çš„è¡¨è¾¾å¼è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> comtStart = <span class="string">"&lt;%#"</span>;      <span class="comment">// æ³¨é‡Š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (tok.includes(start) &amp;&amp; !tok.includes(escpStart)) &#123;</span><br><span class="line">  closing = <span class="keyword">this</span>.tokens[idx + <span class="number">2</span>];</span><br><span class="line">  <span class="keyword">if</span> (closing == <span class="literal">null</span> || !closing.includes(end)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`<span class="subst">$&#123;tok&#125;</span> æœªæ‰¾åˆ°å¯¹åº”çš„é—­åˆæ ‡ç­¾`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h2><p>ç°åœ¨å¼€å§‹éå†tokenã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœ‰é™çš„çŠ¶æ€æœº(Finite-state machine, FSM)æ¥æè¿°è½¬æ¢çš„é€»è¾‘.</p><p><code>çŠ¶æ€æœº</code>æ˜¯è¡¨ç¤º<strong>æœ‰é™ä¸ªçŠ¶æ€ä»¥åŠåœ¨è¿™äº›çŠ¶æ€ä¹‹é—´çš„è½¬ç§»å’ŒåŠ¨ä½œç­‰è¡Œä¸ºçš„æ•°å­¦æ¨¡å‹</strong>ã€‚ç®€å•è€Œè¨€ï¼Œæœ‰é™çŠ¶æ€æœºç”±ä¸€ç»„çŠ¶æ€ã€ä¸€ä¸ªåˆå§‹çŠ¶æ€ã€è¾“å…¥å’Œæ ¹æ®è¾“å…¥åŠç°æœ‰çŠ¶æ€è½¬æ¢ä¸ºä¸‹ä¸€ä¸ªçŠ¶æ€çš„è½¬æ¢å‡½æ•°ç»„æˆã€‚å®ƒæœ‰ä¸‰ä¸ªç‰¹å¾:</p><ul><li>çŠ¶æ€æ€»æ•°æ˜¯æœ‰é™çš„ã€‚</li><li>ä»»ä¸€æ—¶åˆ»ï¼Œåªå¤„åœ¨ä¸€ç§çŠ¶æ€ä¹‹ä¸­ã€‚</li><li>æŸç§æ¡ä»¶ä¸‹ï¼Œä¼šä»ä¸€ç§çŠ¶æ€è½¬å˜åˆ°å¦ä¸€ç§çŠ¶æ€</li></ul><p><br></p><p>ç¨å¾®åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬æ¨¡æ¿å¼•æ“çš„çŠ¶æ€è½¬æ¢å›¾å¦‚ä¸‹:</p><p><img src="/images/ejs/state.png" alt></p><p><br></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥æŠ½å–å‡ºä»¥ä¸‹çŠ¶æ€:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">enum State &#123;</span><br><span class="line">  EVAL,    <span class="comment">// è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line">  ESCAPED, <span class="comment">// è¡¨è¾¾å¼è¾“å‡º</span></span><br><span class="line">  RAW,     <span class="comment">// è¡¨è¾¾å¼è¾“å‡ºä¸è½¬ä¹‰</span></span><br><span class="line">  COMMENT, <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">  LITERAL  <span class="comment">// å­—é¢é‡ï¼Œç›´æ¥è¾“å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Ok, ç°åœ¨å¼€å§‹éå†token:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.tokens.forEach(<span class="function">(<span class="params">tok, idx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">switch</span> (tok) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ‡ç­¾è¯†åˆ«</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> start:</span><br><span class="line">      <span class="comment">// è„šæœ¬å¼€å§‹</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.EVAL;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> escpoutStart:</span><br><span class="line">      <span class="comment">// è½¬ä¹‰è¾“å‡º</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.ESCAPED;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> unescpoutStart:</span><br><span class="line">      <span class="comment">// éè½¬ä¹‰è¾“å‡º</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.RAW;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> comtStart:</span><br><span class="line">      <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.COMMENT;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> escpStart:</span><br><span class="line">      <span class="comment">// æ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.LITERAL;</span><br><span class="line">      <span class="keyword">this</span>.source += <span class="string">`;__append('&lt;%');\n`</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> escpEnd:</span><br><span class="line">      <span class="keyword">this</span>.state = State.LITERAL;</span><br><span class="line">      <span class="keyword">this</span>.source += <span class="string">`;__append('%&gt;');\n`</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> end:</span><br><span class="line">      <span class="comment">// æ¢å¤åˆå§‹çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">this</span>.state = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * è½¬æ¢è¾“å‡º</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">this</span>.state) &#123;</span><br><span class="line">          <span class="keyword">case</span> State.EVAL:</span><br><span class="line">            <span class="comment">// ä»£ç </span></span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;<span class="subst">$&#123;tok&#125;</span>\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.ESCAPED:</span><br><span class="line">            <span class="comment">// stripSemi å°†å¤šä½™çš„åˆ†å·ç§»é™¤</span></span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;__append(escapeFn(<span class="subst">$&#123;stripSemi(tok)&#125;</span>));\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.RAW:</span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;__append(<span class="subst">$&#123;stripSemi(tok)&#125;</span>);\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.LITERAL:</span><br><span class="line">            <span class="comment">// å› ä¸ºæˆ‘ä»¬æŠŠå­—ç¬¦ä¸²æ”¾åˆ°å•å¼•å·ä¸­ï¼Œæ‰€ä»¥transformStringå°†tokä¸­çš„å•å¼•å·ã€æ¢è¡Œç¬¦ã€è½¬ä¹‰ç¬¦è¿›è¡Œè½¬ç§»</span></span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;__append('<span class="subst">$&#123;transformString(tok)&#125;</span>');\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.COMMENT:</span><br><span class="line">            <span class="comment">// ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å­—é¢é‡</span></span><br><span class="line">        <span class="keyword">this</span>.source += <span class="string">`;__append('<span class="subst">$&#123;transformString(tok)&#125;</span>');\n`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·çš„ç»“æœ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">;__append(<span class="string">'\n&lt;html&gt;\n  &lt;head&gt;'</span>);</span><br><span class="line">;__append(escapeFn( title ));</span><br><span class="line">;__append(<span class="string">'&lt;/head&gt;\n  &lt;body&gt;\n    '</span>);</span><br><span class="line">;__append(<span class="string">'&lt;%'</span>);</span><br><span class="line">;__append(<span class="string">' è½¬ä¹‰ '</span>);</span><br><span class="line">;__append(<span class="string">'%&gt;'</span>);</span><br><span class="line">;__append(<span class="string">'\n    '</span>);</span><br><span class="line">;__append(<span class="string">'\n    '</span>);</span><br><span class="line">;__append( before );</span><br><span class="line">;__append(<span class="string">'\n    '</span>);</span><br><span class="line">; <span class="keyword">if</span> (show) &#123;</span><br><span class="line">;__append(<span class="string">'\n      &lt;div&gt;root&lt;/div&gt;\n    '</span>);</span><br><span class="line">; &#125;</span><br><span class="line">;__append(<span class="string">'\n  &lt;/body&gt;\n&lt;/html&gt;\n'</span>);</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°"><a href="#æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°" class="headerlink" title="æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°"></a>æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°</h2><p>ç°åœ¨æˆ‘ä»¬æŠŠè½¬æ¢ç»“æœåŒ…è£¹æˆå‡½æ•°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wrapit() &#123;</span><br><span class="line">    <span class="keyword">this</span>.source = <span class="string">`\</span></span><br><span class="line"><span class="string">const __out = [];</span></span><br><span class="line"><span class="string">const __append = __out.push.bind(__out);</span></span><br><span class="line"><span class="string">with(local||&#123;&#125;) &#123;</span></span><br><span class="line"><span class="string"><span class="subst">$&#123;<span class="keyword">this</span>.source&#125;</span></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">return __out.join('');\</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">    <span class="keyword">this</span>.fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"local"</span>, <span class="string">"escapeFn"</span>, <span class="keyword">this</span>.source);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨åˆ°äº†<code>with</code>è¯­å¥ï¼Œæ¥åŒ…è£¹ä¸Šé¢è½¬æ¢çš„ä»£ç ï¼Œè¿™æ ·å¯ä»¥å…å»localå¯¹è±¡è®¿é—®é™å®šå‰ç¼€ã€‚</p><p>æ¸²æŸ“æ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥è°ƒç”¨ä¸Šé¢åŒ…è£¹çš„å‡½æ•°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render(local: object) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.fn.call(<span class="literal">null</span>, local, <span class="built_in">escape</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="è·‘èµ·æ¥"><a href="#è·‘èµ·æ¥" class="headerlink" title="è·‘èµ·æ¥"></a>è·‘èµ·æ¥</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> temp = <span class="keyword">new</span> Template(<span class="string">`</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">  &lt;head&gt;&lt;%= title %&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;%% è½¬ä¹‰ %%&gt;</span></span><br><span class="line"><span class="string">    &lt;%# è¿™é‡Œæ˜¯æ³¨é‡Š %&gt;</span></span><br><span class="line"><span class="string">    &lt;%- before %&gt;</span></span><br><span class="line"><span class="string">    &lt;% if (show) &#123; %&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;root&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;% &#125; %&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line">temp.compile();</span><br><span class="line">temp.render(&#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">"hello"</span>, <span class="attr">before</span>: <span class="string">"&lt;div&gt;xx&lt;/div&gt;"</span> &#125;)</span><br><span class="line"><span class="comment">// &lt;html&gt;</span></span><br><span class="line"><span class="comment">//   &lt;head&gt;hello&lt;/head&gt;</span></span><br><span class="line"><span class="comment">//   &lt;body&gt;</span></span><br><span class="line"><span class="comment">//     &lt;% è½¬ä¹‰ %&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     &lt;div&gt;xx&lt;/div&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//       &lt;div&gt;root&lt;/div&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   &lt;/body&gt;</span></span><br><span class="line"><span class="comment">// &lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨CodeSandboxè¿è¡Œå®Œæ•´çš„ä»£ç :</p><p><a href="https://codesandbox.io/s/ejs-wp11m?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit ejs"></a></p><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡å…¶å®å—åˆ°äº†<a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">the-super-tiny-compiler</a>å¯å‘ï¼Œå®ç°äº†ä¸€ä¸ªæç®€çš„æ¨¡æ¿å¼•æ“ï¼Œå…¶å®æ¨¡æ¿å¼•æ“æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªCompilerï¼Œé€šè¿‡ä¸Šæ–‡å¯ä»¥äº†è§£åˆ°ä¸€ä¸ªæ¨¡æ¿å¼•æ“ç¼–è¯‘æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li><p><strong>è§£æ</strong> å°†æ¨¡æ¿ä»£ç è§£ææˆæŠ½è±¡çš„è¡¨ç¤ºå½¢å¼ã€‚å¤æ‚çš„ç¼–è¯‘å™¨ä¼šæœ‰<code>è¯æ³•è§£æ(Lexical Analysis)</code>å’Œ<code>è¯­æ³•è§£æ(Syntactic Analysis)</code></p><p> <strong>è¯æ³•è§£æ</strong>, ä¸Šæ–‡æˆ‘ä»¬å°†æ¨¡æ¿å†…å®¹è§£ææˆtokençš„è¿‡ç¨‹å°±å¯ä»¥è®¤ä¸ºæ˜¯â€˜è¯æ³•è§£æâ€™ï¼Œå®ƒä¼šå°†æºä»£ç æ‹†åˆ†ç§°ä¸ºtokenæ•°ç»„ï¼Œtokenæ˜¯ä¸€ä¸ªå°å•å…ƒï¼Œè¡¨ç¤ºç‹¬ç«‹çš„â€˜è¯­æ³•ç‰‡æ®µâ€™ã€‚</p><p> <strong>è¯­æ³•è§£æ</strong>ï¼Œè¯­æ³•è§£æå™¨æ¥æ”¶tokenæ•°ç»„ï¼Œå°†å®ƒä»¬é‡æ–°æ ¼å¼åŒ–ç§°ä¸ºæŠ½è±¡è¯­æ³•æ ‘(Abstract Syntax Tree, AST), æŠ½è±¡è¯­æ³•æ ‘å¯ä»¥ç”¨äºæè¿°è¯­æ³•å•å…ƒ, ä»¥åŠå•å…ƒä¹‹é—´çš„å…³ç³»ã€‚ è¯­æ³•è§£æé˜¶æ®µå¯ä»¥å‘ç°è¯­æ³•é—®é¢˜ã€‚</p><p> <img src="/images/ejs/ast.png" alt></p><p> (å›¾ç‰‡æ¥æº: <a href="https://ruslanspivak.com/lsbasi-part7" target="_blank" rel="noopener">https://ruslanspivak.com/lsbasi-part7</a>)</p><p> æœ¬æ–‡ä»‹ç»çš„æ¨¡æ¿å¼•æ“ï¼Œå› ä¸ºè¯­æ³•å¤ªç®€å•äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦ASTè¿™ä¸ªä¸­é—´è¡¨ç¤ºå½¢å¼ã€‚ç›´æ¥åœ¨tokensä¸Šè¿›è¡Œè½¬æ¢</p></li><li><p><strong>è½¬æ¢</strong> å°†ä¸Šä¸ªæ­¥éª¤æŠ½è±¡çš„è¡¨ç¤ºå½¢å¼ï¼Œè½¬æ¢æˆä¸ºç¼–è¯‘å™¨æƒ³è¦çš„ã€‚æ¯”å¦‚ä¸Šæ–‡æ¨¡æ¿å¼•æ“ä¼šè½¬æ¢ä¸ºå¯¹åº”è¯­è¨€çš„è¯­å¥ã€‚å¤æ‚çš„ç¼–è¯‘å™¨ä¼šåŸºäºASTè¿›è¡Œâ€˜è½¬æ¢â€™ï¼Œä¹Ÿå°±æ˜¯å¯¹ASTè¿›è¡Œâ€˜å¢åˆ æŸ¥æ”¹â€™. é€šå¸¸ä¼šé…åˆVisitorsæ¨¡å¼æ¥éå†/è®¿é—®ASTçš„èŠ‚ç‚¹</p></li><li><strong>ä»£ç ç”Ÿæˆ</strong> å°†è½¬æ¢åçš„æŠ½è±¡è¡¨ç¤ºè½¬æ¢ä¸ºæ–°çš„ä»£ç ã€‚ æ¯”å¦‚æ¨¡æ¿å¼•æ“æœ€åä¸€æ­¥ä¼šå°è£…æˆä¸ºä¸€ä¸ªæ¸²æŸ“å‡½æ•°. å¤æ‚çš„ç¼–è¯‘å™¨ä¼šå°†ASTè½¬æ¢ä¸ºç›®æ ‡ä»£ç </li></ol><p>ç¼–è¯‘å™¨ç›¸å…³çš„ä¸œè¥¿ç¡®å®å¾ˆæœ‰è¶£ï¼Œåç»­æœ‰æœºä¼šå¯ä»¥è®²è®²æ€ä¹ˆç¼–å†™babelæ’ä»¶ã€‚</p><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://github.com/mde/ejs/tree/master/lib" target="_blank" rel="noopener">Ejsæºä»£ç </a></li><li><a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">the-super-tiny-compiler</a></li><li><a href="https://ruslanspivak.com/lsbasi-part7/" target="_blank" rel="noopener">Letâ€™s Build A Simple Interpreter. Part 7: Abstract Syntax Trees</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€å¼ å›¾è¯´æ˜Ejsæ¨¡æ¿å¼•æ“çš„åŸç†&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/ejs/ejs.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢ä¸€å¼ å›¾ï¼Œå·²ç»å¤§æ¦‚æŠŠä¸€ä¸ªç®€å•æ¨¡æ¿å¼•æ“(è¿™é‡Œä»¥&lt;a href=&quot;https://ejs.co/&quot; target=&quot;_b
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>æ­å¼€Electronçš„remoteæ¨¡å—çš„é¢çº±</title>
    <link href="https://bobi.ink/2019/08/04/electron-remote/"/>
    <id>https://bobi.ink/2019/08/04/electron-remote/</id>
    <published>2019-08-03T16:00:00.000Z</published>
    <updated>2019-08-09T13:28:24.883Z</updated>
    
    <content type="html"><![CDATA[<p>Electronçš„remoteæ¨¡å—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡çš„ä¸œè¥¿ï¼Œä¸º<code>æ¸²æŸ“è¿›ç¨‹</code>å’Œ<code>ä¸»è¿›ç¨‹</code>é€šä¿¡å°è£…äº†ä¸€ç§ç®€å•æ–¹æ³•ï¼Œé€šè¿‡remoteä½ å¯ä»¥â€™ç›´æ¥â€™è·å–ä¸»è¿›ç¨‹å¯¹è±¡æˆ–è€…è°ƒç”¨ä¸»è¿›ç¨‹å‡½æ•°æˆ–å¯¹è±¡çš„æ–¹æ³•, è€Œä¸å¿…æ˜¾å¼å‘é€è¿›ç¨‹é—´æ¶ˆæ¯, ç±»ä¼¼äº Java çš„ RMI. ä¾‹å¦‚:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; remote &#125; = <span class="built_in">require</span>(<span class="string">'electron'</span>)</span><br><span class="line"><span class="keyword">const</span> myModal = remote.require(<span class="string">'myModal'</span>) <span class="comment">// è®©ä¸»è¿›ç¨‹requireæŒ‡å®šæ¨¡å—ï¼Œå¹¶è¿”å›åˆ°æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">myModal.dosomething()                     <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p><br></p><p><strong>æœ¬è´¨ä¸Šï¼Œremoteæ¨¡å—æ˜¯åŸºäºElectronçš„IPCæœºåˆ¶çš„ï¼Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡çš„æ•°æ®å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ¯”å¦‚JSONåºåˆ—åŒ–</strong>ã€‚æ‰€ä»¥æœ¬æ–‡çš„ç›®çš„æ˜¯ä»‹ç»Electronæ˜¯å¦‚ä½•è®¾è®¡remoteæ¨¡å—çš„ï¼Œä»¥åŠé‡Œé¢æœ‰ä»€ä¹ˆå‘ã€‚</p><p><br></p><p><img src="/images/electron-remote/ipc.png" alt></p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><ul><li><a href="#%e9%80%9a%e4%bf%a1%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%ae%9a%e4%b9%89">é€šä¿¡åè®®çš„å®šä¹‰</a></li><li><a href="#%e5%af%b9%e8%b1%a1%e7%9a%84%e5%ba%8f%e5%88%97%e5%8c%96">å¯¹è±¡çš„åºåˆ—åŒ–</a></li><li><a href="#%e5%bd%b1%e5%ad%90%e5%af%b9%e8%b1%a1">å½±å­å¯¹è±¡</a></li><li><a href="#%e5%af%b9%e8%b1%a1%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f">å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="#%e6%b8%b2%e6%9f%93%e8%bf%9b%e7%a8%8b%e6%80%8e%e4%b9%88%e7%bb%99%e4%b8%bb%e8%bf%9b%e7%a8%8b%e4%bc%a0%e9%80%92%e5%9b%9e%e8%b0%83">æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ</a></li><li><a href="#%e4%b8%80%e4%ba%9b%e7%bc%ba%e9%99%b7">ä¸€äº›ç¼ºé™·</a></li><li><a href="#remote%e6%a8%a1%e5%9d%97%e5%ae%9e%e8%b7%b5%e5%92%8c%e4%bc%98%e5%8c%96">remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–</a></li><li><a href="#%e6%80%bb%e7%bb%93">æ€»ç»“</a></li><li><a href="#%e6%89%a9%e5%b1%95">æ‰©å±•</a></li></ul><p><br></p><h2 id="é€šä¿¡åè®®çš„å®šä¹‰"><a href="#é€šä¿¡åè®®çš„å®šä¹‰" class="headerlink" title="é€šä¿¡åè®®çš„å®šä¹‰"></a>é€šä¿¡åè®®çš„å®šä¹‰</h2><p>ä¸Šæ–‡è¯´åˆ°ï¼Œremoteæœ¬è´¨ä¸ŠåŸºäºåºåˆ—åŒ–çš„IPCé€šä¿¡çš„ï¼Œæ‰€ä»¥é¦–å…ˆå…³é”®éœ€è¦<strong>å®šä¹‰ä¸€ä¸ªåè®®æ¥æè¿°ä¸€ä¸ªæ¨¡å—/å¯¹è±¡çš„å¤–å½¢</strong>ï¼Œå…¶ä¸­åŒ…å«ä¸‹åˆ—ç±»å‹:</p><ul><li>åŸå§‹å€¼ã€‚ä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼</li><li>æ•°ç»„ã€‚</li><li>å¯¹è±¡ã€‚å¯¹è±¡å±æ€§ã€å¯¹è±¡çš„æ–¹æ³•ã€ä»¥åŠå¯¹è±¡çš„åŸå‹</li><li>å‡½æ•°ã€‚æ™®é€šå‡½æ•°å’Œæ„é€ æ–¹æ³•ã€å¼‚å¸¸å¤„ç†</li><li>ç‰¹æ®Šå¯¹è±¡ã€‚Dateã€Bufferã€Promiseã€å¼‚å¸¸å¯¹è±¡ç­‰ç­‰</li></ul><p><br></p><p>Electronä½¿ç”¨MetaData(å…ƒæ•°æ®)æ¥æè¿°è¿™äº›å¯¹è±¡å¤–å½¢çš„åè®®. ä¸‹é¢æ˜¯ä¸€äº›è½¬æ¢çš„ç¤ºä¾‹:</p><ul><li><p><strong>åŸºæœ¬å¯¹è±¡</strong>: åŸºæœ¬å¯¹è±¡å¾ˆå®¹æ˜“å¤„ç†ï¼Œç›´æ¥å€¼æ‹·è´ä¼ é€’å³å¯</p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">Buffer.from(<span class="string">'hello world'</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'message'</span>);</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">type</span>: <span class="string">"value"</span>, <span class="attr">value</span>: <span class="number">1</span>&#125;;</span><br><span class="line">&#123;<span class="attr">type</span>: <span class="string">"date"</span>, <span class="attr">value</span>: <span class="number">1565002306662</span>&#125;;  <span class="comment">// åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³</span></span><br><span class="line">&#123;<span class="attr">type</span>:Â <span class="string">"buffer"</span>, <span class="attr">value</span>:Â &#123;<span class="attr">data</span>:Â <span class="built_in">Uint8Array</span>(<span class="number">11</span>),Â <span class="attr">length</span>:Â <span class="number">11</span>,Â <span class="attr">type</span>:Â <span class="string">"Buffer"</span>&#125;&#125;; <span class="comment">// åºåˆ—åŒ–ä¸ºæ•°ç»„</span></span><br><span class="line">&#123;</span><br><span class="line">  members: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"stack"</span>,</span><br><span class="line">      value: <span class="string">"Error: message\n    at Object.&lt;anonymous&gt; (çœç•¥è°ƒç”¨æ ˆ)"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"message"</span>, <span class="attr">value</span>: <span class="string">"message"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"name"</span>, <span class="attr">value</span>: <span class="string">"Error"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  type: <span class="string">"error"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>æ•°ç»„</strong>: æ•°ç»„ä¹Ÿæ˜¯å€¼æ‹·è´</p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><p>æ•°ç»„ä¼šé€’å½’å¯¹æˆå‘˜è¿›è¡Œè½¬æ¢. æ³¨æ„æ•°ç»„å’ŒåŸºæœ¬ç±»å‹æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå®ƒä¹Ÿæ˜¯å€¼æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ä¿®æ”¹æ•°ç»„ä¸ä¼šå½±å“åˆ°å¯¹ç«¯è¿›ç¨‹çš„æ•°ç»„å€¼ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"members"</span>: [</span><br><span class="line">    &#123;<span class="string">"type"</span>:<span class="string">"value"</span>,<span class="string">"value"</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"type"</span>:<span class="string">"value"</span>,<span class="string">"value"</span>:<span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"type"</span>:<span class="string">"value"</span>,<span class="string">"value"</span>:<span class="number">3</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"type"</span>:<span class="string">"array"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><br></p><ul><li><p><strong>çº¯å¯¹è±¡</strong>: </p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.a;</span><br><span class="line">  &#125;,</span><br><span class="line">  c: &#123;</span><br><span class="line">    d: <span class="string">'d'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæœ‰ä¸€ä¸ªidï¼Œç”¨äºæ ‡è¯†ä¸»è¿›ç¨‹çš„ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">// å¯¹è±¡æˆå‘˜</span></span><br><span class="line">  members: [</span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"a"</span>, <span class="attr">type</span>: <span class="string">"get"</span>, <span class="attr">writable</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"b"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    <span class="comment">// electronåªä¼šè½¬æ¢ä¸€å±‚ï¼Œä¸ä¼šé€’å½’è½¬æ¢å†…åµŒå¯¹è±¡</span></span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"c"</span>, <span class="attr">type</span>: <span class="string">"get"</span>, <span class="attr">writable</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  name: <span class="string">"Object"</span>,</span><br><span class="line">  <span class="comment">// å¯¹è±¡çš„ä¸Šçº§åŸå‹çš„MetaData</span></span><br><span class="line">  proto: <span class="literal">null</span>,</span><br><span class="line">  type: <span class="string">"object"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>å‡½æ•°</strong>:</p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'hello world'</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// å‡½æ•°ä¹Ÿæœ‰ä¸€ä¸ªå”¯ä¸€idæ ‡è¯†ï¼Œå› ä¸ºå®ƒä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¸»è¿›ç¨‹éœ€è¦ä¿æŒè¯¥å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">  id: <span class="number">2</span>,</span><br><span class="line">  <span class="comment">// å‡½æ•°å±æ€§æˆå‘˜</span></span><br><span class="line">  members: [],</span><br><span class="line">  name: <span class="string">"Function"</span>,</span><br><span class="line">  type: <span class="string">"function"</span></span><br><span class="line">  <span class="comment">// Electronè§£æå¯¹è±¡çš„åŸå‹é“¾</span></span><br><span class="line">  proto: &#123;</span><br><span class="line">    members: [</span><br><span class="line">      <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">      &#123;</span><br><span class="line">        enumerable: <span class="literal">false</span>,</span><br><span class="line">        name: <span class="string">"constructor"</span>,</span><br><span class="line">        type: <span class="string">"method"</span>,</span><br><span class="line">        writable: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"apply"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"bind"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"call"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"toString"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    proto: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>Promise</strong>ï¼šPromiseåªéœ€æè¿°thenå‡½æ•°</p><ul><li><p>è¾“å…¥:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve();</span><br></pre></td></tr></table></figure></li><li><p>è¾“å…¥:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Promiseè¿™é‡Œå…³é”®åœ¨äºthenï¼Œè¯¦è§ä¸Šé¢çš„å‡½æ•°å…ƒæ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line">  type: <span class="string">"promise"</span></span><br><span class="line">  then: &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    members: [],</span><br><span class="line">    name: <span class="string">"Function"</span>,</span><br><span class="line">    proto: &#123;<span class="comment">/*è§ä¸Šé¢*/</span>&#125;,</span><br><span class="line">    type: <span class="string">"function"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><br></p><p>äº†è§£remoteçš„æ•°æ®ä¼ è¾“åè®®åï¼Œæœ‰ç»éªŒçš„å¼€å‘è€…åº”è¯¥å¿ƒé‡Œæœ‰åº•äº†ï¼Œå®ƒçš„åŸç†å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/images/electron-remote/meta-transform.png" alt></p><p>ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´éœ€è¦å°†å¯¹è±¡åºåˆ—åŒ–æˆMetaDataæè¿°ï¼Œè½¬æ¢çš„è§„åˆ™ä¸Šé¢å·²ç»è§£é‡Šçš„æ¯”è¾ƒæ¸…æ¥šäº†ã€‚è¿™é‡Œé¢éœ€è¦ç‰¹æ®Šå¤„ç†æ˜¯å¯¹è±¡å’Œå‡½æ•°ï¼Œæ¸²æŸ“è¿›ç¨‹æ‹¿åˆ°MetaDataåéœ€è¦å°è£…æˆä¸€ä¸ªå½±å­å¯¹è±¡/å‡½æ•°ï¼Œæ¥ä¾›æ¸²æŸ“è¿›ç¨‹åº”ç”¨è°ƒç”¨ã€‚</p><p>å…¶ä¸­æ¯”è¾ƒå¤æ‚çš„æ˜¯å¯¹è±¡å’Œå‡½æ•°çš„å¤„ç†ï¼ŒElectronä¸ºäº†é˜²æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œéœ€è¦å°†è¿™äº›å¯¹è±¡æ”¾è¿›ä¸€ä¸ªæ³¨å†Œè¡¨ä¸­ï¼Œåœ¨è¿™ä¸ªè¡¨ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„idæ¥æ ‡è¯†ã€‚è¿™ä¸ªidæœ‰ç‚¹ç±»ä¼¼äºâ€˜æŒ‡é’ˆâ€™ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šæ‹¿ç€è¿™ä¸ªidå‘ä¸»è¿›ç¨‹è¯·æ±‚è®¿é—®å¯¹è±¡ã€‚</p><p>é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦é‡Šæ”¾è¿™äº›å¯¹è±¡å‘¢ï¼Ÿä¸‹æ–‡ä¼šè®²å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªä¸Šå›¾æ²¡æœ‰å±•ç¤ºå‡ºæ¥çš„ç»†èŠ‚æ˜¯ï¼ŒElectronä¸ä¼šé€’å½’å»è½¬æ¢å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªä¼šè½¬æ¢ä¸€å±‚ã€‚è¿™æ ·å¯ä»¥å®‰å…¨åœ°å¼•ç”¨å­˜åœ¨å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ã€å¦å¤–æ‰€æœ‰å±æ€§å€¼åº”è¯¥ä»è¿œç¨‹è·å–æœ€æ–°çš„å€¼ï¼Œä¸èƒ½å‡è®¾å®ƒçš„ç»“æ„ä¸å¯å˜ã€‚</p><p><br><br><br></p><h2 id="å¯¹è±¡çš„åºåˆ—åŒ–"><a href="#å¯¹è±¡çš„åºåˆ—åŒ–" class="headerlink" title="å¯¹è±¡çš„åºåˆ—åŒ–"></a>å¯¹è±¡çš„åºåˆ—åŒ–</h2><p>å…ˆæ¥çœ‹çœ‹ä¸»è¿›ç¨‹çš„å®ç°ï¼Œå®ƒçš„ä»£ç ä½äº<a href="https://github.com/electron/electron/blob/master/lib/browser/rpc-server.js" target="_blank" rel="noopener">/lib/browser/rpc-server.js</a>ï¼Œä»£ç å¾ˆå°‘è€Œä¸”å¾ˆå¥½ç†è§£ï¼Œè¯»è€…å¯ä»¥è‡ªå·±è¯»ä¸€ä¸‹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸å…³æ³¨å¯¹è±¡åºåˆ—åŒ–çš„ç»†èŠ‚ï¼Œé‡ç‚¹å…³æ³¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œè°ƒç”¨çš„æµç¨‹. </p><p><br></p><p>ä»¥<code>remote.require</code>ä¸ºä¾‹, è¿™ä¸ªæ–¹æ³•ç”¨äºè®©ä¸»è¿›ç¨‹å»requireæŒ‡å®šæ¨¡å—ï¼Œç„¶åè¿”å›æ¨¡å—å†…å®¹ç»™æ¸²æŸ“è¿›ç¨‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleRemoteCommand(<span class="string">'ELECTRON_BROWSER_REQUIRE'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, contextId, moduleName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨require</span></span><br><span class="line">  <span class="keyword">const</span> returnValue = process.mainModule.require(moduleName)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†returnValueåºåˆ—åŒ–ä¸ºMetaData</span></span><br><span class="line">  <span class="keyword">return</span> valueToMeta(event.sender, contextId, returnValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>handleRemoteCommand</code> ä½¿ç”¨<a href="https://electronjs.org/docs/api/ipc-main" target="_blank" rel="noopener">ipcMain</a>ç›‘å¬rendererå‘é€çš„è¯·æ±‚ï¼Œ<code>contextId</code>ç”¨äºæ ‡è¯†ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚</p><p><br></p><p><code>valueToMeta</code>æ–¹æ³•å°†å€¼åºåˆ—åŒ–ä¸ºMetaData:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> valueToMeta = <span class="function"><span class="keyword">function</span> (<span class="params">sender, contextId, value, optimizeSimpleObject = false</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Determine the type of value.</span></span><br><span class="line">  <span class="keyword">const</span> meta = &#123; <span class="attr">type</span>: <span class="keyword">typeof</span> value &#125;</span><br><span class="line">  <span class="keyword">if</span> (meta.type === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="comment">// Recognize certain types of objects.</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">null</span>) &#123;</span><br><span class="line">      meta.type = <span class="string">'value'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bufferUtils.isBuffer(value)) &#123;</span><br><span class="line">      <span class="comment">// ... ğŸ”´ åŸºæœ¬ç±»å‹</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (meta.type === <span class="string">'array'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ æ•°ç»„è½¬æ¢</span></span><br><span class="line">    meta.members = value.map(<span class="function">(<span class="params">el</span>) =&gt;</span> valueToMeta(sender, contextId, el, optimizeSimpleObject))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'object'</span> || meta.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">    meta.name = value.constructor ? value.constructor.name : <span class="string">''</span></span><br><span class="line">    <span class="comment">// ğŸ”´ å°†å¯¹è±¡ä¿å­˜åˆ°æ³¨å†Œè¡¨ä¸­ï¼Œå¹¶è¿”å›å”¯ä¸€çš„å¯¹è±¡id.</span></span><br><span class="line">    <span class="comment">// Electronä¼šå‡è®¾æ¸²æŸ“è¿›ç¨‹ä¼šä¸€ç›´å¼•ç”¨è¿™ä¸ªå¯¹è±¡, ç›´åˆ°æ¸²æŸ“è¿›ç¨‹é€€å‡º</span></span><br><span class="line">    meta.id = objectsRegistry.add(sender, contextId, value)</span><br><span class="line">    meta.members = getObjectMembers(value)</span><br><span class="line">    meta.proto = getObjectPrototype(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'buffer'</span>) &#123;</span><br><span class="line">    meta.value = bufferUtils.bufferToMeta(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'promise'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´promise</span></span><br><span class="line">    value.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;)</span><br><span class="line">    meta.then = valueToMeta(sender, contextId, <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">      value.then(onFulfilled, onRejected)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'error'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´é”™è¯¯å¯¹è±¡</span></span><br><span class="line">    meta.members = plainObjectToMeta(value)</span><br><span class="line">    meta.members.push(&#123;</span><br><span class="line">      name: <span class="string">'name'</span>,</span><br><span class="line">      value: value.name</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'date'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´æ—¥æœŸ</span></span><br><span class="line">    meta.value = value.getTime()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–</span></span><br><span class="line">    meta.type = <span class="string">'value'</span></span><br><span class="line">    meta.value = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> meta</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="å½±å­å¯¹è±¡"><a href="#å½±å­å¯¹è±¡" class="headerlink" title="å½±å­å¯¹è±¡"></a>å½±å­å¯¹è±¡</h2><p><img src="/images/electron-remote/naruto.jpeg" alt></p><p>æ¸²æŸ“è¿›ç¨‹ä¼šä»MetaDataä¸­ååºåˆ—åŒ–çš„å¯¹è±¡æˆ–å‡½æ•°, ä¸è¿‡è¿™åªæ˜¯ä¸€ä¸ªâ€˜å½±å­â€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒä»¬ç§°ä¸º<strong>å½±å­å¯¹è±¡</strong>æˆ–è€…<strong>ä»£ç†å¯¹è±¡</strong>ã€<strong>æ›¿èº«</strong>. ç±»ä¼¼äºç«å½±å¿è€…ä¸­çš„å½±åˆ†èº«ä¹‹æœ¯ï¼Œä¸»ä½“å­˜å‚¨åœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œå½±å­å¯¹è±¡ä¸åŒ…å«ä»»ä½•å®ä½“æ•°æ®ï¼Œå½“è®¿é—®è¿™äº›å¯¹è±¡æˆ–è°ƒç”¨å‡½æ•°/æ–¹æ³•æ—¶ï¼Œå½±å­å¯¹è±¡ç›´æ¥è¿œç¨‹è¯·æ±‚ã€‚</p><blockquote><p>æ¸²æŸ“è¿›ç¨‹çš„ä»£ç å¯ä»¥çœ‹<a href="https://github.com/electron/electron/blob/master/lib/renderer/api/remote.js" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><p>æ¥çœ‹çœ‹æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆåˆ›å»ºâ€˜å½±å­å¯¹è±¡â€™:</p><p><strong>å‡½æ•°çš„å¤„ç†</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (meta.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´åˆ›å»ºä¸€ä¸ª'å½±å­'å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> remoteFunction = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> command</span><br><span class="line">    <span class="comment">// é€šè¿‡new Objå½¢å¼è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>.constructor === remoteFunction) &#123;</span><br><span class="line">      command = <span class="string">'ELECTRON_BROWSER_CONSTRUCTOR'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      command = <span class="string">'ELECTRON_BROWSER_FUNCTION_CALL'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ğŸ”´åŒæ­¥IPCè¿œç¨‹</span></span><br><span class="line">    <span class="comment">// wrapArgså°†å‡½æ•°å‚æ•°åºåˆ—åŒ–ä¸ºMetaData</span></span><br><span class="line">    <span class="keyword">const</span> obj = ipcRendererInternal.sendSync(command, contextId, meta.id, wrapArgs(args))</span><br><span class="line">    <span class="comment">// ğŸ”´ååºåˆ—åŒ–è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> metaToValue(obj)</span><br><span class="line">  &#125;</span><br><span class="line">  ret = remoteFunction</span><br></pre></td></tr></table></figure><p><br></p><p><strong>å¯¹è±¡æˆå‘˜çš„å¤„ç†</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setObjectMembers</span> (<span class="params">ref, object, metaId, members</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> member <span class="keyword">of</span> members) &#123;</span><br><span class="line">    <span class="keyword">if</span> (object.hasOwnProperty(member.name)) <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> descriptor = &#123; <span class="attr">enumerable</span>: member.enumerable &#125;</span><br><span class="line">    <span class="keyword">if</span> (member.type === <span class="string">'method'</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´åˆ›å»ºâ€˜å½±å­â€™æ–¹æ³•. å’Œä¸Šé¢çš„å‡½æ•°è°ƒç”¨å·®ä¸å¤š</span></span><br><span class="line">      <span class="keyword">const</span> remoteMemberFunction = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> command</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>.constructor === remoteMemberFunction) &#123;</span><br><span class="line">          command = <span class="string">'ELECTRON_BROWSER_MEMBER_CONSTRUCTOR'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          command = <span class="string">'ELECTRON_BROWSER_MEMBER_CALL'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> ret = ipcRendererInternal.sendSync(command, contextId, metaId, member.name, wrapArgs(args))</span><br><span class="line">        <span class="keyword">return</span> metaToValue(ret)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (member.type === <span class="string">'get'</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´å±æ€§çš„è·å–</span></span><br><span class="line">      descriptor.get = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> command = <span class="string">'ELECTRON_BROWSER_MEMBER_GET'</span></span><br><span class="line">        <span class="keyword">const</span> meta = ipcRendererInternal.sendSync(command, contextId, metaId, member.name)</span><br><span class="line">        <span class="keyword">return</span> metaToValue(meta)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ğŸ”´å±æ€§çš„è®¾ç½®</span></span><br><span class="line">      <span class="keyword">if</span> (member.writable) &#123;</span><br><span class="line">        descriptor.set = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> args = wrapArgs([value])</span><br><span class="line">          <span class="keyword">const</span> command = <span class="string">'ELECTRON_BROWSER_MEMBER_SET'</span></span><br><span class="line">          <span class="keyword">const</span> meta = ipcRendererInternal.sendSync(command, contextId, metaId, member.name, args)</span><br><span class="line">          <span class="keyword">if</span> (meta != <span class="literal">null</span>) metaToValue(meta)</span><br><span class="line">          <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(object, member.name, descriptor)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><strong>ä¸»è¿›ç¨‹çš„<code>valueToMeta</code>ä¼šå°†æ¯ä¸€ä¸ªå¯¹è±¡å’Œå‡½æ•°éƒ½æ”¾å…¥æ³¨å†Œè¡¨ä¸­ï¼ŒåŒ…æ‹¬æ¯æ¬¡å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼</strong>ã€‚</p><p>è¿™æ˜¯å¦æ„å‘³ç€ï¼Œå¦‚æœé¢‘ç¹è°ƒç”¨å‡½æ•°ï¼Œä¼šå¯¼è‡´æ³¨å†Œè¡¨æš´æ¶¨å ç”¨å¤ªå¤šå†…å­˜å‘¢ï¼Ÿè¿™äº›å¯¹è±¡ä»€ä¹ˆæ—¶å€™é‡Šæ”¾?</p><p><br></p><p>é¦–å…ˆ<strong>å½“æ¸²æŸ“è¿›ç¨‹é”€æ¯æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šé›†ä¸­é”€æ¯æ‰è¯¥è¿›ç¨‹çš„æ‰€æœ‰å¯¹è±¡å¼•ç”¨</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸²æŸ“è¿›ç¨‹é€€å‡ºæ—¶ä¼šé€šè¿‡è¿™ä¸ªäº‹ä»¶å‘Šè¯‰ä¸»è¿›ç¨‹ï¼Œä½†æ˜¯è¿™ä¸ªå¹¶ä¸èƒ½ä¿è¯æ”¶åˆ°</span></span><br><span class="line">handleRemoteCommand(<span class="string">'ELECTRON_BROWSER_CONTEXT_RELEASE'</span>, (event, contextId) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ¸…ç©ºå¯¹è±¡æ³¨å†Œè¡¨</span></span><br><span class="line">  objectsRegistry.clear(event.sender, contextId)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>ELECTRON_BROWSER_CONTEXT_RELEASE</code>ä¸èƒ½ä¿è¯èƒ½å¤Ÿæ”¶åˆ°ï¼Œæ‰€ä»¥<code>objectsRegistry</code>è¿˜ä¼šç›‘å¬å¯¹åº”æ¸²æŸ“è¿›ç¨‹çš„é”€æ¯äº‹ä»¶:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectsRegistry</span> </span>&#123;</span><br><span class="line">    registerDeleteListener (webContents, contextId) &#123;</span><br><span class="line">    <span class="comment">// contextId =&gt; $&#123;processHostId&#125;-$&#123;contextCount&#125;</span></span><br><span class="line">    <span class="keyword">const</span> processHostId = contextId.split(<span class="string">'-'</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> listener = <span class="function">(<span class="params">event, deletedProcessHostId</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (deletedProcessHostId &amp;&amp;</span><br><span class="line">          deletedProcessHostId.toString() === processHostId) &#123;</span><br><span class="line">        webContents.removeListener(<span class="string">'render-view-deleted'</span>, listener)</span><br><span class="line">        <span class="keyword">this</span>.clear(webContents, contextId)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ğŸ”´ ç›‘å¬æ¸²æŸ“è¿›ç¨‹é”€æ¯äº‹ä»¶, ç¡®ä¿ä¸‡æ— ä¸€å¤±</span></span><br><span class="line">    webContents.on(<span class="string">'render-view-deleted'</span>, listener)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç­‰<strong>åˆ°æ¸²æŸ“è¿›ç¨‹é”€æ¯å†å»é‡Šæ”¾è¿™äº›å¯¹è±¡æ˜¾ç„¶æ˜¯æ— æ³•æ¥å—çš„</strong>ï¼Œå’Œç½‘é¡µä¸ä¸€æ ·ï¼Œæ¡Œé¢ç«¯åº”ç”¨å¯èƒ½ä¼š7*24ä¸é—´æ–­è¿è¡Œï¼Œå¦‚æœè¦ç­‰åˆ°æ¸²æŸ“è¿›ç¨‹é€€å‡ºæ‰å»å›æ”¶å¯¹è±¡, æœ€ç»ˆä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºè¢«æ¶ˆè€—æ®†å°½ã€‚</p><p>æ‰€ä»¥<strong>Electronä¼šåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ç›‘å¬å¯¹è±¡çš„åƒåœ¾å›æ”¶äº‹ä»¶ï¼Œå†é€šè¿‡IPCé€šçŸ¥ä¸»è¿›ç¨‹æ¥é€’å‡å¯¹åº”å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</strong>ï¼Œ çœ‹çœ‹æ¸²æŸ“è¿›ç¨‹æ˜¯æ€ä¹ˆåšçš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¸²æŸ“è¿›ç¨‹ï¼Œååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">metaToValue</span> (<span class="params">meta</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹è±¡ç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="keyword">let</span> ret</span><br><span class="line">    <span class="keyword">if</span> (remoteObjectCache.has(meta.id)) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´ å¯¹è±¡å†ä¸€æ¬¡è¢«è®¿é—®ï¼Œé€’å¢å¯¹è±¡å¼•ç”¨è®¡æ•°. </span></span><br><span class="line">      <span class="comment">// v8Utilæ˜¯electronåŸç”Ÿæ¨¡å—</span></span><br><span class="line">      v8Util.addRemoteObjectRef(contextId, meta.id)</span><br><span class="line">      <span class="keyword">return</span> remoteObjectCache.get(meta.id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå½±å­ç±»è¡¨ç¤ºè¿œç¨‹å‡½æ•°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (meta.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> remoteFunction = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">      ret = remoteFunction</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ret = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setObjectMembers(ret, ret, meta.id, meta.members)</span><br><span class="line">    setObjectPrototype(ret, ret, meta.id, meta.proto)</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(ret.constructor, <span class="string">'name'</span>, &#123; <span class="attr">value</span>: meta.name &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”´ ç›‘å¬å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œé€šçŸ¥åˆ°ä¸»è¿›ç¨‹</span></span><br><span class="line">    v8Util.setRemoteObjectFreer(ret, contextId, meta.id)</span><br><span class="line">    v8Util.setHiddenValue(ret, <span class="string">'atomId'</span>, meta.id)</span><br><span class="line">    <span class="comment">// ğŸ”´ æ·»åŠ å¯¹è±¡å¼•ç”¨è®¡æ•°</span></span><br><span class="line">    v8Util.addRemoteObjectRef(contextId, meta.id)</span><br><span class="line">    remoteObjectCache.set(meta.id, ret)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç®€å•äº†è§£ä¸€ä¸‹ObjectFreerä»£ç :</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// atom/common/api/remote_object_freer.cc</span></span><br><span class="line"><span class="comment">// æ·»åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line"><span class="keyword">void</span> RemoteObjectFreer::AddRef(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; context_id, <span class="keyword">int</span> object_id) &#123;</span><br><span class="line">  ref_mapper_[context_id][object_id]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡é‡Šæ”¾äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line"><span class="keyword">void</span> RemoteObjectFreer::RunDestructor() &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">auto</span>* channel = <span class="string">"ELECTRON_BROWSER_DEREFERENCE"</span>;</span><br><span class="line">  base::ListValue args;</span><br><span class="line">  args.AppendString(context_id_);</span><br><span class="line">  args.AppendInteger(object_id_);</span><br><span class="line">  args.AppendInteger(ref_mapper_[context_id_][object_id_]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ æ¸…ç©ºå¼•ç”¨è¡¨</span></span><br><span class="line">  ref_mapper_[context_id_].erase(object_id_);</span><br><span class="line">  <span class="keyword">if</span> (ref_mapper_[context_id_].empty())</span><br><span class="line">    ref_mapper_.erase(context_id_);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ ipcé€šçŸ¥ä¸»è¿›ç¨‹</span></span><br><span class="line">  electron_ptr-&gt;Message(<span class="literal">true</span>, channel, args.Clone());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å†å›åˆ°ä¸»è¿›ç¨‹, ä¸»è¿›ç¨‹ç›‘å¬<code>ELECTRON_BROWSER_DEREFERENCE</code>äº‹ä»¶ï¼Œå¹¶é€’å‡æŒ‡å®šå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleRemoteCommand(<span class="string">'ELECTRON_BROWSER_DEREFERENCE'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, contextId, id, rendererSideRefCount</span>) </span>&#123;</span><br><span class="line">  objectsRegistry.remove(event.sender, contextId, id, rendererSideRefCount)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚æœè¢«ä¸Šé¢çš„ä»£ç ç»•å¾—ä¼˜ç‚¹æ™•ï¼Œé‚£å°±çœ‹çœ‹ä¸‹é¢çš„æµç¨‹å›¾, æ¶ˆåŒ–æ¶ˆåŒ–ï¼š</p><p><img src="/images/electron-remote/lifetime.png" alt></p><p><br><br><br></p><h2 id="æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ"><a href="#æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ"></a>æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ</h2><p>åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œé€šè¿‡remoteè¿˜å¯ä»¥ç»™ä¸»è¿›ç¨‹çš„å‡½æ•°ä¼ é€’å›è°ƒã€‚å…¶å®è·Ÿä¸»è¿›ç¨‹æš´éœ²å‡½æ•°/å¯¹è±¡ç»™æ¸²æŸ“è¿›ç¨‹çš„åŸç†ä¸€æ ·ï¼Œæ¸²æŸ“è¿›ç¨‹åœ¨å°†å›è°ƒä¼ é€’ç»™ä¸»è¿›ç¨‹ä¹‹å‰ä¼šæ”¾ç½®åˆ°<strong>å›è°ƒæ³¨å†Œè¡¨</strong>ä¸­ï¼Œç„¶åç»™ä¸»è¿›ç¨‹æš´éœ²ä¸€ä¸ªcallbackIDã€‚</p><p>æ¸²æŸ“è¿›ç¨‹ä¼šè°ƒç”¨<code>wrapArgs</code>å°†å‡½æ•°è°ƒç”¨å‚æ•°åºåˆ—åŒ–ä¸ºMetaData:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapArgs</span> (<span class="params">args, visited = new Set(</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> valueToMeta = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ é˜²æ­¢å¾ªç¯å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (visited.has(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        type: <span class="string">'value'</span>,</span><br><span class="line">        value: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–ç±»å‹çš„å¤„ç†ï¼Œè¿™äº›ç±»å‹åŸºæœ¬éƒ½æ˜¯å€¼æ‹·è´</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        type: <span class="string">'function'</span>,</span><br><span class="line">        <span class="comment">// ğŸ”´ ç»™ä¸»è¿›ç¨‹ä¼ é€’callbackIdï¼Œå¹¶æ·»åŠ åˆ°å›è°ƒæ³¨å†Œè¡¨ä¸­</span></span><br><span class="line">        id: callbacksRegistry.add(value),</span><br><span class="line">        location: v8Util.getHiddenValue(value, <span class="string">'location'</span>),</span><br><span class="line">        length: value.length</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å›åˆ°ä¸»è¿›ç¨‹ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„<code>unwrapArgs</code>å‡½æ•°æ¥ååºåˆ—åŒ–å‡½æ•°å‚æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> unwrapArgs = <span class="function"><span class="keyword">function</span> (<span class="params">sender, frameId, contextId, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> metaToValue = <span class="function"><span class="keyword">function</span> (<span class="params">meta</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (meta.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'value'</span>:</span><br><span class="line">        <span class="keyword">return</span> meta.value</span><br><span class="line">      <span class="comment">// ... çœç•¥</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'function'</span>: &#123;</span><br><span class="line">        <span class="keyword">const</span> objectId = [contextId, meta.id]</span><br><span class="line">        <span class="comment">// å›è°ƒç¼“å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (rendererFunctions.has(objectId)) &#123;</span><br><span class="line">          <span class="keyword">return</span> rendererFunctions.get(objectId)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ”´ å°è£…å½±å­å‡½æ•°</span></span><br><span class="line">        <span class="keyword">const</span> callIntoRenderer = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">let</span> succeed = <span class="literal">false</span></span><br><span class="line">          <span class="keyword">if</span> (!sender.isDestroyed()) &#123;</span><br><span class="line">            <span class="comment">// ğŸ”´ è°ƒç”¨æ—¶ï¼Œé€šè¿‡IPCé€šçŸ¥æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">            <span class="comment">// å¿½ç•¥å›è°ƒè¿”å›å€¼</span></span><br><span class="line">            succeed = sender._sendToFrameInternal(frameId, <span class="string">'ELECTRON_RENDERER_CALLBACK'</span>, contextId, meta.id, valueToMeta(sender, contextId, args))</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!succeed) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰å‘é€æˆåŠŸåˆ™è¡¨æ˜æ¸²æŸ“è¿›ç¨‹çš„å›è°ƒå¯èƒ½è¢«é‡Šæ”¾äº†ï¼Œè¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">            <span class="comment">// è¿™ç§æƒ…å†µæ¯”è¾ƒå¸¸è§ï¼Œæ¯”å¦‚è¢«æ¸²æŸ“è¿›ç¨‹åˆ·æ–°äº†</span></span><br><span class="line">            removeRemoteListenersAndLogWarning(<span class="keyword">this</span>, callIntoRenderer)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v8Util.setHiddenValue(callIntoRenderer, <span class="string">'location'</span>, meta.location)</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(callIntoRenderer, <span class="string">'length'</span>, &#123; <span class="attr">value</span>: meta.length &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ”´ ç›‘å¬å›è°ƒå‡½æ•°åƒåœ¾å›æ”¶äº‹ä»¶</span></span><br><span class="line">        v8Util.setRemoteCallbackFreer(callIntoRenderer, contextId, meta.id, sender)</span><br><span class="line">        rendererFunctions.set(objectId, callIntoRenderer)</span><br><span class="line">        <span class="keyword">return</span> callIntoRenderer</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`Unknown type: <span class="subst">$&#123;meta.type&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> args.map(metaToValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“è¿›ç¨‹å“åº”å°±æ¯”è¾ƒç®€å•äº†ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleMessage(<span class="string">'ELECTRON_RENDERER_CALLBACK'</span>, (id, args) =&gt; &#123;</span><br><span class="line">  callbacksRegistry.apply(id, metaToValue(args))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>é‚£å›è°ƒä»€ä¹ˆæ—¶å€™é‡Šæ”¾å‘¢ï¼Ÿè¿™ä¸ªç›¸æ¯”æ¸²æŸ“è¿›ç¨‹çš„å¯¹è±¡å¼•ç”¨è¦ç®€å•å¾ˆå¤šï¼Œå› ä¸ºä¸»è¿›ç¨‹åªæœ‰ä¸€ä¸ªã€‚é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“, <code>setRemoteCallbackFreer</code>ä¼šç›‘å¬å½±å­å›è°ƒæ˜¯å¦è¢«åƒåœ¾å›æ”¶ï¼Œä¸€æ—¦è¢«åƒåœ¾å›æ”¶äº†åˆ™é€šçŸ¥æ¸²æŸ“è¿›ç¨‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">handleMessage(<span class="string">'ELECTRON_RENDERER_RELEASE_CALLBACK'</span>, (id) =&gt; &#123;</span><br><span class="line">  callbacksRegistry.remove(id)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ¥ä¸ªæµç¨‹å›¾:</p><p><img src="/images/electron-remote/callback.png" alt></p><p><br><br><br></p><h2 id="ä¸€äº›ç¼ºé™·"><a href="#ä¸€äº›ç¼ºé™·" class="headerlink" title="ä¸€äº›ç¼ºé™·"></a>ä¸€äº›ç¼ºé™·</h2><p>remoteæœºåˆ¶åªæ˜¯å¯¹è¿œç¨‹å¯¹è±¡çš„ä¸€ä¸ªâ€˜å½±åˆ†èº«â€™ï¼Œæ— æ³•ç™¾åˆ†ç™¾å’Œè¿œç¨‹å¯¹è±¡çš„è¡Œä¸ºä¿æŒä¸€è‡´ï¼Œä¸‹é¢æ˜¯ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç¼ºé™·:</p><ul><li>å½“æ¸²æŸ“è¿›ç¨‹è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•/å‡½æ•°æ—¶ï¼Œæ˜¯è¿›è¡ŒåŒæ­¥IPCé€šä¿¡çš„ã€‚æ¢è¨€ä¹‹ï¼ŒåŒæ­¥IPCè°ƒç”¨ä¼šé˜»å¡ç”¨æˆ·ä»£ç çš„æ‰§è¡Œï¼Œè€Œä¸”è·¨ç«¯çš„é€šä¿¡æ•ˆç‡æ— æ³•å’ŒåŸç”Ÿå‡½æ•°è°ƒç”¨ç›¸æ¯”ï¼Œæ‰€ä»¥é¢‘ç¹çš„IPCè°ƒç”¨ä¼šå½±å“ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ€§èƒ½.</li><li>ä¸»è¿›ç¨‹ä¼šä¿æŒå¼•ç”¨æ¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹è®¿é—®çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬å‡½æ•°çš„è¿”å›å€¼ã€‚åŒç†ï¼Œé¢‘ç¹çš„è¿œç¨‹å¯¹è±¡è¯·æ±‚ï¼Œå¯¹å†…å­˜çš„å ç”¨å’Œåƒåœ¾å›æ”¶é€ æˆä¸å°çš„å‹åŠ›</li><li>æ— æ³•å®Œå…¨æ¨¡æ‹ŸJavaScriptå¯¹è±¡çš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨remoteæ¨¡å—ä¸­å­˜åœ¨è¿™äº›é—®é¢˜:<ul><li>æ•°ç»„å±äºâ€™åŸºæœ¬å¯¹è±¡â€™ï¼Œå®ƒæ˜¯é€šè¿‡å€¼æ‹·è´ä¼ é€’ç»™å¯¹ç«¯çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä¸æ˜¯ä¸€ä¸ªâ€˜å¼•ç”¨å¯¹è±¡â€™ï¼Œåœ¨å¯¹ç«¯ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œæ— æ³•ååº”åˆ°åŸå§‹çš„æ•°ç»„.</li><li>å¯¹è±¡åœ¨ç¬¬ä¸€æ¬¡å¼•ç”¨æ—¶ï¼Œåªæœ‰å¯æšä¸¾çš„å±æ€§å¯ä»¥è¿œç¨‹è®¿é—®ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸€å¼€å§‹å¯¹è±¡çš„å¤–å½¢å°±ç¡®å®šä¸‹æ¥äº†ï¼Œå¦‚æœè¿œç¨‹å¯¹è±¡åŠ¨æ€æ‰©å±•äº†å±æ€§ï¼Œæ˜¯æ— æ³•è¢«è¿œç¨‹è®¿é—®åˆ°çš„</li><li>æ¸²æŸ“è¿›ç¨‹ä¼ é€’çš„å›è°ƒä¼šè¢«å¼‚æ­¥è°ƒç”¨ï¼Œè€Œä¸”ä¸»è¿›ç¨‹ä¼šå¿½ç•¥å®ƒçš„è¿”å›å€¼ã€‚å¼‚æ­¥è°ƒç”¨æ˜¯ä¸ºäº†é¿å…äº§ç”Ÿæ­»é”</li></ul></li><li>å¯¹è±¡æ³„éœ²ã€‚<ul><li>å¦‚æœè¿œç¨‹å¯¹è±¡åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ³„éœ²ï¼ˆä¾‹å¦‚å­˜å‚¨åœ¨æ˜ å°„ä¸­ï¼Œä½†ä»æœªé‡Šæ”¾ï¼‰ï¼Œåˆ™ä¸»è¿›ç¨‹ä¸­çš„ç›¸åº”å¯¹è±¡ä¹Ÿå°†è¢«æ³„æ¼ï¼Œæ‰€ä»¥æ‚¨åº”è¯¥éå¸¸å°å¿ƒï¼Œä¸è¦æ³„æ¼è¿œç¨‹å¯¹è±¡ã€‚</li><li>åœ¨ç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒæ—¶ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒï¼Œä¸»è¿›ç¨‹ä¼šä¿æŒå›è°ƒçš„å¼•ç”¨ï¼Œç›´åˆ°å®ƒè¢«é‡Šæ”¾ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨remoteæ¨¡å—è¿›è¡Œä¸€äº›â€˜äº‹ä»¶è®¢é˜…â€™æ—¶ï¼Œåˆ‡è®°è¦è§£é™¤äº‹ä»¶è®¢é˜….</li><li>è¿˜æœ‰ä¸€ç§åœºæ™¯ï¼Œä¸‹æ–‡ä¼šæåˆ°</li></ul></li></ul><p><br><br><br></p><h2 id="remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–"><a href="#remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–" class="headerlink" title="remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–"></a>remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–</h2><p><img src="/images/electron-remote/gzb.png" alt></p><p>ä¸Šé¢æ˜¯æˆ‘å‚ä¸è¿‡çš„æŸä¸ªé¡¹ç›®çš„è½¯ä»¶æ¶æ„å›¾ï¼Œ<code>Hybrid</code>å±‚ä½¿ç”¨C/C++ç¼–å†™ï¼Œå°è£…äº†è·¨å¹³å°çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æ­¤ä¹‹ä¸Šæ¥æ„å»ºå„ä¸ªå¹³å°çš„è§†å›¾ã€‚å…¶ä¸­æ¡Œé¢ç«¯æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ElectronæŠ€æœ¯ã€‚</p><p>å¦‚ä¸Šå›¾ï¼ŒBridgeè¿›æ˜¯å¯¹Hybridçš„ä¸€å±‚Nodeæ¡¥æ¥å°è£…ã€‚ä¸€ä¸ªåº”ç”¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªBridgeå®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬çš„åšæ³•æ˜¯ä½¿ç”¨Electronçš„remoteæ¨¡å—ï¼Œè®©æ¸²æŸ“è¿›ç¨‹é€šè¿‡ä¸»è¿›ç¨‹é—´æ¥åœ°è®¿é—®Bridge.</p><p><br></p><p>é¡µé¢éœ€è¦ç›‘å¬Bridgeçš„ä¸€äº›äº‹ä»¶ï¼Œæœ€åˆæˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bridge.ts</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨remoteçš„ä¸€ä¸ªå¥½å¤„æ—¶ï¼Œå¯ä»¥é…åˆTypescriptå®ç°è¾ƒå¥½çš„ç±»å‹æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">const</span> bridge = electron.remote.require(<span class="string">'bridge'</span>) <span class="keyword">as</span> <span class="keyword">typeof</span> <span class="keyword">import</span>(<span class="string">'bridge'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> bridge</span><br></pre></td></tr></table></figure><p>ç›‘å¬Bridgeäº‹ä»¶:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> bridge <span class="keyword">from</span> <span class="string">'~/bridge'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Store <span class="keyword">extends</span> MobxStore &#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  pageReady() &#123;</span><br><span class="line">    <span class="keyword">this</span>.someEventDispose = bridge.addListener(<span class="string">'someEvent'</span>, <span class="keyword">this</span>.handleSomeEvent)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¡µé¢å…³é—­</span></span><br><span class="line">  pageWillClose() &#123;</span><br><span class="line">    <span class="keyword">this</span>.someEventDispose()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾å¦‚ä¸‹:</p><p><img src="/images/electron-remote/addListener.png" alt></p><p>è¿™ç§æ–¹å¼å­˜åœ¨å¾ˆå¤šé—®é¢˜:</p><ul><li><p>ä¸»è¿›ç¨‹éœ€è¦ä¸ºæ¯ä¸€ä¸ªaddListenerå›è°ƒéƒ½ç»´æŒä¸€ä¸ªå¼•ç”¨ã€‚ä¸Šé¢çš„ä»£ç ä¼šåœ¨é¡µé¢å…³é—­æ—¶é‡Šæ”¾è®¢é˜…ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è€ƒè™‘ç”¨æˆ·åˆ·æ–°é¡µé¢æˆ–è€…é¡µé¢å´©æºƒçš„åœºæ™¯ã€‚è¿™ä¼šå¯¼è‡´å›è°ƒåœ¨ä¸»è¿›ç¨‹æ³„éœ²ã€‚</p><p>ç„¶è€Œå°±ç®—Electronå¯ä»¥åœ¨è°ƒç”¨å›è°ƒæ—¶å‘ç°å›è°ƒåœ¨æ¸²æŸ“è¿›ç¨‹å·²ç»è¢«é‡Šæ”¾æ‰äº†ï¼Œä½†æ˜¯å¼€å‘è€…å´è·å–ä¸åˆ°è¿™äº›ä¿¡æ¯ï¼Œ Bridgeä¼šå§‹ç»ˆä¿æŒå¯¹å½±å­å›è°ƒçš„å¼•ç”¨.</p></li><li><p>å¦å¤–ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„æ˜¯è°ƒç”¨æ•ˆç‡çš„é—®é¢˜ã€‚å‡è®¾é¡µé¢ç›‘å¬äº†Næ¬¡Aäº‹ä»¶ï¼Œå½“Aäº‹ä»¶è§¦å‘æ—¶ï¼Œä¸»è¿›ç¨‹éœ€è¦ç»™è¿™ä¸ªé¡µé¢å‘é€Nä¸ªé€šçŸ¥ã€‚</p></li></ul><p><br></p><p>åæ¥æˆ‘ä»¬æŠ›å¼ƒäº†ä½¿ç”¨remoteè¿›è¡Œäº‹ä»¶è®¢é˜…è¿™ç§æ–¹å¼ï¼Œè®©ä¸»è¿›ç¨‹æ¥ç»´æŠ¤è¿™ç§è®¢é˜…å…³ç³», å¦‚ä¸‹å›¾:</p><p><img src="/images/electron-remote/addListener2.png" alt></p><p>æˆ‘ä»¬æ”¹è¿›äº†å¾ˆå¤šä¸œè¥¿ï¼š</p><p><strong>ä¸»è¿›ç¨‹ç°åœ¨åªç»´æŠ¤â€˜å“ªä¸ªé¡µé¢â€™è®¢é˜…äº†å“ªä¸ªäº‹ä»¶ï¼Œä»â€˜ç»‘å®šå›è°ƒâ€™è¿›åŒ–æˆä¸ºâ€˜ç»‘å®šé¡µé¢â€™</strong>ã€‚è¿™æ ·å¯ä»¥è§£å†³ä¸Šé¢è°ƒç”¨æ•ˆç‡å’Œå›è°ƒæ³„éœ²é—®é¢˜ã€æ¯”å¦‚ä¸ä¼šå› ä¸ºé¡µé¢åˆ·æ–°å¯¼è‡´å›è°ƒæ³„éœ², å¹¶ä¸”å½“äº‹ä»¶è§¦å‘æ—¶åªä¼šé€šçŸ¥ä¸€æ¬¡é¡µé¢ã€‚</p><p>å¦å¤–è¿™é‡Œå‚è€ƒäº†remoteæœ¬èº«çš„å®ç°ï¼Œåœ¨é¡µé¢é”€æ¯æ—¶ç§»é™¤è¯¥é¡µé¢çš„æ‰€æœ‰è®¢é˜…ã€‚ç›¸æ¯”æ¯”remoteé»‘ç›’ï¼Œæˆ‘ä»¬è‡ªå·±æ¥å®ç°è¿™ç§äº‹ä»¶è®¢é˜…å…³ç³»æ¯”ä¹‹å‰è¦æ›´å¥½è°ƒè¯•ã€‚</p><p><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>remoteæ¨¡å—å¯¹äºElectronå¼€å‘æœ‰å¾ˆé‡è¦çš„æ„ä¹‰ï¼Œæ¯•ç«Ÿå¾ˆå¤šæ¨¡å—åªæœ‰åœ¨ä¸»è¿›ç¨‹æ‰èƒ½è®¿é—®ï¼Œæ¯”å¦‚BrowserWindowã€dialog. </p><p>ç›¸æ¯”ipcé€šä¿¡ï¼Œremoteå®åœ¨æ–¹é¢å¾ˆå¤šã€‚é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬ä¹Ÿäº†è§£äº†å®ƒçš„åŸºæœ¬åŸç†å’Œç¼ºé™·ï¼Œæ‰€ä»¥remoteè™½å¥½ï¼Œåˆ‡å¿Œä¸è¦æ»¥ç”¨ã€‚</p><p>remoteçš„æºç ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå€¼å¾—å­¦ä¹ . æ¯•ç«Ÿå‰ç«¯ç›®å‰è·¨ç«¯é€šä¿¡éå¸¸å¸¸è§ï¼Œä¾‹å¦‚WebViewBridgeã€Worker. </p><p>remoteå¯ä»¥ç»™ä½ ä¸€äº›çµæ„Ÿï¼Œä½†æ˜¯è¦å®Œå…¨ç…§æ¬å®ƒæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ¯”å¦‚å®ƒä¾èµ–ä¸€äº›v8 â€˜Hackâ€™æ¥ç›‘å¬å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œæ™®é€šå¼€å‘åœºæ™¯æ˜¯åšä¸åˆ°çš„ã€‚</p><p>æœ¬æ–‡å®Œ.</p><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://electronjs.org/docs/api/remote" target="_blank" rel="noopener">Electron remote æ–‡æ¡£</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Electronçš„remoteæ¨¡å—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡çš„ä¸œè¥¿ï¼Œä¸º&lt;code&gt;æ¸²æŸ“è¿›ç¨‹&lt;/code&gt;å’Œ&lt;code&gt;ä¸»è¿›ç¨‹&lt;/code&gt;é€šä¿¡å°è£…äº†ä¸€ç§ç®€å•æ–¹æ³•ï¼Œé€šè¿‡remoteä½ å¯ä»¥â€™ç›´æ¥â€™è·å–ä¸»è¿›ç¨‹å¯¹è±¡æˆ–è€…è°ƒç”¨ä¸»è¿›ç¨‹å‡½æ•°æˆ–å¯¹è±¡çš„æ–¹æ³•, è€Œä¸å¿…æ˜¾å¼å‘é€è¿›ç¨‹é—´æ¶ˆæ¯, ç±»ä¼¼äº Java 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)</title>
    <link href="https://bobi.ink/2019/07/29/react-event/"/>
    <id>https://bobi.ink/2019/07/29/react-event/</id>
    <published>2019-07-28T16:00:00.000Z</published>
    <updated>2019-08-04T08:19:59.764Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/react-event/sample.png" alt></p><p>å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘. </p><p>å…·ä½“æ¥è®²ï¼ŒReactåˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶åœ¨Documentä¸Šç»Ÿä¸€ç›‘å¬DOMäº‹ä»¶ï¼Œå†æ ¹æ®è§¦å‘çš„targetå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹ã€‚å¦å¤–ä¸Šé¢eæ˜¯ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡(SyntheticEvent), è€Œä¸æ˜¯åŸå§‹çš„DOMäº‹ä»¶å¯¹è±¡.</p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ">é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</a></li><li><a href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a><ul><li><a href="#æ•´ä½“çš„æ¶æ„">æ•´ä½“çš„æ¶æ„</a></li><li><a href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§">äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</a></li></ul></li><li><a href="#å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</a><ul><li><a href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„">äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</a></li><li><a href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„">äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</a><ul><li><a href="#äº‹ä»¶è§¦å‘è°ƒåº¦">äº‹ä»¶è§¦å‘è°ƒåº¦</a></li><li><a href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶">æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</a></li><li><a href="#æ‰¹é‡æ‰§è¡Œ">æ‰¹é‡æ‰§è¡Œ</a></li></ul></li></ul></li><li><a href="#æœªæ¥">æœªæ¥</a><ul><li><a href="#åˆæ¢responderçš„åˆ›å»º">åˆæ¢Responderçš„åˆ›å»º</a></li><li><a href="#react-eventsæ„ä¹‰ä½•åœ¨">react-eventsæ„ä¹‰ä½•åœ¨?</a></li></ul></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><blockquote><p>æˆªæ­¢æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReactç‰ˆæœ¬æ˜¯16.8.6</p></blockquote><p><br></p><h2 id="é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ"><a href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ" class="headerlink" title="é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?"></a>é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</h2><p>å¦‚æœäº†è§£è¿‡Preact(ç¬”è€…ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« <a href="https://juejin.im/post/5cfa29e151882539c33e4f5e" target="_blank" rel="noopener">è§£æPreactçš„æºç </a>)ï¼ŒPreactè£å‰ªäº†å¾ˆå¤šReactçš„ä¸œè¥¿ï¼Œå…¶ä¸­åŒ…æ‹¬äº‹ä»¶æœºåˆ¶ï¼ŒPreactæ˜¯ç›´æ¥åœ¨DOMå…ƒç´ ä¸Šè¿›è¡Œäº‹ä»¶ç»‘å®šçš„ã€‚</p><p>åœ¨ç ”ç©¶ä¸€ä¸ªäº‹ç‰©ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆè¦é—®ä¸ºä»€ä¹ˆï¼Ÿäº†è§£å®ƒçš„åŠ¨æœºï¼Œæ‰æœ‰åˆ©äºä½ å¯¹å®ƒæœ‰æœ¬è´¨çš„è®¤è¯†ã€‚</p><p>Reactè‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿçš„åŠ¨æœºæœ‰ä»¥ä¸‹å‡ ä¸ª:</p><ul><li><p><strong>1. æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å…¼å®¹æ€§å·®å¼‚</strong>ã€‚ è¿™æ˜¯ä¼°è®¡æœ€åŸå§‹çš„åŠ¨æœºï¼ŒReactæ ¹æ®<a href="https://www.w3.org/TR/DOM-Level-3-Events/" target="_blank" rel="noopener">W3C è§„èŒƒ</a>æ¥å®šä¹‰è¿™äº›åˆæˆäº‹ä»¶(SyntheticEvent), æ„åœ¨æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>å¦å¤–Reactè¿˜ä¼šè¯•å›¾é€šè¿‡å…¶ä»–ç›¸å…³äº‹ä»¶æ¥æ¨¡æ‹Ÿä¸€äº›ä½ç‰ˆæœ¬ä¸å…¼å®¹çš„äº‹ä»¶, è¿™æ‰æ˜¯â€˜åˆæˆâ€™çš„æœ¬æ¥æ„æ€å§ï¼Ÿã€‚</p></li><li><p><strong>2. äº‹ä»¶â€˜åˆæˆâ€™, å³äº‹ä»¶è‡ªå®šä¹‰</strong>ã€‚äº‹ä»¶åˆæˆé™¤äº†å¤„ç†å…¼å®¹æ€§é—®é¢˜ï¼Œè¿˜å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰é«˜çº§äº‹ä»¶ï¼Œæ¯”è¾ƒå…¸å‹çš„æ˜¯Reactçš„onChangeäº‹ä»¶ï¼Œå®ƒä¸ºè¡¨å•å…ƒç´ å®šä¹‰äº†ç»Ÿä¸€çš„å€¼å˜åŠ¨äº‹ä»¶ã€‚å¦å¤–ç¬¬ä¸‰æ–¹ä¹Ÿå¯ä»¥é€šè¿‡Reactçš„äº‹ä»¶æ’ä»¶æœºåˆ¶æ¥åˆæˆè‡ªå®šä¹‰äº‹ä»¶ï¼Œå°½ç®¡å¾ˆå°‘äººè¿™ä¹ˆåšã€‚</p></li><li><p><strong>3. æŠ½è±¡è·¨å¹³å°äº‹ä»¶æœºåˆ¶</strong>ã€‚ å’ŒVirtualDOMçš„æ„ä¹‰å·®ä¸å¤šï¼ŒVirtualDOMæŠ½è±¡äº†è·¨å¹³å°çš„æ¸²æŸ“æ–¹å¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„SyntheticEventç›®çš„ä¹Ÿæ˜¯æƒ³æä¾›ä¸€ä¸ªæŠ½è±¡çš„è·¨å¹³å°äº‹ä»¶æœºåˆ¶ã€‚</p></li><li><p><strong>4. Reactæ‰“ç®—åšæ›´å¤šä¼˜åŒ–</strong>ã€‚æ¯”å¦‚åˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶ï¼Œå¤§éƒ¨åˆ†äº‹ä»¶æœ€ç»ˆç»‘å®šåˆ°äº†Documentï¼Œè€Œä¸æ˜¯DOMèŠ‚ç‚¹æœ¬èº«. è¿™æ ·ç®€åŒ–äº†DOMäº‹ä»¶å¤„ç†é€»è¾‘ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€. ä½†è¿™ä¹Ÿæ„å‘³ç€ï¼Œ<strong>Reactéœ€è¦è‡ªå·±æ¨¡æ‹Ÿä¸€å¥—äº‹ä»¶å†’æ³¡çš„æœºåˆ¶</strong>ã€‚</p></li><li><p><strong>5. Reactæ‰“ç®—å¹²é¢„äº‹ä»¶çš„åˆ†å‘</strong>ã€‚v16å¼•å…¥Fiberæ¶æ„ï¼ŒReactä¸ºäº†ä¼˜åŒ–ç”¨æˆ·çš„äº¤äº’ä½“éªŒï¼Œä¼šå¹²é¢„äº‹ä»¶çš„åˆ†å‘ã€‚ä¸åŒç±»å‹çš„äº‹ä»¶æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚é«˜ä¼˜å…ˆçº§çš„äº‹ä»¶å¯ä»¥ä¸­æ–­æ¸²æŸ“ï¼Œè®©ç”¨æˆ·ä»£ç å¯ä»¥åŠæ—¶å“åº”ç”¨æˆ·äº¤äº’ã€‚</p></li></ul><p><br></p><p>Ok, åé¢æˆ‘ä»¬ä¼šæ·±å…¥äº†è§£Reactçš„äº‹ä»¶å®ç°ï¼Œæˆ‘ä¼šå°½é‡ä¸è´´ä»£ç ï¼Œç”¨æµç¨‹å›¾è¯´è¯ã€‚</p><p><br></p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ•´ä½“çš„æ¶æ„"><a href="#æ•´ä½“çš„æ¶æ„" class="headerlink" title="æ•´ä½“çš„æ¶æ„"></a>æ•´ä½“çš„æ¶æ„</h3><p><img src="/images/react-event/st.png" alt></p><ul><li><strong>ReactEventListener</strong> - äº‹ä»¶å¤„ç†å™¨. åœ¨è¿™é‡Œè¿›è¡Œäº‹ä»¶å¤„ç†å™¨çš„ç»‘å®šã€‚å½“DOMè§¦å‘äº‹ä»¶æ—¶ï¼Œä¼šä»è¿™é‡Œå¼€å§‹è°ƒåº¦åˆ†å‘åˆ°Reactç»„ä»¶æ ‘</li><li><strong>ReactEventEmitter</strong> - æš´éœ²æ¥å£ç»™Reactç»„ä»¶å±‚ç”¨äºæ·»åŠ äº‹ä»¶è®¢é˜…</li><li><strong>EventPluginHub</strong> - å¦‚å…¶åï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜æ’ä»¶æ’æ§½â€™ï¼Œè´Ÿè´£ç®¡ç†å’Œæ³¨å†Œå„ç§æ’ä»¶ã€‚åœ¨äº‹ä»¶åˆ†å‘æ—¶ï¼Œè°ƒç”¨æ’ä»¶æ¥ç”Ÿæˆåˆæˆäº‹ä»¶</li><li><p><strong>Plugin</strong> - Reactäº‹ä»¶ç³»ç»Ÿä½¿ç”¨äº†æ’ä»¶æœºåˆ¶æ¥ç®¡ç†ä¸åŒè¡Œä¸ºçš„äº‹ä»¶ã€‚è¿™äº›æ’ä»¶ä¼šå¤„ç†è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ç”Ÿæˆåˆæˆäº‹ä»¶å¯¹è±¡ã€‚ç›®å‰ReactDOMæœ‰ä»¥ä¸‹å‡ ç§æ’ä»¶ç±»å‹:</p><ul><li><strong>SimpleEventPlugin</strong> - ç®€å•äº‹ä»¶, å¤„ç†ä¸€äº›æ¯”è¾ƒé€šç”¨çš„äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚clickã€inputã€keyDownã€mouseOverã€mouseOutã€pointerOverã€pointerOut</li><li><p><strong>EnterLeaveEventPlugin</strong> - mouseEnter/mouseLeaveå’ŒpointerEnter/pointerLeaveè¿™ä¸¤ç±»äº‹ä»¶æ¯”è¾ƒç‰¹æ®Š, å’Œ<code>*over/*leave</code>äº‹ä»¶ç›¸æ¯”, å®ƒä»¬ä¸æ”¯æŒäº‹ä»¶å†’æ³¡, <code>*enter</code>ä¼šç»™æ‰€æœ‰è¿›å…¥çš„å…ƒç´ å‘é€äº‹ä»¶, è¡Œä¸ºæœ‰ç‚¹ç±»ä¼¼äº<code>:hover</code>; è€Œ<code>*over</code>åœ¨è¿›å…¥å…ƒç´ åï¼Œè¿˜ä¼šå†’æ³¡é€šçŸ¥å…¶ä¸Šçº§. å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://codesandbox.io/s/enter-and-over-608cl" target="_blank" rel="noopener">å®ä¾‹</a>è§‚å¯Ÿenterå’Œoverçš„åŒºåˆ«.</p><p>å¦‚æœæ ‘å±‚æ¬¡æ¯”è¾ƒæ·±ï¼Œå¤§é‡çš„mouseenterè§¦å‘å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å¦å¤–å…¶ä¸æ”¯æŒå†’æ³¡ï¼Œæ— æ³•åœ¨Documentå®Œç¾çš„ç›‘å¬å’Œåˆ†å‘, æ‰€ä»¥ReactDOMä½¿ç”¨<code>*over/*out</code>äº‹ä»¶æ¥æ¨¡æ‹Ÿè¿™äº›<code>*enter/*leave</code>ã€‚</p></li><li><p><strong>ChangeEventPlugin</strong> - changeäº‹ä»¶æ˜¯Reactçš„ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ—¨åœ¨è§„èŒƒåŒ–è¡¨å•å…ƒç´ çš„å˜åŠ¨äº‹ä»¶ã€‚</p><p>å®ƒæ”¯æŒè¿™äº›è¡¨å•å…ƒç´ : input, textarea, select </p></li><li><p><strong>SelectEventPlugin</strong> - å’Œchangeäº‹ä»¶ä¸€æ ·ï¼ŒReactä¸ºè¡¨å•å…ƒç´ è§„èŒƒåŒ–äº†select(é€‰æ‹©èŒƒå›´å˜åŠ¨)äº‹ä»¶ï¼Œé€‚ç”¨äºinputã€textareaã€contentEditableå…ƒç´ .</p></li><li><strong>BeforeInputEventPlugin</strong> - beforeinputäº‹ä»¶ä»¥åŠ<a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/compositionstart" target="_blank" rel="noopener">composition</a>äº‹ä»¶å¤„ç†ã€‚</li></ul><p>æœ¬æ–‡ä¸»è¦ä¼šå…³æ³¨<code>SimpleEventPlugin</code>çš„å®ç°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±é˜…è¯»Reactçš„æºä»£ç .</p></li><li><p><strong>EventPropagators</strong> æŒ‰ç…§DOMäº‹ä»¶ä¼ æ’­çš„ä¸¤ä¸ªé˜¶æ®µï¼Œéå†Reactç»„ä»¶æ ‘ï¼Œå¹¶æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„äº‹ä»¶å¤„ç†å™¨.</p></li><li><strong>EventBatching</strong> è´Ÿè´£æ‰¹é‡æ‰§è¡Œäº‹ä»¶é˜Ÿåˆ—å’Œäº‹ä»¶å¤„ç†å™¨ï¼Œå¤„ç†äº‹ä»¶å†’æ³¡ã€‚</li><li><p><strong>SyntheticEvent</strong> è¿™æ˜¯â€˜åˆæˆâ€™äº‹ä»¶çš„åŸºç±»ï¼Œå¯ä»¥å¯¹åº”DOMçš„Eventå¯¹è±¡ã€‚åªä¸è¿‡Reactä¸ºäº†å‡ä½å†…å­˜æŸè€—å’Œåƒåœ¾å›æ”¶ï¼Œä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ± æ¥æ„å»ºå’Œé‡Šæ”¾äº‹ä»¶å¯¹è±¡ï¼Œ ä¹Ÿå°±æ˜¯è¯´SyntheticEventä¸èƒ½ç”¨äºå¼‚æ­¥å¼•ç”¨ï¼Œå®ƒåœ¨åŒæ­¥æ‰§è¡Œå®Œäº‹ä»¶å¤„ç†å™¨åå°±ä¼šè¢«é‡Šæ”¾ã€‚</p><p>SyntheticEventä¹Ÿæœ‰å­ç±»ï¼Œå’ŒDOMå…·ä½“äº‹ä»¶ç±»å‹ä¸€ä¸€åŒ¹é…:</p><ul><li>SyntheticAnimationEvent</li><li>SyntheticClipboardEvent</li><li>SyntheticCompositionEvent</li><li>SyntheticDragEvent</li><li>SyntheticFocusEvent</li><li>SyntheticInputEvent</li><li>SyntheticKeyboardEvent</li><li>SyntheticMouseEvent</li><li>SyntheticPointerEvent</li><li>SyntheticTouchEvent</li><li>â€¦.</li></ul></li></ul><p><br></p><h3 id="äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"><a href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§" class="headerlink" title="äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"></a>äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</h3><p>SimpleEventPluginå°†äº‹ä»¶ç±»å‹åˆ’åˆ†æˆäº†ä¸‰ç±», å¯¹åº”ä¸åŒçš„ä¼˜å…ˆçº§(<strong>ä¼˜å…ˆçº§ç”±ä½åˆ°é«˜</strong>):</p><ul><li><strong>DiscreteEvent</strong> ç¦»æ•£äº‹ä»¶. ä¾‹å¦‚blurã€focusã€ clickã€ submitã€ touchStart. è¿™äº›äº‹ä»¶éƒ½æ˜¯ç¦»æ•£è§¦å‘çš„</li><li><strong>UserBlockingEvent</strong> ç”¨æˆ·é˜»å¡äº‹ä»¶. ä¾‹å¦‚touchMoveã€mouseMoveã€scrollã€dragã€dragOverç­‰ç­‰ã€‚è¿™äº›äº‹ä»¶ä¼šâ€™é˜»å¡â€™ç”¨æˆ·çš„äº¤äº’ã€‚</li><li><strong>ContinuousEvent</strong> å¯è¿ç»­äº‹ä»¶ã€‚ä¾‹å¦‚loadã€errorã€loadStartã€abortã€animationEnd. è¿™ä¸ªä¼˜å…ˆçº§æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åº”è¯¥æ˜¯ç«‹å³åŒæ­¥æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯Continuousçš„æ„ä¹‰ï¼Œå³å¯è¿ç»­çš„æ‰§è¡Œï¼Œä¸è¢«æ‰“æ–­.</li></ul><p>å¯èƒ½è¦å…ˆäº†è§£ä¸€ä¸‹Reactè°ƒåº¦(Schedule)çš„ä¼˜å…ˆçº§ï¼Œæ‰èƒ½ç†è§£è¿™ä¸‰ç§äº‹ä»¶ç±»å‹çš„åŒºåˆ«ã€‚æˆªæ­¢åˆ°æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReactæœ‰5ä¸ªä¼˜å…ˆçº§çº§åˆ«:</p><ul><li><code>Immediate</code> - è¿™ä¸ªä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šåŒæ­¥æ‰§è¡Œ, æˆ–è€…è¯´è¦é©¬ä¸Šæ‰§è¡Œä¸”ä¸èƒ½ä¸­æ–­</li><li><code>UserBlocking</code>(250ms timeout) è¿™äº›ä»»åŠ¡ä¸€èˆ¬æ˜¯ç”¨æˆ·äº¤äº’çš„ç»“æœ, éœ€è¦å³æ—¶å¾—åˆ°åé¦ˆ .</li><li><code>Normal</code> (5s timeout) åº”å¯¹å“ªäº›ä¸éœ€è¦ç«‹å³æ„Ÿå—åˆ°çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚</li><li><code>Low</code> (10s timeout) è¿™äº›ä»»åŠ¡å¯ä»¥æ”¾åï¼Œä½†æ˜¯æœ€ç»ˆåº”è¯¥å¾—åˆ°æ‰§è¡Œ. ä¾‹å¦‚åˆ†æé€šçŸ¥</li><li><code>Idle</code> (no timeout) ä¸€äº›æ²¡æœ‰å¿…è¦åšçš„ä»»åŠ¡ (e.g. æ¯”å¦‚éšè—çš„å†…å®¹).</li></ul><p>ç›®å‰ContinuousEventå¯¹åº”çš„æ˜¯Immediateä¼˜å…ˆçº§; UserBlockingEventå¯¹åº”çš„æ˜¯UserBlocking(éœ€è¦æ‰‹åŠ¨å¼€å¯); è€ŒDiscreteEventå¯¹åº”çš„ä¹Ÿæ˜¯UserBlocking, åªä¸è¿‡å®ƒåœ¨æ‰§è¡Œä¹‹å‰ï¼Œå…ˆä¼šæ‰§è¡Œå®Œå…¶ä»–Discreteä»»åŠ¡ã€‚</p><p>æœ¬æ–‡ä¸ä¼šæ·±å…¥React Fiberæ¶æ„çš„ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»æ–‡æœ«çš„æ‰©å±•é˜…è¯»åˆ—è¡¨.</p><p><br><br><br></p><h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><p>ç°åœ¨å¼€å§‹è¿›å…¥æ–‡ç« æ­£é¢˜ï¼ŒReactæ˜¯æ€ä¹ˆå®ç°äº‹ä»¶æœºåˆ¶ï¼Ÿä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†: <strong>ç»‘å®š</strong>å’Œ<strong>åˆ†å‘</strong>.</p><h3 id="äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"><a href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ" class="headerlink" title="äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"></a>äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</h3><p>ä¸ºäº†é¿å…åé¢ç»•æ™•äº†ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹Reactäº‹ä»¶æœºåˆ¶ä¸­çš„æ’ä»¶åè®®ã€‚ æ¯ä¸ªæ’ä»¶çš„ç»“æ„å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> EventTypes = &#123;[key: <span class="built_in">string</span>]: DispatchConfig&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> PluginModule&lt;NativeEvent&gt; = &#123;</span><br><span class="line">  eventTypes: EventTypes,          <span class="comment">// å£°æ˜æ’ä»¶æ”¯æŒçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line">  extractEvents: (                 <span class="comment">// å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›åˆæˆäº‹ä»¶å¯¹è±¡</span></span><br><span class="line">    topLevelType: TopLevelType,</span><br><span class="line">    targetInst: <span class="literal">null</span> | Fiber,</span><br><span class="line">    nativeEvent: NativeEvent,</span><br><span class="line">    nativeEventTarget: EventTarget,</span><br><span class="line">  ) =&gt; ?ReactSyntheticEvent,</span><br><span class="line">  tapMoveThreshold?: <span class="built_in">number</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>eventTypes</strong>å£°æ˜è¯¥æ’ä»¶è´Ÿè´£çš„äº‹ä»¶ç±»å‹, å®ƒé€šè¿‡<code>DispatchConfig</code>æ¥æè¿°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> DispatchConfig = &#123;</span><br><span class="line">  dependencies: <span class="built_in">Array</span>&lt;TopLevelType&gt;, <span class="comment">// ä¾èµ–çš„åŸç”Ÿäº‹ä»¶ï¼Œè¡¨ç¤ºå…³è”è¿™äº›äº‹ä»¶çš„è§¦å‘. â€˜ç®€å•äº‹ä»¶â€™ä¸€èˆ¬åªæœ‰ä¸€ä¸ªï¼Œå¤æ‚äº‹ä»¶å¦‚onChangeä¼šç›‘å¬å¤šä¸ª, å¦‚ä¸‹å›¾ğŸ‘‡</span></span><br><span class="line">  phasedRegistrationNames?: &#123;    <span class="comment">// ä¸¤é˜¶æ®µpropsäº‹ä»¶æ³¨å†Œåç§°, Reactä¼šæ ¹æ®è¿™äº›åç§°åœ¨ç»„ä»¶å®ä¾‹ä¸­æŸ¥æ‰¾å¯¹åº”çš„propsäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    bubbled: <span class="built_in">string</span>,             <span class="comment">// å†’æ³¡é˜¶æ®µ, å¦‚onClick</span></span><br><span class="line">    captured: <span class="built_in">string</span>,            <span class="comment">// æ•è·é˜¶æ®µï¼Œå¦‚onClickCapture</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registrationName?: <span class="built_in">string</span>      <span class="comment">// propsäº‹ä»¶æ³¨å†Œåç§°, æ¯”å¦‚onMouseEnterè¿™äº›ä¸æ”¯æŒå†’æ³¡çš„äº‹ä»¶ç±»å‹ï¼Œåªä¼šå®šä¹‰  registrationNameï¼Œä¸ä¼šå®šä¹‰phasedRegistrationNames</span></span><br><span class="line">  eventPriority: EventPriority,  <span class="comment">// äº‹ä»¶çš„ä¼˜å…ˆçº§ï¼Œä¸Šæ–‡å·²ç»ä»‹ç»è¿‡äº†</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹ä¸€ä¸‹å®ä¾‹:</p><p><img src="/images/react-event/dispatch-config.png" alt></p><p>ä¸Šé¢åˆ—ä¸¾äº†ä¸‰ä¸ªå…¸å‹çš„EventPluginï¼š</p><ul><li><p><strong>SimpleEventPlugin</strong> - ç®€å•äº‹ä»¶æœ€å¥½ç†è§£ï¼Œå®ƒä»¬çš„è¡Œä¸ºéƒ½æ¯”è¾ƒé€šç”¨ï¼Œæ²¡æœ‰ä»€ä¹ˆTrick, ä¾‹å¦‚ä¸æ”¯æŒäº‹ä»¶å†’æ³¡ã€ä¸æ”¯æŒåœ¨Documentä¸Šç»‘å®šç­‰ç­‰. å’ŒåŸç”ŸDOMäº‹ä»¶æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ¯”è¾ƒå¥½å¤„ç†.</p></li><li><p><strong>EnterLeaveEventPlugin</strong> - ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>mouseEnter</code>å’Œ<code>mouseLeave</code>ä¾èµ–çš„æ˜¯<code>mouseout</code>å’Œ<code>mouseover</code>äº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´<code>*Enter/*Leave</code>äº‹ä»¶åœ¨Reactä¸­æ˜¯é€šè¿‡<code>*Over/*Out</code>äº‹ä»¶æ¥æ¨¡æ‹Ÿçš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨documentä¸Šé¢è¿›è¡Œå§”æ‰˜ç›‘å¬ï¼Œè¿˜æœ‰é¿å…<code>*Enter/*Leave</code>ä¸€äº›å¥‡æ€ªè€Œä¸å®ç”¨çš„è¡Œä¸ºã€‚</p></li><li><p><strong>ChangeEventPlugin</strong> - onChangeæ˜¯Reactçš„ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¯ä»¥çœ‹å‡ºå®ƒä¾èµ–äº†å¤šç§åŸç”ŸDOMäº‹ä»¶ç±»å‹æ¥æ¨¡æ‹ŸonChangeäº‹ä»¶.</p></li></ul><p><br></p><p>å¦å¤–æ¯ä¸ªæ’ä»¶è¿˜ä¼šå®šä¹‰<code>extractEvents</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—äº‹ä»¶åç§°ã€åŸç”ŸDOMäº‹ä»¶å¯¹è±¡ã€äº‹ä»¶è§¦å‘çš„DOMå…ƒç´ ä»¥åŠReactç»„ä»¶å®ä¾‹, è¿”å›ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œå¦‚æœè¿”å›ç©ºåˆ™è¡¨ç¤ºä¸ä½œå¤„ç†. å…³äºextractEventsçš„ç»†èŠ‚ä¼šåœ¨ä¸‹ä¸€èŠ‚é˜è¿°.</p><p><br></p><p>åœ¨ReactDOMå¯åŠ¨æ—¶å°±ä¼šå‘<code>EventPluginHub</code>æ³¨å†Œè¿™äº›æ’ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">EventPluginHubInjection.injectEventPluginsByName(&#123;</span><br><span class="line">  SimpleEventPlugin: SimpleEventPlugin,</span><br><span class="line">  EnterLeaveEventPlugin: EnterLeaveEventPlugin,</span><br><span class="line">  ChangeEventPlugin: ChangeEventPlugin,</span><br><span class="line">  SelectEventPlugin: SelectEventPlugin,</span><br><span class="line">  BeforeInputEventPlugin: BeforeInputEventPlugin,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>Ok, å›åˆ°æ­£é¢˜ï¼Œäº‹ä»¶æ˜¯æ€ä¹ˆç»‘å®šçš„å‘¢ï¼Ÿ æ‰“ä¸ªæ–­ç‚¹çœ‹ä¸€ä¸‹è°ƒç”¨æ ˆ:</p><p><img src="/images/react-event/listento.png" alt></p><p>å‰é¢è°ƒç”¨æ ˆå…³äºReactæ ‘å¦‚ä½•æ›´æ–°å’Œæ¸²æŸ“å°±ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…äº†ï¼Œé€šè¿‡è°ƒç”¨æ ˆå¯ä»¥çœ‹å‡ºReactåœ¨propsåˆå§‹åŒ–å’Œæ›´æ–°æ—¶ä¼šè¿›è¡Œäº‹ä»¶ç»‘å®šã€‚è¿™é‡Œå…ˆçœ‹ä¸€ä¸‹æµç¨‹å›¾ï¼Œå¿½ç•¥æ‚ä¹±çš„è·³è½¬ï¼š</p><p><img src="/images/react-event/binding.png" alt></p><ul><li><strong>1. åœ¨propsåˆå§‹åŒ–å’Œæ›´æ–°æ—¶ä¼šè¿›è¡Œäº‹ä»¶ç»‘å®š</strong>ã€‚é¦–å…ˆReactä¼šåˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯<code>åª’ä½“ç±»å‹</code>ï¼Œ<strong>åª’ä½“ç±»å‹çš„äº‹ä»¶æ˜¯æ— æ³•åœ¨Documentç›‘å¬çš„ï¼Œæ‰€ä»¥ä¼šç›´æ¥åœ¨å…ƒç´ ä¸Šè¿›è¡Œç»‘å®š</strong></li><li><strong>2. åä¹‹å°±åœ¨Documentä¸Šç»‘å®š</strong>. è¿™é‡Œé¢éœ€è¦ä¸¤ä¸ªä¿¡æ¯ï¼Œä¸€ä¸ªå°±æ˜¯ä¸Šæ–‡æåˆ°çš„â€™äº‹ä»¶ä¾èµ–åˆ—è¡¨â€™, æ¯”å¦‚<code>onMouseEnter</code>ä¾èµ–<code>mouseover/mouseout</code>; ç¬¬äºŒä¸ªæ˜¯ReactBrowserEventEmitterç»´æŠ¤çš„â€™å·²è®¢é˜…äº‹ä»¶è¡¨â€™ã€‚<strong>äº‹ä»¶å¤„ç†å™¨åªéœ€åœ¨Documentè®¢é˜…ä¸€æ¬¡ï¼Œæ‰€ä»¥ç›¸æ¯”åœ¨æ¯ä¸ªå…ƒç´ ä¸Šè®¢é˜…äº‹ä»¶ä¼šèŠ‚çœå¾ˆå¤šèµ„æº</strong>.</li></ul><p>ä»£ç å¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">listenTo</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  registrationName: <span class="built_in">string</span>,           <span class="comment">// æ³¨å†Œåç§°ï¼Œå¦‚onClick</span></span></span></span><br><span class="line"><span class="function"><span class="params">  mountAt: Document | Element | Node, <span class="comment">// ç»„ä»¶æ ‘å®¹å™¨ï¼Œä¸€èˆ¬æ˜¯Document</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> listeningSet = getListeningSetForElement(mountAt);             <span class="comment">// å·²è®¢é˜…äº‹ä»¶è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> dependencies = registrationNameDependencies[registrationName]; <span class="comment">// äº‹ä»¶ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dependencies.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> dependency = dependencies[i];</span><br><span class="line">    <span class="keyword">if</span> (!listeningSet.has(dependency)) &#123;                               <span class="comment">// æœªè®¢é˜…</span></span><br><span class="line">      <span class="keyword">switch</span> (dependency) &#123;</span><br><span class="line">        <span class="comment">// ... ç‰¹æ®Šçš„äº‹ä»¶ç›‘å¬å¤„ç†</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">const</span> isMediaEvent = mediaEventTypes.indexOf(dependency) !== <span class="number">-1</span>;</span><br><span class="line">          <span class="keyword">if</span> (!isMediaEvent) &#123;</span><br><span class="line">            trapBubbledEvent(dependency, mountAt);                     <span class="comment">// è®¾ç½®äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      listeningSet.add(dependency);                                    <span class="comment">// æ›´æ–°å·²è®¢é˜…è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®äº‹ä»¶çš„â€™ä¼˜å…ˆçº§â€™å’Œâ€™æ•è·é˜¶æ®µâ€™(æ˜¯å¦æ˜¯capture)æ¥è®¾ç½®äº‹ä»¶å¤„ç†å™¨</strong>:</li></ul><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trapEventForPluginEventSystem</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  element: Document | Element | Node,   <span class="comment">// ç»‘å®šåˆ°å…ƒç´ ï¼Œä¸€èˆ¬æ˜¯Document</span></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType: DOMTopLevelEventType,   <span class="comment">// äº‹ä»¶åç§°</span></span></span></span><br><span class="line"><span class="function"><span class="params">  capture: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> listener;</span><br><span class="line">  <span class="keyword">switch</span> (getEventPriority(topLevelType)) &#123;</span><br><span class="line">    <span class="comment">// ä¸åŒä¼˜å…ˆçº§çš„äº‹ä»¶ç±»å‹ï¼Œæœ‰ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œåˆ†å‘, ä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»</span></span><br><span class="line">    <span class="keyword">case</span> DiscreteEvent:                      <span class="comment">// âš›ï¸ç¦»æ•£äº‹ä»¶</span></span><br><span class="line">      listener = dispatchDiscreteEvent.bind(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        topLevelType,</span><br><span class="line">        PLUGIN_EVENT_SYSTEM,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> UserBlockingEvent:                 <span class="comment">// âš›ï¸ç”¨æˆ·é˜»å¡äº‹ä»¶</span></span><br><span class="line">      listener = dispatchUserBlockingUpdate.bind(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        topLevelType,</span><br><span class="line">        PLUGIN_EVENT_SYSTEM,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ContinuousEvent:                   <span class="comment">// âš›ï¸å¯è¿ç»­äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      listener = dispatchEvent.bind(<span class="literal">null</span>, topLevelType, PLUGIN_EVENT_SYSTEM);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> rawEventName = getRawEventName(topLevelType);</span><br><span class="line">  <span class="keyword">if</span> (capture) &#123;                            <span class="comment">// ç»‘å®šäº‹ä»¶å¤„ç†å™¨åˆ°å…ƒç´ </span></span><br><span class="line">    addEventCaptureListener(element, rawEventName, listener);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    addEventBubbleListener(element, rawEventName, listener);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹ä»¶ç»‘å®šçš„è¿‡ç¨‹è¿˜æ¯”è¾ƒç®€å•, æ¥ä¸‹æ¥çœ‹çœ‹äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ã€‚</p><p><br></p><h3 id="äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"><a href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ" class="headerlink" title="äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"></a>äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</h3><p>æŒ‰æƒ¯ä¾‹è¿˜æ˜¯å…ˆä¸Šæµç¨‹å›¾:</p><p><img src="/images/react-event/binding.png" alt></p><h4 id="äº‹ä»¶è§¦å‘è°ƒåº¦"><a href="#äº‹ä»¶è§¦å‘è°ƒåº¦" class="headerlink" title="äº‹ä»¶è§¦å‘è°ƒåº¦"></a>äº‹ä»¶è§¦å‘è°ƒåº¦</h4><p>é€šè¿‡ä¸Šé¢çš„<code>trapEventForPluginEventSystem</code>å‡½æ•°å¯ä»¥çŸ¥é“ï¼Œä¸åŒçš„äº‹ä»¶ç±»å‹æœ‰ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨, å®ƒä»¬çš„åŒºåˆ«æ˜¯è°ƒåº¦çš„ä¼˜å…ˆçº§ä¸ä¸€æ ·:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¦»æ•£äº‹ä»¶</span></span><br><span class="line"><span class="comment">// discrentUpdates åœ¨UserBlockingä¼˜å…ˆçº§ä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchDiscreteEvent</span>(<span class="params">topLevelType, eventSystemFlags, nativeEvent</span>) </span>&#123;</span><br><span class="line">  flushDiscreteUpdatesIfNeeded(nativeEvent.timeStamp);</span><br><span class="line">  discreteUpdates(dispatchEvent, topLevelType, eventSystemFlags, nativeEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜»å¡äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchUserBlockingUpdate</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">  eventSystemFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEvent,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå¼€å¯äº†enableUserBlockingEvents, åˆ™åœ¨UserBlockingä¼˜å…ˆçº§ä¸­è°ƒåº¦ï¼Œ</span></span><br><span class="line">  <span class="comment">// å¼€å¯enableUserBlockingEventså¯ä»¥é˜²æ­¢é¥¥é¥¿é—®é¢˜ï¼Œå› ä¸ºé˜»å¡äº‹ä»¶ä¸­æœ‰scrollã€mouseMoveè¿™ç±»é¢‘ç¹è§¦å‘çš„äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// å¦åˆ™åŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (enableUserBlockingEvents) &#123;</span><br><span class="line">    runWithPriority(</span><br><span class="line">      UserBlockingPriority,</span><br><span class="line">      dispatchEvent.bind(<span class="literal">null</span>, topLevelType, eventSystemFlags, nativeEvent),</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    dispatchEvent(topLevelType, eventSystemFlags, nativeEvent);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯è¿ç»­äº‹ä»¶åˆ™ç›´æ¥åŒæ­¥è°ƒç”¨dispatchEvent</span></span><br></pre></td></tr></table></figure><p><br></p><p>æœ€ç»ˆä¸åŒçš„äº‹ä»¶ç±»å‹éƒ½ä¼šè°ƒç”¨<code>dispatchEvent</code>å‡½æ•°. <code>dispatchEvent</code>ä¸­ä¼šä»DOMåŸç”Ÿäº‹ä»¶å¯¹è±¡è·å–äº‹ä»¶è§¦å‘çš„targetï¼Œå†æ ¹æ®è¿™ä¸ªtargetè·å–å…³è”çš„ReactèŠ‚ç‚¹å®ä¾‹.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">dispatchEvent</span>(<span class="params">topLevelType: DOMTopLevelEventType, eventSystemFlags: EventSystemFlags, nativeEvent: AnyNativeEvent</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–äº‹ä»¶è§¦å‘çš„ç›®æ ‡DOM</span></span><br><span class="line">  <span class="keyword">const</span> nativeEventTarget = getEventTarget(nativeEvent);</span><br><span class="line">  <span class="comment">// è·å–ç¦»è¯¥DOMæœ€è¿‘çš„ç»„ä»¶å®ä¾‹(åªèƒ½æ˜¯DOMå…ƒç´ ç»„ä»¶)</span></span><br><span class="line">  <span class="keyword">let</span> targetInst = getClosestInstanceFromNode(nativeEventTarget);</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  dispatchEventForPluginEventSystem(topLevelType, eventSystemFlags, nativeEvent, targetInst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æ¥ç€(ä¸­é—´è¿˜æœ‰ä¸€äº›æ­¥éª¤ï¼Œè¿™é‡Œå¿½ç•¥)ä¼šè°ƒç”¨<code>EventPluginHub</code>çš„<code>runExtractedPluginEventsInBatch</code>ï¼Œè¿™ä¸ªæ–¹æ³•éå†æ’ä»¶åˆ—è¡¨æ¥å¤„ç†äº‹ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªSyntheticEventåˆ—è¡¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runExtractedPluginEventsInBatch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType: TopLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">  targetInst: <span class="literal">null</span> | Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEvent: AnyNativeEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEventTarget: EventTarget,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// éå†æ’ä»¶åˆ—è¡¨, è°ƒç”¨æ’ä»¶çš„extractEventsï¼Œç”ŸæˆSyntheticEventåˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> events = extractPluginEvents(</span><br><span class="line">    topLevelType,</span><br><span class="line">    targetInst,</span><br><span class="line">    nativeEvent,</span><br><span class="line">    nativeEventTarget,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œ, è§åæ–‡æ‰¹é‡æ‰§è¡Œ</span></span><br><span class="line">  runEventsInBatch(events);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶"><a href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶" class="headerlink" title="æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?"></a>æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</h4><p>ç°åœ¨æ¥çœ‹çœ‹æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶çš„ï¼Œæˆ‘ä»¬ä»¥<code>SimpleEventPlugin</code>ä¸ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SimpleEventPlugin: PluginModule&lt;MouseEvent&gt; &amp; &#123;</span><br><span class="line">  getEventPriority: <span class="function">(<span class="params">topLevelType: TopLevelType</span>) =&gt;</span> EventPriority,</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  eventTypes: eventTypes,</span><br><span class="line">  <span class="comment">// æŠ½å–äº‹ä»¶å¯¹è±¡</span></span><br><span class="line">  extractEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    topLevelType: TopLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">    targetInst: null | Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">    nativeEvent: MouseEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">    nativeEventTarget: EventTarget,</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">null</span> | <span class="title">ReactSyntheticEvent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// äº‹ä»¶é…ç½®</span></span><br><span class="line">    <span class="keyword">const</span> dispatchConfig = topLevelEventsToDispatchConfig[topLevelType];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1ï¸âƒ£ æ ¹æ®äº‹ä»¶ç±»å‹è·å–SyntheticEventå­ç±»äº‹ä»¶æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">let</span> EventConstructor;</span><br><span class="line">    <span class="keyword">switch</span> (topLevelType) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_KEY_DOWN:</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_KEY_UP:</span><br><span class="line">        EventConstructor = SyntheticKeyboardEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_BLUR:</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_FOCUS:</span><br><span class="line">        EventConstructor = SyntheticFocusEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// ... çœç•¥</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_GOT_POINTER_CAPTURE:</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_POINTER_UP:</span><br><span class="line">        EventConstructor = SyntheticPointerEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        EventConstructor = SyntheticEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ï¸âƒ£ æ„é€ äº‹ä»¶å¯¹è±¡, ä»å¯¹è±¡æ± ä¸­è·å–</span></span><br><span class="line">    <span class="keyword">const</span> event = EventConstructor.getPooled(</span><br><span class="line">      dispatchConfig,</span><br><span class="line">      targetInst,</span><br><span class="line">      nativeEvent,</span><br><span class="line">      nativeEventTarget,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3ï¸âƒ£ æ ¹æ®DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºè·å–ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    accumulateTwoPhaseDispatches(event);</span><br><span class="line">    <span class="keyword">return</span> event;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>SimpleEventPlugin</code>çš„<code>extractEvents</code>ä¸»è¦åšä»¥ä¸‹ä¸‰ä¸ªäº‹æƒ…:</p><ul><li>1ï¸âƒ£ æ ¹æ®äº‹ä»¶çš„ç±»å‹ç¡®å®šSyntheticEventæ„é€ å™¨</li><li>2ï¸âƒ£ æ„é€ SyntheticEventå¯¹è±¡ã€‚</li><li>3ï¸âƒ£ æ ¹æ®DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºè·å–ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨åˆ—è¡¨</li></ul><p><br></p><p><strong>ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºå’Œé‡Šæ”¾äº‹ä»¶å¯¹è±¡å¯¼è‡´æ€§èƒ½æŸè€—(å¯¹è±¡åˆ›å»ºå’Œåƒåœ¾å›æ”¶)ï¼ŒReactä½¿ç”¨ä¸€ä¸ªäº‹ä»¶æ± æ¥è´Ÿè´£ç®¡ç†äº‹ä»¶å¯¹è±¡ï¼Œä½¿ç”¨å®Œçš„äº‹ä»¶å¯¹è±¡ä¼šæ”¾å›æ± ä¸­ï¼Œä»¥å¤‡åç»­çš„å¤ç”¨</strong>ã€‚</p><p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œ<strong>åœ¨äº‹ä»¶å¤„ç†å™¨åŒæ­¥æ‰§è¡Œå®Œåï¼ŒSyntheticEventå¯¹è±¡å°±ä¼šé©¬ä¸Šè¢«å›æ”¶</strong>ï¼Œæ‰€æœ‰å±æ€§éƒ½ä¼šæ— æ•ˆã€‚æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šåœ¨å¼‚æ­¥æ“ä½œä¸­è®¿é—®SyntheticEventäº‹ä»¶å¯¹è±¡ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥ä¿æŒäº‹ä»¶å¯¹è±¡çš„å¼•ç”¨ï¼š</p><ul><li>è°ƒç”¨<code>SyntheticEvent#persist()</code>æ–¹æ³•ï¼Œå‘Šè¯‰Reactä¸è¦å›æ”¶åˆ°å¯¹è±¡æ± </li><li>ç›´æ¥å¼•ç”¨<code>SyntheticEvent#nativeEvent</code>, nativeEventæ˜¯å¯ä»¥æŒä¹…å¼•ç”¨çš„ï¼Œä¸è¿‡ä¸ºäº†ä¸æ‰“ç ´æŠ½è±¡ï¼Œå»ºè®®ä¸è¦ç›´æ¥å¼•ç”¨nativeEvent</li></ul><p><br></p><p>æ„å»ºå®ŒSyntheticEventå¯¹è±¡åï¼Œå°±éœ€è¦<strong>éå†ç»„ä»¶æ ‘æ¥è·å–è®¢é˜…è¯¥äº‹ä»¶çš„ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</strong>äº†:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accumulateTwoPhaseDispatchesSingle</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä»¥_targetInstä¸ºåŸºç‚¹, æŒ‰ç…§DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºéå†ç»„ä»¶æ ‘</span></span><br><span class="line">  traverseTwoPhase(event._targetInst, accumulateDirectionalDispatches, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå†æ–¹æ³•å…¶å®å¾ˆç®€å•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">traverseTwoPhase</span>(<span class="params">inst, fn, arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> path = [];</span><br><span class="line">  <span class="keyword">while</span> (inst) &#123;           <span class="comment">// ä»instå¼€å§‹ï¼Œå‘ä¸Šçº§å›æº¯</span></span><br><span class="line">    path.push(inst);</span><br><span class="line">    inst = getParent(inst);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> i;</span><br><span class="line">  <span class="comment">// æ•è·é˜¶æ®µï¼Œå…ˆä»æœ€é¡¶å±‚çš„çˆ¶ç»„ä»¶å¼€å§‹, å‘ä¸‹çº§ä¼ æ’­</span></span><br><span class="line">  <span class="keyword">for</span> (i = path.length; i-- &gt; <span class="number">0</span>; ) &#123;</span><br><span class="line">    fn(path[i], <span class="string">'captured'</span>, arg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†’æ³¡é˜¶æ®µï¼Œä»instï¼Œå³äº‹ä»¶è§¦å‘ç‚¹å¼€å§‹, å‘ä¸Šçº§ä¼ æ’­</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; path.length; i++) &#123;</span><br><span class="line">    fn(path[i], <span class="string">'bubbled'</span>, arg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>accumulateDirectionalDispatches</code>å‡½æ•°åˆ™æ˜¯ç®€å•æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accumulateDirectionalDispatches</span>(<span class="params">inst, phase, event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">  <span class="keyword">const</span> listener = listenerAtPhase(inst, event, phase);</span><br><span class="line">  <span class="comment">// æ‰€æœ‰å¤„ç†å™¨éƒ½æ”¾å…¥åˆ°_dispatchListenersé˜Ÿåˆ—ä¸­ï¼Œåç»­æ‰¹é‡æ‰§è¡Œè¿™ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">  <span class="keyword">if</span> (listener) &#123;</span><br><span class="line">    event._dispatchListeners = accumulateInto(</span><br><span class="line">      event._dispatchListeners,</span><br><span class="line">      listener,</span><br><span class="line">    );</span><br><span class="line">    event._dispatchInstances = accumulateInto(event._dispatchInstances, inst);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä¾‹å¦‚ä¸‹é¢çš„ç»„ä»¶æ ‘, éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/images/react-event/event-delivery.png" alt></p><p>æœ€ç»ˆè®¡ç®—å‡ºæ¥çš„<code>_dispatchListeners</code>é˜Ÿåˆ—æ˜¯è¿™æ ·çš„ï¼š<code>[handleB, handleC, handleA]</code></p><p><br></p><h4 id="æ‰¹é‡æ‰§è¡Œ"><a href="#æ‰¹é‡æ‰§è¡Œ" class="headerlink" title="æ‰¹é‡æ‰§è¡Œ"></a>æ‰¹é‡æ‰§è¡Œ</h4><p>éå†æ‰§è¡Œæ’ä»¶åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªSyntheticEventåˆ—è¡¨ï¼Œ<code>runEventsInBatch</code>å°±æ˜¯æ‰¹é‡æ‰§è¡Œè¿™äº›äº‹ä»¶ä¸­çš„<code>_dispatchListeners</code>äº‹ä»¶é˜Ÿåˆ—</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runEventsInBatch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  events: Array&lt;ReactSyntheticEvent&gt; | ReactSyntheticEvent | null,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  forEachAccumulated(processingEventQueue, executeDispatchesAndRelease);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> executeDispatchesAndRelease = <span class="function"><span class="keyword">function</span>(<span class="params">event: ReactSyntheticEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event) &#123;</span><br><span class="line">    <span class="comment">// æŒ‰é¡ºåºæ‰§è¡Œ_dispatchListeners</span></span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    executeDispatchesInOrder(event);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è°ƒç”¨persist()æ–¹æ³•åˆ™ç›´æ¥å›æ”¶</span></span><br><span class="line">    <span class="keyword">if</span> (!event.isPersistent()) &#123;</span><br><span class="line">      event.constructor.release(event);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">executeDispatchesInOrder</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// éå†dispatchListeners</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dispatchListeners.length; i++) &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡è°ƒç”¨ stopPropagation æ–¹æ³•å¯ä»¥ç¦æ­¢æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (event.isPropagationStopped()) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    executeDispatch(event, dispatchListeners[i], dispatchInstances[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/react-event/dispatch.png" alt></p><p>OK, åˆ°è¿™é‡ŒReactçš„äº‹ä»¶æœºåˆ¶å°±åŸºæœ¬ä»‹ç»å®Œäº†ï¼Œè¿™é‡Œåªæ˜¯ç®€å•äº†ä»‹ç»äº†ä¸€ä¸‹<code>SimpleEventPlugin</code>, å®é™…ä»£ç ä¸­è¿˜æœ‰å¾ˆå¤šäº‹ä»¶å¤„ç†çš„ç»†èŠ‚ï¼Œé™äºç¯‡å¹…ï¼Œæœ¬æ–‡å°±ä¸å±•å¼€å»è®²äº†ã€‚æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥äº²è‡ªå»è§‚æ‘©Reactçš„æºä»£ç .</p><p><br><br><br></p><h2 id="æœªæ¥"><a href="#æœªæ¥" class="headerlink" title="æœªæ¥"></a>æœªæ¥</h2><p>Reactå†…éƒ¨æœ‰ä¸€ä¸ªå®éªŒæ€§çš„äº‹ä»¶APIï¼ŒReactå†…éƒ¨ç§°ä¸º<code>React Flare</code>ã€æ­£å¼åç§°æ˜¯<a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener"><code>react-events</code></a>, <strong>é€šè¿‡è¿™ä¸ªAPIå¯ä»¥å®ç°è·¨å¹³å°ã€è·¨è®¾å¤‡çš„é«˜çº§äº‹ä»¶å°è£…</strong>.</p><p>react-eventså®šä¹‰äº†ä¸€ä¸ª<strong>äº‹ä»¶å“åº”å™¨(Event Responders)</strong>çš„æ¦‚å¿µï¼Œè¿™ä¸ªäº‹ä»¶å“åº”å™¨å¯ä»¥æ•è·å­ç»„ä»¶æ ‘æˆ–åº”ç”¨æ ¹èŠ‚ç‚¹çš„äº‹ä»¶ï¼Œç„¶åè½¬æ¢ä¸ºè‡ªå®šä¹‰äº‹ä»¶.</p><p>æ¯”è¾ƒå…¸å‹çš„é«˜çº§äº‹ä»¶æ˜¯pressã€longPressã€swipeè¿™äº›æ‰‹åŠ¿ã€‚é€šå¸¸æˆ‘ä»¬éœ€è¦è‡ªå·±æˆ–è€…åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å®ç°è¿™ä¸€å¥—æ‰‹åŠ¿è¯†åˆ«, ä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Gesture <span class="keyword">from</span> <span class="string">'rc-gesture'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Gesture</span><br><span class="line">    onTap=&#123;handleTap&#125;</span><br><span class="line">    onSwipe=&#123;onSwipe&#125;</span><br><span class="line">    onPinch=&#123;handlePinch&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;container&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Gesture&gt;,</span><br><span class="line">container);</span><br></pre></td></tr></table></figure><p><br></p><p>é‚£ä¹ˆreact-eventsçš„ç›®çš„å°±æ˜¯<strong>æä¾›ä¸€å¥—é€šç”¨çš„äº‹ä»¶æœºåˆ¶ç»™å¼€å‘è€…æ¥å®ç°â€™é«˜çº§äº‹ä»¶â€™çš„å°è£…, ç”šè‡³å®ç°äº‹ä»¶çš„è·¨å¹³å°ã€è·¨è®¾å¤‡</strong>, ç°åœ¨ä½ å¯ä»¥é€šè¿‡react-eventsæ¥å°è£…è¿™äº›æ‰‹åŠ¿äº‹ä»¶.</p><p>react-eventsé™¤äº†æ ¸å¿ƒçš„<code>Responder</code>æ¥å£ï¼Œè¿˜å°è£…äº†ä¸€äº›å†…ç½®æ¨¡å—, å®ç°è·¨å¹³å°çš„ã€å¸¸ç”¨çš„é«˜çº§äº‹ä»¶å°è£…ï¼š</p><ul><li>Focus module</li><li>Hover module</li><li>Press module</li><li>FocusScope module</li><li>Input module</li><li>KeyBoard module</li><li>Drag module</li><li>Pan module</li><li>Scroll module</li><li>Swipe module</li></ul><p>ä¸¾<code>Press</code>æ¨¡å—ä½œä¸ºä¾‹å­, <a href="https://github.com/facebook/react/blob/master/packages/react-events/docs/Press.md" target="_blank" rel="noopener">Pressæ¨¡å—</a>ä¼šå“åº”å®ƒåŒ…è£¹çš„å…ƒç´ çš„pressäº‹ä»¶ã€‚pressäº‹ä»¶åŒ…æ‹¬onContextMenuã€onLongPressã€onPressã€onPressEndã€onPressMoveã€onPressStartç­‰ç­‰. å…¶åº•å±‚é€šè¿‡mouseã€penã€touchã€trackpadç­‰äº‹ä»¶æ¥è½¬æ¢.</p><p>çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PressResponder, usePressListener &#125; <span class="keyword">from</span> <span class="string">'react-events/press'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  <span class="keyword">const</span> listener = usePressListener(&#123;  <span class="comment">// âš›ï¸é€šè¿‡hooksåˆ›å»ºResponder</span></span><br><span class="line">    onPressStart,</span><br><span class="line">    onPress,</span><br><span class="line">    onPressEnd,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div listeners=&#123;listener&#125;&gt;</span><br><span class="line">      &#123;subtrees&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br></p><p>react-eventsçš„è¿ä½œæµç¨‹å›¾å¦‚ä¸‹, <strong>äº‹ä»¶å“åº”å™¨(Event Responders)ä¼šæŒ‚è½½åˆ°hostèŠ‚ç‚¹ï¼Œå®ƒä¼šåœ¨hostèŠ‚ç‚¹ç›‘å¬hostæˆ–å­èŠ‚ç‚¹åˆ†å‘çš„åŸç”Ÿäº‹ä»¶(DOMæˆ–React Native), å¹¶å°†å®ƒä»¬è½¬æ¢/åˆå¹¶æˆé«˜çº§çš„äº‹ä»¶</strong>:</p><p><img src="/images/react-event/responder.png" alt></p><p><br></p><blockquote><p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªCodesanboxç©ä¸€ä¸‹<code>react-events</code>: <a href="https://codesandbox.io/s/github/ivan-94/react-events-playground" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit react-events-playground"></a></p></blockquote><p><br></p><h3 id="åˆæ¢responderçš„åˆ›å»º"><a href="#åˆæ¢responderçš„åˆ›å»º" class="headerlink" title="åˆæ¢Responderçš„åˆ›å»º"></a>åˆæ¢Responderçš„åˆ›å»º</h3><p>æˆ‘ä»¬æŒ‘ä¸€ä¸ªç®€å•çš„æ¨¡å—æ¥äº†è§£ä¸€äº›react-eventsçš„æ ¸å¿ƒAPI, ç›®å‰æœ€ç®€å•çš„æ˜¯Keyboardæ¨¡å—. Keyboardæ¨¡å—çš„ç›®çš„å°±æ˜¯è§„èŒƒåŒ–keydownå’Œkeyupäº‹ä»¶å¯¹è±¡çš„keyå±æ€§(éƒ¨åˆ†æµè§ˆå™¨keyå±æ€§çš„è¡Œä¸ºä¸ä¸€æ ·)ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰Responderçš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> keyboardResponderImpl = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1ï¸âƒ£å®šä¹‰Responderéœ€è¦ç›‘å¬çš„å­æ ‘çš„DOMäº‹ä»¶ï¼Œå¯¹äºKeyboardæ¥è¯´æ˜¯['keydown', 'keyup';]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  targetEventTypes,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 2ï¸âƒ£ç›‘å¬å­æ ‘è§¦å‘çš„äº‹ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onEvent(</span><br><span class="line">    event: ReactDOMResponderEvent,     <span class="comment">// åŒ…å«äº†å½“å‰è§¦å‘äº‹ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚åŸç”Ÿäº‹ä»¶å¯¹è±¡ï¼Œäº‹ä»¶è§¦å‘çš„èŠ‚ç‚¹ï¼Œäº‹ä»¶ç±»å‹ç­‰ç­‰</span></span><br><span class="line">    context: ReactDOMResponderContext, <span class="comment">// Responderçš„ä¸Šä¸‹æ–‡ï¼Œç»™Responderæä¾›äº†ä¸€äº›æ–¹æ³•æ¥é©±åŠ¨äº‹ä»¶åˆ†å‘</span></span><br><span class="line">    props: KeyboardResponderProps,     <span class="comment">// ä¼ é€’ç»™Responderçš„props</span></span><br><span class="line">  ): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;responderTarget, type&#125; = event;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.disabled) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">'keydown'</span>) &#123;</span><br><span class="line">      dispatchKeyboardEvent(</span><br><span class="line">        <span class="string">'onKeyDown'</span>,</span><br><span class="line">        event,</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">'keydown'</span>,</span><br><span class="line">        ((responderTarget: any): Element | Document),</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'keyup'</span>) &#123;</span><br><span class="line">      dispatchKeyboardEvent(</span><br><span class="line">        <span class="string">'onKeyUp'</span>,</span><br><span class="line">        event,</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">'keyup'</span>,</span><br><span class="line">        ((responderTarget: any): Element | Document),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹dispatchKeyboardEvent:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchKeyboardEvent</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  eventPropName: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  event: ReactDOMResponderEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">  context: ReactDOMResponderContext,</span></span></span><br><span class="line"><span class="function"><span class="params">  type: KeyboardEventType,</span></span></span><br><span class="line"><span class="function"><span class="params">  target: Element | Document,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šè§„èŒƒåŒ–äº‹ä»¶çš„keyå±æ€§</span></span><br><span class="line">  <span class="keyword">const</span> syntheticEvent = createKeyboardEvent(event, context, type, target);</span><br><span class="line">  <span class="comment">// âš›ï¸é€šè¿‡Responderä¸Šä¸‹æ–‡åˆ†å‘äº‹ä»¶</span></span><br><span class="line">  context.dispatchEvent(eventPropName, syntheticEvent, DiscreteEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºResponder:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸createResponderæŠŠkeyboardResponderImplè½¬æ¢ä¸ºç»„ä»¶å½¢å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> KeyboardResponder = React.unstable_createResponder(</span><br><span class="line">  <span class="string">'Keyboard'</span>,</span><br><span class="line">  keyboardResponderImpl,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸åˆ›å»ºhookså½¢å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useKeyboardListener</span>(<span class="params">props: KeyboardListenerProps</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  React.unstable_useListener(KeyboardResponder, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç°åœ¨è¯»è€…åº”è¯¥å¯¹<strong>Responderçš„èŒè´£</strong>æœ‰äº†ä¸€äº›åŸºæœ¬çš„äº†è§£ï¼Œå®ƒä¸»è¦åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…:</p><ul><li>å£°æ˜è¦ç›‘å¬çš„åŸç”Ÿäº‹ä»¶(å¦‚DOM), å¦‚ä¸Šé¢çš„<code>targetEventTypes</code></li><li>å¤„ç†å’Œè½¬æ¢åˆæˆäº‹ä»¶ï¼Œå¦‚ä¸Šé¢çš„<code>onEvent</code></li><li>åˆ›å»ºå¹¶åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚å¦‚ä¸Šé¢çš„<code>context.dispatchEvent</code></li></ul><p><br></p><p>å’Œä¸Šé¢çš„Keyboardæ¨¡å—ç›¸æ¯”ï¼Œç°å®ä¸­çš„å¾ˆå¤šé«˜çº§äº‹ä»¶ï¼Œå¦‚longPress, å®ƒä»¬çš„å®ç°åˆ™è¦å¤æ‚å¾—å¤š. å®ƒä»¬å¯èƒ½è¦ç»´æŒä¸€å®šçš„<strong>çŠ¶æ€</strong>ã€ä¹Ÿå¯èƒ½è¦ç‹¬å å“åº”çš„<strong>æ‰€æœ‰æƒ</strong>(å³åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªResponderå¯ä»¥å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†, è¿™ä¸ªå¸¸ç”¨äºç§»åŠ¨ç«¯è§¦æ‘¸æ‰‹åŠ¿ï¼Œä¾‹å¦‚React Nativeçš„<a href="https://reactnative.cn/docs/gesture-responder-system/" target="_blank" rel="noopener">GestureResponderSystem</a>)ã€‚</p><p>react-eventsç›®å‰éƒ½è€ƒè™‘äº†è¿™äº›åœºæ™¯, çœ‹ä¸€ä¸‹APIæ¦‚è§ˆ:</p><p><img src="/images/react-event/react-events.png" alt></p><p><br></p><p>è¯¦ç»†å¯ä»¥çœ‹react-events<a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener">å®˜æ–¹ä»“åº“</a></p><p><br></p><h3 id="react-eventsæ„ä¹‰ä½•åœ¨"><a href="#react-eventsæ„ä¹‰ä½•åœ¨" class="headerlink" title="react-eventsæ„ä¹‰ä½•åœ¨?"></a>react-eventsæ„ä¹‰ä½•åœ¨?</h3><p>ä¸Šæ–‡æåˆ°äº†Reactäº‹ä»¶å†…éƒ¨é‡‡ç”¨äº†æ’ä»¶æœºåˆ¶ï¼Œæ¥å®ç°äº‹ä»¶å¤„ç†å’Œåˆæˆï¼Œæ¯”è¾ƒå…¸å‹çš„å°±æ˜¯onChangeäº‹ä»¶ã€‚onChangeäº‹ä»¶å…¶å®å°±æ˜¯æ‰€è°“çš„â€˜é«˜çº§äº‹ä»¶â€™ï¼Œå®ƒæ˜¯é€šè¿‡è¡¨å•ç»„ä»¶çš„å„ç§åŸç”Ÿäº‹ä»¶æ¥æ¨¡æ‹Ÿçš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒReacté€šè¿‡æ’ä»¶æœºåˆ¶æœ¬è´¨ä¸Šæ˜¯å¯ä»¥å®ç°é«˜çº§äº‹ä»¶çš„å°è£…çš„ã€‚ä½†æ˜¯å¦‚æœè¯»è€…çœ‹è¿‡æºä»£ç ï¼Œå°±ä¼šè§‰å¾—é‡Œé¢é€»è¾‘æ¯”è¾ƒç»•ï¼Œè€Œä¸”ä¾èµ–Reactçš„å¾ˆå¤šå†…éƒ¨å®ç°ã€‚<strong>æ‰€ä»¥è¿™ç§å†…éƒ¨çš„æ’ä»¶æœºåˆ¶å¹¶ä¸æ˜¯é¢å‘æ™®é€šå¼€å‘è€…çš„</strong>ã€‚</p><p><code>react-events</code>æ¥å£å°±ç®€å•å¾ˆå¤šäº†ï¼Œå®ƒå±è”½äº†å¾ˆå¤šå†…éƒ¨ç»†èŠ‚ï¼Œé¢å‘æ™®é€šå¼€å‘è€…ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é«˜æ€§èƒ½çš„è‡ªå®šä¹‰äº‹ä»¶åˆ†å‘ï¼Œæ›´å¤§çš„æ„ä¹‰æ˜¯é€šè¿‡å®ƒå¯ä»¥å®ç°è·¨å¹³å°/è®¾å¤‡çš„äº‹ä»¶å¤„ç†æ–¹å¼.</p><p>ç›®å‰react-eventsè¿˜æ˜¯å®éªŒé˜¶æ®µï¼Œç‰¹æ€§æ˜¯é»˜è®¤å…³é—­ï¼ŒAPIå¯èƒ½ä¼šå‡ºç°å˜æ›´, æ‰€ä»¥ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://github.com/facebook/react/issues/15257" target="_blank" rel="noopener">Issue</a>æ¥å…³æ³¨å®ƒçš„è¿›å±•ã€‚</p><p><br></p><p>æœ€åèµå¹ä¸€ä¸‹Reactå›¢é˜Ÿçš„åˆ›æ–°èƒ½åŠ›ï¼</p><p><br></p><p>å®Œï¼</p><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://segmentfault.com/a/1190000013094932" target="_blank" rel="noopener">inputäº‹ä»¶ä¸­æ–‡è§¦å‘å¤šæ¬¡é—®é¢˜ç ”ç©¶</a></li><li><a href="http://www.ayqy.net/blog/dive-into-react-fiber/" target="_blank" rel="noopener">å®Œå…¨ç†è§£React Fiber</a></li><li><a href="https://www.youtube.com/watch?v=ZCuYPiUIONs" target="_blank" rel="noopener">Lin Clark â€“ A Cartoon Intro to Fiber â€“ React Conf 2017</a></li><li><a href="https://philippspiess.com/scheduling-in-react/" target="_blank" rel="noopener">Scheduling in React</a></li><li><a href="https://github.com/facebook/react/issues/15257" target="_blank" rel="noopener">[Umbrella] React Flare</a></li><li><a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener">react-events</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/react-event/sample.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘. &lt;/p
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>if æˆ‘æ˜¯å‰ç«¯å›¢é˜ŸLeaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ?</title>
    <link href="https://bobi.ink/2019/07/19/frontend-standard/"/>
    <id>https://bobi.ink/2019/07/19/frontend-standard/</id>
    <published>2019-07-18T16:00:00.000Z</published>
    <updated>2019-07-29T03:22:24.765Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸‡å­—é•¿æ–‡ï¼Œç»§ç»­åˆ·æ–°æˆ‘çš„æ–‡ç« é•¿åº¦è®°å½•ï¼Œæ¶‰åŠå‰ç«¯å¼€å‘çš„æ–¹æ–¹é¢é¢ã€‚æœ¬æ–‡å°†æŒç»­æ›´æ–°å’Œå®Œå–„, æ–‡ç« éƒ¨åˆ†è§‚ç‚¹å¯èƒ½æ¯”è¾ƒæ­¦æ–­æˆ–ä¸å®Œæ•´ï¼Œæ¬¢è¿è¯„è®ºå’Œè¡¥å……ï¼Œä¸€èµ·å®Œå–„è¯¥æ–‡ç« . è°¢è°¢</p></blockquote><p><br></p><p>ç¬”è€…é•¿æœŸå•æªåŒ¹é©¬åœ¨å‰ç«¯é¢†åŸŸå®æ€(è¨€å¤–ä¹‹æ„å°±æ˜¯å›¢é˜Ÿå°±ä¸€ä¸ªäºº)ï¼Œè‡ªå·±å°±æ˜¯è§„èŒƒã€‚éšç€å…¬å¸ä¸šåŠ¡çš„æ‰©å±•ï¼Œæ‰©å……äº†ä¸€äº›äººå‘˜ï¼Œè¿™æ—¶å€™å°±è¦å¼€å§‹è€ƒè™‘åä½œå’Œç¼–ç è§„èŒƒé—®é¢˜äº†ã€‚æœ¬æ–‡è®°å½•äº†ç¬”è€…åœ¨åˆ¶å®š<code>å‰ç«¯åä½œè§„èŒƒ</code>æ—¶çš„ä¸€äº›æ€è€ƒï¼Œå¸Œæœ›èƒ½ç»™ä½ ä»¬ä¹Ÿå¸¦æ¥ä¸€äº›å¸®åŠ©.</p><p><strong>ä¸€ä¸ªäººèµ°çš„æ›´å¿«ï¼Œä¸€ç¾¤äººå¯ä»¥èµ°å¾—æ›´è¿œï¼Œå‰ææ˜¯ç»Ÿä¸€çš„ç­–ç•¥ï¼Œè¿˜è¦ä¸æ–­åœ°åçœå’Œä¼˜åŒ–</strong>ã€‚</p><p><br></p><p><strong>ä»¥ä¸‹æ˜¯ç›®å½•æ¦‚è§ˆ, çœ‹å‡ºè¿™æ˜¯ä¸€ç¯‡æµ©æµ©è¡è¡çš„é•¿æ–‡</strong></p><!-- TOC --><ul><li><a href="#1-å·¥ä½œæµè§„èŒƒ">1 å·¥ä½œæµè§„èŒƒ</a><ul><li><a href="#11-å¼€å‘">1.1 å¼€å‘</a><ul><li><a href="#111-ç‰ˆæœ¬è§„èŒƒ">1.1.1 ç‰ˆæœ¬è§„èŒƒ</a></li><li><a href="#112-ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ">1.1.2 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ</a></li><li><a href="#113-æäº¤ä¿¡æ¯è§„èŒƒ">1.1.3 æäº¤ä¿¡æ¯è§„èŒƒ</a></li></ul></li><li><a href="#12-æ„å»ºè§„èŒƒ">1.2 æ„å»ºè§„èŒƒ</a></li><li><a href="#13-å‘å¸ƒå·¥ä½œæµè§„èŒƒ">1.3 å‘å¸ƒå·¥ä½œæµè§„èŒƒ</a></li><li><a href="#14-æŒç»­é›†æˆ">1.4 æŒç»­é›†æˆ</a></li><li><a href="#15-ä»»åŠ¡ç®¡ç†">1.5 ä»»åŠ¡ç®¡ç†</a></li></ul></li><li><a href="#2-æŠ€æœ¯æ ˆè§„èŒƒ">2 æŠ€æœ¯æ ˆè§„èŒƒ</a><ul><li><a href="#21-æŠ€æœ¯é€‰å‹">2.1 æŠ€æœ¯é€‰å‹</a></li><li><a href="#22-è¿æ¥æ–°æŠ€æœ¯">2.2 è¿æ¥æ–°æŠ€æœ¯</a></li></ul></li><li><a href="#3-æµè§ˆå™¨å…¼å®¹è§„èŒƒ">3 æµè§ˆå™¨å…¼å®¹è§„èŒƒ</a><ul><li><a href="#31-ç¡®å®šå…¼å®¹ç­–ç•¥">3.1 ç¡®å®šå…¼å®¹ç­–ç•¥</a></li><li><a href="#32-ç¡®å®šæµè§ˆå™¨åˆ†çº§">3.2 ç¡®å®šæµè§ˆå™¨åˆ†çº§</a></li><li><a href="#33-è·å–ç»Ÿè®¡æ•°æ®">3.3 è·å–ç»Ÿè®¡æ•°æ®</a></li></ul></li><li><a href="#4-é¡¹ç›®ç»„ç»‡è§„èŒƒ">4 é¡¹ç›®ç»„ç»‡è§„èŒƒ</a><ul><li><a href="#41-é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ">4.1 é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ</a></li><li><a href="#42-ç›®å½•ç»„ç»‡çš„é£æ ¼">4.2 ç›®å½•ç»„ç»‡çš„é£æ ¼</a></li><li><a href="#43-è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿">4.3 è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿</a></li></ul></li><li><a href="#5-ç¼–ç è§„èŒƒ">5 ç¼–ç è§„èŒƒ</a><ul><li><a href="#51-javascript">5.1 Javascript</a></li><li><a href="#52-html">5.2 HTML</a></li><li><a href="#53-css">5.3 CSS</a></li><li><a href="#54-ä»£ç æ ¼å¼åŒ–">5.4 ä»£ç æ ¼å¼åŒ–</a></li><li><a href="#55-é›†å¤§æˆçš„">5.5 é›†å¤§æˆçš„</a></li><li><a href="#56-ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—">5.6 ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—</a></li><li><a href="#57-code-review">5.7 Code Review</a></li></ul></li><li><a href="#6-æ–‡æ¡£è§„èŒƒ">6 æ–‡æ¡£è§„èŒƒ</a><ul><li><a href="#61-å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ">6.1 å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ</a></li><li><a href="#62-æ–‡æ¡£æ ¼å¼">6.2 æ–‡æ¡£æ ¼å¼</a></li><li><a href="#63-å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿">6.3 å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿</a></li><li><a href="#64-è®¨è®ºå³æ–‡æ¡£">6.4 è®¨è®ºå³æ–‡æ¡£</a></li><li><a href="#65-æ³¨é‡Šå³æ–‡æ¡£">6.5 æ³¨é‡Šå³æ–‡æ¡£</a></li><li><a href="#66-ä»£ç å³æ–‡æ¡£">6.6 ä»£ç å³æ–‡æ¡£</a></li></ul></li><li><a href="#7-uiè®¾è®¡è§„èŒƒ">7 UIè®¾è®¡è§„èŒƒ</a></li><li><a href="#8-æµ‹è¯•è§„èŒƒ">8 æµ‹è¯•è§„èŒƒ</a><ul><li><a href="#81-æµ‹è¯•çš„æµç¨‹">8.1 æµ‹è¯•çš„æµç¨‹</a></li><li><a href="#82-å•å…ƒæµ‹è¯•">8.2 å•å…ƒæµ‹è¯•</a></li></ul></li><li><a href="#9-å¼‚å¸¸å¤„ç†ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ">9 å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ</a><ul><li><a href="#91-å¼‚å¸¸å¤„ç†">9.1 å¼‚å¸¸å¤„ç†</a></li><li><a href="#92-æ—¥å¿—">9.2 æ—¥å¿—</a></li><li><a href="#93-å¼‚å¸¸ç›‘æ§">9.3 å¼‚å¸¸ç›‘æ§</a></li></ul></li><li><a href="#10-å‰åç«¯åä½œè§„èŒƒ">10 å‰åç«¯åä½œè§„èŒƒ</a><ul><li><a href="#101-åä½œæµç¨‹è§„èŒƒ">10.1 åä½œæµç¨‹è§„èŒƒ</a></li><li><a href="#102-æ¥å£è§„èŒƒ">10.2 æ¥å£è§„èŒƒ</a></li><li><a href="#103-æ¥å£æ–‡æ¡£è§„èŒƒ">10.3 æ¥å£æ–‡æ¡£è§„èŒƒ</a></li><li><a href="#104-æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ">10.4 æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ</a></li></ul></li><li><a href="#11-åŸ¹è®­çŸ¥è¯†ç®¡ç†æŠ€æœ¯æ²‰æ·€">11 åŸ¹è®­/çŸ¥è¯†ç®¡ç†/æŠ€æœ¯æ²‰æ·€</a><ul><li><a href="#111-æ–°äººåŸ¹è®­">11.1 æ–°äººåŸ¹è®­</a></li><li><a href="#112-è¥é€ æŠ€æœ¯æ°›å›´">11.2 è¥é€ æŠ€æœ¯æ°›å›´</a></li></ul></li><li><a href="#12-åé¦ˆ">12 åé¦ˆ</a></li></ul><!-- /TOC --><p><br></p><p><strong>CHANGELOG</strong></p><ul><li>2019.7.28<br>æ–°å¢<a href="#tech-select">æŠ€æœ¯é€‰å‹</a></li><li>2019.7.29<br>æ–°å¢<a href="#brw-anly">æµè§ˆå™¨ç»Ÿè®¡æ•°æ®è·å–</a></li></ul><p><br></p><p><strong>ä»€ä¹ˆæ˜¯è§„èŒƒ?</strong></p><p>è§„èŒƒï¼Œåè¯æ„ä¹‰ä¸Šï¼šå³æ˜æ–‡è§„å®šæˆ–çº¦å®šä¿—æˆçš„æ ‡å‡†ï¼Œå¦‚ï¼šé“å¾·è§„èŒƒã€æŠ€æœ¯è§„èŒƒç­‰ã€‚ åŠ¨è¯æ„ä¹‰ä¸Šï¼šæ˜¯æŒ‡æŒ‰ç…§æ—¢å®šæ ‡å‡†ã€è§„èŒƒçš„è¦æ±‚è¿›è¡Œæ“ä½œï¼Œä½¿æŸä¸€è¡Œä¸ºæˆ–æ´»åŠ¨è¾¾åˆ°æˆ–è¶…è¶Šè§„å®šçš„æ ‡å‡†ï¼Œå¦‚ï¼šè§„èŒƒç®¡ç†ã€è§„èŒƒæ“ä½œ.</p><p><br></p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦è§„èŒƒ?</strong></p><ul><li>é™ä½æ–°æˆå‘˜èå…¥å›¢é˜Ÿçš„æˆæœ¬, åŒæ—¶ä¹Ÿä¸€å®šç¨‹åº¦é¿å…æŒ–å‘</li><li>æé«˜å¼€å‘æ•ˆç‡ã€å›¢é˜Ÿåä½œæ•ˆç‡, é™ä½æ²Ÿé€šæˆæœ¬</li><li>å®ç°é«˜åº¦ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼Œæ–¹ä¾¿review, å¦å¤–ä¸€æ–¹é¢å¯ä»¥æé«˜é¡¹ç›®çš„å¯ç»´æŠ¤æ€§</li><li>è§„èŒƒæ˜¯å®ç°è‡ªåŠ¨åŒ–çš„åŸºç¡€</li><li>è§„èŒƒæ˜¯ä¸€ä¸ªå›¢é˜ŸçŸ¥è¯†æ²‰æ·€çš„ç›´æ¥è¾“å‡º</li></ul><p><br></p><p><strong>è§„èŒƒåŒ…å«å“ªäº›å†…å®¹?</strong></p><p>å¦‚æ–‡ç« æ ‡é¢˜ï¼Œ<strong>å‰ç«¯åä½œè§„èŒƒå¹¶ä¸å•å•æŒ‡â€˜ç¼–ç è§„èŒƒâ€™ï¼Œè¿™ä¸ªè§„èŒƒæ¶‰åŠåˆ°å‰ç«¯å¼€å‘æ´»åŠ¨çš„æ–¹æ–¹é¢é¢</strong>ï¼Œä¾‹å¦‚ä»£ç åº“çš„ç®¡ç†ã€å‰åç«¯åä½œã€ä»£ç è§„èŒƒã€å…¼å®¹æ€§è§„èŒƒï¼›</p><p>ä¸ä»…ä»…æ˜¯å‰ç«¯å›¢é˜Ÿå†…éƒ¨éœ€è¦åä½œï¼Œä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæˆ‘ä»¬éœ€è¦å’Œäº§å“/è®¾è®¡ã€åç«¯(æˆ–è€…åŸç”Ÿå®¢æˆ·ç«¯å›¢é˜Ÿ)ã€æµ‹è¯•è¿›è¡Œåä½œ, æˆ‘ä»¬éœ€è¦è¦†ç›–è¿™äº›å†…å®¹.</p><p><br></p><p>ä¸‹é¢å°±å¼€å§‹ä»‹ç»ï¼Œ<strong>å¦‚æœæˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿçš„Leaderï¼Œæˆ‘ä¼šæ€ä¹ˆåˆ¶å®šå‰ç«¯è§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒéœ€è¦åŒ…å«å“ªäº›å†…å®¹</strong>?</p><p><br></p><h2 id="1-å·¥ä½œæµè§„èŒƒ"><a href="#1-å·¥ä½œæµè§„èŒƒ" class="headerlink" title="1 å·¥ä½œæµè§„èŒƒ"></a>1 å·¥ä½œæµè§„èŒƒ</h2><h3 id="1-1-å¼€å‘"><a href="#1-1-å¼€å‘" class="headerlink" title="1.1 å¼€å‘"></a>1.1 å¼€å‘</h3><h4 id="1-1-1-ç‰ˆæœ¬è§„èŒƒ"><a href="#1-1-1-ç‰ˆæœ¬è§„èŒƒ" class="headerlink" title="1.1.1 ç‰ˆæœ¬è§„èŒƒ"></a>1.1.1 ç‰ˆæœ¬è§„èŒƒ</h4><p>é¡¹ç›®çš„ç‰ˆæœ¬å·åº”è¯¥æ ¹æ®æŸäº›è§„åˆ™è¿›è¡Œè¿­ä»£, è¿™é‡Œæ¨èä½¿ç”¨<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">è¯­ä¹‰åŒ–ç‰ˆæœ¬</a>è§„èŒƒ, <strong>é€šè¿‡è¿™ä¸ªè§„èŒƒï¼Œç”¨æˆ·å¯ä»¥äº†è§£ç‰ˆæœ¬å˜æ›´çš„å½±å“èŒƒå›´</strong>ã€‚ è§„åˆ™å¦‚ä¸‹:</p><ul><li>ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ</li><li>æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ</li><li>ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-1-2-ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ"><a href="#1-1-2-ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ" class="headerlink" title="1.1.2 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ"></a>1.1.2 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ</h4><p>å¤§éƒ¨åˆ†å›¢é˜Ÿéƒ½ä½¿ç”¨gitä½œä¸ºç‰ˆæœ¬åº“ï¼Œç®¡ç†å¥½ä»£ç ä¹Ÿæ˜¯ä¸€ç§å­¦é—®ã€‚å°¤å…¶æ˜¯æ¶‰åŠå¤šäººå¹¶å‘åä½œã€éœ€è¦ç®¡ç†å¤šä¸ªè½¯ä»¶ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå®šä¹‰è‰¯å¥½çš„ç‰ˆæœ¬åº“ç®¡ç†è§„èŒƒï¼Œå¯ä»¥è®©å¤§å‹é¡¹ç›®æ›´æœ‰ç»„ç»‡æ€§ï¼Œä¹Ÿå¯ä»¥æé«˜æˆå‘˜åä½œæ•ˆç‡.</p><p>æ¯”è¾ƒæµè¡Œçš„gitåˆ†æ”¯æ¨¡å‹/å·¥ä½œæµæ˜¯<a href="https://www.git-tower.com/learn/git/ebook/cn/command-line/advanced-topics/git-flow" target="_blank" rel="noopener">git-flow</a>, ä½†æ˜¯å¤§éƒ¨åˆ†å›¢é˜Ÿä¼šæ ¹æ®è‡ªå·±çš„æƒ…å†µåˆ¶å®šè‡ªå·±çš„gitå·¥ä½œæµè§„èŒƒ, ä¾‹å¦‚æˆ‘ä»¬å›¢é˜Ÿçš„<a href="https://github.com/GDJiaMi/frontend-standards/blob/master/development.md#git-%E5%88%86%E6%94%AF%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">åˆ†æ”¯è§„èŒƒ</a></p><p><strong>Git æœ‰å¾ˆå¤šå·¥ä½œæµæ–¹æ³•è®ºï¼Œè¿™äº›å·¥ä½œæµçš„é€‰æ‹©å¯èƒ½ä¾èµ–äºé¡¹ç›®çš„è§„æ¨¡ã€é¡¹ç›®çš„ç±»å‹ä»¥åŠå›¢é˜Ÿæˆå‘˜çš„ç»“æ„</strong>.</p><p>æ¯”å¦‚ä¸€ä¸ªç®€å•çš„ä¸ªäººé¡¹ç›®å¯èƒ½ä¸éœ€è¦å¤æ‚çš„åˆ†æ”¯åˆ’åˆ†ï¼Œæˆ‘ä»¬çš„å˜æ›´éƒ½æ˜¯ç›´æ¥æäº¤åˆ° master åˆ†æ”¯;</p><p>å†æ¯”å¦‚å¼€æºé¡¹ç›®ï¼Œé™¤äº†æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ï¼Œå…¶ä»–è´¡çŒ®è€…æ˜¯æ²¡æœ‰æäº¤çš„æƒé™çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€å®šçš„æ‰‹æ®µæ¥éªŒè¯å’Œè®¨è®ºè´¡çŒ®çš„ä»£ç æ˜¯å¦åˆç†ã€‚ æ‰€ä»¥å¯¹äºå¼€æºé¡¹ç›® fork å·¥ä½œæµæ›´ä¸ºé€‚åˆ.</p><p>äº†è§£å¸¸è§çš„å·¥ä½œæµæœ‰åˆ©äºç»„ç»‡æˆ–åˆ›å»ºé€‚åˆè‡ªå·±å›¢é˜Ÿçš„å·¥ä½œæµ, æäº¤å›¢é˜Ÿåä½œçš„æ•ˆç‡:</p><p><img src="/images/frontend-standard/branch.png" alt></p><ul><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/centralized.md" target="_blank" rel="noopener">ç®€å•çš„é›†ä¸­å¼</a></li><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/feature.md" target="_blank" rel="noopener">åŸºäºåŠŸèƒ½åˆ†æ”¯çš„å·¥ä½œæµ</a></li><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/gitflow.md" target="_blank" rel="noopener">Git Flow</a> ğŸ”¥</li><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/fork.md" target="_blank" rel="noopener">Fork/Pull Request å·¥ä½œæµ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-1-3-æäº¤ä¿¡æ¯è§„èŒƒ"><a href="#1-1-3-æäº¤ä¿¡æ¯è§„èŒƒ" class="headerlink" title="1.1.3 æäº¤ä¿¡æ¯è§„èŒƒ"></a>1.1.3 æäº¤ä¿¡æ¯è§„èŒƒ</h4><p><img src="/images/frontend-standard/commit.png" alt></p><p>ç»„ç»‡å¥½çš„æäº¤ä¿¡æ¯, å¯ä»¥æé«˜é¡¹ç›®çš„æ•´ä½“è´¨é‡. è‡³å°‘å…·æœ‰ä¸‹é¢è¿™äº›ä¼˜ç‚¹:</p><ul><li><strong>æ ¼å¼ç»Ÿä¸€çš„æäº¤ä¿¡æ¯æœ‰åŠ©äºè‡ªåŠ¨åŒ–ç”ŸæˆCHANGELOG</strong></li><li><strong>ç‰ˆæœ¬åº“ä¸åªæ˜¯å­˜æ”¾ä»£ç çš„ä»“åº“, å®ƒè®°å½•é¡¹ç›®çš„å¼€å‘æ—¥å¿—, å®ƒåº”è¯¥è¦æ¸…æ™°è¡¨è¾¾è¿™æ¬¡æäº¤çš„åšäº†ä»€ä¹ˆ</strong>. è¿™äº›è®°å½•åº”è¯¥å¯ä»¥å¸®åŠ©åæ¥è€…å¿«é€Ÿåœ°å­¦ä¹ å’Œå›é¡¾ä»£ç , ä¹Ÿåº”è¯¥æ–¹ä¾¿å…¶ä»–åä½œè€…reviewä½ çš„ä»£ç </li><li><strong>è§„èŒƒåŒ–æäº¤ä¿¡æ¯å¯ä»¥ä¿ƒè¿›æäº¤è€…æäº¤æœ‰æ„ä¹‰çš„ã€ç²’åº¦åˆé€‚çš„â€™æäº¤â€™</strong>. æäº¤è€…è¦æƒ³å¥½è¦æ€ä¹ˆæè¿°è¿™ä¸ªæäº¤ï¼Œè¿™æ ·è¢«åŠ¨ä¿ƒè¿›äº†ä»–ä»¬å»æŠŠæ§<strong>æäº¤çš„ç²’åº¦</strong></li></ul><p><br></p><p>ç¤¾åŒºä¸Šæ¯”è¾ƒæµè¡Œçš„æäº¤ä¿¡æ¯è§„èŒƒæ˜¯<a href="https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit" target="_blank" rel="noopener">Angularçš„æäº¤ä¿¡æ¯è§„èŒƒ</a>, é™¤æ­¤ä¹‹å¤–ï¼Œè¿™äº›ä¹Ÿå¾ˆä¸é”™:</p><ul><li><a href="https://github.com/atom/atom/blob/master/CONTRIBUTING.md#git-commit-messages" target="_blank" rel="noopener">Atom</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-ember" target="_blank" rel="noopener">Ember</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-eslint" target="_blank" rel="noopener">Eslint</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-jquery" target="_blank" rel="noopener">JQuery</a></li></ul><p><br></p><p>å¦å¤–è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ æ£€éªŒæäº¤ä¿¡æ¯, ä»¥åŠç”ŸæˆCHANGELOG:</p><ul><li><a href="https://github.com/conventional-changelog/conventional-changelog" target="_blank" rel="noopener">conventional-changelog</a> - ä»é¡¹ç›®çš„æäº¤ä¿¡æ¯ä¸­ç”ŸæˆCHANGELOGå’Œå‘å¸ƒä¿¡æ¯</li><li><a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener">commitlint</a> - æ£€éªŒæäº¤ä¿¡æ¯</li><li><a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener">commitizen</a> - ğŸ”¥ç®€å•çš„æäº¤è§„èŒƒå’Œæäº¤å¸®åŠ©å·¥å…·ï¼Œæ¨è</li><li><a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener">standard-changelog</a> - angularé£æ ¼çš„æäº¤å‘½ä»¤è¡Œå·¥å…· </li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-2-æ„å»ºè§„èŒƒ"><a href="#1-2-æ„å»ºè§„èŒƒ" class="headerlink" title="1.2 æ„å»ºè§„èŒƒ"></a>1.2 æ„å»ºè§„èŒƒ</h3><p>å¯¹äºå›¢é˜Ÿã€æˆ–è€…éœ€è¦ç»´æŠ¤å¤šä¸ªé¡¹ç›®åœºæ™¯ï¼Œç»Ÿä¸€çš„æ„å»ºå·¥å…·é“¾å¾ˆé‡è¦, <strong>è¿™å¥—å·¥å…·åº”è¯¥å¼ºè°ƒâ€çº¦å®šå¤§äºé…ç½®â€ï¼Œè®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡çš„å¼€å‘</strong>ã€‚ç¬”è€…åœ¨<a href="https://juejin.im/post/5d2fcaacf265da1b95708f63" target="_blank" rel="noopener">&lt;ä¸ºä»€ä¹ˆè¦ç”¨vue-cli3?&gt;</a>æ–‡ç« ä¸­æå‡ºäº†<code>vue-cli3</code>æ›´æ–°æœ‰å¾ˆå¤šäº®ç‚¹ï¼Œéå¸¸é€‚åˆä½œä¸ºå›¢é˜Ÿæ„å»ºå·¥å…·é“¾çš„åŸºç¡€:</p><ul><li><strong>é¦–å…ˆè¿™ç±»å·¥å…·æ˜¯æ¨å´‡â€™çº¦å®šå¤§äºé…ç½®â€™</strong>ã€‚å³æŒ‰ç…§ä»–ä»¬çš„è§„èŒƒï¼Œå¯ä»¥å®ç°å¼€ç®±å³ç”¨ï¼Œå¿«é€Ÿå¼€å‘ä¸šåŠ¡. åœ¨å›¢é˜Ÿåä½œä¸­è¿™ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘ä»¬ä¸æ¨èå›¢é˜Ÿæˆå‘˜å»å…³å¿ƒåˆè‡­åˆé•¿çš„webpackæ„å»ºé…ç½®</li><li><strong><code>vue-cli3</code>æŠ½ç¦»äº†<code>cli serviceå±‚</code>ï¼Œå¯ä»¥ç‹¬ç«‹æ›´æ–°å·¥å…·é“¾</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´é¡¹ç›®çš„æ„å»ºè„šæœ¬å’Œé…ç½®åœ¨ä¸€ä¸ªç‹¬ç«‹çš„serviceé¡¹ç›®ä¸­ç»´æŠ¤ï¼Œè€Œä¸æ˜¯åƒä»¥å‰ä¸€æ ·åœ¨æ¯ä¸ªé¡¹ç›®ç›®å½•ä¸‹éƒ½æœ‰webpacké…ç½®å’Œä¾èµ–. è¿™æ ·åšçš„å¥½å¤„æ˜¯ç‹¬ç«‹åœ°ã€ç®€å•åœ°å‡çº§æ•´ä¸ªæ„å»ºé“¾</li><li><strong>çµæ´»çš„æ’ä»¶æœºåˆ¶</strong>ã€‚å¯¹äºå›¢é˜Ÿçš„å®šåˆ¶åŒ–æ„å»ºåº”è¯¥å°è£…åˆ°æ’ä»¶ä¸­ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å®ç°ç‹¬ç«‹çš„æ›´æ–°ã€‚</li></ul><p><strong>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç¬¬ä¸‰æ–¹CLI, å½“ç„¶ä¹Ÿå®šåˆ¶è‡ªå·±çš„æ„å»ºé“¾ï¼ŒæŒ‰ç…§ä¸Šé¢è¯´çš„è¿™ä¸ªæ„å»ºé“¾åº”è¯¥æœ‰ä»¥ä¸‹ç‰¹ç‚¹</strong>:</p><ul><li><strong>å¼ºçº¦å®šï¼Œä½“ç°å›¢é˜Ÿçš„è§„èŒƒ</strong>ã€‚é¦–å…ˆå®ƒåº”è¯¥é¿å…å›¢é˜Ÿæˆå‘˜å»å…³å¿ƒæˆ–æ›´æ”¹æ„å»ºçš„é…ç½®ç»†èŠ‚ï¼Œæš´éœ²æœ€å°åŒ–çš„é…ç½®æ¥å£ã€‚ <em>å¦å¤–æ„å»ºå·¥å…·ä¸ä»…ä»…æ˜¯æ„å»ºï¼Œé€šå¸¸å®ƒè¿˜ä¼šé›†æˆä»£ç æ£€æŸ¥ã€æµ‹è¯•ç­‰åŠŸèƒ½</em>ã€‚</li><li><strong>æ–¹ä¾¿å‡çº§</strong>ã€‚å°¤å…¶æ˜¯å›¢é˜Ÿéœ€è¦ç»´æŠ¤å¤šä¸ªé¡¹ç›®åœºæ™¯, è¿™ä¸€ç‚¹å¾ˆæœ‰æ„ä¹‰</li></ul><p>ä¸‹é¢æ˜¯ç¤¾åŒºä¸Šæ¯”è¾ƒæµè¡Œçš„æ„å»ºå·¥å…·. å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„å›¢é˜Ÿæƒ…å†µå¼€å‘è‡ªå·±çš„CLI, ä½†æ˜¯ä¸‹é¢çš„å·¥å…·ä¾ç„¶å¾ˆæœ‰<em>å‚è€ƒä»·å€¼</em>ï¼š</p><ul><li><a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a> - ğŸ”¥é›¶é…ç½®å¼€å§‹Reactå¼€å‘</li><li><a href="https://cli.vuejs.org/" target="_blank" rel="noopener">vue-cli</a> - ğŸ”¥é›¶é…ç½®ã€æ¸è¿›å¢å¼ºçš„é¡¹ç›®æ„å»ºCLI</li><li><a href="https://parceljs.org/" target="_blank" rel="noopener">parcel</a> - é›¶é…ç½®çš„Webåº”ç”¨æ‰“åŒ…å·¥å…·</li><li><a href="https://github.com/fuse-box/fuse-box" target="_blank" rel="noopener">Fusebox</a> - é«˜é€Ÿæ˜“ç”¨çš„æ‰“åŒ…å·¥å…·</li><li><a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> - é›¶é…ç½®, åŸºäºRollupï¼Œé€‚åˆç”¨äºæ‰“åŒ…â€˜åº“â€™</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-3-å‘å¸ƒå·¥ä½œæµè§„èŒƒ"><a href="#1-3-å‘å¸ƒå·¥ä½œæµè§„èŒƒ" class="headerlink" title="1.3 å‘å¸ƒå·¥ä½œæµè§„èŒƒ"></a>1.3 å‘å¸ƒå·¥ä½œæµè§„èŒƒ</h3><p>å‘å¸ƒå·¥ä½œæµæŒ‡çš„æ˜¯å°†â€˜è½¯ä»¶æˆå“â€™å¯¹å¤–å‘å¸ƒ(å¦‚æµ‹è¯•æˆ–ç”Ÿäº§)çš„ä¸€å¥—æµç¨‹, å°†è¿™å¥—æµç¨‹è§„èŒƒåŒ–åï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–.</p><p>ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒå·¥ä½œæµå¦‚ä¸‹ï¼š</p><p><img src="/images/frontend-standard/pub.png" alt></p><ul><li>ä»£ç å˜æ›´</li><li>æäº¤ä»£ç å˜æ›´åˆ°è¿œç¨‹ç‰ˆæœ¬åº“</li><li>ç¨‹åºé€šè¿‡CIæµ‹è¯•(ä¾‹å¦‚Traviså˜ç»¿)</li><li>æå‡package.jsonä¸­çš„ç‰ˆæœ¬</li><li>ç”ŸæˆCHANGELOG</li><li>æäº¤package.jsonå’ŒCHANGELOG.mdæ–‡ä»¶</li><li>æ‰“ä¸ŠTag</li><li>æ¨é€</li></ul><p>å¦‚æœä½ éµå¾ªä¸Šé¢çš„è§„èŒƒï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨ç¤¾åŒºä¸Šç°æœ‰çš„å·¥å…·æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªæµç¨‹. è¿™äº›å·¥å…·æœ‰:</p><ul><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli" target="_blank" rel="noopener">conventional-changelog-cli</a></li><li><a href="https://github.com/conventional-changelog/conventional-github-releaser" target="_blank" rel="noopener">conventional-github-releaser</a></li><li>å®é™…ä¸Šè‡ªå·±å¼€å‘ä¸€ä¸ªä¹Ÿä¸æ˜¯ç‰¹åˆ«éš¾çš„äº‹æƒ….</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-4-æŒç»­é›†æˆ"><a href="#1-4-æŒç»­é›†æˆ" class="headerlink" title="1.4 æŒç»­é›†æˆ"></a>1.4 æŒç»­é›†æˆ</h3><p>å°†æ•´å¥—å¼€å‘å·¥ä½œæµç¡®å®šä¸‹æ¥ä¹‹å, å°±å¯ä»¥ä½¿ç”¨<code>æŒç»­é›†æˆæœåŠ¡</code>æ¥è‡ªåŠ¨åŒ–æ‰§è¡Œæ•´ä¸ªæµç¨‹ã€‚æ¯”å¦‚ä¸€ä¸ªå…¸å‹çš„CIæµç¨‹:</p><p><img src="/images/frontend-standard/ci.png" alt></p><p><strong>æŒç»­é›†æˆæ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢</strong>?</p><p>æˆ‘ä»¬éœ€è¦<code>æŒç»­é›†æˆ</code>æ‹†æˆä¸¤ä¸ªè¯åˆ†åˆ«æ¥ç†è§£, ä»€ä¹ˆæ˜¯<code>æŒç»­</code>? ä»€ä¹ˆæ˜¯<code>é›†æˆ</code>?</p><p><strong>æŒç»­(Continuous), å¯ä»¥ç†è§£ä¸ºâ€™é¢‘ç¹â€™æˆ–è€…â€˜è¿ç»­æ€§â€™</strong>. ä¸ç®¡æ˜¯æŒç»­é›†æˆè¿˜æ˜¯æ•æ·å¼€å‘æ€ç»´ã€çœ‹æ¿ï¼Œéƒ½è®¤ä¸ºâ€˜æŒç»­â€™æ˜¯å®ƒä»¬çš„åŸºç¡€ã€‚</p><p>ä¸¾ä¸€ä¸ªé€šä¿—çš„ä¾‹å­ï¼Œ<strong>æ¯”å¦‚ä»£ç æ£€æŸ¥ï¼Œâ€˜æŒç»­çš„â€™çš„ä»£ç æ£€æŸ¥å°±æ˜¯ä»£ç ä¸€å˜åŠ¨(å¦‚ä¿å­˜ï¼Œæˆ–è€…IDEå®æ—¶æ£€æŸ¥ã€æˆ–è€…æäº¤åˆ°ç‰ˆæœ¬åº“æ—¶)å°±é©¬ä¸Šæ£€æŸ¥ä»£ç ï¼Œè€Œâ€˜éæŒç»­â€™çš„ä»£ç æ£€æŸ¥å°±æ˜¯åœ¨å®Œæˆæ‰€æœ‰ç¼–ç åï¼Œå†è¿›è¡Œæ£€æŸ¥</strong>ã€‚å¯¹æ¯”ä¸¤è€…å¯ä»¥å‘ç°ï¼ŒæŒç»­æ€§çš„ä»£ç æ£€æŸ¥å¯ä»¥å°½æ—©åœ°å‘ç°é”™è¯¯ï¼Œè€Œä¸”é”™è¯¯ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£å’Œå¤„ç†ï¼Œåä¹‹éæŒç»­æ€§çš„ä»£ç æ£€æŸ¥ï¼Œå¯èƒ½ä¼šå‘ç°ä¸€å †çš„é”™è¯¯ï¼Œå¤±ä¹‹æ¯«å˜è°¬ä»¥åƒé‡Œï¼Œé”™è¯¯ç›¸äº’ç‰µè¿ï¼Œæœ€ç»ˆä¼šå˜å¾—éš¾ä»¥æ”¶æ‹¾ã€‚</p><p><strong>â€˜æŒç»­â€™çš„æ¦‚å¿µï¼Œå¯ä»¥ç”¨äºè½¯ä»¶å¼€å‘çš„æ–¹æ–¹é¢é¢ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æŠŠä¼ ç»Ÿç€‘å¸ƒå¼çš„è½¯ä»¶å¼€å‘æµç¨‹æ‰“ç¢ï¼Œå½¢æˆä¸€ä¸ªä¸ªæ›´å°çš„å¼€å‘é—­ç¯ï¼ŒæŒç»­åœ°è¾“å‡ºäº§å“ï¼ŒåŒæ—¶äº§å“ä¹ŸæŒç»­åœ°ç»™ä¸Šæ¸¸åé¦ˆå’Œçº æ­£</strong>ã€‚</p><p><img src="/images/frontend-standard/continous.png" alt></p><p><strong>é‚£ä»€ä¹ˆæ˜¯â€˜é›†æˆâ€™å‘¢</strong>ï¼Ÿç‹­ä¹‰çš„é›†æˆå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯<a href="https://juejin.im/post/5d2c515d6fb9a07ead5a2bbe#heading-26" target="_blank" rel="noopener">â€˜é›†æˆæµ‹è¯•â€™</a>å§. é›†æˆæµ‹è¯•å¯ä»¥å¯¹ä»£ç é™æ€æµ‹è¯•ã€å•å…ƒæµ‹è¯•ã€é€šè¿‡å•å…ƒæµ‹è¯•åå¯ä»¥è¿›è¡Œé›†æˆæµ‹è¯•ï¼Œåœ¨åº”ç”¨ç»„æˆä¸€ä¸ªæ•´ä½“ååœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è·‘E2Eæµ‹è¯•ç­‰ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™é‡Œè¿›è¡Œä¸€ç³»åˆ—çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¥éªŒè¯è½¯ä»¶ç³»ç»Ÿã€‚</p><p>å¹¿ä¹‰çš„æŒç»­é›†æˆæœåŠ¡ï¼Œä¸ä»…ä»…æ˜¯æµ‹è¯•ï¼Œå®ƒè¿˜è¡ç”Ÿå‡ºå¾ˆå¤šæ¦‚å¿µï¼Œä¾‹å¦‚æŒç»­äº¤ä»˜ã€æŒç»­éƒ¨ç½²ï¼Œå¦‚ä¸‹å›¾</p><p><img src="/images/frontend-standard/devops.png" alt></p><p>OK, <strong>æ€»ç»“ä¸€ä¸‹ä¸ºä»€ä¹ˆæŒç»­é›†æˆçš„å¥½å¤„</strong>:</p><ul><li>å°½æ—©å‘ç°é”™è¯¯ï¼Œå¿«é€Ÿè¯•é”™ã€‚è¶Šæ—©å‘ç°é”™è¯¯ï¼Œå¤„ç†é”™è¯¯çš„æˆæœ¬è¶Šä½</li><li>è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚äººç±»æ¯”æœºå™¨å®¹æ˜“çŠ¯é”™, è€Œä¸”æœºå™¨æ“…é•¿åšé‡å¤çš„äº‹æƒ…</li></ul><p><br></p><p><strong>å¯¹äºæŒç»­é›†æˆè§„èŒƒä¸€èˆ¬ä¼šå®šä¹‰è¿™äº›å†…å®¹</strong>:</p><ul><li>æ‰§è¡Œçš„ç¯å¢ƒ. æ¯”å¦‚å®¹å™¨ã€Nodeç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç­‰ç­‰</li><li>è§¦å‘çš„æ¡ä»¶ã€‚æ¯”å¦‚å®šæ—¶è§¦å‘ã€åœ¨å“ªä¸ªåˆ†æ”¯è§¦å‘ã€ä¼šè§¦å‘ä»€ä¹ˆä»»åŠ¡ç­‰ç­‰</li><li>æ‰§è¡Œçš„ä»»åŠ¡</li><li>åˆ’åˆ†æŒç»­é›†æˆçš„é˜¶æ®µ. æ¯”å¦‚<ul><li>æ£€æŸ¥ï¼šåŒ…æ‹¬å•å…ƒæµ‹è¯•å’Œä»£ç lint. æ‰€æœ‰pushåˆ°ç‰ˆæœ¬åº“çš„ä»£ç éƒ½ä¼šè·‘è¿™ä¸ªé˜¶æ®µ. ä¸€èˆ¬å¯ä»¥åœ¨æäº¤titleä¸­åŒ…å«[ci skip]æ¥è·³è¿‡è¿™ä¸ªé˜¶æ®µ</li><li>æ„å»º: å¯¹å‰ç«¯é¡¹ç›®è¿›è¡Œæ„å»º. åªæœ‰æ‰“ä¸Šç‰ˆæœ¬tagçš„æäº¤æˆ–releaseåˆ†æ”¯ä¼šè·‘æ„å»ºä»»åŠ¡</li><li>å‘å¸ƒ: å°†å‰ç«¯çš„æ„å»ºç»“æœè¿›è¡Œäº¤ä»˜/å‘å¸ƒ.  åªæœ‰æ‰“ä¸Šç‰ˆæœ¬tagçš„æäº¤æˆ–è€…releaseåˆ†æ”¯åœ¨æ„å»ºæˆåŠŸåä¼šè·‘å‘å¸ƒä»»åŠ¡</li></ul></li><li>å®šä¹‰æŒç»­é›†æˆè„šæœ¬æ¨¡æ¿</li></ul><p><br></p><p>å¸¸ç”¨çš„CIæœåŠ¡:</p><ul><li>Github<ul><li><a href="https://github.com/marketplace/travis-ci" target="_blank" rel="noopener">Travis CI</a></li><li><a href="https://github.com/marketplace/circleci" target="_blank" rel="noopener">CircleCI</a></li><li><a href="https://github.com/marketplace/category/continuous-integration" target="_blank" rel="noopener">å®Œæ•´åˆ—è¡¨</a></li></ul></li><li>GitLab: <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener">Gitlab-CI</a></li><li>é€šç”¨<ul><li><a href="https://jenkins.io" target="_blank" rel="noopener">Jenkins</a></li></ul></li></ul><p><br></p><p>æ‰©å±•</p><ul><li><a href="https://juejin.im/post/58f9ee860ce46300611be392" target="_blank" rel="noopener">æŒç»­é›†æˆæ˜¯ä»€ä¹ˆ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-5-ä»»åŠ¡ç®¡ç†"><a href="#1-5-ä»»åŠ¡ç®¡ç†" class="headerlink" title="1.5 ä»»åŠ¡ç®¡ç†"></a>1.5 ä»»åŠ¡ç®¡ç†</h3><p><img src="/images/frontend-standard/kanban.png" alt></p><p>ä½œä¸ºå‰ç«¯Leaderå°‘ä¸äº†ä»»åŠ¡ç®¡ç†ã€‚<strong>çœ‹æ¿æ˜¯ç›®å‰æœ€ä¸ºæµè¡Œçš„ä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£é¡¹ç›®çš„è¿›åº¦ã€èµ„æºçš„åˆ†é…æƒ…å†µã€è¿˜åŸå¼€å‘ç°åœº</strong>.</p><p>ç¬”è€…æ¯•ä¸šç¬¬ä¸€å¹´åœ¨ä¸€å®¶å¾ˆå°çš„å¤–åŒ…å…¬å¸ä¸­å·¥ä½œï¼Œåˆç”Ÿç‰›çŠŠä¸æ€•è™ï¼Œæˆ‘ç«Ÿç„¶ç»™è€æ¿æ¨é”€èµ·äº†çœ‹æ¿å’Œæ•æ·é¡¹ç›®ç®¡ç†ï¼Œæƒ³è¦æ”¹å–„é¡¹ç›®ç®¡ç†è¿™å—æ•ˆç‡ä½ä¸‹é—®é¢˜ï¼Œè€æ¿è¡¨ç¤ºå¾ˆæ”¯æŒï¼Œä½†æ˜¯å…¶ä»–æˆå‘˜ç§¯ææ€§å¹¶ä¸é«˜, ç»“æœå½“ç„¶æ˜¯å¤±è´¥çš„ã€‚</p><p>å½“æ—¶è¿˜èµ·è‰äº†ä¸€ä»½<a href="https://github.com/ivan-94/kanban_enforcement/blob/master/README.md#%E4%BB%80%E4%B9%88%E6%98%AF%E7%9C%8B%E6%9D%BF" target="_blank" rel="noopener">â€˜çœ‹æ¿å®æ–½ç»†åˆ™â€™</a>, æ‰€ä»¥ä»»åŠ¡ç®¡ç†è¿™ä¸€å—ä¹Ÿç®—å°æœ‰å¿ƒå¾—å§.</p><p>è¯´è¯´ä¸€äº›æ¯”è¾ƒå¥½ç”¨çš„å·¥å…·å§ï¼š</p><ul><li><strong>åŸºäºissueçœ‹æ¿</strong> - å¯ä»¥åŸºäºGitlabæˆ–Githubçš„Issueæ¥åšä»»åŠ¡ç®¡ç†ï¼Œå®ƒä»¬éƒ½æ”¯æŒçœ‹æ¿ã€‚å¾ˆGeekï¼Œæ¨è</li><li><a href="https://tower.im/" target="_blank" rel="noopener"><strong>Tower</strong></a> - ä¸“é—¨åšçœ‹æ¿ä»»åŠ¡ç®¡ç†çš„ã€‚å°å›¢é˜ŸåŸºæœ¬å¤Ÿç”¨ã€‚æˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨è¿™æ¬¾äº§å“</li><li><a href="https://www.teambition.com/" target="_blank" rel="noopener"><strong>teambition</strong></a> - å’ŒTowerå·®ä¸å¤šï¼Œæ²¡æœ‰æ·±å…¥ä½¿ç”¨è¿‡</li><li><a href="https://trello.com/" target="_blank" rel="noopener"><strong>Trello</strong></a> - é¢œå€¼é«˜.</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="2-æŠ€æœ¯æ ˆè§„èŒƒ"><a href="#2-æŠ€æœ¯æ ˆè§„èŒƒ" class="headerlink" title="2 æŠ€æœ¯æ ˆè§„èŒƒ"></a>2 æŠ€æœ¯æ ˆè§„èŒƒ</h2><p>ç¬”è€…ç°åœ¨æ‰€åœ¨çš„å…¬å¸ä¹‹å‰å‰ç«¯æŠ€æœ¯æ ˆå°±éå¸¸æ··ä¹±ï¼ŒVueã€Reactå’ŒAngularJSä¸‰å¤§æ¡†æ¶éƒ½æœ‰, è€Œä¸”é£æ ¼ç›¸å·®ä¹Ÿå¾ˆå¤§. å½“æ—¶æˆ‘å°±æƒ³æ”¶åŒ…è£¹èµ°äºº. å…³äºæŠ€æœ¯æ ˆä¸è§„èŒƒçš„ä¸‹åœºå¯ä»¥å‚è€ƒå°åº¦çš„é£æœº: <a href="https://www.zhihu.com/question/26042167/answer/690035402" target="_blank" rel="noopener">&lt;ä¸ºä»€ä¹ˆå°åº¦çš„é£æœºé¢‘ç¹è¢«æ‘”ï¼Ÿ&gt;</a></p><p>å¾ˆå°‘æœ‰äººèƒ½ç²¾é€šè¿™ä¸‰ä¸ªæ¡†æ¶çš„ï¼Œæ›´åˆ«è¯´æ˜¯ä¸€ä¸ªå›¢é˜Ÿã€‚</p><p><strong>ä¸‰å¤§æ¡†æ¶è·Ÿç¼–ç¨‹è¯­è¨€ä¸€æ ·éƒ½æœ‰è‡ªå·±çš„è®¾è®¡å“²å­¦ï¼Œè¿™è·Ÿåº“æ˜¯ä¸ä¸€æ ·, ä¸€ä¸ªåº“çš„æ›¿æ¢æˆæœ¬å¾ˆä½ï¼›è€Œæ¡†æ¶çš„èƒŒåæ˜¯ä¸€ä¸ªæ¶æ„ã€ä¸€ä¸ªç”Ÿæ€ã€‚æ¯ä¸ªæ¡†æ¶èƒŒåç‰µæ¶‰ç€å¼€å‘æ€ç»´ã€ç”Ÿæ€ç³»ç»Ÿã€é…å¥—å·¥å…·ã€æœ€ä½³å®è·µã€æ€§èƒ½è°ƒä¼˜ã€‚è¦ç²¾é€šå’Œç†Ÿç»ƒä¸€ä¸ªæ¡†æ¶éœ€è¦ä»˜å‡ºçš„æˆæœ¬æ˜¯å¾ˆé«˜</strong>ã€‚</p><p><strong>æ‰€ä»¥è¯´å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡æ˜¯åŸºäºç¨³å®šä¸”ç†Ÿç»ƒçš„æŠ€æœ¯æ ˆçš„</strong>ã€‚ç¨³å®šçš„æŠ€æœ¯æ ˆè§„èŒƒæœ‰åˆ©äºå›¢é˜Ÿåä½œå’Œæ²Ÿé€š; å¦å¤–å¦‚æœå›¢é˜Ÿç²¾é€šè¿™ä¸ªæŠ€æœ¯æ ˆï¼Œå½“å‡ºç°é—®é¢˜æˆ–è€…éœ€è¦æ·±å…¥è°ƒä¼˜, ä¼šç›¸å¯¹è½»æ¾ã€‚</p><p>å‰ç«¯æŠ€æœ¯æ ˆè§„èŒƒä¸»è¦åŒ…å«ä¸‹é¢è¿™äº›ç±»å‹:</p><ul><li>ç¼–ç¨‹è¯­è¨€ - Typescriptæˆ–Javascript</li><li>UIæ¡†æ¶åŠå…¶é…å¥—ç”Ÿæ€, ä»¥åŠå¤‡é€‰æ–¹æ¡ˆã€‚å…¶èƒŒåçš„ç”Ÿæ€éå¸¸åºå¤§:<ul><li>UIæ¡†æ¶</li><li>è·¯ç”±</li><li>çŠ¶æ€ç®¡ç†</li><li>ç»„ä»¶åº“</li><li>å›½é™…åŒ–</li><li>åŠ¨ç”»</li><li>æœåŠ¡ç«¯æ¸²æŸ“</li><li>è„šæ‰‹æ¶ã€CLIå·¥å…·</li><li>ç»„ä»¶æµ‹è¯•</li></ul></li><li>æ ·å¼. åŒ…å«äº†å‘½åè§„èŒƒã€é¢„å¤„ç†å™¨ã€æ–¹æ³•è®ºç­‰ç­‰</li><li>åŠ¨ç”»å¼•æ“</li><li>QA. åŒ…å«äº†æµ‹è¯•ã€Lintã€æ ¼å¼åŒ–å·¥å…·ã€ç›‘æ§</li><li>é¡¹ç›®æ„å»ºå·¥å…·æµ. ä¾‹å¦‚webpackã€vue-cli</li><li>åŒ…ç®¡ç†å™¨ã€‚npmã€yarn</li><li>é¡¹ç›®ç®¡ç†å·¥å…·</li><li>æ—¶é—´å¤„ç†ã€‚ä¾‹å¦‚Moment.js</li><li>æ¨¡æ¿å¼•æ“</li><li>å¼€å‘å·¥å…·</li><li>åç«¯å¼€å‘æ¡†æ¶</li><li>å·¥å…·åº“</li><li>å¼€å‘/è°ƒè¯•å·¥å…·</li><li>ç­‰ç­‰</li></ul><p>å¯ä»¥å‚è€ƒä¸€ä¸‹æˆ‘ä»¬å›¢é˜Ÿçš„<a href="https://github.com/GDJiaMi/frontend-standards/blob/master/tech-stack.md" target="_blank" rel="noopener">æŠ€æœ¯æ ˆè§„èŒƒ</a></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-1-æŠ€æœ¯é€‰å‹"><a href="#2-1-æŠ€æœ¯é€‰å‹" class="headerlink" title="2.1 æŠ€æœ¯é€‰å‹"></a>2.1 æŠ€æœ¯é€‰å‹</h3><p><a id="tech-select"></a></p><p><strong>å¦‚ä½•ä»é›¶å¯¹å›¢é˜Ÿçš„æŠ€æœ¯æ ˆè¿›è¡Œè§„èŒƒ, æˆ–è€…è¯´æ€ä¹ˆè¿›è¡Œé€‰å‹å‘¢</strong>ï¼Ÿä¸¾ä¸ªä¾‹å­, å…ˆç¡®å®šå¤‡é€‰é¡¹, ä½ ç°åœ¨è¦é€‰Vueè¿˜æ˜¯é€‰React(ä¸€ä¸ªå¯èƒ½å¼•èµ·è®ºæˆ˜çš„ä¸»é¢˜)ï¼Ÿ</p><p>æ°å¥½å‰å‡ å¤©åœ¨SegmentFaultå›ç­”äº†ä¸€ä¸ªé—®é¢˜: <a href="https://segmentfault.com/q/1010000019762657/a-1020000019775888" target="_blank" rel="noopener">&lt;ä»€ä¹ˆæ—¶å€™ç”¨vueä»€ä¹ˆæ—¶å€™ç”¨reactï¼Ÿ&gt;</a>, æˆ‘è®²äº†ä¸€ä¸ªæˆ‘ä»¬<strong>å‡ å¹´å‰</strong>æ˜¯å¦‚ä½•å†³å®šè¦ä½¿ç”¨Reactè¿˜æ˜¯Vueçš„ä¾‹å­(æ³¨æ„ç»“æœä¸é‡è¦ï¼)ï¼š</p><p><img src="/images/frontend-standard/vue-vs-react.png" alt></p><p><br></p><p><a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">&lt;è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹&gt;</a>è¿™ç¯‡æ–‡ç« å†™å¾—éå¸¸å¥½ï¼Œç»™äº†æˆ‘ä¸€äº›å¯å‘ã€‚ç»“åˆä¸Šé¢çš„å›ç­”çš„ä¾‹å­, æ¥è®²ä¸€è®²åœ¨å¯¹ç›¸å…³æŠ€æœ¯è¿›è¡Œé€‰å‹çš„ä¸€äº›æ–¹æ³•(è¯„åˆ†é¡¹):</p><ul><li><p><strong>é€‰æ‹©ä½ æœ€ç†Ÿæ‚‰çš„æŠ€æœ¯</strong>ã€‚ä¸Šé¢è¯´åˆ°å›¢é˜Ÿå¦‚æœç†Ÿæ‚‰è¯¥æŠ€æœ¯ï¼Œåˆ™å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ä½¿ç”¨è¿‡ç¨‹ä¸­çš„é£é™©ï¼Œæ–¹ä¾¿å¯¹ç¨‹åºè¿›è¡Œè°ƒä¼˜ã€‚æ‰€ä»¥æˆå‘˜ç†Ÿæ‚‰ã€æˆ–è‡³å°‘Leaderç†Ÿæ‚‰ç¨‹åº¦ï¼Œæ˜¯æŠ€æœ¯é€‰å‹çš„ä¸€ä¸ªæ‰“åˆ†é¡¹ã€‚</p><p>æˆ‘ä»¬å›¢é˜Ÿæœ€ç»ˆé€‰æ‹©Reactçš„ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰å®ƒï¼Œå®ƒå·²ç»åœ¨ç°æœ‰çš„å‡ ä¸ªåº”ç”¨ä¸­è‰¯å¥½çš„è¿è¡Œäº†ï¼Œæ‰€ä»¥ React + 1</p></li><li><p><strong>é€‰æ‹©æ‹¥æœ‰å¼ºå¤§ç”Ÿæ€å’Œç¤¾åŒºæ”¯æ’‘çš„å¼€æºæŠ€æœ¯</strong>ã€‚æœ‰å¼ºå¤§çš„ç”Ÿæ€å’Œç¤¾åŒºæ„å‘³ç€ï¼Œå¾ˆå¤šä¸œè¥¿ä½ ä¸éœ€è¦é‡å¤å»é€ è½®å­ï¼Œæˆ–è€…é‡åˆ°é—®é¢˜å¯ä»¥å¾ˆå¿«è§£å†³ï¼Œæœ‰æ›´å¤šçš„é€‰æ‹©ã€‚ä»å…¬å¸å±‚é¢ã€ä½¿ç”¨æ´»è·ƒçš„æŠ€æœ¯ä¹Ÿæ¯”è¾ƒå¥½æ‹›äººã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¹Ÿæåˆ°äº†è¿™ç‚¹ï¼Œå‡ å¹´å‰Reactçš„ç”Ÿæ€æ˜¯å¼ºäºVueçš„ï¼Œæ‰€ä»¥ React + 1</p></li><li><p><strong>é€‰æ‹©æˆé•¿æœŸçš„æŠ€æœ¯</strong>ã€‚<a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">&lt;è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹&gt;</a>é‡Œé¢æœ‰ä¸€å¥è¯ï¼šâ€™é€‰æ‹©ä¸€ä¸ªæŠ€æœ¯çš„æœ€ä½æ ‡å‡†æ˜¯ï¼ŒæŠ€æœ¯çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»æ˜¾è‘—é•¿äºé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸâ€™</p><p> æˆ‘ä»¬é€‰æ‹©çš„æŠ€æœ¯åº”è¯¥æ˜¯å‘å‰å‘å±•çš„ã€é¢å‘æœªæ¥çš„, è¿™æ˜¯é€‰å‹çš„åŸºæœ¬åŸåˆ™ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šå»é€‰æ‹©é‚£äº›â€™è¿‡æ°”â€™çš„æŠ€æœ¯ï¼Œæ¯”å¦‚<code>AngularJS</code>(1.x)ã€<code>Backbone</code>. å› ä¸ºç°åœ¨æœ‰æ›´å¥½çš„é€‰æ‹©ï¼Œä¸å¿…è¿‡äºä¿å®ˆã€‚</p><p> â€˜å‘å‰â€™è¿˜æ„å‘³ç€Leaderè¦èƒ½å¤Ÿé¢„åˆ¤è¯¥æŠ€æœ¯æœªæ¥èµ°å‘ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‚è€ƒå› ç´ ï¼Œæ¯”å¦‚å¤§å‚çš„æ”¯æ’‘ã€ç›®å‰ç¤¾åŒºçš„æ´»è·ƒåº¦ã€å¼€å‘æ´»è·ƒåº¦ç­‰ç­‰</p><p> Reactã€Vueéƒ½éå¸¸æœ‰åŠ¨åŠ›ï¼Œæ¯”å¦‚Reactæœ€è¿‘çš„React Hookã€è¿˜æœ‰æœªæ¥çš„ConcurrentModeã€Async Renderingâ€¦ åœ¨è¿™ç‚¹ä¸ŠVueå’ŒReactæ‰“æˆå¹³æ‰‹å§</p></li><li><p><strong>APIçš„ç¨³å®šæ€§</strong>ã€‚æ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯Angularå’ŒPythonï¼ŒAPIä¸ç¨³å®šä¼šå¯¼è‡´ç¤¾åŒºçš„å‰²è£‚ï¼Œä¹Ÿä¼šå¯¼è‡´é¡¹ç›®å‡çº§æˆæœ¬å˜é«˜ã€æˆ–è€…æ— æ³•å‡çº§, æœ€ç»ˆæˆä¸ºæŠ€æœ¯å€ºã€‚</p><p>ä¸è¿‡å€¼å¾—åº†å¹¸çš„æ˜¯å› ä¸ºæœ‰è¿™ä¹ˆå¤šå†å²æ•™è®­ï¼Œç°åœ¨å¼€æºé¡¹ç›®åœ¨APIå˜æ›´ä¸Šé¢æ˜¯éå¸¸è°¨æ…çš„ï¼Œå‚è€ƒ<a href="https://juejin.im/post/5d0f64d4f265da1b67211893" target="_blank" rel="noopener">[è¯‘] Vue æœ€é»‘æš—çš„ä¸€å¤©</a>äº‹ä»¶. </p><p>è¿™ç‚¹ä¸ŠReactå’ŒVueä¾æ—§æ‰“å¹³</p></li><li><p><strong>åŸºç¡€è®¾æ–½é…åˆ</strong>ã€‚ä¸€ä¸ªæŠ€æœ¯å¾€å¾€ä¸æ˜¯å­¤ç«‹å­˜åœ¨çš„ï¼Œå®ƒéœ€è¦å’Œå…¶ä»–æŠ€æœ¯ç›¸äº’é…åˆï¼Œè¿™ç§æŠ€æœ¯ä¹‹é—´çš„èåˆåº¦ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ã€‚</p><p>è¿™ä¸ªæ ¹æ®å›¢é˜Ÿä½¿ç”¨æƒ…å†µæ¥å®šï¼Œæ¯”å¦‚æˆ‘ä»¬å›¢é˜Ÿç»Ÿä¸€ä½¿ç”¨Typescriptï¼ŒVueè·ŸTypescripté…åˆä½¿ç”¨å…¶å®ä¸ç†æƒ³ï¼Œæ‰€ä»¥ React + 1</p></li><li><p><strong>ä¸šåŠ¡è€ƒè™‘</strong> <a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">&lt;è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹&gt;</a> æåˆ°ä¸€ç‚¹å°±æ˜¯â€˜å­¦ä¼šä»ä¸šåŠ¡ç«¯å¼€å§‹æ€è€ƒâ€™. æ„æ€<strong>å°±æ˜¯é€‰å‹éœ€è¦å……åˆ†åœ°ç†è§£ä¸šåŠ¡ï¼Œç†è§£ç”¨æˆ·éœ€æ±‚ï¼Œå½“ä¸‹éœ€è¦è§£å†³çš„é¦–è¦é—®é¢˜ï¼Œä»¥åŠå¯èƒ½çš„é£é™©æœ‰å“ªäº›ï¼Œå†å°†ç›®æ ‡è¿›è¡Œåˆ†è§£ï¼Œè¿›è¡Œå…·ä½“çš„æŠ€æœ¯é€‰å‹ã€æ¨¡å‹è®¾è®¡ã€æ¶æ„è®¾è®¡</strong>.</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯10å¹´å‰ç«éä¸–ç•Œçš„<code>Rails</code>, åç«¯æ˜¯ä½¿ç”¨Railsè¿˜æ˜¯Java/C#/PHPè¿™äº›ä¼ ç»Ÿåç«¯æŠ€æœ¯? å¾ˆå¤šåˆåˆ›å…¬å¸(å¦‚Githubã€Gitlabã€Twitter)é€‰æ‹©äº†å‰è€…ï¼Œä»–ä»¬éœ€è¦å¿«é€Ÿå¼€å‘åŸå‹ã€å¿«é€Ÿå é¢†å¸‚åœº, Railså¼€å‘å¾ˆçˆ½å¾ˆå¿«å•Š, è¿™ç§é€‰å‹å°±æ˜¯ç¬¦åˆâ€˜ä¸šåŠ¡éœ€æ±‚çš„â€™ã€‚</p><p>é‚£ä¹ˆå‰ç«¯å¥½åƒè·Ÿä¸šåŠ¡ç¦»å¾—æœ‰ç‚¹è¿œ? éšç€â€˜å¤§å‰ç«¯â€™çš„å‘å±•ï¼Œæˆ‘ä»¬çš„å·¥ä½œå¯¹å…¬å¸ä¸šåŠ¡çš„å½±å“åªä¼šè¶Šæ¥è¶Šå¤§ã€‚</p><p>æ¯”å¦‚ä¸Šé¢æåˆ°çš„React Nativeï¼Œæˆ‘ä»¬å½“æ—¶æœ‰è€ƒè™‘åœ¨ç§»åŠ¨ç«¯åº”ç”¨React NativeæŠ€æœ¯ï¼Œå®ç°å®¢æˆ·ç«¯çš„è·¨å¹³å°ï¼Œè¿™å°±æ˜¯ä¸šåŠ¡å½±å“å•Šã€‚è¿™æ—¶å€™Reactæ˜¯ä¸æ˜¯åˆè¦ +1? åŒç†è¿˜æœ‰ä»€ä¹ˆæœåŠ¡ç«¯æ¸²æŸ“ã€Serverlessç­‰ç­‰ï¼ŒæœŸå¾…å‰ç«¯çš„åœ°ä½ä¼šè¶Šæ¥è¶Šé«˜</p></li></ul><p>ç»¼ä¸Šï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒReactæ˜¯èƒœå‡ºçš„ã€‚</p><p>æ‰©å±•:</p><ul><li><a href="https://www.infoq.cn/article/2017/02/Technology-selection" target="_blank" rel="noopener">è°ˆè°ˆæŠ€æœ¯é€‰å‹</a></li><li><a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-2-è¿æ¥æ–°æŠ€æœ¯"><a href="#2-2-è¿æ¥æ–°æŠ€æœ¯" class="headerlink" title="2.2 è¿æ¥æ–°æŠ€æœ¯"></a>2.2 è¿æ¥æ–°æŠ€æœ¯</h3><p>å½“ç„¶ï¼Œå¯¹äºå›¢é˜Ÿè€Œè¨€ä¹Ÿè¦é¼“åŠ±å­¦ä¹ æ–°çš„æŠ€æœ¯ã€æ·˜æ±°æ—§çš„æŠ€æœ¯æ ˆã€‚å› ä¸ºä¸€èˆ¬è€Œè¨€æ–°çš„æŠ€æœ¯æˆ–è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸ºäº†æ›´é«˜çš„ç”Ÿäº§åŠ›è€Œè¯ç”Ÿçš„ã€‚<strong>å½“å›¢é˜Ÿå®¹çº³ä¸€ä¸ªæ–°çš„æŠ€æœ¯é€‰å‹éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹</strong>ï¼š</p><ul><li><strong>å­¦ä¹ æˆæœ¬</strong>ã€‚è€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„æ¥çº³èƒ½åŠ›ã€‚å¦‚æœæˆæœ¬å°äºæ”¶è·çš„åˆ©ç›Šï¼Œåœ¨å›¢é˜Ÿé‡Œé¢æ¨è¡Œä¼°è®¡é˜»åŠ›ä¼šæ¯”è¾ƒå¤§</li><li><strong>æ”¶ç›Š</strong>ã€‚æ˜¯å¦èƒ½å¤Ÿè§£å†³å½“å‰çš„æŸäº›ç—›ç‚¹</li><li><strong>è€ƒè™‘é£é™©</strong>ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¸èƒ½å°†ä¸€ä¸ªå®éªŒé˜¶æ®µçš„æŠ€æœ¯ä½¿ç”¨çš„ç”Ÿäº§ç¯å¢ƒä¸­</li></ul><p>å°±æˆ‘ä»¬å›¢é˜Ÿè€Œè¨€ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æœ‰è‡ªå·±æ„Ÿå…´è¶£çš„æ–¹å‘å’Œé¢†åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†å·¥åˆä½œï¼Œæ¢ç´¢å„è‡ªçš„é¢†åŸŸï¼Œå†å°†æˆæœåˆ†äº«å‡ºæ¥ï¼Œå¦‚æœé è°±çš„è¯åˆ™å¯ä»¥åœ¨å®éªŒé¡¹ç›®ä¸­å…ˆè¯•éªŒä¸€ä¸‹ï¼Œæœ€åæ‰æ¨å¹¿åˆ°å…¶ä»–é¡¹ç›®.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="3-æµè§ˆå™¨å…¼å®¹è§„èŒƒ"><a href="#3-æµè§ˆå™¨å…¼å®¹è§„èŒƒ" class="headerlink" title="3 æµè§ˆå™¨å…¼å®¹è§„èŒƒ"></a>3 æµè§ˆå™¨å…¼å®¹è§„èŒƒ</h2><p>å‰ç«¯å›¢é˜Ÿåº”è¯¥æ ¹æ®é’ˆå¯¹åº”ç”¨æ‰€é¢å¯¹çš„ç”¨æˆ·æƒ…å†µã€åº”ç”¨ç±»å‹ã€å¼€å‘æˆæœ¬ã€æµè§ˆå™¨å¸‚åœºç»Ÿè®¡æ•°æ®ç­‰å› ç´ ï¼Œæ¥åˆ¶å®šè‡ªå·±çš„æµè§ˆå™¨å…¼å®¹è§„èŒƒï¼Œå¹¶å†™å…¥åº”ç”¨ä½¿ç”¨æ‰‹å†Œä¸­.</p><p><strong>æœ‰äº†æµè§ˆå™¨å…¼å®¹è§„èŒƒï¼Œå‰ç«¯å¼€å‘å’Œå…¼å®¹æ€§æµ‹è¯•å°±æœ‰ç†æœ‰æ®ï¼Œé¿å…äº‰è®®; åŒæ—¶å®ƒä¹Ÿæ˜¯å‰ç«¯å›¢é˜Ÿçš„ä¸€ç§å¯¹å¤–å£°æ˜ï¼Œé™¤éç‰¹æ®Šè¦æ±‚ï¼Œä¸ç¬¦åˆæµè§ˆå™¨å…¼å®¹è§„èŒƒçš„æµè§ˆå™¨ï¼Œå‰ç«¯å¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©å¿½ç•¥</strong>ã€‚</p><p><br></p><h3 id="3-1-ç¡®å®šå…¼å®¹ç­–ç•¥"><a href="#3-1-ç¡®å®šå…¼å®¹ç­–ç•¥" class="headerlink" title="3.1 ç¡®å®šå…¼å®¹ç­–ç•¥"></a>3.1 ç¡®å®šå…¼å®¹ç­–ç•¥</h3><p><img src="/images/frontend-standard/g-p.jpg" alt></p><p><strong>æ¸è¿›å¢å¼º</strong>è¿˜æ˜¯<strong>ä¼˜é›…é™çº§</strong>. è¿™æ˜¯ä¸¤ä¸ªä¸åŒæ–¹å‘ç­–ç•¥ï¼Œ<strong>æ¸è¿›å¢å¼ºä¿è¯ä½ç‰ˆæœ¬æµè§ˆå™¨çš„ä½“éªŒï¼Œå¯¹äºæ”¯æŒæ–°ç‰¹æ€§çš„æ–°æµè§ˆå™¨æä¾›ç¨å¥½çš„ä½“éªŒ</strong>ï¼›<strong>ä¼˜é›…é™çº§åˆ™æ˜¯ç›¸åçš„ï¼Œä¸ºç°ä»£æµè§ˆå™¨æä¾›æœ€å¥½çš„ä½“éªŒï¼Œè€Œæ—§æµè§ˆå™¨åˆ™é€€è€Œæ±‚ä¹‹æ¬¡ï¼Œä¿è¯å¤§æ¦‚çš„åŠŸèƒ½</strong>.</p><p>é€‰æ‹©ä¸åŒçš„ç­–ç•¥å¯¹å‰ç«¯å¼€å‘çš„å½±å“æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä½†æ˜¯å¼€å‘è€…æ²¡æœ‰é€‰æ‹©æƒã€‚<strong>ç¡®å®šå“ªç§å…¼å®¹ç­–ç•¥ï¼Œåº”è¯¥å–å†³äºç”¨æˆ·æ¯”é‡ï¼Œå¦‚æœå¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨çš„æ˜¯ç°ä»£æµè§ˆå™¨ï¼Œå°±åº”è¯¥ä½¿ç”¨ä¼˜é›…é™çº§ï¼Œåä¹‹é€‰æ‹©æ¸è¿›å¢å¼º</strong>.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-2-ç¡®å®šæµè§ˆå™¨åˆ†çº§"><a href="#3-2-ç¡®å®šæµè§ˆå™¨åˆ†çº§" class="headerlink" title="3.2 ç¡®å®šæµè§ˆå™¨åˆ†çº§"></a>3.2 ç¡®å®šæµè§ˆå™¨åˆ†çº§</h3><p><img src="/images/frontend-standard/brw-levl.gif" alt></p><p>YUIå°±æ›¾æå‡ºæµè§ˆå™¨åˆ†çº§åŸåˆ™ï¼Œåˆ°ä»Šå¤©è¿™ä¸ªåŸåˆ™ä¾ç„¶é€‚ç”¨ã€‚ç®€å•è¯´å°±æ˜¯å°†æµè§ˆå™¨åˆ’åˆ†ä¸ºå¤šä¸ªç­‰çº§ï¼Œä¸åŒç­‰çº§è¡¨ç¤ºä¸åŒçš„æ”¯æŒç¨‹åº¦. æ¯”å¦‚æˆ‘ä»¬å›¢é˜Ÿå°±å°†æµè§ˆå™¨åˆ’åˆ†ä¸ºä»¥ä¸‹<a href="https://github.com/GDJiaMi/frontend-standards/blob/master/browser-compatibility.md" target="_blank" rel="noopener">ä¸‰ä¸ªç­‰çº§</a>:</p><ul><li><strong>å®Œå…¨å…¼å®¹</strong>: ä¿è¯ç™¾åˆ†ç™¾åŠŸèƒ½æ­£å¸¸</li><li><strong>éƒ¨åˆ†å…¼å®¹</strong>: åªèƒ½ä¿è¯åŠŸèƒ½ã€æ ·å¼ä¸éœ€æ±‚å¤§è‡´ä¸€è‡´ã€‚å¯¹äºä¸€äº›ä¸å½±å“ä¸»ä½“éœ€æ±‚å’ŒåŠŸèƒ½çš„bugï¼Œä¼šåšé™ä½ä¼˜å…ˆçº§å¤„ç†æˆ–è€…ä¸å¤„ç†ã€‚</li><li><strong>ä¸å…¼å®¹</strong>: ä¸è€ƒè™‘å…¼å®¹æ€§</li></ul><p>ä¸€èˆ¬è€Œè¨€, æ ¹æ®æµè§ˆå™¨å¸‚åœºåˆ†å¸ƒæƒ…å†µã€ç”¨æˆ·å æ¯”ã€å¼€å‘æˆæœ¬ç­‰å› ç´ åˆ’åˆ†ç­‰çº§.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å¯¹ç®¡ç†ç³»ç»Ÿçš„å…¼å®¹è§„èŒƒ:</p><p><img src="/images/frontend-standard/cpt.png" alt></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-3-è·å–ç»Ÿè®¡æ•°æ®"><a href="#3-3-è·å–ç»Ÿè®¡æ•°æ®" class="headerlink" title="3.3 è·å–ç»Ÿè®¡æ•°æ®"></a>3.3 è·å–ç»Ÿè®¡æ•°æ®</h3><p><a id="brw-anly"></a></p><p><img src="/images/frontend-standard/bdtj.png" alt></p><p><br></p><p><a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">ç™¾åº¦ç»Ÿè®¡</a>æ˜¯ä¸­æ–‡ç½‘ç«™ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ã€å…è´¹çš„æµé‡åˆ†æå¹³å°. å¦‚ä¸Šå›¾ï¼Œé€šè¿‡è¿™äº›ç»Ÿè®¡å¹³å°å¯ä»¥è·å–åˆ°ç»ˆç«¯çœŸå®çš„æµè§ˆå™¨ä½¿ç”¨æƒ…å†µ, ç‚¹å‡»<a href="https://tongji.baidu.com/web/demo/visit/client?siteId=5503017" target="_blank" rel="noopener">æŸ¥çœ‹ç¤ºä¾‹</a>ã€‚</p><p>å¦‚æœå…¬å¸æ²¡æœ‰å¼€å‘è‡ªå·±ç›‘æ§æœåŠ¡ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨è¿™äº›å…è´¹çš„ï¼Œæœ‰å¤§å‚æ”¯æŒçš„ç›‘æ§å·¥å…·:</p><ul><li><a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">ç™¾åº¦ç»Ÿè®¡</a></li><li><a href="https://web.umeng.com/main.php?spm=a211g2.211692.0.0.3a437d23sjzEPv&amp;c=user&amp;a=index" target="_blank" rel="noopener">å‹ç›Ÿ</a></li><li><a href="https://analytics.google.com/analytics/web/" target="_blank" rel="noopener">Google Analytics</a> éœ€è¦kxä¸Šç½‘</li></ul><p><br></p><p><strong>å¯ä»¥ä»è¿™äº›åœ°æ–¹è·å–é€šç”¨çš„æµè§ˆå™¨ç»Ÿè®¡æ•°æ®</strong>:</p><ul><li><a href="http://tongji.baidu.com/data/browser" target="_blank" rel="noopener">ç™¾åº¦æµé‡ç ”ç©¶é™¢</a>ï¼šä¸»è¦æä¾›å›½å†…æµè§ˆå™¨ç»Ÿè®¡</li><li><a href="http://gs.statcounter.com/" target="_blank" rel="noopener">statcounter</a>: å›½é™…æµè§ˆå™¨ç»Ÿè®¡</li><li><a href="https://en.wikipedia.org/wiki/Timeline_of_web_browsers" target="_blank" rel="noopener">æµè§ˆå™¨å‘å¸ƒå¹´ä»½ç»Ÿè®¡</a></li></ul><p><br></p><p><strong>ç¡®å®šæµè§ˆå™¨æ˜¯å¦æ”¯æŒæŸä¸ªç‰¹æ€§</strong>:</p><ul><li><a href="https://caniuse.com" target="_blank" rel="noopener">caniuse</a></li><li><a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener">MDN</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="4-é¡¹ç›®ç»„ç»‡è§„èŒƒ"><a href="#4-é¡¹ç›®ç»„ç»‡è§„èŒƒ" class="headerlink" title="4 é¡¹ç›®ç»„ç»‡è§„èŒƒ"></a>4 é¡¹ç›®ç»„ç»‡è§„èŒƒ</h2><p>é¡¹ç›®ç»„ç»‡è§„èŒƒå®šä¹‰äº†å¦‚ä½•ç»„ç»‡ä¸€ä¸ªå‰ç«¯é¡¹ç›®, ä¾‹å¦‚é¡¹ç›®çš„å‘½åã€é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ã€ç‰ˆæœ¬å·è§„èŒƒç­‰ç­‰ã€‚å°¤å…¶å¯¹äºå¼€æºé¡¹ç›®ï¼Œè§„èŒƒåŒ–çš„é¡¹ç›®ç»„ç»‡å°±æ›´é‡è¦äº†ã€‚</p><h3 id="4-1-é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ"><a href="#4-1-é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ" class="headerlink" title="4.1 é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ"></a>4.1 é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ</h3><p>ä¸€ä¸ªå…¸å‹çš„é¡¹ç›®ç»„ç»‡è§„èŒƒå¦‚ä¸‹:</p><ul><li><strong>README.md</strong>: é¡¹ç›®è¯´æ˜, è¿™ä¸ªæ˜¯æœ€é‡è¦ã€‚ä½ å¿…é¡»åœ¨è¿™é‡Œæä¾›å…³äºé¡¹ç›®çš„å…³é”®ä¿¡æ¯æˆ–è€…ç›¸å…³ä¿¡æ¯çš„å…¥å£. ä¸€èˆ¬åŒ…å«ä¸‹åˆ—ä¿¡æ¯:<ul><li>ç®€è¦æè¿°ã€é¡¹ç›®ä¸»è¦ç‰¹æ€§</li><li>è¿è¡Œç¯å¢ƒ/ä¾èµ–ã€å®‰è£…å’Œæ„å»ºã€æµ‹è¯•æŒ‡å—</li><li>ç®€å•ç¤ºä¾‹ä»£ç </li><li>æ–‡æ¡£æˆ–æ–‡æ¡£å…¥å£, å…¶ä»–ç‰ˆæœ¬æˆ–ç›¸å…³èµ„æºå…¥å£</li><li>è”ç³»æ–¹å¼ã€è®¨è®ºç¾¤</li><li>è®¸å¯ã€è´¡çŒ®/å¼€å‘æŒ‡å—</li></ul></li><li><strong>CHANGELOG.md</strong>: æ”¾ç½®æ¯ä¸ªç‰ˆæœ¬çš„å˜åŠ¨å†…å®¹, é€šå¸¸è¦æè¿°æ¯ä¸ªç‰ˆæœ¬å˜æ›´çš„å†…å®¹ã€‚æ–¹ä¾¿ä½¿ç”¨è€…ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬. å…³äºCHANGELOGçš„è§„èŒƒå¯ä»¥å‚è€ƒ<a href="https://keepachangelog.com/en/1.0.0/" target="_blank" rel="noopener">keep a changelog</a></li><li><strong>package.json</strong>: å‰ç«¯é¡¹ç›®å¿…é¡». æè¿°å½“å‰çš„ç‰ˆæœ¬ã€<strong>å¯ç”¨çš„å‘½ä»¤</strong>ã€åŒ…åã€ä¾èµ–ã€ç¯å¢ƒçº¦æŸã€é¡¹ç›®é…ç½®ç­‰ä¿¡æ¯.</li><li><strong>.gitignore</strong>: å¿½ç•¥ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œé¿å…å°†è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬åº“</li><li><strong>.gitattributes</strong>: gité…ç½®ï¼Œæœ‰ä¸€äº›è·¨å¹³å°å·®å¼‚çš„è¡Œä¸ºå¯èƒ½éœ€è¦åœ¨è¿™é‡Œé…ç½®ä¸€ä¸‹ï¼Œå¦‚æ¢è¡Œè§„åˆ™</li><li><strong>docs/</strong>: é¡¹ç›®çš„ç»†åŒ–æ–‡æ¡£, å¯é€‰.</li><li><strong>examples/</strong>: é¡¹ç›®çš„ç¤ºä¾‹ä»£ç ï¼Œå¯é€‰.</li><li><strong>build</strong>: é¡¹ç›®å·¥å…·ç±»è„šæœ¬æ”¾ç½®åœ¨è¿™é‡Œï¼Œéå¿…é¡»ã€‚å¦‚æœä½¿ç”¨ç»Ÿä¸€æ„å»ºå·¥å…·ï¼Œåˆ™æ²¡æœ‰è¿™ä¸ªç›®å½•</li><li><strong>dist/</strong>: é¡¹ç›®æ„å»ºç»“æœè¾“å‡ºç›®å½•</li><li><strong>src/</strong>: æºä»£ç ç›®å½•</li><li><p><strong><strong>tests</strong>/</strong>: å•å…ƒæµ‹è¯•ç›®å½•. æŒ‰ç…§<a href="http://jestjs.io" target="_blank" rel="noopener">Jest</a>è§„èŒƒ, <code>__tests__</code>ç›®å½•é€šå¸¸å’Œè¢«æµ‹è¯•çš„æ¨¡å—åœ¨åŒä¸€ä¸ªçˆ¶ç›®å½•ä¸‹, ä¾‹å¦‚:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/src</span><br><span class="line">  __tests__/</span><br><span class="line">    index.ts</span><br><span class="line">    a.ts</span><br><span class="line">  index.ts</span><br><span class="line">  a.ts</span><br></pre></td></tr></table></figure></li><li><p><strong>tests</strong>: å…¨å±€çš„æµ‹è¯•ç›®å½•ï¼Œé€šå¸¸æ”¾åº”ç”¨çš„é›†æˆæµ‹è¯•æˆ–E2Eæµ‹è¯•ç­‰ç”¨ä¾‹</p></li><li><p><strong>.env*</strong>: é¡¹ç›®ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨<code>ç¯å¢ƒå˜é‡</code>æ¥å½±å“åº”ç”¨åœ¨ä¸åŒè¿è¡Œç¯å¢ƒä¸‹çš„è¡Œä¸º. å¯ä»¥é€šè¿‡<a href="https://github.com/motdotla/dotenv" target="_blank" rel="noopener">dotEnv</a>æ¥ä»æ–‡ä»¶ä¸­è¯»å–ç¯å¢ƒå˜é‡. é€šå¸¸æœ‰ä¸‰ä¸ªæ–‡ä»¶:</p><ul><li><code>.env</code> é€šç”¨çš„ç¯å¢ƒå˜é‡</li><li><code>.env.development</code> å¼€å‘ç¯å¢ƒçš„ç¯å¢ƒå˜é‡</li><li><code>.env.production</code> ç”Ÿæˆç¯å¢ƒçš„ç¯å¢ƒå˜é‡</li></ul><p>åŸºæœ¬ä¸Šè¿™äº›æ–‡ä»¶çš„å˜åŠ¨çš„é¢‘ç‡å¾ˆå°‘ï¼Œå›¢é˜Ÿæˆå‘˜åº”è¯¥ä¸è¦éšæ„å˜åŠ¨ï¼Œä»¥å…å½±å“å…¶ä»–æˆå‘˜ã€‚æ‰€ä»¥é€šå¸¸ä¼šä½¿ç”¨<code>.env.*.local</code>æ–‡ä»¶æ¥è¦†ç›–ä¸Šè¿°çš„é…ç½®, å¦å¤–ä¼šè®¾ç½®ç‰ˆæœ¬åº“æ¥å¿½ç•¥<code>*.local</code>æ–‡ä»¶.</p></li></ul><p><br></p><p><strong>å¯¹äºå¼€æºé¡¹ç›®é€šå¸¸è¿˜åŒ…æ‹¬è¿™äº›ç›®å½•</strong>:</p><ul><li><strong>LICENSE</strong>: è¯´æ˜é¡¹ç›®è®¸å¯</li><li><strong>.github</strong>: å¼€æºè´¡çŒ®è§„èŒƒå’ŒæŒ‡å—<ul><li>CONTRIBUTING: è´¡çŒ®æŒ‡å—, è¿™é‡Œä¸€èˆ¬ä¼šè¯´æ˜è´¡çŒ®çš„è§„èŒƒã€ä»¥åŠé¡¹ç›®çš„åŸºæœ¬ç»„ç»‡ã€æ¶æ„ç­‰ä¿¡æ¯</li><li>CODE_OF_CONDUCT: è¡Œä¸ºå‡†åˆ™</li><li>COMMIT_CONVENTION: æäº¤ä¿¡æ¯è§„èŒƒï¼Œä¸Šæ–‡å·²ç»æåŠ</li><li>ISSUE_TEMPLATE: Issueçš„æ¨¡æ¿ï¼Œgithubå¯ä»¥è‡ªåŠ¨è¯†åˆ«è¿™ä¸ªæ¨¡æ¿</li><li>PULL_REQUEST_TEMPLATE: PRæ¨¡æ¿</li></ul></li></ul><p>ä»»æ„ä¸€ä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®éƒ½æ˜¯ä½ çš„è€å¸ˆï¼Œä¾‹å¦‚<a href="https://github.com/facebook/react" target="_blank" rel="noopener">React</a>ã€<a href="https://github.com/vuejs/vue" target="_blank" rel="noopener">Vue</a>â€¦</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-2-ç›®å½•ç»„ç»‡çš„é£æ ¼"><a href="#4-2-ç›®å½•ç»„ç»‡çš„é£æ ¼" class="headerlink" title="4.2 ç›®å½•ç»„ç»‡çš„é£æ ¼"></a>4.2 ç›®å½•ç»„ç»‡çš„é£æ ¼</h3><p>ä¸Šé¢åªæ˜¯ä¸€ä¸ªé€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒï¼Œå…·ä½“æºä»£ç å¦‚ä½•ç»„ç»‡è¿˜å–å†³äºä½ ä»¬ä½¿ç”¨çš„æŠ€æœ¯æ ˆå’Œå›¢é˜Ÿå–œå¥½ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œå…·ä½“å¯ä»¥æœç´¢<code>æ€ä¹ˆç»„ç»‡XXé¡¹ç›®</code>. æ€»ç»“ä¸€ä¸‹é¡¹ç›®ç»„ç»‡ä¸»è¦æœ‰ä¸‰ç§é£æ ¼:</p><ul><li><p><strong>Rails-style</strong>: æŒ‰ç…§æ–‡ä»¶çš„ç±»å‹åˆ’åˆ†ä¸ºä¸åŒçš„ç›®å½•ï¼Œä¾‹å¦‚<code>components</code>ã€<code>constants</code>ã€ <code>typings</code>ã€<code>views</code>. è¿™ä¸ªæ¥æºäºRuby-on-Railsæ¡†æ¶ï¼Œå®ƒæŒ‰ç…§MVCæ¶æ„æ¥åˆ’åˆ†ä¸åŒçš„ç›®å½•ç±»å‹ï¼Œå…¸å‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  models # æ¨¡å‹</span><br><span class="line">  views # è§†å›¾</span><br><span class="line">  controllers # æ§åˆ¶å™¨</span><br><span class="line">  helpers # å¸®åŠ©ç¨‹åº</span><br><span class="line">  assets  # é™æ€èµ„æº</span><br><span class="line">config     # é…ç½®</span><br><span class="line">  application.rb</span><br><span class="line">  database.yml</span><br><span class="line">  routes.rb      # è·¯ç”±æ§åˆ¶</span><br><span class="line">  locales        # å›½é™…åŒ–é…ç½®</span><br><span class="line">  environments/</span><br><span class="line">db        # æ•°æ®åº“ç›¸å…³</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>Domain-style</strong>:  æŒ‰ç…§ä¸€ä¸ªåŠŸèƒ½ç‰¹æ€§æˆ–ä¸šåŠ¡åˆ›å»ºå•ç‹¬çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•å°±è¿‘åŒ…å«å¤šç§ç±»å‹çš„æ–‡ä»¶æˆ–ç›®å½•. æ¯”å¦‚ä¸€ä¸ªå…¸å‹çš„Reduxé¡¹ç›®ï¼Œæ‰€æœ‰é¡¹ç›®çš„æ–‡ä»¶å°±è¿‘æ”¾ç½®åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Users/</span><br><span class="line">Home/</span><br><span class="line">  components/</span><br><span class="line">  actions.js</span><br><span class="line">  actionTypes.js</span><br><span class="line">  constants.js</span><br><span class="line">  index.js</span><br><span class="line">  model.js</span><br><span class="line">  reducer.js</span><br><span class="line">  selectors.js</span><br><span class="line">  style.css</span><br><span class="line">index.js</span><br><span class="line">rootReducer.js</span><br></pre></td></tr></table></figure></li><li><p><strong>Ducks-style</strong>: ä¼˜ç‚¹ç±»ä¼¼äºDomain-styleï¼Œä¸è¿‡æ›´å½»åº•, å®ƒé€šå¸¸å°†ç›¸å…³è”çš„å…ƒç´ å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸‹ã€‚Vueçš„å•æ–‡ä»¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œé™¤æ­¤ä¹‹å¤–Vuexä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§é£æ ¼:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;My Todo App!&lt;/h1&gt;</span><br><span class="line">    &lt;TodoList/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import TodoList from &apos;./components/TodoList.vue&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    TodoList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">@import &apos;./variables.scss&apos;;</span><br><span class="line">/* ... */</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li></ul><p><br></p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹, æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨æ··åˆä¸¤ç§æ–¹å¼çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/      # ğŸ”´ é¡¹ç›®é€šç”¨çš„â€˜å±•ç¤ºç»„ä»¶â€™</span><br><span class="line">    Button/</span><br><span class="line">      index.tsx    # ç»„ä»¶çš„å…¥å£, å¯¼å‡ºç»„ä»¶</span><br><span class="line">      Groups.tsx   # å­ç»„ä»¶</span><br><span class="line">      loading.svg  # é™æ€èµ„æº</span><br><span class="line">      style.css    # ç»„ä»¶æ ·å¼</span><br><span class="line">    ...</span><br><span class="line">    index.ts       # åˆ°å¤„æ‰€æœ‰ç»„ä»¶</span><br><span class="line">  containers/      # ğŸ”´ åŒ…å«'å®¹å™¨ç»„ä»¶'å’Œ'é¡µé¢ç»„ä»¶'</span><br><span class="line">    LoginPage/     # é¡µé¢ç»„ä»¶, ä¾‹å¦‚ç™»å½•</span><br><span class="line">      components/  # é¡µé¢çº§åˆ«å±•ç¤ºç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¸èƒ½å¤ç”¨ä¸å…¶ä»–é¡µé¢ç»„ä»¶ã€‚</span><br><span class="line">        Button.tsx # ç»„ä»¶æœªå¿…æ˜¯ä¸€ä¸ªç›®å½•å½¢å¼ï¼Œå¯¹äºä¸€ä¸ªç®€å•ç»„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªå•æ–‡ä»¶å½¢å¼. ä½†è¿˜æ˜¯æ¨èä½¿ç”¨ç›®å½•ï¼Œæ–¹ä¾¿æ‰©å±•</span><br><span class="line">        Panel.tsx</span><br><span class="line">      reducer.ts   # redux reduces</span><br><span class="line">      useLogin.ts  # (å¯é€‰)æ”¾ç½®'é€»è¾‘', æŒ‰ç…§ğŸ‘†åˆ†ç¦»é€»è¾‘å’Œè§†å›¾çš„åŸåˆ™ï¼Œå°†é€»è¾‘ã€çŠ¶æ€å¤„ç†æŠ½å–åˆ°hookæ–‡ä»¶</span><br><span class="line">      types.ts     # typescript ç±»å‹å£°æ˜</span><br><span class="line">      style.css</span><br><span class="line">      logo.png</span><br><span class="line">      message.ts</span><br><span class="line">      constants.ts</span><br><span class="line">      index.tsx</span><br><span class="line">    HomePage/</span><br><span class="line">    ...</span><br><span class="line">    index.tsx      # ğŸ”´åº”ç”¨æ ¹ç»„ä»¶</span><br><span class="line">  hooks/           # ğŸ”´å¯å¤ç”¨çš„hook</span><br><span class="line">    useList.ts</span><br><span class="line">    usePromise.ts</span><br><span class="line">  ...</span><br><span class="line">  index.tsx        # åº”ç”¨å…¥å£, åœ¨è¿™é‡Œä½¿ç”¨ReactDOMå¯¹è·Ÿç»„ä»¶è¿›è¡Œæ¸²æŸ“</span><br><span class="line">  stores.ts        # redux stores</span><br><span class="line">  contants.ts      # å…¨å±€å¸¸é‡</span><br></pre></td></tr></table></figure><p><br></p><p>æ¡†æ¶å®˜æ–¹å¾ˆå°‘ä¼šå»å¹²é¢„é¡¹ç›®çš„ç»„ç»‡æ–¹å¼ï¼Œè¯»è€…å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº›èµ„æºæ¥å»ºç«‹è‡ªå·±é¡¹ç›®ç»„ç»‡è§„èŒƒ:</p><ul><li><a href="https://link.juejin.im/?target=http%3A%2F%2Fcn.redux.js.org%2Fdocs%2Ffaq%2FCodeStructure.html" target="_blank" rel="noopener">Redux å¸¸è§é—®é¢˜ï¼šä»£ç ç»“æ„</a></li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Freact-boilerplate%2Freact-boilerplate" target="_blank" rel="noopener">react-boilerplate</a></li><li><a href="https://vuex.vuejs.org/zh/guide/structure.html" target="_blank" rel="noopener">vuex é¡¹ç›®ç»“æ„</a></li><li><a href="https://juejin.im/post/5cd8fb916fb9a03218556fc1#heading-11" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“02 - ç»„ä»¶çš„ç»„ç»‡</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-3-è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿"><a href="#4-3-è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿" class="headerlink" title="4.3 è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿"></a>4.3 è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿</h3><p>åœ¨å°†é¡¹ç›®ç»“æ„è§„èŒƒç¡®å®šä¸‹æ¥åï¼Œå¯ä»¥åˆ›å»ºè‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·æˆ–è€…é¡¹ç›®æ¨¡æ¿ï¼Œç”¨äºå¿«é€Ÿåˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®æˆ–ä»£ç æ¨¡æ¿ã€‚</p><p>ç›¸å…³èµ„æº:</p><ul><li><a href="https://yeoman.io" target="_blank" rel="noopener">yeoman</a> - è€ç‰Œçš„é¡¹ç›®è„šæ‰‹æ¶å·¥å…·</li><li><a href="https://github.com/amwmedia/plop" target="_blank" rel="noopener">plop</a> - ä»£ç ç”Ÿæˆè¾…åŠ©CLI</li><li><a href="https://github.com/jondot/hygen" target="_blank" rel="noopener">hygen</a> - ç±»ä¼¼äºplop</li><li><a href="https://github.com/diegohaz/generact" target="_blank" rel="noopener">generact</a> - ç”ŸæˆReactç»„ä»¶, å¤§éƒ¨åˆ†ç»„ä»¶çš„æ–‡ä»¶ç»“æ„å·®ä¸å¤š, è¿™ä¸ªå·¥å…·å°±æ˜¯å¸®åŠ©ä½ ç”Ÿæˆè¿™äº›é‡å¤çš„ä»£ç </li><li><a href="https://babeljs.io/docs/en/babel-generator" target="_blank" rel="noopener">babel-code-generator</a> - åˆ©ç”¨babelæ¥å®ç°æ›´é«˜çº§çš„ä»£ç ç¼–è¾‘å’Œè‡ªåŠ¨ç”Ÿæˆ</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="5-ç¼–ç è§„èŒƒ"><a href="#5-ç¼–ç è§„èŒƒ" class="headerlink" title="5 ç¼–ç è§„èŒƒ"></a>5 ç¼–ç è§„èŒƒ</h2><p>ç½‘ç»œä¸Šå¤§éƒ¨åˆ†â€˜å‰ç«¯è§„èŒƒâ€™æŒ‡çš„éƒ½æ˜¯ç¼–ç è§„èŒƒ, è¿™æ˜¯ä¸€ç§â€˜ç‹­ä¹‰â€™çš„å‰ç«¯è§„èŒƒ. </p><p><strong>ç»Ÿä¸€çš„ç¼–ç è§„èŒƒå¯¹å›¢é˜Ÿé¡¹ç›®çš„é•¿è¿œç»´æŠ¤ä¸æ— è£¨ç›Š. ä¸€è‡´æ€§çš„ä»£ç è§„èŒƒå¯ä»¥å¢å¼ºå›¢é˜Ÿå¼€å‘åä½œæ•ˆç‡ã€æé«˜ä»£ç è´¨é‡ã€å‡å°‘é—ç•™ç³»ç»Ÿç»´æŠ¤çš„è´Ÿæ‹…</strong>ã€‚</p><p>æœ€ç›´æ¥çš„å¥½å¤„å°±æ˜¯é¿å…å†™å‡ºç³Ÿç³•çš„ä»£ç , ç³Ÿç³•çš„ä»£ç ä¸æ–°æ‰‹å’Œè€æ‰‹å…³ç³»ä¸å¤§ï¼Œæˆ‘ä¹Ÿè§è¿‡å¥½å¤„å·¥ä½œå¾ˆå¤šå¹´çš„â€˜èµ„æ·±â€™å·¥ç¨‹å¸ˆå†™å‡ºæ¶å¿ƒçš„ä»£ç . è¿™æ ·çš„ä»£ç éšç€é¡¹ç›®çš„è¿­ä»£ä¼šå˜å¾—éš¾ä»¥æ§åˆ¶ã€‚</p><p><strong>ç°ä»£çš„Lintå·¥å…·å·²ç»éå¸¸å…ˆè¿›ï¼Œå‡ ä¹å¯ä»¥çº¦æŸå„ç§ç¼–ç è¡Œä¸º</strong>. æ¯”å¦‚çº¦æŸä¸€ä¸ªæ–‡ä»¶çš„é•¿åº¦ã€å‡½æ•°çš„å¤æ‚åº¦ã€å‘½åè§„èŒƒã€æ³¨é‡Šè§„èŒƒã€æ¥å£é»‘åå•ã€DeadCodeã€æ£€æŸ¥ç®€å•çš„é€»è¾‘é”™è¯¯â€¦</p><p>æ¯ä¸€ä¸ªç¨‹åºå‘˜å¿ƒç›®ä¸­å¯¹â€˜å¥½ä»£ç â€™éƒ½æœ‰è‡ªå·±çš„ä¸»è§ï¼Œç»Ÿä¸€çš„ç¼–ç è§„èŒƒå¯ä»¥åƒç§¦å§‹çš‡ç»Ÿä¸€æˆ˜å›½ä¸€æ ·ï¼Œé¿å…ä¸å¿…è¦çš„è®ºæˆ˜å’Œäº‰è®®ã€‚</p><p><br></p><p><strong>å…¶å®ä¸å…¶è‡ªå·±å»ºç«‹å‰ç«¯ç¼–ç è§„èŒƒï¼Œç¬”è€…æ¨èé€‰æ‹©ç¤¾åŒºæ²‰æ·€ä¸‹æ¥çš„è§„èŒƒ</strong>. è¿™æ–¹é¢çš„èµ„æºéå¸¸å¤šï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿä¸æ­¦æ–­åœ°æå‡ºè‡ªå·±çš„è§„èŒƒå»ºè®®. æ¨èä¸‹é¢è¿™äº›èµ„æº:</p><p><br></p><h3 id="5-1-javascript"><a href="#5-1-javascript" class="headerlink" title="5.1 Javascript"></a>5.1 Javascript</h3><ul><li>Lintå·¥å…·<ul><li><a href="https://cn.eslint.org" target="_blank" rel="noopener">ESLint</a> - ğŸ”¥ç›®å‰æ˜¯ç¤¾åŒºæœ€æµè¡Œçš„ã€é€šç”¨çš„Javascript Lintå·¥å…·ï¼ŒLintç•Œçš„Babelã€‚æ”¯æŒå®šåˆ¶æ’ä»¶ã€presetã€‚å¦‚æœä¸æƒ³æŠ˜è…¾å¯ä»¥é€‰æ‹©å®ƒçš„ä¸€äº›é¢„å®šä¹‰é…ç½®</li><li><a href="https://github.com/palantir/tslint" target="_blank" rel="noopener">TSLint</a> - Typescript Lintå·¥å…·ã€‚ä¸è¿‡å³å°†<a href="https://github.com/palantir/tslint/issues/4534" target="_blank" rel="noopener">åºŸå¼ƒ</a>äº†, æ¨èä½¿ç”¨ESLint</li></ul></li><li>è§„èŒƒ<ul><li><a href="https://standardjs.com/readme-zhcn.html#why-should-i-use-javascript-standard-style" target="_blank" rel="noopener">JavaScript Standard Style</a> - ğŸ”¥ é›¶é…ç½®çš„ã€â€˜æ ‡å‡†â€™çš„Javascriptç¼–ç è§„èŒƒ. åº•å±‚åŸºäºEslintã€‚ç›®å‰ä¸æ”¯æŒTypescript</li><li><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">Airbnb JavaScript Style Guide</a> - Airbnbçš„ç¼–ç è§„èŒƒï¼Œä¸šç•Œæ ‡æ†</li></ul></li><li>ç±»å‹æ£€æŸ¥. æš‚æ—¶å°†å®ƒä»¬å½’ç±»åˆ°è¿™é‡Œï¼Œå› ä¸ºå®ƒä»¬åŒå±äº<a href="https://juejin.im/post/5d2c515d6fb9a07ead5a2bbe#heading-39" target="_blank" rel="noopener">â€˜é™æ€æµ‹è¯•â€™</a><ul><li><a href="https://www.typescriptlang.org" target="_blank" rel="noopener">Typescript</a> - ğŸ”¥ Javascriptè¯­è¨€çš„è¶…é›†ï¼Œè¿™æ˜¯ä¸€é—¨â€˜æ–°â€™çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯ç®€å•çš„ç±»å‹æ£€æŸ¥å™¨. ä¸è¿‡<strong>å®ƒä¹Ÿæ”¯æŒ<a href="https://www.typescriptlang.org/docs/handbook/type-checking-javascript-files.html" target="_blank" rel="noopener">åŸç”ŸJavascriptçš„ç±»å‹æ£€æŸ¥</a></strong></li><li><a href="https://flow.org" target="_blank" rel="noopener">Flow</a> - Facebookå‡ºå“çš„ç±»å‹æ£€æŸ¥å™¨ï¼Œè¯­æ³•å’ŒTypescriptç±»ä¼¼. ä¸ªäººæ¨èä½¿ç”¨Typescript</li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-2-html"><a href="#5-2-html" class="headerlink" title="5.2 HTML"></a>5.2 HTML</h3><ul><li>Lintå·¥å…·<ul><li><a href="https://htmlhint.io" target="_blank" rel="noopener">HTMLHint</a></li><li><a href="https://github.com/twbs/bootlint" target="_blank" rel="noopener">bootlint</a></li></ul></li><li>è§„èŒƒ<ul><li><a href="https://codeguide.co" target="_blank" rel="noopener">Code Guide</a></li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-3-css"><a href="#5-3-css" class="headerlink" title="5.3 CSS"></a>5.3 CSS</h3><ul><li>Lintå·¥å…·<ul><li><a href="https://stylelint.docschina.org" target="_blank" rel="noopener">stylelint</a> - ğŸ”¥ é€šç”¨çš„CSSç¼–ç æ£€æŸ¥å·¥å…·ï¼Œæ”¯æŒæœ€æ–°çš„CSSè¯­æ³•ã€CSS-in-jsã€ä»¥åŠå…¶ä»–ç±»CSSè¯­æ³•(å¦‚SCSSã€Less). å®ƒä¹Ÿæœ‰é¢„å®šä¹‰é…ç½®ï¼Œæ¨èä½¿ç”¨</li></ul></li><li>è§„èŒƒ<ul><li><a href="https://github.com/airbnb/css" target="_blank" rel="noopener">Airbnb CSS / Sass Styleguide</a></li><li><a href="https://codeguide.co" target="_blank" rel="noopener">Code Guide</a></li><li><a href="https://css-tricks.com/css-style-guides/" target="_blank" rel="noopener">æ›´å¤š</a></li></ul></li><li>æ–¹æ³•è®º<ul><li><a href="https://css-tricks.com/bem-101/" target="_blank" rel="noopener">BEM</a> - ğŸ”¥ BEMå‘½åè§„èŒƒ</li><li><a href="https://github.com/stubbornella/oocss/wiki" target="_blank" rel="noopener">OOCSS</a></li><li><a href="http://smacss.com" target="_blank" rel="noopener">smacss</a></li></ul></li></ul><p><br></p><p>å…³äºCSSå¯ä»¥å­¦ä¹ <a href="http://twitter.github.com/bootstrap/" target="_blank" rel="noopener">Bootstrap</a>è¿™äº›ä¼ ç»ŸUIæ¡†æ¶ï¼Œä»–ä»¬çš„ä»£ç ç»„ç»‡æ€§éå¸¸å¥½, å€¼å¾—å­¦ä¹ </p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-4-ä»£ç æ ¼å¼åŒ–"><a href="#5-4-ä»£ç æ ¼å¼åŒ–" class="headerlink" title="5.4 ä»£ç æ ¼å¼åŒ–"></a>5.4 ä»£ç æ ¼å¼åŒ–</h3><p><img src="/images/frontend-standard/prt.png" alt></p><ul><li><a href="https://prettier.io" target="_blank" rel="noopener">Prettier</a> - ğŸ”¥ å…³äºä»£ç æ ¼å¼åŒ–çš„æ‰€æœ‰ä¸œè¥¿éƒ½äº¤ç»™å®ƒå§ï¼</li></ul><p>åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰ä»£ç æ ¼å¼ç›¸å…³çš„å·¥ä½œéƒ½å¯ä»¥äº¤ç»™Prettieræ¥åšï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šå†ä½¿ç”¨Eslintè¦†ç›–è¯­ä¹‰ç›¸å…³çš„æ£€æŸ¥</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-5-é›†å¤§æˆçš„"><a href="#5-5-é›†å¤§æˆçš„" class="headerlink" title="5.5 é›†å¤§æˆçš„"></a>5.5 é›†å¤§æˆçš„</h3><ul><li><a href="https://coderlmn.github.io/code-standards/#_code_reviews" target="_blank" rel="noopener">isobar å‰ç«¯ä»£ç è§„èŒƒåŠæœ€ä½³å®è·µ</a></li><li><a href="https://guide.aotu.io/index.html" target="_blank" rel="noopener">å‡¹å‡¸å®éªŒå®¤ä»£ç è§„èŒƒ</a></li><li><a href="https://github.com/fex-team/styleguide" target="_blank" rel="noopener">ç™¾åº¦FEXè§„èŒƒ</a></li><li><a href="http://nec.netease.com/standard" target="_blank" rel="noopener">è€ç‰Œçš„NECè§„èŒƒ</a> - æœ‰ç‚¹è€</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-6-ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—"><a href="#5-6-ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—" class="headerlink" title="5.6 ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—"></a>5.6 ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—</h3><ul><li><a href="https://vue.docschina.org/v2/style-guide/" target="_blank" rel="noopener">vue-style-guide</a></li><li><a href="https://github.com/airbnb/javascript/tree/master/react" target="_blank" rel="noopener">Airbnb React/JSX Style Guide</a></li><li><a href="https://juejin.im/post/5cd7f2c4e51d453a7d63b715" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“</a> - è‡ªèä¸€ä¸‹ç¬”è€…å†™çš„Reactç»„ä»¶è®¾è®¡ç›¸å…³å®è·µ</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-7-code-review"><a href="#5-7-code-review" class="headerlink" title="5.7 Code Review"></a>5.7 Code Review</h3><p><img src="/images/frontend-standard/code-review.png" alt></p><p>ä¸Šè¿°çš„Lintå·¥å…·å’Œç±»å‹æ£€æŸ¥å™¨, å¯ä»¥çº¦æŸä»£ç é£æ ¼ã€é¿å…ä½çº§çš„è¯­æ³•é”™è¯¯ã€‚ä½†æ˜¯å³ä½¿é€šè¿‡ä¸Šé¢çš„Lintå’Œç±»å‹æ£€æŸ¥ï¼Œä»£ç ä¹Ÿå¯èƒ½æœªå¿…æ˜¯â€˜å¥½ä»£ç â€™ã€‚</p><p><strong>å¾ˆå¤šä»£ç è®¾è®¡çš„â€˜æœ€ä½³å®è·µâ€™æ˜¯æ— æ³•é€šè¿‡å…·è±¡åŒ–çš„è‡ªåŠ¨åŒ–å·¥å…·æˆ–æ–‡æ¡£è¦†ç›–çš„, è¿™æ—¶å€™ï¼Œâ€™ç»éªŒâ€™æˆ–è€…â€™ç¾¤ä½“æ™ºæ…§â€™å°±æ´¾ä¸Šç”¨åœºäº†</strong>. æ¯”å¦‚Code Reviewé˜¶æ®µä¼šæ£€æŸ¥è¿™äº›ä¸œè¥¿:</p><ul><li>ç¼–ç¨‹åŸåˆ™ã€è®¾è®¡æ€æƒ³. ä¾‹å¦‚ç¬¦åˆSOLIDåŸåˆ™? æ˜¯å¦è¶³å¤ŸDRYï¼Ÿæ¥å£è®¾è®¡æ˜¯å¦ç®€æ´æ˜“æ‰©å±•ã€</li><li>æ¨¡å—è€¦åˆç¨‹åº¦ã€ä»£ç é‡å¤</li><li>ä»£ç å¥å£®æ€§ã€‚æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²ã€æ˜¯å¦çº¿ç¨‹å®‰å…¨ã€æ˜¯å¦æœ‰æ½œåœ¨æ€§èƒ½é—®é¢˜å’Œå¼‚å¸¸ã€é”™è¯¯æ˜¯å¦è¢«å¤„ç†</li><li>ä»£ç çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</li><li>æ˜¯å¦æœ‰æ²¡æœ‰è€ƒè™‘åˆ°çš„åœºæ™¯ï¼Ÿ</li></ul><p>å¦‚æœä½ ä»¬æ˜¯ç¬¬ä¸€æ¬¡æ¨è¡ŒCode Review, å¯ä»¥å»ºç«‹ä¸€ä¸ªæ£€æŸ¥åˆ—è¡¨ï¼Œå¯¹ç…§ç€è¿›è¡Œæ£€æŸ¥ã€‚ç†Ÿç»ƒåï¼Œå¿ƒä¸­è‡ªç„¶æ— ç ã€‚</p><p><br></p><p>Code Reviewæœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>Code Reviewå¯ä»¥è®©å…¶ä»–æˆå‘˜éƒ½ç†Ÿæ‚‰ä»£ç </strong>ã€‚è¿™æ ·ä¿è¯å…¶ä»–äººéƒ½å¯ä»¥è¾ƒå¿«åœ°æ¥æ‰‹ä½ çš„å·¥ä½œï¼Œæˆ–è€…å¸®ä½ è§£å†³æŸäº›é—®é¢˜</li><li><strong>æé«˜ä»£ç è´¨é‡</strong>ã€‚æ¯«æ— ç–‘é—®. ä¸€æ–¹é¢æ˜¯<em>ä¸»åŠ¨æ€§</em>çš„ä»£ç è´¨é‡æå‡ï¼Œæ¯”å¦‚ä½ çš„ä»£ç éœ€è¦è¢«äººReviewï¼Œä¼šè‡ªè§‰å°½é‡çš„æé«˜ä»£ç è´¨é‡ï¼›å¦ä¸€æ–¹é¢ï¼Œå…¶ä»–æˆå‘˜å¯ä»¥æ£€æŸ¥æäº¤æ–¹çš„ä»£ç è´¨é‡</li><li><strong>æ£€æŸ¥æˆ–æé«˜æ–°æˆå‘˜çš„ç¼–ç¨‹æ°´å¹³</strong>ã€‚åŸ¹å…»æ–°äººæ—¶ï¼Œç”±äºä¸ä¿¡ä»»å®ƒä»¬æäº¤çš„ä»£ç ï¼Œæˆ‘ä»¬ä¼šåšä¸€æ¬¡Reviewæ£€æŸ¥ä»£ç æ˜¯å¦è¿‡å…³ã€‚å¦ä¸€æ–¹é¢è¿™æ˜¯ä¸€æ¬¡çœŸå®çš„æ¡ˆä¾‹è®²è§£, å¯ä»¥è¾ƒå¿«æé«˜ä»–ä»¬çš„èƒ½åŠ›</li></ul><p><br></p><p><strong>Code Reviewæœ‰ä¸¤ç§æ–¹å¼: ä¸€ä¸ª<code>æäº¤æ—¶</code>ã€ä¸€ä¸ªæ˜¯<code>å®šæ—¶</code></strong>:</p><ul><li><code>æäº¤æ—¶</code>. å¤§éƒ¨åˆ†å¼€æºé¡¹ç›®é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚é€šä¿—è®²å°±æ˜¯Pull Requestã€‚åªæœ‰ä»£ç é€šè¿‡æµ‹è¯•ã€å’Œå…¶ä»–æˆå‘˜çš„Reviewæ‰å¯ä»¥åˆè¿›æ­£å¼ç‰ˆæœ¬åº“ã€‚è¿™ç§æ–¹å¼ä¹Ÿç§°ä¸ºâ€˜é˜»å¡å¼â€™ä»£ç æ£€æŸ¥ï¼Œä¸€èˆ¬é…åˆGitFlowä½¿ç”¨ã€‚</li><li><code>å®šæ—¶</code>. åœ¨é¡¹ç›®å®Œç»“åã€é¡¹ç›®çš„æŸä¸ªé‡Œç¨‹ç¢‘ã€æˆ–è€…å›ºå®šçš„æ—¶é—´(æ¯å¤©ã€æ¯ä¸ªæ˜ŸæœŸ..). å›¢é˜Ÿæˆå‘˜èšåœ¨ä¸€èµ·ï¼Œå›é¡¾è‡ªå·±å†™çš„ä»£ç , è®©å…¶ä»–æˆå‘˜è¿›è¡Œå®¡æŸ¥</li></ul><p>Code Reviewæ˜¯æ¯”è¾ƒéš¾ä»¥æ¨è¡Œçš„ï¼Œä¸è¿‡è¿™ä¸ªä¹Ÿè¦çœ‹ä½ ä»¬å›¢é˜Ÿçš„æƒ…å†µï¼Œå‘æˆ‘ä»¬é’±å°‘æ´»å¤šçš„å›¢é˜Ÿï¼Œå¾ˆå°‘çš„æ—¶é—´å»ç«‹é©¬å»å…¼é¡¾å…¶ä»–æˆå‘˜çš„ä»£ç . è¿™æ—¶å€™<code>å®šæ—¶Review</code>ä¼šæ›´æœ‰ç”¨ï¼Œå› ä¸ºçœ‹èµ·æ¥æ›´â€˜èŠ‚çœæ—¶é—´â€™.</p><p>è€Œ<code>æäº¤æ—¶Review</code>åˆ™å¯ä»¥é’ˆå¯¹æ–°äººï¼Œæ¯”å¦‚ä½ ä¸ä¿¡ä»»ä»–ä»¬çš„ä»£ç æˆ–è€…å¸Œæœ›å¸®åŠ©ä»–ä»¬æé«˜ç¼–ç èƒ½åŠ›ã€‚</p><p><br></p><p><strong>ç›¸å…³èµ„æº</strong>:</p><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTQwNTA3Nw==&amp;mid=400946871&amp;idx=1&amp;sn=5a125337833768d705f9d87ba8cd9fff&amp;scene=1&amp;srcid=0104FLyeXIS6N0EShgDseIfI&amp;key=41ecb04b051110031290b34976240e650f0169d239c89f125162a89c8d3412f2087198612e71fd7685cae9eebe08e295&amp;ascene=0&amp;uin=MTYyMDMzMTAwMA%3D%3D&amp;devicetype=iMac+MacBookPro11%2C5+OSX+OSX+10.10.5+build(14F1509" target="_blank" rel="noopener">Code Reviewæœ€ä½³å®è·µ</a>&amp;version=11020201&amp;pass_ticket=dc5bBckt1XSthRKTIsukYHIcAvKfv0jninbMlYQ5TWnE6XS%2FrRkdHKlJjNTI2Wsg)</li><li><a href="https://juejin.im/post/5c9740ba6fb9a071090d6a37" target="_blank" rel="noopener">æ˜¯å¦è¦åšCode Reviewï¼Ÿä¸BATèµ„æ·±æ¶æ„å¸ˆäº‰è®ºä¹‹åçš„æ€è€ƒ</a></li><li><a href="https://richardcao.me/2016/09/30/Talk-About-Codereview/" target="_blank" rel="noopener">ä¸€äº›Code Reviewå·¥å…·</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="6-æ–‡æ¡£è§„èŒƒ"><a href="#6-æ–‡æ¡£è§„èŒƒ" class="headerlink" title="6 æ–‡æ¡£è§„èŒƒ"></a>6 æ–‡æ¡£è§„èŒƒ</h2><p>æ–‡æ¡£å¯¹äºé¡¹ç›®å¼€å‘å’Œç»´æŠ¤ã€å­¦ä¹ ã€é‡æ„ã€ä»¥åŠçŸ¥è¯†ç®¡ç†éå¸¸é‡è¦ã€‚</p><p>å’Œå†™æµ‹è¯•ä¸€æ ·ã€å¤§éƒ¨åˆ†å¼€å‘äººå‘˜ä¼šè§‰å¾—å†™æ–‡æ¡£æ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹æƒ…ï¼Œä¸è¿‡åªæœ‰æ—¶é—´èƒ½å¤Ÿè¯æ˜å®ƒçš„ä»·å€¼ã€‚æ¯”å¦‚å¯¹äºäººå‘˜æµåŠ¨æ¯”è¾ƒå¤§çš„å…¬å¸ï¼Œå¦‚æœæœ‰è§„èŒƒçš„æ–‡æ¡£ä½“ç³»ï¼Œè½¬äº¤å·¥ä½œå°±ä¼šå˜åŠ¨éå¸¸è½»æ¾.</p><p><strong>å¹¿ä¹‰çš„æ–‡æ¡£ä¸å•æŒ‡â€˜è¯´æ˜æ–‡ä»¶â€™æœ¬èº«ï¼Œå®ƒæœ‰å¾ˆå¤šå½¢å¼ã€æ¥æºå’Œè½½ä½“ï¼Œå¯ä»¥æè¿°ä¸€ä¸ªçŸ¥è¯†ã€ä»¥åŠçŸ¥è¯†å½¢æˆå’Œè¿­ä»£çš„è¿‡ç¨‹</strong>ã€‚ä¾‹å¦‚ç‰ˆæœ¬åº“ä»£ç æäº¤è®°å½•ã€ä»£ç æ³¨é‡Šã€å†³ç­–å’Œè®¨è®ºè®°å½•ã€CHANGELOGã€ç¤ºä¾‹ä»£ç ã€è§„èŒƒã€ä¼ ç»Ÿæ–‡æ¡£ç­‰ç­‰</p><p><br></p><h3 id="6-1-å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ"><a href="#6-1-å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ" class="headerlink" title="6.1 å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ"></a>6.1 å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ</h3><p>æˆ‘ä»¬å…¬å¸æ˜¯åšIMçš„ï¼Œæ‰€ä»¥ä¹‹å‰æˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨â€™è‡ªå·±çš„â€™é€šè®¯å·¥å…·æ¥åˆ†äº«æ–‡æ¡£ï¼Œè¿™ç§æ–¹å¼æœ‰å¾ˆå¤§é—®é¢˜:</p><ol><li>å¦‚æœæ²¡æœ‰å­˜æ¡£ä¹ æƒ¯(æ¯”å¦‚åç«¯çš„APIæ–‡æ¡£ï¼Œå› ä¸ºç”±åç«¯ç»´æŠ¤ï¼Œä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å»å­˜æ¡£), æ–‡æ¡£å°±å¯èƒ½ä¸¢å¤±ï¼Œè€Œä¸”é€šè®¯å·¥å…·æ˜¯ä¸ä¼šæ°¸ä¹…ä¿å­˜ä½ çš„æ–‡æ¡£çš„ã€‚å½“ä¸¢å¤±æ–‡ä»¶å°±éœ€è¦é‡æ–°å’Œæ–‡æ¡£ç»´æŠ¤è€…ç´¢è¦</li><li>ç³Ÿç³•çš„æ˜¯æ–‡æ¡£ç»´æŠ¤è€…ä¹Ÿæ˜¯è‡ªå·±æ‰‹åŠ¨åœ¨æœ¬åœ°å­˜æ¡£çš„ï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜æ˜¯: å¦‚æœå·¥ä½œè½¬äº¤ï¼Œå…¶ä»–å¼€å‘è€…éœ€è¦èŠ±è´¹ä¸€ç‚¹æ—¶é—´æ¥æŸ¥æ‰¾; ä¸¢å¤±äº†å°±çœŸçš„æ²¡äº†</li><li>æ¯ä¸€æ¬¡æ–‡æ¡£æ›´æ–°è¦é‡æ–°å‘ä¸€ä»½, è¿™å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å¯èƒ½å‡ºç°æ¼å‘çš„æƒ…å†µ, å¯¼è‡´å‰åä¸ä¸€è‡´.</li><li>å…³äºçŸ¥è¯†çš„å­¦ä¹ ã€ä»¥åŠæœ‰æ„ä¹‰çš„è®¨è®ºè®°å½•æ— æ³•å½’æ¡£ã€‚</li></ol><p>ä¸Šé¢ä»‹ç»çš„æ˜¯ä¸€ç§éå¸¸åŸå§‹çš„æ–‡æ¡£å…±äº«æ–¹å¼ï¼Œå¾ˆå¤šå°å›¢é˜Ÿå°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚</p><p><strong>å¯¹äºé¡¹ç›®æœ¬èº«çš„æ–‡æ¡£å»ºè®®æ”¾ç½®åœ¨å…³è”é¡¹ç›®ç‰ˆæœ¬åº“é‡Œé¢ï¼Œè·Ÿéšé¡¹ç›®ä»£ç è¿›è¡Œè¿­ä»£, å½“æˆ‘ä»¬åœ¨æ£€ç´¢æˆ–è·Ÿè¸ªæ–‡æ¡£çš„å†å²è®°å½•æ—¶ï¼Œè¿™ç§æ–¹å¼æ˜¯æœ€æ–¹ä¾¿çš„</strong>ã€‚</p><p>ç„¶è€Œå¾ˆå¤šåº”ç”¨æ˜¯è·¨è¶Šå¤šä¸ªå›¢é˜Ÿçš„ï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½ä¼šæœ‰è‡ªå·±çš„æ–‡æ¡£è¾“å‡º(æ¯”å¦‚éœ€æ±‚æ–‡æ¡£ã€ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ã€APIæ–‡æ¡£ã€é…ç½®æ–‡æ¡£ç­‰ç­‰)ï¼Œè€Œä¸”é€šå¸¸ä¹Ÿä¸ä¼šåœ¨ä¸€ä¸ªç‰ˆæœ¬åº“é‡Œã€‚è¿™æ—¶å€™æ–‡æ¡£å°±æ¯”è¾ƒåˆ†æ•£ã€‚æ‰€ä»¥ä¸€ä¸ªç»Ÿä¸€çš„æ–‡æ¡£ä¸­å¿ƒæ˜¯å¾ˆæœ‰å¿…è¦ã€‚</p><p>æˆ‘ä»¬å…¬å¸ç°åœ¨é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯<code>Git+Markdown</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æ–‡æ¡£éƒ½æ”¾ç½®åœ¨ä¸€ä¸ªgitç‰ˆæœ¬åº“ä¸‹ã€‚ä¹‹å‰ä¹Ÿè€ƒè™‘è¿‡å•†ä¸šçš„æ–¹æ¡ˆï¼Œè­¬å¦‚<a href="https://shimo.im/welcome" target="_blank" rel="noopener">çŸ³å¢¨æ–‡æ¡£</a>ã€<a href="https://docs.qq.com" target="_blank" rel="noopener">è…¾è®¯æ–‡æ¡£</a>, ä½†ç®¡ç†å±‚å¹¶ä¸ä¿¡ä»»è¿™äº›æœåŠ¡ã€‚</p><p>å¤§æ¦‚çš„gité¡¹ç›®ç»„ç»‡å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è§„èŒƒ/</span><br><span class="line">Aåº”ç”¨/</span><br><span class="line">  äº§å“/</span><br><span class="line">  è®¾è®¡/</span><br><span class="line">  APIæ–‡æ¡£/</span><br><span class="line">  æµ‹è¯•/</span><br><span class="line">  å…¶ä»–/</span><br><span class="line">Båº”ç”¨/</span><br></pre></td></tr></table></figure><p><strong>Gitç‰ˆæœ¬åº“(ä¾‹å¦‚Gitlab)æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œä¾‹å¦‚å†å²è®°å½•è·Ÿè¸ªã€ç‰ˆæœ¬åŒ–ã€é—®é¢˜è®¨è®º(å¯ä»¥å…³è”issueã€æˆ–è€…æäº¤)ã€å¤šäººåä½œã€æœç´¢ã€æƒé™ç®¡ç†(é’ˆå¯¹ä¸åŒçš„ç‰ˆæœ¬åº“æˆ–åˆ†ç»„ä¸ºä¸åŒäººå‘˜è®¾ç½®æƒé™)ç­‰ç­‰</strong>ã€‚</p><p><code>Git+Markdown</code>å¯ä»¥æ»¡è¶³å¼€å‘è€…çš„å¤§éƒ¨åˆ†éœ€æ±‚ã€‚ä½†æ˜¯<strong>Gitæœ€æ“…é•¿çš„æ˜¯å¤„ç†çº¯æ–‡æœ¬æ–‡ä»¶ã€å¯¹äºäºŒè¿›åˆ¶æ˜¯æ— èƒ½ä¸ºåŠ›çš„ï¼Œæ— æ³•é’ˆå¯¹è¿™äº›ç±»å‹çš„æ–‡æ¡£è¿›è¡Œåœ¨çº¿é¢„è§ˆå’Œç¼–è¾‘</strong>ã€‚</p><p>æ‰€ä»¥<code>Git+Markdown</code>å¹¶ä¸èƒ½æ»¡è¶³å¤šæ ·åŒ–çš„æ–‡æ¡£å¤„ç†éœ€æ±‚ï¼Œæ¯”å¦‚æ€ç»´å¯¼å›¾ã€å›¾è¡¨ã€è¡¨æ ¼ã€PPTã€ç™½æ¿ç­‰éœ€æ±‚. æ¯•ç«Ÿå®ƒä¸æ˜¯ä¸“ä¸šçš„æ–‡æ¡£å¤„ç†å·¥å…·ã€‚æ‰€ä»¥å¯¹äºäº§å“ã€è®¾è®¡äººå‘˜è¿™äº›å¯Œæ–‡æ¡£éœ€æ±‚åœºæ™¯ï¼Œé€šå¸¸ä¼šæŒ‰ç…§ä¼ ç»Ÿæ–¹å¼æˆ–è€…æ›´ä¸“ä¸šçš„å·¥å…·å¯¹æ–‡æ¡£è¿›è¡Œç®¡ç†.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-2-æ–‡æ¡£æ ¼å¼"><a href="#6-2-æ–‡æ¡£æ ¼å¼" class="headerlink" title="6.2 æ–‡æ¡£æ ¼å¼"></a>6.2 æ–‡æ¡£æ ¼å¼</h3><p>æ¯«æ— ç–‘é—®ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œ<a href="https://zh.wikipedia.org/wiki/Markdown" target="_blank" rel="noopener">Markdown</a>æ˜¯æœ€é€‚åˆçš„ã€æœ€é€šç”¨çš„æ–‡æ¡£æ ¼å¼ã€‚æ”¯æŒç‰ˆæœ¬åº“åœ¨çº¿é¢„è§ˆå’Œå˜æ›´å†å²è·Ÿè¸ªã€‚</p><p>ä¸‹é¢è¿™äº›å·¥å…·å¯ä»¥æé«˜Markdownçš„å¼€å‘æ•ˆç‡:</p><ul><li>å¯è§†åŒ–ç¼–è¾‘å™¨<ul><li><strong>Visual Code</strong>: å¤§éƒ¨åˆ†ä»£ç ç¼–è¾‘éƒ½æ”¯æŒMarkdownç¼–è¾‘å’Œé¢„è§ˆ</li><li><a href="https://link.jianshu.com/?t=http://mouapp.com/" target="_blank" rel="noopener"><strong>Mou</strong></a>: Macä¸‹çš„è€ç‰Œç¼–è¾‘å™¨</li><li><a href="https://typora.io" target="_blank" rel="noopener"><strong>typora</strong></a>: è·¨å¹³å°çš„Markdownç¼–è¾‘å™¨ï¼Œæ¨è</li></ul></li><li><strong>markdownlint</strong>: ç¼–ç æ£€æŸ¥å™¨</li><li>æ‰©å±•(Visual Studio Code):<ul><li><strong>Markdown All in One</strong>: All you need to write Markdown (keyboard shortcuts, table of contents, auto preview and more)</li><li><strong>Markdown TOC</strong>: markdown ç›®å½•ç”Ÿæˆï¼Œæˆ‘æœ€å¸¸ç”¨çš„markdownæ’ä»¶</li></ul></li><li>å›¾è¡¨ç»˜åˆ¶å·¥å…·:<ul><li><a href="https://www.draw.io" target="_blank" rel="noopener"><strong>drawio</strong></a> åŸºäºWebçš„å›¾è¡¨ç»˜åˆ¶å·¥å…·ã€ä¹Ÿæœ‰ç¦»çº¿å®¢æˆ·ç«¯</li><li><strong>KeyNote/PPT</strong> ä¸´æ—¶ç»˜å›¾ä¹Ÿä¸é”™</li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-3-å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿"><a href="#6-3-å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿" class="headerlink" title="6.3 å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿"></a>6.3 å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿</h3><p>å…³äºå¦‚ä½•å†™å¥½æ–‡æ¡£ï¼Œå¾ˆéš¾é€šè¿‡æ ‡å‡†æˆ–è§„èŒƒæ¥è¿›è¡Œçº¦æŸï¼Œå› ä¸ºå®ƒçš„ä¸»è§‚æ€§æ¯”è¾ƒå¼º, å¥½çš„æ–‡æ¡£å–å†³äºç¼–è¾‘è€…çš„é€»è¾‘æ€»ç»“èƒ½åŠ›ã€è¡¨è¾¾èƒ½åŠ›ã€ä»¥åŠæœ‰æ²¡æœ‰ç«™åœ¨è¯»è€…çš„è§’åº¦å»æ€è€ƒé—®é¢˜ã€‚</p><p>æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒç±»å‹çš„æ–‡æ¡£æä¾›ä¸€ä¸ªæ¨¡æ¿ï¼Œé€šè¿‡æ¨¡æ¿æ¥è¯´æ˜ä¸€ä¸ªæ–‡æ¡£éœ€è¦åŒ…å«å“ªäº›å†…å®¹, å¯¹æ–‡æ¡£çš„ç¼–å†™è€…è¿›è¡Œå¼•å¯¼.</p><p>ä¾‹å¦‚ä¸€ä¸ªAPIæ–‡æ¡£å¯èƒ½éœ€è¦è¿™äº›å†…å®¹:</p><ul><li>æ¥å£çš„ç´¢å¼•</li><li>æ¥å£çš„ç‰ˆæœ¬ã€å˜æ›´è®°å½•</li><li>ç”¨æ³•å’Œæ•´ä½“æè¿°, è®¤è¯é‰´æƒç­‰ç­‰</li><li>æè¿°å…·ä½“çš„æ¥å£<ul><li>åŠŸèƒ½è¯´æ˜</li><li>æ–¹æ³•åç§°æˆ–è€…URI</li><li>å‚æ•°å’Œè¿”å›å€¼å®šä¹‰</li><li>è°ƒç”¨ç¤ºä¾‹</li><li>æ³¨æ„äº‹é¡¹ç­‰ç­‰</li></ul></li></ul><p>å…·ä½“è§„èŒƒå†…å®¹å› å›¢é˜Ÿè€Œå¼‚ï¼Œè¿™é‡Œç‚¹åˆ°ä¸ºæ­¢.</p><p><br></p><p>æ‰©å±•:</p><ul><li><a href="https://github.com/ruanyf/document-style-guide/blob/master/docs/reference.md" target="_blank" rel="noopener">ä¸­æ–‡æŠ€æœ¯æ–‡æ¡£çš„å†™ä½œè§„èŒƒ</a></li><li><a href="https://github.com/reactjs/rfcs/blob/master/0000-template.md" target="_blank" rel="noopener">React RFCæ¨¡æ¿</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-4-è®¨è®ºå³æ–‡æ¡£"><a href="#6-4-è®¨è®ºå³æ–‡æ¡£" class="headerlink" title="6.4 è®¨è®ºå³æ–‡æ¡£"></a>6.4 è®¨è®ºå³æ–‡æ¡£</h3><p><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€ä¸ªå¼€æºé¡¹ç›®æ¥è¯´é™¤äº†å®˜æ–¹æ–‡æ¡£ï¼ŒIssuesä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯æ¥æºã€‚åœ¨Issueä¸­æˆ‘ä»¬å¯ä»¥è·å–å…¶ä»–å¼€å‘è€…é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€ç»™å®˜æ–¹åé¦ˆ/æŠ•ç¥¨ã€å…³æ³¨å®˜æ–¹çš„æœ€æ–°åŠ¨æ€ã€å’Œå…¶ä»–å¼€å‘è€…å¤´è„‘é£æš´å”‡æªèˆŒæˆ˜ç­‰ç­‰</strong>ã€‚</p><p>æ‰€ä»¥ç›¸å¯¹äºä½¿ç”¨IMï¼Œç¬”è€…æ›´æ¨èIssueè¿™ç§æ²Ÿé€šæ¨¡å¼ï¼Œå› ä¸º<strong>å®ƒæ–¹ä¾¿å½’æ¡£ç»„ç»‡ï¼Œç´¢å¼•å’ŒæŸ¥æ‰¾</strong>ã€‚è€ŒIMä¸Šçš„è®¨è®ºå°±åƒæµæ°´ä¸€æ ·ï¼Œä¸€å»ä¸å¤è¿”ã€‚</p><p>å½“ç„¶ä¸¤ç§å·¥å…·çš„é€‚ç”¨åœºæ™¯ä¸ä¸€æ ·ï¼Œä½ æ‹¿IMçš„ä½¿ç”¨æ–¹å¼æ¥ä½¿ç”¨Issueï¼ŒIssueå°±ä¼šå˜å¾—å¾ˆæ°´ã€‚<strong>Issueé€‚åˆåšæœ‰æ„ä¹‰çš„ã€ç›®çš„æ˜ç¡®çš„è®¨è®º</strong>ã€‚ æ‰€ä»¥è¦è°´è´£ä¸€ä¸‹åœ¨Github Issueä¸ŠçŒæ°´çš„å¼€å‘è€…ã€‚</p><p>å…³äºIssueæœ‰å¾ˆå¤šå¦™ç”¨ï¼Œæ¨èé˜…è¯»è¿™ç¯‡æ–‡ç« <a href="http://www.ruanyifeng.com/blog/2017/08/issue.html" target="_blank" rel="noopener">&lt;å¦‚ä½•ä½¿ç”¨ Issue ç®¡ç†è½¯ä»¶é¡¹ç›®ï¼Ÿ&gt;</a></p><p>ç°åœ¨å¾ˆå¤šå¼€æºé¡¹ç›®éƒ½å¼•å…¥äº†RFC(è¯·æ±‚æ„è§ç¨¿)æµç¨‹(å‚è€ƒ<a href="https://www.infoq.cn/article/2017/12/react-rfc-process" target="_blank" rel="noopener">Reacté‡‡ç”¨æ–°çš„RFCæµç¨‹</a>, ä»¥åŠ<a href="https://juejin.im/post/5d0f64d4f265da1b67211893" target="_blank" rel="noopener">Vue æœ€é»‘æš—çš„ä¸€å¤©</a>), è¿™è®©å¼€å‘è€…æœ‰â€˜ç¿»èº«å†œå¥´ã€å½“å®¶åšä¸»â€™çš„æ„Ÿè§‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‚ä¸åˆ°ä¸€ä¸ªå¼€æºé¡¹ç›®é‡å¤§äº‹ä»¶çš„å†³ç­–ä¹‹ä¸­ã€‚<strong>æ¯ä¸ªRFCä¼šè¯´æ˜å†³ç­–çš„åŠ¨æœºã€è¯¦ç»†è®¾è®¡ã€ä¼˜ç¼ºç‚¹ã€‚é™¤äº†å®˜æ–¹æ–‡æ¡£ä¹‹å¤–ï¼Œè¿™äº›RFCæ˜¯å¾ˆæœ‰ä»·å€¼çš„å­¦ä¹ èµ„æ–™</strong>ã€‚</p><p>æˆ‘è§‰å¾—å¦‚æœä¸æ¶‰åŠæœºå¯†ï¼Œå›¢é˜Ÿåº”è¯¥è¦è®©æ›´å¤šäººå‚ä¸åˆ°é¡¹ç›®çš„è®¾è®¡å’Œå†³ç­–ä¸­ï¼Œå¯¹äºæ–°æ‰‹å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œè€Œå¯¹äºå‘èµ·è€…ä¹Ÿå¯èƒ½æœ‰è€ƒè™‘ä¸å‘¨çš„æƒ…å†µã€‚</p><p>é‚£å¯¹äºä¼ä¸šåº”ç”¨å¼€å‘, Issueæœ‰ç”¨å—?</p><p>å½“ç„¶æœ‰ç”¨, æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å°†è¿™ç±»è¯é¢˜ä»IMè½¬ç§»åˆ°Issue:</p><ul><li>è®¾è®¡æ–¹æ¡ˆ</li><li>å†³ç­–/å»ºè®®<ul><li>æ–°åŠŸèƒ½ã€æ–°æŠ€æœ¯å¼•å…¥</li><li>é‡æ„</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>è§„èŒƒ</li></ul></li><li>é—®é¢˜è®¨è®º</li><li>é‡å¤§äº‹ä»¶</li><li>è®¡åˆ’æˆ–è¿›åº¦è·Ÿè¸ª</li><li>â€¦</li></ul><p><br></p><p>å¦å¤–Issueé€šå¸¸é€šè¿‡æ ‡ç­¾æ¥è¿›è¡Œåˆ†ç±»ï¼Œæ–¹ä¾¿ç»„ç»‡å’Œæ£€ç´¢:</p><p><img src="/images/frontend-standard/issue.png" alt></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-5-æ³¨é‡Šå³æ–‡æ¡£"><a href="#6-5-æ³¨é‡Šå³æ–‡æ¡£" class="headerlink" title="6.5 æ³¨é‡Šå³æ–‡æ¡£"></a>6.5 æ³¨é‡Šå³æ–‡æ¡£</h3><p><strong>å¿…è¦å’Œé€‚é‡çš„æ³¨é‡Šå¯¹é˜…è¯»æºä»£ç çš„äººæ¥è¯´å°±æ˜¯ä¸€ä¸ªè·¯ç‰Œ, å¯ä»¥å°‘èµ°å¾ˆå¤šå¼¯è·¯</strong>.</p><p>å…³äºæ³¨é‡Šçš„ä¸€äº›å‡†åˆ™ï¼Œ<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E7%BC%96%E7%A8%8B%E8%A7%84%E7%BA%A6/%E6%B3%A8%E9%87%8A%E8%A7%84%E7%BA%A6.md" target="_blank" rel="noopener">&lt;é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ&gt;</a>æ€»ç»“å¾—éå¸¸å¥½, æ¨èåŸºäºè¿™ä¸ªæ¥å»ºç«‹æ³¨é‡Šè§„èŒƒã€‚å¦å¤–é€šè¿‡ESlintæ˜¯å¯ä»¥å¯¹æ³¨é‡Šè¿›è¡Œä¸€å®šç¨‹åº¦çš„è§„èŒƒã€‚</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-6-ä»£ç å³æ–‡æ¡£"><a href="#6-6-ä»£ç å³æ–‡æ¡£" class="headerlink" title="6.6 ä»£ç å³æ–‡æ¡£"></a>6.6 ä»£ç å³æ–‡æ¡£</h3><p>ç°åœ¨æœ‰å¾ˆå¤šç§å·¥å…·æ”¯æŒä»ä»£ç ä¸­è§£æå’Œç”Ÿæˆæ–‡æ¡£, è¿™å¯ä»¥ç»™å¼€å‘è€…ç®€åŒ–å¾ˆå¤šæ–‡æ¡£ç»´æŠ¤çš„å·¥ä½œã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¿®æ”¹äº†ä»£ç ï¼Œä½†æ˜¯æ–‡æ¡£å¿˜è®°åŒæ­¥çš„æƒ…å†µã€‚é€šè¿‡â€˜ä»£ç å³æ–‡æ¡£â€™çš„æ–¹å¼è‡³å°‘å¯ä»¥<strong>ä¿æŒæ–‡æ¡£å’Œä»£ç åŒæ­¥æ›´æ–°</strong>ï¼›å¦å¤–<strong>å¾ˆå¤šå·¥å…·ä¼šåˆ†æä»£ç çš„æ•°æ®ç±»å‹</strong>ï¼Œè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆå‚æ•°å’Œè¿”å›å€¼å®šä¹‰ï¼Œè¿™ä¹Ÿå¯ä»¥å‡å°‘å¾ˆå¤šæ–‡æ¡£ç¼–å†™å·¥ä½œä»¥åŠå‡ºé”™ç‡ã€‚</p><p>æ¯”å¦‚å¯ä»¥é€šè¿‡ä¸‹é¢æ³¨é‡Šæ–¹å¼æ¥ç”Ÿæˆç»„ä»¶æ–‡æ¡£:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Propsæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> interface ColumnProps extends React.HTMLAttributes&lt;any&gt; &#123;</span><br><span class="line">  <span class="comment">/** prop1 description */</span></span><br><span class="line">  prop1?: string;</span><br><span class="line">  <span class="comment">/** prop2 description */</span></span><br><span class="line">  prop2: number;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * prop3 description</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  prop3: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">/** prop4 description */</span></span><br><span class="line">  prop4: <span class="string">'option1'</span> | <span class="string">'option2'</span> | <span class="string">'option3'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹ç»„ä»¶è¿›è¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Column</span> <span class="keyword">extends</span> <span class="title">Component</span>&lt;<span class="title">ColumnProps</span>, </span>&#123;&#125;&gt; &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Column<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç›¸å…³çš„å·¥å…·æœ‰:</p><ul><li>APIæ–‡æ¡£<ul><li>Typescript<ul><li><a href="https://github.com/microsoft/tsdoc" target="_blank" rel="noopener">tsdoc</a> Typescriptå®˜æ–¹çš„æ³¨é‡Šæ–‡æ¡£æ ‡å‡†</li><li><a href="https://github.com/TypeStrong/typedoc" target="_blank" rel="noopener">typedoc</a> åŸºäºtsdocæ ‡å‡†çš„æ–‡æ¡£ç”Ÿæˆå™¨</li></ul></li><li>Javascript<ul><li><a href="https://github.com/jsdoc/jsdoc" target="_blank" rel="noopener">jsdoc</a> Javascriptæ–‡æ¡£æ³¨é‡Šæ ‡å‡†å’Œç”Ÿæˆå™¨</li></ul></li></ul></li><li>åç«¯æ¥å£æ–‡æ¡£<ul><li><a href="https://swagger.io" target="_blank" rel="noopener">Swagger</a> Restfulæ¥å£æ–‡æ¡£è§„èŒƒ</li><li>GraphQL: è¿™ä¸ªæœ‰å¾ˆå¤šå·¥å…·ï¼Œä¾‹å¦‚<a href="https://github.com/graphql/graphiql" target="_blank" rel="noopener">graphiql</a>, é›†æˆäº†Playgroundå’Œæ–‡æ¡£ï¼Œå¾ˆå…ˆè¿›</li><li><a href="https://easy-mock.com/login" target="_blank" rel="noopener">Easy Mock</a> ä¸€ä¸ªå¯è§†åŒ–ï¼Œå¹¶ä¸”èƒ½å¿«é€Ÿç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®çš„æœåŠ¡</li></ul></li><li>ç»„ä»¶æ–‡æ¡£<ul><li><a href="https://storybook.js.org" target="_blank" rel="noopener">StoryBook</a> é€šç”¨çš„ç»„ä»¶å¼€å‘ã€æµ‹è¯•ã€æ–‡æ¡£å·¥å…·</li><li>React<ul><li><a href="http://docz.site" target="_blank" rel="noopener">Docz</a></li><li><a href="https://github.com/styleguidist/react-styleguidist" target="_blank" rel="noopener">Styleguidist</a></li></ul></li><li>Vue<ul><li><a href="https://github.com/vue-styleguidist/vue-styleguidist" target="_blank" rel="noopener">vue-styleguidist</a></li><li>æœ‰æ›´å¥½çš„å·¥å…·è¯·è¯„è®ºå‘Šè¯‰æˆ‘</li></ul></li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="7-uiè®¾è®¡è§„èŒƒ"><a href="#7-uiè®¾è®¡è§„èŒƒ" class="headerlink" title="7 UIè®¾è®¡è§„èŒƒ"></a>7 UIè®¾è®¡è§„èŒƒ</h2><p><img src="/images/frontend-standard/ui-design.png" alt></p><p>è¿™æ˜¯ä¸€ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„è§„èŒƒç±»å‹ã€‚ç¬”è€…å°±æ·±å—å…¶è‹¦ï¼Œæˆ‘ä»¬å…¬å¸åˆæœŸUIå¹¶ä¸ä¸“ä¸šï¼Œæ²¡æœ‰æ‰€è°“çš„è®¾è®¡è§„èŒƒï¼Œè¿™å°±å¯¼è‡´ä»–ä»¬è®¾è®¡å‡ºæ¥çš„äº§å“éƒ½æ˜¯ä¸œå€Ÿè¥¿å‡‘ï¼Œå‰åä¸ç»Ÿä¸€ï¼Œå¤šä¸ªåº”ç”¨ä¹‹é—´çš„ç»„ä»¶ä¸èƒ½å¤ç”¨ã€‚è¿™æå¾—æˆ‘ä»¬ä¸å¾—ä¸æµªè´¹æ—¶é—´ï¼Œå†™å¾ˆå¤šå®šåˆ¶åŒ–æ ·å¼å’Œç»„ä»¶ï¼Œä¸ºä»–ä»¬çš„ä¸ä¸“ä¸šä¹°å•.</p><p>å…³äºUIè®¾è®¡è§„èŒƒçš„é‡è¦æ€§æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5b766ac56fb9a009aa154c27" target="_blank" rel="noopener">&lt;å¼€å‘å’Œè®¾è®¡æ²Ÿé€šæœ‰å¤šéš¾ï¼Ÿ - ä½ åªå·®ä¸€ä¸ªè®¾è®¡è§„èŒƒ&gt;</a>. </p><p>ç®€å•æ€»ç»“ä¸€ä¸‹UIè®¾è®¡è§„èŒƒçš„æ„ä¹‰ï¼š</p><ul><li>æä¾›å›¢é˜Ÿåä½œæ•ˆç‡(äº§å“å’Œå¼€å‘)</li><li>æé«˜ç»„ä»¶çš„å¤ç”¨ç‡. ç»Ÿä¸€çš„ç»„ä»¶è§„èŒƒå¯ä»¥è®©ç»„ä»¶æ›´å¥½ç®¡ç†</li><li>ä¿æŒäº§å“è¿­ä»£è¿‡ç¨‹ä¸­å“ç‰Œä¸€è‡´æ€§</li></ul><p>å»ºç«‹ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„è®¾è®¡è§„èŒƒéœ€è¦<code>UIè®¾è®¡å’Œå¼€å‘</code>çš„ç´§å¯†é…åˆï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç”±æˆ‘ä»¬å‰ç«¯æ¥æ¨åŠ¨ã€‚</p><p>æ¯”å¦‚å¾ˆå¤šå¼€æºçš„UIæ¡†æ¶ï¼Œä¸€å¼€å§‹éƒ½æ˜¯å¼€å‘è€…YYå‡ºæ¥çš„ï¼Œå¹¶æ²¡æœ‰è®¾è®¡å‚ä¸ï¼Œåæ¥ç»„ä»¶åº“æ…¢æ…¢æ²‰æ·€æˆå‹ï¼ŒUIè®¾è®¡å¸ˆæ‰ä»‹å…¥è§„èŒƒä¸€ä¸‹ã€‚</p><p>å¦‚æœä½ ä»¬å›¢é˜Ÿä¸æ‰“ç®—åˆ¶å®šè‡ªå·±çš„UIè®¾è®¡è§„èŒƒï¼Œåˆ™æ¨èä½¿ç”¨ç°æˆçš„å¼€æºç»„ä»¶åº“ï¼š</p><ul><li><a href="https://ant.design/index-cn" target="_blank" rel="noopener">Ant Design</a></li><li><a href="https://material-ui.com" target="_blank" rel="noopener">Material-UI</a></li><li><a href="https://element.eleme.io" target="_blank" rel="noopener">Element UI</a></li><li><a href="https://weui.io" target="_blank" rel="noopener">WeUI</a></li><li><a href="https://developer.microsoft.com/en-us/fabric#/" target="_blank" rel="noopener">Microsoft Fabric</a></li></ul><p>è¿™äº›å¼€æºç»„ä»¶åº“éƒ½ç»è¿‡è‰¯å¥½çš„è®¾è®¡å’Œæ²‰æ·€, è€Œä¸”é…å¥—äº†å®Œå–„çš„è®¾è®¡åŸåˆ™ã€æœ€ä½³å®è·µå’Œè®¾è®¡èµ„æºæ–‡ä»¶ï¼ˆSketch å’Œ Axureï¼‰ï¼Œå¯ä»¥å¸®åŠ©ä¸šåŠ¡å¿«é€Ÿè®¾è®¡å‡ºé«˜è´¨é‡çš„äº§å“åŸå‹ã€‚</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="8-æµ‹è¯•è§„èŒƒ"><a href="#8-æµ‹è¯•è§„èŒƒ" class="headerlink" title="8 æµ‹è¯•è§„èŒƒ"></a>8 æµ‹è¯•è§„èŒƒ</h2><p>æµ‹è¯•æ˜¯ä¿éšœä»£ç è´¨é‡çš„é‡è¦æ‰‹æ®µï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººæ„¿æ„åœ¨è¿™é‡ŒèŠ±å¤ªå¤šæ—¶é—´ã€‚</p><p>æ¯”å¦‚ç¬”è€…ï¼Œæˆ‘å¾ˆå°‘ä¼šå»ç»™ä¸šåŠ¡ä»£ç å’Œç»„ä»¶å†™å•å…ƒæµ‹è¯•ï¼Œé™¤éè‡ªå·±å¯¹ä»£ç éå¸¸æ²¡æœ‰ä¿¡å¿ƒï¼ŒæŒ‰ç…§æˆ‘çš„ç†å¿µå†™æµ‹è¯•ä¸å¦‚å°†ä»£ç å†™å¾—æ›´ç®€å•ä¸€ç‚¹ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªå‡½æ•°æ‹†åˆ†ä¸ºæ›´å°çš„å‡½æ•°ï¼Œä¿æŒå•ä¸€èŒè´£ã€‚</p><p>ä½†æ˜¯<strong>å¯¹äºä¸€äº›åº•å±‚ã€å…±äº«çš„ä»£ç æ¨¡å—è¿˜æ˜¯æœ‰æµ‹è¯•çš„å¿…è¦çš„</strong>ã€‚</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5d2c515d6fb9a07ead5a2bbe" target="_blank" rel="noopener">ä¸çŸ¥é“æµ‹è¯•ä»€ä¹ˆï¼Ÿè¿™äº›æ˜¯ä½ éœ€è¦çŸ¥é“çš„è½¯ä»¶æµ‹è¯•ç±»å‹å’Œå¸¸è¯†</a>æ–‡ç« ä¸­ï¼Œåˆ—ä¸¾äº†ä¸€äº›å¼€å‘è€…éœ€è¦å…³æ³¨çš„æµ‹è¯•ç±»å‹å’Œå¸¸è¯†, å¦‚æœæŒ‰ç…§æµ‹è¯•çš„é˜¶æ®µè¿›è¡Œåˆ†ç±»ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å­çš„:</p><p><img src="/images/frontend-standard/testing.png" alt></p><p><br></p><p>å…¶ä¸­å‰ç«¯å¼€å‘è€…éœ€è¦å…³æ³¨çš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æµ‹è¯•ç±»å‹:</p><ul><li><strong>å•å…ƒæµ‹è¯•</strong>: å¯¹ç‹¬ç«‹çš„è½¯ä»¶æ¨¡å—è¿›è¡Œæµ‹è¯•<ul><li><strong>UIç»„ä»¶æµ‹è¯•</strong>: åŒ…æ‹¬äº†å¿«ç…§(Snapshot)æµ‹è¯•</li></ul></li><li><strong>é›†æˆæµ‹è¯•</strong>: åœ¨å•å…ƒæµ‹è¯•çš„åŸºç¡€ä¸Šï¼Œå°†æ¨¡å—ç»„åˆèµ·æ¥ï¼Œæµ‹è¯•å®ƒä»¬çš„ç»„åˆæ€§</li><li><strong>E2Eæµ‹è¯•</strong>: åœ¨å®Œæ•´ã€çœŸå®çš„è¿è¡Œç¯å¢ƒä¸‹æ¨¡æ‹ŸçœŸå®ç”¨æˆ·å¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ã€‚<strong>ä¸»è¦æµ‹è¯•å‰ç«¯å’Œåç«¯çš„åè°ƒæ€§</strong></li><li><strong>å…¼å®¹æ€§æµ‹è¯•</strong>: ä¸Šé¢æåˆ°äº†æµè§ˆå™¨å…¼å®¹è§„èŒƒï¼Œåœ¨å°†ç‰ˆæœ¬æäº¤ç»™æµ‹è¯•/å‘å¸ƒä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿èƒ½ç¬¦åˆå…¼å®¹æ€§è¦æ±‚</li><li><strong>æ€§èƒ½æµ‹è¯•</strong>: æµ‹è¯•å’Œåˆ†ææ˜¯å¦å­˜åœ¨æ€§èƒ½é—®é¢˜</li><li><strong>å…¶ä»–</strong>:<ul><li>å®‰å…¨æµ‹è¯•</li><li>SEOæµ‹è¯•</li></ul></li></ul><p>å› ä¸ºå¯¹äºå°å…¬å¸æ¥è¯´æ•´ä¸ªè½¯ä»¶å¼€å‘æµç¨‹å¯èƒ½æ²¡æœ‰é‚£ä¹ˆè§„èŒƒï¼Œæ¯”å¦‚å¾ˆéš¾æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç«¯å¯¹ç«¯æµ‹è¯•ç¯å¢ƒï¼Œè¿™äº›éƒ½ä¸æ˜¯å‰ç«¯å›¢é˜Ÿå¯ä»¥æ“ä½œçš„èŒƒå›´, æ‰€ä»¥è‡ªåŠ¨åŒ–æµ‹è¯•å¾ˆéš¾æ¨è¡Œã€‚ä½†æ˜¯å¯ä»¥æ ¹æ®å›¢é˜Ÿå’Œä¸šåŠ¡æƒ…å†µé€æ­¥è¿›è¡Œå¼€å±•ã€‚</p><p>å¯å®æ–½æ€§æ¯”è¾ƒé«˜çš„, ä¹Ÿæ¯”è¾ƒç®€å•æ˜¯å•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿé‡ç‚¹å…³æ³¨å•å…ƒæµ‹è¯•.</p><p><br></p><h3 id="8-1-æµ‹è¯•çš„æµç¨‹"><a href="#8-1-æµ‹è¯•çš„æµç¨‹" class="headerlink" title="8.1 æµ‹è¯•çš„æµç¨‹"></a>8.1 æµ‹è¯•çš„æµç¨‹</h3><p>é¦–å…ˆè¦å®šä¹‰ä¸€ä¸ªåˆé€‚çš„è½¯ä»¶æµ‹è¯•æµç¨‹, åˆé€‚çš„æµ‹è¯•æµç¨‹å¯ä»¥é™ä½å¼€å‘å’Œæµ‹è¯•å›¢é˜Ÿä¹‹é—´çš„æ²Ÿé€šåä½œæˆæœ¬ã€æé«˜æµ‹è¯•æ•ˆç‡ã€‚ä¾‹å¦‚æˆ‘ä»¬å›¢é˜Ÿç›®å‰çš„æµ‹è¯•æµç¨‹:</p><p><img src="/images/frontend-standard/test-proc.png" alt></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="8-2-å•å…ƒæµ‹è¯•"><a href="#8-2-å•å…ƒæµ‹è¯•" class="headerlink" title="8.2 å•å…ƒæµ‹è¯•"></a>8.2 å•å…ƒæµ‹è¯•</h3><p>å•å…ƒæµ‹è¯•æœ‰å¾ˆå¤š<strong>å¥½å¤„</strong>, æ¯”å¦‚:</p><ul><li><strong>æé«˜ä¿¡å¿ƒï¼Œé€‚åº”å˜åŒ–å’Œè¿­ä»£</strong>. å¦‚æœç°æœ‰ä»£ç æœ‰è¾ƒä¸ºå®Œå–„çš„å•å…ƒæµ‹è¯•ï¼Œåœ¨ä»£ç é‡æ„æ—¶ï¼Œå¯ä»¥æ£€éªŒæ¨¡å—æ˜¯å¦ä¾ç„¶å¯ä»¥å·¥ä½œ, ä¸€æ—¦å˜æ›´å¯¼è‡´é”™è¯¯ï¼Œå•å…ƒæµ‹è¯•ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½å¹¶ä¿®å¤é”™è¯¯</li><li><strong>å•å…ƒæµ‹è¯•æ˜¯é›†æˆæµ‹è¯•çš„åŸºç¡€</strong></li><li><strong>æµ‹è¯•å³æ–‡æ¡£</strong>ã€‚å¦‚æœæ–‡æ¡£ä¸èƒ½è§£å†³ä½ çš„é—®é¢˜ï¼Œåœ¨ä½ æ‰“ç®—çœ‹æºç ä¹‹å‰ï¼Œå¯ä»¥æŸ¥çœ‹å•å…ƒæµ‹è¯•ã€‚é€šè¿‡è¿™äº›æµ‹è¯•ç”¨ä¾‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç›´è§‚åœ°ç†è§£ç¨‹åºå•å…ƒçš„åŸºç¡€API</li><li><strong>æå‡ä»£ç è´¨é‡ã€‚æ˜“äºæµ‹è¯•çš„ä»£ç ï¼Œä¸€èˆ¬éƒ½æ˜¯å¥½ä»£ç </strong></li></ul><p><br></p><p><strong>æµ‹ä»€ä¹ˆ?</strong></p><p>ä¸šåŠ¡ä»£ç æˆ–ä¸šåŠ¡ç»„ä»¶æ˜¯æ¯”è¾ƒéš¾ä»¥å®æ–½å•å…ƒæµ‹è¯•çš„ï¼Œä¸€æ–¹é¢å®ƒä»¬æ¯”è¾ƒå¤šå˜ã€å¦ä¸€æ–¹é¢å¾ˆå¤šå›¢é˜Ÿå¾ˆå°‘æœ‰ç²¾åŠ›ç»´æŠ¤è¿™éƒ¨åˆ†å•å…ƒæµ‹è¯•ã€‚æ‰€ä»¥<strong>é€šå¸¸åªè¦æ±‚å¯¹ä¸€äº›åŸºç¡€/åº•å±‚çš„ç»„ä»¶ã€æ¡†æ¶æˆ–è€…æœåŠ¡è¿›è¡Œæµ‹è¯•, è§†æƒ…å†µè€ƒè™‘æ˜¯å¦è¦æµ‹è¯•ä¸šåŠ¡ä»£ç </strong></p><p><br></p><p><strong>æµ‹è¯•çš„å‡†åˆ™</strong>:</p><ul><li>æ¨èPetrowareçš„<a href="https://petroware.no/unittesting.html" target="_blank" rel="noopener">Unit Testing Guidelines</a>, æ€»ç»“äº†27æ¡å•å…ƒæµ‹è¯•å‡†åˆ™ï¼Œéå¸¸å—ç”¨.</li><li>å¦å¤–&lt;é˜¿é‡Œå·´å·´çš„Javaå¼€å‘æ‰‹å†Œ&gt;ä¸­æ€»ç»“çš„<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.md" target="_blank" rel="noopener">å•å…ƒæµ‹è¯•å‡†åˆ™</a>, ä¹Ÿä¸é”™ï¼Œè™½ç„¶ä¹¦åæ˜¯Javaï¼Œå‡†åˆ™æ˜¯é€šç”¨çš„.</li></ul><p><br></p><p><strong>å•å…ƒæµ‹è¯•æŒ‡æ ‡</strong>:</p><p>ä¸€èˆ¬ä½¿ç”¨<a href="https://zh.wikipedia.org/wiki/ä»£ç¢¼è¦†è“‹ç‡" target="_blank" rel="noopener"><code>æµ‹è¯•è¦†ç›–ç‡</code></a>æ¥é‡åŒ–ï¼Œå°½ç®¡å¯¹äºè¦†ç›–ç‡èƒ½ä¸èƒ½è¡¡é‡å•å…ƒæµ‹è¯•çš„æœ‰æ•ˆæ€§å­˜åœ¨è¾ƒå¤šäº‰è®®ã€‚</p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿˜æ˜¯æ¨èå°½å¯èƒ½æé«˜è¦†ç›–ç‡, æ¯”å¦‚è¦æ±‚<code>è¯­å¥è¦†ç›–ç‡è¾¾åˆ°70%ï¼›æ ¸å¿ƒæ¨¡å—çš„è¯­å¥è¦†ç›–ç‡å’Œåˆ†æ”¯è¦†ç›–ç‡éƒ½è¦è¾¾åˆ°100%</code>. è§†å›¢é˜Ÿæƒ…å†µè€Œå®š</p><p>æ‰©å±•:</p><ul><li><a href="https://www.infoq.cn/article/test-coverage-rate-role" target="_blank" rel="noopener">æµ‹è¯•è¦†ç›–ï¼ˆç‡ï¼‰åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></li></ul><p><br></p><p><strong>ç›¸å…³å·¥å…·</strong></p><ul><li>Headless Browsers: æ— å¤´æµè§ˆå™¨æ˜¯ç½‘é¡µè‡ªåŠ¨åŒ–çš„é‡è¦è¿è¡Œç¯å¢ƒã€‚ å¸¸ç”¨äºåŠŸèƒ½æµ‹è¯•ã€å•å…ƒæµ‹è¯•ã€ç½‘ç»œçˆ¬è™«<ul><li><a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">puppeteer</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/lkgr/headless/README.md" target="_blank" rel="noopener">Headless Chromium</a></li></ul></li><li>æµ‹è¯•æ¡†æ¶<ul><li><a href="http://jest.io/" target="_blank" rel="noopener">Jest</a> ğŸ”¥Facebookçš„å•å…ƒæµ‹è¯•æ¡†æ¶. é›¶é…ç½®, æ”¯æŒç»„ä»¶å¿«ç…§æµ‹è¯•ã€æ¨¡å—Mockã€Spy. ä¸€èˆ¬åœºæ™¯, å•å…ƒæµ‹è¯•å­¦å®ƒä¸€ä¸ªå°±è¡Œäº†<ul><li>ç»„ä»¶æµ‹è¯•<ul><li><a href="https://github.com/testing-library" target="_blank" rel="noopener">testing-library</a> ğŸ”¥</li><li><a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener">Enzyme</a></li></ul></li></ul></li><li><a href="https://theintern.github.io/" target="_blank" rel="noopener">Intern</a></li></ul></li><li>å•å…ƒæµ‹è¯•<ul><li><a href="https://github.com/avajs/ava" target="_blank" rel="noopener">AVA</a></li><li><a href="http://jasmine.github.io/" target="_blank" rel="noopener">Jasmine</a></li><li><a href="http://mochajs.org/" target="_blank" rel="noopener">Mocha</a></li><li><a href="https://github.com/substack/tape" target="_blank" rel="noopener">Tape</a></li></ul></li><li>æ–­è¨€åº“<ul><li><a href="http://chaijs.com/" target="_blank" rel="noopener">Chai</a></li><li><a href="https://github.com/Automattic/expect.js" target="_blank" rel="noopener">expect.js</a></li><li><a href="http://shouldjs.github.io/" target="_blank" rel="noopener">should.js</a></li></ul></li><li>Mock/Stubs/Spies<ul><li><a href="http://sinonjs.org/" target="_blank" rel="noopener">sinon.js</a></li></ul></li><li>ä»£ç è¦†ç›–ç‡<ul><li><a href="https://github.com/gotwarlost/istanbul" target="_blank" rel="noopener">istanbul</a></li></ul></li><li>åŸºå‡†æµ‹è¯•<ul><li><a href="http://benchmarkjs.com/" target="_blank" rel="noopener">benchmark.js</a></li><li><a href="https://jsperf.com/" target="_blank" rel="noopener">jsperf.com</a></li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="9-å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ"><a href="#9-å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ" class="headerlink" title="9 å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ"></a>9 å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ</h2><p>å¾ˆå¤šå¼€å‘è€…å¸¸å¸¸è¯¯ç”¨æˆ–è€…è½»è§†å¼‚å¸¸çš„å¤„ç†, åˆç†æœ‰æ•ˆçš„å¼‚å¸¸å¤„ç†å¯ä»¥æé«˜åº”ç”¨çš„å¥å£®æ€§å’Œå¯ç”¨æ€§ï¼Œå¦å¤–è¿˜å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å¼‚å¸¸.</p><h3 id="9-1-å¼‚å¸¸å¤„ç†"><a href="#9-1-å¼‚å¸¸å¤„ç†" class="headerlink" title="9.1 å¼‚å¸¸å¤„ç†"></a>9.1 å¼‚å¸¸å¤„ç†</h3><p>&lt;é˜¿é‡Œå·´å·´çš„Javaå¼€å‘æ‰‹å†Œ&gt;ä¸­æ€»ç»“çš„<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.md" target="_blank" rel="noopener">å¼‚å¸¸å¤„ç†è§„èŒƒ</a>å¯¹JavaScriptçš„å¼‚å¸¸å¤„ç†ä¹Ÿå¾ˆæœ‰å‚è€ƒæ„ä¹‰ï¼Œæ¯”å¦‚:</p><ul><li>å¼‚å¸¸ä¸è¦ç”¨æ¥åšæµç¨‹æ§åˆ¶ï¼Œæ¡ä»¶æ§åˆ¶ã€‚</li><li>æ•è·å¼‚å¸¸æ˜¯ä¸ºäº†å¤„ç†å®ƒï¼Œä¸è¦æ•è·äº†å´ä»€ä¹ˆéƒ½ä¸å¤„ç†è€ŒæŠ›å¼ƒä¹‹ï¼Œå¦‚æœä¸æƒ³å¤„ç†å®ƒï¼Œè¯·å°†è¯¥å¼‚å¸¸æŠ›ç»™å®ƒçš„è°ƒç”¨è€…ã€‚æœ€å¤–å±‚çš„ä¸šåŠ¡ä½¿ç”¨è€…ï¼Œå¿…é¡»å¤„ç†å¼‚å¸¸ï¼Œå°†å…¶è½¬åŒ–ä¸ºç”¨æˆ·å¯ä»¥ç†è§£çš„å†…å®¹ã€‚</li><li>catchæ—¶è¯·åˆ†æ¸…ç¨³å®šä»£ç å’Œéç¨³å®šä»£ç ï¼Œç¨³å®šä»£ç æŒ‡çš„æ˜¯æ— è®ºå¦‚ä½•ä¸ä¼šå‡ºé”™çš„ä»£ç ã€‚å¯¹äºéç¨³å®šä»£ç çš„catchå°½å¯èƒ½è¿›è¡ŒåŒºåˆ†å¼‚å¸¸ç±»å‹ï¼Œå†åšå¯¹åº”çš„å¼‚å¸¸å¤„ç†ã€‚ä¸è¦å¯¹å¤§æ®µä»£ç è¿›è¡Œtry-catch</li><li>â€¦</li></ul><p>ç„¶åå†æ ¹æ®JavaScriptæœ¬èº«çš„å¼‚å¸¸å¤„ç†ç‰¹ç‚¹æ€»ç»“ä¸€äº›è§„èŒƒè¡Œä¸º, ä¾‹å¦‚:</p><ul><li>ä¸è¦throwéErrorå¯¹è±¡</li><li>ä¸è¦å¿½ç•¥å¼‚æ­¥å¼‚å¸¸</li><li>å…¨å±€ç›‘æ§Javascriptå¼‚å¸¸</li><li>â€¦</li></ul><p><br></p><p>èµ„æº:</p><ul><li><a href="https://rollbar.com/blog/top-10-javascript-errors/" target="_blank" rel="noopener">ä»1000+ä¸ªé¡¹ç›®ä¸­æ€»ç»“å‡ºæ¥çš„å‰10ä¸ªJavaScripté”™è¯¯, ä»¥åŠå¦‚ä½•é¿å…å®ƒä»¬</a></li><li><a href="https://levelup.gitconnected.com/the-definite-guide-to-handling-errors-gracefully-in-javascript-58424d9c60e6" target="_blank" rel="noopener">Javascriptå¼‚å¸¸å¤„ç†â€˜æƒå¨â€™æŒ‡å—</a></li><li><a href="https://zhuanlan.zhihu.com/p/63698500" target="_blank" rel="noopener">å‰ç«¯å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="9-2-æ—¥å¿—"><a href="#9-2-æ—¥å¿—" class="headerlink" title="9.2 æ—¥å¿—"></a>9.2 æ—¥å¿—</h3><p>å¯¹äºå‰ç«¯æ¥è¯´ï¼Œæ—¥å¿—ä¹Ÿä¸æ˜¯æ¯«æ— æ„ä¹‰(å¾ˆå¤šæ¡†æ¶æ€§èƒ½ä¼˜åŒ–å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒç§»é™¤console)ã€‚å°¤å…¶æ˜¯åœ¨<strong>ç”Ÿäº§ç°åœº</strong>è°ƒè¯•ä»£ç æ—¶ï¼Œè¿™æ—¶å€™å¯è´µçš„æ§åˆ¶å°æ—¥å¿—å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°å¼‚å¸¸çš„çº¿ç´¢.</p><p>ä¸è¿‡é€šå¸¸æˆ‘ä»¬<strong>åªè¦ä¿ç•™å¿…è¦çš„ã€æœ‰æ„ä¹‰çš„æ—¥å¿—è¾“å‡º</strong>ï¼Œæ¯”å¦‚ä½ ä¸åº”è¯¥å°†console.logæ”¾åˆ°ä¸€ä¸ªReactæ¸²æŸ“å‡½æ•°ä¸­ã€æˆ–è€…æ”¾åˆ°ä¸€ä¸ªå¾ªç¯ä¸­, <strong>DDoså¼çš„æ—¥å¿—ä¿¡æ¯å¹¶ä¸èƒ½å¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜ï¼Œåè€Œä¼šå½±å“è¿è¡Œçš„æ€§èƒ½</strong>. æ‰€ä»¥éœ€è¦ä¸€ä¸ªè§„èŒƒæ¥çº¦æŸæ—¥å¿—è¾“å‡ºè¡Œä¸º, æ¯”å¦‚:</p><ul><li>é¿å…é‡å¤æ‰“å°æ—¥å¿—</li><li>è°¨æ…åœ°è®°å½•æ—¥å¿—, åˆ’åˆ†æ—¥å¿—çº§åˆ«ã€‚æ¯”å¦‚ç”Ÿäº§ç¯å¢ƒç¦æ­¢è¾“å‡ºdebugæ—¥å¿—ï¼›æœ‰é€‰æ‹©åœ°è¾“å‡ºinfoæ—¥å¿—ï¼›</li><li>ä½¿ç”¨å‰ç¼€å¯¹æ—¥å¿—è¿›è¡Œåˆ†ç±», ä¾‹å¦‚: <code>[User] xxxx</code></li><li>åªè®°å½•å…³é”®ä¿¡æ¯, è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©ä½ è¯Šæ–­é—®é¢˜</li><li>â€¦</li></ul><p>æ‰©å±•èµ„æº</p><ul><li><a href="https://github.com/visionmedia/debug" target="_blank" rel="noopener">debug</a> é€‚åˆNode.jså’Œæµè§ˆå™¨çš„debugæ—¥å¿—å·¥å…·, æ”¯æŒåŠ¨æ€å¼€å¯æ—¥å¿—æ‰“å°</li><li><a href="https://github.com/Tencent/vConsole" target="_blank" rel="noopener">vConsole</a> ç§»åŠ¨ç«¯è°ƒè¯•åˆ©å™¨</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="9-3-å¼‚å¸¸ç›‘æ§"><a href="#9-3-å¼‚å¸¸ç›‘æ§" class="headerlink" title="9.3 å¼‚å¸¸ç›‘æ§"></a>9.3 å¼‚å¸¸ç›‘æ§</h3><p>å› ä¸ºç¨‹åºè·‘åœ¨ä¸å—æ§çš„ç¯å¢ƒï¼Œæ‰€ä»¥å¯¹äºå®¢æˆ·ç«¯åº”ç”¨æ¥è¯´ï¼Œå¼‚å¸¸ç›‘æ§åœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥æ”¶é›†å„ç§æ„æ–™ä¹‹å¤–ç”Ÿäº§ç¯å¢ƒé—®é¢˜ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å¼‚å¸¸ã€‚</p><p><br></p><p>å¼‚å¸¸ç›‘æ§é€šå¸¸ä¼šé€šè¿‡ä¸‰ç§æ–¹å¼æ¥æ”¶é›†å¼‚å¸¸æ•°æ®:</p><ol><li>å…¨å±€æ•è·ã€‚ä¾‹å¦‚ä½¿ç”¨window.onerror, æˆ–è€…<code>unhandledrejection</code></li><li>ä¸»åŠ¨ä¸ŠæŠ¥ã€‚åœ¨try/catchä¸­ä¸»åŠ¨ä¸ŠæŠ¥. </li><li>ç”¨æˆ·åé¦ˆã€‚æ¯”å¦‚å¼¹çª—è®©ç”¨æˆ·å¡«å†™åé¦ˆä¿¡æ¯.</li></ol><p>å’Œæ—¥å¿—ä¸€æ ·ï¼Œ<strong>ä¸æ˜¯æ‰€æœ‰â€˜å¼‚å¸¸â€™éƒ½åº”è¯¥ä¸ŠæŠ¥ç»™å¼‚å¸¸ç›‘æ§ç³»ç»Ÿï¼Œè­¬å¦‚ä¸€äº›é¢„æ–™ä¹‹å†…çš„â€˜å¼‚å¸¸â€™</strong>ï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥é”™è¯¯ã€é‰´æƒå¤±è´¥ã€ç½‘ç»œé”™è¯¯ç­‰ç­‰. <strong>å¼‚å¸¸ç›‘æ§ä¸»è¦ç”¨æ¥ä¸ŠæŠ¥ä¸€äº›æ„æ–™ä¹‹å¤–çš„ã€æˆ–è€…è‡´å‘½æ€§çš„å¼‚å¸¸</strong>.</p><p><br></p><p>è¦åšå¥½å‰ç«¯çš„å¼‚å¸¸ç›‘æ§å…¶å®å¹¶ä¸å®¹æ˜“ï¼Œå®ƒéœ€è¦å¤„ç†è¿™äº›ä¸œè¥¿:</p><ul><li>æµè§ˆå™¨å…¼å®¹æ€§ã€‚</li><li>ç¢ç‰‡æ”¶é›†(breadcrumbs)ã€‚ æ”¶é›†â€˜ç¾éš¾â€™ç°åœºçš„ä¸€äº›çº¿ç´¢ï¼Œè¿™äº›çº¿ç´¢å¯¹é—®é¢˜è¯Šæ–­å¾ˆé‡è¦ã€‚ä¾‹å¦‚å½“å‰ç”¨æˆ·ä¿¡æ¯ã€ç‰ˆæœ¬ã€è¿è¡Œç¯å¢ƒã€æ‰“å°çš„æ—¥å¿—ã€å‡½æ•°è°ƒç”¨æ ˆç­‰ç­‰</li><li>è°ƒç”¨æ ˆçš„è½¬æ¢ã€‚é€šå¸¸åœ¨æµè§ˆå™¨è¿è¡Œçš„å‹ç¼©ä¼˜åŒ–è¿‡çš„ä»£ç ï¼Œè¿™ç§è°ƒç”¨æ ˆåŸºæœ¬æ²¡ä»€ä¹ˆå¯è¯»æ€§ï¼Œé€šå¸¸éœ€è¦é€šè¿‡SourceMapæ˜ å°„åˆ°åŸå§‹ä»£ç . å¯ä»¥ä½¿ç”¨è¿™ä¸ªåº“: <a href="https://github.com/mozilla/source-map#sourcemapconsumer" target="_blank" rel="noopener">source-map</a></li><li>æ•°æ®çš„èšåˆã€‚åç«¯ç›‘æ§ç³»ç»Ÿéœ€è¦å¯¹å‰ç«¯ä¸ŠæŠ¥çš„ä¿¡æ¯è¿›è¡Œåˆ†æå’Œèšåˆ</li></ul><p><br></p><p>å¯¹äºå°å›¢é˜Ÿæœªå¿…æœ‰èƒ½åŠ›å¼€å‘è¿™ä¸€å¥—ç³»ç»Ÿï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ä¾‹å¦‚</p><ul><li><a href="https://sentry.io/welcome/" target="_blank" rel="noopener">Sentry</a> ğŸ”¥å…è´¹åŸºæœ¬å¤Ÿç”¨</li><li><a href="https://www.fundebug.com/price" target="_blank" rel="noopener">FunDebug</a> ä»˜è´¹å¢å¼º</li></ul><p><strong>æ‰©å±•</strong>:</p><ul><li><a href="https://cdc.tencent.com/2018/09/13/frontend-exception-monitor-research/" target="_blank" rel="noopener">å‰ç«¯å¼‚å¸¸ç›‘æ§è§£å†³æ–¹æ¡ˆç ”ç©¶</a></li><li><a href="https://www.cnblogs.com/warm-stranger/p/9417084.html" target="_blank" rel="noopener">æ­å»ºå‰ç«¯ç›‘æ§ç³»ç»Ÿ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="10-å‰åç«¯åä½œè§„èŒƒ"><a href="#10-å‰åç«¯åä½œè§„èŒƒ" class="headerlink" title="10 å‰åç«¯åä½œè§„èŒƒ"></a>10 å‰åç«¯åä½œè§„èŒƒ</h2><p>å‰ç«¯æ˜¯Webçš„ä¸€ä¸ªç»†åˆ†é¢†åŸŸï¼Œå¾€å¾€ä¸èƒ½è„±ç¦»åç«¯è€Œå­˜åœ¨ã€‚æ‰€ä»¥å’Œåç«¯åä½œçš„æ—¶é—´æ˜¯æœ€é•¿çš„.</p><h3 id="10-1-åä½œæµç¨‹è§„èŒƒ"><a href="#10-1-åä½œæµç¨‹è§„èŒƒ" class="headerlink" title="10.1 åä½œæµç¨‹è§„èŒƒ"></a>10.1 åä½œæµç¨‹è§„èŒƒ</h3><p>å‰åç«¯å›¢é˜Ÿç»è¿‡é•¿æœŸçš„åˆä½œï¼Œä¸€èˆ¬å¯ä»¥æ€»ç»“å‡ºä¸€æ¡å¯¹äºåŒæ–¹å¼€å‘æ•ˆç‡æœ€ä¼˜çš„åä½œæµç¨‹. å°†è¿™ä¸ªè½å®ä¸ºè§„èŒƒï¼Œåé¢çš„å›¢é˜Ÿæˆå‘˜éƒ½éµå¾ªè¿™ä¸ªæ­¥è°ƒè¿›è¡Œåä½œã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„å‰åç«¯åä½œæµç¨‹å¦‚ä¸‹:</p><p><img src="/images/frontend-standard/f-b.png" alt></p><ol><li>éœ€æ±‚åˆ†æã€‚å‚ä¸è€…ä¸€èˆ¬æœ‰å‰åç«¯ã€æµ‹è¯•ã€ä»¥åŠäº§å“. ç”±äº§å“ä¸»æŒï¼Œå¯¹éœ€æ±‚è¿›è¡Œå®£è´¯ï¼Œæ¥å—å¼€å‘å’Œæµ‹è¯•çš„åé¦ˆï¼Œç¡®ä¿å¤§å®¶å¯¹éœ€æ±‚æœ‰ä¸€è‡´çš„è®¤çŸ¥</li><li>å‰åç«¯å¼€å‘è®¨è®ºã€‚è®¨è®ºåº”ç”¨çš„ä¸€äº›å¼€å‘è®¾è®¡ï¼Œæ²Ÿé€šæŠ€æœ¯ç‚¹ã€éš¾ç‚¹ã€ä»¥åŠåˆ†å·¥é—®é¢˜.</li><li>è®¾è®¡æ¥å£æ–‡æ¡£ã€‚å¯ä»¥ç”±å‰åç«¯ä¸€èµ·è®¾è®¡ï¼›æˆ–è€…ç”±åç«¯è®¾è®¡ã€å‰ç«¯ç¡®è®¤æ˜¯å¦ç¬¦åˆè¦æ±‚</li><li>å¹¶è¡Œå¼€å‘ã€‚å‰åç«¯å¹¶è¡Œå¼€å‘ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå‰ç«¯å¯ä»¥å…ˆå®ç°é™æ€é¡µé¢; æˆ–è€…æ ¹æ®æ¥å£æ–‡æ¡£å¯¹æ¥å£è¿›è¡ŒMock, æ¥æ¨¡æ‹Ÿå¯¹æ¥åç«¯æ¥å£</li><li>åœ¨è”è°ƒä¹‹å‰ï¼Œè¦æ±‚åç«¯åšå¥½æ¥å£æµ‹è¯•</li><li>çœŸå®ç¯å¢ƒè”è°ƒã€‚å‰ç«¯å°†æ¥å£è¯·æ±‚ä»£ç†åˆ°åç«¯æœåŠ¡ï¼Œè¿›è¡ŒçœŸå®ç¯å¢ƒè”è°ƒã€‚</li></ol><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="10-2-æ¥å£è§„èŒƒ"><a href="#10-2-æ¥å£è§„èŒƒ" class="headerlink" title="10.2 æ¥å£è§„èŒƒ"></a>10.2 æ¥å£è§„èŒƒ</h3><p>é¦–å…ˆåº”è¯¥ç¡®å®šä¸‹æ¥çš„æ˜¯æ¥å£è§„èŒƒã€‚å…¶å®ä½¿ç”¨å“ªç§æ¥å£æ ‡å‡†æ˜¯å…¶æ¬¡ï¼Œé‡è¦çš„æ˜¯ç»Ÿä¸€ï¼Œä¸”è¦æ»¡è¶³å‰åç«¯çš„å¼€å‘æ•ˆç‡è¦æ±‚.</p><p>ç¬”è€…ä¸å»ºè®®åç«¯å»å®šä¹‰è‡ªå·±çš„æ¥å£æ ‡å‡†ï¼Œè€Œåº”è¯¥å»é€‰æ‹©ä¸€äº›é€šç”¨çš„ã€æœ‰æ ‡å‡†å®šä¹‰æ¥å£å½¢å¼, ä¾‹å¦‚:</p><ul><li><p><a href="https://zh.wikipedia.org/zh-hans/è¡¨ç°å±‚çŠ¶æ€è½¬æ¢" target="_blank" rel="noopener">RESTful</a>: RESTfulæ˜¯ç›®å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„APIè®¾è®¡è§„èŒƒ, åŸºäºHTTPæœ¬èº«çš„æœºåˆ¶æ¥å®ç°. </p><p>ç¬”è€…ä¸ªäººæ˜¯æ¯”è¾ƒå–œæ¬¢è¿™ä¸ªAPIè§„èŒƒï¼Œä½†æ˜¯æˆ‘å‘ç°å¾ˆå¤šå¼€å‘è€…å¹¶ä¸èƒ½çœŸæ­£(æˆ–è€…è¯´æ²¡å¿ƒæ€)ç†è§£å®ƒï¼Œè®¾è®¡å‡ºæ¥çš„æ¥å£ï¼Œè·Ÿæˆ‘æƒ³è±¡çš„ç›¸å·®ç”šè¿œã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºRESTfulï¼Œå¼€å‘è€…ä¹‹é—´å¾ˆéš¾è¾¾æˆä¸€è‡´çš„ç†è§£ï¼Œå®¹æ˜“äº§ç”Ÿåˆ†æ­§ã€‚</p><p>å› ä¸ºæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„APIå½¢å¼ï¼Œæ‰€ä»¥ç¤¾åŒºä¸Šæœ‰å¾ˆå¤šå·¥å…·æ¥å¯¹RESTfulæ¥å£è¿›è¡Œæ–‡æ¡£åŒ–ã€æµ‹è¯•å’Œæ¨¡æ‹Ÿ.</p></li><li><p><a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">JSONRPC</a> è¿™æ˜¯ä¸€ç§éå¸¸ç®€å•ã€å®¹æ˜“ç†è§£çš„æ¥å£è§„èŒƒã€‚ç›¸å¯¹äºRESTfulæˆ‘æ›´æ¨èè¿™ä¸ªï¼Œç®€å•åˆ™ä¸å®¹æ˜“äº§ç”Ÿåˆ†æ­§ï¼Œæ–°æ‰‹ä¹Ÿå¯ä»¥å¾ˆå¿«æ¥å—.</p></li><li><a href="https://graphql.org/learn/" target="_blank" rel="noopener">GraphQL</a> ğŸ”¥æ›´ä¸ºå…ˆè¿›ã€æ›´æœ‰å‰æ™¯çš„APIè§„èŒƒã€‚ä½†æ˜¯ä½ è¦è¯´æœåç«¯é…åˆä½ ä½¿ç”¨è¿™ç§æ ‡å‡†å¯èƒ½å¾ˆæœ‰éš¾åº¦</li></ul><p><br></p><p><strong>æ¥å£è®¾è®¡éœ€è¦æ³¨æ„çš„ç‚¹</strong>:</p><ul><li>æ˜ç¡®åŒºåˆ†æ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸, ä¸¥æ ¼éµå¾ªæ¥å£çš„å¼‚å¸¸åŸè¯­. ä¸Šè¿°æ¥å£å½¢å¼éƒ½æœ‰æ˜ç¡®çš„å¼‚å¸¸åŸè¯­ï¼Œæ¯”å¦‚JSONRPCï¼Œå½“å‡ºç°å¼‚å¸¸æ—¶åº”è¯¥è¿”å›<code>é”™è¯¯å¯¹è±¡</code>å“åº”ï¼Œè€Œä¸æ˜¯åœ¨æ­£å¸¸çš„å“åº”ä½“ä¸­è¿”å›é”™è¯¯ä»£ç . å¦å¤–è¦è§„èŒƒåŒ–çš„é”™è¯¯ç , HTTPå“åº”ç å°±æ˜¯ä¸€ä¸ªä¸é”™çš„å­¦ä¹ å¯¹è±¡</li><li>æ˜ç¡®æ•°æ®ç±»å‹ã€‚å¾ˆå¤šåç«¯å†™çš„æ¥å£éƒ½æ˜¯stringå’Œnumberä¸åˆ†çš„ï¼Œå¦‚æœå¦¥åçš„è¯ã€å‰ç«¯å°±éœ€è¦é’ˆå¯¹è¿™ä¸ªå±æ€§åšç‰¹æ®Šå¤„ç†ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯æ½œåœ¨çš„bug</li><li>æ˜ç¡®ç©ºå€¼çš„æ„ä¹‰ã€‚æ¯”å¦‚åœ¨åšæ›´æ–°æ“ä½œæ˜¯ï¼Œç©ºå€¼æ˜¯è¡¨ç¤ºé‡ç½®ï¼Œè¿˜æ˜¯å¿½ç•¥æ›´æ–°ï¼Ÿ</li><li>å“åº”é¿å…å†—ä½™çš„åµŒå¥—ã€‚</li><li>æ¥å£ç‰ˆæœ¬åŒ–ï¼Œä¿æŒå‘ä¸‹å…¼å®¹ã€‚å°±åƒæˆ‘ä»¬ä¸Šæ–‡çš„â€˜è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒâ€™è¯´çš„ï¼Œå¯¹äºåç«¯æ¥è¯´ï¼ŒAPIå°±æ˜¯å…¬å…±çš„æ¥å£. å…¬å…±æš´éœ²çš„æ¥å£åº”è¯¥æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¥è¯´æ˜å½“å‰æè¿°çš„æ¥å£åšäº†ä»€ä¹ˆå˜åŠ¨ï¼Œæ˜¯å¦å‘ä¸‹å…¼å®¹ã€‚<br>ç°åœ¨å‰ç«¯ä»£ç å¯èƒ½ä¼šåœ¨å®¢æˆ·ç«¯è¢«ç¼“å­˜ï¼Œä¾‹å¦‚å°ç¨‹åºã€‚å¦‚æœåç«¯åšäº†break changeï¼Œå°±ä¼šå½±å“è¿™éƒ¨åˆ†ç”¨æˆ·ã€‚</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="10-3-æ¥å£æ–‡æ¡£è§„èŒƒ"><a href="#10-3-æ¥å£æ–‡æ¡£è§„èŒƒ" class="headerlink" title="10.3 æ¥å£æ–‡æ¡£è§„èŒƒ"></a>10.3 æ¥å£æ–‡æ¡£è§„èŒƒ</h3><p>åç«¯é€šè¿‡æ¥å£æ–‡æ¡£å‘å‰ç«¯æš´éœ²æ¥å£ç›¸å…³çš„ä¿¡æ¯ã€‚é€šå¸¸éœ€è¦åŒ…å«è¿™äº›ä¿¡æ¯ï¼š</p><ul><li>ç‰ˆæœ¬å·</li><li>æ–‡æ¡£æè¿°</li><li>æœåŠ¡çš„å…¥å£. ä¾‹å¦‚åŸºæœ¬è·¯å¾„</li><li>æµ‹è¯•æœåŠ¡å™¨. å¯é€‰</li><li>ç®€å•ä½¿ç”¨ç¤ºä¾‹</li><li>å®‰å…¨å’Œè®¤è¯</li><li>å…·ä½“æ¥å£å®šä¹‰<ul><li>æ–¹æ³•åç§°æˆ–è€…URL</li><li>æ–¹æ³•æè¿°</li><li>è¯·æ±‚å‚æ•°åŠå…¶æè¿°ï¼Œå¿…é¡»è¯´æ˜ç±»å‹(æ•°æ®ç±»å‹ã€æ˜¯å¦å¯é€‰ç­‰)</li><li>å“åº”å‚æ•°åŠå…¶æè¿°, å¿…é¡»è¯´æ˜ç±»å‹(æ•°æ®ç±»å‹ã€æ˜¯å¦å¯é€‰ç­‰)</li><li>å¯èƒ½çš„å¼‚å¸¸æƒ…å†µã€é”™è¯¯ä»£ç ã€ä»¥åŠæè¿°</li><li>è¯·æ±‚ç¤ºä¾‹ï¼Œå¯é€‰</li></ul></li></ul><p><strong>äººå·¥ç»´æŠ¤å¯¼è‡´çš„é—®é¢˜</strong>:</p><p>ä¸Šæ–‡â€˜ä»£ç å³æ–‡æ¡£â€™å°±æåˆ°äº†äººå·¥ç»´æŠ¤æ¥å£æ–‡æ¡£å¯èƒ½å¯¼è‡´ä»£ç å’Œæ–‡æ¡£ä¸åŒæ­¥é—®é¢˜ã€‚</p><p>å¦‚æœå¯ä»¥ä»ä»£ç æˆ–è€…è§„èŒƒæ–‡æ¡£(ä¾‹å¦‚OpenAPIè¿™ç±»APIæè¿°è§„èŒƒ)ä¸­ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œå¯ä»¥è§£å†³å®ç°å’Œæ–‡æ¡£ä¸ä¸€è‡´é—®é¢˜, åŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘æ–‡æ¡£ç¼–å†™å’Œç»´æŠ¤çš„æŠ•å…¥.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="10-4-æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ"><a href="#10-4-æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ" class="headerlink" title="10.4 æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ"></a>10.4 æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ</h3><p>ä¸ºäº†åšåˆ°é«˜æ•ˆç‡çš„å‰åç«¯å¹¶è¡Œå¼€å‘ï¼Œæ¥å£çš„æµ‹è¯•ä¸æ¨¡æ‹Ÿæ˜¯å¿…è¦çš„ã€‚</p><ul><li>å‰ç«¯è¦æ±‚åç«¯åœ¨è”è°ƒä¹‹å‰ï¼Œéœ€è¦æµ‹è¯•éªŒè¯å¥½è‡ªå·±çš„æ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œã€‚è€Œä¸æ˜¯åœ¨è”è°ƒæœŸé—´ï¼ŒæŠŠå‰ç«¯å½“â€˜æ¥å£æµ‹è¯•å‘˜â€™ï¼Œé˜»å¡æ¥å£è”è°ƒè¿›åº¦</li><li>å¦å¤–å‰ç«¯éœ€è¦åœ¨åç«¯æ¥å£æœªå‡†å¤‡å¥½ä¹‹å‰ï¼Œé€šè¿‡æ¥å£æ¨¡æ‹Ÿçš„æ–¹å¼ï¼Œæ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚</li></ul><p>é’ˆå¯¹æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿï¼Œå­˜åœ¨ä¸‹å›¾è¿™æ ·ä¸€ä¸ªç†æƒ³çš„æ¨¡å‹:</p><p><img src="/images/frontend-standard/api-mock.png" alt></p><p>ä¸€åˆ‡ä»å®šä¹‰è‰¯å¥½çš„æ¥å£æ–‡æ¡£å‡ºå‘ï¼Œç”Ÿæˆ<code>Mock Server</code>å’Œ<code>Mock Client</code>, Mock Serverç»™å‰ç«¯æä¾›æ¨¡æ‹Ÿæ•°æ®ï¼Œè€ŒMock Clientåˆ™è¾…åŠ©åç«¯å¯¹å®ƒä»¬çš„æ¥å£è¿›è¡Œæµ‹è¯•.</p><p>èµ„æº:</p><ul><li>RESTful<ul><li><a href="https://swagger.io/" target="_blank" rel="noopener">Swagger</a> è¿™æ˜¯æœ€ä¸ºæ¥è¿‘ä¸Šé¢ç†æƒ³æ¨¡å‹çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</li><li><a href="https://github.com/nuysoft/Mock" target="_blank" rel="noopener">JSON Server</a> å¿«é€Ÿç”ŸæˆJSON mockæœåŠ¡å™¨</li><li><a href="https://easy-mock.com" target="_blank" rel="noopener">Easy Mock</a> å¯è§†åŒ–çš„ã€åœ¨çº¿çš„æ¥å£mockæœåŠ¡</li></ul></li><li>GraphQl<ul><li><a href="https://github.com/APIs-guru/graphql-faker" target="_blank" rel="noopener">GraphQL Faker</a></li><li><a href="https://www.apollographql.com/docs/graphql-tools/mocking/" target="_blank" rel="noopener">graphql-tools</a></li></ul></li><li>æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ<ul><li><a href="https://github.com/Marak/faker.js" target="_blank" rel="noopener">faker.js</a> ğŸ”¥å¼ºå¤§çš„æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒNodeå’Œæµè§ˆå™¨</li><li><a href="https://github.com/nuysoft/Mock" target="_blank" rel="noopener">Mock.js</a> æ•°æ®ç”Ÿæˆå’Œæ¨¡æ‹Ÿå·¥å…·</li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="11-åŸ¹è®­-çŸ¥è¯†ç®¡ç†-æŠ€æœ¯æ²‰æ·€"><a href="#11-åŸ¹è®­-çŸ¥è¯†ç®¡ç†-æŠ€æœ¯æ²‰æ·€" class="headerlink" title="11 åŸ¹è®­/çŸ¥è¯†ç®¡ç†/æŠ€æœ¯æ²‰æ·€"></a>11 åŸ¹è®­/çŸ¥è¯†ç®¡ç†/æŠ€æœ¯æ²‰æ·€</h2><p>æˆ‘è§‰å¾—ä¸€ä¸ªå›¢é˜Ÿçš„çŸ¥è¯†ç®¡ç†æ˜¯éå¸¸é‡è¦çš„. ä½ è¦é—®ä¸€ä¸ªåˆšå…¥è¡Œçš„æ–°æ‰‹åŠ å…¥å›¢é˜Ÿå¸Œæœ›å¾—åˆ°ä»€ä¹ˆï¼Ÿå¾ˆå¤šäººçš„å›ç­”æ˜¯â€™å­¦ä¹ â€™,  å¸Œæœ›è‡ªå·±çš„æŠ€æœ¯å¯ä»¥æ›´åŠ ç²¾è¿›, é’±å€’è¿˜æ˜¯å…¶æ¬¡ã€‚</p><p>ç„¶è€Œç°å®æ˜¯ç›®å‰å¾ˆå¤šå…¬å¸çš„æ°›å›´å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œä¸€å¤©åˆ°æ™šå†™ä¸šåŠ¡ä»£ç ã€å·¥ä½œé‡å¤§ã€æ¯å¤©åšé‡å¤çš„äº‹æƒ…ï¼Œè€Œä¸”è¿˜åŠ ç­ï¼Œå·¥ä½œå¤šå¹´æŠ€æœ¯ä¹Ÿæ²¡æ„Ÿè§‰æœ‰å¤šå°‘è¿›æ­¥, ç¡®å®ä¼šè®©äººéå¸¸æ²®ä¸§ã€‚åŒ…æ‹¬ç¬”è€…ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚</p><p>æ‰€ä»¥ä¸ºäº†æ”¹å–„è¿™ç§æƒ…å†µï¼Œæˆ‘æ¥èŠèŠæœ€è¿‘åœ¨â€˜å°å›¢é˜Ÿâ€™åšçš„ä¸€äº›å°è¯•.</p><h3 id="11-1-æ–°äººåŸ¹è®­"><a href="#11-1-æ–°äººåŸ¹è®­" class="headerlink" title="11.1 æ–°äººåŸ¹è®­"></a>11.1 æ–°äººåŸ¹è®­</h3><p>å¦‚æœå›¢é˜Ÿæœ‰è§„èŒƒçš„æ–°æˆå‘˜åŸ¹è®­æ‰‹å†Œï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šåŸ¹è®­çš„æ—¶é—´ï¼Œé¿å…æ¯æ¬¡é‡å¤å£è¿°ä¸€æ ·çš„å†…å®¹ã€‚åŸ¹è®­æ‰‹å†ŒåŒ…å«ä»¥ä¸‹å†…å®¹:</p><ul><li><p><strong>äº§å“æ¶æ„ä¸ç»„ç»‡æ¶æ„</strong>. ä»‹ç»å…¬å¸èƒŒæ™¯å’Œäº§å“ï¼Œä¸€èˆ¬ç»„ç»‡çš„å›¢é˜Ÿç»“æ„å’Œäº§å“çš„æ¶æ„æ˜¯ç›¸å…³è”çš„. ä»¥ç¬”è€…æ‰€åœ¨å…¬å¸ä¸ºä¾‹, ä¸»è¦äº§å“æ˜¯å³æ—¶é€šä¿¡:</p><p><img src="/images/frontend-standard/org.png" alt></p></li><li><p><strong>äº§å“ç ”å‘æµç¨‹</strong>: ä»‹ç»äº§å“å¼€å‘å’Œè¿­ä»£ä¼šæ¶‰åŠåˆ°çš„æµç¨‹ã€ä»¥åŠå›¢é˜Ÿä¹‹é—´çš„åä½œè¡”æ¥ï¼Œä¾‹å¦‚:</p><p><img src="/images/frontend-standard/dev-proc.png" alt></p></li><li><p><strong>å·¥ä½œèŒƒå›´</strong>: å›¢é˜Ÿæˆå‘˜çš„èŒè´£èŒƒå›´</p></li><li><strong>å»ºç«‹èµ„æºç´¢å¼•</strong>: å¼€å‘éœ€è¦è®¾è®¡åˆ°çš„èµ„æºï¼Œæ¯”å¦‚å„ç§æ–‡æ¡£åœ°å€ã€ç ”å‘ç³»ç»Ÿå…¥å£(ä¾‹å¦‚gitlabã€bugè·Ÿè¸ªç³»ç»Ÿã€æ–‡ä»¶å…±äº«ã€å‘å¸ƒå¹³å°ã€å¼€å‘/æµ‹è¯•ç¯å¢ƒã€ç›‘æ§ç³»ç»Ÿ)ã€åä½œè§„èŒƒç­‰ç­‰ã€‚å°†è¿™äº›èµ„æºæ•´ç†å¥½å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ²Ÿé€šæˆæœ¬</li><li><strong>è§„èŒƒ</strong>: å³æœ¬æ–‡çš„ä¸»ä½“â€™å‰ç«¯åä½œè§„èŒƒâ€™ã€‚æœ‰è§„èŒƒå¯å¾ªï¼Œå¯ä»¥è®©æˆå‘˜ä»¥è¾ƒå¿«çš„é€Ÿåº¦å…¥æ‰‹å¼€å‘ã€åŒæ—¶ä¹Ÿå‡å°‘åŸ¹è®­æˆæœ¬æŠ•å…¥ã€‚</li></ul><p>åŸ¹è®­æ‰‹å†Œå°†å¯ä»¥æ–‡æ¡£å…·è±¡åŒ–çš„å†…å®¹æ•´ç†ä¸ºæ–‡æ¡£ï¼Œå’Œä¸Šæ–‡è¯´åˆ°çš„Code Reviewä¸€æ ·ï¼Œä¸€äº›ä¸œè¥¿æ— æ³•é€šè¿‡æ–‡æ¡£æ¥è¯´æ˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šæ­é…ä¸€ä¸ªâ€˜åŸ¹è®­å¯¼å¸ˆâ€™ï¼Œåœ¨è¯•ç”¨æœŸé—´ï¼Œä¸€å¯¹ä¸€è¾…å¯¼ã€‚</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="11-2-è¥é€ æŠ€æœ¯æ°›å›´"><a href="#11-2-è¥é€ æŠ€æœ¯æ°›å›´" class="headerlink" title="11.2 è¥é€ æŠ€æœ¯æ°›å›´"></a>11.2 è¥é€ æŠ€æœ¯æ°›å›´</h3><ul><li><strong>é¼“åŠ±æˆå‘˜å†™æŠ€æœ¯åšå®¢ï¼Œæˆ–è€…å»ºç«‹è‡ªå·±çš„å›¢é˜Ÿä¸“æ </strong>. å†™ä¸€ç¯‡å¥½çš„æ–‡ç« ä¸å®¹æ˜“</li><li><strong>é¼“åŠ±å‚ä¸å¼€æºé¡¹ç›®</strong></li><li><p><strong>å®šæœŸçš„ä¸“é¢˜åˆ†äº«</strong>. é¼“åŠ±å›¢é˜Ÿæˆå‘˜å®šæœŸè¿›è¡Œä¸“é¢˜å­¦ä¹ å’Œç ”ç©¶ï¼Œç¼–å†™æŠ€æœ¯åšå®¢ï¼Œå¹¶å°†å­¦ä¹ çš„æˆæœåˆ†äº«ç»™å…¶ä»–æˆå‘˜. è¿™æ˜¯ä¸€ç§æŠ±å›¢å–æš–çš„å­¦ä¹ æ–¹å¼ï¼Œæ—¨åœ¨å¸®åŠ©å›¢é˜Ÿæˆå‘˜ä¸€èµ·å­¦ä¹ å’Œæˆé•¿ã€‚</p><p>æ¯”å¦‚å¼€å‘è€æ‰‹å¯ä»¥åˆ†äº«è‡ªå·±çš„ç»éªŒï¼Œç ”ç©¶æ›´æ·±å±‚æ¬¡çš„æŠ€æœ¯ï¼›æ–°æ‰‹åˆ™å¯ä»¥ç ”ç©¶æŸäº›å¼€å‘æŠ€å·§ã€æ–°æŠ€æœ¯ï¼Œä¾‹å¦‚CSS Gridï¼ŒsvgåŠ¨ç”»ç­‰ç­‰ã€‚æ¨èå›¢é˜Ÿæˆå‘˜æœ‰ä¸ªæ˜ç¡®çš„ç ”ç©¶é¢†åŸŸï¼Œè¿™æ ·åˆ†å·¥åˆä½œå¯ä»¥å­¦ä¹ åˆ°æ›´å¤šä¸œè¥¿.</p><p><strong>ä¸“é¢˜æ€ä¹ˆæ¥?</strong></p><ul><li>ä¸“é¢˜è¯·æ±‚. å¯ä»¥è¯·æ±‚å…¶ä»–æˆå‘˜å®Œæˆä¸“é¢˜ï¼Œæ¯”å¦‚æ¯”è¾ƒæ·±çš„çŸ¥è¯†ï¼Œå¯ä»¥è¦æ±‚å›¢é˜Ÿæ¯”è¾ƒæœ‰ç»éªŒçš„è¿›è¡Œå­¦ä¹ åˆ†äº«</li><li>å­¦ä¹ æ€»ç»“.</li><li>é¡¹ç›®å›é¡¾</li><li>éš¾ç‚¹æ”»å…‹</li><li>é¡¹ç›®è§„èŒƒ</li><li>å·¥å…·ä½¿ç”¨</li></ul></li><li><p><strong>è½å®å’Œå®Œå–„å¼€å‘è§„èŒƒ</strong>. è§„èŒƒæœ¬èº«å°±æ˜¯å›¢é˜ŸçŸ¥è¯†æ²‰æ·€çš„ä¸€ç§ç›´æ¥è¾“å‡º</p></li><li><strong>å›¾ä¹¦åˆ†äº«</strong>. å’Œç¦»æ•£çš„æ–‡ç« æˆ–æ•™ç¨‹ç›¸æ¯”ï¼Œå›¾ä¹¦çš„çŸ¥è¯†ä¼šæ¯”è¾ƒç³»ç»Ÿï¼Œå¦å¤–å¾ˆå¤šç»å…¸çš„å›¾ä¹¦æ˜¯è¦é™ä¸‹æ¥å¥½å¥½æ¬£èµçš„ã€‚</li><li><strong>é¼“åŠ±é‡æ„å’ŒæŒç»­ä¼˜åŒ–ä»£ç </strong></li><li><strong>æŠ½è±¡ä¸€å¥—åŸºç¡€åº“æˆ–æ¡†æ¶ï¼Œå‡å°‘é‡å¤å·¥ä½œ, æé«˜å·¥ä½œæ•ˆç‡</strong>. ä¸åŠ ç­å…ˆä»æé«˜å·¥ä½œæ•ˆç‡å¼€å§‹</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="12-åé¦ˆ"><a href="#12-åé¦ˆ" class="headerlink" title="12 åé¦ˆ"></a>12 åé¦ˆ</h2><p>å¤§å®¶æœ‰ä»€ä¹ˆè¦è¡¥å……æˆ–æ„è§å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®º, ä¸€èµ·æ¥å®Œå–„è¿™ç¯‡æ–‡ç« , è°¢è°¢ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä¸‡å­—é•¿æ–‡ï¼Œç»§ç»­åˆ·æ–°æˆ‘çš„æ–‡ç« é•¿åº¦è®°å½•ï¼Œæ¶‰åŠå‰ç«¯å¼€å‘çš„æ–¹æ–¹é¢é¢ã€‚æœ¬æ–‡å°†æŒç»­æ›´æ–°å’Œå®Œå–„, æ–‡ç« éƒ¨åˆ†è§‚ç‚¹å¯èƒ½æ¯”è¾ƒæ­¦æ–­æˆ–ä¸å®Œæ•´ï¼Œæ¬¢è¿è¯„è®ºå’Œè¡¥å……ï¼Œä¸€èµ·å®Œå–„è¯¥æ–‡ç« . è°¢è°¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;ç¬”è€…é•¿æœŸå•æªåŒ¹é©¬åœ¨å‰ç«¯é¢†
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[é—®ç­”] ä¸ºä»€ä¹ˆè¦ç”¨vue-cli3?</title>
    <link href="https://bobi.ink/2019/07/18/why-vue-cli3/"/>
    <id>https://bobi.ink/2019/07/18/why-vue-cli3/</id>
    <published>2019-07-17T16:00:00.000Z</published>
    <updated>2019-07-18T04:20:32.211Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><code>[é—®ç­”]</code>ç³»åˆ—ä¸»è¦æ•´ç†<a href="https://segmentfault.com/q/1010000019785471" target="_blank" rel="noopener">SegmentFault</a>ä¸Šé¢æ¯”è¾ƒæœ‰ä»·å€¼çš„é—®é¢˜ï¼Œä»¥åŠæˆ‘çš„å›ç­”</p></blockquote><h2 id="åŸé—®é¢˜"><a href="#åŸé—®é¢˜" class="headerlink" title="åŸé—®é¢˜"></a><a href="https://segmentfault.com/q/1010000019785471/a-1020000019793827" target="_blank" rel="noopener">åŸé—®é¢˜</a></h2><p>å…¶å®è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯æƒ³äº†è§£vue-cli3ä¸vue-cli2ç›¸æ¯”æ˜¯å¦å­˜åœ¨ä¸€äº›ä¸å¾—ä¸å‡çº§çš„å¥½å¤„å’Œä¼˜ç‚¹ï¼Ÿ</p><p>äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯åœ¨è¯•ç”¨å®Œvue-cli3ä¹‹åå¹¶æ²¡æœ‰è§‰å¾—å¥½ç”¨ï¼Œåè€Œè§‰å¾—æŸæ‰‹æŸè„šï¼Œæˆ‘cli2æ—¶ï¼Œwebpackæƒ³æ€ä¹ˆé…æ€ä¹ˆé…ä¸ºä»€ä¹ˆåˆ°äº†cli3æˆ‘è¦åœ¨vue.config.jsä¸­é…ç½®<br>ä¼—æ‰€å‘¨çŸ¥vue-cliçš„é€šç”¨é…ç½®å¹¶ä¸é€‚åˆæ¯ç§æƒ…å†µ, è€Œåœ¨vue.config.jsåªèƒ½åšå¢æ·»å’Œè¦†ç›–ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰ç”¨vue-cli3æ„å»ºé¡¹ç›®</p><p>æ‰€ä»¥æƒ³è¯·æ•™ä¸‹ è¿™ä¸ªç‰ˆæœ¬æœ‰æ²¡æœ‰å€¼å¾—å‡çº§çš„ä¼˜ç‚¹</p><p><br></p><h2 id="æˆ‘çš„å›ç­”"><a href="#æˆ‘çš„å›ç­”" class="headerlink" title="æˆ‘çš„å›ç­”"></a>æˆ‘çš„å›ç­”</h2><p>å¥½é—®é¢˜ï¼Œvue-cli3ç›¸å¯¹vue-cliæœ‰å¾ˆå¤šé‡è¦çš„æ›´æ–°ã€‚</p><p>é¦–å…ˆè¯´ä¸€äº›vue-cliè¿™äº›å·¥å…·çš„<strong>åˆè¡·</strong>å§: è¿™äº›å·¥å…·å°±æ˜¯ä¸ºäº†è®©å¼€å‘è€…èƒ½å¤Ÿ<strong>å¼€ç®±å³ç”¨</strong>å¿«é€Ÿåœ°è¿›è¡Œåº”ç”¨å¼€å‘è€Œå¼€å‘çš„ï¼Œ<strong>å®ƒä»¬ç§‰æ‰¿çš„æ˜¯â€œçº¦å®šå¤§äºé…ç½®â€æ€æƒ³ï¼Œç®€å•è¯´å°±æ˜¯â€èƒ½ä¸é…ç½®çš„å°±ä¸é…ç½®ï¼Œä½ å°±æŒ‰ç…§æˆ‘çš„æ–¹å¼æ¥ï¼Œä¹Ÿä¸è¦å»äº‰è®ºè¿™ä¸ªå¥½ä¸å¥½ï¼Œå¿«é€Ÿè¿›è¡Œä¸šåŠ¡å¼€å‘æ‰æ˜¯æ­£ç»äº‹â€. å®ƒä»¬ä¸å»ºè®®ä½ å»é…ç½®ï¼Œä½†ä¹Ÿä¸ä¼šæ‹¦ç€ä½ å»é…ç½®</strong>ã€‚</p><p>å¦å¤–Webpackå¯¹åˆå­¦è€…å¹¶ä¸æ˜¯ååˆ†å‹å¥½ï¼Œâ€˜åˆé•¿åˆè‡­â€™çš„é…ç½®ï¼Œæ™®é€šå¼€å‘è€…å¾ˆéš¾å†™å…¥å®šä¹‰è‰¯å¥½ï¼Œæ€§èƒ½ä¼˜åŒ–çš„é…ç½®ã€‚ä¸ç„¶å°±ä¸ä¼šå„ç§cliå·¥å…·å†’å‡ºæ¥äº†ï¼Œæ¯”å¦‚parcelï¼Œcreate-react-appã€‚è¿™äº›å·¥å…·éƒ½å®£ç§°é›¶é…ç½®ï¼Œç›®çš„å°±æ˜¯è®©å¼€å‘è€…èƒ½å¤Ÿæ„‰å¿«çš„è¿›è¡Œä»£ç å¼€å‘ã€‚</p><p><br></p><hr><p><br></p><p>ç°åœ¨æ¥çœ‹çœ‹Vue-cli v3çš„æ”¹è¿›ï¼Œä»¥åŠæ€è€ƒè¿™äº›æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p><p><br></p><p><strong>1. æŠ½ç¦»cli serviceå±‚</strong></p><p>Create-React-Appæ˜¯ç¬¬ä¸€ä¸ªåšè¿™ç§äº‹æƒ…çš„ã€‚vue-cli3åº“ç°åœ¨åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ¨¡å—ï¼š</p><ul><li><p>CLI: å³vueå…¨å±€å‘½ä»¤ï¼Œä¸»è¦ç”¨äºé¡¹ç›®åˆ›å»ºå’Œç®¡ç†ï¼ŒåŒ…å«äº†<code>vue create</code>ã€<code>vue ui</code>è¿™äº›å‘½ä»¤ã€‚CLIå‘½ä»¤çš„åšçš„äº‹æƒ…æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æ›´æ–°ä¸ä¼šå¤ªé¢‘ç¹(å¼€å‘è€…ä¹Ÿå¾ˆå°‘ä¼šå»æ›´æ–°è¿™äº›å‘½ä»¤)</p></li><li><p>Serviceå±‚: è´Ÿè´£é¡¹ç›®çš„å®é™…æ„å»ºï¼Œä¹Ÿå°±æ˜¯webpacké¡¹ç›®æ„å»ºã€‚è¿™ä¸€å—æ˜¯é¢‘ç¹æ›´æ–°çš„ï¼Œä¸€èˆ¬ä½œä¸ºé¡¹ç›®çš„å±€éƒ¨ä¾èµ–ã€‚</p></li></ul><p><br></p><p>OKï¼Œè¿™ä¹ˆåšæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿè€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¹Ÿæ˜¯ç­”ä¸»ä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªç—›ç‚¹ï¼š</p><p><strong>vue-cli3ä¹‹å‰ä¸ç®—æ˜¯ä¸€ä¸ªæ„å»ºCLI, å®ƒé¡¶å¤šå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ‹·è´å™¨, åšçš„äº‹æƒ…éå¸¸å°‘</strong>, æ‰€æœ‰webpacké…ç½®å’Œæ„å»ºå‘½ä»¤éƒ½æ˜¯è€¦åˆåœ¨å…·ä½“çš„é¡¹ç›®é‡Œé¢ï¼Œpackage.jsonä¼šåŒ…å«ä¸€å¤§å †å¼€å‘ä¾èµ–ã€‚</p><p>å¦‚æœå»è·Ÿè¿›webpackæˆ–ç›¸å…³å·¥å…·æ›´æ–°çš„æœ‹å‹ä¼šæœ‰è¿™ç§ä½“ä¼šï¼Œå‡çº§ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚æ¯”å¦‚ä½ å‡çº§äº†babel-loader, å¯èƒ½è¦è¿å¸¦webpackéƒ½å‡çº§ï¼Œwebpackå‡çº§åå¯èƒ½å…¶ä»–å·¥å…·åˆä¸å…¼å®¹äº†ã€‚</p><p>å‡çº§æ–¹é¢çš„ç—›ç‚¹æ˜¯å…¶ä¸€ã€‚å¦‚æœä½ çš„å›¢é˜Ÿéœ€è¦ç»´æŠ¤å¾ˆå¤šé¡¹ç›®ï¼Œä½ æ€ä¹ˆå¯¹è¿™äº›é¡¹ç›®è¿›è¡Œç»´æŠ¤å‡çº§ï¼Ÿæ¯ä¸ªé¡¹ç›®éƒ½æ‹·è´ä¸€ä¸‹ï¼Ÿå¦‚æœæŸä¸ªé¡¹ç›®åšäº†ç‰¹æ®Šé…ç½®å‘¢ï¼Ÿ</p><p><strong>å¯¹äºå›¢é˜Ÿè€Œè¨€ï¼Œé¡¹ç›®æ„å»ºè¿™ä¸€å—æ˜¯åº”è¯¥å°½é‡åšåˆ°çš„ç»Ÿä¸€å’Œå‚»ç“œåŒ–çš„ï¼Œæ²¡æœ‰å¿…è¦åœ¨è¿™æ–¹é¢æŠ•å…¥å¤ªå¤šçš„ç²¾åŠ›ï¼Œåº”è¯¥æŠŠäº‹æƒ…å¤–åŒ…ç»™æ“…é•¿è¿™ç§äº‹æƒ…çš„äººå»åš</strong>ã€‚</p><p><strong>å¦å¤–ä¸è¦æ’æ–¥æ›´æ–°ï¼Œæ›´æ–°å¯ä»¥è·å¾—æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œæ„å»ºé€Ÿåº¦ã€è¿è¡Œæ€§èƒ½, åˆ«äººåœ¨è¿™æ–¹é¢æ¯”ä½ äº†è§£çš„æ›´å¤š</strong>ã€‚</p><p><strong>åˆ†ç¦»äº†vue-cli-serviceä¹‹åï¼Œé¡¹ç›®æ„å»ºæ›´æ–°åªæ˜¯ä¸€ä¸ªå‘½ä»¤çš„äº‹æƒ…ï¼Œé™¤éåšäº†å¾ˆå¤šç‰¹æ®ŠåŒ–æ“ä½œ</strong>ã€‚<strong>ç‰¹æ®ŠåŒ–æ“ä½œåº”è¯¥å°è£…åˆ°vue-cliçš„æ’ä»¶ä¸­</strong>ã€‚è¿™å°±å¼•å‡ºäº†vue-cli3çš„å¦å¤–ä¸€ä¸ªç‰¹è‰²ï¼šæ’ä»¶</p><p><br></p><hr><p><br></p><p><strong>2. æ’ä»¶åŒ–</strong></p><p>ç›¸æ¯”create-react-app, vue-cliæ˜¯åœ¨å¤ªä»æ…ˆäº†ã€‚vue-cliçš„æ’ä»¶æœºåˆ¶å¾ˆçµæ´»ï¼Œé€šè¿‡<code>webpack-chain</code>å’Œ<code>webpack-merge</code>å¯ä»¥å®ç°webpackå®Œå…¨å®šåˆ¶åŒ–ã€‚</p><p>å¯ä»¥å¯¹æ¯”ä¸€ä¸‹å¸‚é¢ä¸Šæµè¡Œçš„cliå·¥å…·çš„å¯æ‰©å±•æ€§ï¼š</p><table><thead><tr><th></th><th>Vue CLI</th><th>create-react-app</th><th>parcel</th></tr></thead><tbody><tr><td>å¿«é€ŸåŸå‹å¼€å‘</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>å…¨å±€æ¨¡å¼</td><td>é›¶é…ç½®åŸå‹å¼€å‘å°±æ˜¯å…¨å±€çš„</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>æ’ä»¶</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒï¼Œæ‰©å±•æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶è¾“å‡º</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¼ºï¼Œé€šè¿‡æ’ä»¶æ‰©å±• wepack é…ç½®</td><td>å¼±, å¼ºçº¦å®š, æ— æ³•é…ç½® webpackï¼Œå¯ä»¥ eject, ç„¶åæ‰‹å·¥é…ç½®ï¼›æ”¯æŒ babel-macro;(ä¸¥æ ¼è¯´å¯ä»¥é€šè¿‡<a href="https://github.com/timarney/react-app-rewired" target="_blank" rel="noopener">react-app-rewired</a>è¿›è¡Œæ‰©å±•)</td><td>ä¸­(å¯ä»¥é…ç½® babelï¼Œpostcssï¼ŒTypescript); æä¾›äº† Node API; æ”¯æŒæ’ä»¶æ‰©å±•æ–‡ä»¶ç±»å‹</td></tr><tr><td>å¤šé¡µé¢</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>é€‚ç”¨èŒƒå›´</td><td>Vue ç»„ä»¶çš„ç¬¬ä¸€å…¬æ°‘ã€‚é€šè¿‡æ‰©å±•å¯ä»¥æ”¯æŒä»»æ„å‰ç«¯æ¡†æ¶</td><td>é’ˆå¯¹ React å¼€å‘ï¼Œä¸æ”¯æŒå…¶ä»–æ¡†æ¶</td><td>parcel æ˜¯ä¸€ä¸ªé€šç”¨çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„ç«äº‰å¯¹æ‰‹æ˜¯ webpack</td></tr><tr><td>ç¼–è¯‘é€Ÿåº¦</td><td>cache-loader,thread-loader æ¥åŠ é€Ÿ JS å’Œ TS ç¼–è¯‘</td><td>babel-loader å¼€å¯äº† cache</td><td>ç¼–è¯‘é€Ÿåº¦å·ç§°æ˜¯ webpack çš„ä¸¤å€</td></tr><tr><td>å¯å‡çº§æ€§</td><td>æ”¯æŒå‡çº§ cli-service, æ’ä»¶éœ€è¦å•ç‹¬å‡çº§, æ’ä»¶éœ€è¦éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬. å¤ªå¤šæ’ä»¶å­˜åœ¨å‡çº§é£é™©</td><td>æ”¯æŒå‡çº§ react-script, å®˜æ–¹ç»´æŠ¤ï¼Œä¸”å¼ºçº¦å®šåŸºæœ¬å¯ä»¥ä¿éšœå‘ä¸‹å…¼å®¹</td><td>æ”¯æŒå‡çº§ parcel-bundler</td></tr><tr><td>UI</td><td>å›¾å½¢åŒ–ç®¡ç†æ˜¯ CLI çš„ç‰¹è‰²ä¹‹ä¸€</td><td>-</td><td>-</td></tr></tbody></table><p><br></p><p>å¯¹äºvue-cliçš„æ’ä»¶å®ç°æœºåˆ¶å¯ä»¥çœ‹è¿™ç¯‡<a href="https://juejin.im/post/5cedb26451882566477b7235" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚</p><p>å› ä¸ºvue-cliçµæ´»çš„æ‰©å±•æ€§ï¼Œæ‰€ä»¥å®ƒä¸ä»…é™äºvueæœ¬èº«ï¼Œå¯ä»¥æ‰©å±•æ”¯æŒreactã€anythingâ€¦</p><p>æŒ‰ç…§ä¸Šæ–‡è¯´çš„ï¼Œ<strong>å¦‚æœä½ è¦åšæ·±åº¦çš„vue-cliå®šåˆ¶åŒ–ï¼Œä¸å»ºè®®ç›´æ¥å†™åœ¨vue.config.jsä¸­ï¼Œè€Œæ˜¯å°è£…åœ¨æ’ä»¶ä¸­ï¼Œç‹¬ç«‹çš„ç»´æŠ¤è¿™ä¸ªæ’ä»¶ï¼Œç„¶åé¡¹ç›®å†ä¾èµ–è¿™ä¸ªæ’ä»¶ã€‚è¿™æ ·å°±å¯ä»¥ç®€åŒ–å‡çº§çš„æˆæœ¬å’Œå¤æ‚åº¦</strong>ã€‚</p><p><br></p><hr><p><br></p><p><strong>3. GUIç•Œé¢</strong></p><p>è™½ç„¶å¤§éƒ¨åˆ†äººéƒ½è§‰å¾—ä½œç”¨ä¸å¤§ï¼Œå› ä¸ºç¡®å®å¯¹å¼€å‘æ•ˆç‡å¹¶å®é™…çš„æå‡æ•ˆæœã€‚å°±æ˜¯çœ‹ç€èˆ’æœç›´è§‚ï¼Œè¿™å°±å¤Ÿäº†ã€‚</p><p><br></p><hr><p><br></p><p><strong>4. å¿«é€ŸåŸå‹å¼€å‘</strong></p><p>vue-cli3ä¹Ÿæ”¯æŒç›´æ¥å°†ä¸€ä¸ªvueæ–‡ä»¶è·‘èµ·æ¥ï¼Œå¿«é€ŸåŸå‹å¼€å‘æˆ–éªŒè¯æŸäº›æƒ³æ³•æ—¶ï¼ŒæŒºä¸é”™ã€‚</p><p><br></p><hr><p><br></p><p><strong>5. <a href="https://cli.vuejs.org/guide/browser-compatibility.html#modern-mode" target="_blank" rel="noopener">ç°ä»£æ¨¡å¼</a></strong></p><p>ç»™å…ˆè¿›çš„æµè§ˆå™¨é…åˆå…ˆè¿›çš„ä»£ç (ES6ä¹‹å),åŒæ—¶å…¼å®¹æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œå…ˆè¿›çš„ä»£ç ä¸ç®¡ä»æ–‡ä»¶ä½“ç§¯è¿˜æ˜¯è„šæœ¬è§£ææ•ˆç‡ã€è¿è¡Œæ•ˆç‡éƒ½æœ‰è¾ƒé«˜çš„æå‡ã€‚</p><p>ä½“ç§¯å¯¹æ¯”:</p><table><thead><tr><th>Version</th><th>Size (minified)</th><th>Size (minified + gzipped)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>80K</td><td>21K</td></tr><tr><td>ES5 (main.es5.js)</td><td>175K</td><td>43K</td></tr></tbody></table><p><br></p><p>è§£ææ•ˆç‡:</p><table><thead><tr><th>Version</th><th>Parse/eval time (individual runs)</th><th>Parse/eval time (avg)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>184ms, 164ms, 166ms</td><td>172ms</td></tr><tr><td>ES5 (main.es5.js)</td><td>389ms, 351ms, 360ms</td><td>367ms</td></tr></tbody></table><p><br></p><hr><p><br></p><p><strong>6. Standard Tooling for Vue.js Development</strong></p><p>è¿™æ˜¯vue-cliçš„å®˜æ–¹ä»‹ç»ï¼Œvueæ ‡å‡†å¼€å‘å·¥å…·. è·Ÿè¿›vue-cliå°±æ˜¯è·Ÿè¿›å®˜æ–¹çš„æœ€ä½³å®è·µå’Œå‰æ²¿æŠ€æœ¯ï¼Œvueå›¢é˜Ÿå·²ç»ä¸ºä½ è€ƒè™‘å¾ˆå¤šåº”ç”¨åœºæ™¯, why not?</p><p><br></p><hr><p><br></p><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼š</p><ul><li><p>å¦‚æœæˆ‘ä»¬å–œæ¬¢æŠ˜è…¾ï¼Œè‚¯å®šä¼šè§‰å¾—vue-cli3æŸæ‰‹æŸè„šï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¸æ˜¯vue-cli3çš„ç›®æ ‡ç”¨æˆ·ï¼›</p><p>å°±æ¯”å¦‚æˆ‘ä»¬å›¢é˜Ÿå°±è‡ªå·±æäº†ä¸€ä¸€ä¸ªCLIæ„å»ºå·¥å…·: <a href="https://github.com/GDJiaMi/jm-cli" target="_blank" rel="noopener">jm-cli</a>, æ ¹æ®è‡ªå·±çš„å›¢é˜Ÿéœ€æ±‚è¿›è¡Œæ·±åº¦å®šåˆ¶ï¼Œä¸è¿‡æˆ‘ä»¬è¿™ä¸ªå·¥å…·æ˜¯å¼ºçº¦å®šçš„ï¼ŒåŒ…æ‹¬ç›®å½•ç»“æ„ã€ç¼–ç è§„èŒƒç­‰ç­‰. å› ä¸ºæˆ‘ä»¬ä¸æ¨èå›¢é˜Ÿæˆå‘˜å»æç‰¹æ®ŠåŒ–å®šåˆ¶ï¼Œè€Œä¸”ä¸ºäº†æ–¹ä¾¿è¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥å¹²è„†å°±ä¸è®©æ‰©å±•äº†ï¼Œ<strong>ç»Ÿä¸€å’Œè§„èŒƒå¯¹å›¢é˜Ÿæ¥è¯´æ‰æ˜¯æœ€é‡è¦çš„</strong>.</p><p><strong>å¦‚æœä½ æœ‰ç±»ä¼¼çš„å¼€å‘ç»éªŒï¼Œä½ ä¼šè§‰å¾—vue-cliå¯èƒ½æ˜¯æ‰€æœ‰æ„å»ºCLIçš„æœ€ç»ˆå½’å®¿æˆ–è€…å…¸èŒƒ</strong>ã€‚</p></li><li><p>å¦‚æœä¸æƒ³æŠ˜è…¾ï¼Œåªæƒ³å†™ä»£ç , è€Œä¸”æƒ³è·Ÿè¿›vueå®˜æ–¹æœ€æ–°å®è·µï¼Œé‚£å°±ç›´æ¥æ‹¿æ¥ç”¨å§ï¼›</p></li><li>å¦‚æœæƒ³æŠ˜è…¾ï¼Œåˆè¦è€ƒè™‘å›¢é˜Ÿåä½œå’Œæ„å»ºå·¥å…·é“¾çš„ç»´æŠ¤æˆæœ¬ï¼Œvue-cliæ˜¯å¾ˆé€‚åˆçš„ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€ è½®å­</li><li>å¦‚æœæƒ³å­¦webpackçš„æ„å»ºé¡¹ç›®ï¼Œä¹Ÿä¸æ¨èä½ ä½¿ç”¨vue-cli</li></ul><p><br></p><p>æœ€åç»™vueå›¢é˜Ÿç‚¹ä¸ªèµğŸ‘</p><p>æ¬¢è¿å…³æ³¨æˆ‘ï¼Œå’Œæˆ‘äº¤æµ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;[é—®ç­”]&lt;/code&gt;ç³»åˆ—ä¸»è¦æ•´ç†&lt;a href=&quot;https://segmentfault.com/q/1010000019785471&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SegmentFault&lt;/a&gt;
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ç°ä»£è„šæœ¬çš„åŠ è½½</title>
    <link href="https://bobi.ink/2019/07/17/modern-module/"/>
    <id>https://bobi.ink/2019/07/17/modern-module/</id>
    <published>2019-07-16T16:00:00.000Z</published>
    <updated>2019-07-18T23:21:49.165Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€: <a href="https://jasonformat.com/modern-script-loading/" target="_blank" rel="noopener">Modern Script Loading</a>, æ–‡ç« ä½œè€…æ˜¯Preactä½œè€…<a href="https://twitter.com/_developit" target="_blank" rel="noopener">Jason Miller</a></p><p><br></p><p><img src="/images/modern-module/modern-script-loading.jpg" alt></p><p><br></p><h2 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h2><p>å…ˆç®€å•ä»‹ç»ä¸€ä¸‹<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" target="_blank" rel="noopener"><code>æ¨¡å—script(Module script)</code></a>, å®ƒæŒ‡çš„æ˜¯<strong>ç°ä»£æµè§ˆå™¨æ”¯æŒé€šè¿‡<code>&lt;script type=module src=main.js&gt;&lt;/script&gt;</code>æ¥åŠ è½½ç°ä»£çš„ES6æ¨¡å—</strong>. ç°ä»£æµè§ˆå™¨å¯¹ES6ç°ä»£è¯­æ³•æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€<strong>æˆ‘ä»¬å¯ä»¥ç»™è¿™äº›ç°ä»£æµè§ˆå™¨æä¾›æ›´ç´§å‡‘çš„â€˜ç°ä»£ä»£ç â€™ï¼Œä¸€æ–¹é¢å¯ä»¥å‡å°æ‰“åŒ…çš„ä½“ç§¯ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“çš„å¸¦å®½ï¼Œå¦å¤–è¿˜å¯ä»¥æé«˜è„šæœ¬è§£æçš„æ•ˆç‡å’Œè¿è¡Œæ•ˆç‡</strong>.</p><p>ä¸‹å›¾æ¥æºäº<a href="https://philipwalton.com/articles/deploying-es2015-code-in-production-today/" target="_blank" rel="noopener"><code>module/nomodule pattern</code></a>, å¯¹æ¯”äº†<strong>æ¨¡å—script</strong>å’Œ<strong>ä¼ ç»Ÿ(legacy) script</strong>çš„æ€§èƒ½:</p><p>ä½“ç§¯å¯¹æ¯”:</p><table><thead><tr><th>Version</th><th>Size (minified)</th><th>Size (minified + gzipped)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>80K</td><td>21K</td></tr><tr><td>ES5 (main.es5.js)</td><td>175K</td><td>43K</td></tr></tbody></table><p><br></p><p>è§£ææ•ˆç‡:</p><table><thead><tr><th>Version</th><th>Parse/eval time (individual runs)</th><th>Parse/eval time (avg)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>184ms, 164ms, 166ms</td><td>172ms</td></tr><tr><td>ES5 (main.es5.js)</td><td>389ms, 351ms, 360ms</td><td>367ms</td></tr></tbody></table><p><br></p><p>Okï¼Œä¸ºäº†å…¼å®¹æ—§æµè§ˆå™¨, <a href="https://philipwalton.com/articles/deploying-es2015-code-in-production-today/" target="_blank" rel="noopener">module/nomodule pattern</a>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€ç§<strong>module/nomodule æ¨¡å¼</strong>, ç®€å•è¯´å°±æ˜¯<strong>åŒæ—¶æä¾›ä¸¤ä¸ªscript, ç”±æµè§ˆå™¨æ¥å†³å®šåŠ è½½å“ªä¸ªæ–‡ä»¶</strong>ï¼š</p><p><br></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ”¯æŒæ¨¡å—scriptçš„æµè§ˆå™¨ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"main.mjs"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ—§æµè§ˆå™¨ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å› ä¸ºåŠ äº†nomdule, æ‰€ä»¥ç°ä»£æµè§ˆå™¨ä¸ä¼šåŠ è½½è¯¥æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"main.es5.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹èµ·æ¥å¾ˆç¾å¥½æ˜¯å§? ç°å®æ˜¯ï¼š<strong>ä¸­é—´å­˜åœ¨ä¸€äº›æµè§ˆå™¨ï¼Œå®ƒä»¬å¯ä»¥è¯†åˆ«<code>æ¨¡å—script</code>ä½†æ˜¯ä¸è®¤è¯†<code>nomodule</code>å±æ€§, è¿™å°±å¯¼è‡´äº†è¿™äº›æµè§ˆå™¨ä¼šåŒæ—¶åŠ è½½è¿™ä¸¤ä¸ªæ–‡ä»¶(ä¸‹æ–‡ç»Ÿä¸€ç§°ä¸ºâ€˜åŒé‡åŠ è½½â€™(over-fetching))</strong>.</p><p><br><br><br></p><blockquote><p>OKï¼Œæ­£å¼è¿›å…¥æ­£æ–‡. ç»™æ­£ç¡®çš„æµè§ˆå™¨äº¤ä»˜æ­£ç¡®ä»£ç æ˜¯ä¸€ä»¶æ£˜æ‰‹çš„äº‹æƒ…ã€‚æœ¬æ–‡ä¼šä»‹ç»å‡ ç§æ–¹å¼, æ¥è§£å†³ä¸Šè¿°çš„é—®é¢˜:</p></blockquote><p>ç»™ç°ä»£æµè§ˆå™¨ä¼ºæœâ€™ç°ä»£çš„ä»£ç â€™å¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚æ‰€ä»¥ä½ åº”è¯¥é’ˆå¯¹ç°ä»£æµè§ˆå™¨æä¾›åŒ…å«æ›´ç´§å‡‘å’Œä¼˜åŒ–çš„ç°ä»£è¯­æ³•çš„JavascriptåŒ…ï¼ŒåŒæ—¶åˆå¯ä»¥ä¿æŒå¯¹æ—§æµè§ˆå™¨çš„æ”¯æŒ</p><p>ç°æœ‰çš„å·¥å…·é“¾çš„ç”Ÿæ€ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯åœ¨<code>module/nomoduleæ¨¡å¼</code>ä¸Šæ•´åˆçš„ï¼Œå®ƒå£°æ˜å¼åŠ è½½ç°ä»£å’Œä¼ ç»Ÿä»£ç (legacy code)ï¼Œå³ç»™æµè§ˆå™¨æä¾›ä¸¤ä¸ªæºä»£ç ï¼Œè®©å®ƒæ¥è‡ªå·±æ¥å†³å®šç”¨å“ªä¸ª:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"/modern.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"/legacy.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œç°å®æ€»æ˜¯ç»™ä½ å½“å¤´ä¸€æ£’ï¼Œå®ƒæ²¡æˆ‘ä»¬æœŸæœ›çš„é‚£ä¹ˆç®€å•ç›´æ¥ã€‚ä¸Šè¿°åŸºäºHTMLçš„åŠ è½½æ–¹å¼åœ¨<a href="https://gist.github.com/jakub-g/5fc11af85a061ca29cc84892f1059fec" target="_blank" rel="noopener"><strong>Edgeå’ŒSafariä¸­ä¼šè¢«åŒæ—¶åŠ è½½</strong></a>!</p><p><br></p><h2 id="æ€ä¹ˆåŠ"><a href="#æ€ä¹ˆåŠ" class="headerlink" title="æ€ä¹ˆåŠ?"></a>æ€ä¹ˆåŠ?</h2><p>æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬æƒ³ä¾èµ–æµè§ˆå™¨æ¥äº¤ä»˜ä¸åŒçš„ç¼–è¯‘ç›®æ ‡ï¼Œä½†æ˜¯ä¸€äº›æ—§æµè§ˆå™¨å¹¶ä¸èƒ½ä¼˜é›…åœ°æ”¯æŒè¿™ç§ç®€æ´çš„å†™æ³•ã€‚</p><p>é¦–å…ˆï¼ŒSafari åœ¨10.1å¼€å§‹æ”¯æŒJSæ¨¡å—, ä½†ä¸æ”¯æŒnomoduleå±æ€§ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒSamæ‰¾åˆ°äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡Safari 10å’Œ11ä¸­éæ ‡å‡†çš„beforeloadäº‹ä»¶æ¥æ¨¡æ‹Ÿ nomodule, ä¹Ÿå°±æ˜¯å¯ä»¥è®¤ä¸ºSafari 10.1å¼€å§‹æ˜¯å¯ä»¥æ”¯æŒ<code>module/nomoduleæ¨¡å¼</code></p><p><br></p><h2 id="é€‰é¡¹1-åŠ¨æ€åŠ è½½"><a href="#é€‰é¡¹1-åŠ¨æ€åŠ è½½" class="headerlink" title="é€‰é¡¹1: åŠ¨æ€åŠ è½½"></a>é€‰é¡¹1: åŠ¨æ€åŠ è½½</h2><p>æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªå°å‹scriptåŠ è½½å™¨æ¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œå·¥ä½œåŸç†ç±»ä¼¼äº<a href="https://github.com/filamentgroup/loadCSS" target="_blank" rel="noopener">LoadCSS</a>ã€‚åªä¸è¿‡è¿™é‡Œéœ€è¦ä¾é æµè§ˆå™¨çš„æ¥å®ç°ESæ¨¡å—å’Œnomoduleå±æ€§.</p><p>æˆ‘ä»¬é¦–å…ˆå°è¯•æ‰§è¡Œä¸€ä¸ªæ¨¡å—scriptè¿›è¡Œâ€™çŸ³è•Šè¯•éªŒâ€™(litmus test), ç„¶åç”±è¿™ä¸ªè¯•éªŒçš„ç»“æœæ¥å†³å®šåŠ è½½ç°ä»£ä»£ç è¿˜æ˜¯ä¼ ç»Ÿä»£ç :</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ä¸€ä¸ªæ¨¡å—scriptæ¥æ£€æµ‹æ˜¯å¦æ˜¯ç°ä»£æµè§ˆå™¨ --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  self.modern = <span class="literal">true</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç°åœ¨æ ¹æ®è¿™ä¸ªæ£€æµ‹ç»“æœæ¥å†³å®šåŠ è½½ç°ä»£ä»£ç è¿˜æ˜¯ä¼ ç»Ÿä»£ç : --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (self.modern) &#123;</span></span><br><span class="line"><span class="javascript">      s.src = <span class="string">'/modern.js'</span></span></span><br><span class="line"><span class="javascript">      s.type = <span class="string">'module'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">      s.src = <span class="string">'/legacy.js'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.head.appendChild(s)</span></span><br><span class="line"><span class="undefined">  &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆå¿…é¡»ç­‰å¾…è¿›è¡Œâ€˜çŸ³è•Šè¯•éªŒâ€™æ¨¡å—scriptæ‰§è¡Œå®Œæˆ, æ‰èƒ½å¼€å§‹æ³¨å…¥scriptã€‚è¿™æ˜¯å› ä¸º<code>&lt;script type=module&gt;</code>å§‹ç»ˆæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥åˆ«æ— å®ƒæ³•(å»¶è¿Ÿåˆ°loadäº‹ä»¶å)ã€‚</p><p>å¦ä¸€ç§å®ç°æ–¹å¼æ˜¯æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ<code>nomodule</code>, è¿™æ˜¯æ–¹å¼å¯ä»¥é¿å…ä¸Šè¿°çš„å»¶è¿ŸåŠ è½½é—®é¢˜, åªä¸è¿‡è¿™æ„å‘³ç€åƒSafari 10.1è¿™äº›æ”¯æŒæ¨¡å—, å´ä¸æ”¯æŒnomoduleçš„æµè§ˆå™¨ä¹Ÿä¼šè¢«å½“åšä¼ ç»Ÿæµè§ˆå™¨ï¼Œè¿™ä¹Ÿè®¸<a href="https://github.com/web-padawan/polymer3-webpack-starter/issues/33#issuecomment-474993984" target="_blank" rel="noopener">å¯èƒ½</a>æ˜¯<a href="https://jasonformat.com/modern-script-loading/" target="_blank" rel="noopener">å¥½äº‹</a>(ç›¸å¯¹äºä¸¤ä¸ªè„šæœ¬éƒ½åŠ è½½ä»¥åŠæœ‰ä¸€äº›bug)ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)  </span><br><span class="line"><span class="keyword">if</span> (<span class="string">'noModule'</span> <span class="keyword">in</span> s) &#123;  <span class="comment">// æ³¨æ„è¿™é‡Œçš„å¤§å°å†™</span></span><br><span class="line">  s.type = <span class="string">'module'</span></span><br><span class="line">  s.src = <span class="string">'/modern.js'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">  s.src = <span class="string">'/legacy.js'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.head.appendChild(s)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æŠŠå®ƒä»¬å°è£…æˆå‡½æ•°ï¼Œå¹¶ç¡®ä¿ä¸¤ç§æ–¹å¼éƒ½ç»Ÿä¸€ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼åŠ è½½(ä¸Šæ–‡æåˆ°æ¨¡å—scriptæ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¼ ç»Ÿscriptä¸æ˜¯):</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  $loadjs(<span class="string">"/modern.js"</span>,<span class="string">"/legacy.js"</span>)</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">$loadjs</span>(<span class="params">src,fallback,s</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="string">'noModule'</span> <span class="keyword">in</span> s) s.type = <span class="string">'module'</span>, s.src = src</span></span><br><span class="line"><span class="javascript">    <span class="keyword">else</span> s.async = <span class="literal">true</span>, s.src = fallback   <span class="comment">// ç»Ÿä¸€ä½¿ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.head.appendChild(s)</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹èµ·æ¥å·²ç»å¾ˆå®Œç¾äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ<strong>æˆ‘ä»¬è¿˜æ²¡è€ƒè™‘é¢„åŠ è½½(preloading)</strong></p><p>è¿™ä¸ªæœ‰ç‚¹è›‹ç–¼ï¼Œ å› ä¸ºä¸€èˆ¬æµè§ˆå™¨åªä¼šé™æ€åœ°æ‰«æHTMLï¼Œç„¶åæŸ¥æ‰¾å®ƒå¯ä»¥é¢„åŠ è½½çš„èµ„æºã€‚ æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„æ¨¡å—åŠ è½½å™¨æ˜¯å®Œå…¨åŠ¨æ€çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨æ²¡æœ‰è¿è¡Œæˆ‘ä»¬çš„ä»£ç ä¹‹å‰ï¼Œæ˜¯æ²¡åŠæ³•å‘ç°æˆ‘ä»¬è¦é¢„åŠ è½½ç°ä»£è¿˜æ˜¯ä¼ ç»Ÿçš„Javascriptèµ„æºçš„ã€‚</p><p>ä¸è¿‡æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œå°±æ˜¯ä¸å®Œç¾ï¼šå°±æ˜¯ä½¿ç”¨<code>&lt;link rel=modulepreload&gt;</code>æ¥é¢„åŠ è½½ç°ä»£ç‰ˆæœ¬çš„åŒ…, æ—§æµè§ˆå™¨ä¼šå¿½ç•¥è¿™æ¡è§„åˆ™ï¼Œç„¶è€Œç›®å‰<a href="https://developers.google.com/web/updates/2017/12/modulepreload" target="_blank" rel="noopener">åªæœ‰Chromeæ”¯æŒè¿™ä¹ˆåš</a>:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"modulepreload"</span> <span class="attr">href</span>=<span class="string">"/modern.js"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">self.modern=1</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- etc --&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å…¶å®é¢„åŠ è½½è¿™ç§æŠ€æœ¯æ˜¯å¦æœ‰æ•ˆï¼Œå–å†³äºåµŒå…¥ä½ çš„è„šæœ¬çš„HTMLæ–‡æ¡£çš„å¤§å°</strong>ã€‚</p><p>å¦‚æœä½ çš„HTMLè½½è·å¾ˆå°, æ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¯åŠ¨å±æˆ–è€…åªæ˜¯ç®€å•å¯åŠ¨å®¢æˆ·ç«¯åº”ç”¨ï¼Œé‚£ä¹ˆæ”¾å¼ƒé¢„åŠ è½½æ‰«æå¯¹ä½ çš„åº”ç”¨æ€§èƒ½å½±å“å¾ˆå°ã€‚<br>å¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“å¤§é‡æœ‰æ„ä¹‰çš„HTML, å¹¶ä»¥æµ(stream)çš„æ–¹å¼ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œé‚£ä¹ˆé¢„åŠ è½½æ‰«æå°±æ˜¯ä½ çš„æœ‹å‹ï¼Œä½†è¿™ä¹Ÿæœªå¿…æ˜¯æœ€ä½³æ–¹æ³•ã€‚</p><blockquote><p>è¯‘æ³¨: ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒåˆ†å—ç¼–ç ä¼ è¾“ï¼Œç­‰æœåŠ¡ç«¯å®Œå…¨è¾“å‡ºhtmlå¯èƒ½æœ‰ä¸€æ®µç©ºé—²æ—¶é—´ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡é¢„åŠ è½½æŠ€æœ¯ï¼Œè®©æµè§ˆå™¨é¢„å…ˆå»è¯·æ±‚èµ„æº</p></blockquote><p>å¤§æ¦‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"modulepreload"</span> <span class="attr">href</span>=<span class="string">"/modern.js"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">self.modern=1</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  $loadjs(<span class="string">"/modern.js"</span>,<span class="string">"/legacy.js"</span>)</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">$loadjs</span>(<span class="params">e,d,c</span>)</span>&#123;c=<span class="built_in">document</span>.createElement(<span class="string">"script"</span>),self.modern?(c.src=e,c.type=<span class="string">"module"</span>):c.src=d,<span class="built_in">document</span>.head.appendChild(c)&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæ”¯æŒ<a href="https://caniuse.com/#feat=es6-module" target="_blank" rel="noopener">JSæ¨¡å—çš„æµè§ˆå™¨</a>ä¸€èˆ¬ä¹Ÿ<a href="https://caniuse.com/#feat=link-rel-preload" target="_blank" rel="noopener">æ”¯æŒ</a><code>&lt;link rel = preload&gt;</code>ã€‚å¯¹äºæŸäº›ç½‘ç«™ï¼Œç›¸æ¯”ä¾é <code>modulepreload</code>, ä½¿ç”¨<code>&lt;link rel=preload as=script crossorigin&gt;</code>å¯èƒ½æ›´æœ‰æ„ä¹‰ã€‚ä¸è¿‡æ€§èƒ½ä¸Šé¢å¯èƒ½æ¬ ç‚¹ï¼Œå› ä¸ºä¼ ç»Ÿçš„è„šæœ¬é¢„åŠ è½½ä¸ä¼šåƒ<code>modulepreload</code>ä¸€æ ·éšç€æ—¶é—´çš„æ¨ç§»è€Œå»å±•å¼€è§£æå·¥ä½œ(<code>rel=preload</code>åªæ˜¯ä¸‹è½½ï¼Œä¸ä¼šå°è¯•å»è§£æè„šæœ¬)ã€‚</p><p><br></p><h2 id="é€‰é¡¹2-ç”¨æˆ·ä»£ç†å—…æ¢"><a href="#é€‰é¡¹2-ç”¨æˆ·ä»£ç†å—…æ¢" class="headerlink" title="é€‰é¡¹2: ç”¨æˆ·ä»£ç†å—…æ¢"></a>é€‰é¡¹2: ç”¨æˆ·ä»£ç†å—…æ¢</h2><p>æˆ‘åŠæ³•æ‹¿å‡ºä¸€ä¸ªç®€æ´çš„ä»£ç ç¤ºä¾‹ï¼Œå› ä¸ºç”¨æˆ·ä»£ç†æ£€æµ‹ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ï¼Œæ¨èé˜…è¯»è¿™ç¯‡<a href="https://www.smashingmagazine.com/2018/10/smart-bundling-legacy-code-browsers/" target="_blank" rel="noopener">Smashing Magazineæ–‡ç« </a></p><p>æœ¬è´¨ä¸Šï¼Œ<strong>è¿™ç§æŠ€æœ¯åœ¨æ¯ä¸ªæµè§ˆå™¨ä¸Šéƒ½ä½¿ç”¨<code>&lt;script src=bundle.js&gt;</code>æ¥åŠ è½½ä»£ç ï¼Œå½“<code>bundle.js</code>è¢«è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè§£ææµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†ï¼Œå¹¶é€‰æ‹©è¿”å›ç°ä»£ä»£ç è¿˜æ˜¯ä¼ ç»Ÿä»£ç ï¼Œå–å†³äºæµè§ˆå™¨æ˜¯å¦èƒ½è¢«è¯†åˆ«ä¸ºç°ä»£æµè§ˆå™¨</strong>.</p><p>å°½ç®¡è¿™ç§æ–¹æ³•æ¯”è¾ƒé€šç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ä¸¥é‡çš„ç¼ºç‚¹ï¼š</p><ul><li>å› ä¸ºä¾èµ–äºæœåŠ¡ç«¯å®ç°ï¼Œæ‰€ä»¥å‰ç«¯èµ„æºä¸èƒ½è¢«é™æ€éƒ¨ç½²(ä¾‹å¦‚é™æ€ç½‘ç«™ç”Ÿæˆå™¨(å¦‚github page)ï¼ŒNetlifyç­‰ç­‰)</li><li>å¾ˆéš¾è¿›è¡Œæœ‰æ•ˆçš„ç¼“å­˜. ç°åœ¨è¿™äº›JavaScript URLçš„ç¼“å­˜ä¼šå› ç”¨æˆ·ä»£ç†è€Œå¼‚ï¼Œè¿™æ˜¯éå¸¸ä¸ç¨³å®šçš„, è€Œå¾ˆå¤šç¼“å­˜æœºåˆ¶åªæ˜¯å°†URLä½œä¸ºç¼“å­˜é”®ï¼Œç°åœ¨è¿™äº›ç¼“å­˜ä¸­é—´ä»¶å¯èƒ½å°±æ²¡åŠæ³•å·¥ä½œäº†ã€‚</li><li>UAæ£€æµ‹å¾ˆéš¾ï¼Œå®¹æ˜“å‡ºç°è¯¯æŠ¥</li><li>ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²å®¹æ˜“è¢«ç¯¡æ”¹ï¼Œè€Œä¸”æ¯å¤©éƒ½æœ‰æ–°çš„UAå‡ºç°</li></ul><p>è§£å†³è¿™äº›é™åˆ¶çš„ä¸€ç§æ–¹æ³•å°±æ˜¯<strong>å°†<code>module/nomoduleæ¨¡å¼</code>ä¸â€™ç”¨æˆ·ä»£ç†åŒºåˆ†â€™ç»“åˆèµ·æ¥</strong>ï¼Œé¦–å…ˆè¿™å¯ä»¥é¿å…å•çº¯çš„<code>module/nomoduleæ¨¡å¼</code>éœ€è¦å‘é€å¤šä¸ªè½¯ä»¶åŒ…é—®é¢˜ï¼Œå°½ç®¡è¿™ç§æ–¹æ³•ä»ç„¶ä¼šé™ä½é¡µé¢(è¿™æ—¶å€™æŒ‡HTMLï¼Œè€Œä¸æ˜¯JavascriptåŒ…)çš„å¯ç¼“å­˜æ€§ï¼Œä½†æ˜¯å®ƒå¯ä»¥æœ‰æ•ˆåœ°è§¦å‘é¢„åŠ è½½ï¼Œå› ä¸ºç”ŸæˆHTMLçš„æœåŠ¡å™¨æ ¹æ®ç”¨æˆ·ä»£ç†çŸ¥é“åº”è¯¥ä½¿ç”¨<code>modulepreload</code>è¿˜æ˜¯<code>preload</code>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderPage</span>(<span class="params">request, response</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">let</span> html = <span class="string">`&lt;html&gt;&lt;head&gt;...`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> agent = request.headers.userAgent;</span><br><span class="line">  <span class="keyword">const</span> isModern = userAgent.isModern(agent);</span><br><span class="line">  <span class="keyword">if</span> (isModern) &#123;</span><br><span class="line">    html += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;link rel=modulepreload href=modern.mjs&gt;</span></span><br><span class="line"><span class="string">      &lt;script type=module src=modern.mjs&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    html += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;link rel=preload as=script href=legacy.js&gt;</span></span><br><span class="line"><span class="string">      &lt;script src=legacy.js&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  response.end(html);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºé‚£äº›å·²ç»åœ¨ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„ç½‘ç«™æ¥è¯´ï¼Œç”¨æˆ·ä»£ç†å—…æ¢æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ</p><p><br></p><h2 id="é€‰é¡¹-3-ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨"><a href="#é€‰é¡¹-3-ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨" class="headerlink" title="é€‰é¡¹ 3:ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨"></a>é€‰é¡¹ 3:ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨</h2><p><strong>æ³¨æ„è¿™é‡Œçš„â€˜æ—§ç‰ˆæœ¬æµè§ˆå™¨â€™ç‰¹æŒ‡é‚£äº›å‡ºç°åŒé‡åŠ è½½çš„æµè§ˆå™¨</strong>. å¯¹äº<code>module/nomoduleæ¨¡å¼</code>æ”¯æŒæ¯”è¾ƒå·®(å³åŒé‡åŠ è½½)çš„ä¸»è¦æ˜¯ä¸€äº›æ—§ç‰ˆæœ¬çš„Chromeã€Firefoxå’ŒSafari. å¹¸è¿çš„æ˜¯è¿™éƒ¨åˆ†æµè§ˆå™¨çš„å¸‚åœºèŒƒå›´é€šå¸¸æ˜¯æ¯”è¾ƒçª„ï¼Œå› ä¸ºç”¨æˆ·ä¼šè‡ªåŠ¨å‡çº§åˆ°æœ€æ–°çš„ç‰ˆæœ¬ã€‚Edge 16-18æ˜¯ä¾‹å¤–, ä½†è¿˜æœ‰å¸Œæœ›ï¼š æ–°ç‰ˆæœ¬çš„Edgeä¼šä½¿ç”¨åŸºäºChromiumçš„æ¸²æŸ“å™¨ï¼Œå¯ä»¥ä¸å—è¯¥é—®é¢˜çš„å½±å“.</p><p>å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ¥å—è¿™ä¸€ç‚¹å¦¥åæ˜¯å®Œå…¨åˆç†çš„ï¼šä½ å¯ä»¥ç»™90ï¼…çš„æµè§ˆå™¨ä¸­æä¾›ç°ä»£ä»£ç ï¼Œè®©ä»–ä»¬è·å¾—æ›´å¥½çš„ä½“éªŒï¼Œè€Œæå°‘æ•°æ—§æµè§ˆå™¨ä¸å¾—ä¸æŠ›å¼ƒå®ƒä»¬ï¼Œå®ƒä»¬åªæ˜¯ä»˜å‡ºçš„é¢å¤–å¸¦å®½(å³åŒé‡åŠ è½½)ï¼Œå¹¶ä¸å½±å“åŠŸèƒ½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå æ®ç§»åŠ¨ç«¯ä¸»è¦å¸‚åœºä»½é¢çš„ç”¨æˆ·ä»£ç†ä¸ä¼šæœ‰åŒé‡åŠ è½½é—®é¢˜ï¼Œæ‰€ä»¥è¿™äº›æµé‡ä¸å¤ªå¯èƒ½æ¥è‡ªäºä½é€Ÿæˆ–è€…é«˜æ˜‚æµé‡è´¹çš„æ‰‹æœºã€‚</p><p>å¦‚æœä½ çš„ç½‘ç«™ç”¨æˆ·ä¸»è¦ä½¿ç”¨ç§»åŠ¨è®¾å¤‡æˆ–è¾ƒæ–°ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„<code>module/nomodule</code>æ¨¡å¼å°†é€‚ç”¨äºä½ çš„ç»å¤§å¤šæ•°ç”¨æˆ·, å…¶ä»–ç”¨æˆ·å°±ä¸è€ƒè™‘äº†ï¼Œåæ­£ä¹Ÿæ˜¯å¯ä»¥è·‘èµ·æ¥çš„, ä¼˜å…ˆè€ƒè™‘å¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¿®å¤Safari 10.1 ä¸æ”¯æŒ `nomodule` é—®é¢˜: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">!<span class="function"><span class="keyword">function</span>(<span class="params">e,t,n</span>)</span>&#123;!(<span class="string">"noModule"</span><span class="keyword">in</span>(t=e.createElement(<span class="string">"script"</span>)))&amp;&amp;<span class="string">"onbeforeload"</span><span class="keyword">in</span> t&amp;&amp;(n=!<span class="number">1</span>,e.addEventListener(<span class="string">"beforeload"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">if</span>(e.target===t)n=!<span class="number">0</span>;<span class="keyword">else</span> <span class="keyword">if</span>(!e.target.hasAttribute(<span class="string">"nomodule"</span>)||!n)<span class="keyword">return</span>;e.preventDefault()&#125;,!<span class="number">0</span>),t.type=<span class="string">"module"</span>,t.src=<span class="string">"."</span>,e.head.appendChild(t),t.remove())&#125;(<span class="built_in">document</span>)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é€‚ç”¨äº90+% çš„æµè§ˆå™¨: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">modern.js</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- éƒ¨åˆ†æ”¯æŒmoduleä½†æ˜¯ä¸æ”¯æŒnomoduleçš„æµè§ˆå™¨ï¼Œä¹Ÿä¼šåŠ è½½ä¸‹é¢è„šæœ¬ï¼ŒèŒƒå›´å¯èƒ½å¾ˆå°ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¿½ç•¥å®ƒä»¬: --&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- IE, Edge &lt;16, Safari &lt;10.1, old desktop: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">legacy.js</span> <span class="attr">nomodule</span> <span class="attr">async</span> <span class="attr">defer</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="é€‰é¡¹-4-ä½¿ç”¨æ¡ä»¶åŒ…"><a href="#é€‰é¡¹-4-ä½¿ç”¨æ¡ä»¶åŒ…" class="headerlink" title="é€‰é¡¹ 4: ä½¿ç”¨æ¡ä»¶åŒ…"></a>é€‰é¡¹ 4: ä½¿ç”¨æ¡ä»¶åŒ…</h2><p><strong><code>nomodule</code>å¯ä»¥å·§å¦™åœ°ç”¨æ¥<em>æ¡ä»¶åŠ è½½</em>é‚£äº›ç°ä»£æµè§ˆå™¨ä¸éœ€è¦çš„ä»£ç </strong>ï¼Œ ä¾‹å¦‚polyfillsã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯polyfillå’Œbundleéƒ½ä¼šè¢«åŠ è½½(ä¾‹å¦‚Safari 10.1)ï¼Œä½†è¿™æ¯•ç«Ÿæ˜¯å°‘æ•°ã€‚é‰´äºç›®å‰é€šè¡Œçš„åšæ³•å°±æ˜¯åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­ä¸€è‡´åŒä»åœ°åŠ è½½polyfillsï¼Œç›¸æ¯”è€Œè¨€, <em>æ¡ä»¶polyfills</em>å¯ä»¥è®©å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨ç”¨æˆ·é¿å…åŠ è½½polyfillä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- newer browsers won't load this bundle: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"polyfills.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- all browsers load this one: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Angular CLIæ”¯æŒé…ç½®è¿™ç§æ–¹å¼æ¥åŠ è½½polyfill, æŸ¥çœ‹<a href="https://blog.mgechev.com/2019/02/06/5-angular-cli-features/#conditional-polyfill-serving" target="_blank" rel="noopener">Minko Gechevçš„ä»£ç ç¤ºä¾‹</a>.<br>äº†è§£äº†è¿™ç§æ–¹å¼ä¹‹åï¼Œæˆ‘å†³å®šåœ¨preact-cliä¸­æ”¯æŒè‡ªåŠ¨polyfillæ³¨å…¥ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¿™ä¸ª<a href="https://github.com/preactjs/preact-cli/pull/833/files" target="_blank" rel="noopener">PR</a></p><p>å¦‚æœä½ ä½¿ç”¨Webpackï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªhtml-webpack-plugin<a href="https://github.com/swimmadude66/webpack-nomodule-plugin" target="_blank" rel="noopener">æ’ä»¶</a>å¯ä»¥æ–¹ä¾¿åœ°ä¸ºpolyfillåŒ…æ·»åŠ <code>nomodule</code>å±æ€§.</p><p><br></p><h2 id="ä½ åº”è¯¥æ€ä¹ˆåš"><a href="#ä½ åº”è¯¥æ€ä¹ˆåš" class="headerlink" title="ä½ åº”è¯¥æ€ä¹ˆåš?"></a>ä½ åº”è¯¥æ€ä¹ˆåš?</h2><p>ç­”æ¡ˆå–å†³äºä½ çš„ä½¿ç”¨åœºæ™¯, é€‰æ‹©å’Œä½ ä»¬çš„æ¶æ„åŒ¹é…çš„é€‰é¡¹:<br>å¦‚æœä½ çš„åº”ç”¨åªæ˜¯å®¢æˆ·ç«¯æ¸²æŸ“, è€Œä¸”ä½ çš„HTMLä¸è¶…è¿‡ä¸€ä¸ª<code>&lt;script&gt;</code>ï¼Œé€‰é¡¹1æ¯”è¾ƒåˆé€‚ï¼›<br>å¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè€Œä¸”å¯ä»¥æ¥å—ç¼“å­˜é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©é€‰é¡¹2ï¼›<br>å¦‚æœä½ å¼€å‘çš„æ˜¯<a href="https://developers.google.com/web/updates/2019/02/rendering-on-the-web#rehydration" target="_blank" rel="noopener">åŒæ„åº”ç”¨</a>ï¼Œé¢„åŠ è½½çš„åŠŸèƒ½å¯èƒ½å¯¹ä½ å¾ˆé‡è¦ï¼Œè¿™æ—¶ä½ å¯ä»¥è€ƒè™‘é€‰é¡¹3å’Œ4.</p><p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œç›¸æ¯”è€ƒè™‘æ¡Œé¢ç«¯æµè§ˆå™¨èµ„æºä¸‹è½½æˆæœ¬ï¼Œæˆ‘æ›´å€¾å‘äºä¼˜åŒ–ç§»åŠ¨è®¾å¤‡è§£ææ—¶é—´. ç§»åŠ¨ç”¨æˆ·ä½“éªŒä¼šå—åˆ°æ•°æ®è§£æã€æµé‡è´¹ç”¨ï¼Œç”µæ± æ¶ˆè€—ç­‰å› ç´ çš„å½±å“ï¼Œè€Œæ¡Œé¢ç”¨æˆ·å¾€å¾€ä¸éœ€è¦è€ƒè™‘è¿™äº›å› ç´ ã€‚<br>å¦å¤–è¿™äº›ä¼˜åŒ–é€‚ç”¨äº90%çš„ç”¨æˆ·ï¼Œæ¯”å¦‚æˆ‘å·¥ä½œé¢å¯¹çš„å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½æ˜¯ä½¿ç”¨ç°ä»£æˆ–ç§»åŠ¨æµè§ˆå™¨çš„ã€‚</p><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><p>æœ‰å…´è¶£ç»§ç»­æ·±å…¥ï¼Ÿå¯ä»¥ä»ä¸‹é¢çš„æ–‡ç« å¼€å§‹æŒ–æ˜ï¼š</p><ul><li>Philçš„<a href="https://github.com/philipwalton/webpack-esnext-boilerplate/issues/1" target="_blank" rel="noopener">webpack-esnext-boilerplate</a>çš„ä¸€äº›é™„åŠ çš„èƒŒæ™¯.</li><li>Ralph<a href="https://github.com/zeit/next.js/pull/7704" target="_blank" rel="noopener">åœ¨Next.jsä¸­å®ç°äº†module/nomodule</a>, å¹¶åŠªåŠ›è§£å†³äº†ä¸Šé¢çš„é—®é¢˜.</li></ul><p>æ„Ÿè°¢<a href="https://twitter.com/philwalton" target="_blank" rel="noopener">Phil</a>, <a href="https://twitter.com/shubhie" target="_blank" rel="noopener">Shubhie</a>, <a href="https://twitter.com/atcastle" target="_blank" rel="noopener">Alex</a>, <a href="https://twitter.com/hdjirdeh" target="_blank" rel="noopener">Houssein</a>, <a href="https://twitter.com/Janicklas" target="_blank" rel="noopener">Ralph</a> ä»¥åŠ <a href="https://twitter.com/addyosmani" target="_blank" rel="noopener">Addy</a> çš„åé¦ˆ.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡åœ°å€: &lt;a href=&quot;https://jasonformat.com/modern-script-loading/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Modern Script Loading&lt;/a&gt;, æ–‡ç« ä½œè€…æ˜¯Preactä½œè€…&lt;a 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Javascriptç«Ÿç„¶æ²¡æœ‰æ ‡å‡†åº“?</title>
    <link href="https://bobi.ink/2019/07/16/js-stdlib/"/>
    <id>https://bobi.ink/2019/07/16/js-stdlib/</id>
    <published>2019-07-15T16:00:00.000Z</published>
    <updated>2019-08-12T04:27:48.955Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨SegmentFaultçƒ­å¿ƒè§£é¢˜ï¼Œä¸€ä¸ªé—®é¢˜æ¯”è¾ƒè®©æˆ‘æ¯”è¾ƒå°è±¡æ·±åˆ»ï¼š<em>ä¸€ä¸ªåˆå­¦è€…è¯•å›¾åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥Node.jsçš„netæ¨¡å—ã€‚ç»“æœåœ¨æ§åˆ¶å°æ‰“å°åæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</em>ã€‚</p><p>å¯¹äºæœ‰ç‚¹Javascriptç»éªŒçš„äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜å¼±æ™ºâ€™é—®é¢˜ï¼Œæ€ä¹ˆå¯ä»¥åœ¨æµè§ˆå™¨ç«¯è¿è¡ŒNodeç¨‹åºå‘¢ï¼Ÿå› ä¸ºè¿™äº›Nodeæ¨¡å—ç»è¿‡<a href="http://webpack.docschina.org/configuration/node/#å…¶ä»–-node-js-æ ¸å¿ƒåº“-node-js-core-libraries-" target="_blank" rel="noopener">Webpackå¤„ç†</a>, æ‰€ä»¥å˜æˆäº†ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ›´å¥½çš„å¤„ç†æ–¹å¼åº”è¯¥æ˜¯æŠ›å‡ºå¼‚å¸¸.</p><p><strong>ä»”ç»†åæ€ä¸€ä¸‹ï¼Œå¯¹äºè¿™äº›åˆšå…¥é—¨Javascriptçš„æˆ–è€…ä»å…¶ä»–è¯­è¨€åˆ‡æ¢è¿‡æ¥çš„å¼€å‘è€…ï¼Œä»–ä»¬å‹æ ¹å°±æ²¡æœ‰æ¦‚å¿µï¼Œæ¯”å¦‚Pythonã€Rubyã€Javaè¿™äº›è¯­è¨€éƒ½æœ‰å¼ºå¤§çš„æ ‡å‡†åº“ï¼Œå¯ä»¥æ»¡è¶³80%çš„å¼€å‘éœ€æ±‚ï¼Œä¸ç®¡å®ƒåœ¨ä»€ä¹ˆç¯å¢ƒã€ä»€ä¹ˆå¹³å°è¿è¡Œï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥ç»Ÿä¸€ä½¿ç”¨è¿™å¥—æ ‡å‡†åº“ã€‚è€ŒJavascriptç›®å‰çš„ç°çŠ¶æ˜¯ï¼šä¸åŒçš„è¿è¡Œç¯å¢ƒï¼ŒAPIç»“æ„æ˜¯å‰²è£‚çš„</strong>ã€‚</p><p>Javascriptè¿™é—¨åå‡ å¤©å¼€å‘å‡ºæ¥çš„ã€ä¸“ä¾›æµè§ˆå™¨çš„è¯­è¨€ï¼Œå¯èƒ½å½“åˆè®¾è®¡æ˜¯æ ¹æœ¬å°±æ²¡æœ‰è€ƒè™‘æ ‡å‡†åº“è¿™äº›ç©æ„ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿï¼Œç½‘ç»œç­‰ç­‰ã€‚<strong>å› ä¸ºè¿™ä¸ªèƒŒæ™¯, Javascripté•¿æœŸä¸å…·å¤‡ç‹¬ç«‹æ€§ï¼Œå®ƒæ·±åº¦ä¾èµ–äºæµè§ˆå™¨è¿™ä¸ªè¿è¡Œç¯å¢ƒ, å¤„äºä¸€ç§ç»™æµè§ˆå™¨æ‰“è¾…åŠ©çš„è§’è‰²</strong>, æ‰€ä»¥Javascriptå¾ˆå¤šå¹´æ²¡æœ‰èµ°å‡ºæµè§ˆå™¨ç©å…·è¯­è¨€è¿™ä¸ªèŒƒå›´.</p><p>å½“ç„¶è¿™æ—¢æ˜¯åŠ£åŠ¿ï¼Œä¹Ÿæ˜¯ä¼˜åŠ¿, ç°åœ¨æ²¡ä»»ä½•è¯­è¨€èƒ½æ’¼åŠ¨Javascriptåœ¨æµè§ˆå™¨ä¸­çš„åœ°ä½ã€‚</p><p>æˆ‘æƒ³å¾ˆå¤šäººè·Ÿæˆ‘å½“åˆä¸€æ ·è®¤ä¸º<strong>æµè§ˆå™¨æä¾›çš„Web API === Javascriptçš„æ ‡å‡†åº“</strong>, æ¯”å¦‚<code>console.log</code>ã€<code>setTimeout</code>(ä¸‹æ–‡ä¼šä»‹ç»è¿™äº›åŠŸèƒ½éƒ½ä¸åœ¨Javascriptè§„èŒƒé‡Œé¢). æ­£å¦‚å½“å¹´é‚£äº›æŠŠJQueryå½“æˆâ€˜Javascriptâ€™çš„äºº.</p><p>ç›´åˆ°NodeJSçš„å‡ºç°ï¼ŒJavascriptæ‰æŒ£è„±æµè§ˆå™¨çº¦æŸï¼Œå»¶ä¼¸åˆ°æœåŠ¡å™¨é¢†åŸŸ, ä¸å†æ˜¯ä¸€ä¸ªâ€™æ²™ç›’è¯­è¨€â€™ã€‚NodeJSå®šä¹‰äº†å¾ˆå¤šæ¨¡å—æ¥æ”¯æ’‘æœåŠ¡ç«¯çš„å¼€å‘, å¦‚fsã€osã€Bufferã€netã€‚ä½†æ˜¯è¿™äº›APIä¸€æ ·ä¸æ˜¯Javascriptçš„æ ‡å‡†ã€ä¹Ÿå°±æ˜¯è¯´<strong>NodeJS !== Javascript</strong>.</p><p>å†åˆ°åæ¥ï¼Œå­¦ä¸åŠ¨äº†ï¼ŒNodeJSåŸä½œè€…åæ§½äº†ä¸€é€šNodeJSï¼Œåˆæå‡ºäº†ä¸€ä¸ª<a href="https://deno.land" target="_blank" rel="noopener">Deno</a>, å®ƒä¹Ÿä¼šæœ‰è‡ªå·±æ ‡å‡†åº“ï¼Œä¼šå®šä¹‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œAPIã€‚ä»åå­—ä¸Šå°±æš—ç¤ºç€è¿™äº›APIä¸å¯èƒ½å’ŒNodeJSå…¼å®¹ã€‚Okï¼Œç°åœ¨å›åˆ°æ–‡ç« å¼€å§‹é‚£ä¸ªé—®é¢˜ï¼Œ<strong>å¦‚æœdenoå‘å±•èµ·æ¥ï¼Œè¯´ä¸å®šå“ªå¤©åˆæœ‰äººå°è¯•åœ¨æµè§ˆå™¨å¼•ç”¨Denoçš„æ¨¡å—</strong>ï¼Ÿ</p><p><br><br><br></p><h2 id="ç°æœ‰çš„javascript-apiç»“æ„"><a href="#ç°æœ‰çš„javascript-apiç»“æ„" class="headerlink" title="ç°æœ‰çš„Javascript APIç»“æ„"></a>ç°æœ‰çš„Javascript APIç»“æ„</h2><p><img src="/images/js-stdlib/outline.png" alt></p><p>å¦‚ä¸Šå›¾, Javascriptå…¶å®æ˜¯æœ‰ä¸€å±‚æ¯”è¾ƒè–„å…¨å±€çš„ã€é€šç”¨çš„ã€<strong>æ ‡å‡†çš„</strong>ã€æ ¸å¿ƒçš„APIå±‚ï¼Œå³<code>æ ‡å‡†å†…ç½®å¯¹è±¡</code>ï¼Œè¿™æ˜¯ä¸€äº›è¯­è¨€æ ¸å¿ƒçš„å†…ç½®å¯¹è±¡ï¼Œå¯ä»¥å…¨å±€è®¿é—®ã€‚å…³é”®çš„æ˜¯è¿™äº›æ˜¯æ ‡å‡†çš„ï¼Œå®ƒä»¬åœ¨<a href="https://tc39.es/ecma262/#sec-global-object" target="_blank" rel="noopener">ECMAScriptè§„èŒƒ</a>ä¸­è¢«å®šä¹‰. åœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šï¼Œä¸åŒçš„è¿è¡Œç¯å¢ƒæ‹“å±•äº†è‡ªå·±çš„APIã€‚</p><p>ä»¥æµè§ˆå™¨ä¸ºä¾‹:</p><p><img src="/images/js-stdlib/brw.png" alt></p><p>æµè§ˆå™¨ç«¯çš„Web APIæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚APIé›†åˆï¼Œä¸Šå›¾æ€»ç»“äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬å°±åŒ…å«ä¸¤å—ä¸œè¥¿:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model" target="_blank" rel="noopener">Core DOM</a>. DOMæ˜¯ä¸€ä¸ªé€šç”¨çš„æŠ€æœ¯ï¼Œä¸ä»…ä»…å±€é™äºæµè§ˆå™¨ï¼Œè¿™ä¸ªè§„èŒƒå®šä¹‰äº†ç»“æ„åŒ–(structured document)æ–‡æ¡£çš„è§£æå’Œæ“ä½œè§„èŒƒã€‚å®šä¹‰äº†åŸºæœ¬çš„èŠ‚ç‚¹ç±»å‹å’Œæ“ä½œæ–¹æ³•ã€‚ä¸å±€é™äºHTMLçš„æ“ä½œ</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM" target="_blank" rel="noopener">HTML DOM</a>. å¯ä»¥è®¤ä¸ºæ˜¯Core DOMçš„æ‰©å±•ï¼Œè¿™é‡Œé¢å®šä¹‰äº†å„ç§HTMLå…ƒç´ å¯¹è±¡ç±»å‹ã€æ‰©å±•äº†å…ƒç´ çš„æ“ä½œæ–¹æ³•ï¼Œå¦å¤–è¿˜åŒ…å«äº†æµè§ˆå™¨ç›¸å…³çš„æ¥å£ï¼Œå¦‚XMLHttpRequestã€‚è¿™ä¸€å—é€šå¸¸ä¹Ÿè¢«ç»Ÿç§°ä¸ºBOM</li></ul><p>WebAPIåŸºæœ¬æ¦‚è§ˆ:</p><p><img src="/images/js-stdlib/webAPI.png" alt></p><p>å¦‚æœä½ æœ‰ç•™å¿ƒæŸ¥çœ‹MDNæ–‡æ¡£ä¸‹é¢çš„è§„èŒƒå¼•ç”¨ï¼Œä½ ä¼šå‘ç°æœ‰äº›è§„èŒƒå¼•ç”¨äº†<a href="https://www.w3.org/TR/" target="_blank" rel="noopener">W3C</a>, æœ‰äº›åˆ™å¼•ç”¨äº†<a href="https://html.spec.whatwg.org/multipage/" target="_blank" rel="noopener">WHATWG</a>. åˆ°åº•è°è¯´äº†ç®—?</p><p>å¦‚æœä½ æ€å¼€é”…ç›–ï¼Œå°±ä¼šå‘ç°è¿™æ˜¯ä¸€åœºé—¹å‰§. å¦‚æœå‰é˜µå­æœ‰å…³æ³¨æ–°é—»ï¼Œä¼šçœ‹åˆ°è¿™äº›æ ‡é¢˜â€˜<em>WHATWG å‡»è´¥ W3Cï¼Œèµ¢å¾— HTML å’Œ DOM çš„æ§åˆ¶æƒ</em>â€™ã€â€™<em>W3Cå°†ä¸WHATWGåˆä½œåˆ¶å®šæœ€æ–°HTMLå’ŒDOMè§„èŒƒæ ‡å‡†</em>â€˜. å¤§æ¦‚å¯ä»¥çŒœå‡ºè¿™ä¸¤ä¸ªç»„ç»‡ä¹‹é—´çš„å…³ç³». æœ¬æ–‡å°±ä¸æ‰¯è¿™äº›â€˜å…«å¦â€™äº†ï¼Œç›¸å…³èƒŒæ™¯å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.infoq.cn/article/bsvFxt96DOh-SBZphBwJ" target="_blank" rel="noopener">WHATWG å‡»è´¥ W3Cï¼Œèµ¢å¾— HTML å’Œ DOM çš„æ§åˆ¶æƒ</a></p><p>ç›¸å¯¹è€Œè¨€, è¯­è¨€å±‚åˆ™ç”±ECMAScriptè§„èŒƒå®šä¹‰çš„ï¼Œæ¯”è¾ƒç‹¬ç«‹, è¿‘äº›å¹´æˆæœä¹Ÿæ¯”è¾ƒæ˜¾è‘—.</p><p><br></p><h3 id="æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿"><a href="#æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿" class="headerlink" title="æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿"></a>æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿</h3><ul><li>ç‰¹æ®Šå€¼<ul><li>Infinity</li><li>NaN</li><li>undefined</li><li>null</li><li>globalThis</li></ul></li><li>å‡½æ•°<ul><li>eval()</li><li>uneval() </li><li>isFinite()</li><li>isNaN()</li><li>parseFloat()</li><li>parseInt()</li><li>decodeURI()</li><li>decodeURIComponent()</li><li>encodeURI()</li><li>encodeURIComponent()</li></ul></li><li>åŸºç¡€å¯¹è±¡<ul><li>Object</li><li>Function</li><li>Boolean</li><li>Symbol</li><li>Error</li><li>EvalError</li><li>InternalError </li><li>RangeError</li><li>ReferenceError</li><li>SyntaxError</li><li>TypeError</li><li>URIError</li></ul></li><li>æ•°å€¼å’Œæ—¶é—´<ul><li>Number</li><li>BigInt</li><li>Math</li><li>Date</li></ul></li><li>æ–‡æœ¬å¤„ç†<ul><li>String</li><li>RegExp</li></ul></li><li>ç´¢å¼•å®¹å™¨<ul><li>Array</li><li>â€˜TypedArrayâ€™</li></ul></li><li>é”®å€¼å®¹å™¨<ul><li>Map</li><li>Set</li><li>WeakMap</li><li>WeakSet</li></ul></li><li>ç»“æ„åŒ–æ•°æ®<ul><li>ArrayBuffer</li><li>SharedArrayBuffer </li><li>Atomics </li><li>DataView</li><li>JSON</li></ul></li><li>æ§åˆ¶æŠ½è±¡åŒ–å¯¹è±¡<ul><li>Promise</li><li>Generator</li><li>GeneratorFunction</li><li>AsyncFunction </li></ul></li><li>åå°„<ul><li>Reflect</li><li>Proxy</li></ul></li><li>å›½é™…åŒ–<ul><li>Intl</li></ul></li><li>WebAssembly</li><li>å…¶ä»–<ul><li>arguments</li></ul></li></ul><p><br></p><p>è¿™äº›å…¨å±€åŸºæœ¬å¯¹è±¡æ•°é‡å¾ˆå°‘, è¿™äº›å¯¹è±¡æ˜¯æ¯ä¸ªJavaScriptå¼€å‘è€…å¿…é¡»æŒæ¡çš„. </p><p>å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨çš„éå¸¸é¢‘ç¹çš„Timerå’ŒConsoleéƒ½ä¸å†æ­¤åˆ—.</p><p>è¿™äº›å¯¹è±¡åªèƒ½æ»¡è¶³å¾ˆåŸºæœ¬å¼€å‘éœ€æ±‚, æ ¹æœ¬ä¸èƒ½å’Œå…¶ä»–è¯­è¨€çš„æ ‡å‡†åº“ç›¸æ¯”. <strong>å½“ç„¶è¿™å’Œè¯­è¨€çš„å®šä½ä¹Ÿæœ‰ä¸€å®šå…³ç³»</strong></p><p><br><br><br></p><h2 id="ä»€ä¹ˆæ˜¯æ ‡å‡†åº“"><a href="#ä»€ä¹ˆæ˜¯æ ‡å‡†åº“" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ‡å‡†åº“?"></a>ä»€ä¹ˆæ˜¯æ ‡å‡†åº“?</h2><p>æ ‡å‡†åº“æ²¡æœ‰ä¸€ä¸ªä¸¥æ ¼çš„å®šä¹‰ï¼ŒæŒ‰ç…§Wikiçš„è¯´æ³•æ ‡å‡†åº“å°±æ˜¯<strong>è¯¥è¯­è¨€åœ¨ä¸åŒå®ç°ä¸­éƒ½æŒ‰ä¾‹æä¾›çš„åº“</strong>, æ¯”å¦‚Rubyå®˜æ–¹å®ç°cRubyå’ŒåŸºäºJVMçš„JRubyéƒ½æŒ‰ç…§å®˜æ–¹æ ‡å‡†åº“è§„èŒƒå®ç°äº†æ ‡å‡†åº“ã€‚ <strong>æ ‡å‡†åº“æ€ä¹ˆè®¾è®¡ï¼Œéœ€è¦åŒ…å«ä»€ä¹ˆå†…å®¹å–å†³äºè¯­è¨€å„è‡ªç§‰æŒçš„å“²å­¦å’Œå®šä½</strong>ã€‚ æˆ‘è®¤ä¸ºæ ‡å‡†åº“åº”è¯¥æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li>æ ‡å‡†åŒ–çš„. æœ‰è§„èŒƒæ˜ç¡®å®šä¹‰å®ƒçš„å†…å®¹å’Œè¡Œä¸º</li><li>å†…å®¹ç»è¿‡ä»”ç»†é›•ç¢å’ŒæŒ‘é€‰ï¼Œå¯ä»¥è¦†ç›–å¤§éƒ¨åˆ†ä½¿ç”¨åœºæ™¯æˆ–è€…ç¬¦åˆçš„è¯­è¨€å®šä½</li><li>å¯é€‰çš„ã€æŒ‰éœ€å¯¼å…¥. æ ‡å‡†åº“ä¸æ˜¯å…¨å±€çš„ï¼Œéœ€è¦é€šè¿‡æ¨¡å—å¯¼å…¥, éå¼ºåˆ¶æ€§ä½¿ç”¨</li></ul><p><br></p><p>è‡³äºæ ‡å‡†åº“éœ€è¦åŒ…å«ä»€ä¹ˆå†…å®¹ï¼Œå¯ä»¥å‚è€ƒå…¶ä»–è¯­è¨€çš„å®ç°ã€‚æ¯”å¦‚ï¼š</p><ul><li><a href="https://golang.org/pkg/" target="_blank" rel="noopener">go</a></li><li><a href="http://ruby-doc.org/stdlib-2.6.3/" target="_blank" rel="noopener">ruby</a></li><li><a href="https://docs.python.org/3/library/index.html" target="_blank" rel="noopener">python</a></li></ul><p><br></p><p>å¤§æ¦‚åˆ†æä¸€ä¸‹ï¼Œå®ƒä»¬æ ‡å‡†åº“å¤§è‡´éƒ½æœ‰è¿™äº›å†…å®¹ï¼š</p><ul><li>ç½‘ç»œåè®®</li><li>æ–‡ä»¶ç³»ç»Ÿ<ul><li>æ–‡ä»¶ç³»ç»Ÿ</li><li>æµ</li><li>æ ‡å‡†è¾“å…¥è¾“å‡º</li><li>äºŒè¿›åˆ¶å¤„ç†</li></ul></li><li>ç®—æ³•<ul><li>å¯†ç ç®—æ³•</li><li>ç¼–ç </li><li>å‹ç¼©ã€å½’æ¡£</li><li>æ’åº</li><li>æ•°å­¦</li><li>å­—ç¬¦ä¸²ã€æ–‡æœ¬</li></ul></li><li>æ•°æ®ç»“æ„, ä¾‹å¦‚æ ‘ã€å †ã€é˜Ÿåˆ—ç­‰ç­‰</li><li>æ•°æ®æŒä¹…åŒ–å’Œåºåˆ—åŒ–. æ¯”å¦‚JSONåºåˆ—åŒ–ï¼ŒäºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œæ•°æ®åº“æ“ä½œç­‰ç­‰</li><li>è°ƒè¯•/è¾…åŠ©</li><li>å•å…ƒæµ‹è¯•</li><li>æ–‡æ¡£å¤„ç†</li><li>è®¾è®¡æ¨¡å¼. æ ‡å‡†åº“ä¸­ç»å¸¸ä¼šæºå¸¦(æˆ–è¾…åŠ©è®¾è®¡)è¯¥è¯­è¨€çš„æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼, ä¾‹å¦‚goä¸­çš„context, Rubyä¸­çš„singleton</li><li>å›½é™…åŒ–</li><li>æ—¶é—´ã€æ—¥æœŸ</li><li>æ“ä½œç³»ç»Ÿ<ul><li>å‘½ä»¤è¡Œ</li><li>ç¯å¢ƒå˜é‡</li><li>ç³»ç»Ÿèµ„æº</li></ul></li><li>å¹¶å‘<ul><li>è¿›ç¨‹</li><li>çº¿ç¨‹</li><li>åç¨‹</li></ul></li><li>è¯­è¨€æˆ–è¿è¡Œæ—¶çš„åº•å±‚æ¥å£</li></ul><p>å¤§éƒ¨åˆ†è¯­è¨€çš„æ ¸å¿ƒéƒ½å¾ˆå°(C++é™¤å¤–)ï¼Œæˆ‘ä»¬å­¦ä¸€é—¨è¯­è¨€ï¼Œå¤§éƒ¨åˆ†æ—¶é—´æ˜¯èŠ±åœ¨æ ‡å‡†åº“ä¸Šå’Œè¯­è¨€çš„ç”Ÿæ€ä¸Šé¢ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°è¿™äº›æ ‡å‡†åº“ä¸€èˆ¬éƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰ç»éªŒçš„å¼€å‘è€…å¯ä»¥å¾ˆå¿«åœ°å…¥æ‰‹ä¸€é—¨è¯­è¨€.</p><p>æ˜¾ç„¶ä¸Šé¢è¿™äº›åŠŸèƒ½å¤§éƒ¨åˆ†åœ¨NodeJSä¸­å·²ç»å®ç°äº†ï¼Œ<strong>é‰´äºNodeJSè¿™ä¹ˆå¹¿æ³›çš„ä½¿ç”¨ç‡ï¼ŒNodeJSå¯ä»¥ç®—æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†äº†</strong></p><p><br></p><h2 id="æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“"><a href="#æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“" class="headerlink" title="æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“?"></a>æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“?</h2><p><img src="/images/js-stdlib/dep.png" alt></p><p>æ˜¾ç„¶è¦ç»“åˆå½“å‰çš„èƒŒæ™¯æ¥è¾©è¯åœ°è€ƒè™‘ã€‚</p><p><strong>æœ‰æ ‡å‡†åº“æœ‰ä»€ä¹ˆå¥½å¤„?</strong></p><ul><li>æ ‡å‡†åº“æä¾›é€šç”¨ã€å®šä¹‰è‰¯å¥½ã€ä¼˜åŒ–çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼Œå‡å°‘ç¬¬ä¸‰æ–¹æ¨¡å—ä¾èµ–, è€Œä¸”ç¬¬ä¸‰æ–¹åº“å¾ˆéš¾ä¿è¯è´¨é‡</li><li>é¿å…ç¤¾åŒºå‰²è£‚, æŠšå¹³ä¸åŒè¿è¡Œç¯å¢ƒçš„å·®å¼‚. ç°åœ¨æœ‰NodeJSã€åé¢æœ‰Denoï¼Œå¯èƒ½è¿˜ä¼šæœ‰Aenoã€Beno, å°½ç®¡å–ä»£NodeJSçš„å¯èƒ½æ€§å¾ˆä½ï¼Œæœ‰è§„èŒƒåŒ–çš„æ ‡å‡†åº“å¯ä»¥é¿å…é‡å¤é€ è½®å­ï¼Œä¸ç„¶çœŸä¼šå­¦ä¸åŠ¨</li><li>å®‰å…¨æ€§. <a href="https://mp.weixin.qq.com/s/UEPZwFuousrRVj17zZU80w" target="_blank" rel="noopener">è¿‘æœŸnpmå®‰å…¨äº‹ä»¶é¢‘å‘</a>ï¼ŒæŠ•æ¯’ã€åˆ åº“(left-padäº‹ä»¶)ã€npmå•†ä¸šè¿ä½œ, ç»™ç¤¾åŒºå¸¦äº†ä¸å°‘éº»çƒ¦ã€‚è€Œæ ‡å‡†åº“ç”±è¿è¡Œç¯å¢ƒå†…ç½®ï¼Œå¯ä»¥é¿å…å¼•ç”¨ç¬¬ä¸‰æ–¹åº“å¯¼è‡´çš„å®‰å…¨é—®é¢˜</li><li>ä»Šå¤©çš„Javascriptåº”ç”¨ä¼šæœ‰å¾ˆå¤šä¾èµ–(node_modules hell)ï¼Œæ‰“åŒ…å‡ºæ¥çš„ä½“ç§¯å¾ˆå¤§ï¼Œç½‘ç»œåŠ è½½å’Œè„šæœ¬è§£æéœ€è¦è€—è´¹ä¸€å®šçš„èµ„æºï¼Œè€Œä¸”è¿™äº›èµ„æºä¸èƒ½åœ¨å¤šä¸ªåº”ç”¨ä¹‹é—´è¢«ç¼“å­˜. ä¸€ä¸ªå¾ˆå¤§çš„åŸå› æ˜¯npmçš„ä¾èµ–è¿‡äºé›¶ç¢(æ¯”å¦‚å‡ è¡Œä»£ç çš„åŒ…)å’Œé‡å¤(ä¾èµ–ä¸åŒçš„ç‰ˆæœ¬ã€Dead Code)ï¼Œä½¿ç”¨æ ‡å‡†åº“å¯ä»¥å‡å°‘è¿™éƒ¨åˆ†ä¾èµ–</li><li>é€‰æ‹©å›°éš¾ç—‡. æ²¡æœ‰æ ‡å‡†åº“ï¼Œå¯ä»¥é€‰æ‹©npmä¸Šçš„ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨npmä¸ŠæŒ‘é€‰é è°±ã€é«˜è´¨é‡çš„åº“æ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´æˆæœ¬çš„. æœ‰æ—¶å€™æˆ‘ä»¬å°±æ˜¯æ‡’å¾—å»æ¯”è¾ƒå’Œé€‰æ‹©</li><li>ä¼˜é›…çš„æ ‡å‡†åº“ï¼Œæ˜¯å­¦ä¹ çš„æ¦œæ ·. ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½æ˜¯é’»ç ”æ ‡å‡†åº“ç®—æ³•å’Œå®ç°çš„ï¼Œå¯¹è¯­è¨€çš„å¼€å‘è€…æ¥è¯´æ ‡å‡†åº“æ˜¯ä¸€å—å®è—</li><li>å­¦ä¹ æˆæœ¬ã€‚å…¶ä»–è¯­è¨€çš„å¼€å‘è€…ï¼Œå¯ä»¥è¾ƒå¿«å…¥æ‰‹</li></ul><p><br></p><p><strong>æ ‡å‡†åº“å¯èƒ½ä¼šæœ‰ä»€ä¹ˆé—®é¢˜?</strong></p><ul><li>æ ‡å‡†å¯èƒ½æ»åè·Ÿä¸ä¸Šç¤¾åŒºå‘å±•. Javascriptæ­£å¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼Œå¾ˆå¤šè§„èŒƒçš„å®šä¹‰æ˜¯ç”±ç¤¾åŒºé©±åŠ¨çš„ï¼Œæ¯”å¦‚Promiseã€async/await. è·Ÿä¸ä¸Šç¤¾åŒºçš„å‘å±•ç»“æœå¯èƒ½å°±æ˜¯æ²¡äººç”¨</li><li>æƒ³ä¸‹WebComponentç›®å‰çš„å¢ƒé‡</li><li>æ ‡å‡†åº“ä¸å¯èƒ½æ»¡è¶³æ‰€æœ‰äººçš„å£å‘³</li></ul><p><br></p><p><strong>å¦‚ä½•è®¾è®¡æ ‡å‡†åº“? æ ‡å‡†åº“æ¨è¿›è¿›ç¨‹å¯èƒ½ä¼šæœ‰ä»€ä¹ˆéšœç¢?</strong></p><ul><li>NodeJSå·²ç»æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†, æ€ä¹ˆå…¼å®¹ç°æœ‰çš„ç”Ÿæ€?</li><li>æ ‡å‡†åº“åº”è¯¥åŒ…å«ä»€ä¹ˆå†…å®¹ï¼Œå¦‚ä½•ä¿æŒå’Œç¤¾åŒºåŒæ­¥?</li><li><p>å¦‚ä½•æŠŠæ§æ ‡å‡†åº“å†…å®¹çš„å°ºåº¦? </p><p>æœ€å°åŒ–çš„æ ‡å‡†åº“å®¹æ˜“è¢«ç»´æŠ¤å’Œå‡çº§ï¼Œä½†å¯èƒ½å‡ºç°â€™æ²¡ä»€ä¹ˆåµç”¨â€™çš„æƒ…å†µï¼›</p><p>æœ€å¤§åŒ–çš„æ ‡å‡†åº“ï¼Œä¾‹å¦‚Javaçš„æ ‡å‡†åº“ï¼Œå‡ ä¹åŒ…å«äº†æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªä¸œè¥¿, ä½†æ˜¯è¿‡äº†å‡ å¹´å¾ˆå¤šAPIå°±ä¼šå˜å¾—è¿‡æ—¶ï¼Œä¸€èˆ¬ä¸ºäº†ä¿æŒå‘ä¸‹å…¼å®¹ï¼Œè¿™äº›APIä¼šä¸€ç›´åƒä¸€æ ¹åˆºä¸€æ ·å¡åœ¨é‚£é‡Œ.<br>å¦ä¸€ä¸ªéå¸¸å…¸å‹çš„åä¾‹å°±æ˜¯PHPçš„æ ‡å‡†åº“ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°å„ç§é£æ ¼çš„API.</p><p>æ ‡å‡†åº“æ˜¯è·Ÿéšè¯­è¨€å‘å¸ƒçš„ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†è¿‡æ—¶çš„APIï¼Œåˆæƒ³å‡çº§è¯­è¨€ç‰ˆæœ¬ï¼Œå°±éœ€è¦é‡æ„é¡¹ç›®ã€‚è€Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åˆ™å¯èƒ½å¯ä»¥ä¿æŒä¸åŠ¨ã€‚</p></li><li><p>Javascriptçš„ä¸»è¦æˆ˜åœºè¿˜æ˜¯æµè§ˆå™¨, æ ‡å‡†åº“æ˜¯å¦åº”è¯¥æœ‰ä¸€ä¸ªâ€™åŸºæœ¬ç‰ˆâ€™(ç”¨äºæµè§ˆå™¨æˆ–è€…ä¸€äº›æŠ½è±¡æ“ä½œç³»ç»Ÿçš„è¿è¡Œç¯å¢ƒ), è¿˜æœ‰ä¸ªâ€™æ——èˆ°ç‰ˆâ€™(æœåŠ¡ç«¯), æˆ–è€…åªæä¾›ä¸€ä¸ªè·¨è¶Šæ‰€æœ‰å¹³å°çš„æ ‡å‡†åº“?</p></li><li>å¦‚ä½•å¤„ç†å…¼å®¹æ€§é—®é¢˜? è€æ—§æµè§ˆå™¨å¦‚ä½•Polyfill?</li><li>å¦‚ä½•ä¸ç°æœ‰çš„å…¨å±€å¯¹è±¡æˆ–ç”¨æˆ·æ¨¡å—åˆ†ç¦»ï¼Ÿ</li></ul><p><br></p><h2 id="è¿‘æœŸçš„ä¸€äº›å°è¯•"><a href="#è¿‘æœŸçš„ä¸€äº›å°è¯•" class="headerlink" title="è¿‘æœŸçš„ä¸€äº›å°è¯•"></a>è¿‘æœŸçš„ä¸€äº›å°è¯•</h2><ul><li><a href="https://github.com/tc39/proposal-javascript-standard-library" target="_blank" rel="noopener">proposal-javascript-standard-library</a> è¿™æ˜¯ä¸€ä¸ªéå¸¸æ—©æœŸçš„è¯­è¨€æè®®ï¼Œå®šä¹‰äº†å¦‚ä½•å¼•ç”¨æ ‡å‡†åº“(built-in modules)ï¼Œä½†æ˜¯æ²¡æœ‰å®šä¹‰æ ‡å‡†åº“çš„å†…å®¹</li><li><p><a href="https://developers.google.com/web/updates/2019/03/kv-storage" target="_blank" rel="noopener">KV Storage: the Webâ€™s First Built-in Module</a> Chromeåœ¨å¹´åˆæ¨å‡ºçš„å®éªŒæ€§åŠŸèƒ½ï¼Œå°è¯•å®ç°proposal-javascript-standard-libraryæè®®. å®ƒé€šè¿‡ä¸‹é¢æ–¹å¼æ¥å¼•ç”¨â€˜æ ‡å‡†åº“â€™æ¨¡å—:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;storage, StorageArea&#125; <span class="keyword">from</span> <span class="string">'std:kv-storage'</span>; <span class="comment">// std: å‰ç¼€ï¼Œå’Œæ™®é€šæ¨¡å—åŒºåˆ†å¼€æ¥</span></span><br></pre></td></tr></table></figure></li></ul><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»ä¸€ä¸ªSegmentFaultä¸Šçš„ä¸€ä¸ªé—®é¢˜å¼€å§‹ï¼Œå¯¹æ¯”å…¶ä»–è¯­è¨€ï¼Œæ­éœ²Javascriptæ²¡æœ‰æ ‡å‡†åº“çš„çª˜å¢ƒ. æ¥ç€ä»‹ç»ç°æœ‰Javascriptçš„APIç»“æ„ï¼Œä»‹ç»ä»€ä¹ˆæ˜¯æ ‡å‡†åº“ï¼Œè¾©è¯è€ƒè™‘æ ‡å‡†åº“çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠæ¨è¡Œä¸Šé¢å¯èƒ½ä¼šé‡åˆ°çš„é˜»ç¢.</p><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://www.infoworld.com/article/3048833/brendan-eich-javascript-standard-library-will-stay-small.html" target="_blank" rel="noopener">Brendan Eich: JavaScript standard library will stay small</a></li><li><a href="https://medium.com/@thomasfuchs/what-if-we-had-a-great-standard-library-in-javascript-52692342ee3f" target="_blank" rel="noopener">What if we had a great standard library in JavaScript?</a></li><li><a href="https://www.i-programmer.info/news/167-javascript/12608-the-javascript-standard-library.html" target="_blank" rel="noopener">The JavaScript Standard Library</a></li><li><a href="https://www.w3.org/TR/" target="_blank" rel="noopener">W3C</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank" rel="noopener">Web API ç´¢å¼•</a></li><li><a href="https://dev.to/sloan/explain-like-im-five-whats-a-standard-library-4gi" target="_blank" rel="noopener">Explain Like Iâ€™m Five: Whatâ€™s a standard library?</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨SegmentFaultçƒ­å¿ƒè§£é¢˜ï¼Œä¸€ä¸ªé—®é¢˜æ¯”è¾ƒè®©æˆ‘æ¯”è¾ƒå°è±¡æ·±åˆ»ï¼š&lt;em&gt;ä¸€ä¸ªåˆå­¦è€…è¯•å›¾åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥Node.jsçš„netæ¨¡å—ã€‚ç»“æœåœ¨æ§åˆ¶å°æ‰“å°åæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæœ‰ç‚¹Javascriptç»éªŒçš„äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜å¼±æ™ºâ€™é—®é¢˜ï¼Œæ€ä¹ˆå¯ä»¥åœ¨æµè§ˆå™¨ç«¯
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½ éœ€è¦çŸ¥é“çš„è½¯ä»¶æµ‹è¯•ç±»å‹å’Œå¸¸è¯†</title>
    <link href="https://bobi.ink/2019/07/10/typeof-testing/"/>
    <id>https://bobi.ink/2019/07/10/typeof-testing/</id>
    <published>2019-07-09T16:00:00.000Z</published>
    <updated>2019-07-14T14:00:23.180Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡é“¾æ¥: <a href="https://www.softwaretestinghelp.com/types-of-software-testing/" target="_blank" rel="noopener">Types Of Software Testing: Different Testing Types With Details</a></p><blockquote><p>æ–‡ç« ä¸ºæ„è¯‘ï¼Œå¹¶ä¸”åœ¨åŸæ–‡çš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ¼”ç»å’Œæ‰©å±•</p></blockquote><blockquote><p>æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œé˜…è¯»å®Œå¤§æ¦‚20minï¼Œè¯»å®Œä¼šæœ‰æ”¶è·ã€‚æ¬¢è¿ç‚¹èµæ”¶è—å…³æ³¨</p></blockquote><p><br></p><p><img src="/images/typeof-testing/Types-of-Testing1.jpg" alt></p><p><br></p><p>æœ‰å¤šå°‘è½¯ä»¶æµ‹è¯•ç±»å‹å‘¢?</p><p>æˆ‘ä»¬ä½œä¸ºæµ‹è¯•äººå‘˜äº†è§£å¾ˆå¤šç§ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹ï¼Œä¾‹å¦‚åŠŸèƒ½æµ‹è¯•(Functional Test)ã€éåŠŸèƒ½æµ‹è¯•ã€è‡ªåŠ¨æµ‹è¯•ã€æ•æ·æµ‹è¯•ã€ä»¥åŠå®ƒä»¬çš„å„ç§å­ç±»å‹. å°½ç®¡åœ¨æˆ‘ä»¬çš„æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šæ¥è§¦å¾ˆå¤šç§æµ‹è¯•ç±»å‹, æˆ–è€…å¬è¯´è¿‡æŸäº›æµ‹è¯•ç±»å‹ï¼Œä½†æ˜¯å¾ˆå°‘äººæ•¢è¯´ç²¾é€šæ‰€æœ‰çš„æµ‹è¯•ç±»å‹.</p><p>æ¯ä¸ªæµ‹è¯•ç±»å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚æ‰€ä»¥æˆ‘å†™è¿™ç¯‡æ–‡ç« ï¼Œç§‘æ™®ä¸€ä¸‹æˆ‘ä»¬ä»Šå¤©æœ€å¸¸ç”¨çš„æµ‹è¯•ç±»å‹.</p><p><br></p><h2 id="ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹"><a href="#ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹" class="headerlink" title="ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹"></a>ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹</h2><p><img src="/images/typeof-testing/Types-of-Software-Testing.jpg" alt></p><p>ä¸‹é¢æ˜¯è½¯ä»¶æµ‹è¯•çš„é€šç”¨ç±»å‹åˆ—è¡¨</p><ul><li><p>åŠŸèƒ½æµ‹è¯•ç±»å‹:</p><ul><li>å•å…ƒæµ‹è¯•(Unit testing)</li><li>é›†æˆæµ‹è¯•(Integration testing)</li><li>ç³»ç»Ÿæµ‹è¯•(System testing)</li><li>å¥å…¨æ€§æµ‹è¯•(Sanity testing)</li><li>å†’çƒŸæµ‹è¯•(Smoke testing)</li><li>æ¥å£æµ‹è¯•(Interface testing)</li><li>å›å½’æµ‹è¯•(Regression testing)</li><li>Beta/éªŒæ”¶æµ‹è¯•(Beta/Acceptance testing)</li></ul></li><li><p>éåŠŸèƒ½æµ‹è¯•ç±»å‹:</p><ul><li>æ€§èƒ½æµ‹è¯•(Performance Testing)</li><li>è´Ÿè½½æµ‹è¯•(Load testing)</li><li>å‹åŠ›æµ‹è¯•(Stress testing)</li><li>å®¹é‡æµ‹è¯•(Volume testing)</li><li>å®‰å…¨æµ‹è¯•(Security testing)</li><li>å…¼å®¹æ€§æµ‹è¯•(Compatibility testing)</li><li>å®‰è£…æµ‹è¯•(Install testing)</li><li>æ¢å¤æµ‹è¯•(Recovery testing)</li><li>å¯é æ€§æµ‹è¯•(Reliability testing)</li><li>å¯ç”¨æ€§æµ‹è¯•(Usability testing)</li><li>ä¸€è‡´æ€§æµ‹è¯•(Compliance testing)</li><li>æœ¬åœ°åŒ–æµ‹è¯•(Localization testing)</li></ul></li></ul><p>æ¥çœ‹çœ‹è¿™äº›æµ‹è¯•ç±»å‹çš„ç»†èŠ‚</p><p><br></p><h2 id="0-a-bæµ‹è¯•-a-b-testing"><a href="#0-a-bæµ‹è¯•-a-b-testing" class="headerlink" title="0) A/Bæµ‹è¯•(A/B Testing)"></a>0) A/Bæµ‹è¯•(A/B Testing)</h2><p><img src="/images/typeof-testing/ab.png" alt></p><p>é¡¾åæ€ä¹‰ï¼Œ <a href="https://maxket.com/ab-test-best-practice/" target="_blank" rel="noopener">A/Bæµ‹è¯•</a>å°±æ˜¯å‡†å¤‡ä¸¤ä¸ª(A/B)æˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œè®©ä¸åŒçš„ç”¨æˆ·æ¥éšæœºè®¿é—®è¿™äº›ç‰ˆæœ¬ï¼Œæ”¶é›†å„ç¾¤ç»„çš„ç”¨æˆ·ä½“éªŒæ•°æ®å’Œä¸šåŠ¡æ•°æ®ï¼Œæœ€ååˆ†æã€è¯„ä¼°å‡ºæœ€å¥½ç‰ˆæœ¬ï¼Œæ­£å¼é‡‡ç”¨ã€‚å¦‚ä¸Šå›¾ï¼Œè°·æ­Œä½¿ç”¨A/Bæµ‹è¯•æ¥å†³å®šå¯¼èˆªåº”è¯¥æ˜¯çº¢è‰²è¿˜æ˜¯è“è‰²ã€‚</p><p><br></p><h2 id="1-alphaæµ‹è¯•-alpha-testing"><a href="#1-alphaæµ‹è¯•-alpha-testing" class="headerlink" title="1) Alphaæµ‹è¯•(Alpha Testing)"></a>1) Alphaæµ‹è¯•(Alpha Testing)</h2><p><strong><a href="https://www.softwaretestinghelp.com/what-is-alpha-testing-beta-testing/" target="_blank" rel="noopener">Alphaæµ‹è¯•</a>è¿™æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­å¾ˆå¸¸è§çš„æµ‹è¯•ç±»å‹ã€‚å®ƒçš„ç›®æ ‡å°±æ˜¯å°½å¯èƒ½åœ°åœ¨å‘å¸ƒåˆ°å¸‚åœºæˆ–äº¤ä»˜ç»™ç”¨æˆ·ä¹‹å‰æ‰¾å‡ºæ‰€æœ‰çš„é—®é¢˜å’Œç¼ºé™·</strong>ã€‚</p><p>Alphaæµ‹è¯•ä¸€èˆ¬åœ¨å¼€å‘çš„æœ«æ®µä¸”åœ¨Betaæµ‹è¯•ä¹‹å‰è¿›è¡Œã€‚åœ¨è¿™ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé©±åŠ¨å¼€å‘è€…è¿›è¡Œä¸€äº›å°(minor)çš„è®¾è®¡å˜åŠ¨. Alphaæµ‹è¯•ä¸€èˆ¬åœ¨å¼€å‘è€…ç½‘ç«™è¿›è¡Œï¼Œå³åªå¯¹å¼€å‘è€…æˆ–å†…éƒ¨ç”¨æˆ·å¼€æ”¾ï¼Œä¸€èˆ¬å¯ä»¥ä¸ºæ­¤ç±»æµ‹è¯•åˆ›å»ºå†…éƒ¨è™šæ‹Ÿçš„ç”¨æˆ·ç¯å¢ƒã€‚</p><p><br></p><p>ä¸€èˆ¬å¤§å‹çš„è½¯ä»¶é¡¹ç›®éƒ½æœ‰è§„èŒƒåŒ–çš„<strong>è½¯ä»¶ç‰ˆæœ¬å‘¨æœŸ</strong>:</p><p><img src="/images/typeof-testing/alpha-testing.png" alt></p><ul><li><strong>Pre-alpha</strong>: æœ‰æ—¶å€™è½¯ä»¶ä¼šåœ¨Alphaæˆ–Betaç‰ˆæœ¬å‰å…ˆå‘å¸ƒPre-alphaç‰ˆæœ¬, ç›¸æ¯”Alphaå’ŒBetaï¼Œè¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸å®Œæ•´çš„ç‰ˆæœ¬</li><li><strong>Alpha</strong>: Alphaç‰ˆæœ¬åŠŸèƒ½è¿˜æ²¡å®Œå–„ï¼Œéœ€è¦è¿›ä¸€æ­¥æµ‹è¯•ã€‚Alphaç‰ˆæœ¬é€šå¸¸ä¼šå‘é€åˆ°å¼€å‘è½¯ä»¶çš„ç»„ç»‡æˆ–æŸç¾¤ä½“ä¸­çš„è½¯ä»¶æµ‹è¯•è€…è¿›è¡Œå†…éƒ¨æµ‹è¯•ã€‚</li><li><strong>Beta</strong>: ä¸€èˆ¬Betaç‰ˆæœ¬ä¼šåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼Œä½†å¯èƒ½åˆæœ‰ä¸€äº›Bugï¼Œéœ€è¦è°ƒè¯•åé¦ˆã€‚ Betaç‰ˆæœ¬æ˜¯è½¯ä»¶æœ€æ—©å¯¹å¤–å…¬å¼€çš„è½¯ä»¶ç‰ˆæœ¬ï¼Œç”±å…¬ä¼—ï¼ˆé€šå¸¸ä¸ºå…¬å¸å¤–çš„ç¬¬ä¸‰æ–¹å¼€å‘è€…å’Œä¸šä½™ç©å®¶ï¼‰å‚ä¸æµ‹è¯•ã€‚</li><li><strong>Release Candidate(rc)</strong>: å‘å¸ƒå€™é€‰ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°é—®é¢˜åˆ™å¯å‘å¸ƒæˆä¸ºæ­£å¼çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬åŒ…å«å®Œæ•´ä¸”æ¯”è¾ƒç¨³å®šçš„åŠŸèƒ½</li></ul><p>ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­, æœ€è¿‘æŠŠæˆ‘<a href="https://juejin.im/pin/5d1ecb656fb9a00259a176a5" target="_blank" rel="noopener">å‘å¾—æœ‰ç‚¹æƒ¨</a>çš„iOS13çš„å‘å¸ƒè®¡åˆ’:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">June 3: iOS 13 beta 1 and first look at WWDC 2019                 # -&gt; WWDCåå°±å¯ä»¥è£…çš„ï¼Œç›¸å½“äºpre-alphaæˆ–Alphaé˜¶æ®µå§</span><br><span class="line">June 17: iOS 13 beta 2 launched for developers</span><br><span class="line">June 24: iOS 13 public beta release date for adventurous testers  # -&gt; å…¬å¼€Betaç‰ˆæœ¬ï¼Œç›¸å½“äºä¸Šé¢è¯´çš„Betaé˜¶æ®µ</span><br><span class="line">July 3: iOS 13 developer beta 3 launch with some new features     </span><br><span class="line">July 8: iOS 13 public beta 2 release date</span><br><span class="line">Early September 2019: iOS 13 Golden Master (final dev beta)       # -&gt; ä¹æœˆåˆï¼Œè¯¥å‘æœ€ç»ˆBetaç‰ˆæœ¬äº†ï¼Œç›¸å½“äºè¿›å…¥RCé˜¶æ®µäº†</span><br><span class="line">Mid-September 2019: iOS 13 likely to launch with new 2019 iPhones # -&gt; æ­£å¼ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><br></p><p>ç°åœ¨å¾ˆå¤šå¼€æºé¡¹ç›®ï¼Œå·²ç»æ·¡åŒ–äº†ç€‘å¸ƒå¼çš„è½¯ä»¶ç‰ˆæœ¬å‘¨æœŸï¼Œå˜æˆä¸€ç§æŒç»­(Continuous)çš„ã€å¸¸æ€åŒ–çš„è¡Œä¸º, ä¾‹å¦‚Firefox:</p><p><img src="/images/typeof-testing/firefox.png" alt></p><p><br></p><h2 id="2-éªŒæ”¶æµ‹è¯•-acceptance-testing"><a href="#2-éªŒæ”¶æµ‹è¯•-acceptance-testing" class="headerlink" title="2) éªŒæ”¶æµ‹è¯•(Acceptance Testing)"></a>2) éªŒæ”¶æµ‹è¯•(Acceptance Testing)</h2><p><strong><a href="https://www.softwaretestinghelp.com/what-is-acceptance-testing/" target="_blank" rel="noopener">éªŒæ”¶æµ‹è¯•</a>é€šå¸¸æ˜¯éƒ¨ç½²è½¯ä»¶ä¹‹å‰çš„æœ€åä¸€ä¸ªæµ‹è¯•æ“ä½œ, ä¹Ÿç§°ä¸ºäº¤ä»˜æµ‹è¯•, ç”±æœ€ç»ˆå®¢æˆ·æ‰§è¡Œï¼Œä»–ä»¬ä¼šéªŒè¯ç«¯åˆ°ç«¯(end to end)çš„ç³»ç»Ÿæµç¨‹æ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼Œä»¥åŠåŠŸèƒ½æ˜¯å¦æ˜¯æ»¡è¶³æœ€ç»ˆç”¨æˆ·çš„éœ€æ±‚</strong>ã€‚åªæœ‰å½“æ‰€æœ‰çš„ç‰¹æ€§å’ŒåŠŸèƒ½æŒ‰ç…§æœŸæœ›çš„è¿è¡Œï¼Œå®¢æˆ·æ‰ä¼šæ¥å—è½¯ä»¶</p><p>è¿™æ˜¯æµ‹è¯•çš„æœ€åé˜¶æ®µï¼Œåœ¨éªŒæ”¶æµ‹è¯•ä¹‹åï¼Œè½¯ä»¶å°†æŠ•å…¥ç”Ÿäº§ç¯å¢ƒ. æ‰€ä»¥å®ƒä¹Ÿå«ç”¨æˆ·éªŒæ”¶æµ‹è¯•(UAT)</p><p><img src="/images/typeof-testing/accept.png" alt></p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒéªŒæ”¶æµ‹è¯•å°±ç›¸å½“äºæ”¶å¿«é€’, åŒ…è£¹æ˜¯è½¯ä»¶ã€ä½ å°±æ˜¯å®¢æˆ·ï¼Œæ˜¯éªŒæ”¶æ–¹ï¼Œå¦‚æœè´§ç‰©ä¸ç¬¦åˆä½ çš„è¦æ±‚ï¼Œæ˜¯è¦é€€è´§çš„ã€‚</p><p><br></p><h2 id="3-ä¸´æ—¶æµ‹è¯•-ad-hoc-testing"><a href="#3-ä¸´æ—¶æµ‹è¯•-ad-hoc-testing" class="headerlink" title="3) ä¸´æ—¶æµ‹è¯•(Ad-hoc Testing)"></a>3) ä¸´æ—¶æµ‹è¯•(Ad-hoc Testing)</h2><p>Ad-hocä¸­æ–‡åº”è¯¥ç†è§£ä¸ºä¸´æ—¶çš„æ„æ€ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ç§æµ‹è¯•æ˜¯åœ¨ä¸´æ—¶åŸºç¡€ä¸Šè¿›è¡Œçš„, æœ‰æ—¶å€™ä¹Ÿç§°ä¸ºéšæœºæµ‹è¯•ã€‚å³æ²¡æœ‰å‚è€ƒæµ‹è¯•ç”¨ä¾‹ã€æ²¡æœ‰é’ˆå¯¹è¯¥æµ‹è¯•çš„ä»»ä½•è®¡åˆ’å’Œæ–‡æ¡£ã€‚Ad-hocæµ‹è¯•çš„ç›®çš„å°±æ˜¯<strong>é€šè¿‡æ‰§è¡Œéšæ„çš„æµç¨‹æˆ–ä»»æ„çš„åŠŸèƒ½æ¥æ‰¾å‡ºåº”ç”¨çš„ç¼ºé™·å’Œé—®é¢˜</strong></p><p>Ad-hocæµ‹è¯•ä¸€ç§éæ­£å¼çš„æ–¹æ³•ï¼Œå¯ä»¥ç”±é¡¹ç›®ä¸­çš„ä»»ä½•äººæ‰§è¡Œã€‚å°½ç®¡æ²¡æœ‰æµ‹è¯•ç”¨ä¾‹å¾ˆéš¾è¯†åˆ«ç¼ºé™·ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™åœ¨Ad-hocæµ‹è¯•æœŸé—´å‘ç°çš„ç¼ºé™·å¯èƒ½æ— æ³•ä½¿ç”¨ç°æœ‰çš„æµ‹è¯•ç”¨ä¾‹æ¥è¯†åˆ«, <strong>ä¹Ÿå°±æ˜¯è¯´å®ƒä¸€èˆ¬ç”¨æ¥å‘ç°â€˜æ„å¤–â€™çš„ç¼ºé™·</strong>.</p><p><br></p><h2 id="4-å¯è®¿é—®æ€§æµ‹è¯•-accessibility-testing"><a href="#4-å¯è®¿é—®æ€§æµ‹è¯•-accessibility-testing" class="headerlink" title="4) å¯è®¿é—®æ€§æµ‹è¯•(Accessibility Testing)"></a>4) å¯è®¿é—®æ€§æµ‹è¯•(Accessibility Testing)</h2><p><strong>å¯è®¿é—®æ€§æµ‹è¯•çš„ç›®çš„æ˜¯ç¡®å®šè½¯ä»¶æˆ–åº”ç”¨ç¨‹åºæ˜¯å¦å¯ä¾›æ®‹ç–¾äººä½¿ç”¨</strong>ã€‚æ®‹ç–¾æ˜¯æŒ‡è‹äººï¼Œè‰²ç›²ï¼Œæ™ºéšœäººå£«ï¼Œå¤±æ˜è€…ï¼Œè€å¹´äººå’Œå…¶ä»–æ®‹ç–¾äººç¾¤ä½“ã€‚è¿™é‡Œä¼šæ‰§è¡Œå„ç§æ£€æŸ¥ï¼Œä¾‹å¦‚é’ˆå¯¹è§†è§‰æ®‹ç–¾çš„å­—ä½“å¤§å°æµ‹è¯•ï¼Œé’ˆå¯¹è‰²ç›²çš„é¢œè‰²å’Œå¯¹æ¯”åº¦æµ‹è¯•ç­‰ç­‰ã€‚</p><p>ä¸åŒå¹³å°ã€ä¸åŒåº”ç”¨ç±»å‹å¯¹å¯è®¿é—®æ€§æ”¯æŒæƒ…å†µä¸å¤ªä¸€æ ·ï¼Œæ¯”å¦‚iOSç›¸æ¯”å…¶ä»–æ“ä½œç³»ç»Ÿåˆ™æ›´é‡è§†å¯è®¿é—®, è€Œå›½å¤–æ¯”å›½å†…æ›´é‡è§†å¯è®¿é—®æ€§ã€‚</p><p><img src="/images/typeof-testing/acs.png" alt></p><p><br></p><h2 id="5-betaæµ‹è¯•-beta-testing"><a href="#5-betaæµ‹è¯•-beta-testing" class="headerlink" title="5) Betaæµ‹è¯•(Beta Testing)"></a>5) Betaæµ‹è¯•(Beta Testing)</h2><p>ä¸Šæ–‡Alphaæµ‹è¯•å·²ç»æåŠBetaæµ‹è¯•, <strong>Betaæµ‹è¯•æ˜¯ä¸€ç§æ­£å¼çš„è½¯ä»¶æµ‹è¯•ç±»å‹ï¼Œåœ¨å°†äº§å“å‘å¸ƒåˆ°å¸‚åœºæˆ–è€…å®é™…æœ€ç»ˆç”¨æˆ·ä¹‹å‰ï¼Œç”±å®¢æˆ·åœ¨çœŸå®çš„åº”ç”¨ç¯å¢ƒä¸­æ‰§è¡Œ</strong>ã€‚</p><p>æ‰§è¡ŒBetaæµ‹è¯•ç›®çš„æ˜¯ç¡®ä¿è½¯ä»¶æˆ–äº§å“ä¸­æ²¡æœ‰é‡å¤§æ•…éšœï¼Œå¹¶ä¸”æ»¡è¶³æœ€ç»ˆç”¨æˆ·çš„ä¸šåŠ¡éœ€æ±‚ã€‚å½“å®¢æˆ·æ¥å—è½¯ä»¶æ—¶ï¼ŒBetaæµ‹è¯•æ‰ç®—é€šè¿‡ã€‚</p><p>é€šå¸¸ï¼Œæ­¤ç±»æµ‹è¯•ç”±æœ€ç»ˆç”¨æˆ·æˆ–å…¶ä»–äººå®Œæˆã€‚è¿™æ˜¯åœ¨å°†åº”ç”¨å‘å¸ƒä½œä¸ºå•†ä¸šç”¨é€”ä¹‹å‰å®Œæˆçš„æœ€ç»ˆæµ‹è¯•ã€‚é€šå¸¸ï¼Œå‘å¸ƒçš„è½¯ä»¶æˆ–äº§å“çš„Betaç‰ˆæœ¬ä»…é™äºç‰¹å®šåŒºåŸŸä¸­çš„ç‰¹å®šæ•°é‡çš„ç”¨æˆ·ã€‚<br>æ‰€ä»¥æœ€ç»ˆç”¨æˆ·å®é™…ä½¿ç”¨è½¯ä»¶åä¼šå°†ä¸€äº›é—®é¢˜åé¦ˆç»™å…¬å¸ã€‚å…¬å¸å¯ä»¥åœ¨å…¨é¢å‘å¸ƒä¹‹å‰é‡‡å–å¿…è¦çš„æªæ–½ã€‚</p><p>Betaæµ‹è¯•åœ¨æ­£å¼ç‰ˆæœ¬ä¹‹å‰ä¹Ÿå¯èƒ½ä¼šè¿­ä»£è¿›è¡Œå¤šæ¬¡.</p><p><br></p><h2 id="6-åç«¯æµ‹è¯•-back-end-testing"><a href="#6-åç«¯æµ‹è¯•-back-end-testing" class="headerlink" title="6) åç«¯æµ‹è¯•(Back-end Testing)"></a>6) åç«¯æµ‹è¯•(Back-end Testing)</h2><p>å‰ç«¯åº”ç”¨è¾“å…¥çš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå­˜å‚¨åœ¨æ•°æ®åº“ï¼Œæ‰€ä»¥é’ˆå¯¹æ•°æ®åº“çš„è¿™ç±»æµ‹è¯•ç§°ä¸º<strong>æ•°æ®åº“æµ‹è¯•æˆ–è€…åç«¯æµ‹è¯•</strong>. å¸‚é¢æœ‰ä¸åŒçš„æ•°æ®åº“ï¼Œå¦‚SQL Serverï¼ŒMySQLå’ŒOracleç­‰ã€‚æ•°æ®åº“æµ‹è¯•ä¼šæ¶‰åŠè¡¨ç»“æ„ï¼Œæ¨¡å¼ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œæ•°æ®ç»“æ„ç­‰ã€‚</p><p>åç«¯æµ‹è¯•ä¸€èˆ¬ä¸ä¼šæ¶‰åŠGUIï¼Œæµ‹è¯•äººå‘˜é€šè¿‡æŸäº›æ‰‹æ®µç›´æ¥è¿æ¥åˆ°æ•°æ®åº“ï¼Œä»è€Œå¯ä»¥å®¹æ˜“åœ°è¿è¡Œä¸€äº›æ•°æ®åº“è¯·æ±‚æ¥éªŒè¯æ•°æ®ã€‚<strong>é€šè¿‡åç«¯æµ‹è¯•å¯ä»¥å‘ç°ä¸€äº›æ•°æ®åº“é—®é¢˜ï¼Œæ¯”å¦‚æ•°æ®ä¸¢å¤±ã€æ­»é”ã€æ•°æ®æŸåã€‚è¿™äº›é—®é¢˜åœ¨ç³»ç»ŸæŠ•å…¥ç”Ÿäº§ç¯å¢ƒä¹‹å‰è¿›è¡Œä¿®å¤è‡³å…³é‡è¦</strong></p><p><br></p><h2 id="7-æµè§ˆå™¨å…¼å®¹æµ‹è¯•-browser-compatibility-testing"><a href="#7-æµè§ˆå™¨å…¼å®¹æµ‹è¯•-browser-compatibility-testing" class="headerlink" title="7) æµè§ˆå™¨å…¼å®¹æµ‹è¯•(Browser Compatibility Testing)"></a>7) æµè§ˆå™¨å…¼å®¹æµ‹è¯•(Browser Compatibility Testing)</h2><p><img src="/images/typeof-testing/brw.png" alt></p><p>è¿™æ˜¯å…¼å®¹æ€§æµ‹è¯•çš„å­ç±»å‹ï¼Œç”±æµ‹è¯•å›¢é˜Ÿæ‰§è¡Œ. <strong><a href="http://frontend.turing.io/lessons/module-2/cross-browser-compat.html" target="_blank" rel="noopener">æµè§ˆå™¨å…¼å®¹æµ‹è¯•</a>ä¸»è¦é’ˆå¯¹Webåº”ç”¨ï¼Œç”¨äºç¡®ä¿è½¯ä»¶å¯ä»¥åœ¨ä¸åŒæµè§ˆå™¨æˆ–æ“ä½œç³»ç»Ÿä¸­è¿è¡Œ; æˆ–è€…éªŒè¯Webåº”ç”¨ç¨‹åºæ˜¯å¦æ”¯æŒåœ¨æµè§ˆå™¨çš„æ‰€æœ‰ç‰ˆæœ¬ä¸Šè¿è¡Œ, ä»¥ç¡®å®šåº”ç”¨æœ€ç»ˆå…¼å®¹çš„èŒƒå›´</strong>.</p><p>æµè§ˆå™¨å…¼å®¹æµ‹è¯•æ˜¯å‰ç«¯å¼€å‘è€…ç»•ä¸å¼€çš„å‘ã€‚</p><p>æˆ‘ä»¬æœ‰å¾ˆå¤š<strong>ç­–ç•¥</strong>æ¥åº”å¯¹æµè§ˆå™¨å…¼å®¹æ€§ï¼Œæ¯”å¦‚æ¸è¿›å¢å¼ºæˆ–è€…ä¼˜é›…é™çº§, è¿˜æœ‰åˆ¶å®šæµè§ˆå™¨å…¼å®¹è§„èŒƒ; </p><p>ä¸ºäº†<strong>æŠšå¹³æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚</strong>ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å„ç§ç‰¹æ€§æ£€æµ‹å·¥å…·(Modernizr), è¿˜æœ‰å„ç§polyfill(CSS Normaliz, polyfill/shim, css-autoprefixer);</p><p>å½“ç„¶ä¸ºäº†<strong>æµ‹è¯•è·¨æµè§ˆå™¨å…¼å®¹æ€§</strong>ï¼Œè¿˜è¦ä¸€äº›è¾…åŠ©å·¥å…·ï¼Œä¾‹å¦‚<a href="https://www.browserstack.com/" target="_blank" rel="noopener">BrowserStack</a>, å¯¹äºæˆ‘ä»¬è¿™äº›å°å›¢é˜Ÿï¼Œåªèƒ½ä¸‹ä¸€å †Portable(<em>Portableæµè§ˆå™¨è¿è¡Œæ—¶ç›¸äº’éš”ç¦»çš„, æ‰€ä»¥ä¸ä¼šå­˜åœ¨é…ç½®æ–‡ä»¶ç­‰å†²çªé—®é¢˜</em>) æµè§ˆå™¨ï¼Œæ‰‹å·¥æµ‹è¯•äº†ã€‚</p><p><br></p><h2 id="8-åå‘å…¼å®¹æµ‹è¯•-backward-compatibility-testing"><a href="#8-åå‘å…¼å®¹æµ‹è¯•-backward-compatibility-testing" class="headerlink" title="8) åå‘å…¼å®¹æµ‹è¯•(Backward Compatibility Testing)"></a>8) åå‘å…¼å®¹æµ‹è¯•(Backward Compatibility Testing)</h2><p><strong>å‘åå…¼å®¹æµ‹è¯•, ç”¨äºéªŒè¯æ–°å¼€å‘æˆ–æ›´æ–°çš„è½¯ä»¶æ˜¯å¦èƒ½åœ¨æ—§ç‰ˆæœ¬çš„ç¯å¢ƒä¸­è¿è¡Œ</strong>ã€‚</p><p>æ¯”å¦‚å‘åå…¼å®¹æµ‹è¯•ä¼šæ£€æŸ¥æ–°ç‰ˆè½¯ä»¶æ˜¯å¦å¯ä»¥æ­£ç¡®åœ°å¤„ç†æ—§ç‰ˆæœ¬è½¯ä»¶åˆ›å»ºçš„æ–‡ä»¶æ ¼å¼ã€‚ä¾‹å¦‚æ–°ç‰ˆçš„Office 2016æ˜¯å¦å¯ä»¥æ‰“å¼€2012åˆ›å»ºçš„æ–‡ä»¶ã€‚</p><p>åŒç†ä¹Ÿå¯ä»¥æ£€æŸ¥æ–°ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å…¼å®¹æ—§ç‰ˆæœ¬è½¯ä»¶åˆ›å»ºçš„æ•°æ®è¡¨ã€æ•°æ®æ–‡ä»¶ã€æ•°æ®ç»“æ„ã€é…ç½®æ–‡ä»¶ã€‚ </p><p>ä»»ä½•è½¯ä»¶æ›´æ–°åº”è¯¥åœ¨å…ˆå‰ç‰ˆæœ¬çš„åŸºç¡€ä¹‹ä¸Šè‰¯å¥½åœ°è¿è¡Œ</p><p><br></p><h2 id="9-é»‘ç›’æµ‹è¯•-black-box-testing"><a href="#9-é»‘ç›’æµ‹è¯•-black-box-testing" class="headerlink" title="9) é»‘ç›’æµ‹è¯•(Black Box Testing)"></a>9) é»‘ç›’æµ‹è¯•(Black Box Testing)</h2><p><img src="/images/typeof-testing/black-box.png" alt></p><p>é»‘ç›’æµ‹è¯•ä¸è€ƒè™‘è½¯ä»¶çš„å†…éƒ¨ç³»ç»Ÿè®¾è®¡ï¼Œå®ƒåŸºäºéœ€æ±‚å’ŒåŠŸèƒ½è¿›è¡Œæµ‹è¯•, åªå…³å¿ƒç³»ç»Ÿçš„è¾“å…¥/è¾“å‡ºä»¥åŠåŠŸèƒ½æµç¨‹ã€‚ </p><p>æ¢å¥è¯è¯´<strong>é»‘ç›’æµ‹è¯•ä»ç”¨æˆ·çš„è§’åº¦å‡ºå‘é’ˆå¯¹è½¯ä»¶ç•Œé¢ã€åŠŸèƒ½åŠå¤–éƒ¨ç»“æ„è¿›è¡Œæµ‹è¯•ï¼Œè€Œä¸è€ƒè™‘ç¨‹åºå†…éƒ¨é€»è¾‘ç»“æ„</strong>.</p><p>é»‘ç›’æµ‹è¯•ä¸‹é¢æœ‰å¾ˆå¤šå­ç±»ï¼Œä¾‹å¦‚é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ã€å¤§éƒ¨åˆ†éåŠŸèƒ½æ€§æµ‹è¯•</p><p>å…³äºé»‘ç›’æµ‹è¯•çš„ä¼˜ç¼ºç‚¹ä»¥åŠæµ‹è¯•ç±»å‹å¯ä»¥çœ‹<a href="https://www.softwaretestinghelp.com/black-box-testing/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p><br></p><h2 id="10-è¾¹ç•Œå€¼æµ‹è¯•-boundary-value-testing"><a href="#10-è¾¹ç•Œå€¼æµ‹è¯•-boundary-value-testing" class="headerlink" title="10) è¾¹ç•Œå€¼æµ‹è¯•(Boundary Value Testing)"></a>10) è¾¹ç•Œå€¼æµ‹è¯•(Boundary Value Testing)</h2><p><strong>è¾¹ç•Œå€¼æµ‹è¯•, æµ‹è¯•åº”ç”¨å¤„äºè¾¹ç•Œæ¡ä»¶(boundary level)çš„è¡Œä¸º</strong>ã€‚å¾ˆå¤šè¾¹ç•Œæ¡ä»¶å¼€å‘è€…æ˜¯å¾ˆéš¾è€ƒè™‘å‘¨åˆ°çš„ï¼Œæ‰€ä»¥æ‰æœ‰ä¸€ä¸ªä¸“é—¨çš„æµ‹è¯•ç±»å‹æ¥éªŒè¯è¿™ç§æƒ…å†µ</p><p>è¾¹ç•Œå€¼æµ‹è¯•æ£€æŸ¥åº”ç”¨å¤„äºè¾¹ç•Œå€¼æ—¶æ˜¯å¦å­˜åœ¨ç¼ºé™·ã€‚è¾¹ç•Œå€¼æµ‹è¯•é€šå¸¸ç”¨äºæµ‹è¯•ä¸åŒèŒƒå›´çš„æ•°å­—, æ¯ä¸ªèŒƒå›´éƒ½æœ‰ä¸€ä¸ªä¸Šä¸‹è¾¹ç•Œï¼Œè¾¹ç•Œæµ‹è¯•åˆ™æ˜¯é’ˆå¯¹è¿™äº›è¾¹ç•Œå€¼è¿›è¡Œæµ‹è¯•ã€‚</p><p>æ¯”å¦‚æ•°å­—èŒƒå›´ä¸º1-500, é‚£ä¹ˆè¾¹ç•Œå€¼æµ‹è¯•ä¼šåœ¨è¿™äº›å€¼ä¸Šè¿›è¡ŒéªŒè¯: 0ã€1ã€2ã€499ã€500ã€501</p><p><br></p><h2 id="11-åˆ†æ”¯æµ‹è¯•-branch-testing"><a href="#11-åˆ†æ”¯æµ‹è¯•-branch-testing" class="headerlink" title="11) åˆ†æ”¯æµ‹è¯•(Branch Testing)"></a>11) åˆ†æ”¯æµ‹è¯•(Branch Testing)</h2><p>è¿™æ˜¯ç™½ç›’æµ‹è¯•çš„å­ç±»å‹ï¼Œåœ¨å•å…ƒæµ‹è¯•ä¸­å®æ–½. é¡¾åæ€ä¹‰ï¼Œ<strong>åˆ†æ”¯æµ‹è¯•è¡¨ç¤ºæµ‹è¯•è¦è¦†ç›–ç¨‹åºä»£ç çš„å„ç§æ¡ä»¶åˆ†æ”¯, é¿å…é—æ¼ç¼ºé™·</strong>ã€‚åˆ†æ”¯è¦†ç›–æ˜¯å•å…ƒæµ‹è¯•è¦†ç›–ç‡çš„ä¸€ä¸ªæŒ‡æ ‡ä¹‹ä¸€</p><p><br></p><h2 id="12-æ¯”è¾ƒæµ‹è¯•-comparison-testing"><a href="#12-æ¯”è¾ƒæµ‹è¯•-comparison-testing" class="headerlink" title="12) æ¯”è¾ƒæµ‹è¯•(Comparison Testing)"></a>12) æ¯”è¾ƒæµ‹è¯•(Comparison Testing)</h2><p><img src="/images/typeof-testing/wzr.png" alt></p><p><strong>æ¯”è¾ƒæµ‹è¯•ï¼Œå°†äº§å“çš„ä¼˜ç‚¹å’Œå¼±ç‚¹ä¸æ—§ç‰ˆæœ¬æˆ–è€…åŒç±»(ç«å“)äº§å“è¿›è¡Œæ¯”è¾ƒ.</strong></p><p>æ¯”å¦‚ç±»ä¼¼ç‹è‡ªå¦‚è¿™ç§æ•°ç æµ‹è¯„æ ç›®ï¼Œè¯„æµ‹ä¸€ä¸ªæ‰‹æœºæˆ–è€…å…¶ä»–æ•°ç äº§å“æ—¶ï¼Œä¸€èˆ¬ä¼šæ¨ªå‘å’Œå‹å•†äº§å“è¿›è¡Œæ¯”è¾ƒï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šçºµå‘å’Œä¸Šä¸€ä»£äº§å“æ¯”è¾ƒ.</p><p>è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯å’Œè¡Œä¸šçš„é¢†å¯¼è€…æ¯”è¾ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åšIMçš„ï¼Œä¼šç»å¸¸å’Œå¾®ä¿¡æ¯”è¾ƒ: â€˜ä½ è¿™ä¸ªåº”ç”¨çš„å¯åŠ¨é€Ÿåº¦æ€ä¹ˆæ¯”å¾®ä¿¡æ…¢è¿™ä¹ˆå¤š?â€™</p><p><br></p><h2 id="13-å…¼å®¹æ€§æµ‹è¯•-compatibility-testing"><a href="#13-å…¼å®¹æ€§æµ‹è¯•-compatibility-testing" class="headerlink" title="13) å…¼å®¹æ€§æµ‹è¯•(Compatibility Testing)"></a>13) å…¼å®¹æ€§æµ‹è¯•(Compatibility Testing)</h2><p>è¿™æ˜¯ä¸€ä¸ªå¤§ç±», <strong>å…¼å®¹æ€§æµ‹è¯•ç”¨äºéªŒè¯åº”ç”¨åœ¨ä¸åŒç¯å¢ƒã€webæœåŠ¡å™¨ã€ç¡¬ä»¶ã€ç½‘ç»œæ¡ä»¶ä¸‹çš„è¡Œä¸º</strong>ã€‚å…¼å®¹æ€§æµ‹è¯•ç¡®ä¿è½¯ä»¶å¯ä»¥åœ¨ä¸åŒçš„é…ç½®ã€ä¸åŒçš„æ•°æ®åº“ã€ä¸åŒçš„æµè§ˆå™¨ï¼Œä»¥åŠå®ƒä»¬ä¸åŒçš„ç‰ˆæœ¬ä¸‹è¿è¡Œã€‚å…¼å®¹æ€§æµ‹è¯•ç”±æµ‹è¯•å›¢é˜Ÿå®æ–½</p><p><br></p><h2 id="14-ç»„ä»¶æµ‹è¯•-component-testing"><a href="#14-ç»„ä»¶æµ‹è¯•-component-testing" class="headerlink" title="14) ç»„ä»¶æµ‹è¯•(Component Testing)"></a>14) ç»„ä»¶æµ‹è¯•(Component Testing)</h2><p><a href="https://www.guru99.com/component-testing.html" target="_blank" rel="noopener">ç»„ä»¶æµ‹è¯•</a>(æ­¤ç»„ä»¶éGUIç»„ä»¶, å–ç»„åˆæµ‹è¯•å¯èƒ½æ›´å¥½ç†è§£ä¸€ç‚¹)ï¼Œ<strong>ä¸€èˆ¬ä¹Ÿç§°ä¸ºæ¨¡å—æµ‹è¯•(Module Testing), ä¸€èˆ¬ç”±å¼€å‘è€…åœ¨å®Œæˆå•å…ƒæµ‹è¯•åæ‰§è¡Œã€‚ç»„ä»¶æµ‹è¯•å°†å¤šä¸ªåŠŸèƒ½ç»„åˆèµ·æ¥ä½œä¸ºå•ä¸€çš„æ•´ä½“è¿›è¡Œæµ‹è¯•ï¼Œç›®çš„æ˜¯å‘ç°å¤šä¸ªåŠŸèƒ½åœ¨ç›¸äº’è¿æ¥èµ·æ¥ä¹‹åçš„ç¼ºé™·</strong>ã€‚</p><p>ç»„ä»¶æµ‹è¯•å¯å¤§å¯å°ï¼Œå°åˆ°å‡½æ•°çº§åˆ«æˆ–è€…ç±»çº§åˆ«çš„ç»„åˆï¼Œå¤§å¯ä»¥å¤§åˆ°å‡ ä¸ªå•ç‹¬çš„é¡µé¢ã€æ¨¡å—ã€å­ç³»ç»Ÿçš„ç»„åˆã€‚ ä¸¾ä¸€ä¸ªå‰ç«¯ä¾‹å­ï¼Œå°†å¤šä¸ªé¡µé¢è·¯ç”±ç»„åˆèµ·æ¥ï¼Œæµ‹è¯•å®ƒä»¬çš„æµç¨‹è·³è½¬ï¼Œå°±å±äºç»„ä»¶æµ‹è¯•ã€‚</p><p><img src="/images/typeof-testing/comp.png" alt></p><p><br></p><h2 id="15-ç«¯åˆ°ç«¯æµ‹è¯•-end-to-end-testing"><a href="#15-ç«¯åˆ°ç«¯æµ‹è¯•-end-to-end-testing" class="headerlink" title="15) ç«¯åˆ°ç«¯æµ‹è¯•(End-to-End Testing)"></a>15) ç«¯åˆ°ç«¯æµ‹è¯•(End-to-End Testing)</h2><p>ç«¯åˆ°ç«¯æµ‹è¯•ä¹Ÿæ˜¯ä¸€ç§é»‘ç›’æµ‹è¯•ç±»å‹ï¼Œç±»ä¼¼äºç³»ç»Ÿæµ‹è¯•. <strong>ç«¯åˆ°ç«¯æµ‹è¯•åœ¨æ¨¡æ‹Ÿçš„ã€å®Œæ•´çš„ã€çœŸå®åº”ç”¨ç¯å¢ƒä¸‹æ¨¡æ‹ŸçœŸå®ç”¨æˆ·å¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚åº”ç”¨ä¼šå’Œæ•°æ®åº“äº¤äº’ã€ä¼šä½¿ç”¨ç½‘ç»œé€šä¿¡ã€æˆ–è€…åœ¨é€‚å½“çš„æƒ…å†µä¸‹å’Œå…¶ä»–ç¡¬ä»¶ã€åº”ç”¨ã€ç³»ç»Ÿè¿›è¡Œäº¤äº’</strong>. ç«¯åˆ°ç«¯æ˜¯æŒ‡ä»ä¸€ä¸ªç«¯ç‚¹åˆ°å¦ä¸€ä¸ªç«¯ç‚¹çš„æ„æ€ï¼Œæ‰€ä»¥ç«¯åˆ°ç«¯æµ‹è¯•é‡ç‚¹ç”¨äºæµ‹è¯•æ¨¡å—å’Œæ¨¡å—ä¹‹é—´çš„åè°ƒæ€§ã€‚</p><p>å½“åº”ç”¨æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–è€…éœ€è¦å’Œå…¶ä»–å¤–éƒ¨ç³»ç»ŸååŒæ—¶ï¼Œç«¯åˆ°ç«¯æµ‹è¯•æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰², å®ƒå¯ä»¥å…¨é¢æ£€æŸ¥ä»¥ç¡®ä¿è½¯ä»¶åœ¨ä¸åŒå¹³å°å’Œç¯å¢ƒäº§å“èƒ½å‡†ç¡®åœ°äº¤äº’ã€‚ç«¯åˆ°ç«¯æµ‹è¯•æœ‰ä»¥ä¸‹ç›®çš„:</p><ul><li>ç¡®ä¿åº”ç”¨å¯ä»¥å’Œå¤–éƒ¨ç³»ç»Ÿä¹‹é—´è‰¯å¥½çš„åè°ƒã€‚å¯¹äºå‰ç«¯æ¥è¯´ï¼Œæ˜¯ç¡®ä¿é¡µé¢å’Œåç«¯ä¹‹é—´è‰¯å¥½åè°ƒ</li><li>æ£€æŸ¥ä»æºç³»ç»Ÿåˆ°ç›®æ ‡ç³»ç»Ÿçš„æ‰€æœ‰ç³»ç»Ÿæµ</li><li>ä»æœ€ç»ˆç”¨æˆ·è§’åº¦éªŒè¯éœ€æ±‚</li><li>è¯†åˆ«å¼‚æ„ç¯å¢ƒä¸­çš„é—®é¢˜</li></ul><p>å‰ç«¯ä¹Ÿæœ‰å¾ˆå¤šè‡ªåŠ¨åŒ–çš„ç«¯åˆ°ç«¯æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚nightwatchï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å¯¹é¡µé¢è¿›è¡Œæ“ä½œï¼Œä»è€Œæ£€éªŒæ•´ä¸ªåº”ç”¨æµç¨‹æ˜¯å¦æ­£å¸¸å’Œç¬¦åˆéœ€æ±‚:</p><p><img src="/images/typeof-testing/nightwatch.png" alt></p><p>å› ä¸ºå’Œ<strong>ç³»ç»Ÿæµ‹è¯•</strong>å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿè¢«ç»å¸¸æ‹¿æ¥<a href="https://www.softwaretestinghelp.com/system-vs-end-to-end-testing/" target="_blank" rel="noopener">æ¯”è¾ƒ</a></p><p><br></p><h2 id="16-ç­‰ä»·åˆ’åˆ†-equivalence-partitioning"><a href="#16-ç­‰ä»·åˆ’åˆ†-equivalence-partitioning" class="headerlink" title="16) ç­‰ä»·åˆ’åˆ†(Equivalence Partitioning)"></a>16) ç­‰ä»·åˆ’åˆ†(Equivalence Partitioning)</h2><p>ç­‰ä»·åˆ’åˆ†, è¿™æ˜¯ä¸€ç§é»‘ç›’æµ‹è¯•çš„æµ‹è¯•æŠ€æœ¯. <strong>é€šè¿‡ç­‰ä»·åˆ’åˆ†ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„è¾“å…¥æ•°æ®åˆç†åœ°åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†ç»„ï¼Œæˆ‘ä»¬åªéœ€åœ¨æ¯ä¸ªåˆ†ç»„ä¸­å–ä¸€ä¸ªæ•°æ®ä½œä¸ºæµ‹è¯•çš„è¾“å…¥æ¡ä»¶, è¿™æ ·å¯ä»¥å®ç°ç”¨å°‘é‡ä»£è¡¨æ€§çš„æµ‹è¯•æ•°æ®å–å¾—è¾ƒå¥½çš„æµ‹è¯•ç»“æœ</strong>.</p><p>æ‰€ä»¥è¯´è¿™ä¸ªæµ‹è¯•çš„ç›®çš„: æ˜¯åœ¨ä¸å¯¼è‡´ç¼ºé™·çš„å‰æä¸‹ï¼Œç§»é™¤æŒ‡å®šåˆ†ç»„ä¸­çš„é‡å¤çš„ç”¨ä¾‹, ç®€åŒ–æµ‹è¯•çš„å·¥ä½œ</p><p><img src="/images/typeof-testing/part.png" alt></p><p>æ¯”å¦‚ä¸€ä¸ªç¨‹åºåº”ç”¨æ¥å—-10åˆ°+10ä¹‹é—´çš„å€¼ï¼Œä½¿ç”¨ç­‰ä»·åˆ†åŒºæ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªåˆ†ç»„: 0ã€è´Ÿå€¼ã€æ­£å€¼. æ¥ä¸‹æ¥çš„æµ‹è¯•åªéœ€ä»è¿™ä¸ªä¸‰ä¸ªåˆ†ç»„ä¸­å–ä¸€ä¸ªæˆå‘˜è¿›è¡Œæµ‹è¯•, è€Œä¸éœ€è¦-10åˆ°+10æ¯ä¸ªæˆå‘˜éƒ½æµ‹è¯•ä¸€é.</p><p><br></p><h2 id="17-å®ä¾‹æµ‹è¯•-example-testing"><a href="#17-å®ä¾‹æµ‹è¯•-example-testing" class="headerlink" title="17) å®ä¾‹æµ‹è¯•(Example Testing)"></a>17) å®ä¾‹æµ‹è¯•(Example Testing)</h2><p>It means real-time testing. Example testing includes the real-time scenario, it also involves the scenarios based on the experience of the testers.</p><p>å®ä¾‹æµ‹è¯•æ„å‘³ç€å®æ—¶æµ‹è¯•ã€‚å®ä¾‹æµ‹è¯•åŒ…å«äº†å®æ—¶åœºæ™¯ã€å¦å¤–è¿˜æ¶‰åŠåŸºäºæµ‹è¯•äººå‘˜ç»éªŒçš„åœºæ™¯ã€‚</p><blockquote><p>ğŸ¤” è¿™é‡Œä¸æ˜¯ç‰¹åˆ«èƒ½ç†è§£è¿™ä¸ªæµ‹è¯•ç±»å‹ï¼Œæ‰€ä»¥è´´ä¸ŠåŸæ–‡ã€‚çŸ¥é“çš„å‘Šè¯‰æˆ‘å‘€</p></blockquote><p><br></p><h2 id="18-æ¢ç´¢æµ‹è¯•-exploratory-testing"><a href="#18-æ¢ç´¢æµ‹è¯•-exploratory-testing" class="headerlink" title="18) æ¢ç´¢æµ‹è¯•(Exploratory Testing)"></a>18) æ¢ç´¢æµ‹è¯•(Exploratory Testing)</h2><p><img src="/images/typeof-testing/explorer.png" alt></p><p>æ¢ç´¢æ€§æµ‹è¯•æœ‰ç‚¹ç±»ä¼¼äºAd-Hocæµ‹è¯•. æ¢ç´¢æ€§æµ‹è¯•æ˜¯ç”±æµ‹è¯•å›¢é˜Ÿè¿›è¡Œçš„éæ­£å¼æµ‹è¯•ã€‚æ­¤æµ‹è¯•çš„ç›®çš„æ˜¯æ¢ç´¢åº”ç”¨å¹¶æŸ¥æ‰¾åº”ç”¨ä¸­å­˜åœ¨çš„ç¼ºé™·ã€‚åƒæ¢é™©ä¸€æ ·ï¼Œåœ¨æµ‹è¯•æœŸé—´æ˜¯æœ‰ä¸€å®šå‡ ç‡å‘ç°çš„é‡å¤§ã€ç”šè‡³å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ•…éšœçš„ç¼ºé™·.</p><p>åœ¨æ¢ç´¢æ€§æµ‹è¯•æœŸé—´ï¼Œå»ºè®®è·Ÿè¸ªè®°å½•å¥½æµ‹è¯•çš„æµç¨‹ã€ä»¥åŠå¼€å§‹è¯¥æµç¨‹ä¹‹å‰çš„æ´»åŠ¨è®°å½•, æ–¹ä¾¿å¤ç°bug.</p><p>æ¢ç´¢æµ‹è¯•ä¸éœ€è¦ä»»ä½•æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹.</p><p><br></p><h2 id="20-åŠŸèƒ½æµ‹è¯•-functional-testing"><a href="#20-åŠŸèƒ½æµ‹è¯•-functional-testing" class="headerlink" title="20) åŠŸèƒ½æµ‹è¯•(Functional Testing)"></a>20) åŠŸèƒ½æµ‹è¯•(Functional Testing)</h2><p>åŠŸèƒ½æµ‹è¯•æ˜¯ä¸€ä¸ªå¤§ç±», åˆç§°ä¸ºè¡Œä¸ºæµ‹è¯•ï¼Œ  <strong>åŠŸèƒ½æµ‹è¯•ä¼šå¿½ç•¥å†…éƒ¨å®ç°è€Œå…³æ³¨ç»„ä»¶çš„è¾“å‡ºï¼Œç›®çš„æ˜¯éªŒè¯æ˜¯å¦ç¬¦åˆéœ€æ±‚ï¼Œè¿™æ˜¯ä¸€ç§é¢å‘åŠŸèƒ½éœ€æ±‚çš„é»‘ç›’æµ‹è¯•ç±»å‹</strong>ã€‚å…³äºåŠŸèƒ½æµ‹è¯•çš„ç»†èŠ‚è¯·çœ‹<a href="https://www.softwaretestinghelp.com/guide-to-functional-testing/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>åŠŸèƒ½æµ‹è¯•æ˜¯ç›¸å¯¹éåŠŸèƒ½æµ‹è¯•è€Œè¨€çš„, åŠŸèƒ½æµ‹è¯•éœ€è¦å…³å¿ƒåŠŸèƒ½æˆ–è€…ä¸šåŠ¡ï¼Œéœ€è¦ä¸šåŠ¡è€¦åˆç¨‹åº¦é«˜ï¼›è€ŒéåŠŸèƒ½æµ‹è¯•åˆ™æ˜¯é€šç”¨çš„ï¼Œæ¯”å¦‚å‹åŠ›æµ‹è¯•ã€è´Ÿè½½æµ‹è¯•ï¼Œè¿™äº›æµ‹è¯•éƒ½æœ‰é€šç”¨çš„å·¥å…·æ¥æ”¯æŒï¼Œä¸éœ€è¦æˆ–å¾ˆå°‘å®šåˆ¶åŒ–æ“ä½œ.</p><p><br></p><h2 id="21-guiæµ‹è¯•-graphical-user-interface-gui-testing"><a href="#21-guiæµ‹è¯•-graphical-user-interface-gui-testing" class="headerlink" title="21) GUIæµ‹è¯•(Graphical User Interface (GUI) Testing)"></a>21) GUIæµ‹è¯•(Graphical User Interface (GUI) Testing)</h2><p>GUIæµ‹è¯•çš„ç›®çš„æ˜¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚éªŒè¯GUIã€‚åœ¨è¯¦ç»†è®¾è®¡æ–‡æ¡£å’ŒGUIæ¨¡å‹(UIè®¾è®¡æ–‡æ¡£)ä¸­ä¸€èˆ¬ä¼šæåˆ°åº”ç”¨æœŸæœ›çš„GUI.</p><p>å¸¸è§çš„GUIæµ‹è¯•åŒ…æ‹¬æµ‹è¯•å±å¹•ä¸Šæ˜¾ç¤ºçš„æŒ‰é’®å’Œè¾“å…¥å­—æ®µçš„å¤§å°ã€è¡¨æ ¼ä¸­æ‰€æœ‰æ–‡æœ¬ã€è¡¨æ ¼æˆ–å†…å®¹çš„å¯¹é½è§„åˆ™ç­‰ç­‰. å¦‚æœå›¢é˜Ÿæœ‰UIè®¾è®¡è§„èŒƒï¼Œè¿˜ä¼šéªŒè¯æ˜¯å¦ç¬¦åˆè®¾è®¡è§„èŒƒ</p><p><br></p><h2 id="22-å¤§çŒ©çŒ©æµ‹è¯•-gorilla-testing"><a href="#22-å¤§çŒ©çŒ©æµ‹è¯•-gorilla-testing" class="headerlink" title="22) å¤§çŒ©çŒ©æµ‹è¯•(Gorilla Testing)"></a>22) å¤§çŒ©çŒ©æµ‹è¯•(Gorilla Testing)</h2><p><img src="/images/typeof-testing/gr.jpg" alt></p><p>å¤§çŒ©çŒ©æµ‹è¯•æ˜¯ç”±æµ‹è¯•äººå‘˜æ‰§è¡Œçš„æµ‹è¯•ç±»å‹ï¼Œæœ‰æ—¶ä¹Ÿç”±å¼€å‘äººå‘˜æ‰§è¡Œã€‚åœ¨å¤§çŒ©çŒ©æµ‹è¯•ä¸­ï¼Œå¯¹æ¨¡å—ä¸­çš„ä¸€ä¸ªæ¨¡å—æˆ–åŠŸèƒ½è¿›è¡Œäº†å½»åº•å’Œä¸¥æ ¼çš„æµ‹è¯•ã€‚åŸæ–‡æ²¡æœ‰è¯´å‡ºå¤§çŒ©çŒ©æµ‹è¯•çš„ç²¾é«“ï¼Œå¤§çŒ©çŒ©æµ‹è¯•ä¼šå¯¹ä¸€ä¸ªåŠŸèƒ½æˆ–æ¨¡å—è¿›è¡Œé‡å¤â€˜ä¸Šç™¾æ¬¡â€™çš„æµ‹è¯•, äººç±»æ ¹æœ¬å—ä¸äº†è¿™æ ·å­çš„æµ‹è¯•æ–¹å¼ï¼Œæ‰€ä»¥å¤§çŒ©çŒ©æµ‹è¯•çš„å¦ä¸€ä¸ªåˆ«åæ˜¯â€˜ä»¤äººæ²®ä¸§çš„æµ‹è¯•(Frustrating Testing)â€™</p><p>è¿™ç§æµ‹è¯•çš„ç›®çš„æ˜¯æ£€æŸ¥åº”ç”¨ç¨‹åºçš„ç¨³å¥æ€§(robustness)</p><p><br></p><h2 id="23-ä¹è§‚è·¯çº¿æµ‹è¯•-happy-path-testing"><a href="#23-ä¹è§‚è·¯çº¿æµ‹è¯•-happy-path-testing" class="headerlink" title="23) ä¹è§‚è·¯çº¿æµ‹è¯•(Happy Path Testing)"></a>23) ä¹è§‚è·¯çº¿æµ‹è¯•(Happy Path Testing)</h2><p><strong>ä¹è§‚è·¯çº¿æµ‹è¯•</strong>çš„ç›®æ ‡æ˜¯åœ¨æ­£å¸¸æµç¨‹ä¸ŠæˆåŠŸæµ‹è¯•åº”ç”¨ã€‚å®ƒä¸ä¼šè€ƒè™‘å„ç§è´Ÿé¢æˆ–å¼‚å¸¸æƒ…å†µã€‚é‡ç‚¹åªå…³æ³¨äºéªŒè¯åº”ç”¨åœ¨æœ‰æ•ˆå’Œåˆæ³•è¾“å…¥çš„æ¡ä»¶ä¸‹ç”ŸæˆæœŸæœ›çš„è¾“å‡º. æ¯”å¦‚é“¶è¡Œä»˜æ¬¾ï¼Œåªè€ƒè™‘è´¦æˆ·æœ‰é’±çš„æ­£å¸¸çŠ¶æ€ğŸ˜‚</p><p><br></p><h2 id="24-å¢é‡é›†æˆæµ‹è¯•-incremental-integration-testing"><a href="#24-å¢é‡é›†æˆæµ‹è¯•-incremental-integration-testing" class="headerlink" title="24) å¢é‡é›†æˆæµ‹è¯•(Incremental Integration Testing)"></a>24) å¢é‡é›†æˆæµ‹è¯•(Incremental Integration Testing)</h2><p>å¢é‡é›†æˆæµ‹è¯•æ˜¯ä¸€ç§è‡ªä¸‹è€Œä¸Šçš„æµ‹è¯•æ–¹æ³•ï¼Œå³åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶ç«‹å³é›†æˆåº”ç”¨ç¨‹åºè¿›è¡Œè¿ç»­æµ‹è¯•ã€‚åº”ç”¨ç¨‹åºåŠŸèƒ½å’Œæ¨¡å—åº”è¯¥è¶³å¤Ÿç‹¬ç«‹ï¼Œä»¥ä¾¿å•ç‹¬æµ‹è¯•ã€‚è¿™é€šå¸¸ç”±ç¨‹åºå‘˜æˆ–æµ‹è¯•äººå‘˜å®Œæˆã€‚</p><p><br></p><h2 id="25-å®‰è£…å¸è½½æµ‹è¯•-install-uninstall-testing"><a href="#25-å®‰è£…å¸è½½æµ‹è¯•-install-uninstall-testing" class="headerlink" title="25) å®‰è£…å¸è½½æµ‹è¯•(Install/Uninstall Testing)"></a>25) å®‰è£…å¸è½½æµ‹è¯•(Install/Uninstall Testing)</h2><p><img src="/images/typeof-testing/blue-screen.jpg" alt></p><p>å®‰è£…å’Œå¸è½½æµ‹è¯•æ˜¯åœ¨ä¸åŒç¡¬ä»¶æˆ–è½¯ä»¶ç¯å¢ƒä¸‹çš„ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„è¿›è¡Œå®Œæ•´/éƒ¨åˆ†çš„å®‰è£…ã€å‡çº§ã€å¸è½½ã€å›æ»šç­‰æµ‹è¯•. å¸¸ç”¨äºæ¡Œé¢ç«¯åº”ç”¨</p><p><br></p><h2 id="26-é›†æˆæµ‹è¯•-integration-testing"><a href="#26-é›†æˆæµ‹è¯•-integration-testing" class="headerlink" title="26) é›†æˆæµ‹è¯•(Integration Testing)"></a>26) é›†æˆæµ‹è¯•(Integration Testing)</h2><p>é›†æˆæµ‹è¯•æ˜¯æŒ‡å°†æ‰€æœ‰æ¨¡å—é›†æˆä¹‹åï¼ŒéªŒè¯åˆå¹¶åçš„åŠŸèƒ½. æ¨¡å—é€šå¸¸æ˜¯ä»£ç æ¨¡å—ã€å•ä¸ªåº”ç”¨ã€ç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç­‰ç­‰ã€‚</p><p><img src="/images/typeof-testing/ingr.png" alt></p><p>é›†æˆæµ‹è¯•ä¸€èˆ¬åœ¨å•å…ƒæµ‹è¯•ä¹‹åï¼Œæ‰€ä»¥å•å…ƒæµ‹è¯•æ˜¯é›†æˆæµ‹è¯•çš„åŸºç¡€ï¼Œæ²¡æœ‰è¿›è¡Œå•å…ƒæµ‹è¯•çš„é›†æˆæµ‹è¯•æ˜¯ä¸é è°±çš„ã€‚æ‰€ä»¥æœ€ç®€å•çš„å½¢å¼æ˜¯ï¼šâ€™æŠŠä¸¤ä¸ªå·²ç»æµ‹è¯•è¿‡çš„å•å…ƒç»„åˆæˆä¸€ä¸ªç»„ä»¶ï¼Œæµ‹è¯•å®ƒä»¬ä¹‹é—´çš„æ¥å£â€™ã€‚ä¹Ÿå°±æ˜¯è¯´<strong>é›†æˆæµ‹è¯•åœ¨å•å…ƒæµ‹è¯•çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°†å•å…ƒæµ‹è¯•ä¸­ç‹¬ç«‹çš„å•å…ƒåˆå¹¶èµ·æ¥ï¼ŒéªŒè¯å®ƒä»¬çš„åè°ƒæ€§, åˆå¹¶åçš„ç»„ä»¶åˆæ˜¯ä¸€ä¸ªæ–°çš„â€˜å•å…ƒâ€™ï¼Œè¿™æ ·é€æ­¥åˆå¹¶æµ‹è¯•ï¼Œæœ€ç»ˆå½¢æˆå®Œæ•´çš„åº”ç”¨ç¨‹åº</strong>ã€‚</p><p>è¿™ç§ç±»å‹çš„æµ‹è¯•å¸¸ç”¨äºB/Sè½¯ä»¶å’Œåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p><p><br></p><h2 id="27-è´Ÿè½½æµ‹è¯•-load-testing"><a href="#27-è´Ÿè½½æµ‹è¯•-load-testing" class="headerlink" title="27) è´Ÿè½½æµ‹è¯•(Load Testing)"></a>27) è´Ÿè½½æµ‹è¯•(Load Testing)</h2><p>å®ƒæ˜¯ä¸€ç§éåŠŸèƒ½æ€§æµ‹è¯•ï¼Œè´Ÿè½½æµ‹è¯•çš„ç›®çš„æ˜¯æ£€æŸ¥ç³»ç»Ÿå¯ä»¥æ‰¿å—å¤šå°‘è´Ÿè½½è€Œä¸ä¼šé™ä½æ€§èƒ½, æˆ–è€…è¯´ç¡®å®šæœ€å¤§å·¥ä½œè´Ÿè½½æ˜¯å¤šå°‘ã€‚</p><p>è´Ÿè½½æµ‹è¯•æœ‰åŠ©äºæŸ¥æ‰¾ç‰¹å®šè´Ÿè½½ä¸‹ç³»ç»Ÿçš„æœ€å¤§å®¹é‡ä»¥åŠå¯¼è‡´è½¯ä»¶æ€§èƒ½ä¸‹é™çš„ä»»ä½•åŸå› ã€‚å¯ä»¥ä½¿ç”¨JMeterï¼ŒLoadRunnerï¼ŒWebLoadï¼ŒSilkæ‰§è¡Œç¨‹åºç­‰å·¥å…·æ‰§è¡Œè´Ÿè½½æµ‹è¯•ã€‚</p><p><img src="/images/typeof-testing/perf.png" alt></p><p>è´Ÿè½½æµ‹è¯•ç»å¸¸å’Œæ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€ç¨³å®šæ€§æµ‹è¯•ç­‰è”ç³»åœ¨ä¸€èµ·ã€‚å¦‚ä¸Šå›¾(æ¥æºäºæ·˜å®æ€§èƒ½ç™½çš®ä¹¦). å…¶ä¸­TPS(Transation Per Second)æŒ‡çš„æ˜¯æ¯ç§’é’Ÿç³»ç»Ÿå¯ä»¥å¤„ç†çš„äº¤æ˜“æˆ–äº‹åŠ¡çš„æ•°é‡; Server ResourceæŒ‡çš„æ˜¯ç³»ç»Ÿèµ„æºå æœ‰.</p><ul><li><strong>æ€§èƒ½æµ‹è¯•</strong>. ä¸»è¦ä½äºa-bä¹‹é—´. åœ¨ç³»ç»Ÿè®¾è®¡åˆæœŸå°±ä¼šè§„åˆ’ä¸€ä¸ªé¢„æœŸç›®æ ‡, æ¯”å¦‚ç»™å®šèµ„æºAxï¼Œaç‚¹å°±æ˜¯æ€§èƒ½æœŸæœ›å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ç»™å®šå›ºå®šèµ„æºAxçš„æƒ…å†µä¸‹ï¼Œå¦‚æœTPSå¯ä»¥è¾¾åˆ°aç‚¹ç”šè‡³æ›´é«˜ï¼Œå°±è¯´æ˜ç³»ç»Ÿæ€§èƒ½è¾¾åˆ°æˆ–è€…å¥½äºé¢„æœŸ. <strong>é€šè¿‡æ€§èƒ½æµ‹è¯•å¯ä»¥éªŒè¯ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æœ‰æ²¡æœ‰è¾¾åˆ°é¢„æœŸ</strong></li><li><strong>è´Ÿè½½æµ‹è¯•</strong>. ä½äºb-cä¹‹é—´ã€‚å¯¹ç³»ç»Ÿä¸æ–­å¢åŠ å¹¶å‘è¯·æ±‚ï¼Œç›´åˆ°ç³»ç»Ÿçš„æŸé¡¹æˆ–è€…å¤šé¡¹æŒ‡æ ‡è¾¾åˆ°å®‰å…¨çš„ä¸´ç•Œå€¼ï¼Œå¦‚ä¸Šå›¾ä¸­çš„cï¼Œè¿™ä¸ªcå°±æ˜¯æ‰€è°“çš„æœ€å¤§è´Ÿè½½é‡ã€‚åé¢å†å¢åŠ è¯·æ±‚å‹åŠ›ï¼Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ä¸ä½†ä¸èƒ½æé«˜ï¼Œè¿”å›ä¼šä¸‹é™. <strong>é€šè¿‡å‹åŠ›æµ‹è¯•å¯ä»¥å¾—å‡ºç³»ç»Ÿæœ€å¤§çš„å®‰å…¨è´Ÿè½½å€¼</strong></li><li><strong>å‹åŠ›æµ‹è¯•</strong>. ä½äºc-dä¹‹é—´ã€‚åœ¨è¶…è¿‡å®‰å…¨è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œç»§ç»­å¯¹ç³»ç»Ÿå¢åŠ å‹åŠ›ï¼Œç›´åˆ°è¾¾åˆ°å´©æºƒç‚¹, å³ä¸Šå›¾çš„d. <strong>é€šè¿‡å‹åŠ›æµ‹è¯•å¯ä»¥å¾—å‡ºç³»ç»Ÿçš„æœ€å¤§æ‰¿å—èƒ½åŠ›</strong></li><li><strong>ç¨³å®šæ€§æµ‹è¯•</strong>. ä½äºa-dä¹‹é—´ã€‚åœ¨aã€bã€cã€dä¸åŒçš„ç‚¹(ä»£è¡¨ç‰¹å®šçš„ç¡¬ä»¶ã€è½¯ä»¶å’Œç½‘ç»œç¯å¢ƒ)ï¼Œè®©ç³»ç»Ÿè¿è¡Œä¸€æ®µè¾ƒé•¿çš„æ—¶é—´ï¼Œ<strong>æ£€æµ‹ç³»ç»Ÿåœ¨ä¸åŒæ¡ä»¶ä¸‹çš„ç³»ç»Ÿè¿è¡Œçš„ç¨³å®šæ€§</strong>ã€‚</li></ul><p>å¦å¤–ä¹Ÿæ¨èé˜…è¯»&lt;&lt;å¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„&gt;&gt;è¿™æœ¬ä¹¦</p><p><br></p><h2 id="28-çŒ´å­æµ‹è¯•-monkey-testing"><a href="#28-çŒ´å­æµ‹è¯•-monkey-testing" class="headerlink" title="28) çŒ´å­æµ‹è¯•(Monkey Testing)"></a>28) çŒ´å­æµ‹è¯•(Monkey Testing)</h2><p><img src="/images/typeof-testing/monkey-testing.jpg" alt></p><p>çŒ´å­æµ‹è¯•æ˜¯ç”±æµ‹è¯•äººå‘˜è¿›è¡Œçš„ï¼Œå³æŠŠè‡ªå·±å½“æˆçŒ´å­ï¼Œåœ¨æ²¡æœ‰ä»»ä½•çŸ¥è¯†èƒŒæ™¯æˆ–è€…ç†è§£åº”ç”¨å‰æä¸‹ï¼Œéšæ„è¾“å…¥å’Œæ“ä½œã€‚</p><p>çŒ´å­æµ‹è¯•çš„ç›®æ ‡æ˜¯é€šè¿‡æä¾›éšæœºè¾“å…¥å€¼/æ•°æ®æ¥æ£€æŸ¥åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿæ˜¯å¦å´©æºƒã€‚ çŒ´å­æ˜¯éšæœºæ‰§è¡Œçš„ï¼Œæ²¡æœ‰æµ‹è¯•ç”¨ä¾‹, ä¹Ÿæ²¡æœ‰å¿…è¦äº†è§£ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½</p><p><br></p><h2 id="29-å˜å¼‚æµ‹è¯•-mutation-testing"><a href="#29-å˜å¼‚æµ‹è¯•-mutation-testing" class="headerlink" title="29) å˜å¼‚æµ‹è¯•(Mutation Testing)"></a>29) å˜å¼‚æµ‹è¯•(Mutation Testing)</h2><p>å˜å¼‚æµ‹è¯•(æˆ–è€…è¯´å¯å˜æ€§æµ‹è¯•)æ˜¯ä¸€ç§ç™½ç›’æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ç§å’Œå•å…ƒæµ‹è¯•åç€æ¥çš„æµ‹è¯•ç±»å‹ã€‚</p><p><img src="/images/typeof-testing/mut.png" alt></p><p><strong>é€šå¸¸å•å…ƒæµ‹è¯•çš„æ€è·¯æ˜¯é€šè¿‡æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯ä»£ç æ˜¯å¦æœ‰æ•ˆå¯é ï¼Œè€Œå˜å¼‚æµ‹è¯•æ˜¯åè¿‡æ¥. å®ƒé¦–å…ˆæ›´æ”¹å…¶ä¸­ä¸€ä¸ªç¨‹åºçš„æºä»£ç ï¼Œå†è·‘å•å…ƒæµ‹è¯•ï¼Œå¦‚æœå•å…ƒæµ‹è¯•é€šè¿‡åˆ™å¯èƒ½è¯´æ˜æµ‹è¯•ç”¨ä¾‹æ²¡æœ‰æ•ˆæœï¼Œæˆ–è€…æµ‹è¯•ç”¨ä¾‹æ²¡æœ‰è¦†ç›–åˆ°è¿™å¤„ä»£ç å˜å¼‚</strong>. </p><p>æ‰€ä»¥è¯´å˜å¼‚æµ‹è¯•å¯ä»¥åè¿‡æ¥éªŒè¯ä½ çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¦æœ‰æ•ˆ, è¿˜æœ‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾å‡ºä¸€äº›æ— æ³•è¢«å½“å‰æµ‹è¯•æ‰€é˜²æ­¢çš„æ½œåœ¨é”™è¯¯.</p><p><br></p><h2 id="30-æ‚²è§‚æµ‹è¯•-negative-testing"><a href="#30-æ‚²è§‚æµ‹è¯•-negative-testing" class="headerlink" title="30) æ‚²è§‚æµ‹è¯•(Negative Testing)"></a>30) æ‚²è§‚æµ‹è¯•(Negative Testing)</h2><p>æ‚²è§‚æµ‹è¯•å’Œä¹è§‚è·¯çº¿æµ‹è¯•ç›¸å, å®ƒè¦æ±‚æµ‹è¯•è€…è¦å…·æœ‰â€œæ‰“ç ´â€å¸¸è§„çš„æ€åº¦ï¼Œè€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µ, ä½¿ç”¨å„ç§é‚ªæ¶çš„ğŸ‘¿ã€ä¸æ€€å¥½æ„ã€ä¸åˆæ³•çš„æ“ä½œæ¥æµ‹è¯•ç³»ç»Ÿã€‚æ‚²è§‚æµ‹è¯•ä¼šä½¿ç”¨ä¸æ­£ç¡®çš„æ•°æ®ã€æ— æ•ˆæ•°æ®æˆ–è¾“å…¥æ¥è¿›è¡ŒéªŒè¯ã€‚å®ƒéªŒè¯ç³»ç»Ÿæ˜¯å¦å¯ä»¥è¯†åˆ«å¼‚å¸¸æƒ…å†µï¼Œå¹¶æŒ‰é¢„æœŸè¿è¡Œã€‚</p><p><br></p><h2 id="31-éåŠŸèƒ½æµ‹è¯•-non-functional-testing"><a href="#31-éåŠŸèƒ½æµ‹è¯•-non-functional-testing" class="headerlink" title="31) éåŠŸèƒ½æµ‹è¯•(Non-Functional Testing)"></a>31) éåŠŸèƒ½æµ‹è¯•(Non-Functional Testing)</h2><p>æ¯ä¸ªå¤§å‹çš„ç»„ç»‡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å›¢é˜Ÿï¼Œé€šå¸¸ç§°ä¸ºéåŠŸèƒ½æµ‹è¯•ï¼ˆNFTï¼‰å›¢é˜Ÿæˆ–æ€§èƒ½å›¢é˜Ÿã€‚</p><p>éåŠŸèƒ½æ€§æµ‹è¯•æ¶‰åŠæµ‹è¯•éåŠŸèƒ½æ€§éœ€æ±‚ï¼Œå¦‚è´Ÿè½½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€å®‰å…¨æ€§ã€å®¹é‡ï¼Œæ¢å¤æµ‹è¯•ç­‰ç­‰. NFTæµ‹è¯•çš„ç›®æ ‡æ˜¯ç¡®ä¿è½¯ä»¶æˆ–åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´æ˜¯å¦æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p><p>ä¾‹å¦‚åŠ è½½ä»»ä½•é¡µé¢æˆ–ç³»ç»Ÿéƒ½ä¸åº”è¯¥èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œå¹¶ä¸”åœ¨è´Ÿè½½å³°å€¼æœŸé—´åº”è¯¥ç»´æŒè‰¯å¥½è¿è¡ŒçŠ¶æ€ã€‚</p><p><br></p><h2 id="32-æ€§èƒ½æµ‹è¯•-performance-testing"><a href="#32-æ€§èƒ½æµ‹è¯•-performance-testing" class="headerlink" title="32) æ€§èƒ½æµ‹è¯•(Performance Testing)"></a>32) æ€§èƒ½æµ‹è¯•(Performance Testing)</h2><p>è¿™ä¸ªæœ¯è¯­é€šå¸¸ä¸â€œå‹åŠ›â€å’Œâ€œè´Ÿè½½â€æµ‹è¯•äº’æ¢ä½¿ç”¨ã€‚<a href="https://en.wikipedia.org/wiki/Software_performance_testing" target="_blank" rel="noopener">æ€§èƒ½æµ‹è¯•</a>ç”¨äºæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ»¡è¶³æ€§èƒ½è¦æ±‚ã€‚å®ƒä¼šä½¿ç”¨ä¸åŒçš„æ€§èƒ½å’Œè´Ÿè½½å·¥å…·æ¥æ‰§è¡Œæ­¤æµ‹è¯•ã€‚</p><p><a href="https://www.softwaretestinghelp.com/introduction-to-performance-testing-loadrunner-training-tutorial-part-1/" target="_blank" rel="noopener">æ€§èƒ½æµ‹è¯•</a>è¿™ä¸ªèŒƒå›´æ¯”è¾ƒå¤§ï¼Œ<strong>å¹¿ä¹‰ä¸Šçš„æ€§èƒ½æµ‹è¯•åŒ…æ‹¬äº†ä¸Šæ–‡æåˆ°çš„è´Ÿè½½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€ç¨³å®šæ€§æµ‹è¯•ã€å®¹é‡æµ‹è¯•ç­‰ç­‰ã€‚ç‹­ä¹‰çš„æ€§èƒ½æµ‹è¯•åˆ™æ˜¯æŒ‡åœ¨ç‰¹å®šèµ„æºæ¡ä»¶ä¸‹ï¼Œæµ‹è¯•ç³»ç»Ÿèƒ½å¦è¾¾åˆ°æœŸæœ›å€¼, ä¹Ÿå°±æ˜¯åŸºçº¿æµ‹è¯•(Baseline Test).</strong></p><p>æ€»ç»“ä¸€ä¸‹æ€§èƒ½æµ‹è¯•çš„ç±»å‹:</p><ul><li><strong>åŸºçº¿æµ‹è¯•(Baseline Test)</strong>: åœ¨ç»™å®šçš„èµ„æºä¸‹ï¼Œæµ‹è¯•æœ€ä½³çš„æ€§èƒ½ï¼Œç”¨ä½œåç»­æµ‹é‡çš„å‚è€ƒâ€˜åŸºçº¿â€™ã€‚æ³¨æ„åŸºçº¿æµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•æ˜¯æœ‰åŒºåˆ«çš„, è¿™ä¹ˆç†è§£ï¼ŒåŸºå‡†æ˜¯ä½ æƒ³è¾¾åˆ°çš„ï¼Œæ¯”å¦‚100çŸ­è·‘ä¸–ç•Œçºªå½•ï¼ŒåŸºçº¿æ˜¯ä½ çš„æˆç»©ã€‚</li><li><strong>è´Ÿè½½æµ‹è¯•(Load Test)</strong>: åœ¨é¢„æœŸå³°å€¼çš„ç”Ÿäº§è´Ÿè½½ä¸‹æµ‹é‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚ä¸Šæ–‡è´Ÿè½½æµ‹è¯•å·²ç»å¤§æ¦‚ä»‹ç»äº†</li><li><strong>ç¨³å®šæ€§æµ‹è¯•(Endurance Test)</strong>: åœ¨æŒ‡å®šè´Ÿè½½ä¸‹ï¼Œé•¿æ—¶é—´æµ‹é‡ç³»ç»Ÿçš„ç¨³å®šæ€§</li><li><strong>å‹åŠ›æµ‹è¯•(Stress Test)</strong>: æµ‹è¯•æç«¯æ¡ä»¶ä¸‹çš„ç³»ç»Ÿæ€§èƒ½</li></ul><p><br></p><h2 id="33-æ¢å¤æµ‹è¯•-recovery-testing"><a href="#33-æ¢å¤æµ‹è¯•-recovery-testing" class="headerlink" title="33) æ¢å¤æµ‹è¯•(Recovery Testing)"></a>33) æ¢å¤æµ‹è¯•(Recovery Testing)</h2><p>æ¢å¤æµ‹è¯•ç”¨äºéªŒè¯åº”ç”¨æˆ–ç³»ç»Ÿä¸­å´©æºƒæˆ–ç¾éš¾ä¸­æ¢å¤çš„ç¨‹åº¦. ç¡®å®šç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿåœ¨ç¾éš¾å‘ç”Ÿåç»§ç»­è¿è¡Œã€‚</p><p>æ¯”å¦‚åº”ç”¨é€šè¿‡ç½‘ç»œç”µç¼†æ¥æ”¶æ•°æ®ï¼Œçªç„¶æ–­å¼€äº†ç½‘ç»œç”µç¼†çš„è¿æ¥, è¿‡ä¸€æ®µæ—¶é—´ï¼Œå†æ’ä¸Šç½‘çº¿, ç³»ç»Ÿåº”è¯¥å¼€å§‹æ¢å¤ç”±äºç½‘ç»œç”µç¼†æ‹”å‡ºè€Œä¸¢å¤±è¿æ¥çš„æ•°æ®</p><p><br></p><h2 id="34-å›å½’æµ‹è¯•-regression-testing"><a href="#34-å›å½’æµ‹è¯•-regression-testing" class="headerlink" title="34) å›å½’æµ‹è¯•(Regression Testing)"></a>34) å›å½’æµ‹è¯•(Regression Testing)</h2><p>åœ¨ä¿®æ”¹ä»»æ„æ¨¡å—æˆ–è€…åŠŸèƒ½åï¼Œå°†åº”ç”¨ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæµ‹è¯•ï¼Œç§°ä¸ºå›å½’æµ‹è¯•ã€‚<strong>å›å½’æµ‹è¯•çš„ç›®çš„å°±æ˜¯éªŒè¯åœ¨è½¯ä»¶åŸæœ‰çš„åŠŸèƒ½å˜åŠ¨åæ˜¯å¦ä¿æŒå®Œæ•´æ€§</strong>. </p><p><img src="/images/typeof-testing/bug-fix.gif" alt></p><p><strong>æœ‰è§‚ç‚¹è®¤ä¸ºå›å½’æµ‹è¯•å°±æ˜¯å›å½’æµ‹è¯•æ˜¯æŒ‡é‡å¤æ‰§è¡Œä»¥å‰çš„å…¨éƒ¨æˆ–éƒ¨åˆ†ç›¸åŒçš„æµ‹è¯•å·¥ä½œ, å…¶å®ä¸æ˜¯ä¸æ— é“ç†ã€‚è€Œä¸”å› ä¸ºå±€éƒ¨ä¿®æ”¹è€Œç‰µä¸€å‘åŠ¨å…¨èº«çš„æ„å¤–åœ¨å¹³æ—¶å¼€å‘ä¸­å¹¶ä¸å°‘è§ï¼Œè¿™ç§æ„å¤–æ€§å°±æ˜¯å›å½’æµ‹è¯•çš„å­˜åœ¨çš„ç›®çš„</strong>.</p><p>å› ä¸ºåœ¨å›å½’æµ‹è¯•ä¸­å¾ˆéš¾è¦†ç›–æ‰€æœ‰ç³»ç»Ÿï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·è¿›è¡Œè¿™äº›ç±»æµ‹è¯•ã€‚æ¯”å¦‚æ¯æ¬¡ä¿®æ”¹å®Œä»£ç ï¼Œè·‘å•å…ƒæµ‹è¯•æ¥ç¡®ä¿ä¸å½±å“ç¡®ä¿å…¶ä»–è½¯ä»¶å•å…ƒã€‚</p><p>åœ¨å‰ç«¯ä¸­<a href="https://jestjs.io/docs/en/snapshot-testing" target="_blank" rel="noopener">ç»„ä»¶å¿«ç…§æµ‹è¯•(Snapshot Testing)</a>å’Œä¸€äº›<a href="https://github.com/HuddleEng/PhantomCSS" target="_blank" rel="noopener">CSS UIæµ‹è¯•</a>ï¼Œéƒ½æ˜¯å±äºå›å½’æµ‹è¯•ç±»å‹,å®ƒä»¬çš„åŸç†éƒ½æ˜¯å’Œä¸Šä¸€æ¬¡æµ‹è¯•ç”Ÿæˆçš„ç»“æœè¿›è¡Œæ¯”å¯¹ï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ„å¤–çš„ä¿®æ”¹:</p><p><img src="/images/typeof-testing/phantomcss.png" alt></p><p><br></p><h2 id="35-åŸºäºé£é™©çš„æµ‹è¯•-risk-based-testing-rbt"><a href="#35-åŸºäºé£é™©çš„æµ‹è¯•-risk-based-testing-rbt" class="headerlink" title="35) åŸºäºé£é™©çš„æµ‹è¯•(Risk-Based Testing (RBT))"></a>35) åŸºäºé£é™©çš„æµ‹è¯•(Risk-Based Testing (RBT))</h2><p>åœ¨åŸºäºé£é™©çš„æµ‹è¯•ä¸­ï¼ŒåŠŸèƒ½æˆ–éœ€æ±‚å°†æ ¹æ®å…¶ä¼˜å…ˆçº§è¿›è¡Œæµ‹è¯•ã€‚åŸºäºé£é™©çš„æµ‹è¯•ä¼šä¼˜å…ˆæµ‹è¯•é«˜åº¦å…³é”®çš„åŠŸèƒ½ï¼Œå› ä¸ºè¿™äº›åŠŸèƒ½å¯¹ä¸šåŠ¡å½±å“æœ€å¤§æˆ–è€…æ•…éšœæ¦‚ç‡éå¸¸é«˜. è€Œä¼˜å…ˆçº§ç”±ä¸šåŠ¡éœ€æ±‚å†³å®šï¼Œå› æ­¤ä¸€æ—¦ä¸ºæ‰€æœ‰åŠŸèƒ½è®¾ç½®äº†ä¼˜å…ˆçº§ï¼Œåˆ™åº”è¯¥é¦–å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§åŠŸèƒ½æˆ–æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åå†æ‰§è¡Œä½ä¼˜å…ˆçº§åŠŸèƒ½ã€‚ ä½ä¼˜å…ˆçº§åŠŸèƒ½å¯ä»¥åœ¨æ—¶é—´å……è£•æ—¶æµ‹è¯•ï¼Œæˆ–è€…ä¸æµ‹è¯•ã€‚</p><p><strong>åŸºäºé£é™©çš„æµ‹è¯•åº”è¯¥åœ¨â€˜ä¸å¤Ÿæ—¶é—´æ¥æµ‹è¯•æ•´ä¸ªåº”ç”¨ï¼Œä½†æ˜¯åˆè¦æŒ‰æ—¶äº¤ä»˜è½¯ä»¶â€™çš„æƒ…å†µä¸‹æ‰§è¡Œ</strong>ï¼Œé€šå¸¸è¿˜éœ€è¦å®¢æˆ·å’Œé«˜çº§ç®¡ç†å±‚çš„è®¨è®ºå’Œæ‰¹å‡†ä¹‹åæ‰è¿›è¡Œ</p><p><br></p><h2 id="36-å®Œæ•´æ€§æµ‹è¯•-sanity-testing"><a href="#36-å®Œæ•´æ€§æµ‹è¯•-sanity-testing" class="headerlink" title="36) å®Œæ•´æ€§æµ‹è¯•(Sanity Testing)"></a>36) å®Œæ•´æ€§æµ‹è¯•(Sanity Testing)</h2><p>å®Œæ•´æ€§æµ‹è¯•ç”¨äºç¡®å®šä¸€ä¸ªæ–°çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å¼€å§‹è¿›è¡Œæ­£å¼çš„æµ‹è¯•ï¼Œå¦‚æœä¸€ä¸ªåº”è¯¥åœ¨ä¸€å¼€å§‹ä½¿ç”¨æ—¶å°±å´©æºƒï¼Œé‚£ä¹ˆå°±è¯´æ˜ç³»ç»Ÿè¿˜ä¸å¤Ÿç¨³å®šï¼Œæ²¡æœ‰å¿…è¦è¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•ã€‚è¿™ç§æƒ…å†µåº”è¯¥æ‰“å›ç»™å¼€å‘ï¼Œä»¥å…æµªè´¹æ—¶é—´</p><p>ä»¥æˆ‘ä»¬å…¬å¸ä¸ºä¾‹:</p><p><img src="/images/typeof-testing/smoke.png" alt></p><ul><li>åœ¨è½¯ä»¶è®¾è®¡é˜¶æ®µï¼Œæµ‹è¯•å›¢é˜Ÿå°±ä¼šä¸ºç¼–å†™å†’çƒŸæµ‹è¯•ç”¨ä¾‹; </li><li>å¼€å‘å›¢é˜Ÿåœ¨æäº¤ç‰ˆæœ¬ç»™æµ‹è¯•ä¹‹å‰ä¼šè‡ªå·±è·‘ä¸€ä¸‹å†’çƒŸç”¨ä¾‹, ç¡®ä¿æ²¡æœ‰é‡å¤§æ•…éšœï¼›</li><li>å°†ç‰ˆæœ¬æäº¤ç»™æµ‹è¯•å›¢é˜Ÿåï¼Œæµ‹è¯•å›¢é˜Ÿå°±ä¼šå…ˆè·‘ä¸€ä¸‹å®Œæ•´æ€§æµ‹è¯•ï¼Œæ£€æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰é‡å¤§çš„ï¼Œå½±å“æµ‹è¯•è¿›ç¨‹çš„bugï¼Œå¦‚æœæœ‰åˆ™é€€å›å¼€å‘</li><li>å¦‚æœé€šè¿‡äº†å®Œæ•´æ€§æµ‹è¯•, åˆ™è¿›è¡Œå†’çƒŸæµ‹è¯•ï¼Œå¦‚æœå†’çƒŸæµ‹è¯•æ²¡æœ‰é€šè¿‡ä¹Ÿä¼šç«‹å³æ‰“å›å¼€å‘ã€‚</li><li>é¡ºåˆ©é€šè¿‡å®Œæ•´æ€§æµ‹è¯•å’Œå†’çƒŸæµ‹è¯•ä¹‹åæ‰ä¼šè¿›å…¥æ­£å¼æµ‹è¯•é˜¶æ®µã€‚</li></ul><p>è¿™ä¹ˆåšçš„ç›®çš„ä¹‹ä¸€å°±æ˜¯ä¸ºäº†é™ä½æµ‹è¯•å›¢é˜Ÿçš„å·¥ä½œè´Ÿæ‹…ï¼Œå› ä¸ºä»–ä»¬è¦å¯¹æ¥å¤šä¸ªå¼€å‘å›¢é˜Ÿçš„æµ‹è¯•ä»»åŠ¡ã€‚</p><p><br></p><h2 id="37-å®‰å…¨æµ‹è¯•-security-testing"><a href="#37-å®‰å…¨æµ‹è¯•-security-testing" class="headerlink" title="37) å®‰å…¨æµ‹è¯•(Security Testing)"></a>37) å®‰å…¨æµ‹è¯•(Security Testing)</h2><p><img src="/images/typeof-testing/sec.png" alt></p><p>å®‰å…¨ä¹Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„å­¦ç§‘ï¼Œè€Œä¸”çŸ¥è¯†æ¯å¤©éƒ½åœ¨æ›´æ–°ï¼Œæ‰€ä»¥å®‰å…¨æµ‹è¯•ä¸€èˆ¬ç”±ç‰¹æ®Šçš„å®‰å…¨å›¢é˜Ÿæ‰§è¡Œï¼Œä»–ä»¬ä»¥å„ç§é»‘å®¢æ‰‹æ®µå¯¹ç³»ç»Ÿè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚</p><p>å®‰å…¨æµ‹è¯•æ—¨åœ¨ç¡®ä¿åº”ç”¨æˆ–ç½‘ç«™å…å—å†…éƒ¨å’Œå¤–éƒ¨å¨èƒçš„ä¾µå®³ã€‚è¿™ä¸ªæµ‹è¯•åŒ…æ‹¬é¢„é˜²æ¶æ„ç¨‹åºã€ç—…æ¯’ï¼› æ£€éªŒæˆæƒå’Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</p><p>å®ƒè¿˜ä¼šæ£€æŸ¥è½¯ä»¶å¯¹ä»»ä½•é»‘å®¢æ”»å‡»å’Œæ¶æ„ç¨‹åºçš„ååº”æ–¹å¼ï¼Œä»¥åŠåœ¨é­åˆ°é»‘å®¢æ”»å‡»åå¦‚ä½•ç»´æŠ¤è½¯ä»¶ä»¥ä¿æŠ¤æ•°æ®å®‰å…¨</p><p><br></p><h2 id="38-å†’çƒŸæµ‹è¯•-smoke-testing"><a href="#38-å†’çƒŸæµ‹è¯•-smoke-testing" class="headerlink" title="38) å†’çƒŸæµ‹è¯•(Smoke Testing)"></a>38) å†’çƒŸæµ‹è¯•(Smoke Testing)</h2><p><img src="/images/typeof-testing/note7.jpg" alt></p><p>å†’çƒŸæµ‹è¯•ï¼Œæ¯å½“å¼€å‘å›¢é˜Ÿæäº¤æ–°çš„æ„å»ºæ—¶ï¼Œè½¯ä»¶æµ‹è¯•å›¢é˜Ÿå°±ä¼šå…ˆéªŒè¯æ„å»º, å¹¶ç¡®ä¿ä¸å­˜åœ¨é‡å¤§é—®é¢˜, å¦‚æœå­˜åœ¨é‡å¤§é—®é¢˜ä¼šç›´æ¥æ‰“å›å¼€å‘å›¢é˜Ÿ.</p><p>å¦‚ä½•é€šä¿—åœ°ç†è§£å†’çƒŸæµ‹è¯•å‘¢ï¼Ÿè¿™ä¸ªå±äºæ¥æºäºç¡¬ä»¶è¡Œä¸šï¼Œå¯¹ä¸€ä¸ªç¡¬ä»¶æˆ–ç¡¬ä»¶ç»„ä»¶è¿›è¡Œæ›´æ”¹æˆ–ä¿®å¤åï¼Œç›´æ¥ç»™è®¾å¤‡åŠ ç”µã€‚å¦‚æœæ²¡æœ‰å†’çƒŸï¼Œåˆ™è¯¥ç»„ä»¶å°±é€šè¿‡äº†æµ‹è¯•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç»™ä¸‰æ˜ŸNote7åŠ ç”µï¼Œå¦‚æœæ²¡çˆ†ç‚¸ï¼Œå°±è¯´æ˜é€šè¿‡äº†â€˜å†’çƒŸæµ‹è¯•â€™(æ„Ÿè§‰å½“æ‰‹æœºæµ‹è¯•è€…ä¸å®¹æ˜“ï¼Œå®¹æ˜“æœ‰ç”Ÿå‘½å±é™©ğŸ˜‚)?</p><p>æµ‹è¯•å›¢é˜Ÿåœ¨ç¡®ä¿æ„å»ºç¨³å®šåæ‰ä¼šè¿›ä¸€æ­¥æ‰§è¡Œè¯¦ç»†çš„æµ‹è¯•ã€‚ å†’çƒŸæ£€æŸ¥ä¼šæ£€æŸ¥æ„å»ºä¸­æ˜¯å¦å­˜åœ¨ä¸­æ–­ç¼ºé™·(stopper defect, å³å½±å“ç»§ç»­æµ‹è¯•çš„ç¼ºé™·)ï¼Œè¿™å°†é˜»æ­¢æµ‹è¯•å›¢é˜Ÿè¿›ä¸€æ­¥è¯¦ç»†æµ‹è¯•ã€‚ å³å¦‚æœæµ‹è¯•äººå‘˜å‘ç°ä¸»è¦åŠŸèƒ½ä¸èƒ½å·¥ä½œï¼Œä»–ä»¬ä¼šæ‹’ç»è¿™æ¬¡æ„å»ºï¼Œå¹¶é€€å›ç»™å¼€å‘å›¢é˜Ÿã€‚</p><p>å†’çƒŸæµ‹è¯•ä¸€èˆ¬åœ¨å›å½’æµ‹è¯•æˆ–å…¶ä»–è¯¦ç»†æµ‹è¯•ä¹‹å‰è¿›è¡Œ</p><p><br></p><h2 id="39-é™æ€æµ‹è¯•-static-testing"><a href="#39-é™æ€æµ‹è¯•-static-testing" class="headerlink" title="39) é™æ€æµ‹è¯•(Static Testing)"></a>39) é™æ€æµ‹è¯•(Static Testing)</h2><p><img src="/images/typeof-testing/review.jpg" alt></p><p>é™æ€æµ‹è¯•æœ‰ç‚¹ç±»ä¼¼äºä»£ç Reviewï¼Œåœ¨ä¸æ‰§è¡Œä»»ä½•ä»£ç çš„æƒ…å†µä¸‹æ‰§è¡Œ(ä¹Ÿå°±æ˜¯ä¸è¿è¡Œåº”ç”¨)ï¼Œå®ƒæ¶‰åŠå¯¹å¯äº¤ä»˜æˆæœå®¡æŸ¥(inspection)ã€reviewå’Œæ¼”ç»ƒ(walkthrough). æ¯”å¦‚æ£€æŸ¥ä»£ç è¯­æ³•ã€å‘½åçº¦å®šã€é¡¹ç›®ç»„ç»‡ã€‚</p><p>é™æ€æµ‹è¯•ä¸ä»…é€‚ç”¨äºä»£ç , ä¹Ÿé€‚ç”¨äºæµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•è®¡åˆ’å’Œè®¾è®¡æ–‡æ¡£. å¦‚æœåœ¨é™æ€æµ‹è¯•é˜¶æ®µå‘ç°ç¼ºé™·ï¼Œå¯ä»¥å°†ç¼ºé™·æˆæœ¬é™åˆ°æœ€ä½ã€‚æ¯”å¦‚åœ¨è®¾è®¡é˜¶æ®µå°±å‘ç°é—®é¢˜ï¼Œç›¸æ¯”åˆ°å¼€å‘é˜¶æ®µç”šè‡³åˆ°ç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜è¦å¥½è§£å†³</p><p>ä¸¾å‰ç«¯çš„ä¾‹å­ï¼Œé™æ€æµ‹è¯•å¯èƒ½åŒ…æ‹¬:</p><ul><li>ä½¿ç”¨Lintå·¥å…·å¯¹ç¨‹åºè¿›è¡Œè§„èŒƒæ£€æŸ¥ï¼Œç›¸å…³çš„å·¥å…·æœ‰ESLintã€TSLintã€Stylintç­‰, ç”šè‡³Typescriptè¿™äº›ç±»å‹æ£€æŸ¥å™¨ä¹Ÿå¯ä»¥å½’åˆ°è¿™ä¸ªèŒƒç•´</li><li>ä»£ç Reviewã€‚æœ‰ä¸€äº›é—®é¢˜æ˜¯æ— æ³•é€šè¿‡Lintå·¥å…·è¦†ç›–çš„ï¼Œæ¯”å¦‚ä»£ç é€»è¾‘ã€å¼‚å¸¸æ•è·ã€é¡¹ç›®ç»„ç»‡ã€å†…å­˜æ³„éœ²ç­‰ç­‰ï¼Œè¿™äº›éœ€è¦äººå·¥è¿›è¡Œèµ°æŸ¥Review</li><li>æ£€æŸ¥ä»£ç æ˜¯å¦ä¸è®¾è®¡ä¸€è‡´ï¼Œæ˜¯å¦ç¬¦åˆè½¯ä»¶éœ€æ±‚ã€æ¦‚è¦å’Œè¯¦ç»†è®¾è®¡ï¼Œè¿™ä¸ä»…å¯ä»¥çœ‹å‡ºä»£ç é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥æ›´æ—©å‘ç°éœ€æ±‚æˆ–è®¾è®¡æ˜¯å¦æ­£ç¡®ã€‚</li></ul><p><br></p><h2 id="40-å‹åŠ›æµ‹è¯•-stress-testing"><a href="#40-å‹åŠ›æµ‹è¯•-stress-testing" class="headerlink" title="40) å‹åŠ›æµ‹è¯•(Stress Testing)"></a>40) å‹åŠ›æµ‹è¯•(Stress Testing)</h2><p><img src="/images/typeof-testing/str.jpg" alt></p><p><strong>é€šè¿‡å‹åŠ›æµ‹è¯•ï¼Œæ¨¡æ‹Ÿç³»ç»Ÿå—åˆ°è¶…å‡ºå…¶è§„æ ¼çš„å‹åŠ›æ—¶å¤±è´¥çš„æ–¹å¼å’Œæ—¶é—´, æ‰¾å‡ºç³»ç»Ÿçš„å´©æºƒç‚¹</strong>. è¿™ä¸ªæµ‹è¯•åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹æ‰§è¡Œçš„ï¼Œä¾‹å¦‚å­˜å–è¶…è¿‡å®¹é‡é™åˆ¶çš„æ•°æ®ã€æ‰§è¡Œå¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢ã€è¿ç»­æš´åŠ›è¾“å…¥åˆ°ç³»ç»Ÿæˆ–åŠ è½½åˆ°æ•°æ®åº“ã€‚</p><p><br></p><h2 id="41-ç³»ç»Ÿæµ‹è¯•-system-testing"><a href="#41-ç³»ç»Ÿæµ‹è¯•-system-testing" class="headerlink" title="41) ç³»ç»Ÿæµ‹è¯•(System Testing)"></a>41) ç³»ç»Ÿæµ‹è¯•(System Testing)</h2><p>ç³»ç»Ÿæµ‹è¯•åœ¨å®Œæ•´çš„é›†æˆç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>ç³»ç»Ÿæµ‹è¯•ä¸€èˆ¬åœ¨é›†æˆæµ‹è¯•ä¹‹åè¿›è¡Œï¼Œé›†æˆæµ‹è¯•ä¹‹åç³»ç»Ÿæˆä¸ºäº†ä¸€ä¸ªæ•´ä½“ï¼Œç³»ç»Ÿæµ‹è¯•åœ¨è¿™ä¸ªåŸºç¡€ä¸Šã€åœ¨çœŸå®çš„è¿è¡Œç¯å¢ƒä¸­éªŒè¯ç³»ç»Ÿæ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚</strong>ã€‚ è¿™æ˜¯ä¸€ç§é»‘ç›’å‹æµ‹è¯•ï¼ŒåŸºäºæ€»ä½“éœ€æ±‚è§„èŒƒï¼Œæ¶µç›–ç³»ç»Ÿçš„æ‰€æœ‰ç»„åˆéƒ¨åˆ†ã€‚</p><p>ç³»ç»Ÿæµ‹è¯•å…¶å®ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æµ‹è¯•æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ä¸ªæµ‹è¯•é˜¶æ®µã€‚ è¿™ä¸ªé˜¶æ®µä¼šè¿›è¡Œå¾ˆå¤šç§æµ‹è¯•ï¼Œä¸€èˆ¬å…¬å¸çš„æµ‹è¯•å›¢é˜Ÿçš„å·¥ä½œå°±é›†ä¸­åœ¨è¿™ä¸€å—ã€‚ ä¸€èˆ¬åŒ…å«:</p><ul><li><strong>åŠŸèƒ½æµ‹è¯•</strong>: å³ä¸Šé¢è®²çš„ï¼Œä»ç³»ç»Ÿçš„æ•´ä½“ä¸Šæµ‹è¯•æ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚</li><li><strong>å„ç§éåŠŸèƒ½æµ‹è¯•</strong>ï¼šä¾‹å¦‚æ¢å¤æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€å®‰å…¨æµ‹è¯•ç­‰ç­‰ã€‚</li></ul><p>å½’çº³ä¸€ä¸‹<strong>ç³»ç»Ÿæµ‹è¯•çš„ç›®çš„</strong>:</p><ul><li>ç¡®ä¿åº”ç”¨<strong>ä½œä¸ºä¸€ä¸ªæ•´ä½“</strong>å¯ä»¥è‰¯å¥½åœ°è¿è¡Œ.</li><li>ç¡®ä¿åº”ç”¨ç¬¦åˆä¸šåŠ¡éœ€æ±‚</li><li>ç¡®ä¿åº”ç”¨åœ¨çœŸå®çš„ç¯å¢ƒå¯ä»¥è‰¯å¥½åœ°è¿è¡Œã€‚æ¯”å¦‚è¿›è¡Œä¸€äº›éåŠŸèƒ½æµ‹è¯•ï¼ŒéªŒè¯ç³»ç»Ÿçš„å¥å£®æ€§</li></ul><p>å…¶å®ç³»ç»Ÿæµ‹è¯•å’Œä¸Šæ–‡è¯´çš„ç«¯åˆ°ç«¯æµ‹è¯•å¾ˆåƒï¼Œå®ƒä»¬è¦æ±‚ç³»ç»Ÿä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥ç®€å•å±•å¼€å¯¹æ¯”ä¸€ä¸‹</p><table><thead><tr><th></th><th>ç³»ç»Ÿæµ‹è¯•</th><th>ç«¯åˆ°ç«¯æµ‹è¯•</th></tr></thead><tbody><tr><td>æµ‹è¯•èŒƒå›´</td><td>ä¸€èˆ¬é’ˆå¯¹è¢«æµ‹åº”ç”¨æœ¬èº«</td><td>ä¸€èˆ¬é’ˆå¯¹è¢«æµ‹åº”ç”¨ä»¥åŠå…¶ä¾èµ–çš„å…¶ä»–ç³»ç»Ÿã€‚æ­£å¦‚å…¶åï¼Œç«¯åˆ°ç«¯ï¼Œå³ä»ä¸€ç«¯ç‚¹åˆ°å¦ä¸€ç«¯ç‚¹ã€‚é‡ç‚¹å…³æ³¨å‰ç«¯ã€åç«¯ä»¥åŠä¸­é—´ä»¶ä¹‹é—´çš„å¤„ç†æµç¨‹</td></tr><tr><td>æµ‹è¯•ç±»å‹</td><td>åŒ…å«åŠŸèƒ½æµ‹è¯•å’ŒéåŠŸèƒ½æµ‹è¯•</td><td>ä¸€èˆ¬æ¶µç›–æ‰€æœ‰æºç³»ç»Ÿå’Œç›®æ ‡ç³»ç»Ÿä¹‹é—´çš„æ¥å£çº§åˆ«çš„æµ‹è¯•</td></tr><tr><td>æµ‹è¯•æ—¶æœº</td><td>ä¸€èˆ¬åœ¨é›†æˆæµ‹è¯•ä¹‹å</td><td>ä¸€èˆ¬åœ¨ç³»ç»Ÿæµ‹è¯•ä¹‹å</td></tr></tbody></table><p><br></p><h2 id="42-å•å…ƒæµ‹è¯•-unit-testing"><a href="#42-å•å…ƒæµ‹è¯•-unit-testing" class="headerlink" title="42) å•å…ƒæµ‹è¯•(Unit Testing)"></a>42) å•å…ƒæµ‹è¯•(Unit Testing)</h2><p><img src="/images/typeof-testing/unit-test.png" alt></p><p><strong>æµ‹è¯•ç‹¬ç«‹çš„è½¯ä»¶å•å…ƒæˆ–æ¨¡å—ç§°ä¸ºå•å…ƒæµ‹è¯•</strong>ã€‚å®ƒé€šå¸¸ç”±å¼€å‘è€…å®Œæˆï¼Œè€Œä¸æ˜¯ç”±æµ‹è¯•äººå‘˜å®Œæˆï¼Œå› ä¸ºå®ƒéœ€è¦è¯¦ç»†äº†è§£å†…éƒ¨ç¨‹åºè®¾è®¡å’Œä»£ç ã€‚</p><p>å•å…ƒæµ‹è¯•æ˜¯å’Œæˆ‘ä»¬å¼€å‘è€…æœ€å¯†åˆ‡ç›¸å…³çš„æµ‹è¯•ç±»å‹ã€‚å®ƒçš„æµ‹è¯•å¯¹è±¡æ˜¯è½¯ä»¶å•å…ƒã€‚<strong>è½¯ä»¶å•å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°/æ–¹æ³•ã€ä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªGUIç»„ä»¶ç­‰</strong>ã€‚</p><p>è¿™æ˜¯ä¸€ç§ç™½ç›’æµ‹è¯•ï¼Œæ‰€ä»¥è¦æ±‚ç”±å¼€å‘è€…è‡ªå·±è¿›è¡Œï¼Œå› ä¸ºåªæœ‰å¼€å‘è€…æ‰çŸ¥é“å•å…ƒçš„å†…éƒ¨å®ç°ã€‚<strong>å•å…ƒæµ‹è¯•ä¸€èˆ¬ä¼šä½¿ç”¨æµ‹è¯•è¦†ç›–ç‡æ¥éªŒè¯å•å…ƒæµ‹è¯•çš„å®Œæˆåº¦</strong>. </p><p>å‰ç«¯å¸¸è§çš„å•å…ƒæµ‹è¯•å·¥å…·æœ‰Jestã€Mochaã€Jasmineç­‰ç­‰. ä¸‹é¢æ˜¯å…¸å‹çš„BDDé£æ ¼çš„å•å…ƒæµ‹è¯•ç»„ç»‡:</p><p><img src="/images/typeof-testing/bdd.png" alt></p><p><br></p><h2 id="43-å¯ç”¨æ€§æµ‹è¯•-usability-testing"><a href="#43-å¯ç”¨æ€§æµ‹è¯•-usability-testing" class="headerlink" title="43) å¯ç”¨æ€§æµ‹è¯•(Usability Testing)"></a>43) å¯ç”¨æ€§æµ‹è¯•(Usability Testing)</h2><p>å¯ç”¨æ€§æµ‹è¯•ç”¨äºæ£€æµ‹åº”ç”¨çš„ç”¨æˆ·å‹å¥½ç¨‹åº¦(User-friendliness). å®ƒä¼šéªŒè¯æ–°ç”¨æˆ·å—å¯ä»¥è½»æ¾ç†è§£åº”ç”¨æµç¨‹ï¼Œå¦‚æœç”¨æˆ·é™·å…¥éº»çƒ¦ï¼Œæµ‹è¯•äººå‘˜è¦è®°å½•å¥½å¹¶æä¾›å¸®åŠ©ã€‚å¯ä»¥è®¤ä¸ºå¯ç”¨æ€§æµ‹è¯•æ˜¯åœ¨æ£€æŸ¥ç³»ç»Ÿçš„å¯¼èˆªæ€§(navigation)</p><p><br></p><h2 id="44-æ¼æ´æµ‹è¯•-vulnerability-testing"><a href="#44-æ¼æ´æµ‹è¯•-vulnerability-testing" class="headerlink" title="44) æ¼æ´æµ‹è¯•(Vulnerability Testing)"></a>44) æ¼æ´æµ‹è¯•(Vulnerability Testing)</h2><p>æ¼æ´æµ‹è¯•ï¼Œæ¶‰åŠè¯†åˆ«è½¯ä»¶ã€ç¡¬ä»¶å’Œç½‘ç»œä¸­çš„æ¼æ´ã€‚å¦‚æœæ¼æ´å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œæˆ–è€…å®¹æ˜“å—åˆ°ç—…æ¯’å’Œè •è™«æ„ŸæŸ“ï¼Œé»‘å®¢æˆ–æ¶æ„ç¨‹åºå°±å¯ä»¥æ§åˆ¶ç³»ç»Ÿã€‚</p><p>å› æ­¤æœ‰å¿…è¦åœ¨æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä¹‹å‰æ£€æŸ¥è¿™äº›ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ¼æ´ã€‚</p><p><br></p><h2 id="45-å®¹é‡æµ‹è¯•-volume-testing"><a href="#45-å®¹é‡æµ‹è¯•-volume-testing" class="headerlink" title="45) å®¹é‡æµ‹è¯•(Volume Testing)"></a>45) å®¹é‡æµ‹è¯•(Volume Testing)</h2><p>å®¹é‡æµ‹è¯•æ˜¯ç”±æ€§èƒ½æµ‹è¯•å›¢é˜Ÿæ‰§è¡Œçš„ä¸€ç§éåŠŸèƒ½æµ‹è¯•ã€‚å®¹é‡æµ‹è¯•ä¼šæ£€æŸ¥åº”ç”¨ç¨‹åºé‡åˆ°å¤§é‡çš„æ•°æ®æ—¶çš„ç³»ç»Ÿè¡Œä¸ºå’Œå“åº”æ—¶é—´ã€‚è¿™ç§å¤§é‡æ•°æ®å¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå¤„ç†æ—¶é—´çš„é€Ÿåº¦ã€‚</p><p><br></p><h2 id="46-ç™½ç›’æµ‹è¯•-white-box-testing"><a href="#46-ç™½ç›’æµ‹è¯•-white-box-testing" class="headerlink" title="46) ç™½ç›’æµ‹è¯•(White Box Testing)"></a>46) ç™½ç›’æµ‹è¯•(White Box Testing)</h2><p><img src="/images/typeof-testing/glassbox.jpg" alt></p><p>ç™½ç›’æµ‹è¯•, å®ƒä¹Ÿè¢«ç§°ä¸ºç»ç’ƒç›’æµ‹è¯•ã€ç»“æ„æµ‹è¯•ã€é€»è¾‘é©±åŠ¨æµ‹è¯•æˆ–åŸºäºä»£ç çš„æµ‹è¯•, åŸºäºåº”ç”¨ç¨‹åºä»£ç çš„å†…éƒ¨é€»è¾‘ã€‚å³æµ‹è¯•äººå‘˜åº”è¯¥çŸ¥é“å†…éƒ¨è½¯ä»¶å’Œä»£ç æ˜¯å¦‚ä½•å·¥ä½œçš„, å¯¹æ‰€æœ‰çš„é€»è¾‘è·¯å¾„è¿›è¡Œè¦†ç›–æµ‹è¯•ã€‚ä¸Šé¢æåˆ°çš„å•å…ƒæµ‹è¯•å’Œé™æ€æµ‹è¯•å°±æ˜¯å…¸å‹çš„ç™½ç›’æµ‹è¯•, åŸºæœ¬ä¸Šç™½ç›’æµ‹è¯•å¯ä»¥ç­‰ä»·äºå•å…ƒæµ‹è¯•</p><p><strong>é€»è¾‘è·¯å¾„åŒ…æ‹¬è¯­å¥è¦†ç›–ã€åˆ¤å®šè¦†ç›–ã€æ¡ä»¶è¦†ç›–ã€åˆ¤å®š/æ¡ä»¶è¦†ç›–ã€æ¡ä»¶ç»„åˆè¦†ç›–å’Œè·¯å¾„è¦†ç›–ç­‰ç­‰</strong>.</p><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="/images/typeof-testing/all.png" alt></p><p>ä¸Šé¢æåˆ°çš„è½¯ä»¶æµ‹è¯•ç±»å‹åªæ˜¯æµ‹è¯•ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®é™…æœ‰è¶…è¿‡100ç§çš„æµ‹è¯•ç±»å‹ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰æµ‹è¯•ç±»å‹éƒ½ä¼šè¢«æ‰€æœ‰é¡¹ç›®ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œåªæ˜¯åˆ—ä¸¾ä¸€äº›æ¯”è¾ƒå¸¸è§çš„è½¯ä»¶æµ‹è¯•ç±»å‹ã€‚</p><p>å¦å¤–ä¸åŒçš„ç»„ç»‡ä¸­å¯èƒ½ä¼šæœ‰ä¸åŒçš„å®šä¹‰æˆ–è¿‡ç¨‹ï¼Œä½†æ˜¯åŸºæœ¬æ¦‚å¿µåœ¨ä»»ä½•åœ°æ–¹éƒ½æ˜¯ç›¸åŒçš„ã€‚å½“é¡¹ç›®ã€éœ€æ±‚å’ŒèŒƒå›´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›æµ‹è¯•ç±»å‹ã€è¿‡ç¨‹åŠå…¶å®ç°æ–¹æ³•ä¼šä¸æ–­æ¼”å˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡é“¾æ¥: &lt;a href=&quot;https://www.softwaretestinghelp.com/types-of-software-testing/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Types Of Software Testing: 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½ å¯èƒ½ä¸çŸ¥é“çš„æµè§ˆå™¨å®æ—¶é€šä¿¡æ–¹æ¡ˆ</title>
    <link href="https://bobi.ink/2019/07/07/sockjs/"/>
    <id>https://bobi.ink/2019/07/07/sockjs/</id>
    <published>2019-07-06T16:00:00.000Z</published>
    <updated>2019-07-10T08:30:04.800Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ¢è®¨ç°é˜¶æ®µæµè§ˆå™¨ç«¯å¯è¡Œçš„å®æ—¶é€šä¿¡æ–¹æ¡ˆï¼Œä»¥åŠå®ƒä»¬çš„å‘å±•å†å²ã€‚</p><p>è¿™é‡Œä»¥<a href="https://github.com/sockjs/sockjs-client" target="_blank" rel="noopener"><code>sockjs</code></a>ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„æµè§ˆå™¨å®æ—¶é€šä¿¡åº“ï¼Œæä¾›äº†â€™ç±»Websocketâ€™ã€ä¸€è‡´æ€§ã€è·¨å¹³å°çš„APIï¼Œæ—¨åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´åˆ›å»ºä¸€ä¸ªä½å»¶è¿Ÿã€å…¨åŒå·¥ã€æ”¯æŒè·¨åŸŸçš„å®æ—¶é€šä¿¡ä¿¡é“. <strong>ä¸»è¦ç‰¹ç‚¹å°±æ˜¯ä»¿ç”ŸWebsocketï¼Œå®ƒä¼šä¼˜å…ˆä½¿ç”¨Websocketä½œä¸ºä¼ è¾“å±‚ï¼Œåœ¨ä¸æ”¯æŒWebSocketçš„ç¯å¢ƒå›é€€ä½¿ç”¨å…¶ä»–è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚XHR-Streamã€è½®è¯¢</strong>. </p><p>æ‰€ä»¥<code>sockjs</code>æœ¬èº«å°±æ˜¯æµè§ˆå™¨å®æ—¶é€šä¿¡æ–¹æ¡ˆçš„ç¼–å¹´å², æœ¬æ–‡ä¹Ÿæ˜¯æŒ‰ç…§ç”±æ–°åˆ°è€è¿™æ ·çš„é¡ºåºæ¥ä»‹ç»è¿™äº›è§£å†³æ–¹æ¡ˆ. </p><blockquote><p>ç±»ä¼¼sockjsçš„è§£å†³æ–¹æ¡ˆè¿˜æœ‰ <a href="https://socket.io/" target="_blank" rel="noopener">socket.io</a></p></blockquote><blockquote><p>å¦‚æœä½ è§‰å¾—æ–‡ç« ä¸é”™ï¼Œè¯·ä¸è¦åæƒœä½ çš„ç‚¹èµğŸ‘ï¼Œé¼“åŠ±ç¬”è€…å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« </p></blockquote><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#websocket">WebSocket</a></li><li><a href="#xhr-streaming">XHR-streaming</a></li><li><a href="#eventsource">EventSource</a></li><li><a href="#htmlfile">HtmlFile</a></li><li><a href="#polling">Polling</a></li><li><a href="#long-polling">Long polling</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="websocket"><a href="#websocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>WebSocketå…¶å®ä¸æ˜¯æœ¬æ–‡çš„ä¸»è§’ï¼Œè€Œä¸”ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ä»‹ç»WebSocketä¹‹å¤–çš„ä¸€äº›å›é€€æ–¹æ¡ˆï¼Œåœ¨æµè§ˆå™¨ä¸æ”¯æŒWebsocketçš„æƒ…å†µä¸‹, å¯ä»¥é€‰æ‹©å›é€€åˆ°è¿™äº›æ–¹æ¡ˆ.</p><p>åœ¨æ­¤ä»‹ç»Websocketä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€äº›HTTPçš„åŸºç¡€çŸ¥è¯†ï¼Œæ¯•ç«ŸWebSocketæœ¬èº«æ˜¯å€Ÿç”¨HTTPåè®®å®ç°çš„ã€‚</p><p>HTTPåè®®æ˜¯åŸºäºTCP/IPä¹‹ä¸Šçš„åº”ç”¨å±‚åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´HTTPåœ¨TCPè¿æ¥ä¸­è¿›è¡Œè¯·æ±‚å’Œå“åº”çš„ï¼Œ<strong>æµè§ˆå™¨ä¼šä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œè¯·æ±‚ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œåœ¨æœåŠ¡ç«¯å“åº”åå…³é—­è¿æ¥</strong>:</p><p><img src="/images/sockjs/base-http.png" alt></p><p>åæ¥äººä»¬å‘ç°ä¸ºæ¯ä¸ªHTTPè¯·æ±‚éƒ½å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œå¤ªæµªè´¹èµ„æºäº†ï¼Œèƒ½ä¸èƒ½ä¸è¦ç€æ€¥å…³é—­TCPè¿æ¥ï¼Œè€Œæ˜¯å°†å®ƒå¤ç”¨èµ·æ¥, åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­è¿›è¡Œå¤šæ¬¡è¯·æ±‚ã€‚</p><p><strong>è¿™å°±æœ‰äº†HTTPæŒä¹…è¿æ¥(HTTP persistent connection, ä¹Ÿç§°ä¸ºHTTP keep-alive), å®ƒåˆ©ç”¨åŒä¸€ä¸ªTCPè¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚/å“åº”ã€‚æŒä¹…è¿æ¥çš„æ–¹å¼å¯ä»¥å¤§å¤§å‡å°‘ç­‰å¾…æ—¶é—´, åŒæ–¹ä¸éœ€è¦é‡æ–°è¿è¡ŒTCPæ¡æ‰‹ï¼Œè¿™å¯¹å‰ç«¯é™æ€èµ„æºçš„åŠ è½½ä¹Ÿæœ‰å¾ˆå¤§æ„ä¹‰</strong>:</p><p><img src="/images/sockjs/http-keep-alive.png" alt></p><p>Ok, ç°åœ¨å›åˆ°WebSocket, <strong>æµè§ˆå™¨ç«¯ç”¨æˆ·ç¨‹åºå¹¶ä¸æ”¯æŒå’ŒæœåŠ¡ç«¯ç›´æ¥å»ºç«‹TCPè¿æ¥ï¼Œä½†æ˜¯ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šå»ºç«‹TCPè¿æ¥, TCPæ˜¯å¯é çš„ã€å…¨åŒå·¥çš„æ•°æ®é€šä¿¡é€šé“ï¼Œé‚£æˆ‘ä»¬ä½•ä¸ç›´æ¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œå®æ—¶é€šä¿¡ï¼Ÿ è¿™å°±æ˜¯Websocketçš„åŸç†!</strong> </p><p>æˆ‘ä»¬è¿™é‡Œé€šè¿‡ä¸€å¼ å›¾ï¼Œé€šä¿—åœ°ç†è§£ä¸€ä¸‹Websocketçš„åŸç†:</p><p><img src="/images/sockjs/websocket.png" alt></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œ<strong>WebSocketé™¤æœ€åˆå»ºç«‹è¿æ¥æ—¶éœ€è¦å€ŸåŠ©äºç°æœ‰çš„HTTPåè®®ï¼Œå…¶ä»–æ—¶å€™ç›´æ¥åŸºäºTCPå®Œæˆé€šä¿¡</strong>ã€‚è¿™æ˜¯æµè§ˆå™¨ä¸­æœ€é è¿‘å¥—æ¥å­—çš„APIï¼Œå¯ä»¥å®æ—¶å’ŒæœåŠ¡ç«¯è¿›è¡Œå…¨åŒå·¥é€šä¿¡. WebSocketç›¸æ¯”ä¼ ç»Ÿçš„æµè§ˆå™¨çš„<a href="https://en.wikipedia.org/wiki/Comet_(programming" target="_blank" rel="noopener">Comet</a>)(ä¸‹æ–‡ä»‹ç»)æŠ€æœ¯, æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼š</p><ul><li>æ›´å¼ºçš„å®æ—¶æ€§ã€‚åŸºäºTCPåè®®çš„å…¨åŒå·¥é€šä¿¡</li><li>æ›´é«˜æ•ˆã€‚ä¸€æ–¹é¢æ˜¯æ•°æ®åŒ…ç›¸å¯¹è¾ƒå°ï¼Œå¦ä¸€æ–¹é¢ç›¸æ¯”ä¼ ç»ŸXHR-Streamingå’Œè½®è¯¢æ–¹å¼æ›´åŠ é«˜æ•ˆï¼Œä¸éœ€è¦é‡å¤å»ºç«‹TCPè¿æ¥</li><li>æ›´å¥½çš„äºŒè¿›åˆ¶æ”¯æŒã€‚ Websocketå®šä¹‰äº†äºŒè¿›åˆ¶å¸§ï¼Œç›¸å¯¹HTTPï¼Œå¯ä»¥æ›´è½»æ¾åœ°å¤„ç†äºŒè¿›åˆ¶å†…å®¹</li><li>ä¿æŒè¿æ¥çŠ¶æ€ã€‚ ç›¸æ¯”HTTPæ— çŠ¶æ€çš„åè®®ï¼ŒWebSocketåªéœ€è¦åœ¨å»ºç«‹è¿æ¥æ—¶æºå¸¦è®¤è¯ä¿¡æ¯ï¼Œåç»­çš„é€šä¿¡éƒ½åœ¨è¿™ä¸ªä¼šè¯å†…è¿›è¡Œ</li><li>å¯ä»¥æ”¯æŒæ‰©å±•ã€‚Websocketå®šä¹‰äº†æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•åè®®ã€å®ç°éƒ¨åˆ†è‡ªå®šä¹‰çš„å­åè®®ã€‚å¦‚éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒå‹ç¼©ç­‰</li></ul><p><br></p><p>å®ƒçš„æ¥å£ä¹Ÿéå¸¸ç®€å•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8080/socket'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line">ws.onerror = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123; ... &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥å…³é—­</span></span><br><span class="line">ws.onclose = <span class="function"><span class="params">()</span> =&gt;</span> &#123; ... &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥å»ºç«‹</span></span><br><span class="line">ws.onopen = <span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">  ws.send(<span class="string">"ping"</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">ws.onmessage = <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123; </span><br><span class="line">  <span class="keyword">if</span>(msg.data <span class="keyword">instanceof</span> Blob) &#123; </span><br><span class="line">  <span class="comment">// å¤„ç†äºŒè¿›åˆ¶ä¿¡æ¯</span></span><br><span class="line">    processBlob(msg.data);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line">    processText(msg.data); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸ä¼šæ·±å…¥è§£æWebsocketçš„åè®®ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹ä¸‹åˆ—æ–‡ç« :</p><ul><li><a href="https://zh.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener">WebSocket</a></li><li><a href="https://mp.weixin.qq.com/s/7aXMdnajINt0C5dcJy2USg?" target="_blank" rel="noopener">WebSocket æµ…æ</a></li><li><a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">é˜®ä¸€å³°ï¼šWebSocket æ•™ç¨‹</a></li></ul><p><br></p><p>å¦‚æœä¸è€ƒè™‘ä½ç‰ˆæœ¬IEï¼ŒåŸºæœ¬ä¸ŠWebSocketä¸ä¼šæœ‰ä»€ä¹ˆå…¼å®¹æ€§ä¸Šé¢çš„é¡¾è™‘. ä¸‹é¢åˆ—ä¸¾äº†Websocketä¸€äº›å¸¸è§çš„é—®é¢˜, å½“æ— æ³•æ­£å¸¸ä½¿ç”¨Websocketæ—¶ï¼Œå¯ä»¥åˆ©ç”¨sockjsæˆ–è€…socket.ioè¿™äº›æ–¹æ¡ˆå›é€€åˆ°ä¼ ç»Ÿçš„CometæŠ€æœ¯æ–¹æ¡ˆ.</p><ol><li>æµè§ˆå™¨å…¼å®¹æ€§ã€‚<ul><li>IE10ä»¥ä¸‹ä¸æ”¯æŒ</li><li>Safari ä¸‹ä¸å…è®¸ä½¿ç”¨éæ ‡å‡†æ¥å£å»ºç«‹è¿æ¥</li></ul></li><li>å¿ƒè·³. WebSocketæœ¬èº«ä¸ä¼šç»´æŠ¤å¿ƒè·³æœºåˆ¶ï¼Œä¸€äº›Websocketå®ç°åœ¨ç©ºé—²ä¸€æ®µæ—¶é—´ä¼šè‡ªåŠ¨æ–­å¼€ã€‚æ‰€ä»¥sockjsè¿™äº›åº“ä¼šå¸®ä½ ç»´æŠ¤å¿ƒè·³</li><li>ä¸€äº›è´Ÿè½½å‡è¡¡æˆ–ä»£ç†ä¸æ”¯æŒWebsocketã€‚</li><li>ä¼šè¯å’Œæ¶ˆæ¯é˜Ÿåˆ—ç»´æŠ¤ã€‚è¿™äº›ä¸æ˜¯Websocketåè®®çš„èŒè´£ï¼Œè€Œæ˜¯åº”ç”¨çš„èŒè´£ã€‚sockjsä¼šä¸ºæ¯ä¸ªWebsocketè¿æ¥ç»´æŠ¤ä¸€ä¸ªä¼šè¯ï¼Œä¸”è¿™ä¸ªä¼šè¯é‡Œé¢ä¼šç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå½“Websocketæ„å¤–æ–­å¼€æ—¶ï¼Œä¸è‡³äºä¸¢å¤±æ•°æ®</li></ol><p><br></p><hr><p><br></p><h2 id="xhr-streaming"><a href="#xhr-streaming" class="headerlink" title="XHR-streaming"></a>XHR-streaming</h2><p>XHR-Streming, ä¸­æ–‡åç§°â€˜XHRæµâ€™, è¿™æ˜¯WebSocketçš„æœ€ä½³æ›¿è¡¥æ–¹æ¡ˆ. XHR-streamingçš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼š<strong>æœåŠ¡ç«¯ä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç (Chunked transfer encoding)çš„HTTPä¼ è¾“æœºåˆ¶è¿›è¡Œå“åº”ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯ä¸ç»ˆæ­¢HTTPå“åº”æµï¼Œè®©HTTPå§‹ç»ˆå¤„äºæŒä¹…è¿æ¥çŠ¶æ€ï¼Œå½“æœ‰æ•°æ®éœ€è¦å‘é€ç»™å®¢æˆ·ç«¯æ—¶å†è¿›è¡Œå†™å…¥æ•°æ®</strong>ã€‚</p><p>æ²¡ç†è§£ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥, å…ˆæ¥çœ‹ä¸€ä¸‹æ­£å¸¸çš„HTTPè¯·æ±‚å¤„ç†æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Node.jsä»£ç </span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>, <span class="comment">// è®¾ç½®å†…å®¹æ ¼å¼</span></span><br><span class="line">    <span class="string">'Content-Length'</span>: <span class="number">11</span>, <span class="comment">// è®¾ç½®å†…å®¹é•¿åº¦</span></span><br><span class="line">  &#125;)</span><br><span class="line">  res.end(<span class="string">'hello world'</span>) <span class="comment">// å“åº” </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¼šç«‹å³æ¥æ”¶åˆ°å“åº”:</p><p><img src="/images/sockjs/http-req.png" alt></p><p><br></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81" target="_blank" rel="noopener"><strong>åˆ†å—ä¼ è¾“ç¼–ç </strong></a>å‘¢?</p><p><strong>åœ¨HTTP/1.0ä¹‹å‰, å“åº”æ˜¯å¿…é¡»ä½œä¸ºä¸€æ•´å—æ•°æ®è¿”å›å®¢æˆ·ç«¯çš„(å¦‚ä¸Šä¾‹)ï¼Œè¿™è¦æ±‚æœåŠ¡ç«¯åœ¨å‘é€å“åº”ä¹‹å‰å¿…é¡»è®¾ç½®<code>Content-Length</code>, æµè§ˆå™¨çŸ¥é“æ•°æ®çš„å¤§å°åæ‰èƒ½ç¡®å®šå“åº”çš„ç»“æŸæ—¶é—´</strong>ã€‚è¿™è®©æœåŠ¡å™¨å“åº”åŠ¨æ€çš„å†…å®¹å˜å¾—éå¸¸ä½æ•ˆï¼Œå®ƒå¿…é¡»ç­‰å¾…æ‰€æœ‰åŠ¨æ€å†…å®¹ç”Ÿæˆå®Œï¼Œå†è®¡ç®—Content-Length, æ‰å¯ä»¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå“åº”çš„å†…å®¹ä½“ç§¯å¾ˆå¤§ï¼Œéœ€è¦å ç”¨å¾ˆå¤šå†…å­˜ç©ºé—´.</p><p><strong>HTTP/1.1å¼•å…¥äº†<code>Transfer-Encoding: chunked;</code>æŠ¥å¤´ã€‚ å®ƒå…è®¸æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯åº”ç”¨çš„æ•°æ®å¯ä»¥åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†, å¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªå—å‘é€ï¼Œè¿™æ ·æœåŠ¡å™¨å¯ä»¥å‘é€æ•°æ®è€Œä¸éœ€è¦æå‰è®¡ç®—å‘é€å†…å®¹çš„æ€»å¤§å°</strong>ã€‚</p><p><strong>æœ‰äº†åˆ†å—ä¼ è¾“æœºåˆ¶åï¼ŒåŠ¨æ€ç”Ÿæˆå†…å®¹çš„æœåŠ¡å™¨å°±å¯ä»¥ç»´æŒHTTPé•¿è¿æ¥, ä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨å“åº”æµä¸ç»“æŸï¼ŒTCPè¿æ¥å°±ä¸ä¼šæ–­å¼€</strong>. </p><p><br></p><p>ç°åœ¨æˆ‘ä»¬åˆ‡æ¢ä¸ºåˆ†å—ä¼ è¾“ç¼–ç æ¨¡å¼ï¼Œ ä¸”æˆ‘ä»¬ä¸ç»ˆæ­¢å“åº”æµï¼Œçœ‹ä¼šæœ‰ä»€ä¹ˆæƒ…å†µ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></span><br><span class="line">    <span class="comment">// 'Content-Length': 11, // ğŸ”´å°†Content-LengthæŠ¥å¤´å»æ‰ï¼ŒNode.jsé»˜è®¤å°±æ˜¯ä½¿ç”¨åˆ†å—ç¼–ç ä¼ è¾“çš„</span></span><br><span class="line">  &#125;)</span><br><span class="line">  res.write(<span class="string">'hello world'</span>)</span><br><span class="line">  <span class="comment">// res.end() // ğŸ”´ä¸ç»ˆæ­¢è¾“å‡ºæµ</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°è¯·æ±‚ä¼šä¸€ç›´å¤„äºPendingçŠ¶æ€(ç»¿è‰²ä¸‹è½½å›¾æ ‡)ï¼Œ<strong>é™¤éå‡ºç°å¼‚å¸¸ã€æœåŠ¡å™¨å…³é—­æˆ–æ˜¾å¼å…³é—­è¿æ¥(æ¯”å¦‚è®¾ç½®è¶…æ—¶æœºåˆ¶)ï¼Œè¯·æ±‚æ˜¯æ°¸è¿œä¸ä¼šç»ˆæ­¢çš„ã€‚ä½†æ˜¯å³ä½¿å¤„äºPendingçŠ¶æ€å®¢æˆ·ç«¯è¿˜æ˜¯å¯ä»¥æ¥æ”¶æ•°æ®ï¼Œä¸å¿…ç­‰å¾…è¯·æ±‚ç»“æŸ</strong>:</p><p><img src="/images/sockjs/http-pending-req.png" alt></p><p><br></p><p>åŸºäºè¿™ä¸ªåŸç†æˆ‘ä»¬å†æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ping-pongæœåŠ¡å™¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/ping'</span>) &#123;</span><br><span class="line">    <span class="comment">// pingè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (pendingResponse == <span class="literal">null</span>) &#123;</span><br><span class="line">      res.writeHead(<span class="number">500</span>);</span><br><span class="line">      res.write(<span class="string">'session not found'</span>);</span><br><span class="line">      res.end();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(<span class="number">200</span>)</span><br><span class="line">    res.end()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»™å®¢æˆ·ç«¯æ¨æµ</span></span><br><span class="line">    pendingResponse.write(<span class="string">'pong\n'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜å¥æŸ„</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(<span class="string">'welcome to ping\n'</span>);</span><br><span class="line">    pendingResponse = res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨å¦ä¸€ä¸ªçª—å£è®¿é—®<code>/ping</code>è·¯å¾„ï¼š</p><p><img src="/images/sockjs/http-stream-ping.png" alt></p><p>Ok! è¿™å°±æ˜¯XHR-Streaming!</p><p><br></p><p>é‚£ä¹ˆAjaxæ€ä¹ˆæ¥æ”¶è¿™äº›æ•°æ®å‘¢ï¼Ÿ â‘ ä¸€ç§åšæ³•æ˜¯åœ¨<code>XMLHttpRequest</code>çš„<code>onreadystatechange</code>äº‹ä»¶å¤„ç†å™¨ä¸­åˆ¤æ–­<code>readyState</code>æ˜¯å¦ç­‰äº<code>XMLHttpRequest.LOADING</code>ï¼›â‘¡å¦å¤–ä¸€ç§åšæ³•æ˜¯åœ¨<code>xhr.onprogress</code>äº‹ä»¶å¤„ç†å™¨ä¸­å¤„ç†ã€‚ä¸‹é¢æ˜¯pingå®¢æˆ·ç«¯å®ç°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.onprogress = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„responseTextæ˜¯è·å–æœåŠ¡ç«¯å‘é€çš„æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœè¦è·å–æœªè¯»æ•°æ®ï¼Œåˆ™éœ€è¦è¿›è¡Œåˆ’åˆ†</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'progress'</span>, xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, HOST);</span><br><span class="line">  xhr.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ping</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, HOST + <span class="string">'/ping'</span>);</span><br><span class="line">  xhr.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">listen();</span><br><span class="line">setInterval(ping, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><p><br></p><p>æ…¢ç€ï¼Œä¸è¦é«˜å…´å¾—å¤ªæ—©ğŸ˜°. å¦‚æœè¿è¡Œä¸Šé¢çš„ä»£ç ä¼šå‘ç°<code>onprogress</code>å¹¶æ²¡æœ‰è¢«æ­£å¸¸çš„è§¦å‘, å…·ä½“åŸå› ç¬”è€…ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œæˆ‘å‘ç°sockjsçš„æœåŠ¡å™¨æºç é‡Œé¢ä¼šé¢„å…ˆå†™å…¥2049ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸è§¦å‘onprogressäº‹ä»¶äº†:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/ping'</span>) &#123;</span><br><span class="line">    <span class="comment">// pingè¯·æ±‚</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜å¥æŸ„</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(<span class="built_in">Array</span>(<span class="number">2049</span>).join(<span class="string">'h'</span>) + <span class="string">'\n'</span>);</span><br><span class="line">    pendingResponse = res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>æœ€åå†å›¾è§£ä¸€ä¸‹XHR-streamingçš„åŸç†:</p><p><img src="/images/sockjs/xhr-stream.png" alt></p><p>æ€»ç»“ä¸€ä¸‹XHR-Streamingçš„ç‰¹ç‚¹:</p><ul><li>åˆ©ç”¨åˆ†å—ä¼ è¾“ç¼–ç æœºåˆ¶å®ç°æŒä¹…åŒ–è¿æ¥(persistent connection): æœåŠ¡å™¨ä¸å…³é—­å“åº”æµï¼Œè¿æ¥å°±ä¸ä¼šå…³é—­</li><li>å•å·¥(unidirectional): åªå…è®¸æœåŠ¡å™¨å‘æµè§ˆå™¨å•å‘çš„æ¨é€æ•°æ®</li></ul><p><strong>é€šè¿‡XHR-Streamingï¼Œå¯ä»¥å…è®¸æœåŠ¡ç«¯è¿ç»­åœ°å‘é€æ¶ˆæ¯ï¼Œæ— éœ€æ¯æ¬¡å“åº”åå†å»å»ºç«‹ä¸€ä¸ªè¿æ¥, æ‰€ä»¥å®ƒæ˜¯é™¤äº†Websocketä¹‹å¤–æœ€ä¸ºé«˜æ•ˆçš„å®æ—¶é€šä¿¡æ–¹æ¡ˆ. ä½†å®ƒä¹Ÿå¹¶ä¸æ˜¯å®Œç¾æ— ç¼º</strong>ã€‚</p><p>æ¯”å¦‚XHR-streamingè¿æ¥çš„æ—¶é—´è¶Šé•¿ï¼Œæµè§ˆå™¨ä¼šå ç”¨è¿‡å¤šå†…å­˜ï¼Œè€Œä¸”åœ¨æ¯ä¸€æ¬¡æ–°çš„æ•°æ®åˆ°æ¥æ—¶ï¼Œéœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œåˆ’åˆ†ï¼Œå‰”é™¤æ‰å·²ç»æ¥æ”¶çš„æ•°æ®. å› æ­¤sockjså¯¹å®ƒè¿›è¡Œäº†ä¸€ç‚¹ä¼˜åŒ–, ä¾‹å¦‚sockjsé»˜è®¤åªå…è®¸æ¯ä¸ªxhr-streamingè¿æ¥è¾“å‡º128kbæ•°æ®ï¼Œè¶…è¿‡è¿™ä¸ªå¤§å°æ—¶ä¼šå…³é—­è¾“å‡ºæµï¼Œè®©æµè§ˆå™¨é‡æ–°å‘èµ·è¯·æ±‚.</p><p><br></p><hr><p><br></p><h2 id="eventsource"><a href="#eventsource" class="headerlink" title="EventSource"></a>EventSource</h2><p>äº†è§£äº†XHR-Streaming, å°±ä¼šè§‰å¾—<a href="https://developer.mozilla.org/zh-CN/docs/Server-sent_events/EventSource" target="_blank" rel="noopener"><code>EventSource</code></a>å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œç©æ„: å®ƒå°±æ˜¯ä¸Šé¢è®²çš„<code>XHR-streaming</code>, åªä¸è¿‡æµè§ˆå™¨ç»™å®ƒæä¾›äº†æ ‡å‡†çš„APIå°è£…å’Œåè®®, ä½ æŠ“åŒ…ä¸€çœ‹å’ŒXHR-streamingæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«:</p><p><img src="/images/sockjs/eventsource.png" alt></p><p><br></p><p>ä¸Šé¢å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„<code>Accept</code>ä¸º<code>text/event-stream</code>, ä¸”æœåŠ¡ç«¯å†™å…¥çš„æ•°æ®éƒ½æœ‰æ ‡å‡†çš„çº¦å®š, å³è½½è·éœ€è¦è¿™æ ·ç»„ç»‡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="string">`data: <span class="subst">$&#123;payload&#125;</span>\r\n\r\n`</span></span><br></pre></td></tr></table></figure><p><br></p><p>EventSourceçš„APIå’ŒWebsocketç±»ä¼¼, å®ä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> evtSource = <span class="keyword">new</span> EventSource(<span class="string">'sse.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æ‰“å¼€</span></span><br><span class="line">evtSource.onopen = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å—æ¶ˆæ¯</span></span><br><span class="line">evtSource.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"message: "</span> + e.data)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…³é—­æµ</span></span><br><span class="line">  evtSource.close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚å¸¸</span></span><br><span class="line">evtSource.onerror = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å› ä¸ºæ˜¯æ ‡å‡†çš„ï¼Œæµè§ˆå™¨è°ƒè¯•ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æŠ“åŒ…å·¥å…·:</p><p><img src="/images/sockjs/eventsource-inspect.png" alt></p><p><br></p><hr><p><br></p><h2 id="htmlfile"><a href="#htmlfile" class="headerlink" title="HtmlFile"></a>HtmlFile</h2><p>è¿™æ˜¯ä¸€ç§å¤è€çš„â€˜ç§˜æœ¯â€™ğŸ˜‚ï¼Œè™½ç„¶æˆ‘ä»¬å¯èƒ½æ°¸è¿œéƒ½ä¸ä¼šå†ç”¨åˆ°å®ƒï¼Œä½†æ˜¯å®ƒçš„å®ç°æ–¹å¼æ¯”è¾ƒæœ‰æ„æ€(ç±»ä¼¼äºJSONPè¿™ç§é»‘ç§‘æŠ€), æ‰€ä»¥è¿˜æ˜¯å€¼å¾—è®²ä¸€ä¸‹ã€‚</p><p>HtmlFileçš„å¦ä¸€ä¸ªåå­—å«åš<code>æ°¸ä¹…å¸§(forever-frame)</code>, é¡¾åæ€ä¹‰, æµè§ˆå™¨ä¼šæ‰“å¼€ä¸€ä¸ªéšè—çš„iframeï¼Œè¿™ä¸ªiframeä¼šè¯·æ±‚ä¸€ä¸ªåˆ†å—ä¼ è¾“ç¼–ç çš„htmlæ–‡ä»¶(Transfer-Encoding: chunked), å’ŒXHR-Streamingä¸€æ ·ï¼Œè¿™ä¸ªè¯·æ±‚æ°¸è¿œéƒ½ä¸ä¼šç»“æŸï¼ŒæœåŠ¡å™¨ä¼šä¸æ–­åœ¨è¿™ä¸ªæ–‡æ¡£ä¸Šè¾“å‡ºå†…å®¹ã€‚<strong>è¿™é‡Œé¢çš„è¦ç‚¹æ˜¯ç°ä»£æµè§ˆå™¨éƒ½ä¼šå¢é‡æ¸²æŸ“htmlæ–‡ä»¶ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¯ä»¥é€šè¿‡æ·»åŠ scriptæ ‡ç­¾åœ¨å®¢æˆ·ç«¯æ‰§è¡ŒæŸäº›ä»£ç </strong>ï¼Œå…ˆæ¥çœ‹ä¸ªæŠ“åŒ…çš„å®ä¾‹:</p><p><img src="/images/sockjs/htmlfile.png" alt></p><p><br></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º:</p><ul><li>â‘  è¿™é‡Œä¼šç»™æœåŠ¡å™¨ä¼ é€’ä¸€ä¸ªcallbackï¼Œé€šè¿‡è¿™ä¸ªcallbackå°†æ•°æ®ä¼ é€’ç»™çˆ¶æ–‡æ¡£</li><li>â‘¡ æœåŠ¡å™¨æ¯å½“æœ‰æ–°çš„æ•°æ®ï¼Œå°±å‘æ–‡æ¡£è¿½åŠ ä¸€ä¸ª<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œscriptçš„ä»£ç å°±æ˜¯å°†æ•°æ®ä¼ é€’ç»™callbackã€‚åˆ©ç”¨æµè§ˆå™¨ä¼šè¢«ä¸‹è½½è¾¹è§£æHTMLæ–‡æ¡£çš„ç‰¹æ€§ï¼Œæ–°å¢çš„scriptä¼šé©¬ä¸Šè¢«æ‰§è¡Œ</li></ul><p><br></p><p>æœ€åè¿˜æ˜¯ç”¨æµç¨‹å›¾æè¿°ä¸€ä¸‹ï¼š</p><p><img src="/images/sockjs/htmlfile-progress.png" alt></p><p>é™¤äº†IE6ã€7ä»¥ä¸‹ä¸æ”¯æŒï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ”¯æŒè¿™ä¸ªæ–¹æ¡ˆï¼Œå½“æµè§ˆå™¨ä¸æ”¯æŒ<code>XHR-streaming</code>æ—¶ï¼Œå¯ä»¥ä½œä¸ºæœ€ä½³å¤‡èƒã€‚</p><p><br></p><hr><p><br></p><h2 id="polling"><a href="#polling" class="headerlink" title="Polling"></a>Polling</h2><p>è½®è¯¢æ˜¯æœ€ç²—æš´(æˆ–è€…è¯´æœ€ç®€å•)ï¼Œä¹Ÿæ˜¯æ•ˆç‡æœ€ä½ä¸‹çš„â€˜å®æ—¶â€™é€šä¿¡æ–¹æ¡ˆï¼Œè¿™ç§æ–¹å¼çš„åŸç†å°±æ˜¯å®šæœŸå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚, æ‹‰å–æœ€æ–°çš„æ¶ˆæ¯é˜Ÿåˆ—:</p><p><img src="/images/sockjs/polling2.png" alt></p><p>è¿™ç§è½®è¯¢æ–¹å¼æ¯”è¾ƒåˆé€‚<strong>æœåŠ¡å™¨çš„ä¿¡æ¯å®šæœŸæ›´æ–°</strong>çš„åœºæ™¯ï¼Œå¦‚å¤©æ°”å’Œè‚¡ç¥¨è¡Œæƒ…ä¿¡æ¯ã€‚ä¸¾ä¸ªä¾‹å­è‚¡ç¥¨ä¿¡æ¯æ¯éš”5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯å®šæœŸè½®è¯¢, ä¸”è½®è¯¢é—´éš”å’ŒæœåŠ¡ç«¯æ›´æ–°é¢‘ç‡ä¿æŒä¸€è‡´æ˜¯ä¸€ç§ç†æƒ³çš„æ–¹å¼ã€‚</p><p>ä½†æ˜¯å¦‚æœè¿½æ±‚å®æ—¶æ€§ï¼Œè½®è¯¢ä¼šå¯¼è‡´ä¸€äº›ä¸¥é‡çš„é—®é¢˜:</p><ul><li>èµ„æºæµªè´¹ã€‚æ¯”å¦‚è½®è¯¢çš„é—´éš”å°äºæœåŠ¡å™¨ä¿¡æ¯æ›´æ–°çš„é¢‘ç‡ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šHTTPè¯·æ±‚, æ¶ˆè€—å®è´µçš„CPUæ—¶é—´å’Œå¸¦å®½</li><li>å®¹æ˜“å¯¼è‡´è¯·æ±‚è½°ç‚¸ã€‚æ¯”å¦‚å½“æœåŠ¡å™¨è´Ÿè½½æ¯”è¾ƒé«˜æ—¶ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿˜æ²¡å¤„ç†å®Œæˆï¼Œè¿™æ—¶å€™ç¬¬äºŒã€ç¬¬ä¸‰ä¸ªè¯·æ±‚æ¥è¸µè€Œæ¥ï¼Œæ— ç”¨çš„é¢å¤–è¯·æ±‚å¯¹æœåŠ¡ç«¯è¿›è¡Œäº†è½°ç‚¸ã€‚</li></ul><p><br></p><hr><p><br></p><h2 id="long-polling"><a href="#long-polling" class="headerlink" title="Long polling"></a>Long polling</h2><p>è¿˜æœ‰ä¸€ç§ä¼˜åŒ–çš„è½®è¯¢æ–¹æ³•ï¼Œç§°ä¸ºé•¿è½®è¯¢(Long Polling)ï¼Œsockjså°±æ˜¯ä½¿ç”¨è¿™ç§è½®è¯¢æ–¹å¼, <strong>é•¿è½®è¯¢æŒ‡çš„æ˜¯æµè§ˆå™¨å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åªæœ‰åœ¨æœ‰å¯ç”¨çš„æ–°æ•°æ®æ—¶æ‰å“åº”</strong>ï¼š</p><p><img src="/images/sockjs/polling.png" alt></p><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªæ¶ˆæ¯è·å–è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šå°†å½“å‰çš„æ¶ˆæ¯é˜Ÿåˆ—è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå…³é—­è¿æ¥ã€‚<strong>å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒæœåŠ¡ç«¯ä¸ä¼šç«‹å³å…³é—­è¿æ¥ï¼Œè€Œæ˜¯ç­‰å¾…æŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´é—´éš”å†…æ²¡æœ‰æ–°çš„æ¶ˆæ¯ï¼Œåˆ™ç”±å®¢æˆ·ç«¯ä¸»åŠ¨è¶…æ—¶å…³é—­è¿æ¥</strong>ã€‚</p><p>å¦å¤–ä¸€ä¸ªè¦ç‚¹æ˜¯ï¼Œ<strong>å®¢æˆ·ç«¯çš„è½®è¯¢è¯·æ±‚åªæœ‰åœ¨ä¸Šä¸€ä¸ªè¯·æ±‚è¿æ¥å…³é—­åæ‰ä¼šé‡æ–°å‘èµ·</strong>ã€‚è¿™å°±è§£å†³äº†ä¸Šæ–‡çš„è¯·æ±‚è½°ç‚¸é—®é¢˜ã€‚æœåŠ¡ç«¯å¯ä»¥æ§åˆ¶å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶åºï¼Œå› ä¸ºåœ¨æœåŠ¡ç«¯æœªå“åº”ä¹‹å‰ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€é¢å¤–çš„è¯·æ±‚(åœ¨è¶…æ—¶æœŸé—´å†…)ã€‚</p><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API" target="_blank" rel="noopener">WebRTC</a> è¿™æ˜¯æµè§ˆå™¨çš„å®æ—¶é€šä¿¡æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œåº”ç”¨æˆ–è€…ç«™ç‚¹ï¼Œåœ¨ä¸å€ŸåŠ©ä¸­é—´åª’ä»‹çš„æƒ…å†µä¸‹ï¼Œå»ºç«‹æµè§ˆå™¨ä¹‹é—´ç‚¹å¯¹ç‚¹ï¼ˆPeer-to-Peerï¼‰çš„è¿æ¥ï¼Œå®ç°è§†é¢‘æµå’Œï¼ˆæˆ–ï¼‰éŸ³é¢‘æµæˆ–è€…å…¶ä»–ä»»æ„æ•°æ®çš„ä¼ è¾“ã€‚</li><li><a href="https://github.com/meteor/meteor/tree/devel/packages/ddp" target="_blank" rel="noopener">metetor DDP</a> DDP(Distributed Data Protocol), è¿™æ˜¯ä¸€ä¸ªâ€™æœ‰çŠ¶æ€çš„â€™å®æ—¶é€šä¿¡åè®®ï¼Œè¿™ä¸ªæ˜¯<a href="https://github.com/meteor/meteor" target="_blank" rel="noopener">Meteor</a>æ¡†æ¶çš„åŸºç¡€, å®ƒå°±æ˜¯ä½¿ç”¨è¿™ä¸ªåè®®æ¥è¿›è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡. ä»–åªæ˜¯ä¸€ä¸ªåè®®ï¼Œè€Œä¸æ˜¯é€šä¿¡æŠ€æœ¯ï¼Œæ¯”å¦‚å®ƒçš„åº•å±‚å¯ä»¥åŸºäºWebsocketã€XHR-Streamingã€é•¿è½®è¯¢ç”šè‡³æ˜¯WebRTC</li><li><a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html" target="_blank" rel="noopener">Server-Sent Events æ•™ç¨‹</a></li><li><a href="https://medium.com/@chijianqiang/ç¨‹åºå‘˜æ€ä¹ˆä¼šä¸çŸ¥é“-c10k-é—®é¢˜å‘¢-d024cb7880f3" target="_blank" rel="noopener">ç¨‹åºå‘˜æ€ä¹ˆä¼šä¸çŸ¥é“C10K é—®é¢˜å‘¢ï¼Ÿ - æ± å»ºå¼º- Medium</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ä¸»è¦æ¢è®¨ç°é˜¶æ®µæµè§ˆå™¨ç«¯å¯è¡Œçš„å®æ—¶é€šä¿¡æ–¹æ¡ˆï¼Œä»¥åŠå®ƒä»¬çš„å‘å±•å†å²ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»¥&lt;a href=&quot;https://github.com/sockjs/sockjs-client&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;sockjs
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[è¯‘] ä¸å®¹é”™è¿‡çš„CSSå˜é‡</title>
    <link href="https://bobi.ink/2019/07/06/css-variable/"/>
    <id>https://bobi.ink/2019/07/06/css-variable/</id>
    <published>2019-07-05T16:00:00.000Z</published>
    <updated>2019-07-06T04:54:51.625Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡é“¾æ¥: <a href="https://dev.to/timdeschryver/don-t-miss-out-on-css-variables-4708" target="_blank" rel="noopener">Donâ€™t miss out on css variables</a></p><p>å½“æˆ‘ç¬¬ä¸€æ¬¡å¬è¯´<a href="https://www.w3.org/TR/css-variables/" target="_blank" rel="noopener">CSSå˜é‡</a>æ—¶ï¼Œæˆ‘æ˜¯æŠ±ç€æ€€ç–‘å¤ªå¤šçš„ã€‚scssã€sassã€lesså’Œstylusè¿™äº›CSSé¢„å¤„ç†å™¨ä¸æ˜¯éƒ½æœ‰å˜é‡æœºåˆ¶å—? ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨å®ƒï¼Ÿè¿‡äº†å‡ å¹´ï¼Œæˆ‘å‘ç°è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹è®¨è®ºå’Œä½¿ç”¨å®ƒï¼Œæˆ‘è§‰å¾—æˆ‘æ˜¯é”™è¿‡äº†ä»€ä¹ˆâ€¦â€¦ è™½ç„¶èŠ±è´¹äº†ä¸€ç‚¹åŠŸå¤«ï¼Œä½†åœ¨ä½¿ç”¨åï¼Œæˆ‘ç¡®å®è¢«å®ƒå¸å¼•ä½äº†ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä¼šé˜è¿°åˆ°åº•æ˜¯ä»€ä¹ˆæ¨åŠ¨æˆ‘è¿›ä¸€æ­¥å»æ¢ç´¢CSSå˜é‡ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚</p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p>åœ¨é€‰æ‹©å™¨é‡Œé¢å£°æ˜å˜é‡ï¼Œå˜é‡åä»¥<code>--</code>ä½œä¸ºå‰ç¼€:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">--bgColor</span>: deeppink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæµè¡Œçš„æ–¹å¼æ˜¯åœ¨<code>:root</code>é€‰æ‹©å™¨ä¸­å®šä¹‰å˜é‡ï¼Œè¿™ç›¸å½“äºå®šäºå…¨å±€å˜é‡:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">--bgColor</span>: teal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>var()</code>å‡½æ•°æ¥å¼•ç”¨å˜é‡:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--bgColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>var()</code>å‡½æ•°è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œç”¨ä½œå˜é‡çš„é»˜è®¤å€¼ï¼Œå½“å˜é‡æœªå®šä¹‰æ—¶å›é€€åˆ°è¿™ä¸ªé»˜è®¤å€¼:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--bgColor);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color, beige);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹:</p><p><img src="/images/css-variable/0.png" alt></p><h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><p>åˆ©ç”¨CSSå˜é‡ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°ä¸»é¢˜æœºåˆ¶.</p><p>åœ¨bodyå…ƒç´ ä¸Šä¸ºä¸åŒçš„ä¸»é¢˜åˆ›å»ºä¸åŒçš„ç±»åï¼Œå¹¶å®šä¹‰åˆé€‚çš„å˜é‡å€¼:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span><span class="selector-class">.sunrise</span> &#123;</span><br><span class="line">  <span class="attribute">--background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">--text-color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span><span class="selector-class">.sunset</span> &#123;</span><br><span class="line">  <span class="attribute">--background-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">--text-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™äº›å˜é‡:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--background-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨åˆ‡æ¢bodyå…ƒç´ çš„ç±»ååˆ°sunriseæˆ–sunseï¼ŒCSSå˜é‡ä¼šå å±‚åº”ç”¨åˆ°æ‰€æœ‰é€‰æ‹©å™¨. æ•ˆæœå¦‚ä¸‹:</p><p><img src="/images/css-variable/1.gif" alt></p><h2 id="javascript-api"><a href="#javascript-api" class="headerlink" title="Javascript API"></a>Javascript API</h2><p>æˆ‘è§‰å¾—è¿™æ˜¯CSSå˜é‡æœ€å¥½çš„éƒ¨åˆ† â€”â€” CSSå˜é‡å¯ä»¥é€šè¿‡Javascript APIæ¥è·å–å’Œè®¾ç½®ã€‚SCSS/Lessè¿™äº›é¢„å¤„ç†å™¨çš„å˜é‡å¯åšä¸åˆ°(éƒ¨åˆ†é¢„å¤„ç†å™¨å·²æ”¯æŒç¼–è¯‘åˆ°åˆ°CSSå˜é‡)ã€‚</p><p>é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleDeclaration/getPropertyValue" target="_blank" rel="noopener"><code>getPropertyValue</code></a>æ–¹æ³•æ¥è·å–å˜é‡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getComputedStyle(<span class="built_in">document</span>.documentElement).getPropertyValue(<span class="string">'--color'</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦è·å–å…·ä½“å…ƒç´ çš„çš„å˜é‡å€¼, å…ˆé€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector" target="_blank" rel="noopener"><code>querySelector</code></a>è·å–å…ƒç´ ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getComputedStyle(<span class="built_in">document</span>.querySelector(<span class="string">'h1'</span>)).getPropertyValue(<span class="string">'--color'</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleDeclaration/setProperty" target="_blank" rel="noopener"><code>style.setProperty</code></a>æ¥è®¾ç½®å˜é‡å€¼ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(<span class="string">'--color'</span>, <span class="string">'red'</span>)</span><br></pre></td></tr></table></figure><p>è®¾ç½®å…·ä½“å…ƒç´ çš„å˜é‡å€¼:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'h1'</span>).style.setProperty(<span class="string">'--color'</span>, <span class="string">'blue'</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªAPIæä¾›äº†ä¸€ä¸ªç®€æ´çš„æ–¹å¼æ¥ä½¿ç”¨CSSå˜é‡.</p><p>å‡ å¤©å‰, æˆ‘é€šè¿‡<a href="https://twitter.com/DavidKPiano" target="_blank" rel="noopener">David K</a>çš„<a href="https://codepen.io/davidkpiano/pen/zWrRye" target="_blank" rel="noopener">XState DEMO</a>æ¥è§¦åˆ°äº†è¿™ä¸ªä½¿ç”¨åœºæ™¯: å½“ç”¨æˆ·é¼ æ ‡æ‹–æ‹½æ—¶, é€šè¿‡CSSå˜é‡æ¥ç¡®å®šé€‰æ‹©æ¡†çš„å®šä½(åŸºäºé¼ æ ‡çš„å¼€å§‹ä½ç½®å’Œå½“å‰ä½ç½®):</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.selectbox</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="built_in">calc</span>(var(--mouse-x1));</span><br><span class="line">  <span class="attribute">top</span>: <span class="built_in">calc</span>(var(--mouse-y1));</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>((var(--mouse-x2) - <span class="built_in">var</span>(--mouse-x1)));</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>((var(--mouse-y2) - <span class="built_in">var</span>(--mouse-y1)));</span><br><span class="line"></span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(255, 255, 255, 0.5);</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(0, 0, 0, 0.1);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid currentColor;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.3s</span> ease-in-out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é¼ æ ‡äº‹ä»¶å¤„ç†å™¨ä¸­æ›´æ–°CSSå˜é‡ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-x1'</span>,</span><br><span class="line">  ctx.selectArea.x1 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-y1'</span>,</span><br><span class="line">  ctx.selectArea.y1 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-x2'</span>,</span><br><span class="line">  ctx.selectArea.x2 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-y2'</span>,</span><br><span class="line">  ctx.selectArea.y2 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/css-variable/2.gif" alt></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¦‚æœä½ åƒæˆ‘ä¸€æ ·è§‰å¾—CSSå˜é‡æ²¡æœ‰ç”¨ï¼Œæˆ–è€…å‹æ ¹ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥ä¸ºä½ å¼€å¯ä¸€æ‰‡é—¨ï¼Œæ¥æ¢ç´¢å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>Javascript APIè®©æˆ‘è¸©äº†ä¸å°‘å‘ï¼Œä½†æ˜¯å®ƒç¡®å®è®©æˆ‘å¼€äº†çœ¼ç•Œï¼Œæˆ‘æœŸå¾…æœªæ¥èƒ½å¤Ÿæ›´å¤šä½¿ç”¨å’Œäº†è§£å®ƒä»¬ã€‚</p><blockquote><p>è¯‘è€…æ³¨:<br><br>æœ¬æ–‡å¹¶éå®Œå…¨ç…§æ¬åŸæ–‡ï¼Œå³æ„è¯‘. å¦å¤–å¥³æœ‹å‹ä¹Ÿç»™æˆ‘æ ¡éªŒè¿‡äº†ï¼Œç¡®ä¿å¤§ä½“æ²¡æœ‰æé”™ğŸ˜‚<br><br>å› ä¸ºç¬”è€…è‡ªå·±åŸåˆ›çš„æ–‡ç« é˜…è¯»é‡æ¯”è¾ƒæƒ¨æ·¡ï¼Œæ‰€ä»¥ç¬”è€…è¿‘æœŸä¼šå°è¯•ç¿»è¯‘ä¸€äº›æ–‡ç« ï¼Œå­¦ä¹ è¿™äº›æ–‡ç« æ˜¯æ€ä¹ˆå†™çš„ï¼Œä¹Ÿç§¯æ”’ç‚¹äººæ°”ï¼Œä»¥ä¾¿åé¢åŸåˆ›æ–‡ç« æœ‰æ›´å¤šé˜…è¯»é‡</p></blockquote><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Using_CSS_custom_properties" target="_blank" rel="noopener">ä½¿ç”¨CSSå˜é‡</a></li><li><a href="https://caniuse.com/#feat=css-variables" target="_blank" rel="noopener">Caniuse: CSS Variables (Custom Properties)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡é“¾æ¥: &lt;a href=&quot;https://dev.to/timdeschryver/don-t-miss-out-on-css-variables-4708&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Donâ€™t miss out on css va
      
    
    </summary>
    
      <category term="å‰ç«¯,CSS" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF-CSS/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] CodeSandbox å¦‚ä½•å·¥ä½œ? ä¸Šç¯‡</title>
    <link href="https://bobi.ink/2019/06/20/codesandbox/"/>
    <id>https://bobi.ink/2019/06/20/codesandbox/</id>
    <published>2019-06-19T16:00:00.000Z</published>
    <updated>2019-07-04T14:28:21.865Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æœŸæ¥å…³æ³¨ä¸€ä¸‹<a href="https://codesandbox.io" target="_blank" rel="noopener"><code>CodeSandbox</code></a>, è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„æ²™ç›’è¿è¡Œç¯å¢ƒï¼Œæ”¯æŒå¤šç§æµè¡Œçš„æ„å»ºæ¨¡æ¿ï¼Œä¾‹å¦‚ <code>create-react-app</code>ã€ <code>vue-cli</code>ã€<code>parcel</code>ç­‰ç­‰ã€‚ å¯ä»¥ç”¨äºå¿«é€ŸåŸå‹å¼€å‘ã€DEMO å±•ç¤ºã€Bug è¿˜åŸç­‰ç­‰.</p><p>ç›¸ä¼¼çš„äº§å“æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚<a href="https://codepen.io/pen" target="_blank" rel="noopener"><code>codepen</code></a>ã€<a href="https://jsfiddle.net" target="_blank" rel="noopener"><code>JSFiddle</code></a>ã€<a href="https://webpackbin-prod.firebaseapp.com" target="_blank" rel="noopener"><code>WebpackBin</code></a>(å·²åºŸå¼ƒ).</p><p>CodeSandbox åˆ™æ›´åŠ å¼ºå¤§ï¼Œå¯ä»¥è§†ä½œæ˜¯æµè§ˆå™¨ç«¯çš„ Webpack è¿è¡Œç¯å¢ƒ, ç”šè‡³åœ¨ V3 ç‰ˆæœ¬å·²ç»æ”¯æŒ VsCode æ¨¡å¼ï¼Œæ”¯æŒ Vscode çš„æ’ä»¶å’Œ Vim æ¨¡å¼ã€è¿˜æœ‰ä¸»é¢˜.</p><p>å¦å¤– CodeSandbox æ”¯æŒç¦»çº¿è¿è¡Œ(PWA)ã€‚åŸºæœ¬ä¸Šå¯ä»¥æ¥è¿‘æœ¬åœ° VSCode çš„ç¼–ç¨‹ä½“éªŒ. æœ‰ iPad çš„åŒå­¦ï¼Œä¹Ÿå¯ä»¥å°è¯•åŸºäºå®ƒæ¥è¿›è¡Œå¼€å‘ã€‚æ‰€ä»¥å¿«é€Ÿçš„åŸå‹å¼€å‘æˆ‘ä¸€èˆ¬ä¼šç›´æ¥ä½¿ç”¨ CodeSandbox</p><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#å¼•">å¼•</a></li><li><a href="#åŸºæœ¬ç›®å½•ç»“æ„">åŸºæœ¬ç›®å½•ç»“æ„</a></li><li><a href="#é¡¹ç›®æ„å»ºè¿‡ç¨‹">é¡¹ç›®æ„å»ºè¿‡ç¨‹</a><ul><li><a href="#packager">Packager</a><ul><li><a href="#webpackdllplugin">WebpackDllPlugin</a></li><li><a href="#åœ¨çº¿æ‰“åŒ…æœåŠ¡">åœ¨çº¿æ‰“åŒ…æœåŠ¡</a></li><li><a href="#å›é€€æ–¹æ¡ˆ">å›é€€æ–¹æ¡ˆ</a></li></ul></li><li><a href="#transpilation">Transpilation</a><ul><li><a href="#åŸºæœ¬å¯¹è±¡">åŸºæœ¬å¯¹è±¡</a></li><li><a href="#manager">Manager</a></li><li><a href="#transpiledmodule">TranspiledModule</a></li><li><a href="#transpiler">Transpiler</a></li><li><a href="#babeltranspiler">BabelTranspiler</a></li></ul></li><li><a href="#evaluation">Evaluation</a></li></ul></li><li><a href="#æŠ€æœ¯åœ°å›¾">æŠ€æœ¯åœ°å›¾</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br><br><br></p><h2 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h2><center><br>  <img src="/images/08/codesandbox.png" width="800"><br></center><p><br></p><p>ç¬”è€…å¯¹ CodeSandbox çš„ç¬¬ä¸€å°è±¡æ˜¯è¿™ç©æ„æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨çš„å§ï¼Ÿ æ¯”å¦‚ <code>create-react-app</code> è¦è¿è¡Œèµ·æ¥éœ€è¦ node ç¯å¢ƒï¼Œéœ€è¦é€šè¿‡ npm å®‰è£…ä¸€å¤§å †ä¾èµ–ï¼Œç„¶åé€šè¿‡ Webpack è¿›è¡Œæ‰“åŒ…ï¼Œæœ€åè¿è¡Œä¸€ä¸ªå¼€å‘æœåŠ¡å™¨æ‰èƒ½åœ¨æµè§ˆå™¨è·‘èµ·æ¥.</p><p><strong>å®é™…ä¸Š CodeSandbox æ‰“åŒ…å’Œè¿è¡Œå¹¶ä¸ä¾èµ–äºæœåŠ¡å™¨, å®ƒæ˜¯å®Œå…¨åœ¨æµè§ˆå™¨è¿›è¡Œçš„</strong>. å¤§æ¦‚çš„ç»“æ„å¦‚ä¸‹:</p><center><br> <img src="/images/08/codesandbox-arch.png" width="600"><br></center><ul><li><strong>Editor</strong>: ç¼–è¾‘å™¨ã€‚ä¸»è¦ç”¨äºä¿®æ”¹æ–‡ä»¶ï¼ŒCodeSandboxè¿™é‡Œé›†æˆäº† <code>VsCode</code>, æ–‡ä»¶å˜åŠ¨åä¼šé€šçŸ¥ <code>Sandbox</code> è¿›è¡Œè½¬è¯‘. è®¡åˆ’ä¼šæœ‰æ–‡ç« ä¸“é—¨ä»‹ç»CodeSandboxçš„ç¼–è¾‘å™¨å®ç°</li><li><strong>Sandbox</strong>: ä»£ç è¿è¡Œå™¨ã€‚<strong>Sandbox åœ¨ä¸€ä¸ªå•ç‹¬çš„ iframe ä¸­è¿è¡Œ, è´Ÿè´£ä»£ç çš„è½¬è¯‘(Transpiler)å’Œè¿è¡Œ(Evalation)</strong>. å¦‚æœ€ä¸Šé¢çš„å›¾ï¼Œå·¦è¾¹æ˜¯Editorï¼Œå³è¾¹æ˜¯Sandbox</li><li><strong>Packager</strong> åŒ…ç®¡ç†å™¨ã€‚ç±»ä¼¼äºyarnå’Œnpmï¼Œè´Ÿè´£æ‹‰å–å’Œç¼“å­˜ npm ä¾èµ–</li></ul><p><br></p><p>CodeSandbox çš„ä½œè€… <a href="https://twitter.com/CompuIves" target="_blank" rel="noopener">Ives van Hoorne</a> ä¹Ÿå°è¯•è¿‡å°† <code>Webpack</code> ç§»æ¤åˆ°æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œå› ä¸ºç°åœ¨å‡ ä¹æ‰€æœ‰çš„ CLI éƒ½æ˜¯ä½¿ç”¨ Webpack è¿›è¡Œæ„å»ºçš„ï¼Œå¦‚æœèƒ½å°† Webpack ç§»æ¤åˆ°æµè§ˆå™¨ä¸Š, å¯ä»¥åˆ©ç”¨ Webpack å¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿå’Œè½¬è¯‘æœºåˆ¶(loader/plugin)ï¼Œä½æˆæœ¬å…¼å®¹å„ç§ CLI.</p><p>ç„¶è€Œ Webpack å¤ªé‡äº†ğŸ˜±ï¼Œå‹ç¼©è¿‡åçš„å¤§å°å°±å¾— 3.5MBï¼Œè¿™è¿˜ç®—å‹‰å¼ºå¯ä»¥æ¥å—å§ï¼›æ›´å¤§çš„é—®é¢˜æ˜¯è¦åœ¨æµè§ˆå™¨ç«¯æ¨¡æ‹Ÿ Node è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªæˆæœ¬å¤ªé«˜äº†ï¼Œå¾—ä¸å¿å¤±ã€‚</p><p>æ‰€ä»¥ CodeSandbox å†³å®šè‡ªå·±é€ ä¸ªæ‰“åŒ…å™¨ï¼Œè¿™ä¸ªæ‰“åŒ…å™¨æ›´è½»é‡ï¼Œå¹¶ä¸”é’ˆå¯¹ CodeSandbox å¹³å°è¿›è¡Œä¼˜åŒ–. æ¯”å¦‚ CodeSandbox åªå…³å¿ƒå¼€å‘ç¯å¢ƒçš„ä»£ç æ„å»º, ç›®æ ‡å°±æ˜¯èƒ½è·‘èµ·æ¥å°±è¡Œäº†, è·Ÿ Webpack ç›¸æ¯”è£å‰ªæ‰äº†ä»¥ä¸‹ç‰¹æ€§:</p><ul><li>ç”Ÿäº§æ¨¡å¼. CodeSandbox åªè€ƒè™‘ development æ¨¡å¼ï¼Œä¸éœ€è¦è€ƒè™‘ productionä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚<ul><li>ä»£ç å‹ç¼©ï¼Œä¼˜åŒ–</li><li>Tree-shaking</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>ä»£ç åˆ†å‰²</li></ul></li><li>æ–‡ä»¶è¾“å‡º. ä¸éœ€è¦æ‰“åŒ…æˆchunk</li><li>æœåŠ¡å™¨é€šä¿¡. Sandboxç›´æ¥åŸåœ°è½¬è¯‘å’Œè¿è¡Œ, è€ŒWebpack éœ€è¦å’Œå¼€å‘æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥ç”¨äºæ¥æ”¶æŒ‡ä»¤ï¼Œä¾‹å¦‚ HMR.</li><li>é™æ€æ–‡ä»¶å¤„ç†(å¦‚å›¾ç‰‡). è¿™äº›å›¾ç‰‡éœ€è¦ä¸Šä¼ åˆ° CodeSandbox çš„æœåŠ¡å™¨</li><li>æ’ä»¶æœºåˆ¶ç­‰ç­‰.</li></ul><p>æ‰€ä»¥å¯ä»¥è®¤ä¸º<strong>CodeSandboxæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„Webpack, ä¸”é’ˆå¯¹æµè§ˆå™¨ç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨workeræ¥è¿›è¡Œå¹¶è¡Œè½¬è¯‘</strong></p><p>CodeSandbox çš„æ‰“åŒ…å™¨ä½¿ç”¨äº†æ¥è¿‘ <code>Webpack Loader</code> çš„ API, è¿™æ ·å¯ä»¥å¾ˆå®¹æ˜“åœ°å°† Webpack çš„ä¸€äº› loader ç§»æ¤è¿‡æ¥. ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯ <code>create-react-app</code> çš„å®ç°(æŸ¥çœ‹<a href="https://github.com/codesandbox/codesandbox-client/blob/84972fd027fe36c53652c22f6775e1e6d3c51145/packages/app/src/sandbox/eval/presets/create-react-app/index.js#L1" target="_blank" rel="noopener">æºç </a>):</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> stylesTranspiler <span class="keyword">from</span> <span class="string">"../../transpilers/style"</span>;</span><br><span class="line"><span class="keyword">import</span> babelTranspiler <span class="keyword">from</span> <span class="string">"../../transpilers/babe"</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> sassTranspiler <span class="keyword">from</span> <span class="string">"../../transpilers/sass"</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preset = <span class="keyword">new</span> Preset(</span><br><span class="line">  <span class="string">"create-react-app"</span>,</span><br><span class="line">  [<span class="string">"web.js"</span>, <span class="string">"js"</span>, <span class="string">"json"</span>, <span class="string">"web.jsx"</span>, <span class="string">"jsx"</span>, <span class="string">"ts"</span>, <span class="string">"tsx"</span>],</span><br><span class="line">  &#123;</span><br><span class="line">    hasDotEnv: <span class="literal">true</span>,</span><br><span class="line">    setup: <span class="function"><span class="params">manager</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> babelOptions = &#123;</span><br><span class="line">        <span class="comment">/*..*/</span></span><br><span class="line">      &#125;;</span><br><span class="line">      preset.registerTranspiler(</span><br><span class="line">        <span class="built_in">module</span> =&gt;</span><br><span class="line">          /\.(t|j)sx?$/.test(<span class="built_in">module</span>.path) &amp;&amp; !<span class="built_in">module</span>.path.endsWith(<span class="string">".d.ts"</span>),</span><br><span class="line">        [</span><br><span class="line">          &#123;</span><br><span class="line">            transpiler: babelTranspiler,</span><br><span class="line">            options: babelOptions</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      );</span><br><span class="line">      preset.registerTranspiler(</span><br><span class="line">        <span class="built_in">module</span> =&gt; <span class="regexp">/\.svg$/</span>.test(<span class="built_in">module</span>.path),</span><br><span class="line">        [</span><br><span class="line">          &#123; <span class="attr">transpiler</span>: svgrTranspiler &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            transpiler: babelTranspiler,</span><br><span class="line">            options: babelOptions</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><br></p><p>å¯ä»¥çœ‹å‡º, CodeSandboxçš„Presetå’ŒWebpackçš„é…ç½®é•¿çš„å·®ä¸å¤š. <strong>ä¸è¿‡, ç›®å‰ä½ åªèƒ½ä½¿ç”¨ CodeSandbox é¢„å®šä¹‰çš„ Preset, ä¸æ”¯æŒåƒ Webpack ä¸€æ ·è¿›è¡Œé…ç½®, ä¸ªäººè§‰å¾—è¿™ä¸ªæ˜¯ç¬¦åˆ CodeSandbox å®šä½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„åŸå‹å¼€å‘å·¥å…·ï¼Œä½ è¿˜æŠ˜è…¾ Webpack å¹²å˜›ï¼Ÿ</strong></p><p>ç›®å‰æ”¯æŒè¿™äº›Preset:</p><center><br> <img src="/images/08/presets.png" width="600"><br></center><p><br></p><hr><p><br></p><h2 id="åŸºæœ¬ç›®å½•ç»“æ„"><a href="#åŸºæœ¬ç›®å½•ç»“æ„" class="headerlink" title="åŸºæœ¬ç›®å½•ç»“æ„"></a>åŸºæœ¬ç›®å½•ç»“æ„</h2><p>CodeSandbox çš„å®¢æˆ·ç«¯æ˜¯å¼€æºçš„ï¼Œä¸ç„¶å°±æ²¡æœ‰æœ¬æ–‡äº†ï¼Œå®ƒçš„åŸºæœ¬ç›®å½•ç»“æ„å¦‚ä¸‹:</p><ul><li><strong>packages</strong><ul><li><strong>app</strong> CodeSandboxåº”ç”¨<ul><li><strong>app</strong> ç¼–è¾‘å™¨å®ç°</li><li><strong>embed</strong> ç½‘é¡µå†…åµŒè¿è¡Œ codesandbox</li><li><strong>sandbox</strong> è¿è¡Œæ²™ç›’ï¼Œåœ¨è¿™é‡Œæ‰§è¡Œä»£ç æ„å»ºå’Œé¢„è§ˆï¼Œç›¸å½“äºä¸€ä¸ªç¼©ç•¥ç‰ˆçš„ Webpack. è¿è¡Œåœ¨å•ç‹¬çš„ iframe ä¸­<ul><li>eval<ul><li>preset<ul><li>create-react-app</li><li>parcel</li><li>vue-cli</li><li>â€¦</li></ul></li><li>transpiler<ul><li>babel</li><li>sass</li><li>vue</li><li>â€¦</li></ul></li></ul></li><li>compile.ts ç¼–è¯‘å™¨</li></ul></li></ul></li><li><strong>common</strong> æ”¾ç½®é€šç”¨çš„ç»„ä»¶ã€å·¥å…·æ–¹æ³•ã€èµ„æº</li><li><strong>codesandbox-api</strong>: å°è£…äº†ç»Ÿä¸€çš„åè®®ï¼Œç”¨äº sandbox å’Œ editor ä¹‹é—´é€šä¿¡(åŸºäºpostmessage)</li><li><strong>codesandbox-browserfs</strong>: è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„â€˜æ–‡ä»¶ç³»ç»Ÿâ€™ï¼Œæ¨¡æ‹Ÿäº† NodeJS çš„æ–‡ä»¶ç³»ç»Ÿ APIï¼Œæ”¯æŒåœ¨æœ¬åœ°æˆ–ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­å­˜å‚¨æˆ–è·å–æ–‡ä»¶.</li><li><strong>react-sandpack</strong>: codesandboxå…¬å¼€çš„SDKï¼Œå¯ä»¥ç”¨äºè‡ªå®šä¹‰è‡ªå·±çš„codesandbox</li></ul></li></ul><p><a href="https://github.com/codesandbox/codesandbox-client" target="_blank" rel="noopener">æºç åœ¨è¿™</a></p><p><br></p><hr><p><br></p><h2 id="é¡¹ç›®æ„å»ºè¿‡ç¨‹"><a href="#é¡¹ç›®æ„å»ºè¿‡ç¨‹" class="headerlink" title="é¡¹ç›®æ„å»ºè¿‡ç¨‹"></a>é¡¹ç›®æ„å»ºè¿‡ç¨‹</h2><p><code>packager -&gt; transpilation -&gt; evaluation</code></p><p>Sandbox æ„å»ºåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:</p><ul><li><strong>Packager</strong> åŒ…åŠ è½½é˜¶æ®µï¼Œä¸‹è½½å’Œå¤„ç†æ‰€æœ‰npmæ¨¡å—ä¾èµ–</li><li><strong>Transpilation</strong> è½¬è¯‘é˜¶æ®µï¼Œè½¬è¯‘æ‰€æœ‰å˜åŠ¨çš„ä»£ç , æ„å»ºæ¨¡å—ä¾èµ–å›¾</li><li><strong>Evaluation</strong> æ‰§è¡Œé˜¶æ®µï¼Œä½¿ç”¨ <code>eval</code> è¿è¡Œæ¨¡å—ä»£ç è¿›è¡Œé¢„è§ˆ</li></ul><p>ä¸‹é¢ä¼šæŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤æ¥æè¿°å…¶ä¸­çš„æŠ€æœ¯ç‚¹</p><p><br><br><br></p><h3 id="packager"><a href="#packager" class="headerlink" title="Packager"></a>Packager</h3><p>å°½ç®¡ npm æ˜¯ä¸ªâ€™é»‘æ´â€™ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç¦»ä¸å¼€å®ƒã€‚ å…¶å®å¤§æ¦‚åˆ†æä¸€ä¸‹å‰ç«¯é¡¹ç›®çš„ <code>node_modules</code>ï¼Œ80%æ˜¯å„ç§å¼€å‘ä¾èµ–ç»„æˆçš„. </p><p>ç”±äº CodeSandbox å·²ç»åŒ…æ½äº†ä»£ç æ„å»ºçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦<code>devDependencies</code>, ä¹Ÿå°±æ˜¯è¯´ <strong>åœ¨CodeSandbox ä¸­æˆ‘ä»¬åªéœ€è¦å®‰è£…æ‰€æœ‰å®é™…ä»£ç è¿è¡Œéœ€è¦çš„ä¾èµ–ï¼Œè¿™å¯ä»¥å‡å°‘æˆç™¾ä¸Šåƒçš„ä¾èµ–ä¸‹è½½. æ‰€ä»¥æš‚ä¸”ä¸ç”¨æ‹…å¿ƒæµè§ˆå™¨ä¼šæ‰›ä¸ä½</strong>.</p><p><br></p><h4 id="webpackdllplugin"><a href="#webpackdllplugin" class="headerlink" title="WebpackDllPlugin"></a>WebpackDllPlugin</h4><p>CodeSandbox çš„ä¾èµ–æ‰“åŒ…æ–¹å¼å— <code>WebpackDllPlugin</code> å¯å‘ï¼ŒDllPlugin ä¼šå°†æ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åˆ°ä¸€ä¸ª<code>dll</code>æ–‡ä»¶ä¸­ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª <code>manifest</code> æ–‡ä»¶æ¥æè¿°dllçš„å…ƒæ•°æ®(å¦‚ä¸‹å›¾).</p><p>Webpack è½¬è¯‘æ—¶æˆ–è€… è¿è¡Œæ—¶å¯ä»¥æ ¹æ® manifest ä¸­çš„æ¨¡å—ç´¢å¼•(ä¾‹å¦‚<code>__webpack_require__(&#39;../node_modules/react/index.js&#39;)</code>)æ¥åŠ è½½ dll ä¸­çš„æ¨¡å—ã€‚ å› ä¸º<code>WebpackDllPlugin</code>æ˜¯åœ¨è¿è¡Œæˆ–è½¬è¯‘ä¹‹å‰é¢„å…ˆå¯¹ä¾èµ–çš„è¿›è¡Œè½¬è¯‘ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®ä»£ç è½¬è¯‘é˜¶æ®µå¯ä»¥å¿½ç•¥æ‰è¿™éƒ¨åˆ†ä¾èµ–ä»£ç ï¼Œè¿™æ ·å¯ä»¥æé«˜æ„å»ºçš„é€Ÿåº¦(çœŸå®åœºæ™¯å¯¹npmä¾èµ–è¿›è¡ŒDllæ‰“åŒ…æé€Ÿæ•ˆæœå¹¶ä¸å¤§):</p><center><br>  <img src="/images/08/dll.png"><br></center><p>manifestæ–‡ä»¶</p><center><br>  <img src="/images/08/webpack-dll-manifest.png" width="500"><br></center><p><br></p><h4 id="åœ¨çº¿æ‰“åŒ…æœåŠ¡"><a href="#åœ¨çº¿æ‰“åŒ…æœåŠ¡" class="headerlink" title="åœ¨çº¿æ‰“åŒ…æœåŠ¡"></a>åœ¨çº¿æ‰“åŒ…æœåŠ¡</h4><p>åŸºäºè¿™ä¸ªæ€æƒ³, CodeSandbox æ„å»ºäº†è‡ªå·±çš„åœ¨çº¿æ‰“åŒ…æœåŠ¡, å’ŒWebpackDllPluginä¸ä¸€æ ·çš„æ˜¯ï¼ŒCodeSandboxæ˜¯åœ¨æœåŠ¡ç«¯é¢„å…ˆæ„å»ºManifestæ–‡ä»¶çš„, è€Œä¸”ä¸åŒºåˆ†Dllå’Œmanifestæ–‡ä»¶ã€‚ å…·ä½“æ€è·¯å¦‚ä¸‹:</p><center><br> <img src="/images/08/packager1.png" width="800"><br></center><p>ç®€è€Œè¨€ä¹‹ï¼ŒCodeSandbox å®¢æˆ·ç«¯æ‹¿åˆ°<code>package.json</code>ä¹‹åï¼Œå°†<code>dependencies</code>è½¬æ¢ä¸ºä¸€ä¸ªç”±ä¾èµ–å’Œç‰ˆæœ¬å·ç»„æˆçš„<code>Combination</code>(æ ‡è¯†ç¬¦, ä¾‹å¦‚ <a href="https://d1jyvh0kxilfa7.cloudfront.net/v1/combinations/babel-runtime@7.3.1%2Bcsbbust@1.0.0%2Breact@16.8.4%2Breact-dom@16.8.4%2Breact-router@5.0.1%2Breact-router-dom@5.0.1%2Breact-split-pane@0.1.87.json" target="_blank" rel="noopener"><code>v1/combinations/babel-runtime@7.3.1&amp;csbbust@1.0.0&amp;react@16.8.4&amp;react-dom@16.8.4&amp;react-router@5.0.1&amp;react-router-dom@5.0.1&amp;react-split-pane@0.1.87.json</code></a>), å†æ‹¿è¿™ä¸ª Combination åˆ°æœåŠ¡å™¨è¯·æ±‚ã€‚æœåŠ¡å™¨ä¼šæ ¹æ® Combination ä½œä¸ºç¼“å­˜é”®æ¥ç¼“å­˜æ‰“åŒ…ç»“æœï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œåˆ™è¿›è¡Œæ‰“åŒ….</p><p><strong>æ‰“åŒ…å®é™…ä¸Šè¿˜æ˜¯ä½¿ç”¨<code>yarn</code>æ¥ä¸‹è½½æ‰€æœ‰ä¾èµ–ï¼Œåªä¸è¿‡è¿™é‡Œä¸ºäº†å‰”é™¤ npm æ¨¡å—ä¸­å¤šä½™çš„æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯è¿˜éå†äº†æ‰€æœ‰ä¾èµ–çš„å…¥å£æ–‡ä»¶(package.json#main), è§£æ AST ä¸­çš„ require è¯­å¥ï¼Œé€’å½’è§£æè¢« require æ¨¡å—. æœ€ç»ˆå½¢æˆä¸€ä¸ªä¾èµ–å›¾, åªä¿ç•™å¿…è¦çš„æ–‡ä»¶</strong>. </p><p>æœ€ç»ˆè¾“å‡º Manifest æ–‡ä»¶ï¼Œå®ƒçš„ç»“æ„å¤§æ¦‚å¦‚ä¸‹, ä»–å°±ç›¸å½“äºWebpackDllPluginçš„dll.js+manifest.jsonçš„ç»“åˆä½“:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ¨¡å—å†…å®¹</span></span><br><span class="line">  <span class="string">"contents"</span>: &#123;</span><br><span class="line">    <span class="string">"/node_modules/react/index.js"</span>: &#123;</span><br><span class="line">      <span class="string">"content"</span>: <span class="string">"'use strict';â†µâ†µif ...."</span>, <span class="comment">// ä»£ç å†…å®¹</span></span><br><span class="line">      <span class="string">"requires"</span>: [                        <span class="comment">// ä¾èµ–çš„å…¶ä»–æ¨¡å—</span></span><br><span class="line">        <span class="string">"./cjs/react.development.js"</span>,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"/node_modules/react-dom/index.js"</span>: &#123;<span class="comment">/*..*/</span>&#125;,</span><br><span class="line">    <span class="string">"/node_modules/react/package.json"</span>: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æ¨¡å—å…·ä½“å®‰è£…ç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="string">"dependencies"</span>: [&#123;<span class="attr">name</span>: <span class="string">"@babel/runtime"</span>, <span class="attr">version</span>: <span class="string">"7.3.1"</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">"csbbust"</span>, <span class="attr">version</span>: <span class="string">"1.0.0"</span>&#125;,<span class="comment">/*â€¦*/</span>],</span><br><span class="line">  <span class="comment">// æ¨¡å—åˆ«å, æ¯”å¦‚å°†reactä½œä¸ºpreact-compatçš„åˆ«å</span></span><br><span class="line">  <span class="string">"dependencyAliases"</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// ä¾èµ–çš„ä¾èµ–, å³é—´æ¥ä¾èµ–ä¿¡æ¯. è¿™äº›ä¿¡æ¯å¯ä»¥ä»yarn.lockè·å–</span></span><br><span class="line">  <span class="string">"dependencyDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"object-assign"</span>: &#123;</span><br><span class="line">      <span class="string">"entries"</span>: [<span class="string">"object-assign"</span>], <span class="comment">// æ¨¡å—å…¥å£</span></span><br><span class="line">      <span class="string">"parents"</span>: [<span class="string">"react"</span>, <span class="string">"prop-types"</span>, <span class="string">"scheduler"</span>, <span class="string">"react-dom"</span>], <span class="comment">// çˆ¶æ¨¡å—</span></span><br><span class="line">      <span class="string">"resolved"</span>: <span class="string">"4.1.1"</span>,</span><br><span class="line">      <span class="string">"semver"</span>: <span class="string">"^4.1.1"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p><strong>Serverless æ€æƒ³</strong><br><br><br>å€¼å¾—ä¸€æçš„æ˜¯ CodeSandbox çš„ Packager åç«¯ä½¿ç”¨äº† Serverless(åŸºäº AWS Lambda)ï¼ŒåŸºäº Serverless çš„æ¶æ„è®© Packager æœåŠ¡æ›´å…·ä¼¸ç¼©æ€§ï¼Œå¯ä»¥çµæ´»åœ°åº”ä»˜é«˜å¹¶å‘çš„åœºæ™¯ã€‚ä½¿ç”¨ Serverless ä¹‹å Packager çš„å“åº”æ—¶é—´æ˜¾è‘—æé«˜ï¼Œè€Œä¸”è´¹ç”¨ä¹Ÿä¸‹å»äº†ã€‚</p></blockquote><blockquote><p>Packager ä¹Ÿæ˜¯å¼€æºçš„, <a href="https://github.com/codesandbox/dependency-packager" target="_blank" rel="noopener">å›´è§‚</a></p></blockquote><p><br></p><h4 id="å›é€€æ–¹æ¡ˆ"><a href="#å›é€€æ–¹æ¡ˆ" class="headerlink" title="å›é€€æ–¹æ¡ˆ"></a>å›é€€æ–¹æ¡ˆ</h4><p>AWS Lambdaå‡½æ•°æ˜¯æœ‰å±€é™æ€§çš„, æ¯”å¦‚<code>/tmp</code>æœ€å¤šåªèƒ½æœ‰ 500MB çš„ç©ºé—´. å°½ç®¡å¤§éƒ¨åˆ†ä¾èµ–æ‰“åŒ…åœºæ™¯ä¸ä¼šè¶…è¿‡è¿™ä¸ªé™é¢, ä¸ºäº†å¢å¼ºå¯é æ€§(æ¯”å¦‚ä¸Šè¿°çš„æ–¹æ¡ˆå¯èƒ½å‡ºé”™ï¼Œä¹Ÿå¯èƒ½æ¼æ‰ä¸€äº›æ¨¡å—), Packagerè¿˜æœ‰å›é€€æ–¹æ¡ˆ.</p><p>åæ¥CodeSanboxä½œè€…å¼€å‘äº†æ–°çš„Sandboxï¼Œæ”¯æŒæŠŠåŒ…ç®¡ç†çš„æ­¥éª¤æ”¾ç½®åˆ°æµè§ˆå™¨ç«¯, å’Œä¸Šé¢çš„æ‰“åŒ…æ–¹å¼ç»“åˆç€ä½¿ç”¨ã€‚åŸç†ä¹Ÿæ¯”è¾ƒç®€å•: <strong>åœ¨è½¬è¯‘ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå¦‚æœå‘ç°æ¨¡å—ä¾èµ–çš„npmæ¨¡å—æœªæ‰¾åˆ°ï¼Œåˆ™æƒ°æ€§ä»è¿œç¨‹ä¸‹è½½å›æ¥</strong>. æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå¤„ç†çš„:</p><center><br> <img src="/images/08/packager2.png"><br></center><p>åœ¨å›é€€æ–¹æ¡ˆä¸­CodeSandbox å¹¶ä¸ä¼šå°† package.json ä¸­æ‰€æœ‰çš„åŒ…éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œè€Œæ˜¯åœ¨æ¨¡å—æŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œæƒ°æ€§çš„å»åŠ è½½ã€‚æ¯”å¦‚åœ¨è½¬è¯‘å…¥å£æ–‡ä»¶æ—¶ï¼Œå‘ç° react è¿™ä¸ªæ¨¡å—æ²¡æœ‰åœ¨æœ¬åœ°ç¼“å­˜æ¨¡å—é˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶å€™å°±ä¼šåˆ°è¿œç¨‹å°†å®ƒä¸‹è½½å›æ¥ï¼Œç„¶åæ¥ç€è½¬è¯‘ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå› ä¸ºåœ¨è½¬è¯‘é˜¶æ®µä¼šé™æ€åˆ†ææ¨¡å—çš„ä¾èµ–ï¼Œåªéœ€è¦å°†çœŸæ­£ä¾èµ–çš„æ–‡ä»¶ä¸‹è½½å›æ¥ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªnpmåŒ…ä¸‹è½½å›æ¥ï¼ŒèŠ‚çœäº†ç½‘ç»œä¼ è¾“çš„æˆæœ¬.</p><p>CodeSandbox é€šè¿‡ <code>unpkg.com</code> æˆ– <code>cdn.jsdelivr.net</code> æ¥è·å–æ¨¡å—çš„ä¿¡æ¯ä»¥åŠä¸‹è½½æ–‡ä»¶, ä¾‹å¦‚</p><ul><li>è·å– package.json: <code>https://unpkg.com/react@latest/package.json</code></li><li>åŒ…ç›®å½•ç»“æ„è·å–: <code>https://unpkg.com/antd@3.17.0/?meta</code> è¿™ä¸ªä¼šé€’å½’è¿”å›è¯¥åŒ…çš„æ‰€æœ‰ç›®å½•ä¿¡æ¯</li><li>å…·ä½“æ–‡ä»¶ä¸‹è½½: <code>https://unpkg.com/react@16.8.6/cjs/react.production.min.js</code> æˆ–è€… <code>https://cdn.jsdelivr.net/npm/@babel/runtime@7.3.1/helpers/interopRequireDefault.js</code></li></ul><p><br></p><hr><p><br></p><h3 id="transpilation"><a href="#transpilation" class="headerlink" title="Transpilation"></a>Transpilation</h3><p>è®²å®Œ Packager ç°åœ¨æ¥çœ‹ä¸€ä¸‹ Transpilation, è¿™ä¸ªé˜¶æ®µ<strong>ä»åº”ç”¨çš„å…¥å£æ–‡ä»¶å¼€å§‹, å¯¹æºä»£ç è¿›è¡Œè½¬è¯‘, è§£æASTï¼Œæ‰¾å‡ºä¸‹çº§ä¾èµ–æ¨¡å—ï¼Œç„¶åé€’å½’è½¬è¯‘ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªâ€™ä¾èµ–å›¾â€™</strong>:</p><center><br>  <img src="/images/08/transpile-dependency-graph.png"><br></center><p>CodeSandbox çš„æ•´ä¸ªè½¬è¯‘å™¨æ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„ iframe ä¸­è¿è¡Œçš„ï¼š</p><center><br>  <img src="/images/08/editor-vs-compiler.png"><br></center><p>Editor è´Ÿè´£å˜æ›´æºä»£ç ï¼Œæºä»£ç å˜æ›´ä¼šé€šè¿‡ postmessage ä¼ é€’ç»™ Compilerï¼Œè¿™é‡Œé¢ä¼šæºå¸¦ <code>Module+template</code></p><ul><li><strong>Module</strong> ä¸­åŒ…å«æ‰€æœ‰æºä»£ç å†…å®¹å’Œæ¨¡å—è·¯å¾„ï¼Œå…¶ä¸­è¿˜åŒ…å« package.json, Compiler ä¼šæ ¹æ® package.json æ¥è¯»å– npm ä¾èµ–;</li><li><strong>template</strong> è¡¨ç¤º Compiler çš„ Presetï¼Œä¾‹å¦‚<code>create-react-app</code>ã€<code>vue-cli</code>, å®šä¹‰äº†ä¸€äº› loader è§„åˆ™ï¼Œç”¨æ¥è½¬è¯‘ä¸åŒç±»å‹çš„æ–‡ä»¶, å¦å¤–presetä¹Ÿå†³å®šäº†åº”ç”¨çš„æ¨¡æ¿å’Œå…¥å£æ–‡ä»¶ã€‚ é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“, è¿™äº› template ç›®å‰çš„é¢„å®šä¹‰çš„.</li></ul><p><br></p><h4 id="åŸºæœ¬å¯¹è±¡"><a href="#åŸºæœ¬å¯¹è±¡" class="headerlink" title="åŸºæœ¬å¯¹è±¡"></a>åŸºæœ¬å¯¹è±¡</h4><p>åœ¨è¯¦ç»†ä»‹ç» Transpilation ä¹‹å‰å…ˆå¤§æ¦‚çœ‹ä¸€äº›åŸºæœ¬å¯¹è±¡ï¼Œäº†è§£è¿™äº›å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼š</p><center><br> <img src="/images/08/baseobj.png"><br></center><ul><li><strong>Manager</strong> è¿™æ˜¯ Sandbox çš„æ ¸å¿ƒå¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç†é…ç½®ä¿¡æ¯(Preset)ã€é¡¹ç›®ä¾èµ–(Manifest)ã€ä»¥åŠç»´æŠ¤é¡¹ç›®æ‰€æœ‰æ¨¡å—(TranspilerModule)</li><li><strong>Manifest</strong> é€šè¿‡ä¸Šæ–‡çš„ Packager æˆ‘ä»¬çŸ¥é“ï¼ŒManifest ç»´æŠ¤æ‰€æœ‰ä¾èµ–çš„ npm æ¨¡å—ä¿¡æ¯</li><li><strong>TranspiledModule</strong> è¡¨ç¤ºæ¨¡å—æœ¬èº«ã€‚è¿™é‡Œé¢ç»´æŠ¤è½¬è¯‘çš„ç»“æœã€ä»£ç æ‰§è¡Œçš„ç»“æœã€ä¾èµ–çš„æ¨¡å—ä¿¡æ¯ï¼Œè´Ÿè´£é©±åŠ¨å…·ä½“æ¨¡å—çš„è½¬è¯‘(è°ƒç”¨ Transpiler)å’Œæ‰§è¡Œ</li><li><strong>Preset</strong> ä¸€ä¸ªé¡¹ç›®æ„å»ºæ¨¡æ¿ï¼Œä¾‹å¦‚ <code>vue-cli</code>ã€<code>create-react-app</code>. é…ç½®äº†é¡¹ç›®æ–‡ä»¶çš„è½¬è¯‘è§„åˆ™, ä»¥åŠåº”ç”¨çš„ç›®å½•ç»“æ„(å…¥å£æ–‡ä»¶)</li><li><strong>Transpiler</strong> ç­‰ä»·äº Webpack çš„ loaderï¼Œè´Ÿè´£å¯¹æŒ‡å®šç±»å‹çš„æ–‡ä»¶è¿›è¡Œè½¬è¯‘ã€‚ä¾‹å¦‚ babelã€typescriptã€pugã€sass ç­‰ç­‰</li><li><strong>WorkerTranspiler</strong> è¿™æ˜¯ Transpiler çš„å­ç±»ï¼Œè°ƒåº¦ä¸€ä¸ª Workeræ± æ¥æ‰§è¡Œè½¬è¯‘ä»»åŠ¡ï¼Œä»è€Œæé«˜è½¬è¯‘çš„æ€§èƒ½</li></ul><p><br></p><h4 id="manager"><a href="#manager" class="headerlink" title="Manager"></a>Manager</h4><p>Manageræ˜¯ä¸€ä¸ªç®¡ç†è€…çš„è§’è‰²ï¼Œä»å¤§å±€ä¸ŠæŠŠæ§æ•´ä¸ªè½¬è¯‘å’Œæ‰§è¡Œçš„æµç¨‹. ç°åœ¨æ¥çœ‹çœ‹æ•´ä½“çš„è½¬è¯‘æµç¨‹ï¼š</p><center><br> <img src="/images/08/compiler.png"><br></center><p>å¤§å±€ä¸ŠåŸºæœ¬ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å››ä¸ªé˜¶æ®µ:</p><ul><li><strong>é…ç½®é˜¶æ®µ</strong>ï¼šé…ç½®é˜¶æ®µä¼šåˆ›å»º Preset å¯¹è±¡ï¼Œç¡®å®šå…¥å£æ–‡ä»¶ç­‰ç­‰. CodeSandbox ç›®å‰åªæ”¯æŒé™å®šçš„å‡ ç§åº”ç”¨æ¨¡æ¿ï¼Œä¾‹å¦‚ vue-cliã€create-react-appã€‚ä¸åŒæ¨¡æ¿ä¹‹é—´ç›®å½•ç»“æ„çš„çº¦å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¾‹å¦‚å…¥å£æ–‡ä»¶å’Œ html æ¨¡æ¿æ–‡ä»¶ã€‚å¦å¤–æ–‡ä»¶å¤„ç†çš„è§„åˆ™ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ vue-cli éœ€è¦å¤„ç†<code>.vue</code>æ–‡ä»¶ã€‚</li><li><strong>ä¾èµ–ä¸‹è½½é˜¶æ®µ</strong>ï¼š å³ Packager é˜¶æ®µï¼Œä¸‹è½½é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œç”Ÿæˆ Manifest å¯¹è±¡</li><li><strong>å˜åŠ¨è®¡ç®—é˜¶æ®µ</strong>ï¼šæ ¹æ® Editor ä¼ é€’è¿‡æ¥çš„æºä»£ç ï¼Œè®¡ç®—æ–°å¢ã€æ›´æ–°ã€ç§»é™¤çš„æ¨¡å—ã€‚</li><li><strong>è½¬è¯‘é˜¶æ®µ</strong>ï¼šçœŸæ­£å¼€å§‹è½¬è¯‘äº†ï¼Œé¦–å…ˆé‡æ–°è½¬è¯‘ä¸Šä¸ªé˜¶æ®µè®¡ç®—å‡ºæ¥çš„éœ€è¦æ›´æ–°çš„æ¨¡å—ã€‚æ¥ç€ä»å…¥å£æ–‡ä»¶ä½œä¸ºå‡ºå‘ç‚¹ï¼Œè½¬è¯‘å’Œæ„å»ºæ–°çš„ä¾èµ–å›¾ã€‚è¿™é‡Œä¸ä¼šé‡å¤è½¬è¯‘æ²¡æœ‰å˜åŒ–çš„æ¨¡å—ä»¥åŠå…¶å­æ¨¡å—</li></ul><p><br><br><br></p><h4 id="transpiledmodule"><a href="#transpiledmodule" class="headerlink" title="TranspiledModule"></a>TranspiledModule</h4><p>TranspiledModuleç”¨äºç®¡ç†æŸä¸ªå…·ä½“çš„æ¨¡å—ï¼Œè¿™é‡Œé¢ä¼šç»´æŠ¤è½¬è¯‘å’Œè¿è¡Œçš„ç»“æœã€æ¨¡å—çš„ä¾èµ–ä¿¡æ¯ï¼Œå¹¶é©±åŠ¨æ¨¡å—çš„è½¬è¯‘å’Œæ‰§è¡Œï¼š</p><center><br> <img src="/images/08/transpiled-module.png"><br></center><p>TranspiledModule ä¼šä»Presetä¸­è·å–åŒ¹é…å½“å‰æ¨¡å—çš„Transpileråˆ—è¡¨çš„ï¼Œéå†Transpilerå¯¹æºä»£ç è¿›è¡Œè½¬è¯‘ï¼Œè½¬è¯‘çš„è¿‡ç¨‹ä¸­ä¼šè§£æASTï¼Œåˆ†ææ¨¡å—å¯¼å…¥è¯­å¥, æ”¶é›†æ–°çš„ä¾èµ–; å½“æ¨¡å—è½¬è¯‘å®Œæˆåï¼Œä¼šé€’å½’è½¬è¯‘ä¾èµ–åˆ—è¡¨ã€‚ æ¥çœ‹çœ‹å¤§æ¦‚çš„ä»£ç ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> transpile(manager: Manager) &#123;</span><br><span class="line">  <span class="comment">// å·²è½¬è¯‘</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.source)  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  <span class="comment">// é¿å…é‡å¤è½¬è¯‘, ä¸€ä¸ªæ¨¡å—åªè½¬è¯‘ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">if</span> (manager.transpileJobs[<span class="keyword">this</span>.getId()]) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  manager.transpileJobs[<span class="keyword">this</span>.getId()] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...é‡ç½®çŠ¶æ€ </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ä»Presetè·å–Transpileråˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> transpilers = manager.preset.getLoaders(<span class="keyword">this</span>.module, <span class="keyword">this</span>.query);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ é“¾å¼è°ƒç”¨Transpiler</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; transpilers.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> transpilerConfig = transpilers[i];</span><br><span class="line">    <span class="comment">// ğŸ”´æ„å»ºLoaderContextï¼Œè§ä¸‹æ–‡</span></span><br><span class="line">    <span class="keyword">const</span> loaderContext = <span class="keyword">this</span>.getLoaderContext(</span><br><span class="line">      manager,</span><br><span class="line">      transpilerConfig.options || &#123;&#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”´è°ƒç”¨Transpilerè½¬è¯‘æºä»£ç </span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      transpiledCode,</span><br><span class="line">      sourceMap,</span><br><span class="line">    &#125; = <span class="keyword">await</span> transpilerConfig.transpiler.transpile(code, loaderContext); <span class="comment">// eslint-disable-line no-await-in-loop</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.errors.length) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">this</span>.errors[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.logWarnings();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">    <span class="keyword">this</span>.asyncDependencies.map(<span class="keyword">async</span> p =&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tModule = <span class="keyword">await</span> p;</span><br><span class="line">        <span class="keyword">this</span>.dependencies.add(tModule);</span><br><span class="line">        tModule.initiators.add(<span class="keyword">this</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">/* let this handle at evaluation */</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">this</span>.asyncDependencies = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´é€’å½’è½¬è¯‘ä¾èµ–çš„æ¨¡å—</span></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">    flattenDeep([</span><br><span class="line">      ...Array.from(<span class="keyword">this</span>.transpilationInitiators).map(<span class="function"><span class="params">t</span> =&gt;</span></span><br><span class="line">        t.transpile(manager)</span><br><span class="line">      ),</span><br><span class="line">      ...Array.from(<span class="keyword">this</span>.dependencies).map(<span class="function"><span class="params">t</span> =&gt;</span> t.transpile(manager)),</span><br><span class="line">    ])</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h4 id="transpiler"><a href="#transpiler" class="headerlink" title="Transpiler"></a>Transpiler</h4><p>Transpilerç­‰ä»·äºwebpackçš„loaderï¼Œå®ƒé…ç½®æ–¹å¼ä»¥åŠåŸºæœ¬APIä¹Ÿå’Œwebpack(æŸ¥çœ‹<a href="https://webpack.docschina.org/api/loaders/" target="_blank" rel="noopener">webpackçš„loader API</a>)å¤§æ¦‚ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚é“¾å¼è½¬è¯‘å’Œloader-context. æ¥çœ‹ä¸€ä¸‹Transpilerçš„åŸºæœ¬å®šä¹‰ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">abstract</span> <span class="keyword">class</span> Transpiler &#123;</span><br><span class="line">  initialize() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  dispose() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  cleanModule(loaderContext: LoaderContext) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ ä»£ç è½¬æ¢</span></span><br><span class="line">  transpile(</span><br><span class="line">    code: <span class="built_in">string</span>,</span><br><span class="line">    loaderContext: LoaderContext</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;TranspilerResult&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.doTranspilation(code, loaderContext);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ æŠ½è±¡æ–¹æ³•ï¼Œç”±å…·ä½“å­ç±»å®ç°</span></span><br><span class="line">  <span class="keyword">abstract</span> doTranspilation(</span><br><span class="line">    code: <span class="built_in">string</span>,</span><br><span class="line">    loaderContext: LoaderContext</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;TranspilerResult&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Transpilerçš„æ¥å£å¾ˆç®€å•ï¼Œ<code>transpile</code>æ¥å—ä¸¤ä¸ªå‚æ•°: </p><ul><li><code>code</code>å³æºä»£ç .</li><li><p><code>loaderContext</code> ç”±TranspiledModuleæä¾›, å¯ä»¥ç”¨æ¥è®¿é—®ä¸€ä¸‹è½¬è¯‘ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚Transpilerçš„é…ç½®ã€ æ¨¡å—æŸ¥æ‰¾ã€æ³¨å†Œä¾èµ–ç­‰ç­‰ã€‚å¤§æ¦‚å¤–å½¢å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LoaderContext = &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´ ä¿¡æ¯æŠ¥å‘Š</span></span><br><span class="line">  emitWarning: <span class="function">(<span class="params">warning: WarningStructure</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  emitError: <span class="function">(<span class="params">error: <span class="built_in">Error</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  emitModule: <span class="function">(<span class="params">title: <span class="built_in">string</span>, code: <span class="built_in">string</span>, currentPath?: <span class="built_in">string</span>, overwrite?: <span class="built_in">boolean</span>, isChild?: <span class="built_in">boolean</span></span>) =&gt;</span> TranspiledModule;</span><br><span class="line">  emitFile: <span class="function">(<span class="params">name: <span class="built_in">string</span>, content: <span class="built_in">string</span>, sourceMap: SourceMap</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// ğŸ”´ é…ç½®ä¿¡æ¯</span></span><br><span class="line">  options: &#123;</span><br><span class="line">    context: <span class="built_in">string</span>;</span><br><span class="line">    config?: object;</span><br><span class="line">    [key: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  sourceMap: <span class="built_in">boolean</span>;</span><br><span class="line">  target: <span class="built_in">string</span>;</span><br><span class="line">  path: <span class="built_in">string</span>;</span><br><span class="line">  addTranspilationDependency: <span class="function">(<span class="params">depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; isEntry?: <span class="built_in">boolean</span>; &#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  resolveTranspiledModule: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; ignoredExtensions?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;; &#125;</span>) =&gt;</span> TranspiledModule;</span><br><span class="line">  resolveTranspiledModuleAsync: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; ignoredExtensions?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;; &#125;</span>) =&gt;</span> <span class="built_in">Promise</span>&lt;TranspiledModule&gt;;</span><br><span class="line">   <span class="comment">// ğŸ”´ ä¾èµ–æ”¶é›†</span></span><br><span class="line">  addDependency: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; isEntry?: <span class="built_in">boolean</span>; &#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  addDependenciesInDirectory: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; isEntry?: <span class="built_in">boolean</span>; &#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  _module: TranspiledModule;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><p><br><br><br></p><p>å…ˆä»ç®€å•çš„å¼€å§‹ï¼Œæ¥çœ‹çœ‹JSONæ¨¡å—çš„Transpilerå®ç°, æ¯ä¸ªTranspilerå­ç±»éœ€è¦å®ç°doTranspilationï¼Œæ¥æ”¶æºä»£ç ï¼Œå¹¶å¼‚æ­¥è¿”å›å¤„ç†ç»“æœï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> JSONTranspiler <span class="keyword">extends</span> Transpiler &#123;</span><br><span class="line">  doTranspilation(code: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="string">`</span></span><br><span class="line"><span class="string">      module.exports = JSON.parse(<span class="subst">$&#123;JSON.stringify(code || '')&#125;</span>)</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(&#123;</span><br><span class="line">      transpiledCode: result,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h4 id="babeltranspiler"><a href="#babeltranspiler" class="headerlink" title="BabelTranspiler"></a>BabelTranspiler</h4><p>å¹¶ä¸æ˜¯æ‰€æœ‰æ¨¡å—éƒ½åƒJSONè¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚Typescriptå’ŒBabelã€‚ ä¸ºäº†æé«˜è½¬è¯‘çš„æ•ˆç‡ï¼ŒCodesandboxä¼šåˆ©ç”¨Workeræ¥è¿›è¡Œå¤šè¿›ç¨‹è½¬è¯‘ï¼Œå¤šWorkerçš„è°ƒåº¦å·¥ä½œç”±<code>WorkerTranspiler</code>å®Œæˆï¼Œè¿™æ˜¯Transpilerçš„å­ç±»ï¼Œç»´æŠ¤äº†ä¸€ä¸ªWorkeræ± ã€‚Babelã€Typescriptã€Sassè¿™ç±»å¤æ‚çš„è½¬è¯‘ä»»åŠ¡éƒ½æ˜¯åŸºäºWorkerTranspilerå®ç°çš„ï¼š</p><center><br> <img src="/images/08/transpiler.png"><br></center><p><br></p><p>å…¶ä¸­æ¯”è¾ƒå…¸å‹çš„å®ç°æ˜¯BabelTranspiler, åœ¨Sandboxå¯åŠ¨æ—¶å°±ä¼šé¢„å…ˆforkä¸‰ä¸ªworkerï¼Œæ¥æé«˜è½¬è¯‘å¯åŠ¨çš„é€Ÿåº¦, BabelTranspilerä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸‰ä¸ªworkeræ¥åˆå§‹åŒ–Workeræ± ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨worker-loader forkä¸‰ä¸ªloaderï¼Œç”¨äºå¤„ç†babelç¼–è¯‘</span></span><br><span class="line"><span class="keyword">import</span> BabelWorker <span class="keyword">from</span> <span class="string">'worker-loader?publicPath=/&amp;name=babel-transpiler.[hash:8].worker.js!./eval/transpilers/babel/worker/index.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.babelworkers = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">window</span>.babelworkers.push(<span class="keyword">new</span> BabelWorker());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿™é‡Œé¢ä½¿ç”¨åˆ°äº†webpackçš„<a href="https://github.com/webpack-contrib/worker-loader" target="_blank" rel="noopener">worker-loader</a>, å°†æŒ‡å®šæ¨¡å—å°è£…ä¸º Worker å¯¹è±¡ã€‚è®© Worker æ›´å®¹æ˜“ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> Worker <span class="keyword">from</span> <span class="string">"./file.worker.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> Worker();</span><br><span class="line"></span><br><span class="line">worker.postMessage(&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;);</span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">worker.addEventListener(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>BabelTranpilerå…·ä½“çš„æµç¨‹å¦‚ä¸‹:</p><center><br><img src="/images/08/babel-transpiler.png"><br></center><p>WorkerTranspilerä¼šç»´æŠ¤<code>ç©ºé—²çš„Workeré˜Ÿåˆ—</code>å’Œä¸€ä¸ª<code>ä»»åŠ¡é˜Ÿåˆ—</code>, å®ƒçš„å·¥ä½œå°±æ˜¯é©±åŠ¨Workeræ¥æ¶ˆè´¹ä»»åŠ¡é˜Ÿåˆ—ã€‚å…·ä½“çš„è½¬è¯‘å·¥ä½œåœ¨Workerä¸­è¿›è¡Œï¼š</p><center><br><img src="/images/08/babel-worker.png"><br></center><p><br></p><hr><p><br></p><h3 id="evaluation"><a href="#evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h3><p>è™½ç„¶ç§°ä¸ºæ‰“åŒ…å™¨(bundler), ä½†æ˜¯ CodeSandbox å¹¶ä¸ä¼šè¿›è¡Œæ‰“åŒ…ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä¸ä¼šåƒ Webpack ä¸€æ ·ï¼Œå°†æ‰€æœ‰çš„æ¨¡å—éƒ½æ‰“åŒ…åˆå¹¶æˆ chunks æ–‡ä»¶.</p><p><code>Transpilation</code>ä»<code>å…¥å£æ–‡ä»¶</code>å¼€å§‹è½¬è¯‘, å†åˆ†ææ–‡ä»¶çš„æ¨¡å—å¯¼å…¥è§„åˆ™ï¼Œé€’å½’è½¬è¯‘ä¾èµ–çš„æ¨¡å—. åˆ°<code>Evaluation</code>é˜¶æ®µï¼ŒCodeSandbox å·²ç»æ„å»ºå‡ºäº†ä¸€ä¸ªå®Œæ•´çš„<strong>ä¾èµ–å›¾</strong>. ç°åœ¨è¦æŠŠåº”ç”¨è·‘èµ·æ¥äº†ğŸƒ</p><p><img src="/images/08/dependency-graph.png" alt></p><p>Evaluation çš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå’Œ Transpilation ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä»å…¥å£æ–‡ä»¶å¼€å§‹: <strong>ä½¿ç”¨<code>eval</code>æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨äº†<code>require</code>ï¼Œåˆ™é€’å½’ eval è¢«ä¾èµ–çš„æ¨¡å—</strong>ã€‚</p><p>å¦‚æœä½ äº†è§£è¿‡ Node çš„æ¨¡å—å¯¼å…¥åŸç†ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="/images/08/evaluation.png" alt></p><ul><li>â‘  é¦–å…ˆè¦åˆå§‹åŒ– htmlï¼Œæ‰¾åˆ°<code>index.html</code>æ–‡ä»¶ï¼Œå°† document.body.innerHTML è®¾ç½®ä¸º html æ¨¡æ¿çš„ body å†…å®¹.</li><li>â‘¡ æ³¨å…¥å¤–éƒ¨èµ„æºã€‚ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ä¸€äº›å¤–éƒ¨é™æ€æ–‡ä»¶ï¼Œä¾‹å¦‚ css å’Œ jsï¼Œè¿™äº›éœ€è¦ append åˆ° head ä¸­</li><li>â‘¢ evaluate å…¥å£æ¨¡å—</li><li><p>â‘£ æ‰€æœ‰æ¨¡å—éƒ½ä¼šè¢«è½¬è¯‘æˆ CommonJS æ¨¡å—è§„èŒƒã€‚æ‰€ä»¥éœ€è¦æ¨¡æ‹Ÿè¿™ä¸ªæ¨¡å—ç¯å¢ƒã€‚å¤§æ¦‚çœ‹ä¸€ä¸‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°requireæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path: string</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... æ‹¦æˆªä¸€äº›ç‰¹æ®Šæ¨¡å—</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨Managerå¯¹è±¡ä¸­æŸ¥æ‰¾æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> requiredTranspiledModule = manager.resolveTranspiledModule(</span><br><span class="line">    path,</span><br><span class="line">    localModule.path</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¨¡å—ç¼“å­˜, å¦‚æœå­˜åœ¨ç¼“å­˜åˆ™è¯´æ˜ä¸éœ€è¦é‡æ–°æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">const</span> cache = requiredTranspiledModule.compilation;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> cache</span><br><span class="line">    ? cache.exports</span><br><span class="line">    : <span class="comment">// ğŸ”´é€’å½’evaluate</span></span><br><span class="line">      manager.evaluateTranspiledModule(</span><br><span class="line">        requiredTranspiledModule,</span><br><span class="line">        transpiledModule</span><br><span class="line">      );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°require.resolve</span></span><br><span class="line"><span class="built_in">require</span>.resolve = <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">path: string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> manager.resolveModule(path, localModule.path).path;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿä¸€äº›å…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> globals = &#123;&#125;;</span><br><span class="line">globals.__dirname = pathUtils.dirname(<span class="keyword">this</span>.module.path);</span><br><span class="line">globals.__filename = <span class="keyword">this</span>.module.path;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´æ”¾ç½®æ‰§è¡Œç»“æœï¼Œå³CommonJSçš„moduleå¯¹è±¡</span></span><br><span class="line"><span class="keyword">this</span>.compilation = &#123;</span><br><span class="line">  id: <span class="keyword">this</span>.getId(),</span><br><span class="line">  exports: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´eval</span></span><br><span class="line"><span class="keyword">const</span> exports = evaluate(</span><br><span class="line">  <span class="keyword">this</span>.source.compiledCode,</span><br><span class="line">  <span class="built_in">require</span>,</span><br><span class="line">  <span class="keyword">this</span>.compilation,</span><br><span class="line">  manager.envVariables,</span><br><span class="line">  globals</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>â‘¤ ä½¿ç”¨ eval æ¥æ‰§è¡Œæ¨¡å—ã€‚åŒæ ·çœ‹çœ‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">code, require, module, env = &#123;&#125;, globals = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> exports = <span class="built_in">module</span>.exports;</span><br><span class="line">  <span class="keyword">const</span> global = g;</span><br><span class="line">  <span class="keyword">const</span> process = buildProcess(env);</span><br><span class="line">  g.global = global;</span><br><span class="line">  <span class="keyword">const</span> allGlobals = &#123;</span><br><span class="line">    <span class="built_in">require</span>,</span><br><span class="line">    <span class="built_in">module</span>,</span><br><span class="line">    exports,</span><br><span class="line">    process,</span><br><span class="line">    setImmediate: requestFrame,</span><br><span class="line">    global,</span><br><span class="line">    ...globals</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> allGlobalKeys = <span class="built_in">Object</span>.keys(allGlobals);</span><br><span class="line">  <span class="keyword">const</span> globalsCode = allGlobalKeys.length ? allGlobalKeys.join(<span class="string">", "</span>) : <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">const</span> globalsValues = allGlobalKeys.map(<span class="function"><span class="params">k</span> =&gt;</span> allGlobals[k]);</span><br><span class="line">  <span class="comment">// ğŸ”´å°†ä»£ç å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸‹é¢ï¼Œå…¨å±€å˜é‡ä»¥å‡½æ•°å½¢å¼ä¼ å…¥</span></span><br><span class="line">  <span class="keyword">const</span> newCode = <span class="string">`(function evaluate(`</span> + globalsCode + <span class="string">`) &#123;`</span> + code + <span class="string">`\n&#125;)`</span>;</span><br><span class="line">  (<span class="number">0</span>, <span class="built_in">eval</span>)(newCode).apply(<span class="keyword">this</span>, globalsValues);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>Okï¼åˆ°è¿™é‡Œ Evaluation å°±è§£é‡Šå®Œäº†ï¼Œå®é™…çš„ä»£ç æ¯”è¿™é‡Œè¦å¤æ‚å¾—å¤šï¼Œæ¯”å¦‚ HMR(hot module replacement)æ”¯æŒ, æœ‰å…´è¶£çš„è¯»è€…ï¼Œå¯ä»¥è‡ªå·±å»çœ‹ CodeSandbox çš„æºç .</p><p><br></p><hr><p><br></p><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><p>ä¸€ä¸å°å¿ƒåˆå†™äº†ä¸€ç¯‡é•¿æ–‡ï¼Œè¦æŠŠè¿™ä¹ˆå¤æ‚ä»£ç è®²æ¸…æ¥šçœŸæ˜¯ä¸€ä¸ªæŒ‘æˆ˜, æˆ‘è¿˜åšçš„ä¸å¤Ÿå¥½ï¼ŒæŒ‰ç…§ä»¥å¾€çš„ç»éªŒï¼Œè¿™åˆæ˜¯ä¸€ç¯‡æ— äººé—®æ´¥çš„æ–‡ç« , åˆ«è¯´æ˜¯ä½ ä»¬, æˆ‘è‡ªå·±éƒ½ä¸æ€ä¹ˆæœ‰è€å¿ƒçœ‹è¿™ç±»æ–‡ç« , åé¢è¿˜æ˜¯å°½é‡é¿å…å§!</p><ul><li>worker-loader: å°†æŒ‡å®šæ¨¡å—å°è£…ä¸ºWorker</li><li>babel: JavaScriptä»£ç è½¬è¯‘ï¼Œæ”¯æŒES, Flow, Typescript</li><li>browserfs: åœ¨æµè§ˆå™¨ä¸­æ¨¡æ‹ŸNodeç¯å¢ƒ</li><li>localForage: å®¢æˆ·ç«¯å­˜å‚¨åº“ï¼Œä¼˜å…ˆä½¿ç”¨(IndexedDB or WebSQL)è¿™äº›å¼‚æ­¥å­˜å‚¨æ–¹æ¡ˆï¼Œæä¾›ç±»LocalStorageçš„æ¥å£</li><li>lru-cache: least-recently-usedç¼“å­˜</li></ul><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://hackernoon.com/how-i-created-a-parallel-offline-extensible-browser-based-bundler-886db508cc31" target="_blank" rel="noopener">Creating a parallel, offline, extensible, browser based bundler for CodeSandbox</a></li><li><a href="https://www.youtube.com/watch?v=qURPenhndYA" target="_blank" rel="noopener">year of CodeSandbox - Ives van Hoorne aka @CompuIves at @ReactEurope 2018</a></li><li><a href="https://hackernoon.com/how-we-make-npm-packages-work-in-the-browser-announcing-the-new-packager-6ce16aa4cee6" target="_blank" rel="noopener">How we make npm packages work in the browser</a></li><li><a href="https://github.com/codesandbox/dependency-packager" target="_blank" rel="noopener">codesandbox/dependency-packager</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æœŸæ¥å…³æ³¨ä¸€ä¸‹&lt;a href=&quot;https://codesandbox.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;CodeSandbox&lt;/code&gt;&lt;/a&gt;, è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„æ²™ç›’è¿è¡Œç¯å¢ƒï¼Œæ”¯æŒå¤šç§æµè¡Œçš„æ„å»ºæ¨¡æ¿ï¼Œä¾‹å¦‚ &lt;code
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactæ€§èƒ½æµ‹é‡å’Œåˆ†æ</title>
    <link href="https://bobi.ink/2019/06/16/react-performance-analyze/"/>
    <id>https://bobi.ink/2019/06/16/react-performance-analyze/</id>
    <published>2019-06-15T16:00:00.000Z</published>
    <updated>2019-06-16T23:00:08.422Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡<a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">æ–‡ç« </a>è®²äº† React æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ–¹å‘å’Œæ‰‹æ®µï¼Œè¿™ç¯‡æ–‡ç« å†è¡¥å……è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œæ€§èƒ½æµ‹é‡å’Œåˆ†æ, ä»‹ç» React æ€§èƒ½åˆ†æçš„ä¸€äº›å·¥å…·å’Œæ–¹æ³•.</p><p>è¿›è¡Œä»»ä½•æ€§èƒ½ä¼˜åŒ–çš„å‰ææ˜¯ä½ è¦æ‰¾å‡ºâ€™æ€§èƒ½é—®é¢˜â€˜ï¼Œè¿™æ ·æ‰èƒ½é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ã€‚æˆ‘è§‰å¾—å¯¹äº React çš„æ€§èƒ½ä¼˜åŒ–å¯ä»¥åˆ†ä¸¤ä¸ªé˜¶æ®µ:</p><ul><li><p><strong>1. åˆ†æé˜¶æ®µ</strong></p><ul><li>é€šè¿‡åˆ†æå™¨(Profiler)æ‰¾å‡ºé‡æ–°æ¸²æŸ“çš„ç»„ä»¶ã€é‡æ–°æ¸²æŸ“çš„æ¬¡æ•°ã€ä»¥åŠé‡æ–°æ¸²æŸ“è€—è´¹çš„èµ„æºä¸æ—¶é—´</li><li>å˜åŠ¨æ£€æµ‹. é€šè¿‡åˆ†æå™¨æˆ‘ä»¬å¯ä»¥çŸ¥é“â€™ä»€ä¹ˆè¢«é‡æ–°æ¸²æŸ“, é‡æ–°æ¸²æŸ“çš„ä»£ä»·â€™ï¼Œé‚£ä¹ˆå˜åŠ¨æ£€æµ‹å›ç­”çš„é—®é¢˜å°±æ˜¯ï¼š â€™ä¸ºä»€ä¹ˆè¿™äº›è¿›è¡Œäº†é‡æ–°æ¸²æŸ“?â€™</li></ul></li><li><p><strong>2. ä¼˜åŒ–é˜¶æ®µ</strong>. ä¼˜åŒ–é˜¶æ®µæˆ‘ä»¬é’ˆå¯¹åˆ†æé˜¶æ®µæŠ›å‡ºçš„é—®é¢˜è¿›è¡Œè§£å†³ï¼Œè§£å†³çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡çš„å§Šå¦¹ç¯‡&lt;<a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a>&gt;</p></li></ul><p><br></p><p><strong>æœ¬æ–‡å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#åˆ†æå™¨">åˆ†æå™¨</a><ul><li><a href="#react-devtool">React Devtool</a><ul><li><a href="#é«˜äº®æ›´æ–°">é«˜äº®æ›´æ–°</a></li><li><a href="#åˆ†æå™¨-1">åˆ†æå™¨</a></li></ul></li><li><a href="#chrome-performance-å·¥å…·">Chrome Performance å·¥å…·</a></li><li><a href="#å…¶ä»–å·¥å…·">å…¶ä»–å·¥å…·</a></li></ul></li><li><a href="#å˜åŠ¨æ£€æµ‹">å˜åŠ¨æ£€æµ‹</a><ul><li><a href="#props-å˜åŠ¨æ£€æµ‹">props å˜åŠ¨æ£€æµ‹</a></li><li><a href="#mobx-å˜åŠ¨æ£€æµ‹">mobx å˜åŠ¨æ£€æµ‹</a></li><li><a href="#context-å˜æ›´æ£€æµ‹">Context å˜æ›´æ£€æµ‹</a></li><li><a href="#react-devtool-çš„-interactions">React Devtool çš„ Interactions</a></li></ul></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><p>ä¸‹é¢æœ¬æ–‡æµ‹è¯•çš„æ ·æ¿ä»£ç .</p><blockquote><p>æ¨èç‚¹å‡» Preview é¢æ¿çš„<code>Open In New Window</code>, æˆ–è€…ç›´æ¥ç‚¹å‡»è¯¥<a href="https://igz9h.codesandbox.io/" target="_blank" rel="noopener">é“¾æ¥</a>ï¼Œåœ¨çº¿åŠ¨æ‰‹å®è·µ</p></blockquote><iframe src="https://codesandbox.io/embed/react-performance-analyze-demo-igz9h?autoresize=1&fontsize=14" title="React-Performance-Analyze-Demo" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><a href="https://codesandbox.io/s/react-performance-analyze-demo-igz9h?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit React-Performance-Analyze-Demo"></a></p><p><br><br><br></p><h2 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h2><p>åˆ†æå“ªäº›ç»„ä»¶è¿›è¡Œäº†æ¸²æŸ“ï¼Œä»¥åŠæ¸²æŸ“æ¶ˆè€—çš„æ—¶é—´ä»¥åŠèµ„æºã€‚ä¸»è¦å·¥å…·æœ‰ React å®˜æ–¹çš„å¼€å‘è€…å·¥å…·ä»¥åŠ Chrome çš„ Performance å·¥å…·ã€‚</p><h3 id="react-devtool"><a href="#react-devtool" class="headerlink" title="React Devtool"></a>React Devtool</h3><p>æœ€å…ˆåº”è¯¥ä½¿ç”¨çš„è‚¯å®šæ˜¯å®˜æ–¹æä¾›çš„å¼€å‘è€…å·¥å…·ï¼ŒReact v16.5 å¼•å…¥äº†æ–°çš„ Profiler åŠŸèƒ½ï¼Œè®©åˆ†æç»„ä»¶æ¸²æŸ“è¿‡ç¨‹å˜å¾—æ›´åŠ ç®€å•ï¼Œè€Œä¸”å¯ä»¥å¾ˆç›´è§‚åœ°æŸ¥çœ‹å“ªäº›ç»„ä»¶è¢«æ¸²æŸ“.</p><h4 id="é«˜äº®æ›´æ–°"><a href="#é«˜äº®æ›´æ–°" class="headerlink" title="é«˜äº®æ›´æ–°"></a>é«˜äº®æ›´æ–°</h4><p><strong>é¦–å…ˆæœ€ç®€å•ä¹Ÿæ˜¯æœ€æ–¹ä¾¿çš„åˆ¤æ–­ç»„ä»¶æ˜¯å¦è¢«é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ˜¯â€™é«˜äº®æ›´æ–°(Hightlight Updates)â€™</strong>.</p><p>â‘  å¼€å¯é«˜äº®æ›´æ–°:</p><center><br> <img src="/images/10/hightlight-update.png"><br></center><p>â‘¡ è¿è¡Œæ•ˆæœå¦‚ä¸‹:</p><center><br>  <img src="/images/10/hightlight-update.gif"><br></center><p>â‘¢ é€šè¿‡é«˜äº®æ›´æ–°ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šå“ªäº›ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“. æ‰€ä»¥ç°åœ¨æˆ‘ä»¬ç»™ ListItem åŠ ä¸Š React.memo(æŸ¥çœ‹ PureList ç¤ºä¾‹), çœ‹ä¸€ä¸‹æ•ˆæœ:</p><center><br> <img src="/images/10/hightlight-update-pure.gif"><br></center><p>æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œç°åœ¨åªæœ‰é€’å¢çš„ ListItem ä¼šè¢«æ›´æ–°ï¼Œè€Œä¸”å½“æ•°ç»„æ’åºæ—¶åªæœ‰ List ç»„ä»¶ä¼šè¢«åˆ·æ–°. æ‰€ä»¥è¯´â€˜çº¯ç»„ä»¶â€™æ˜¯ React ä¼˜åŒ–çš„ç¬¬ä¸€å¼ ç‰Œ, ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„ä¸€å¼ ç‰Œ.</p><p><br><br><br></p><h4 id="åˆ†æå™¨-1"><a href="#åˆ†æå™¨-1" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h4><p>å¦‚æœ<code>é«˜äº®æ›´æ–°</code>æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæ¯”å¦‚<strong>ä½ éœ€è¦çŸ¥é“å…·ä½“å“ªäº›ç»„ä»¶è¢«æ¸²æŸ“ã€æ¸²æŸ“æ¶ˆè€—å¤šå°‘æ—¶é—´ã€è¿›è¡Œäº†å¤šå°‘æ¬¡çš„æäº¤(æ¸²æŸ“)ç­‰ç­‰</strong>, è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°åˆ†æå™¨äº†.</p><p>â‘  é¦–å…ˆé€‰æ‹©éœ€è¦æ”¶é›†æµ‹é‡ä¿¡æ¯çš„èŠ‚ç‚¹(ä¸€èˆ¬é»˜è®¤é€‰ä¸­æ ¹èŠ‚ç‚¹ï¼Œæœ‰ä¸€äº›åº”ç”¨å¯èƒ½å­˜åœ¨å¤šä¸ªç»„ä»¶æ ‘ï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨é€‰æ‹©):</p><center><br> <img src="/images/10/select-profile.png"><br></center><p>â‘¡ Okï¼Œç‚¹å‡» Record å¼€å§‹æµ‹é‡</p><center><br> <img src="/images/10/start-record.gif"><br></center><p><br></p><p>â‘¢ çœ‹çœ‹æµ‹é‡çš„ç»“æœï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹ Profiler é¢æ¿çš„åŸºæœ¬ç»“æ„:</p><center><br> <img src="/images/10/profile-outline.png"><br></center><ul><li><p><strong>1ï¸âƒ£ è¿™æ˜¯ä¸€ä¸ª commit åˆ—è¡¨</strong>ã€‚commit åˆ—è¡¨è¡¨ç¤ºå½•åˆ¶æœŸé—´å‘ç”Ÿçš„ commit(å¯ä»¥è®¤ä¸ºæ˜¯æ¸²æŸ“) æ“ä½œï¼Œè¦ç†è§£ commit çš„æ„æ€è¿˜éœ€è¦äº†è§£ React æ¸²æŸ“çš„åŸºæœ¬åŸç†.</p><p>åœ¨ v16 å React ç»„ä»¶æ¸²æŸ“ä¼šåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œå³ render å’Œ commit é˜¶æ®µã€‚</p><ul><li><strong>render é˜¶æ®µå†³å®šéœ€è¦è¿›è¡Œå“ªäº›å˜æ›´ï¼Œæ¯”å¦‚ DOM</strong>ã€‚é¡¾åæ€ä¹‰, è¿™ä¸ªé˜¶æ®µ React ä¼šè°ƒç”¨ render å‡½æ•°ï¼Œå¹¶å°†ç»“æœå’Œä¸Šä¸€æ¬¡ render çš„ç»“æœè¿›è¡Œ diff, è®¡ç®—å‡ºéœ€è¦è¿›è¡Œå˜æ›´çš„æ“ä½œé˜Ÿåˆ—</li><li><strong>commit é˜¶æ®µ</strong>ã€‚æˆ–è€…ç§°ä¸ºæäº¤é˜¶æ®µ, åœ¨è¿™ä¸ªé˜¶æ®µä¼šæ‰§è¡Œ render é˜¶æ®µ diff å‡ºæ¥çš„å˜æ›´è¯·æ±‚ã€‚æ¯”å¦‚ DOM æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ã€æ’åºç­‰ç­‰ã€‚åœ¨è¿™ä¸ªé˜¶æ®µ React è¿˜ä¼šè°ƒç”¨ componentDidMount å’Œ componentDidUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°.</li></ul><p>åœ¨ v16 ä¹‹å‰ï¼Œæˆ–è€…åœ¨ Preact è¿™äº›â€™ç±» Reactâ€™ æ¡†æ¶ä¸­ï¼Œå¹¶ä¸åŒºåˆ† render é˜¶æ®µå’Œ commit é˜¶æ®µï¼Œä¹Ÿå°±è¯´è¿™ä¸¤ä¸ªé˜¶æ®µç³…åˆåœ¨ä¸€èµ·ï¼Œä¸€è¾¹ diff ä¸€è¾¹ commitã€‚æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹ç¬”è€…ä¹‹å‰å†™çš„<a href="https://juejin.im/post/5cfa29e151882539c33e4f5e" target="_blank" rel="noopener">ä» Preact ä¸­äº†è§£ç»„ä»¶å’Œ hooks åŸºæœ¬åŸç†</a><br><br></p><p>åˆ‡æ¢ commit:</p><p><img src="/images/10/profile-commit.gif" alt><br><br></p></li><li><p><strong>2ï¸âƒ£ é€‰æ‹©å…¶ä»–å›¾å½¢å±•ç¤ºå½¢å¼</strong>ï¼Œä¾‹å¦‚ <code>Ranked è§†å›¾</code>ï¼Œè¿™ä¸ªè§†å›¾æŒ‰ç…§æ¸²æŸ“æ¶ˆè€—æ—¶é—´å¯¹ç»„ä»¶è¿›è¡Œæ’åºï¼š</p><p><img src="/images/10/ranked.png" alt></p><p><br></p></li><li><p><strong>3ï¸âƒ£ ç«ç„°å›¾</strong> è¿™ä¸ªå›¾å…¶å®å°±æ˜¯<strong>ç»„ä»¶æ ‘</strong>ï¼ŒProfiler ä½¿ç”¨é¢œè‰²æ¥æ ‡è®°å“ªäº›ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“ã€‚<strong>å’Œ commit åˆ—è¡¨ä»¥åŠ Ranked å›¾ä¸€æ ·ï¼Œé¢œè‰²åœ¨è¿™é‡Œæ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ¯”å¦‚ç°è‰²è¡¨ç¤ºæ²¡æœ‰é‡æ–°æ¸²æŸ“ï¼›ä»æ¸²æŸ“æ¶ˆè€—çš„æ—¶é—´ä¸Šçœ‹çš„è¯: <code>é»‘è‰² &gt; é»„è‰² &gt; è“è‰²</code>, é€šè¿‡ ğŸ‘†Ranked å›¾å¯ä»¥ç›´è§‚æ„Ÿå—åˆ°ä¸åŒé¢œè‰²ä¹‹é—´çš„æ„ä¹‰</strong></p><p><img src="/images/10/profile-framegraph.gif" alt></p><p><br></p></li><li><p><strong>4ï¸âƒ£ å½“å‰é€‰ä¸­ç»„ä»¶æˆ–è€… Commit çš„è¯¦æƒ…</strong>, å¯ä»¥æŸ¥çœ‹è¯¥ç»„ä»¶æ¸²æŸ“æ—¶çš„ props å’Œ state</p><p><img src="/images/10/profile-props.gif" alt></p><p>åŒå‡»å…·ä½“ç»„ä»¶å¯ä»¥è¯¦ç»†æ¯”å¯¹æ¯ä¸€æ¬¡ commit æ¶ˆè€—çš„æ—¶é—´:</p><p><img src="/images/10/profile-component-detail.png" alt></p><p><br></p></li><li><p><strong>5ï¸âƒ£ è®¾ç½®</strong></p><p>å¦å¤–å¯ä»¥é€šè¿‡è®¾ç½®ï¼Œç­›é€‰ Commitï¼Œä»¥åŠæ˜¯å¦æ˜¾ç¤ºåŸç”Ÿå…ƒç´ :</p><p><img src="/images/10/profile-settings.png" alt></p></li></ul><p><br></p><p>â‘£ ç°åœ¨ä½¿ç”¨ Profiler æ¥åˆ†æä¸€ä¸‹ PureList çš„æ¸²æŸ“è¿‡ç¨‹:</p><p><img src="/images/10/profile-demo.png" alt></p><p><br></p><blockquote><p>å…³äº Profiler çš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™ç¯‡å®˜æ–¹åšå®¢&lt;<a href="https://zh-hans.reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html" target="_blank" rel="noopener">Introducing the React Profiler</a>&gt;</p></blockquote><p><br><br><br></p><h3 id="chrome-performance-å·¥å…·"><a href="#chrome-performance-å·¥å…·" class="headerlink" title="Chrome Performance å·¥å…·"></a>Chrome Performance å·¥å…·</h3><p>åœ¨ v16.5 ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯åˆ©ç”¨ Chrome è‡ªå¸¦çš„ Performance æ¥è¿›è¡Œ React æ€§èƒ½æµ‹é‡:</p><p><img src="/images/10/chrome-performance.png" alt></p><p><br></p><p>React ä½¿ç”¨æ ‡å‡†çš„<code>User Timing API</code>(æ‰€æœ‰æ”¯æŒè¯¥æ ‡å‡†çš„æµè§ˆå™¨éƒ½å¯ä»¥ç”¨æ¥åˆ†æ React)æ¥è®°å½•æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ Timings æ ‡ç­¾ä¸­æŸ¥çœ‹ React çš„æ¸²æŸ“è¿‡ç¨‹ã€‚React è¿˜ç‰¹æ„ä½¿ç”¨ emoji æ ‡è®°.</p><p>ç›¸å¯¹ React Devtool è€Œè¨€ Performance å·¥å…·å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œä½†æ˜¯å®ƒéå¸¸å¼ºå¤§ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ<strong>å¦‚æœè¯´ React-Devtool æ˜¯<a href="https://www.telerik.com/fiddler" target="_blank" rel="noopener">Fiddler</a>, é‚£ä¹ˆ Performance å°±æ˜¯<a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a>. ä½¿ç”¨ Performance å¯ä»¥ç”¨æ¥å®šä½ä¸€äº›æ¯”è¾ƒæ·±å±‚æ¬¡çš„é—®é¢˜ï¼Œè¿™å¯èƒ½éœ€è¦ä½ å¯¹ React çš„å®ç°åŸç†æœ‰ä¸€å®šäº†è§£, å°±åƒä½¿ç”¨ Wireshark ä½ éœ€è¦æ‡‚ç‚¹ç½‘ç»œåè®®ä¸€æ ·</strong></p><p>æ‰€ä»¥è¯´ä½¿ç”¨ Performance å·¥å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿:</p><ul><li>å¯ä»¥æµ‹é‡åˆ†ææ•´ä¸ªæ¸²æŸ“çš„è¿‡ç¨‹ç»†èŠ‚. å®ƒå¯ä»¥å®šä½æŸäº›å…·ä½“æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹å’Œæ¶ˆè€—, æ–¹ä¾¿å®šä½ä¸€äº›æ·±å±‚æ¬¡é—®é¢˜.</li><li>å¯ä»¥æµ‹é‡åˆ†æåº•å±‚ DOM çš„ç»˜åˆ¶ã€å¸ƒå±€ã€åˆæˆç­‰ç»†èŠ‚ã€‚æ–¹ä¾¿å®šä½æµè§ˆå™¨æ€§èƒ½é—®é¢˜</li></ul><p>å…¶å® Performance æ˜¯ä¸€ä¸ªé€šç”¨çš„æ€§èƒ½æ£€æµ‹å·¥å…·ï¼Œæ‰€ä»¥å…¶ç»†èŠ‚ä¸åœ¨æœ¬æ–‡è®¨è®ºè®¿é—®ã€‚ è¯¦ç»†å‚è€ƒ</p><ul><li><a href="https://calibreapp.com/blog/react-performance-profiling-optimization/" target="_blank" rel="noopener">Profiling React performance with React 16 and Chrome Devtools</a></li><li><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/" target="_blank" rel="noopener">Chrome å®˜æ–¹çš„ Performance ä½¿ç”¨æ–‡æ¡£</a></li></ul><p><br></p><h3 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h3><p>ä¸Šé¢ä»‹ç»çš„è¿™äº›å·¥å…·åŸºæœ¬ä¸Šå·²ç»å¤Ÿç”¨äº†ã€‚ç¤¾åŒºä¸Šè¿˜æœ‰ä¸€äº›æ¯”è¾ƒæµè¡Œçš„å·¥å…·ï¼Œä¸è¿‡è¿™äº›å·¥å…·è¿Ÿæ—©/å·²ç»è¦è¢«å®˜æ–¹å–ä»£(æ‹›å®‰)ï¼Œè€Œä¸”å®ƒä»¬ä¹Ÿè·Ÿä¸ä¸Š React çš„æ›´æ–°ã€‚</p><ul><li><a href="https://reactjs.org/docs/perf.html" target="_blank" rel="noopener">react-addons-perf</a> React v16 ä¸æ”¯æŒäº†ï¼Œä¸è¯´äº†ã€‚è€ç‰ˆæœ¬å¯ç”¨</li><li><a href="https://github.com/nitin42/react-perf-devtool" target="_blank" rel="noopener">react-perf-devtool</a> ä¹Ÿä¸æ´»è·ƒäº†ï¼Œä¸æ¨èä½¿ç”¨</li></ul><p><br></p><hr><p><br></p><h2 id="å˜åŠ¨æ£€æµ‹"><a href="#å˜åŠ¨æ£€æµ‹" class="headerlink" title="å˜åŠ¨æ£€æµ‹"></a>å˜åŠ¨æ£€æµ‹</h2><p>OK, æˆ‘ä»¬é€šè¿‡åˆ†æå·¥å…·å·²ç»çŸ¥é“æˆ‘ä»¬çš„åº”ç”¨å­˜åœ¨å“ªäº›é—®é¢˜äº†ï¼Œè¯Šæ–­å‡ºäº†å“ªäº›ç»„ä»¶è¢«æ— æ„ä¹‰çš„æ¸²æŸ“ã€‚ä¸‹ä¸€æ­¥æ“ä½œå°±æ˜¯æ‰¾å‡ºç»„ä»¶é‡æ–°æ¸²æŸ“çš„å…ƒå‡¶, æ£€æµ‹ä¸ºä»€ä¹ˆç»„ä»¶è¿›è¡Œäº†æ›´æ–°.</p><p><strong>æˆ‘ä»¬å…ˆå‡è®¾æˆ‘ä»¬çš„ç»„ä»¶æ˜¯ä¸€ä¸ªâ€™çº¯ç»„ä»¶â€˜ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¤ä¸ºåªæœ‰ç»„ä»¶ä¾èµ–çš„çŠ¶æ€å˜æ›´æ—¶ï¼Œç»„ä»¶æ‰ä¼šé‡æ–°æ¸²æŸ“</strong>. éçº¯ç»„ä»¶æ²¡æœ‰è®¨è®ºçš„æ„ä¹‰ï¼Œå› ä¸ºåªè¦çŠ¶æ€å˜æ›´æˆ–çˆ¶çº§å˜æ›´ä»–éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚</p><p><strong>é‚£ä¹ˆå¯¹äºä¸€ä¸ªâ€™çº¯ç»„ä»¶â€˜æ¥è¯´ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸‹é¢è¿™äº›å› ç´ éƒ½å¯èƒ½å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>:</p><ul><li><strong>props + state</strong> æ¯«æ— ç–‘é—®. è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨<strong>æ¥æºäºå¤–éƒ¨çš„ props</strong>. å†…éƒ¨ state å˜åŠ¨ä¸€èˆ¬æ˜¯äººä¸ºè§¦å‘çš„ï¼Œæ¯”è¾ƒå®¹æ˜“å‘ç°</li><li><strong>Mobx observable value</strong>. å¦‚æœè®¿é—®äº† mobx ä¼ è¿›æ¥çš„å“åº”å¼æ•°æ®ï¼Œå°±ä¼šå»ºç«‹ä¸€ä¸ªçŠ¶æ€ä¾èµ–å…³ç³»ï¼Œè¿™ä¸ªç›¸å¯¹äº props å’Œ context æ¥è¯´æ˜¯éšå¼çš„ï¼Œæ£€æµ‹å®ƒçš„å˜åŠ¨æˆ‘ä»¬å¯èƒ½éœ€è¦åˆ©ç”¨ mobx æä¾›çš„ä¸€äº›å·¥å…·</li><li><strong>Context</strong>ã€‚ Context çš„ value çš„å˜æ›´ä¼šå¼ºåˆ¶é‡æ–°æ¸²æŸ“ç»„ä»¶</li></ul><p><br></p><h3 id="props-å˜åŠ¨æ£€æµ‹"><a href="#props-å˜åŠ¨æ£€æµ‹" class="headerlink" title="props å˜åŠ¨æ£€æµ‹"></a>props å˜åŠ¨æ£€æµ‹</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘å°±å»ºè®®ç®€åŒ– propsï¼Œç®€å•ç»„ä»¶çš„ props çš„å˜æ›´å¾ˆå®¹æ˜“é¢„æµ‹, ç”šè‡³ä½ è‚‰çœ¼éƒ½å¯ä»¥å¯Ÿè§‰å‡ºæ¥ã€‚å¦å¤–å¦‚æœä½ ä½¿ç”¨ Reduxï¼Œå¦‚æœä¸¥æ ¼æŒ‰ç…§ Redux çš„æœ€ä½³å®è·µï¼Œé…åˆ Redux çš„å¼€å‘è€…å·¥å…·ï¼Œä¹Ÿå¯ä»¥å¾ˆç›´è§‚åœ°åˆ¤æ–­å“ªäº›çŠ¶æ€å‘ç”Ÿäº†å˜æ›´ã€‚</p><p>å¦‚æœä½ æ²¡åŠæ³•æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå¯èƒ½å°±å¾—ä¾èµ–å·¥å…·äº†ã€‚ä¹‹å‰æœ‰ä¸€ä¸ª<a href="https://github.com/maicki/why-did-you-update" target="_blank" rel="noopener">why-did-you-update</a>çš„åº“ï¼Œ<strong>å¾ˆå¯æƒœç°åœ¨å·²ç»æ²¡æ€ä¹ˆç»´æŠ¤äº†(æ—§ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨å®ƒ)</strong>ã€‚è¿™ä¸ªåº“ä½¿ç”¨çŒ´è¡¥ä¸(monkey patches)æ¥æ‰©å±• Reactï¼Œæ¯”å¯¹æ£€æµ‹å“ªäº› props å’Œ state å‘ç”Ÿäº†å˜åŒ–ï¼š</p><p><img src="/images/10/wdyu.png" alt></p><p>åé¢ä¹Ÿæœ‰äººå€Ÿé‰´ why-did-you-update å†™äº†ä¸ª<a href="https://github.com/welldone-software/why-did-you-render" target="_blank" rel="noopener">why-did-you-render</a>. ä¸è¿‡ç¬”è€…è¿˜æ˜¯ä¸çœ‹å¥½è¿™äº›é€šè¿‡çŒ´è¡¥ä¸æ‰©å±• React çš„å®ç°ï¼Œä¾èµ–äº React çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ï¼Œè·Ÿä¸ä¸Š React æ›´æ–°åŸºæœ¬å°±åºŸäº†.</p><p>å¦‚æœä½ ç°åœ¨ä½¿ç”¨ hook çš„è¯ï¼Œè‡ªå·±æ‰‹å†™ä¸€ä¸ªä¹Ÿå¾ˆç®€å•, è¿™ä¸ª idea æ¥æºäº<a href="https://github.com/devhubapp/devhub/blob/master/packages/components/src/hooks/use-why-did-you-update.ts" target="_blank" rel="noopener">use-why-did-you-update</a>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useWhyDidYouUpdate</span>(<span class="params">name: <span class="built_in">string</span>, props: Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸ä¿å­˜ä¸Šä¸€ä¸ªprops</span></span><br><span class="line">  <span class="keyword">const</span> latestProps = useRef(props);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'development'</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> allKeys = <span class="built_in">Object</span>.keys(&#123; ...latestProps.current, ...props &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> changesObj: Record&lt;<span class="built_in">string</span>, &#123; <span class="keyword">from</span>: <span class="built_in">any</span>; to: <span class="built_in">any</span> &#125;&gt; = &#123;&#125;;</span><br><span class="line">    allKeys.forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (latestProps.current[key] !== props[key]) &#123;</span><br><span class="line">        changesObj[key] = &#123; <span class="keyword">from</span>: latestProps.current[key], to: props[key] &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(changesObj).length) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[why-did-you-update]'</span>, name, changesObj);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å…¶ä»–åŸå› å¯¼è‡´ç»„ä»¶æ¸²æŸ“</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    latestProps.current = props;</span><br><span class="line">  &#125;, <span class="built_in">Object</span>.values(props));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Counter = React.memo(props =&gt; &#123;</span><br><span class="line">  useWhyDidYouUpdate(&apos;Counter&apos;, props);</span><br><span class="line">  return &lt;div style=&#123;props.style&#125;&gt;&#123;props.count&#125;&lt;/div&gt;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œå¯ä»¥åœ¨<code>componentDidUpdate</code>ä½¿ç”¨ç±»ä¼¼ä¸Šé¢çš„æ–¹å¼æ¥æ¯”è¾ƒ props</p><p><br></p><h3 id="mobx-å˜åŠ¨æ£€æµ‹"><a href="#mobx-å˜åŠ¨æ£€æµ‹" class="headerlink" title="mobx å˜åŠ¨æ£€æµ‹"></a>mobx å˜åŠ¨æ£€æµ‹</h3><p>æ’é™¤äº† props å˜æ›´å¯¼è‡´çš„é‡æ–°æ¸²æŸ“ï¼Œç°åœ¨æ¥çœ‹çœ‹æ˜¯å¦æ˜¯ mobx å“åº”å¼æ•°æ®å¯¼è‡´çš„å˜æ›´. å¦‚æœä½ ä»¬å›¢é˜Ÿä¸ä½¿ç”¨ mobxï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚</p><p><strong>é¦–å…ˆä¸ç®¡æ˜¯ Redux å’Œ Mobxï¼Œæˆ‘ä»¬éƒ½åº”è¯¥è®©çŠ¶æ€çš„å˜åŠ¨å˜å¾—å¯é¢„æµ‹</strong>. å› ä¸º Mobx æ²¡æœ‰ Redux é‚£æ ·å›ºåŒ–çš„æ•°æ®å˜æ›´æ¨¡å¼ï¼ŒMobx å¹¶ä¸å®¹æ˜“è‡ªåŠ¨åŒ–åœ°ç›‘æµ‹æ•°æ®æ˜¯å¦‚ä½•è¢«å˜æ›´çš„ã€‚åœ¨ mobx ä¸­æˆ‘ä»¬ä½¿ç”¨<code>@action</code> æ¥æ ‡å¿—çŠ¶æ€çš„å˜æ›´æ“ä½œï¼Œä½†æ˜¯å®ƒæ‹¿å¼‚æ­¥æ“ä½œæ²¡åŠæ³•ã€‚å¥½åœ¨åé¢ mobx æ¨å‡ºäº† <code>flow</code> APIğŸ‘ã€‚</p><p>å¯¹äº Mobx é¦–å…ˆå»ºè®®å¼€å¯ä¸¥æ ¼æ¨¡å¼, è¦æ±‚æ‰€æœ‰æ•°æ®å˜æ›´éƒ½æ”¾åœ¨@action æˆ– flow ä¸­:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line">configure(&#123; <span class="attr">enforceActions</span>: <span class="string">'always'</span> &#125;);</span><br></pre></td></tr></table></figure><p>å®šä¹‰çŠ¶æ€å˜æ›´æ“ä½œ</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, action, flow &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterStore</span> </span>&#123;</span><br><span class="line">  @observable count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒæ­¥æ“ä½œ</span></span><br><span class="line">  @action(<span class="string">'increment count'</span>)</span><br><span class="line">  increment = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.count++;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼‚æ­¥æ“ä½œ</span></span><br><span class="line">  <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œç±»ä¼¼äºsagaçš„æœºåˆ¶</span></span><br><span class="line">  fetchCount = flow(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="keyword">yield</span> getCount();</span><br><span class="line">    <span class="keyword">this</span>.count = count;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ok æœ‰äº†ä¸Šé¢çš„çº¦å®šï¼Œç°åœ¨å¯ä»¥åœ¨æ§åˆ¶å°(é€šè¿‡ mobx-logger)æˆ–è€… <a href="https://github.com/mobxjs/mobx-devtools" target="_blank" rel="noopener">Mobx å¼€å‘è€…å·¥å…·</a>ä¸­è·Ÿè¸ª Mobx å“åº”å¼æ•°æ®çš„å˜åŠ¨äº†ã€‚</p><p><img src="/images/10/mobx-devtool.png" alt></p><p><br></p><p>å¦‚æœä¸æŒ‰ç…§è§„èŒƒæ¥ï¼Œå‡ºç°é—®é¢˜ä¼šæ¯”è¾ƒæµªè´¹æ—¶é—´, ä½†ä¹Ÿä¸æ˜¯æ²¡åŠæ³•è§£å†³ã€‚Mobx è¿˜æä¾›äº†ä¸€ä¸ª<a href="https://mobx.js.org/best/trace.html" target="_blank" rel="noopener">trace</a>å‡½æ•°, ç”¨æ¥æ£€æµ‹ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ SideEffect:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ListItem = observer(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; item, onShiftDown &#125; = props;</span><br><span class="line">  trace();</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"list-item"</span>&gt;</span>&#123;/*...*/&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœ(é€’å¢äº† value å€¼):</p><p><img src="/images/10/mobx-trace.png" alt="mobx-trace"></p><p><br></p><h3 id="context-å˜æ›´æ£€æµ‹"><a href="#context-å˜æ›´æ£€æµ‹" class="headerlink" title="Context å˜æ›´æ£€æµ‹"></a>Context å˜æ›´æ£€æµ‹</h3><p>Ok, å¦‚æœæ’é™¤äº† props å’Œ mobx æ•°æ®å˜æ›´è¿˜ä¼šé‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆ 100%æ˜¯ Context å¯¼è‡´çš„ï¼Œå› ä¸ºä¸€æ—¦ Context æ•°æ®å˜åŠ¨ï¼Œç»„ä»¶å°±ä¼šè¢«å¼ºåˆ¶æ¸²æŸ“ã€‚ç¬”è€…åœ¨<a href="https://juejin.im/post/5d045350f265da1b695d5bf2#heading-14" target="_blank" rel="noopener">æµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a>æåˆ°äº† ContextAPI çš„ä¸€äº›é™·é˜±ã€‚å…ˆæ’é™¤ä¸€ä¸‹æ˜¯å¦æ˜¯è¿™äº›åŸå› å¯¼è‡´çš„.</p><p>ç°åœ¨å¹¶æ²¡æœ‰åˆé€‚çš„è·Ÿè¸ª context å˜åŠ¨çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–åƒä¸Šæ–‡çš„<code>useWhyDidYouUpdate</code>ä¸€æ ·çš„æ–¹å¼æ¥æ¯”å¯¹ Context çš„å€¼ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useIsContextUpdate</span>(<span class="params">contexts: object = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> latestContexts = useRef(contexts);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'development'</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> changedContexts: string[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> contexts) &#123;</span><br><span class="line">      <span class="keyword">if</span> (contexts[key] !== latestContexts.current[key]) &#123;</span><br><span class="line">        changedContexts.push(key);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (changedContexts.length) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`[is-context-update]: <span class="subst">$&#123;changedContexts.join(<span class="string">', '</span>)&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    latestContexts.current = contexts;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æ³•:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = useRouter();</span><br><span class="line"><span class="keyword">const</span> myContext = useContext(MyContext);</span><br><span class="line"></span><br><span class="line">useIsContextUpdate(&#123;</span><br><span class="line">  router,</span><br><span class="line">  myContext,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="react-devtool-çš„-interactions"><a href="#react-devtool-çš„-interactions" class="headerlink" title="React Devtool çš„ Interactions"></a>React Devtool çš„ Interactions</h3><p>è¿™æ˜¯ React Devtool çš„ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼ŒInteractions ç¿»è¯‘ä¸ºä¸­æ–‡æ˜¯â€˜äº¤äº’â€™ï¼Ÿè¿™ä¸ªä¸œè¥¿ç›®çš„å…¶å®å°±æ˜¯ä¸ºäº†è·Ÿè¸ªâ€˜ä»€ä¹ˆå¯¼è‡´äº†æ›´æ–°â€™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„å˜åŠ¨æ£€æµ‹ã€‚Reactå¸Œæœ›æä¾›ä¸€ä¸ªé€šç”¨çš„APIç»™å¼€å‘è€…æˆ–ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæ–¹ä¾¿å¼€å‘è€…ç›´è§‚åœ°å®šä½æ›´æ–°çš„åŸå› :</p><p><img src="/images/10/interaction.png" alt></p><p>ä¸Šå›¾è¡¨ç¤ºåœ¨è®°å½•æœŸé—´è·Ÿè¸ªåˆ°äº†å››ä¸ªäº¤äº’ï¼Œä»¥åŠäº¤äº’è§¦å‘çš„æ—¶é—´å’Œè€—æ—¶ã€‚å› ä¸ºè¿˜æ˜¯ä¸€ä¸ªIdeaé˜¶æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æŒ‘é€‰ä¸€äº›APIä»£ç éšä¾¿çœ‹çœ‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** è·Ÿè¸ªçŠ¶æ€å˜æ›´ **/</span></span><br><span class="line"><span class="keyword">import</span> &#123; unstable_trace <span class="keyword">as</span> trace &#125; <span class="keyword">from</span> <span class="string">"scheduler/tracing"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleLoginButtonClick = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è·Ÿè¸ªsetState</span></span><br><span class="line">    trace(<span class="string">"Login button click"</span>, performance.now(), () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">isLoggingIn</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è·Ÿè¸ªå¼‚æ­¥æ“ä½œ **/</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  unstable_trace <span class="keyword">as</span> trace,</span><br><span class="line">  unstable_wrap <span class="keyword">as</span> wrap</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"scheduler/tracing"</span>;</span><br><span class="line"></span><br><span class="line">trace(<span class="string">"Some event"</span>, performance.now(), () =&gt; &#123;</span><br><span class="line">  setTimeout(</span><br><span class="line">    wrap(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// Do some async work</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è·Ÿè¸ªåˆå§‹åŒ–æ¸²æŸ“ **/</span></span><br><span class="line">trace(<span class="string">"initial render"</span>, performance.now(), () =&gt; render(<span class="xml"><span class="tag">&lt;<span class="name">Application</span> /&gt;</span>));</span></span><br></pre></td></tr></table></figure><p>å¥½äº†è¡Œæ–‡ç»“æŸï¼Œå¦‚æœè§‰å¾—å¯ä»¥å°±ç‚¹ä¸ª ğŸ‘ å§</p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://zh-hans.reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html" target="_blank" rel="noopener">Introducing the React Profiler</a></li><li><a href="https://calibreapp.com/blog/react-performance-profiling-optimization/" target="_blank" rel="noopener">Profiling React performance with React 16 and Chrome Devtools.</a></li><li><a href="https://www.youtube.com/watch?v=nl8VVig_9aM" target="_blank" rel="noopener">Tools For Measuring React Performance - Brenda Jimenez @ ReactNYC</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šä¸€ç¯‡&lt;a href=&quot;https://juejin.im/post/5d045350f265da1b695d5bf2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ–‡ç« &lt;/a&gt;è®²äº† React æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ–¹å‘å’Œæ‰‹æ®µï¼Œè¿™ç¯‡æ–‡ç« å†è¡¥å……è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œæ€§èƒ½æµ‹
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</title>
    <link href="https://bobi.ink/2019/06/14/react-performance/"/>
    <id>https://bobi.ink/2019/06/14/react-performance/</id>
    <published>2019-06-13T16:00:00.000Z</published>
    <updated>2019-06-16T01:03:44.939Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ¥æºäºå…¬å¸å†…éƒ¨çš„ä¸€æ¬¡é—ªç”µåˆ†äº«ï¼Œç¨ä½œæ¶¦è‰²åˆ†äº«å‡ºæ¥ã€‚ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚<strong>å¦‚æœä½ è§‰å¾—å¯ä»¥ï¼Œè¯·å¤šç‚¹èµï¼Œé¼“åŠ±æˆ‘å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« </strong>ğŸ™ã€‚</p><p><br></p><p>React æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ä¸‰ä¸ªæ–¹å‘ï¼Œå…¶å®ä¹Ÿé€‚ç”¨äºå…¶ä»–è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œè¿™ä¸‰ä¸ªæ–¹å‘åˆ†åˆ«æ˜¯:</p><ul><li><strong>å‡å°‘è®¡ç®—çš„é‡</strong>ã€‚ -&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ æˆ–è€… é™ä½ç»„ä»¶æ¸²æŸ“çš„å¤æ‚åº¦</strong></li><li><strong>åˆ©ç”¨ç¼“å­˜</strong>ã€‚-&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>å¦‚ä½•é¿å…é‡æ–°æ¸²æŸ“ï¼Œåˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ memo æ–¹å¼æ¥é¿å…ç»„ä»¶é‡æ–°æ¸²æŸ“</strong></li><li><strong>ç²¾ç¡®é‡æ–°è®¡ç®—çš„èŒƒå›´</strong>ã€‚ å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>ç»‘å®šç»„ä»¶å’ŒçŠ¶æ€å…³ç³», ç²¾ç¡®åˆ¤æ–­æ›´æ–°çš„â€™æ—¶æœºâ€™å’Œâ€™èŒƒå›´â€™. åªé‡æ–°æ¸²æŸ“â€™è„â€™çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´é™ä½æ¸²æŸ“èŒƒå›´</strong></li></ul><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹é™ä½æ¸²æŸ“è®¡ç®—é‡å¤æ‚åº¦">å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡(å¤æ‚åº¦)</a><ul><li><a href="#0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—">0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</a></li><li><a href="#1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—">1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—</a></li><li><a href="#2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨">2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨</a></li><li><a href="#3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“">3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“</a></li><li><a href="#4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ">4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ</a></li></ul></li><li><a href="#é¿å…é‡æ–°æ¸²æŸ“">é¿å…é‡æ–°æ¸²æŸ“</a><ul><li><a href="#0ï¸âƒ£-ç®€åŒ–-props">0ï¸âƒ£ ç®€åŒ– props</a></li><li><a href="#1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨">1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</a></li><li><a href="#2ï¸âƒ£-ä¸å¯å˜æ•°æ®">2ï¸âƒ£ ä¸å¯å˜æ•°æ®</a></li><li><a href="#3ï¸âƒ£-ç®€åŒ–-state">3ï¸âƒ£ ç®€åŒ– state</a></li><li><a href="#4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹">4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹</a></li></ul></li><li><a href="#ç²¾ç»†åŒ–æ¸²æŸ“">ç²¾ç»†åŒ–æ¸²æŸ“</a><ul><li><a href="#0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“">0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“</a></li><li><a href="#1ï¸âƒ£-ä¸è¦æ»¥ç”¨-context">1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context</a></li></ul></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br><br><br></p><h2 id="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡-å¤æ‚åº¦"><a href="#å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡-å¤æ‚åº¦" class="headerlink" title="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡(å¤æ‚åº¦)"></a>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡(å¤æ‚åº¦)</h2><p>é¦–å…ˆä»è®¡ç®—çš„é‡ä¸Šä¸‹åŠŸå¤«ï¼Œå‡å°‘èŠ‚ç‚¹æ¸²æŸ“çš„æ•°é‡æˆ–è€…é™ä½æ¸²æŸ“çš„è®¡ç®—é‡å¯ä»¥æ˜¾è‘—çš„æé«˜ç»„ä»¶æ¸²æŸ“æ€§èƒ½ã€‚</p><p><br></p><h3 id="0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—"><a href="#0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—" class="headerlink" title="0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—"></a>0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</h3><p>æ¯”å¦‚ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°(render)ä¸­è¿›è¡Œæ•°ç»„æ’åºã€æ•°æ®è½¬æ¢ã€è®¢é˜…äº‹ä»¶ã€åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ç­‰ç­‰. <strong>æ¸²æŸ“å‡½æ•°ä¸­ä¸åº”è¯¥æ”¾ç½®å¤ªå¤šå‰¯ä½œç”¨</strong></p><p><br></p><h3 id="1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—"><a href="#1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—" class="headerlink" title="1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—"></a>1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—</h3><center><br> <img src="/images/09/styled-components.png"><br></center><p>æˆ‘ä»¬å›¢é˜Ÿæ˜¯é‡åº¦çš„ <code>styled-components</code> ç”¨æˆ·ï¼Œ<strong>å…¶å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸éœ€è¦è¿™ä¸ªç©æ„</strong>ï¼Œæ¯”å¦‚çº¯é™æ€çš„æ ·å¼è§„åˆ™ï¼Œä»¥åŠéœ€è¦é‡åº¦æ€§èƒ½ä¼˜åŒ–çš„åœºæ™¯ã€‚é™¤äº†æ€§èƒ½é—®é¢˜ï¼Œå¦å¤–ä¸€ä¸ªå›°æ‰°æˆ‘ä»¬çš„æ˜¯å®ƒå¸¦æ¥çš„èŠ‚ç‚¹åµŒå¥—åœ°ç‹±(å¦‚ä¸Šå›¾)ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç†æ€§åœ°é€‰æ‹©ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚ä½¿ç”¨åŸç”Ÿçš„ CSSï¼Œå‡å°‘ React è¿è¡Œæ—¶çš„è´Ÿæ‹….</p><p><strong>ä¸€èˆ¬ä¸å¿…è¦çš„èŠ‚ç‚¹åµŒå¥—éƒ½æ˜¯æ»¥ç”¨é«˜é˜¶ç»„ä»¶/RenderProps å¯¼è‡´çš„ã€‚æ‰€ä»¥è¿˜æ˜¯é‚£å¥è¯â€˜åªæœ‰åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ xxxâ€™</strong>ã€‚ æœ‰å¾ˆå¤šç§æ–¹å¼æ¥ä»£æ›¿é«˜é˜¶ç»„ä»¶/RenderPropsï¼Œä¾‹å¦‚ä¼˜å…ˆä½¿ç”¨ propsã€React Hooks</p><p><br></p><h3 id="2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨"><a href="#2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨"></a>2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨</h3><p>è™šæ‹Ÿåˆ—è¡¨æ˜¯å¸¸è§çš„â€˜é•¿åˆ—è¡¨â€™å’Œâ€™å¤æ‚ç»„ä»¶æ ‘â€™ä¼˜åŒ–æ–¹å¼ï¼Œå®ƒä¼˜åŒ–çš„æœ¬è´¨å°±æ˜¯å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚</p><p>è™šæ‹Ÿåˆ—è¡¨åªæ¸²æŸ“å½“å‰è§†å£å¯è§å…ƒç´ :</p><center><br> <img src="/images/09/vl.png" width="500"><br></center><p>è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“æ€§èƒ½å¯¹æ¯”:</p><center><br> <img src="/images/09/vl-compare.png" width="500"><br></center><p>è™šæ‹Ÿåˆ—è¡¨å¸¸ç”¨äºä»¥ä¸‹ç»„ä»¶åœºæ™¯:</p><ul><li>æ— é™æ»šåŠ¨åˆ—è¡¨ï¼Œgrid, è¡¨æ ¼ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼Œspreadsheets</li><li>æ— é™åˆ‡æ¢çš„æ—¥å†æˆ–è½®æ’­å›¾</li><li>å¤§æ•°æ®é‡æˆ–æ— é™åµŒå¥—çš„æ ‘</li><li>èŠå¤©çª—ï¼Œæ•°æ®æµ(feed), æ—¶é—´è½´</li><li>ç­‰ç­‰</li></ul><p>ç›¸å…³ç»„ä»¶æ–¹æ¡ˆ:</p><ul><li><a href="https://github.com/bvaughn/react-virtualized" target="_blank" rel="noopener">react-virtualized</a></li><li><a href="https://github.com/bvaughn/react-window" target="_blank" rel="noopener">react-window</a> æ›´è½»é‡çš„ react-virtualized, åŒå‡ºä¸€ä¸ªä½œè€…</li><li><a href="https://github.com/bvaughn/react-virtualized#friends" target="_blank" rel="noopener">æ›´å¤š</a></li></ul><p>æ‰©å±•ï¼š</p><ul><li><a href="https://bvaughn.github.io/forward-js-2017/#/0/0" target="_blank" rel="noopener">Creating more efficient React views with windowing</a></li><li><a href="https://addyosmani.com/blog/react-window/" target="_blank" rel="noopener">Rendering large lists with react-window</a></li></ul><p><br><br><br></p><h3 id="3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“"><a href="#3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“" class="headerlink" title="3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“"></a>3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“</h3><p><strong>æƒ°æ€§æ¸²æŸ“çš„åˆè¡·æœ¬è´¨ä¸Šå’Œè™šè¡¨ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªåœ¨å¿…è¦æ—¶æ‰å»æ¸²æŸ“å¯¹åº”çš„èŠ‚ç‚¹</strong>ã€‚</p><p>ä¸¾ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸¸ç”¨ Tab ç»„ä»¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸€å¼€å§‹å°±å°†æ‰€æœ‰ Tab çš„ panel éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œè€Œæ˜¯ç­‰åˆ°è¯¥ Tab è¢«æ¿€æ´»æ—¶æ‰å»æƒ°æ€§æ¸²æŸ“ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šåœºæ™¯ä¼šç”¨åˆ°æƒ°æ€§æ¸²æŸ“ï¼Œä¾‹å¦‚æ ‘å½¢é€‰æ‹©å™¨ï¼Œæ¨¡æ€å¼¹çª—ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼ŒæŠ˜å ç»„ä»¶ç­‰ç­‰ã€‚</p><p>è¿™é‡Œå°±ä¸ä¸¾å…·ä½“çš„ä»£ç ä¾‹å­äº†ï¼Œç•™ç»™è¯»è€…å»æ€è€ƒ.</p><p><br></p><h3 id="4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ"><a href="#4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ" class="headerlink" title="4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ"></a>4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ</h3><center><br>  <img src="/images/09/style-compare.png" width="500"><br></center><p>å¦‚å›¾(å›¾ç‰‡æ¥æºäº<a href="https://blog.primehammer.com/the-performance-of-styled-react-components/" target="_blank" rel="noopener">THE PERFORMANCE OF STYLED REACT COMPONENTS</a>), è¿™ä¸ªå›¾ç‰‡æ˜¯17å¹´çš„äº†ï¼Œä½†æ˜¯å¤§æŠµçš„è¶‹åŠ¿è¿˜æ˜¯è¿™æ ·ã€‚</p><p>æ‰€ä»¥åœ¨æ ·å¼è¿è¡Œæ—¶æ€§èƒ½æ–¹é¢å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼š<code>CSS &gt; å¤§éƒ¨åˆ†CSS-in-js &gt; inline style</code></p><p><br></p><hr><p><br></p><h2 id="é¿å…é‡æ–°æ¸²æŸ“"><a href="#é¿å…é‡æ–°æ¸²æŸ“" class="headerlink" title="é¿å…é‡æ–°æ¸²æŸ“"></a>é¿å…é‡æ–°æ¸²æŸ“</h2><p>å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ä¹Ÿæ˜¯ React ç»„ä»¶æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹å‘. ä¸ºäº†é¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ–°æ¸²æŸ“éœ€è¦åœ¨åšåˆ°ä¸¤ç‚¹:</p><ol><li>ä¿è¯ç»„ä»¶çº¯ç²¹æ€§ã€‚å³æ§åˆ¶ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œå¦‚æœç»„ä»¶æœ‰å‰¯ä½œç”¨åˆ™æ— æ³•å®‰å…¨åœ°ç¼“å­˜æ¸²æŸ“ç»“æœ</li><li>é€šè¿‡<code>shouldComponentUpdate</code>ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ¥æ¯”å¯¹ state å’Œ props, ç¡®å®šæ˜¯å¦è¦é‡æ–°æ¸²æŸ“ã€‚å¯¹äºå‡½æ•°ç»„ä»¶å¯ä»¥ä½¿ç”¨<code>React.memo</code>åŒ…è£…</li></ol><p>å¦å¤–è¿™äº›æªæ–½ä¹Ÿå¯ä»¥å¸®åŠ©ä½ æ›´å®¹æ˜“åœ°ä¼˜åŒ–ç»„ä»¶é‡æ–°æ¸²æŸ“:</p><p><br></p><h3 id="0ï¸âƒ£-ç®€åŒ–-props"><a href="#0ï¸âƒ£-ç®€åŒ–-props" class="headerlink" title="0ï¸âƒ£ ç®€åŒ– props"></a>0ï¸âƒ£ ç®€åŒ– props</h3><p><strong>â‘  å¦‚æœä¸€ä¸ªç»„ä»¶çš„ props å¤ªå¤æ‚ä¸€èˆ¬æ„å‘³ç€è¿™ä¸ªç»„ä»¶å·²ç»è¿èƒŒäº†â€˜å•ä¸€èŒè´£â€™ï¼Œé¦–å…ˆåº”è¯¥å°è¯•å¯¹ç»„ä»¶è¿›è¡Œæ‹†è§£</strong>.<br><strong>â‘¡ å¦å¤–å¤æ‚çš„ props ä¹Ÿä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤, æ¯”å¦‚ä¼šå½±å“<code>shallowCompare</code>æ•ˆç‡, è¿˜ä¼šè®©ç»„ä»¶çš„å˜åŠ¨å˜å¾—éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•</strong>.</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­, ä¸ºäº†åˆ¤æ–­åˆ—è¡¨é¡¹æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œè¿™é‡Œä¼ å…¥äº†ä¸€ä¸ªå½“å‰æ¿€æ´»çš„ id:</p>  <center><br>    <img src="/images/09/list.png" width="500"><br>  </center><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡ï¼Œä¸€æ—¦æ¿€æ´» id å˜åŠ¨ï¼Œæ‰€æœ‰åˆ—è¡¨é¡¹éƒ½ä¼šé‡æ–°åˆ·æ–°. æ›´å¥½çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ç±»ä¼¼<code>actived</code>è¿™æ ·çš„å¸ƒå°”å€¼ prop. actived ç°åœ¨åªæœ‰ä¸¤ç§å˜åŠ¨æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´æ¿€æ´» id çš„å˜åŠ¨ï¼Œæœ€å¤šåªæœ‰ä¸¤ä¸ªç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“.</p><p><strong>ç®€åŒ–çš„ props æ›´å®¹æ˜“ç†è§£, ä¸”å¯ä»¥æé«˜ç»„ä»¶ç¼“å­˜çš„å‘½ä¸­ç‡</strong></p><p><br></p><h3 id="1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨"><a href="#1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨" class="headerlink" title="1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨"></a>1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</h3><p>â‘ <strong>é¿å…ä½¿ç”¨ç®­å¤´å‡½æ•°å½¢å¼çš„äº‹ä»¶å¤„ç†å™¨</strong>, ä¾‹å¦‚:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;ComplexComponent onClick=&#123;evt =&gt; onClick(evt.id)&#125; otherProps=&#123;values&#125; /&gt;</span><br></pre></td></tr></table></figure><p>å‡è®¾ ComplexComponent æ˜¯ä¸€ä¸ªå¤æ‚çš„ PureComponent, è¿™é‡Œä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå…¶å®æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¼šå¯¼è‡´ ComplexComponent å§‹ç»ˆä¼šè¢«é‡æ–°æ¸²æŸ“.</p><p>æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨å®ä¾‹æ–¹æ³•:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    &lt;ComplexComponent onClick=&#123;<span class="keyword">this</span>.handleClick&#125; otherProps=&#123;values&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <br></p><p>â‘¡ å³ä½¿ç°åœ¨ä½¿ç”¨<code>hooks</code>ï¼Œæˆ‘ä¾ç„¶ä¼š<strong>ä½¿ç”¨<code>useCallback</code>æ¥åŒ…è£…äº‹ä»¶å¤„ç†å™¨</strong>ï¼Œå°½é‡ç»™ä¸‹çº§ç»„ä»¶æš´éœ²ä¸€ä¸ªé™æ€çš„å‡½æ•°:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ComplexComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> <span class="attr">otherProps</span>=<span class="string">&#123;values&#125;</span> /&gt;</span>;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœ<code>useCallback</code>ä¾èµ–äºå¾ˆå¤šçŠ¶æ€ï¼Œä½ çš„<code>useCallback</code>å¯èƒ½ä¼šå˜æˆè¿™æ ·:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  <span class="comment">// ğŸ¤­</span></span><br><span class="line">&#125;, [foo, bar, baz, bazz, bazzzz]);</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•å®åœ¨è®©äººéš¾ä»¥æ¥å—ï¼Œè¿™æ—¶å€™è°è¿˜ç®¡ä»€ä¹ˆå‡½æ•°å¼éå‡½æ•°å¼çš„ã€‚æˆ‘æ˜¯è¿™æ ·å¤„ç†çš„:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRefProps</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: T</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef &lt; T &gt; props;</span><br><span class="line">  <span class="comment">// æ¯æ¬¡æ¸²æŸ“æ›´æ–°props</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ref.current = props;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComp</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> propsRef = useRefProps(props);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç°åœ¨handleClickæ˜¯å§‹ç»ˆä¸å˜çš„</span></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; foo, bar, baz, bazz, bazzzz &#125; = propsRef.current;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>â‘¢<strong>è®¾è®¡æ›´æ–¹ä¾¿å¤„ç†çš„ Event Props</strong>. æœ‰æ—¶å€™æˆ‘ä»¬ä¼šè¢«é€¼çš„ä¸å¾—ä¸ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥ä½œä¸ºäº‹ä»¶å¤„ç†å™¨ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;List&gt;</span><br><span class="line">  &#123;list.map(<span class="function"><span class="params">i</span> =&gt;</span> (</span><br><span class="line">    &lt;Item key=&#123;i.id&#125; onClick=&#123;() =&gt; handleDelete(i.id)&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">  ))&#125;</span><br><span class="line">&lt;<span class="regexp">/List&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ onClick æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å®ç°ï¼Œå®ƒæ²¡æœ‰æºå¸¦ä»»ä½•ä¿¡æ¯æ¥æ ‡è¯†äº‹ä»¶æ¥æºï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½ä½¿ç”¨é—­åŒ…å½¢å¼ï¼Œæ›´å¥½çš„è®¾è®¡å¯èƒ½æ˜¯è¿™æ ·çš„:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// onClickä¼ é€’äº‹ä»¶æ¥æºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> handleDelete = useCallback(<span class="function">(<span class="params">id: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*åˆ é™¤æ“ä½œ*/</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;List&gt;</span><br><span class="line">    &#123;list.map(<span class="function"><span class="params">i</span> =&gt;</span> (</span><br><span class="line">      &lt;Item key=&#123;i.id&#125; id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;<span class="regexp">/List&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶æˆ–è€… DOM ç»„ä»¶å‘¢? å®åœ¨ä¸è¡Œï¼Œçœ‹èƒ½ä¸èƒ½ä¼ é€’<code>data-*</code>å±æ€§:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleDelete = useCallback(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = event.dataset.id;</span><br><span class="line">  <span class="comment">/*åˆ é™¤æ“ä½œ*/</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;list.map(<span class="function"><span class="params">i</span> =&gt;</span> (</span><br><span class="line">      &lt;li key=&#123;i.id&#125; data-id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="2ï¸âƒ£-ä¸å¯å˜æ•°æ®"><a href="#2ï¸âƒ£-ä¸å¯å˜æ•°æ®" class="headerlink" title="2ï¸âƒ£ ä¸å¯å˜æ•°æ®"></a>2ï¸âƒ£ ä¸å¯å˜æ•°æ®</h3><p>ä¸å¯å˜æ•°æ®å¯ä»¥è®©çŠ¶æ€å˜å¾—å¯é¢„æµ‹ï¼Œä¹Ÿè®© shouldComponentUpdate â€˜æµ…æ¯”è¾ƒâ€™å˜å¾—æ›´å¯é å’Œé«˜æ•ˆ. ç¬”è€…åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-8" target="_blank" rel="noopener">React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 04 - ç»„ä»¶çš„æ€ç»´</a>ä»‹ç»è¿‡ä¸å¯å˜æ•°æ®ï¼Œæœ‰å…´è¶£è¯»è€…å¯ä»¥çœ‹çœ‹.</p><p>ç›¸å…³çš„å·¥å…·æœ‰<a href="https://github.com/facebook/immutable-js" target="_blank" rel="noopener">Immutable.js</a>ã€<a href="https://github.com/mweststrate/immer" target="_blank" rel="noopener">Immer</a>ã€immutability-helper ä»¥åŠ seamless-immutableã€‚</p><p><br></p><h3 id="3ï¸âƒ£-ç®€åŒ–-state"><a href="#3ï¸âƒ£-ç®€åŒ–-state" class="headerlink" title="3ï¸âƒ£ ç®€åŒ– state"></a>3ï¸âƒ£ ç®€åŒ– state</h3><p><strong>ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ”¾åœ¨ç»„ä»¶çš„ state ä¸­</strong>. ä¾‹å¦‚ç¼“å­˜æ•°æ®ã€‚æŒ‰ç…§æˆ‘çš„åŸåˆ™æ˜¯ï¼š<strong>å¦‚æœéœ€è¦ç»„ä»¶å“åº”å®ƒçš„å˜åŠ¨, æˆ–è€…éœ€è¦æ¸²æŸ“åˆ°è§†å›¾ä¸­çš„æ•°æ®æ‰åº”è¯¥æ”¾åˆ° state ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ•°æ®å˜åŠ¨å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“.</strong></p><p><br></p><h3 id="4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹"><a href="#4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹" class="headerlink" title="4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹"></a>4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹</h3><p>å°½ç®¡ hooks å‡ºæ¥åï¼Œrecompose å®£ç§°ä¸å†æ›´æ–°äº†ï¼Œä½†è¿˜æ˜¯ä¸å½±å“æˆ‘ä»¬ä½¿ç”¨ recompose æ¥æ§åˆ¶<code>shouldComponentUpdate</code>æ–¹æ³•, æ¯”å¦‚å®ƒæä¾›äº†ä»¥ä¸‹æ–¹æ³•æ¥ç²¾ç»†æ§åˆ¶åº”è¯¥æ¯”è¾ƒå“ªäº› props:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ç›¸å½“äºReact.memo */</span></span><br><span class="line">pure()</span><br><span class="line"><span class="comment">/* è‡ªå®šä¹‰æ¯”è¾ƒ */</span></span><br><span class="line">shouldUpdate(test: <span class="function">(<span class="params">props: <span class="built_in">Object</span>, nextProps: <span class="built_in">Object</span></span>) =&gt;</span> <span class="built_in">boolean</span>): HigherOrderComponent</span><br><span class="line"><span class="comment">/* åªæ¯”è¾ƒæŒ‡å®škey */</span></span><br><span class="line">onlyUpdateForKeys( propKeys: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;): HigherOrderComponent</span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜å¯ä»¥å†æ‰©å±•ä¸€ä¸‹ï¼Œæ¯”å¦‚<code>omitUpdateForKeys</code>å¿½ç•¥æ¯”å¯¹æŸäº› key.</p><p><br><br><br></p><h2 id="ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="ç²¾ç»†åŒ–æ¸²æŸ“"></a>ç²¾ç»†åŒ–æ¸²æŸ“</h2><p>æ‰€è°“ç²¾ç»†åŒ–æ¸²æŸ“æŒ‡çš„æ˜¯<strong>åªæœ‰ä¸€ä¸ªæ•°æ®æ¥æºå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>, æ¯”å¦‚è¯´ A åªä¾èµ–äº a æ•°æ®ï¼Œé‚£ä¹ˆåªæœ‰åœ¨ a æ•°æ®å˜åŠ¨æ—¶æ‰æ¸²æŸ“ A, å…¶ä»–çŠ¶æ€å˜åŒ–ä¸åº”è¯¥å½±å“ç»„ä»¶ Aã€‚</p><p>Vue å’Œ Mobx å®£ç§°è‡ªå·±æ€§èƒ½å¥½çš„ä¸€éƒ¨åˆ†åŸå› æ˜¯å®ƒä»¬çš„â€™å“åº”å¼ç³»ç»Ÿâ€™, <strong>å®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€äº›â€˜å“åº”å¼æ•°æ®â€™ï¼Œå½“è¿™äº›å“åº”æ•°æ®å˜åŠ¨æ—¶ï¼Œä¾èµ–è¿™äº›å“åº”å¼æ•°æ®è§†å›¾å°±ä¼šé‡æ–°æ¸²æŸ“</strong>. æ¥çœ‹çœ‹ Vue å®˜æ–¹æ˜¯å¦‚ä½•æè¿°çš„:</p><center><br>  <img src="/images/09/vue-compare.png" width="500"><br></center><p><br></p><h3 id="0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“"></a>0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“</h3><p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå“åº”å¼æ•°æ®å¯ä»¥å®ç°è§†å›¾ç²¾ç»†åŒ–çš„æ¸²æŸ“, ä½†å®ƒè¿˜æ˜¯ä¸èƒ½é¿å…å¼€å‘è€…å†™å‡ºä½æ•ˆçš„ç¨‹åº</strong>. <strong>æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºç»„ä»¶è¿èƒŒâ€˜å•ä¸€èŒè´£â€™</strong>.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰ä¸€ä¸ª MyComponent ç»„ä»¶ï¼Œä¾èµ–äº Aã€Bã€C ä¸‰ä¸ªæ•°æ®æºï¼Œæ¥æ„å»ºä¸€ä¸ª vdom æ ‘ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç°åœ¨åªè¦ Aã€Bã€C ä»»æ„ä¸€ä¸ªå˜åŠ¨ï¼Œé‚£ä¹ˆ MyComponent æ•´ä¸ªå°±ä¼šé‡æ–°æ¸²æŸ“:</p><center><br>  <img src="/images/09/my-component1.png" width="300"><br></center><p>æ›´å¥½çš„åšæ³•æ˜¯è®©ç»„ä»¶çš„èŒè´£æ›´å•ä¸€ï¼Œç²¾ç»†åŒ–åœ°ä¾èµ–å“åº”å¼æ•°æ®ï¼Œæˆ–è€…è¯´å¯¹å“åº”å¼æ•°æ®è¿›è¡Œâ€˜éš”ç¦»â€™. å¦‚ä¸‹å›¾, Aã€Bã€C éƒ½æŠ½å–å„è‡ªçš„ç»„ä»¶ä¸­äº†ï¼Œç°åœ¨ A å˜åŠ¨åªä¼šæ¸²æŸ“ A ç»„ä»¶æœ¬èº«ï¼Œè€Œä¸ä¼šå½±å“çˆ¶ç»„ä»¶å’Œ Bã€C ç»„ä»¶:</p><center><br>  <img src="/images/09/my-component2.png" width="480"><br></center><p><br></p><p>ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œåˆ—è¡¨æ¸²æŸ“:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">'mobx-react-lite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialList = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  initialList.push(&#123; <span class="attr">id</span>: i, <span class="attr">name</span>: <span class="string">`name-<span class="subst">$&#123;i&#125;</span>`</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = observable(&#123;</span><br><span class="line">  list: initialList,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> List = observer(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> list = store.list;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Listæ¸²æŸ“'</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-container"</span>&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map(<span class="function">(<span class="params">i, idx</span>) =&gt;</span> (</span><br><span class="line">          &lt;div className=<span class="string">"list-item"</span> key=&#123;i.id&#125;&gt;</span><br><span class="line">            &#123;<span class="comment">/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */</span>&#125;</span><br><span class="line">            &#123;<span class="built_in">console</span>.log(<span class="string">'render'</span>, i.id)&#125;</span><br><span class="line">            &lt;span className=<span class="string">"list-item-name"</span>&gt;&#123;i.name&#125; &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;span className="list-item-value"&gt;&#123;i.value&#125; &lt;/</span>span&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              className=<span class="string">"list-item-increment"</span></span><br><span class="line">              onClick=&#123;() =&gt; &#123;</span><br><span class="line">                i.value++;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'é€’å¢'</span>);</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              é€’å¢</span><br><span class="line">            &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;button</span></span><br><span class="line"><span class="regexp">              className="list-item-increment"</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                if (idx &lt; list.length - 1) &#123;</span></span><br><span class="line"><span class="regexp">                  console.log('ç§»ä½');</span></span><br><span class="line"><span class="regexp">                  let t = list[idx];</span></span><br><span class="line"><span class="regexp">                  list[idx] = list[idx + 1];</span></span><br><span class="line"><span class="regexp">                  list[idx + 1] = t;</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">              &#125;&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              ä¸‹ç§»</span></span><br><span class="line"><span class="regexp">            &lt;/</span>button&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        ))&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/u</span>l&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure><p><br></p><p>ä¸Šè¿°çš„ä¾‹å­æ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜çš„ï¼Œå•ä¸ª list-item çš„é€’å¢å’Œç§»ä½éƒ½ä¼šå¯¼è‡´æ•´ä¸ªåˆ—è¡¨çš„é‡æ–°æ¸²æŸ“:</p><center><br>  <img src="/images/09/list-demo.png" width="380"><br></center><p>åŸå› å¤§æ¦‚èƒ½çŒœå‡ºæ¥å§? å¯¹äº Vue æˆ–è€… Mobx æ¥è¯´ï¼Œ<strong>ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“å‡½æ•°å°±æ˜¯ä¸€ä¸ªä¾èµ–æ”¶é›†çš„ä¸Šä¸‹æ–‡</strong>ã€‚ä¸Šé¢ List ç»„ä»¶æ¸²æŸ“å‡½æ•°å†…â€™è®¿é—®â€™äº†æ‰€æœ‰çš„åˆ—è¡¨é¡¹æ•°æ®ï¼Œé‚£ä¹ˆ Vue æˆ– Mobx å°±ä¼šè®¤ä¸ºä½ è¿™ä¸ªç»„ä»¶ä¾èµ–äºæ‰€æœ‰çš„åˆ—è¡¨é¡¹ï¼Œè¿™æ ·å°±å¯¼è‡´ï¼Œåªè¦ä»»æ„ä¸€ä¸ªåˆ—è¡¨é¡¹çš„å±æ€§å€¼å˜åŠ¨å°±ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ª List ç»„ä»¶ã€‚</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†æ•°æ®éš”ç¦»æŠ½å–åˆ°å•ä¸€èŒè´£çš„ç»„ä»¶ä¸­ã€‚<strong>å¯¹äº Vue æˆ– Mobx æ¥è¯´ï¼Œè¶Šç»†ç²’åº¦çš„ç»„ä»¶ï¼Œå¯ä»¥æ”¶è·æ›´é«˜çš„æ€§èƒ½ä¼˜åŒ–æ•ˆæœ</strong>:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ListItem = observer(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; item, onShiftDown &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-item"</span>&gt;</span><br><span class="line">      &#123;<span class="built_in">console</span>.log(<span class="string">'render'</span>, item.id)&#125;</span><br><span class="line">      &#123;<span class="comment">/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */</span>&#125;</span><br><span class="line">      &lt;span className=<span class="string">"list-item-name"</span>&gt;&#123;item.name&#125; &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span className="list-item-value"&gt;&#123;item.value&#125; &lt;/</span>span&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        className=<span class="string">"list-item-increment"</span></span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          item.value++;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'é€’å¢'</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        é€’å¢</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button className="list-item-increment" onClick=&#123;() =&gt; onShiftDown(item)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        ä¸‹ç§»</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export const List = observer(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const list = store.list;</span></span><br><span class="line"><span class="regexp">  const handleShiftDown = useCallback(item =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const idx = list.findIndex(i =&gt; i.id === item.id);</span></span><br><span class="line"><span class="regexp">    if (idx !== -1 &amp;&amp; idx &lt; list.length - 1) &#123;</span></span><br><span class="line"><span class="regexp">      console.log('ç§»ä½');</span></span><br><span class="line"><span class="regexp">      let t = list[idx];</span></span><br><span class="line"><span class="regexp">      list[idx] = list[idx + 1];</span></span><br><span class="line"><span class="regexp">      list[idx + 1] = t;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ eslint-disable-next-line react-hooks/</span>exhaustive-deps</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'List æ¸²æŸ“'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-container"</span>&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map(<span class="function">(<span class="params">i, idx</span>) =&gt;</span> (</span><br><span class="line">          &lt;ListItem key=&#123;i.id&#125; item=&#123;i&#125; onShiftDown=&#123;handleShiftDown&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¾ˆæ˜æ˜¾, list-item é€’å¢åªä¼šé‡æ–°æ¸²æŸ“æœ¬èº«; è€Œç§»ä½åªä¼šé‡æ–°æ¸²æŸ“ Listï¼Œ å› ä¸ºåˆ—è¡¨é¡¹æ²¡æœ‰å˜åŠ¨, æ‰€ä»¥ä¸‹çº§ list-item ä¹Ÿä¸éœ€è¦é‡æ–°æ¸²æŸ“:</p><center><br>  <img src="/images/09/list-demo2.png" width="380"><br></center><p><br><br><br></p><h3 id="1ï¸âƒ£-ä¸è¦æ»¥ç”¨-context"><a href="#1ï¸âƒ£-ä¸è¦æ»¥ç”¨-context" class="headerlink" title="1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context"></a>1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context</h3><p><strong>å…¶å® Context çš„ç”¨æ³•å’Œå“åº”å¼æ•°æ®æ­£å¥½ç›¸å</strong>ã€‚ç¬”è€…ä¹Ÿçœ‹è¿‡ä¸å°‘æ»¥ç”¨ Context API çš„ä¾‹å­, è¯´åˆ°åº•è¿˜æ˜¯æ²¡æœ‰å¤„ç†å¥½â€˜çŠ¶æ€çš„ä½œç”¨åŸŸé—®é¢˜â€™.</p><p>é¦–å…ˆè¦ç†è§£ Context API çš„æ›´æ–°ç‰¹ç‚¹ï¼Œ<strong>å®ƒæ˜¯å¯ä»¥ç©¿é€<code>React.memo</code>æˆ–è€…<code>shouldComponentUpdate</code>çš„æ¯”å¯¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdate</strong>.</p><p><strong>è¿™ä¸ªå’Œ Mobx å’Œ Vue çš„å“åº”å¼ç³»ç»Ÿä¸åŒï¼ŒContext API å¹¶ä¸èƒ½ç»†ç²’åº¦åœ°æ£€æµ‹å“ªäº›ç»„ä»¶ä¾èµ–å“ªäº›çŠ¶æ€ï¼Œæ‰€ä»¥è¯´ä¸ŠèŠ‚æåˆ°çš„â€˜ç²¾ç»†åŒ–æ¸²æŸ“â€™ç»„ä»¶æ¨¡å¼ï¼Œåœ¨ Context è¿™é‡Œå°±æˆä¸ºäº†â€˜åæ¨¡å¼â€™</strong>.</p><p>æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ Context API è¦éµå¾ªä¸€ä¸‹åŸåˆ™:</p><p><br></p><ul><li><p><strong>æ˜ç¡®çŠ¶æ€ä½œç”¨åŸŸ, Context åªæ”¾ç½®å¿…è¦çš„ï¼Œå…³é”®çš„ï¼Œè¢«å¤§å¤šæ•°ç»„ä»¶æ‰€å…±äº«çš„çŠ¶æ€</strong>ã€‚æ¯”è¾ƒå…¸å‹çš„æ˜¯é‰´æƒçŠ¶æ€</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><center><br>  <img src="/images/09/use-context1.png" width="400"><br></center><center><br>  <img src="/images/09/use-context2.png" width="650"><br></center><p>æ‰©å±•ï¼šContextå…¶å®æœ‰ä¸ªå®éªŒæ€§æˆ–è€…è¯´éå…¬å¼€çš„é€‰é¡¹<code>observedBits</code>, å¯ä»¥ç”¨äºæ§åˆ¶ContextConsumeræ˜¯å¦éœ€è¦æ›´æ–°. è¯¦ç»†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« &lt;<a href="https://zhuanlan.zhihu.com/p/51073183" target="_blank" rel="noopener">ObservedBits: React Contextçš„ç§˜å¯†åŠŸèƒ½</a>&gt;. ä¸è¿‡ä¸æ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªAPIä¹Ÿæ¯”è¾ƒéš¾ç”¨ï¼Œä¸å¦‚ç›´æ¥ä¸Šmobxã€‚</p></li><li><p><strong>ç²—ç²’åº¦åœ°è®¢é˜… Context</strong></p><p>å¦‚ä¸‹å›¾. ç»†ç²’åº¦çš„ Context è®¢é˜…ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“, æ‰€ä»¥è¿™é‡Œæ¨èç²—ç²’åº¦çš„è®¢é˜…. æ¯”å¦‚åœ¨çˆ¶çº§è®¢é˜… Contextï¼Œç„¶åå†é€šè¿‡ props ä¼ é€’ç»™ä¸‹çº§ã€‚</p><center><br>  <img src="/images/09/context-vs-props.png" width="600"><br></center></li></ul><p><br></p><p>å¦å¤–ç¨‹å¢¨ Morgan åœ¨<a href="https://zhuanlan.zhihu.com/p/50336226" target="_blank" rel="noopener">é¿å… React Context å¯¼è‡´çš„é‡å¤æ¸²æŸ“</a>ä¸€æ–‡ä¸­ä¹Ÿæåˆ° ContextAPI çš„ä¸€ä¸ªé™·é˜±:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Context.Provider</span><br><span class="line">  value=&#123;&#123; <span class="attr">theme</span>: <span class="keyword">this</span>.state.theme, <span class="attr">switchTheme</span>: <span class="keyword">this</span>.switchTheme &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;Content /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Context.Provider&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»„ä»¶ä¼šåœ¨ state å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œè‡³äºä¸ºä»€ä¹ˆç•™ç»™è¯»è€…å»æ€è€ƒã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¸ä¼šè£¸éœ²åœ°ä½¿ç”¨ Context.Provider, è€Œæ˜¯å°è£…ä¸ºç‹¬ç«‹çš„ Provider ç»„ä»¶:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ é¡ºä¾¿æš´éœ²useTheme, è®©å¤–éƒ¨å¿…é¡»ç›´æ¥ä½¿ç”¨Context</span></span><br><span class="line"><span class="regexp">export function useTheme() &#123;</span></span><br><span class="line"><span class="regexp">  return useContext(Context);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ theme å˜åŠ¨å°±ä¸ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå› ä¸º props.children ç”±å¤–éƒ¨ä¼ é€’è¿›æ¥ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ã€‚</p><p><strong>å…¶å®ä¸Šé¢çš„ä»£ç è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¯”è¾ƒéš¾å‘ç°çš„é™·é˜±(å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰<a href="https://zh-hans.reactjs.org/docs/context.html#caveats" target="_blank" rel="noopener">æåˆ°</a>)</strong>:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &#123;<span class="comment">/* ğŸ‘‡ ğŸ’£è¿™é‡Œæ¯ä¸€æ¬¡æ¸²æŸ“ThemeProvider, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„value(å³ä½¿themeå’ŒswitchThemeæ²¡æœ‰å˜åŠ¨),</span></span><br><span class="line"><span class="comment">        ä»è€Œå¯¼è‡´å¼ºåˆ¶æ¸²æŸ“æ‰€æœ‰ä¾èµ–è¯¥Contextçš„ç»„ä»¶ */</span>&#125;</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<strong>ä¼ é€’ç»™ Context çš„ value æœ€å¥½åšä¸€ä¸‹ç¼“å­˜</strong>:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  <span class="keyword">const</span> value = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> (&#123; theme, switchTheme &#125;), [theme]);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://react.docschina.org/docs/optimizing-performance.html" target="_blank" rel="noopener">Optimizing Performance</a> React å®˜æ–¹æ–‡æ¡£ï¼Œæœ€å¥½çš„æ•™ç¨‹, åˆ©ç”¨å¥½ React çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚</li><li><a href="https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3" target="_blank" rel="noopener">Twitter Lite and High Performance React Progressive Web Apps at Scale</a> çœ‹çœ‹ Twitter å¦‚ä½•ä¼˜åŒ–çš„</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡æ¥æºäºå…¬å¸å†…éƒ¨çš„ä¸€æ¬¡é—ªç”µåˆ†äº«ï¼Œç¨ä½œæ¶¦è‰²åˆ†äº«å‡ºæ¥ã€‚ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚&lt;strong&gt;å¦‚æœä½ è§‰å¾—å¯ä»¥ï¼Œè¯·å¤šç‚¹èµï¼Œé¼“åŠ±æˆ‘å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« &lt;/strong&gt;ğŸ™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;React æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ä¸‰ä¸ªæ–¹å‘ï¼Œå…¶å®
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] Preact</title>
    <link href="https://bobi.ink/2019/06/02/preact-map/"/>
    <id>https://bobi.ink/2019/06/02/preact-map/</id>
    <published>2019-06-01T16:00:00.000Z</published>
    <updated>2019-06-07T23:04:38.874Z</updated>
    
    <content type="html"><![CDATA[<p>React çš„ä»£ç åº“ç°åœ¨å·²ç»æ¯”è¾ƒåºå¤§äº†ï¼ŒåŠ ä¸Š v16 çš„ Fiber é‡æ„ï¼Œåˆå­¦è€…å¾ˆå®¹æ˜“é™·å…¥ç»†èŠ‚çš„æ±ªæ´‹å¤§æµ·ï¼Œææ‡‚äº†ä¼šè®©äººè§‰å¾—è‡ªå·±å¾ˆç‰›é€¼ï¼Œæä¸æ‡‚å¾ˆå®¹æ˜“è®©äººå¤±å»ä¿¡å¿ƒ, æ€€ç–‘è‡ªå·±æ˜¯å¦åº”è¯¥ç»§ç»­æå‰ç«¯ã€‚é‚£ä¹ˆå°è¯•åœ¨æœ¬æ–‡è¿™é‡Œæ‰¾å›ä¸€ç‚¹è‡ªä¿¡å§(é«˜æ‰‹ç»•è·¯).</p><p>Preact æ˜¯ React çš„ç¼©ç•¥ç‰ˆ, ä½“ç§¯éå¸¸å°, ä½†äº”è„ä¿±å…¨. å¦‚æœä½ æƒ³äº†è§£ React çš„åŸºæœ¬åŸç†, å¯ä»¥å»å­¦ä¹ å­¦ä¹  Preact çš„æºç , è¿™ä¹Ÿæ­£æ˜¯æœ¬æ–‡çš„ç›®çš„ã€‚</p><p>å…³äº React åŸç†çš„ä¼˜ç§€çš„æ–‡ç« å·²ç»éå¸¸å¤š, æœ¬æ–‡å°±æ˜¯è€é…’è£…æ–°ç“¶, ç®—æ˜¯è‡ªå·±çš„ä¸€ç‚¹æ€»ç»“ï¼Œä¹Ÿä¸ºåé¢çš„æ–‡ç« ä½œä¸€ä¸‹é“ºå«å§.</p><p>æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œé˜…è¯»æ—¶é—´çº¦ 20minï¼Œä¸»è¦è¢«ä»£ç å æ®ï¼Œå¦å¤–ä¹Ÿç”»äº†æµç¨‹å›¾é…åˆç†è§£ä»£ç ã€‚</p><blockquote><p>æ³¨æ„ï¼šä»£ç æœ‰æ‰€ç®€åŒ–ï¼Œå¿½ç•¥æ‰ svgã€replaceNodeã€context ç­‰ç‰¹æ€§<br>æœ¬æ–‡ä»£ç åŸºäº Preact v10 ç‰ˆæœ¬</p></blockquote><p><br></p><!-- TOC --><ul><li><a href="#virtual-dom">Virtual-DOM</a></li><li><a href="#ä»-createelement-å¼€å§‹">ä» createElement å¼€å§‹</a></li><li><a href="#component-çš„å®ç°">Component çš„å®ç°</a></li><li><a href="#diff-ç®—æ³•">diff ç®—æ³•</a><ul><li><a href="#diffchildren">diffChildren</a></li><li><a href="#diff">diff</a></li><li><a href="#diffelementnodes">diffElementNodes</a></li><li><a href="#diffprops">diffProps</a></li></ul></li><li><a href="#hooks-çš„å®ç°">Hooks çš„å®ç°</a><ul><li><a href="#usestate">useState</a></li><li><a href="#useeffect">useEffect</a></li></ul></li><li><a href="#æŠ€æœ¯åœ°å›¾">æŠ€æœ¯åœ°å›¾</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><h2 id="virtual-dom"><a href="#virtual-dom" class="headerlink" title="Virtual-DOM"></a>Virtual-DOM</h2><center><br> <img src="/images/07/vd.png" width="500"><br></center><p>Virtual-DOM å…¶å®å°±æ˜¯ä¸€é¢—å¯¹è±¡æ ‘ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œè¿™ä¸ªå¯¹è±¡æ ‘æœ€ç»ˆè¦æ˜ å°„åˆ°å›¾å½¢å¯¹è±¡. Virtual-DOM æ¯”è¾ƒæ ¸å¿ƒçš„æ˜¯å®ƒçš„<code>diffç®—æ³•</code>.</p><p>ä½ å¯ä»¥æƒ³è±¡è¿™é‡Œæœ‰ä¸€ä¸ª<code>DOMæ˜ å°„å™¨</code>ï¼Œè§åçŸ¥ä¹‰ï¼Œ<strong>è¿™ä¸ªâ€™DOM æ˜ å°„å™¨â€˜çš„å·¥ä½œå°±æ˜¯å°† Virtual-DOM å¯¹è±¡æ ‘æ˜ å°„æµè§ˆå™¨é¡µé¢çš„ DOMï¼Œåªä¸è¿‡ä¸ºäº†æé«˜ DOM çš„â€™æ“ä½œæ€§èƒ½â€™. å®ƒä¸æ˜¯æ¯ä¸€æ¬¡éƒ½å…¨é‡æ¸²æŸ“æ•´ä¸ª Virtual-DOM æ ‘ï¼Œè€Œæ˜¯æ”¯æŒæ¥æ”¶ä¸¤é¢— Virtual-DOM å¯¹è±¡æ ‘(ä¸€ä¸ªæ›´æ–°å‰ï¼Œä¸€ä¸ªæ›´æ–°å), é€šè¿‡ diff ç®—æ³•è®¡ç®—å‡ºä¸¤é¢— Virtual-DOM æ ‘å·®å¼‚çš„åœ°æ–¹ï¼Œç„¶ååªåº”ç”¨è¿™äº›å·®å¼‚çš„åœ°æ–¹åˆ°å®é™…çš„ DOM æ ‘, ä»è€Œå‡å°‘ DOM å˜æ›´çš„æˆæœ¬.</strong></p><p>Virtual-DOM æ˜¯æ¯”è¾ƒæœ‰äº‰è®®æ€§ï¼Œæ¨èé˜…è¯»<a href="https://www.zhihu.com/question/31809713/answer/53544875" target="_blank" rel="noopener">ã€Šç½‘ä¸Šéƒ½è¯´æ“ä½œçœŸå® DOM æ…¢ï¼Œä½†æµ‹è¯•ç»“æœå´æ¯” React æ›´å¿«ï¼Œä¸ºä»€ä¹ˆï¼Ÿã€‹</a> ã€‚åˆ‡è®°æ°¸è¿œéƒ½ä¸è¦ç¦»å¼€åœºæ™¯å»è¯„åˆ¤ä¸€ä¸ªæŠ€æœ¯çš„å¥½åã€‚å½“åˆç½‘ä¸ŠæŠŠ React å¹å¾—å¤šä¹ˆç‰›é€¼, ä¸€äº›å°ç™½å°±ä¼šè§‰å¾— Virtual-DOM å¾ˆåŠï¼ŒJQuery å¼±çˆ†äº†ã€‚</p><p>æˆ‘è§‰å¾—ä¸¤ä¸ªå¯æ¯”æ€§ä¸å¤§ï¼Œä»æ€§èƒ½ä¸Šçœ‹, <strong>æ¡†æ¶å†æ€ä¹ˆç‰›é€¼å®ƒä¹Ÿæ˜¯éœ€è¦æ“ä½œåŸç”Ÿ DOM çš„ï¼Œè€Œä¸”å®ƒæœªå¿…æœ‰ä½ ä½¿ç”¨ JQuery æ‰‹åŠ¨æ“ä½œ DOM æ¥å¾—â€™ç²¾ç»†â€™</strong>. æ¡†æ¶ä¸åˆç†ä½¿ç”¨ä¹Ÿå¯èƒ½å‡ºç°ä¿®æ”¹ä¸€ä¸ªå°çŠ¶æ€ï¼Œå¯¼è‡´æ¸²æŸ“é›ªå´©(å¤§èŒƒå›´é‡æ–°æ¸²æŸ“)çš„æƒ…å†µ; åŒç† JQuery è™½ç„¶å¯ä»¥ç²¾ç»†åŒ–æ“ä½œ DOM, ä½†æ˜¯ä¸åˆç†çš„ DOM æ›´æ–°ç­–ç•¥å¯èƒ½ä¹Ÿä¼šæˆä¸ºåº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆ. æ‰€ä»¥å…³é”®è¿˜å¾—çœ‹ä½ æ€ä¹ˆç”¨.</p><p>é‚£ä¸ºä»€ä¹ˆéœ€è¦ Virtual-DOMï¼Ÿ</p><p><strong>æˆ‘ä¸ªäººçš„ç†è§£å°±æ˜¯ä¸ºäº†è§£æ”¾ç”Ÿäº§åŠ›ã€‚ç°å¦‚ä»Šç¡¬ä»¶çš„æ€§èƒ½è¶Šæ¥è¶Šå¥½ï¼Œweb åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œç”Ÿäº§åŠ›ä¹Ÿæ˜¯è¦è·Ÿä¸Šçš„</strong>. å°½ç®¡æ‰‹åŠ¨æ“ä½œ DOM å¯èƒ½å¯ä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†æ˜¯è¿™æ ·å¯¹å¤§éƒ¨åˆ†å¼€å‘è€…æ¥è¯´å¤ªä½æ•ˆäº†ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ¥å—ç‰ºç‰²ä¸€ç‚¹æ€§èƒ½æ¢å–æ›´é«˜çš„å¼€å‘æ•ˆç‡çš„.</p><p>æ‰€ä»¥è¯´ Virtual-DOM æ›´å¤§çš„æ„ä¹‰åœ¨äºå¼€å‘æ–¹å¼çš„æ”¹å˜: å£°æ˜å¼ã€ æ•°æ®é©±åŠ¨, è®©å¼€å‘è€…ä¸éœ€è¦å…³å¿ƒ DOM çš„æ“ä½œç»†èŠ‚(å±æ€§æ“ä½œã€äº‹ä»¶ç»‘å®šã€DOM èŠ‚ç‚¹å˜æ›´)ï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨çš„å¼€å‘æ–¹å¼å˜æˆäº†<code>view=f(state)</code>, è¿™å¯¹ç”Ÿäº§åŠ›çš„è§£æ”¾æ˜¯æœ‰å¾ˆå¤§æ¨åŠ¨ä½œç”¨çš„.</p><p>å½“ç„¶ Virtual-DOM ä¸æ˜¯å”¯ä¸€ï¼Œä¹Ÿä¸æ˜¯ç¬¬ä¸€ä¸ªçš„è¿™æ ·è§£å†³æ–¹æ¡ˆ. æ¯”å¦‚ AngularJS, Vue1.x è¿™äº›åŸºäºæ¨¡æ¿çš„å®ç°æ–¹å¼, ä¹Ÿå¯ä»¥è¯´å®ç°è¿™ç§å¼€å‘æ–¹å¼è½¬å˜çš„. é‚£ç›¸å¯¹äºä»–ä»¬ Virtual-DOM çš„ä¹°ç‚¹å¯èƒ½å°±æ˜¯æ›´é«˜çš„æ€§èƒ½äº†, å¦å¤– Virtual-DOM åœ¨æ¸²æŸ“å±‚ä¸Šé¢çš„æŠ½è±¡æ›´åŠ å½»åº•, ä¸å†è€¦åˆäº DOM æœ¬èº«ï¼Œæ¯”å¦‚å¯ä»¥æ¸²æŸ“ä¸º ReactNativeï¼ŒPDFï¼Œç»ˆç«¯ UI ç­‰ç­‰ã€‚</p><p><br></p><hr><p><br></p><h2 id="ä»-createelement-å¼€å§‹"><a href="#ä»-createelement-å¼€å§‹" class="headerlink" title="ä» createElement å¼€å§‹"></a>ä» createElement å¼€å§‹</h2><p>å¾ˆå¤šå°ç™½å°† <code>JSX</code> ç­‰ä»·ä¸º Virtual-DOMï¼Œå…¶å®è¿™ä¸¤è€…å¹¶æ²¡æœ‰ç›´æ¥çš„å…³ç³», æˆ‘ä»¬çŸ¥é“ <strong>JSX ä¸è¿‡æ˜¯ä¸€ä¸ªè¯­æ³•ç³–</strong>.</p><p>ä¾‹å¦‚<code>&lt;a href=&quot;/&quot;&gt;&lt;span&gt;Home&lt;/span&gt;&lt;/a&gt;</code>æœ€ç»ˆä¼šè½¬æ¢ä¸º<code>h(&#39;a&#39;, { href:&#39;/&#39; }, h(&#39;span&#39;, null, &#39;Home&#39;))</code>è¿™ç§å½¢å¼, <code>h</code>æ˜¯ JSX Element å·¥å‚æ–¹æ³•.</p><p><code>h</code> åœ¨ React ä¸‹çº¦å®šæ˜¯<code>React.createElement</code>, è€Œå¤§éƒ¨åˆ† Virtual-DOM æ¡†æ¶åˆ™ä½¿ç”¨<code>h</code>. <code>h</code> æ˜¯ <code>createElement</code> çš„åˆ«å, Vue ç”Ÿæ€ç³»ç»Ÿä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ªæƒ¯ä¾‹, å…·ä½“ä¸ºä»€ä¹ˆæ²¡ä½œè€ƒç©¶(æ¯”è¾ƒç®€çŸ­ï¼Ÿ)ã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>@jsx</code>æ³¨è§£æˆ– babel é…ç½®é¡¹æ¥é…ç½® JSX å·¥å‚ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @jsx h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello jsx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, el);</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸æ˜¯ React æˆ– Preact çš„å…¥é—¨æ–‡ç« ï¼Œæ‰€ä»¥ç‚¹åˆ°ä¸ºæ­¢ï¼Œæ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹<a href="https://preactjs.com/guide/getting-started" target="_blank" rel="noopener">å®˜æ–¹æ•™ç¨‹</a>.</p><p>ç°åœ¨æ¥çœ‹çœ‹<code>createElement</code>, <strong>createElement ä¸è¿‡å°±æ˜¯æ„é€ ä¸€ä¸ªå¯¹è±¡(VNode)</strong>:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸type èŠ‚ç‚¹çš„ç±»å‹ï¼Œæœ‰DOMå…ƒç´ (string)å’Œè‡ªå®šä¹‰ç»„ä»¶ï¼Œä»¥åŠFragment, ä¸ºnullæ—¶è¡¨ç¤ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, children</span>) </span>&#123;</span><br><span class="line">  props.children = children;</span><br><span class="line">  <span class="comment">// âš›ï¸åº”ç”¨defaultProps</span></span><br><span class="line">  <span class="keyword">if</span> (type != <span class="literal">null</span> &amp;&amp; type.defaultProps != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> type.defaultProps)</span><br><span class="line">      <span class="keyword">if</span> (props[i] === <span class="literal">undefined</span>) props[i] = type.defaultProps[i];</span><br><span class="line">  <span class="keyword">let</span> ref = props.ref;</span><br><span class="line">  <span class="keyword">let</span> key = props.key;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸æ„å»ºVNodeå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> createVNode(type, props, key, ref);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createVNode</span>(<span class="params">type, props, key, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; type, props, key, ref, <span class="comment">/* ... å¿½ç•¥éƒ¨åˆ†å†…ç½®å­—æ®µ */</span> <span class="keyword">constructor</span>: undefined &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p>é€šè¿‡ JSX å’Œç»„ä»¶, å¯ä»¥æ„é€ å¤æ‚çš„å¯¹è±¡æ ‘:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">render(</span><br><span class="line">  &lt;div className=<span class="string">"container"</span>&gt;</span><br><span class="line">    &lt;SideBar /&gt;</span><br><span class="line">    &lt;Body /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">  root,</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h2 id="component-çš„å®ç°"><a href="#component-çš„å®ç°" class="headerlink" title="Component çš„å®ç°"></a>Component çš„å®ç°</h2><p>å¯¹äºä¸€ä¸ªè§†å›¾æ¡†æ¶æ¥è¯´ï¼Œç»„ä»¶å°±æ˜¯å®ƒçš„çµé­‚, å°±åƒå‡½æ•°ä¹‹äºå‡½æ•°å¼è¯­è¨€ï¼Œç±»ä¹‹äºé¢å‘å¯¹è±¡è¯­è¨€, æ²¡æœ‰ç»„ä»¶åˆ™æ— æ³•ç»„æˆå¤æ‚çš„åº”ç”¨.</p><p>ç»„ä»¶åŒ–çš„æ€ç»´æ¨èå°†ä¸€ä¸ªåº”ç”¨åˆ†è€Œæ²»ä¹‹, æ‹†åˆ†å’Œç»„åˆä¸åŒçº§åˆ«çš„ç»„ä»¶ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–åº”ç”¨çš„å¼€å‘å’Œç»´æŠ¤ï¼Œè®©ç¨‹åºæ›´å¥½ç†è§£. ä»æŠ€æœ¯ä¸Šçœ‹<strong>ç»„ä»¶æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å…ƒç´ ç±»å‹ï¼Œå¯ä»¥å£°æ˜ç»„ä»¶çš„è¾“å…¥(props)ã€æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€ä»¥åŠæ–¹æ³•ã€æœ€ç»ˆè¾“å‡º Virtual-DOM å¯¹è±¡æ ‘, ä½œä¸ºåº”ç”¨ Virtual-DOM æ ‘çš„ä¸€ä¸ªåˆ†æ”¯å­˜åœ¨</strong>.</p><p>Preact çš„è‡ªå®šä¹‰ç»„ä»¶æ˜¯åŸºäº Component ç±»å®ç°çš„. å¯¹ç»„ä»¶æ¥è¯´æœ€åŸºæœ¬çš„å°±æ˜¯çŠ¶æ€çš„ç»´æŠ¤, è¿™ä¸ªé€šè¿‡ setState æ¥å®ç°:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params">props, context</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸setStateå®ç°</span></span><br><span class="line">Component.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">update, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…‹éš†ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„State, _nextStateä¼šåœ¨ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹å¼ä¸­ç”¨åˆ°(ä¾‹å¦‚shouldComponentUpdate)</span></span><br><span class="line">  <span class="keyword">let</span> s = (<span class="keyword">this</span>._nextState !== <span class="keyword">this</span>.state &amp;&amp; <span class="keyword">this</span>._nextState) ||</span><br><span class="line">    (<span class="keyword">this</span>._nextState = assign(&#123;&#125;, <span class="keyword">this</span>.state));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// stateæ›´æ–°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> update !== <span class="string">'function'</span> || (update = update(s, <span class="keyword">this</span>.props)))</span><br><span class="line">    assign(s, update);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._vnode) &#123; <span class="comment">// å·²æŒ‚è½½</span></span><br><span class="line">    <span class="comment">// æ¨å…¥æ¸²æŸ“å›è°ƒé˜Ÿåˆ—, åœ¨æ¸²æŸ“å®Œæˆåæ‰¹é‡è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (callback) <span class="keyword">this</span>._renderCallbacks.push(callback);</span><br><span class="line">    <span class="comment">// æ”¾å…¥å¼‚æ­¥è°ƒåº¦é˜Ÿåˆ—</span></span><br><span class="line">    enqueueRender(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p><code>enqueueRender</code> å°†ç»„ä»¶æ”¾è¿›ä¸€ä¸ªå¼‚æ­¥çš„æ‰¹æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·å¯ä»¥å½’å¹¶é¢‘ç¹çš„ setState è°ƒç”¨ï¼Œå®ç°ä¹Ÿéå¸¸ç®€å•:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> q = [];</span><br><span class="line"><span class="comment">// å¼‚æ­¥è°ƒåº¦å™¨ï¼Œç”¨äºå¼‚æ­¥æ‰§è¡Œä¸€ä¸ªå›è°ƒ</span></span><br><span class="line"><span class="keyword">const</span> defer = <span class="keyword">typeof</span> <span class="built_in">Promise</span> == <span class="string">'function'</span></span><br><span class="line">    ? <span class="built_in">Promise</span>.prototype.then.bind(<span class="built_in">Promise</span>.resolve()) <span class="comment">// micro task</span></span><br><span class="line">    : setTimeout; <span class="comment">// å›è°ƒåˆ°setTimeout</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enqueueRender</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸éœ€è¦é‡å¤æ¨å…¥å·²ç»åœ¨é˜Ÿåˆ—çš„Component</span></span><br><span class="line">  <span class="keyword">if</span> (!c._dirty &amp;&amp; (c._dirty = <span class="literal">true</span>) &amp;&amp; q.push(c) === <span class="number">1</span>)</span><br><span class="line">    defer(process); <span class="comment">// å½“é˜Ÿåˆ—ä»ç©ºå˜ä¸ºéç©ºæ—¶ï¼Œå¼€å§‹è°ƒåº¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹é‡æ¸…ç©ºé˜Ÿåˆ—, è°ƒç”¨Componentçš„forceUpdate</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> p;</span><br><span class="line">  <span class="comment">// æ’åºé˜Ÿåˆ—ï¼Œä»ä½å±‚çš„ç»„ä»¶ä¼˜å…ˆæ›´æ–°?</span></span><br><span class="line">  q.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b._depth - a._depth);</span><br><span class="line">  <span class="keyword">while</span> ((p = q.pop()))</span><br><span class="line">    <span class="keyword">if</span> (p._dirty) p.forceUpdate(<span class="literal">false</span>); <span class="comment">// falseè¡¨ç¤ºä¸è¦å¼ºåˆ¶æ›´æ–°ï¼Œå³ä¸è¦å¿½ç•¥shouldComponentUpdate</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>Ok, ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡º <code>setState</code> æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨ <code>forceUpdate</code> è¿›è¡Œç»„ä»¶é‡æ–°æ¸²æŸ“çš„ï¼Œæ¥å¾€ä¸‹æŒ–ä¸€æŒ– forceUpdate çš„å®ç°.</p><blockquote><p>è¿™é‡Œæš‚ä¸”å¿½ç•¥ diff, <strong>å°† diff è§†ä½œä¸€ä¸ªé»‘ç›’ï¼Œä»–å°±æ˜¯ä¸€ä¸ª DOM æ˜ å°„å™¨, åƒä¸Šé¢è¯´çš„ diff æ¥æ”¶ä¸¤æ£µ VNode æ ‘, ä»¥åŠä¸€ä¸ª DOM æŒ‚è½½ç‚¹, åœ¨æ¯”å¯¹çš„è¿‡ç¨‹ä¸­å®ƒå¯ä»¥ä¼šåˆ›å»ºã€ç§»é™¤æˆ–æ›´æ–°ç»„ä»¶å’Œ DOM å…ƒç´ ï¼Œè§¦å‘å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>.</p></blockquote><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Component.prototype.forceUpdate = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123; <span class="comment">// callbackæ”¾ç½®æ¸²æŸ“å®Œæˆåçš„å›è°ƒ</span></span><br><span class="line">  <span class="keyword">let</span> vnode = <span class="keyword">this</span>._vnode, dom = <span class="keyword">this</span>._vnode._dom, parentDom = <span class="keyword">this</span>._parentDom;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (parentDom) &#123; <span class="comment">// å·²æŒ‚è½½è¿‡</span></span><br><span class="line">    <span class="keyword">const</span> force = callback !== <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> mounts = [];</span><br><span class="line">    <span class="comment">// è°ƒç”¨diffå¯¹å½“å‰ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“å’ŒVirtual-DOMæ¯”å¯¹</span></span><br><span class="line">    <span class="comment">// âš›ï¸æš‚ä¸”å¿½ç•¥è¿™äº›å‚æ•°, å°†diffè§†ä½œä¸€ä¸ªé»‘ç›’ï¼Œä»–å°±æ˜¯ä¸€ä¸ªDOMæ˜ å°„å™¨ï¼Œ</span></span><br><span class="line">    dom = diff(parentDom, vnode, vnode, mounts, <span class="keyword">this</span>._ancestorComponent, force, dom);</span><br><span class="line">    <span class="keyword">if</span> (dom != <span class="literal">null</span> &amp;&amp; dom.parentNode !== parentDom)</span><br><span class="line">      parentDom.appendChild(dom);</span><br><span class="line">    commitRoot(mounts, vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (callback) callback();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>åœ¨çœ‹çœ‹ <code>render</code> æ–¹æ³•, å®ç°è·Ÿ forceUpdate å·®ä¸å¤š, éƒ½æ˜¯è°ƒç”¨ diff ç®—æ³•æ¥æ‰§è¡Œ DOM æ›´æ–°ï¼Œåªä¸è¿‡ç”±å¤–éƒ¨æŒ‡å®šä¸€ä¸ª DOM å®¹å™¨:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–ç‰ˆ</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, parentDom</span>) </span>&#123;</span><br><span class="line">  vnode = createElement(Fragment, <span class="literal">null</span>, [vnode]);</span><br><span class="line">  parentDom.childNodes.forEach(<span class="function"><span class="params">i</span> =&gt;</span> i.remove())</span><br><span class="line">  <span class="keyword">let</span> mounts = [];</span><br><span class="line">  diffChildren(parentDom, <span class="literal">null</span> oldVNode, mounts, vnode, EMPTY_OBJ);</span><br><span class="line">  commitRoot(mounts, vnode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>æ¢³ç†ä¸€ä¸‹ä¸Šé¢çš„æµç¨‹:</p><center><br>  <img src="/images/07/setState.png" width="800"><br></center><p>åˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰çœ‹åˆ°ç»„ä»¶çš„å…¶ä»–åŠŸèƒ½ï¼Œå¦‚åˆå§‹åŒ–ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚è¿™äº›ç‰¹æ€§åœ¨ diff å‡½æ•°ä¸­å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç»„ä»¶æŒ‚è½½æˆ–æ›´æ–°çš„è¿‡ç¨‹ä¸­è¢«è°ƒç”¨ã€‚ä¸‹ä¸€èŠ‚å°±ä¼šä»‹ç» diff</p><p><br></p><hr><p><br></p><h2 id="diff-ç®—æ³•"><a href="#diff-ç®—æ³•" class="headerlink" title="diff ç®—æ³•"></a>diff ç®—æ³•</h2><p>åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œé€šè¿‡ä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼Œ<code>createElement</code> å’Œ <code>Component</code> é€»è¾‘éƒ½å¾ˆè–„ï¼Œ ä¸»è¦çš„é€»è¾‘è¿˜æ˜¯é›†ä¸­åœ¨ diff å‡½æ•°ä¸­. React å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <code>Reconciliation</code>, åœ¨ Preact ä¸­ç§°ä¸º <code>Differantiate</code>.</p><p>ä¸ºäº†ç®€åŒ–ç¨‹åº Preact çš„å®ç°å°† diff å’Œ DOM æ‚ç³…åœ¨ä¸€èµ·, ä½†é€»è¾‘è¿˜æ˜¯å¾ˆæ¸…æ™°ï¼Œçœ‹ä¸‹ç›®å½•ç»“æ„å°±çŸ¥é“äº†:</p><p><br></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/diff</span><br><span class="line">â”œâ”€â”€ children.js # æ¯”å¯¹childrenæ•°ç»„</span><br><span class="line">â”œâ”€â”€ index.js    # æ¯”å¯¹ä¸¤ä¸ªèŠ‚ç‚¹</span><br><span class="line">â””â”€â”€ props.js    # æ¯”å¯¹ä¸¤ä¸ªDOMèŠ‚ç‚¹çš„props</span><br></pre></td></tr></table></figure><center><br>  <img src="/images/07/diff.png" width="600"><br></center><p><br></p><p>åœ¨æ·±å…¥ diff ç¨‹åºä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹åŸºæœ¬çš„å¯¹è±¡ç»“æ„, æ–¹ä¾¿åé¢ç†è§£ç¨‹åºæµç¨‹. å…ˆæ¥çœ‹ä¸‹ VNode çš„å¤–å½¢:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type ComponentFactory&lt;P&gt; = preact.ComponentClass&lt;P&gt; | FunctionalComponent&lt;P&gt;;</span><br><span class="line"></span><br><span class="line">interface VNode&lt;P = &#123;&#125;&gt; &#123;</span><br><span class="line">  <span class="comment">// èŠ‚ç‚¹ç±»å‹, å†…ç½®DOMå…ƒç´ ä¸ºstringç±»å‹ï¼Œè€Œè‡ªå®šä¹‰ç»„ä»¶åˆ™æ˜¯Componentç±»å‹ï¼ŒPreactä¸­å‡½æ•°ç»„ä»¶åªæ˜¯ç‰¹æ®Šçš„Componentç±»å‹</span></span><br><span class="line">  type: string | ComponentFactory&lt;P&gt; | <span class="literal">null</span>;</span><br><span class="line">  props: P &amp; &#123; <span class="attr">children</span>: ComponentChildren &#125; | string | number | <span class="literal">null</span>;</span><br><span class="line">  key: Key</span><br><span class="line">  ref: Ref&lt;any&gt; | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å†…éƒ¨ç¼“å­˜ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// VNodeå­èŠ‚ç‚¹</span></span><br><span class="line">  _children: <span class="built_in">Array</span>&lt;VNode&gt; | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å…³è”çš„DOMèŠ‚ç‚¹, å¯¹äºFragmentæ¥è¯´ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">  _dom: PreactElement | Text | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// Fragment, æˆ–è€…ç»„ä»¶è¿”å›Fragmentçš„æœ€åä¸€ä¸ªDOMå­èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">  _lastDomChild: PreactElement | Text | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// Componentå®ä¾‹</span></span><br><span class="line">  _component: Component | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="diffchildren"><a href="#diffchildren" class="headerlink" title="diffChildren"></a>diffChildren</h3><p>å…ˆä»æœ€ç®€å•çš„å¼€å§‹, ä¸Šé¢å·²ç»çŒœå‡º diffChildren ç”¨äºæ¯”å¯¹ä¸¤ä¸ª VNode åˆ—è¡¨.</p><center><br>  <img src="/images/07/diffChildren-base.png" width="600"><br></center><p>å¦‚ä¸Šå›¾, é¦–å…ˆè¿™é‡Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªè¡¨ç¤ºå½“å‰æ’å…¥ä½ç½®çš„å˜é‡ oldDOM, å®ƒä¸€å¼€å§‹æŒ‡å‘ DOM childrenNode çš„ç¬¬ä¸€ä¸ªå…ƒç´ , åé¢æ¯æ¬¡æ’å…¥æ›´æ–°æˆ–æ’å…¥ newDOMï¼Œéƒ½ä¼šæŒ‡å‘ newDOM çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ .</p><p>åœ¨éå† newChildren åˆ—è¡¨è¿‡ç¨‹ä¸­, ä¼šå°è¯•æ‰¾å‡ºç›¸åŒ key çš„æ—§ VNodeï¼Œå’Œå®ƒè¿›è¡Œ diff. å¦‚æœæ–° VNode å’Œæ—§ VNode ä½ç½®ä¸ä¸€æ ·ï¼Œè¿™å°±éœ€è¦ç§»åŠ¨å®ƒä»¬;å¯¹äºæ–°å¢çš„ DOMï¼Œå¦‚æœæ’å…¥ä½ç½®(oldDOM)å·²ç»åˆ°äº†ç»“å°¾ï¼Œåˆ™ç›´æ¥è¿½åŠ åˆ°çˆ¶èŠ‚ç‚¹, å¦åˆ™æ’å…¥åˆ° oldDOM ä¹‹å‰ã€‚</p><p>æœ€åå¸è½½æ—§ VNode åˆ—è¡¨ä¸­æœªä½¿ç”¨çš„ VNode.</p><p>æ¥è¯¦ç»†çœ‹çœ‹æºç :</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diffChildren</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentDom,         <span class="regexp">//</span> childrençš„çˆ¶DOMå…ƒç´ </span></span></span><br><span class="line"><span class="function"><span class="params">  newParentVNode,    <span class="regexp">//</span> childrençš„æ–°çˆ¶VNode</span></span></span><br><span class="line"><span class="function"><span class="params">  oldParentVNode,    <span class="regexp">//</span> childrençš„æ—§çˆ¶VNodeï¼ŒdiffChildrenä¸»è¦æ¯”å¯¹è¿™ä¸¤ä¸ªVnodeçš„children</span></span></span><br><span class="line"><span class="function"><span class="params">  mounts,            <span class="regexp">//</span> ä¿å­˜åœ¨è¿™æ¬¡æ¯”å¯¹è¿‡ç¨‹ä¸­è¢«æŒ‚è½½çš„ç»„ä»¶å®ä¾‹ï¼Œåœ¨æ¯”å¯¹åï¼Œä¼šè§¦å‘è¿™äº›ç»„ä»¶çš„componentDidMountç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span></span><br><span class="line"><span class="function"><span class="params">  ancestorComponent, <span class="regexp">//</span> childrençš„ç›´æ¥çˆ¶<span class="string">'ç»„ä»¶'</span>, å³æ¸²æŸ“(render</span>)<span class="title">VNode</span>çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="function">  <span class="title">oldDom</span>,            // å½“å‰æŒ‚è½½çš„<span class="title">DOM</span>ï¼Œå¯¹äº<span class="title">diffChildren</span>æ¥è¯´ï¼Œ<span class="title">oldDom</span>ä¸€å¼€å§‹æŒ‡å‘ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> newChildren = newParentVNode._children || toChildArray(newParentVNode.props.children, (newParentVNode._children = []), coerceToVNode, <span class="literal">true</span>,);</span><br><span class="line">  <span class="keyword">let</span> oldChildren = (oldParentVNode &amp;&amp; oldParentVNode._children) || EMPTY_ARR;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸éå†æ–°children</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; newChildren.length; i++) &#123;</span><br><span class="line">    childVNode = newChildren[i] = coerceToVNode(newChildren[i]); <span class="comment">// è§„èŒƒåŒ–VNode</span></span><br><span class="line">    <span class="keyword">if</span> (childVNode == <span class="literal">null</span>) <span class="keyword">continue</span></span><br><span class="line">    <span class="comment">// âš›ï¸æŸ¥æ‰¾oldChildrenä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å…ƒç´ ï¼Œå¦‚æœæ‰¾åˆ°åˆ™é€šè¿‡è®¾ç½®ä¸ºundefinedï¼Œä»oldChildrenä¸­ç§»é™¤</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™ä¿æŒä¸ºnull</span></span><br><span class="line">    oldVNode = oldChildren[i];</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; oldChildrenLength; j++) &#123;</span><br><span class="line">      oldVNode = oldChildren[j];</span><br><span class="line">      <span class="keyword">if</span> (oldVNode &amp;&amp; childVNode.key == oldVNode.key &amp;&amp; childVNode.type === oldVNode.type) &#123;</span><br><span class="line">        oldChildren[j] = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      oldVNode = <span class="literal">null</span>; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ—§nodeï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªæ–°çš„</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// âš›ï¸ é€’å½’æ¯”å¯¹VNode</span></span><br><span class="line">    newDom = diff(parentDom, childVNode, oldVNode, mounts, ancestorComponent, <span class="literal">null</span>, oldDom);</span><br><span class="line">    <span class="comment">// vnodeæ²¡æœ‰è¢«diffå¸è½½æ‰</span></span><br><span class="line">    <span class="keyword">if</span> (newDom != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (childVNode._lastDomChild != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸å½“å‰VNodeæ˜¯Fragmentç±»å‹</span></span><br><span class="line">        <span class="comment">// åªæœ‰Fragmentæˆ–ç»„ä»¶è¿”å›Fragmentçš„Vnodeä¼šæœ‰énullçš„_lastDomChild, ä»Fragmentçš„ç»“å°¾çš„DOMæ ‘å¼€å§‹æ¯”å¯¹:</span></span><br><span class="line">        <span class="comment">// &lt;A&gt;                               &lt;A&gt;</span></span><br><span class="line">        <span class="comment">//  &lt;&gt;                                 &lt;&gt;   ğŸ‘ˆ Fragmentç±»å‹ï¼Œdiffä¼šé€’å½’æ¯”å¯¹å®ƒçš„childrenï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬åªéœ€è¦å°†newDomæŒ‡å‘æ¯”å¯¹åçš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å³å¯</span></span><br><span class="line">        <span class="comment">//    &lt;a&gt;a&lt;/a&gt;           &lt;- diff -&gt;      &lt;b&gt;b&lt;/b&gt;</span></span><br><span class="line">        <span class="comment">//    &lt;b&gt;b&lt;/b&gt;                           &lt;a&gt;a&lt;/a&gt; ----+</span></span><br><span class="line">        <span class="comment">//  &lt;/&gt;                                &lt;/&gt;             \</span></span><br><span class="line">        <span class="comment">//                                     &lt;div&gt;x&lt;/div&gt;     ğŸ‘ˆoldDomä¼šæŒ‡å‘è¿™é‡Œ</span></span><br><span class="line">        <span class="comment">// &lt;/A&gt;                              &lt;/A&gt;</span></span><br><span class="line">        newDom = childVNode._lastDomChild;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVNode == <span class="literal">null</span> || newDom != oldDom || newDom.parentNode == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ newDomå’Œå½“å‰oldDomä¸åŒ¹é…ï¼Œå°è¯•æ–°å¢æˆ–ä¿®æ”¹ä½ç½®</span></span><br><span class="line">        outer: <span class="keyword">if</span> (oldDom == <span class="literal">null</span> || oldDom.parentNode !== parentDom) &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸oldDomæŒ‡å‘äº†ç»“å°¾, å³åé¢æ²¡æœ‰æ›´å¤šå…ƒç´ äº†ï¼Œç›´æ¥æ’å…¥å³å¯; é¦–æ¬¡æ¸²æŸ“ä¸€èˆ¬ä¼šè°ƒç”¨åˆ°è¿™é‡Œ</span></span><br><span class="line">          parentDom.appendChild(newDom);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ªä¼˜åŒ–æªæ–½ï¼Œå»æ‰ä¹Ÿä¸ä¼šå½±å“æ­£å¸¸ç¨‹åº. ä¸ºäº†ä¾¿äºç†è§£å¯ä»¥å¿½ç•¥è¿™æ®µä»£ç </span></span><br><span class="line">          <span class="comment">// å°è¯•å‘åæŸ¥æ‰¾oldChildLength/2ä¸ªå…ƒç´ ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ä¸éœ€è¦è°ƒç”¨insertBefore. è¿™æ®µä»£ç å¯ä»¥å‡å°‘insertBeforeçš„è°ƒç”¨é¢‘ç‡</span></span><br><span class="line">          <span class="keyword">for</span> (sibDom = oldDom, j = <span class="number">0</span>; (sibDom = sibDom.nextSibling) &amp;&amp; j &lt; oldChildrenLength; j += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sibDom == newDom)</span><br><span class="line">              <span class="keyword">break</span> outer;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// âš›ï¸insertBefore() å°†newDomç§»åŠ¨åˆ°oldDomä¹‹å‰ </span></span><br><span class="line">          parentDom.insertBefore(newDom, oldDom);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// âš›ï¸å…¶ä»–æƒ…å†µï¼ŒnewDom === oldDOMä¸éœ€è¦å¤„ç†</span></span><br><span class="line">      <span class="comment">// âš›ï¸ oldDomæŒ‡å‘ä¸‹ä¸€ä¸ªDOMèŠ‚ç‚¹</span></span><br><span class="line">      oldDom = newDom.nextSibling;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸ å¸è½½æ‰æ²¡æœ‰è¢«ç½®ä¸ºundefinedçš„å…ƒç´ </span></span><br><span class="line">  <span class="keyword">for</span> (i = oldChildrenLength; i--; )</span><br><span class="line">    <span class="keyword">if</span> (oldChildren[i] != <span class="literal">null</span>) unmount(oldChildren[i], ancestorComponent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>é…å›¾ç†è§£ä¸€ä¸‹ diffChilrend çš„è°ƒç”¨è¿‡ç¨‹:</p><center><br>  <img src="/images/07/diffChildren.png" width="600"><br></center><p><br></p><p>æ€»ç»“ä¸€ä¸‹æµç¨‹å›¾</p><center><br>  <img src="/images/07/diffChildren-process.png" width="800"><br></center><p><br></p><hr><p><br></p><h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><p>diff ç”¨äºæ¯”å¯¹ä¸¤ä¸ª VNode èŠ‚ç‚¹. diff å‡½æ•°æ¯”è¾ƒå†—é•¿, ä½†æ˜¯è¿™é‡Œé¢å¹¶æ²¡æœ‰ç‰¹åˆ«å¤æ‚é€»è¾‘ï¼Œä¸»è¦æ˜¯ä¸€äº›è‡ªå®šä¹‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„å¤„ç†ã€‚æ‰€ä»¥å…ˆä¸Šæµç¨‹å›¾ï¼Œä»£ç ä¸æ„Ÿå…´è¶£å¯ä»¥è·³è¿‡.</p><center><br>  <img src="/images/07/diff-process.png" width="800"><br></center><p><br></p><p>æºä»£ç è§£æï¼š</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diff</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentDom,         <span class="regexp">//</span> çˆ¶DOMèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="function"><span class="params">  newVNode,          <span class="regexp">//</span> æ–°VNode</span></span></span><br><span class="line"><span class="function"><span class="params">  oldVNode,          <span class="regexp">//</span> æ—§VNode</span></span></span><br><span class="line"><span class="function"><span class="params">  mounts,            <span class="regexp">//</span> å­˜æ”¾å·²æŒ‚è½½çš„ç»„ä»¶, å°†åœ¨diffç»“æŸåæ‰¹é‡å¤„ç†</span></span></span><br><span class="line"><span class="function"><span class="params">  ancestorComponent, <span class="regexp">//</span> ç›´æ¥çˆ¶ç»„ä»¶</span></span></span><br><span class="line"><span class="function"><span class="params">  force,             <span class="regexp">//</span> æ˜¯å¦å¼ºåˆ¶æ›´æ–°, ä¸ºtrueå°†å¿½ç•¥æ‰shouldComponentUpdate</span></span></span><br><span class="line"><span class="function"><span class="params">  oldDom,            <span class="regexp">//</span> å½“å‰æŒ‚è½½çš„DOMèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    outer: <span class="keyword">if</span> (oldVNode.type === Fragment || newType === Fragment) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸ Fragmentç±»å‹ï¼Œä½¿ç”¨diffChildrenè¿›è¡Œæ¯”å¯¹</span></span><br><span class="line">      diffChildren(parentDom, newVNode, oldVNode, mounts, ancestorComponent, oldDom);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸è®°å½•Fragmentçš„èµ·å§‹DOMå’Œç»“æŸDOM</span></span><br><span class="line">      <span class="keyword">let</span> i = newVNode._children.length;</span><br><span class="line">      <span class="keyword">if</span> (i &amp;&amp; (tmp = newVNode._children[<span class="number">0</span>]) != <span class="literal">null</span>) &#123;</span><br><span class="line">        newVNode._dom = tmp._dom;</span><br><span class="line">        <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">          tmp = newVNode._children[i];</span><br><span class="line">          <span class="keyword">if</span> (newVNode._lastDomChild = tmp &amp;&amp; (tmp._lastDomChild || tmp._dom))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> newType === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸è‡ªå®šä¹‰ç»„ä»¶ç±»å‹</span></span><br><span class="line">      <span class="keyword">if</span> (oldVNode._component) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ ï¸å·²ç»å­˜åœ¨ç»„ä»¶å®ä¾‹</span></span><br><span class="line">        c = newVNode._component = oldVNode._component;</span><br><span class="line">        newVNode._dom = oldVNode._dom;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸åˆå§‹åŒ–ç»„ä»¶å®ä¾‹</span></span><br><span class="line">        <span class="keyword">if</span> (newType.prototype &amp;&amp; newType.prototype.render) &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ç±»ç»„ä»¶</span></span><br><span class="line">          newVNode._component = c = <span class="keyword">new</span> newType(newVNode.props, cctx); <span class="comment">// eslint-disable-line new-cap</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸å‡½æ•°ç»„ä»¶</span></span><br><span class="line">          newVNode._component = c = <span class="keyword">new</span> Component(newVNode.props, cctx);</span><br><span class="line">          c.constructor = newType;</span><br><span class="line">          c.render = doRender;</span><br><span class="line">        &#125;</span><br><span class="line">        c._ancestorComponent = ancestorComponent;</span><br><span class="line">        c.props = newVNode.props;</span><br><span class="line">        <span class="keyword">if</span> (!c.state) c.state = &#123;&#125;;</span><br><span class="line">        isNew = c._dirty = <span class="literal">true</span>;</span><br><span class="line">        c._renderCallbacks = [];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      c._vnode = newVNode;</span><br><span class="line">      <span class="keyword">if</span> (c._nextState == <span class="literal">null</span>) c._nextState = c.state;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸getDerivedStateFromProps ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">      <span class="keyword">if</span> (newType.getDerivedStateFromProps != <span class="literal">null</span>)</span><br><span class="line">        assign(c._nextState == c.state</span><br><span class="line">            ? (c._nextState = assign(&#123;&#125;, c._nextState)) <span class="comment">// æƒ°æ€§æ‹·è´</span></span><br><span class="line">            : c._nextState,</span><br><span class="line">          newType.getDerivedStateFromProps(newVNode.props, c._nextState),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (isNew) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ è°ƒç”¨æŒ‚è½½å‰çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// âš›ï¸ componentWillMount</span></span><br><span class="line">        <span class="keyword">if</span> (newType.getDerivedStateFromProps == <span class="literal">null</span> &amp;&amp; c.componentWillMount != <span class="literal">null</span>) c.componentWillMount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš›ï¸ componentDidMount</span></span><br><span class="line">        <span class="comment">// å°†ç»„ä»¶æ¨å…¥mountsæ•°ç»„ï¼Œåœ¨æ•´ä¸ªç»„ä»¶æ ‘diffå®Œæˆåæ‰¹é‡è°ƒç”¨, ä»–ä»¬åœ¨commitRootæ–¹æ³•ä¸­è¢«è°ƒç”¨</span></span><br><span class="line">        <span class="comment">// æŒ‰ç…§å…ˆè¿›åå‡º(æ ˆ)çš„é¡ºåºè°ƒç”¨, å³å­ç»„ä»¶çš„componentDidMountä¼šå…ˆè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (c.componentDidMount != <span class="literal">null</span>) mounts.push(c);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ è°ƒç”¨é‡æ–°æ¸²æŸ“ç›¸å…³çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// âš›ï¸ componentWillReceiveProps</span></span><br><span class="line">        <span class="keyword">if</span> (newType.getDerivedStateFromProps == <span class="literal">null</span> &amp;&amp; force == <span class="literal">null</span> &amp;&amp; c.componentWillReceiveProps != <span class="literal">null</span>)</span><br><span class="line">          c.componentWillReceiveProps(newVNode.props, cctx);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš›ï¸ shouldComponentUpdate</span></span><br><span class="line">        <span class="keyword">if</span> (!force &amp;&amp; c.shouldComponentUpdate != <span class="literal">null</span> &amp;&amp; c.shouldComponentUpdate(newVNode.props, c._nextState, cctx) === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="comment">// shouldComponentUpdateè¿”å›falseï¼Œå–æ¶ˆæ¸²æŸ“æ›´æ–°</span></span><br><span class="line">          c.props = newVNode.props;</span><br><span class="line">          c.state = c._nextState;</span><br><span class="line">          c._dirty = <span class="literal">false</span>;</span><br><span class="line">          newVNode._lastDomChild = oldVNode._lastDomChild;</span><br><span class="line">          <span class="keyword">break</span> outer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš›ï¸ componentWillUpdate</span></span><br><span class="line">        <span class="keyword">if</span> (c.componentWillUpdate != <span class="literal">null</span>) c.componentWillUpdate(newVNode.props, c._nextState, cctx);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸è‡³æ­¤propså’Œstateå·²ç»ç¡®å®šä¸‹æ¥ï¼Œç¼“å­˜å’Œæ›´æ–°propså’Œstateå‡†å¤‡æ¸²æŸ“</span></span><br><span class="line">      oldProps = c.props;</span><br><span class="line">      oldState = c.state;</span><br><span class="line">      c.props = newVNode.props;</span><br><span class="line">      c.state = c._nextState;</span><br><span class="line">      <span class="keyword">let</span> prev = c._prevVNode || <span class="literal">null</span>;</span><br><span class="line">      c._dirty = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸æ¸²æŸ“</span></span><br><span class="line">      <span class="keyword">let</span> vnode = (c._prevVNode = coerceToVNode(c.render(c.props, c.state)));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸getSnapshotBeforeUpdate</span></span><br><span class="line">      <span class="keyword">if</span> (!isNew &amp;&amp; c.getSnapshotBeforeUpdate != <span class="literal">null</span>) snapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ç»„ä»¶å±‚çº§ï¼Œä¼šå½±å“æ›´æ–°çš„ä¼˜å…ˆçº§</span></span><br><span class="line">      c._depth = ancestorComponent ? (ancestorComponent._depth || <span class="number">0</span>) + <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// âš›ï¸é€’å½’diffæ¸²æŸ“ç»“æœ</span></span><br><span class="line">      c.base = newVNode._dom = diff(parentDom, vnode, prev, mounts, c, <span class="literal">null</span>, oldDom);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (vnode != <span class="literal">null</span>) &#123;</span><br><span class="line">        newVNode._lastDomChild = vnode._lastDomChild;</span><br><span class="line">      &#125;</span><br><span class="line">      c._parentDom = parentDom;</span><br><span class="line">      <span class="comment">// âš›ï¸åº”ç”¨ref</span></span><br><span class="line">      <span class="keyword">if</span> ((tmp = newVNode.ref)) applyRef(tmp, c, ancestorComponent);</span><br><span class="line">      <span class="comment">// âš›ï¸è°ƒç”¨renderCallbacksï¼Œå³setStateçš„å›è°ƒ</span></span><br><span class="line">      <span class="keyword">while</span> ((tmp = c._renderCallbacks.pop())) tmp.call(c);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸componentDidUpdate</span></span><br><span class="line">      <span class="keyword">if</span> (!isNew &amp;&amp; oldProps != <span class="literal">null</span> &amp;&amp; c.componentDidUpdate != <span class="literal">null</span>) c.componentDidUpdate(oldProps, oldState, snapshot);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸æ¯”å¯¹ä¸¤ä¸ªDOMå…ƒç´ </span></span><br><span class="line">      newVNode._dom = diffElementNodes(oldVNode._dom, newVNode, oldVNode, mounts, ancestorComponent);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((tmp = newVNode.ref) &amp;&amp; oldVNode.ref !== tmp) applyRef(tmp, newVNode._dom, ancestorComponent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸æ•è·æ¸²æŸ“é”™è¯¯ï¼Œä¼ é€’ç»™ä¸Šçº§ç»„ä»¶çš„didCatchç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">    catchErrorInComponent(e, ancestorComponent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newVNode._dom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><hr><p><br></p><h3 id="diffelementnodes"><a href="#diffelementnodes" class="headerlink" title="diffElementNodes"></a>diffElementNodes</h3><p>æ¯”å¯¹ä¸¤ä¸ª DOM å…ƒç´ , æµç¨‹éå¸¸ç®€å•:</p><center><br>  <img src="/images/07/diffElementNodes-process.png" width="600"><br></center><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diffElementNodes</span>(<span class="params">dom, newVNode, oldVNode, mounts, ancestorComponent</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸åˆ›å»ºDOMèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (dom == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newVNode.type === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸æ–‡æœ¬èŠ‚ç‚¹, æ²¡æœ‰å±æ€§å’Œå­çº§ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">document</span>.createTextNode(newProps);</span><br><span class="line">    &#125;</span><br><span class="line">    dom = <span class="built_in">document</span>.createElement(newVNode.type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newVNode.type === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸æ–‡æœ¬èŠ‚ç‚¹æ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (oldProps !== newProps) dom.data = newProps;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (newVNode !== oldVNode) &#123;</span><br><span class="line">      <span class="comment">// newVNode !== oldVNode è¿™è¯´æ˜æ˜¯ä¸€ä¸ªé™æ€èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">let</span> oldProps = oldVNode.props || EMPTY_OBJ;</span><br><span class="line">      <span class="keyword">let</span> newProps = newVNode.props;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ dangerouslySetInnerHTMLå¤„ç†</span></span><br><span class="line">      <span class="keyword">let</span> oldHtml = oldProps.dangerouslySetInnerHTML;</span><br><span class="line">      <span class="keyword">let</span> newHtml = newProps.dangerouslySetInnerHTML;</span><br><span class="line">      <span class="keyword">if</span> (newHtml || oldHtml)</span><br><span class="line">        <span class="keyword">if</span> (!newHtml || !oldHtml || newHtml.__html != oldHtml.__html)</span><br><span class="line">          dom.innerHTML = (newHtml &amp;&amp; newHtml.__html) || <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸é€’å½’æ¯”å¯¹å­å…ƒç´ </span></span><br><span class="line">      diffChildren(dom, newVNode, oldVNode, context, mounts, ancestorComponent, EMPTY_OBJ);</span><br><span class="line">      <span class="comment">// âš›ï¸é€’å½’æ¯”å¯¹DOMå±æ€§</span></span><br><span class="line">      diffProps(dom, newProps, oldProps, isSvg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><hr><p><br></p><h3 id="diffprops"><a href="#diffprops" class="headerlink" title="diffProps"></a>diffProps</h3><p>diffProps ç”¨äºæ›´æ–° DOM å…ƒç´ çš„å±æ€§</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diffProps</span>(<span class="params">dom, newProps, oldProps, isSvg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(newProps).sort();</span><br><span class="line">  <span class="comment">// âš›ï¸æ¯”è¾ƒå¹¶è®¾ç½®å±æ€§</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> k = keys[i];</span><br><span class="line">    <span class="keyword">if</span> (k !== <span class="string">'children'</span> &amp;&amp; k !== <span class="string">'key'</span> &amp;&amp;</span><br><span class="line">      (!oldProps || (k === <span class="string">'value'</span> || k === <span class="string">'checked'</span> ? dom : oldProps)[k] !== newProps[k])) </span><br><span class="line">      setProperty(dom, k, newProps[k], oldProps[k], isSvg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸æ¸…ç©ºå±æ€§</span></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> oldProps)</span><br><span class="line">    <span class="keyword">if</span> (i !== <span class="string">'children'</span> &amp;&amp; i !== <span class="string">'key'</span> &amp;&amp; !(i <span class="keyword">in</span> newProps))</span><br><span class="line">      setProperty(dom, i, <span class="literal">null</span>, oldProps[i], isSvg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>diffProps å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯éå†ä¸€ä¸‹å±æ€§æœ‰æ²¡æœ‰å˜åŠ¨ï¼Œæœ‰å˜åŠ¨åˆ™é€šè¿‡ setProperty è®¾ç½®å±æ€§ã€‚å¯¹äºå¤±æ•ˆçš„ props ä¹Ÿä¼šé€šè¿‡ setProperty ç½®ç©ºã€‚è¿™é‡Œé¢ç¨å¾®æœ‰ç‚¹å¤æ‚çš„æ˜¯ setProperty. è¿™é‡Œæ¶‰åŠåˆ°äº‹ä»¶çš„å¤„ç†, å‘½åçš„è½¬æ¢ç­‰ç­‰:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setProperty</span>(<span class="params">dom, name, value, oldValue, isSvg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (name === <span class="string">'style'</span>) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸æ ·å¼è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">set</span> = assign(assign(&#123;&#125;, oldValue), value);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> <span class="keyword">set</span>) &#123;</span><br><span class="line">      <span class="comment">// æ ·å¼å±æ€§æ²¡æœ‰å˜åŠ¨</span></span><br><span class="line">      <span class="keyword">if</span> ((value || EMPTY_OBJ)[i] === (oldValue || EMPTY_OBJ)[i]) <span class="keyword">continue</span>;</span><br><span class="line">      dom.style.setProperty(</span><br><span class="line">        i[<span class="number">0</span>] === <span class="string">'-'</span> &amp;&amp; i[<span class="number">1</span>] === <span class="string">'-'</span> ? i : i.replace(CAMEL_REG, <span class="string">'-$&amp;'</span>),</span><br><span class="line">        value &amp;&amp; i <span class="keyword">in</span> value</span><br><span class="line">          ? <span class="keyword">typeof</span> <span class="keyword">set</span>[i] === 'number' &amp;&amp; IS_NON_DIMENSIONAL.test(i) === false</span><br><span class="line">            ? <span class="keyword">set</span>[i] + 'px'</span><br><span class="line">            : <span class="keyword">set</span>[i]</span><br><span class="line">          : '', // æ¸…ç©º</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else if (name[0] === 'o' &amp;&amp; name[1] === 'n') &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸äº‹ä»¶ç»‘å®š</span></span><br><span class="line">    <span class="keyword">let</span> useCapture = name !== (name = name.replace(<span class="regexp">/Capture$/</span>, <span class="string">''</span>));</span><br><span class="line">    <span class="keyword">let</span> nameLower = name.toLowerCase();</span><br><span class="line">    name = (nameLower <span class="keyword">in</span> dom ? nameLower : name).slice(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸é¦–æ¬¡æ·»åŠ äº‹ä»¶, æ³¨æ„è¿™é‡Œæ˜¯eventProxyä¸ºäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">      <span class="comment">// preactç»Ÿä¸€å°†æ‰€æœ‰äº‹ä»¶å¤„ç†å™¨æ”¶é›†åœ¨dom._listenerså¯¹è±¡ä¸­ï¼Œç»Ÿä¸€è¿›è¡Œåˆ†å‘</span></span><br><span class="line">      <span class="comment">// function eventProxy(e) &#123;</span></span><br><span class="line">      <span class="comment">//   return this._listeners[e.type](options.event ? options.event(e) : e);</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="keyword">if</span> (!oldValue) dom.addEventListener(name, eventProxy, useCapture);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ç§»é™¤äº‹ä»¶</span></span><br><span class="line">      dom.removeEventListener(name, eventProxy, useCapture);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¿å­˜äº‹ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    (dom._listeners || (dom._listeners = &#123;&#125;))[name] = value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name !== <span class="string">'list'</span> &amp;&amp; name !== <span class="string">'tagName'</span> &amp;&amp; name <span class="keyword">in</span> dom) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸DOMå¯¹è±¡å±æ€§</span></span><br><span class="line">    dom[name] = value == <span class="literal">null</span> ? <span class="string">''</span> : value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> value !== <span class="string">'function'</span> &amp;&amp;</span><br><span class="line">    name !== <span class="string">'dangerouslySetInnerHTML'</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸DOMå…ƒç´ å±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span> || value === <span class="literal">false</span>) &#123;</span><br><span class="line">      dom.removeAttribute(name);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dom.setAttribute(name, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p>OK è‡³æ­¤ Diff ç®—æ³•ä»‹ç»å®Œæ¯•ï¼Œå…¶å®è¿™é‡Œé¢çš„é€»è¾‘å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚, å½“ç„¶ Preact åªæ˜¯ä¸€ä¸ªæåº¦ç²¾ç®€çš„æ¡†æ¶ï¼ŒReact å¤æ‚åº¦è¦é«˜å¾—å¤šï¼Œå°¤å…¶ React Fiber é‡æ„ä¹‹åã€‚ä½ ä¹Ÿå¯ä»¥æŠŠ Preact å½“åš React çš„å†å²å›é¡¾ï¼Œæœ‰å…´è¶£å†æ·±å…¥äº†è§£ React çš„æœ€æ–°æ¶æ„ã€‚</p><p><br></p><hr><p><br></p><h2 id="hooks-çš„å®ç°"><a href="#hooks-çš„å®ç°" class="headerlink" title="Hooks çš„å®ç°"></a>Hooks çš„å®ç°</h2><p>React16.8 æ­£å¼å¼•å…¥çš„ hooksï¼Œè¿™ç©æ„å¸¦æ¥äº†å…¨æ–°çš„ React ç»„ä»¶å¼€å‘æ–¹å¼ï¼Œè®©ä»£ç å˜å¾—æ›´åŠ ç®€æ´ã€‚ <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a>è¿™ç¯‡æ–‡ç« å·²ç»æ­ç¤ºäº† hooks çš„åŸºæœ¬å®ç°åŸç†, å®ƒä¸è¿‡æ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚preact ä¹Ÿå®ç°äº† hooks æœºåˆ¶ï¼Œå®ç°ä»£ç ä¹Ÿå°±ç™¾æ¥è¡Œï¼Œè®©æˆ‘ä»¬æ¥ä½“ä¼šä½“ä¼š.</p><p>hooks åŠŸèƒ½æœ¬èº«æ˜¯æ²¡æœ‰é›†æˆåœ¨ Preact ä»£ç åº“å†…éƒ¨çš„ï¼Œè€Œæ˜¯é€šè¿‡<code>preact/hooks</code>å¯¼å…¥</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">'preact'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'preact/hooks'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'mounted'</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello hooks<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>é‚£ Preact æ˜¯å¦‚ä½•æ‰©å±• diff ç®—æ³•æ¥å®ç° hooks çš„å‘¢ï¼Ÿ å®é™…ä¸Š Preact æä¾›äº†<code>options</code>å¯¹è±¡æ¥å¯¹ Preact diff è¿›è¡Œæ‰©å±•ï¼Œoptions ç±»ä¼¼äº Preact ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œåœ¨ diff è¿‡ç¨‹ä¸­è¢«è°ƒç”¨(ä¸ºäº†è¡Œæ–‡ç®€æ´ï¼Œä¸Šé¢çš„ä»£ç æˆ‘å¿½ç•¥æ‰äº†)ã€‚ä¾‹å¦‚:</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diff</span>(<span class="params"><span class="regexp">/*...*/</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸å¼€å§‹diff</span></span><br><span class="line">  <span class="keyword">if</span> ((tmp = options.diff)) tmp(newVNode);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    outer: <span class="keyword">if</span> (oldVNode.type === Fragment || newType === Fragment) &#123;</span><br><span class="line">      <span class="comment">// Fragment diff</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> newType === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment">// è‡ªå®šä¹‰ç»„ä»¶diff</span></span><br><span class="line">      <span class="comment">// âš›ï¸å¼€å§‹æ¸²æŸ“</span></span><br><span class="line">      <span class="keyword">if</span> ((tmp = options.render)) tmp(newVNode);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line">        c.render(c.props, c.state, c.context),</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸æ•è·å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> ((tmp = options.catchRender) &amp;&amp; tmp(e, c)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// DOM element diff</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// âš›ï¸diffç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> ((tmp = options.diffed)) tmp(newVNode);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    catchErrorInComponent(e, ancestorComponent);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newVNode._dom;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><h3 id="usestate"><a href="#usestate" class="headerlink" title="useState"></a>useState</h3><p>å…ˆä»æœ€å¸¸ç”¨çš„ useState å¼€å§‹:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initialState</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸OKåªæ˜¯æ•°ç»„ï¼Œæ²¡æœ‰Magicï¼Œæ¯ä¸ªhooksè°ƒç”¨éƒ½ä¼šé€’å¢currenIndex, ä»å½“å‰ç»„ä»¶ä¸­å–å‡ºçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> hookState = getHookState(currentIndex++);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸ åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (!hookState._component) &#123;</span><br><span class="line">    hookState._component = currentComponent; <span class="comment">// å½“å‰ç»„ä»¶å®ä¾‹</span></span><br><span class="line">    hookState._value = [</span><br><span class="line">      <span class="comment">// âš›ï¸state, åˆå§‹åŒ–state</span></span><br><span class="line">      <span class="keyword">typeof</span> initialState === <span class="string">'function'</span> ? initialState() : initialState,</span><br><span class="line">      <span class="comment">// âš›ï¸dispatch</span></span><br><span class="line">      value =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> nextValue = <span class="keyword">typeof</span> value === <span class="string">'function'</span> ? value(hookState._value[<span class="number">0</span>]) : value;</span><br><span class="line">        <span class="keyword">if</span> (hookState._value[<span class="number">0</span>] !== nextValue) &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ ä¿å­˜çŠ¶æ€å¹¶è°ƒç”¨setStateå¼ºåˆ¶æ›´æ–°</span></span><br><span class="line">          hookState._value[<span class="number">0</span>] = nextValue;</span><br><span class="line">          hookState._component.setState(&#123;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hookState._value; <span class="comment">// [state, dispatch]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®åœ¨äº<code>getHookState</code>çš„å®ç°</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; options &#125; <span class="keyword">from</span> <span class="string">'preact'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> currentIndex; <span class="comment">// ä¿å­˜å½“å‰hookçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">let</span> currentComponent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸render é’©å­, åœ¨ç»„ä»¶å¼€å§‹æ¸²æŸ“ä¹‹å‰è°ƒç”¨</span></span><br><span class="line"><span class="comment">// å› ä¸ºPreactæ˜¯åŒæ­¥é€’å½’å‘ä¸‹æ¸²æŸ“çš„ï¼Œè€Œä¸”Javascriptæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°å¼•ç”¨å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line">options.render = <span class="function"><span class="params">vnode</span> =&gt;</span> &#123;</span><br><span class="line">  currentComponent = vnode._component; <span class="comment">// ä¿å­˜å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶</span></span><br><span class="line">  currentIndex = <span class="number">0</span>;                    <span class="comment">// å¼€å§‹æ¸²æŸ“æ—¶indexé‡ç½®ä¸º0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æš‚æ—¶å¿½ç•¥ï¼Œä¸‹é¢è®²åˆ°useEffectå°±èƒ½ç†è§£</span></span><br><span class="line">  <span class="comment">// æ¸…ç©ºä¸Šæ¬¡æ¸²æŸ“æœªå¤„ç†çš„Effect(useEffect)ï¼Œåªæœ‰åœ¨å¿«é€Ÿé‡æ–°æ¸²æŸ“æ—¶æ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬åœ¨å¼‚æ­¥é˜Ÿåˆ—ä¸­è¢«å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (currentComponent.__hooks) &#123;</span><br><span class="line">    currentComponent.__hooks._pendingEffects = handleEffects(</span><br><span class="line">      currentComponent.__hooks._pendingEffects,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸no magic!, åªæ˜¯ä¸€ä¸ªæ•°ç»„, çŠ¶æ€ä¿å­˜åœ¨ç»„ä»¶å®ä¾‹çš„_listæ•°ç»„ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHookState</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–æˆ–åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> hooks = currentComponent.__hooks ||</span><br><span class="line">    (currentComponent.__hooks = &#123;</span><br><span class="line">      _list: [],                  <span class="comment">// æ”¾ç½®çŠ¶æ€</span></span><br><span class="line">      _pendingEffects: [],        <span class="comment">// æ”¾ç½®å¾…å¤„ç†çš„effectï¼Œç”±useEffectä¿å­˜</span></span><br><span class="line">      _pendingLayoutEffects: [],  <span class="comment">// æ”¾ç½®å¾…å¤„ç†çš„layoutEffectï¼Œæœ‰useLayoutEffectä¿å­˜</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–°å»ºçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span> (index &gt;= hooks._list.length) &#123;</span><br><span class="line">    hooks._list.push(&#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hooks._list[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹:</p><center><br>  <img src="/images/07/useState.png" width="800"><br></center><p><br></p><h3 id="useeffect"><a href="#useeffect" class="headerlink" title="useEffect"></a>useEffect</h3><p>å†çœ‹çœ‹ useEffect å’Œ useLayoutEffect. useEffect å’Œ useLayouteEffect å·®ä¸å¤š, åªæ˜¯è§¦å‘ effect çš„æ—¶æœºä¸ä¸€æ ·ï¼ŒuseEffect åœ¨å®Œæˆæ¸²æŸ“åç»˜åˆ¶è§¦å‘ï¼Œè€Œ useLayoutEffect åœ¨ diff å®Œæˆåè§¦å‘:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> state = getHookState(currentIndex++);</span><br><span class="line">  <span class="keyword">if</span> (argsChanged(state._args, args)) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸çŠ¶æ€å˜åŒ–</span></span><br><span class="line">    state._value = callback;</span><br><span class="line">    state._args = args;</span><br><span class="line">    currentComponent.__hooks._pendingEffects.push(state); <span class="comment">// âš›ï¸æ¨è¿›_pendingEffectsé˜Ÿåˆ—</span></span><br><span class="line">    afterPaint(currentComponent);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useLayoutEffect</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> state = getHookState(currentIndex++);</span><br><span class="line">  <span class="keyword">if</span> (argsChanged(state._args, args)) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸çŠ¶æ€å˜åŒ–</span></span><br><span class="line">    state._value = callback;</span><br><span class="line">    state._args = args;</span><br><span class="line">    currentComponent.__hooks._pendingLayoutEffects.push(state); <span class="comment">// âš›ï¸æ¨è¿›_pendingLayoutEffectsé˜Ÿåˆ—</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹çœ‹å¦‚ä½•è§¦å‘ effect. useEffect å’Œä¸Šé¢çœ‹åˆ°çš„<code>enqueueRender</code>å·®ä¸å¤šï¼Œæ”¾è¿›ä¸€ä¸ªå¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œç”±<code>requestAnimationFrame</code>è¿›è¡Œè°ƒåº¦ï¼Œæ‰¹é‡å¤„ç†:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äºä¸Šé¢æåˆ°çš„å¼‚æ­¥é˜Ÿåˆ—</span></span><br><span class="line">afterPaint = <span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!component._afterPaintQueued &amp;&amp; <span class="comment">// é¿å…ç»„ä»¶é‡å¤æ¨å…¥</span></span><br><span class="line">    (component._afterPaintQueued = <span class="literal">true</span>) &amp;&amp;</span><br><span class="line">    afterPaintEffects.push(component) === <span class="number">1</span> <span class="comment">// å¼€å§‹è°ƒåº¦</span></span><br><span class="line">  )</span><br><span class="line">    requestAnimationFrame(scheduleFlushAfterPaint);  <span class="comment">// ç”±requestAnimationFrameè°ƒåº¦</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scheduleFlushAfterPaint</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(flushAfterPaintEffects);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushAfterPaintEffects</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  afterPaintEffects.some(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">    component._afterPaintQueued = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (component._parentDom)</span><br><span class="line">      <span class="comment">// æ¸…ç©º_pendingEffectsé˜Ÿåˆ—</span></span><br><span class="line">      component.__hooks._pendingEffects = handleEffects(component.__hooks._pendingEffects);</span><br><span class="line">  &#125;);</span><br><span class="line">  afterPaintEffects = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleEffects</span>(<span class="params">effects</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…ˆæ¸…é™¤åè°ƒç”¨effect</span></span><br><span class="line">  effects.forEach(invokeCleanup); <span class="comment">// è¯·è°ƒç”¨æ¸…ç†</span></span><br><span class="line">  effects.forEach(invokeEffect);  <span class="comment">// å†è°ƒç”¨effect</span></span><br><span class="line">  <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeCleanup</span>(<span class="params">hook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (hook._cleanup) hook._cleanup();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeEffect</span>(<span class="params">hook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = hook._value();</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> result === <span class="string">'function'</span>) hook._cleanup = result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>å†çœ‹çœ‹å¦‚ä½•è§¦å‘ LayoutEffect, å¾ˆç®€å•ï¼Œåœ¨ diff å®Œæˆåè§¦å‘, è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">options.diffed = <span class="function"><span class="params">vnode</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> c = vnode._component;</span><br><span class="line">  <span class="keyword">if</span> (!c) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">const</span> hooks = c.__hooks;</span><br><span class="line">  <span class="keyword">if</span> (hooks) &#123;</span><br><span class="line">    hooks._pendingLayoutEffects = handleEffects(hooks._pendingLayoutEffects);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ğŸ‘Œï¼Œhooks åŸºæœ¬åŸç†åŸºæœ¬äº†è§£å®Œæ¯•, æœ€åè¿˜æ˜¯ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹å§ã€‚</p><center><br>  <img src="/images/07/hooks.png" width="800"><br></center><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><p>æ–‡ç« ç¯‡å¹…å¾ˆé•¿ï¼Œä¸»è¦æ˜¯å¤ªå¤šä»£ç äº†, æˆ‘è‡ªå·±ä¹Ÿä¸å–œæ¬¢çœ‹è¿™ç§æ–‡ç« ï¼Œæ‰€ä»¥æ²¡æœŸæœ›è¯»è€…ä¼šçœ‹åˆ°è¿™é‡Œ. åé¢æ–‡ç« å†æƒ³åŠæ³•æ”¹å–„æ”¹å–„. è°¢è°¢ä½ é˜…è¯»åˆ°è¿™é‡Œã€‚</p><p>æœ¬æœŸçš„ä¸»è§’æœ¬èº«æ˜¯ä¸€ä¸ªå°è€Œç¾çš„è§†å›¾æ¡†æ¶ï¼Œæ²¡æœ‰å…¶ä»–æŠ€æœ¯æ ˆ. è¿™é‡Œå°±å®‰åˆ©ä¸€ä¸‹ Preact ä½œè€…<a href="https://github.com/developit" target="_blank" rel="noopener">developit</a>çš„å¦å¤–ä¸€äº›å°è€Œç¾çš„åº“å§.</p><ul><li><a href="https://github.com/developit/workerize" target="_blank" rel="noopener">Workerize</a> ä¼˜é›…åœ°åœ¨ webWorker ä¸­æ‰§è¡Œå’Œè°ƒç”¨ç¨‹åº</li><li><a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> é›¶é…ç½®çš„åº“æ‰“åŒ…å·¥å…·</li><li><a href="https://github.com/developit/greenlet" target="_blank" rel="noopener">greenlet</a> å’Œ workerize å·®ä¸å¤šï¼Œè¿™ä¸ªå°†å•ä¸ªå¼‚æ­¥å‡½æ•°æ”¾åˆ° webworker ä¸­æ‰§è¡Œï¼Œè€Œ workerize æ˜¯å°†ä¸€ä¸ªæ¨¡å—</li><li><a href="https://github.com/developit/mitt" target="_blank" rel="noopener">mitt</a> 200byte çš„ EventEmitter</li><li><a href="https://github.com/developit/dlv" target="_blank" rel="noopener">dlv</a> å®‰å…¨åœ°è®¿é—®æ·±åµŒå¥—çš„å¯¹è±¡å±æ€§ï¼Œç±»ä¼¼äº lodash çš„ get æ–¹æ³•</li><li><a href="https://github.com/developit/snarkdown" target="_blank" rel="noopener">snarkdown</a> 1kb çš„ markdown parser</li><li><a href="https://github.com/developit/unistore" target="_blank" rel="noopener">unistore</a> ç®€æ´ç±» Redux çŠ¶æ€å®¹å™¨ï¼Œæ”¯æŒ React å’Œ Preact</li><li><a href="https://github.com/developit/stockroom" target="_blank" rel="noopener">stockroom</a> åœ¨ webWorker æ”¯æŒçŠ¶æ€ç®¡ç†å™¨</li></ul><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://juejin.im/entry/59b9284a5188257e6571b9b4" target="_blank" rel="noopener">Preactï¼šInto the void 0ï¼ˆè¯‘ï¼‰</a></li><li><a href="https://auth0.com/blog/face-off-virtual-dom-vs-incremental-dom-vs-glimmer/" target="_blank" rel="noopener">React Virtual DOM vs Incremental DOM vs Emberâ€™s Glimmer: Fight</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;React çš„ä»£ç åº“ç°åœ¨å·²ç»æ¯”è¾ƒåºå¤§äº†ï¼ŒåŠ ä¸Š v16 çš„ Fiber é‡æ„ï¼Œåˆå­¦è€…å¾ˆå®¹æ˜“é™·å…¥ç»†èŠ‚çš„æ±ªæ´‹å¤§æµ·ï¼Œææ‡‚äº†ä¼šè®©äººè§‰å¾—è‡ªå·±å¾ˆç‰›é€¼ï¼Œæä¸æ‡‚å¾ˆå®¹æ˜“è®©äººå¤±å»ä¿¡å¿ƒ, æ€€ç–‘è‡ªå·±æ˜¯å¦åº”è¯¥ç»§ç»­æå‰ç«¯ã€‚é‚£ä¹ˆå°è¯•åœ¨æœ¬æ–‡è¿™é‡Œæ‰¾å›ä¸€ç‚¹è‡ªä¿¡å§(é«˜æ‰‹ç»•è·¯).&lt;/p&gt;
&lt;p&gt;Preact æ˜¯ R
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] ğŸ’…styled-components ğŸ’…</title>
    <link href="https://bobi.ink/2019/05/29/styled-components-map/"/>
    <id>https://bobi.ink/2019/05/29/styled-components-map/</id>
    <published>2019-05-28T16:00:00.000Z</published>
    <updated>2019-06-01T09:18:28.099Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="https://juejin.im/post/5cdad9c7f265da039b08915d" target="_blank" rel="noopener">React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 03 - æ ·å¼çš„ç®¡ç†</a>ä¸€æ–‡ä¸­å¹äº†ä¸€æ³¢ <a href="https://www.styled-components.com" target="_blank" rel="noopener">styled-components</a> åï¼Œæœ¬æ–‡æƒ³æ·±å…¥æ¥äº†è§£ä¸€ä¸‹ styled-components çš„åŸç†. å¦‚æœä½ å¯¹ styled-components è¿˜ä¸äº†è§£ï¼Œå»ºè®®å…ˆé˜…è¯»ä¸€ä¸‹å®˜æ–¹<a href="http://styled-components.com" target="_blank" rel="noopener">æ–‡æ¡£</a>æˆ–å‰é¢çš„æ–‡ç« .</p><blockquote><p>æœ¬æ–‡åŸºäº styled-components v4.13 ç‰ˆæœ¬</p></blockquote><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#ä»-tagged-template-literals-è¯´èµ·">ä» Tagged Template Literals è¯´èµ·</a></li><li><a href="#æºç å¯¼è¯»">æºç å¯¼è¯»</a><ul><li><a href="#1-å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡">1. å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</a></li><li><a href="#2-react-ç»„ä»¶çš„å°è£…">2. React ç»„ä»¶çš„å°è£…</a></li><li><a href="#3-æ ·å¼å’Œç±»åçš„ç”Ÿæˆ">3. æ ·å¼å’Œç±»åçš„ç”Ÿæˆ</a></li><li><a href="#4-dom-å±‚æ“ä½œ">4. DOM å±‚æ“ä½œ</a></li><li><a href="#5-æ€»ç»“">5. æ€»ç»“</a></li></ul></li><li><a href="#æŠ€æœ¯åœ°å›¾">æŠ€æœ¯åœ°å›¾</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="ä»-tagged-template-literals-è¯´èµ·"><a href="#ä»-tagged-template-literals-è¯´èµ·" class="headerlink" title="ä» Tagged Template Literals è¯´èµ·"></a>ä» Tagged Template Literals è¯´èµ·</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank" rel="noopener"><strong>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡(Tagged Template Literals)</strong></a>æ˜¯ ES6 æ–°å¢çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ <strong>è‡ªå®šä¹‰å­—ç¬¦ä¸²çš„å†…æ’(interpolation)è§„åˆ™</strong>, styled-components æ­£æ˜¯åŸºäºè¿™ä¸ªç‰¹æ€§æ„å»º:</p><center><br>  <img src="/images/06/styled-sample.png" width="400"><br></center><p>å®ƒçš„åŸç†éå¸¸ç®€å•ï¼Œæ‰€æœ‰é™æ€å­—ç¬¦ä¸²ä¼šè¢«æ‹†åˆ†å‡ºæ¥åˆå¹¶æˆä¸ºæ•°ç»„, ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥åˆ°ç›®æ ‡å‡½æ•°ï¼Œè€Œå†…æ’(interpolation)è¡¨è¾¾å¼çš„å€¼åˆ™ä¼šä½œä¸º rest å‚æ•°ä¼ å…¥:</p><center><br>  <img src="/images/06/tag-template.png" width="400"><br></center><p><strong>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡ç›¸æ¯”æ™®é€šçš„æ¨¡æ¿å­—é¢é‡æ›´åŠ çµæ´». æ™®é€šæ¨¡æ¿å­—ç¬¦ä¸²ä¼šå°†æ‰€æœ‰å†…æ’å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œ<code>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</code>åˆ™ç”±ä½ è‡ªå·±æ¥æ§åˆ¶</strong>:</p><center><br>  <img src="/images/06/tag-template-pros.png" width="600"><br></center><p>å› ä¸ºæ ‡ç­¾æ¨¡æ¿å­—ç¬¦ä¸²ç®€æ´çš„è¯­æ³•å’Œçµæ´»æ€§ï¼Œå®ƒæ¯”è¾ƒé€‚ç”¨äºä½œä¸º<code>DSL</code>, ä¸éœ€è¦åœ¨è¯­è¨€å±‚é¢è¿›è¡Œæ”¯æŒï¼Œæ¯”å¦‚å‰é˜µå­<a href="https://github.com/preactjs/preact" target="_blank" rel="noopener">preact</a>ä½œè€…å¼€å‘çš„<a href="https://github.com/developit/htm" target="_blank" rel="noopener">htm</a>, å£å·å°±æ˜¯â€å–ä»£ JSXï¼Œè€Œä¸”ä¸éœ€è¦ç¼–è¯‘å™¨æ”¯æŒâ€, é€šè¿‡è¿™ç§æ–¹å¼æ˜¯å¯ä»¥ä¼˜é›…åœ°å®ç°<a href="https://juejin.im/post/5ceacf09e51d454f73356cc4" target="_blank" rel="noopener">â€˜ä½ çš„ç½‘ç«™æˆ–è®¸ä¸éœ€è¦å‰ç«¯æ„å»ºâ€™</a>.</p><center><br>  <img src="/images/06/htm.png" width="700"><br></center><p>å¦ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯ <code>jest</code> çš„<a href="https://jestjs.io/docs/en/api#testeachtable-name-fn-timeout" target="_blank" rel="noopener"><code>è¡¨æ ¼æµ‹è¯•</code></a>, è¿™æ ·å½¢å¼å¯è¯»æ€§æ›´é«˜:</p><center><br>  <img src="/images/06/jest.png" width="700"><br></center><p>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡çš„è„‘æ´è¿˜åœ¨ç»§ç»­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨æ¥å†™ markdownï¼Œå†ç”Ÿæˆ react ç»„ä»¶ã€‚é™äºç¯‡å¹…å°±ä¸å•°å—¦äº†</p><p>æ‰©å±•:</p><ul><li><a href="https://mxstbr.blog/2016/11/styled-components-magic-explained/" target="_blank" rel="noopener">The magic behind ğŸ’… styled-components</a></li></ul><p><br></p><hr><p><br></p><h2 id="æºç å¯¼è¯»"><a href="#æºç å¯¼è¯»" class="headerlink" title="æºç å¯¼è¯»"></a>æºç å¯¼è¯»</h2><p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹ styled-components çš„å®ç°ã€‚ä¸ºäº†è¡Œæ–‡ç®€æ´ï¼Œæˆ‘ä»¬åªå…³å¿ƒ styled-components çš„æ ¸å¿ƒé€»è¾‘ï¼Œæ‰€ä»¥æˆ‘å¯¹æºä»£ç è¿›è¡Œäº†å¤§é‡çš„ç®€åŒ–ï¼Œæ¯”å¦‚å¿½ç•¥æ‰æœåŠ¡ç«¯æ¸²æŸ“ã€ReactNative å®ç°ã€babel æ’ä»¶ç­‰ç­‰.</p><h3 id="1-å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡"><a href="#1-å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡" class="headerlink" title="1. å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡"></a>1. å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</h3><p>å…ˆä» <code>styled</code> æ„é€ å‡½æ•°çœ‹èµ·:</p><center><br>  <img src="/images/06/styled-code.png" width="500"><br></center><p>styled æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªåŒ…è£…ç»„ä»¶ targetï¼Œè€Œæ ‡ç­¾æ¨¡æ¿å­—é¢é‡åˆ™ç”±<a href="https://www.styled-components.com/docs/api#css" target="_blank" rel="noopener"><code>css</code></a>å‡½æ•°è¿›è¡Œå¤„ç†çš„. è¿™ä¸ªå‡½æ•°åœ¨ styled-components ä¸­éå¸¸å¸¸ç”¨ï¼Œç±»ä¼¼äº <code>SCSS</code> çš„ <code>mixin</code> è§’è‰². <code>css</code> å‡½æ•°ä¼šæ ‡ç­¾æ¨¡æ¿å­—é¢é‡è§„èŒƒåŒ–, ä¾‹å¦‚:</p><center><br>  <img src="/images/06/css.png" width="750"><br></center><p> css å®ç°ä¹Ÿéå¸¸ç®€å•:</p><center><br>  <img src="/images/06/css-code.png" width="700"><br></center><p><code>interleave</code>å‡½æ•°å°†å°†é™æ€å­—ç¬¦ä¸²æ•°ç»„å’Œå†…æ’å€¼â€™æ‹‰é“¾å¼â€˜äº¤å‰åˆå¹¶ä¸ºå•ä¸ªæ•°ç»„, æ¯”å¦‚[1, 2] + [a, b]ä¼šåˆå¹¶ä¸º[1, a, 2, b]</p><p>å…³é”®åœ¨äºå¦‚ä½•å°†æ•°ç»„è¿›è¡Œæ‰å¹³åŒ–, è¿™ä¸ªç”± <code>flatten</code> å‡½æ•°å®ç°. flatten å‡½æ•°ä¼šå°†åµŒå¥—çš„ css(æ•°ç»„å½¢å¼)é€’å½’ concat åœ¨ä¸€èµ·ï¼Œå°† StyledComponent ç»„ä»¶è½¬æ¢ä¸ºç±»åå¼•ç”¨ã€è¿˜æœ‰å¤„ç† keyframe ç­‰ç­‰. æœ€ç»ˆå‰©ä¸‹é™æ€å­—ç¬¦ä¸²å’Œå‡½æ•°, è¾“å‡ºç»“æœå¦‚ä¸Šæ‰€ç¤ºã€‚</p><p><strong>å®é™…ä¸Š styled-components ä¼šè¿›è¡Œä¸¤æ¬¡ flattenï¼Œç¬¬ä¸€æ¬¡ flatten å°†èƒ½å¤Ÿé™æ€åŒ–çš„éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå°†åµŒå¥—çš„ css ç»“æ„æ‰“å¹³, åªå‰©ä¸‹ä¸€äº›å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åªèƒ½åœ¨è¿è¡Œæ—¶(æ¯”å¦‚åœ¨ç»„ä»¶æ¸²æŸ“æ—¶)æ‰§è¡Œï¼›ç¬¬äºŒæ¬¡æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œæ‹¿åˆ°å‡½æ•°çš„è¿è¡Œä¸Šä¸‹æ–‡(propsã€theme ç­‰ç­‰)å, æ‰§è¡Œæ‰€æœ‰å‡½æ•°ï¼Œå°†å‡½æ•°çš„æ‰§è¡Œç»“æœè¿›è¡Œé€’å½’åˆå¹¶ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ˜¯ä¸€ä¸ªçº¯å­—ç¬¦ä¸²æ•°ç»„</strong>. å¯¹äºæ ‡ç­¾æ¨¡æ¿å­—é¢é‡çš„å¤„ç†å¤§æ¦‚éƒ½æ˜¯è¿™ä¸ªè¿‡ç¨‹. çœ‹çœ‹ flatten çš„å®ç°:</p><center><br>  <img src="/images/06/flatten-code.png" width="700"><br></center><p>æ€»ç»“ä¸€ä¸‹æ ‡ç­¾æ¨¡æ¿å­—é¢é‡çš„å¤„ç†æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·å­:</p><center><br><img src="/images/06/flatten.png" width="700"><br></center><p><br></p><hr><p><br></p><h3 id="2-react-ç»„ä»¶çš„å°è£…"><a href="#2-react-ç»„ä»¶çš„å°è£…" class="headerlink" title="2. React ç»„ä»¶çš„å°è£…"></a>2. React ç»„ä»¶çš„å°è£…</h3><p>ç°åœ¨çœ‹çœ‹å¦‚ä½•æ„é€ å‡º React ç»„ä»¶ã€‚styled-components é€šè¿‡ createStyledComponent é«˜é˜¶ç»„ä»¶å°†ç»„ä»¶å°è£…ä¸º StyledComponent ç»„ä»¶:</p><center><br><img src="/images/06/create-component.png" width="800"><br></center><p>createStyledComponent æ˜¯ä¸€ä¸ªå…¸å‹çš„é«˜é˜¶ç»„ä»¶ï¼Œå®ƒåœ¨æ‰§è¡ŒæœŸé—´ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç»„ä»¶ id å’Œåˆ›å»º<code>ComponentStyle</code>å¯¹è±¡. ComponentStyle å¯¹è±¡ç”¨äºç»´æŠ¤ css å‡½æ•°ç”Ÿæˆçš„ cssRules, åœ¨è¿è¡Œæ—¶(ç»„ä»¶æ¸²æŸ“æ—¶)å¾—åˆ°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡åç”Ÿæˆæœ€ç»ˆçš„æ ·å¼å’Œç±»åã€‚</p><p>å†æ¥çœ‹çœ‹ StyledComponent çš„å®ç°, StyledComponent åœ¨ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œå°†å½“å‰çš„ props+theme ä½œä¸º context ä¼ é€’ç»™ ComponentStyleï¼Œç”Ÿæˆç±»å.</p><center><br><img src="/images/06/StyledComponent.png" width="800"><br></center><p><br></p><hr><p><br></p><h3 id="3-æ ·å¼å’Œç±»åçš„ç”Ÿæˆ"><a href="#3-æ ·å¼å’Œç±»åçš„ç”Ÿæˆ" class="headerlink" title="3. æ ·å¼å’Œç±»åçš„ç”Ÿæˆ"></a>3. æ ·å¼å’Œç±»åçš„ç”Ÿæˆ</h3><p>ä¸Šé¢çœ‹åˆ° StyleComponent é€šè¿‡ ComponentStyle ç±»æ¥æ„é€ æ ·å¼è¡¨å¹¶ç”Ÿæˆç±»å, ComponentStyle æ‹¿åˆ° context åï¼Œå†æ¬¡è°ƒç”¨ flatten å°† css rule æ‰å¹³åŒ–ï¼Œå¾—åˆ°ä¸€ä¸ªçº¯å­—ç¬¦ä¸²æ•°ç»„ã€‚é€šè¿‡ä½¿ç”¨ hash ç®—æ³•ç”Ÿæˆç±»å, å¹¶ä½¿ç”¨stylis å¯¹æ ·å¼è¿›è¡Œé¢„å¤„ç†. æœ€åé€šè¿‡ StyleSheet å¯¹è±¡å°†æ ·å¼è§„åˆ™æ’å…¥åˆ° DOM ä¸­</p><center><br><img src="/images/06/ComponentStyle.png" width="800"><br></center><p><a href="https://github.com/thysultan/stylis.js/blob/master/README.md" target="_blank" rel="noopener">stylis</a>æ˜¯ä¸€ä¸ª 3kb çš„è½»é‡çš„ CSS é¢„å¤„ç†å™¨, styled-components æ‰€æœ‰çš„ CSS ç‰¹æ€§éƒ½ä¾èµ–äºå®ƒï¼Œ ä¾‹å¦‚åµŒå¥—è§„åˆ™(<code>a {&amp;:hover{}}</code>)ã€å‚å•†å‰ç¼€ã€å‹ç¼©ç­‰ç­‰.</p><p><br></p><hr><p><br></p><h3 id="4-dom-å±‚æ“ä½œ"><a href="#4-dom-å±‚æ“ä½œ" class="headerlink" title="4. DOM å±‚æ“ä½œ"></a>4. DOM å±‚æ“ä½œ</h3><p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹ StyleSheet, StyleSheet è´Ÿè´£æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„æ ·å¼è§„åˆ™ï¼Œå¹¶æ’å…¥åˆ° DOM ä¸­</p><center><br><img src="/images/06/StyleSheet.png" width="800"><br></center><p>çœ‹çœ‹ç®€åŒ–ç‰ˆçš„ makeTag</p><center><br><img src="/images/06/makeTag.png" width="800"><br></center><p><br></p><hr><p><br></p><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h3><p>ä»£ç å¯èƒ½çœ‹æ™•äº†ï¼Œé€šè¿‡æµç¨‹å›¾æ¥æ¢³ç†ä¸€ä¸‹è¿‡ç¨‹.</p><blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://juejin.im/post/5cedb26451882566477b7235" target="_blank" rel="noopener">æŠ€æœ¯åœ°å›¾ - vue-cli</a>ä¸€ç‚¹ä»£ç ä¹Ÿæ²¡æœ‰ç½—åˆ—ï¼Œåªæœ‰ä¸€ä¸ªæµç¨‹å›¾, è¯»è€…å¯èƒ½ä¸€ä¸‹å­å°±å‚»çœ¼äº†, ä¸çŸ¥é“åœ¨è¯´äº›ä»€ä¹ˆ; è€Œä¸”è¿™ä¸ªæµç¨‹å›¾å¤ªå¤§ï¼Œåœ¨ç§»åŠ¨ç«¯ä¸å¥½é˜…è¯». è¿™æœŸç¨å¾®æ”¹è¿›ä¸€ä¸‹ï¼Œæ–°å¢â€™æºç å¯¼è¯»â€˜ä¸€èŠ‚ï¼Œä»£ç è¡¨è¾¾èƒ½åŠ›æ¯«æ— ç–‘é—®æ˜¯èƒœäºæµç¨‹å›¾çš„ï¼Œä½†æ˜¯ä»£ç ç›¸å¯¹æ¯”è¾ƒç»†èŠ‚çç¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ˜¯å°†ä»£ç è¿›è¡Œç®€åŒ–ï¼Œç•™ä¸‹æ ¸å¿ƒçš„é€»è¾‘ï¼Œç¬¬äºŒæ˜¯ä½¿ç”¨æµç¨‹å›¾è¡¨ç¤ºå¤§æ¦‚çš„ç¨‹åºæµç¨‹ï¼Œä»¥åŠæµç¨‹ä¸»ä½“ä¹‹é—´çš„å…³ç³».</p></blockquote><p><img src="/images/06/process.png" alt></p><p><br></p><p>å¦‚ä¸Šå›¾ styled-components ä¸»è¦æœ‰å››ä¸ªæ ¸å¿ƒå¯¹è±¡:</p><ul><li><strong>WrappedComponent</strong>: è¿™æ˜¯ createStyledComponent åˆ›å»ºçš„åŒ…è£…ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¿å­˜çš„è¢«åŒ…è£…çš„ targetã€å¹¶ç”Ÿæˆç»„ä»¶ id å’Œ ComponentStyle å¯¹è±¡</li><li><strong>StyledComponent</strong>: è¿™æ˜¯æ ·å¼ç»„ä»¶ï¼Œåœ¨å®ƒ render æ—¶ä¼šå°† props ä½œä¸º context ä¼ é€’ç»™ ComponentStyleï¼Œå¹¶ç”Ÿæˆç±»å</li><li><strong>ComponentStyle</strong>: è´Ÿè´£ç”Ÿæˆæœ€ç»ˆçš„æ ·å¼è¡¨å’Œå”¯ä¸€çš„ç±»åï¼Œå¹¶è°ƒç”¨ StyleSheet å°†ç”Ÿæˆçš„æ ·è¡¨æ³¨å…¥åˆ°æ–‡æ¡£ä¸­</li><li><strong>StyleSheet</strong>: è´Ÿè´£ç®¡ç†å·²ç”Ÿæˆçš„æ ·å¼è¡¨, å¹¶æ³¨å…¥åˆ°æ–‡æ¡£ä¸­</li></ul><p><br></p><p><strong>styled-components æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong></p><p>styled-components æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è®¡ç®— cssRuleï¼Œå¹¶è¿›è¡Œ hash è®¡ç®—å‡º classNameï¼Œå¦‚æœå·²ç»å¯¹åº”çš„ className è¿˜æ²¡æ’å…¥åˆ°æ ·å¼è¡¨ä¸­ï¼Œåˆ™ä½¿ç”¨ stylis è¿›è¡Œé¢„å¤„ç†ï¼Œå¹¶æ’å…¥åˆ°æ ·å¼è¡¨ä¸­; </p><p>å¦å¤– styled-components å¯¹é™æ€ cssRule(æ²¡æœ‰ä»»ä½•å†…æ’å‡½æ•°)è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå®ƒä»¬ä¸ä¼šç›‘å¬ ThemeContext å˜åŒ–, ä¸”åœ¨æ¸²æŸ“æ—¶ä¸ä¼šé‡æ–°è®¡ç®—ã€‚</p><p>é€šè¿‡è¿™äº›è§„åˆ™å¯ä»¥å¾—å‡ºä»¥ä¸‹æ€§èƒ½ä¼˜åŒ–çš„å»ºè®®:</p><ul><li><strong>é™æ€åŒ–çš„ cssRule æ€§èƒ½æ˜¯æœ€å¥½çš„</strong></li><li><p><strong>é™ä½ StyledComponent çŠ¶æ€å¤æ‚åº¦</strong>. styled-components å¹¶ä¸ä¼šå¯¹å·²æœ‰çš„ä¸å˜çš„æ ·å¼è§„åˆ™è¿›è¡Œå¤ç”¨ï¼Œä¸€æ—¦çŠ¶æ€å˜åŒ– styled-component ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„æ ·å¼è§„åˆ™å’Œç±»å. è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§å®ç°, é¿å…äº†æ ·å¼å¤ç”¨çš„å¤æ‚æ€§ï¼ŒåŒæ—¶ä¿æŒæ ·å¼çš„éš”ç¦»æ€§, é—®é¢˜å°±æ˜¯ä¼šäº§ç”Ÿæ ·å¼å†—ä½™ã€‚ ä¾‹å¦‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Foo = styled.div&lt;&#123; active: boolean &#125;&gt;`</span><br><span class="line">  color: red;</span><br><span class="line">  background: $&#123;props =&gt; (props.active ? &apos;blue&apos; : &apos;red&apos;)&#125;;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure><p>active åˆ‡æ¢ä¹‹é—´ä¼šç”Ÿæˆä¸¤ä¸ªç±»å:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.cQAOKL</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.kklCtT</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæŠŠ StyledComponent çœ‹åšæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œé‚£ä¹ˆ styled-components å¯èƒ½ä¼šä¸ºæ¯ä¸€ä¸ªå¯èƒ½çš„çŠ¶æ€ç”Ÿæˆç‹¬ç«‹çš„æ ·å¼. å¦‚æœ StyledComponent æ ·å¼å¾ˆå¤š, è€Œä¸”çŠ¶æ€æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆä¼šç”Ÿæˆå¾ˆå¤šå†—ä½™çš„æ ·å¼.</p></li><li><p>âŒ <strong>ä¸è¦ç”¨äºåŠ¨ç”»</strong>ã€‚ä¸Šé¢äº†è§£åˆ° styled-component ä¼šä¸ºæ¯ä¸ªçŠ¶æ€ç”Ÿæˆä¸€ä¸ªæ ·å¼è¡¨. åŠ¨ç”»ä¸€èˆ¬ä¼šæœ‰å¾ˆå¤šä¸­é—´å€¼ï¼Œåœ¨çŸ­æ—¶é—´å†…è¿›è¡Œå˜åŒ–ï¼Œå¦‚æœåŠ¨ç”»å€¼é€šè¿‡propsä¼ å…¥è¯¥StyledComponentæ¥åº”ç”¨æ ·å¼ï¼Œè¿™æ ·ä¼šç”Ÿæˆå¾ˆå¤šæ ·å¼ï¼Œæ€§èƒ½éå¸¸å·®:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Bar = styled.div&lt;&#123; width: boolean &#125;&gt;`</span><br><span class="line">  color: red;</span><br><span class="line">  // åƒä¸‡åˆ«è¿™ä¹ˆå¹²</span><br><span class="line">  width: $&#123;props =&gt; props.width&#125;;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure><p>è¿™ç§åŠ¨ç”»åœºæ™¯æœ€å¥½ä½¿ç”¨ style å†…è”æ ·å¼æ¥åš</p></li></ul><p><br></p><p>OK, è¡Œæ–‡ç»“æŸã€‚styled-components ä¸è¿‡å¦‚æ­¤æ˜¯å§ï¼Ÿ</p><p><br></p><hr><p><br></p><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><ul><li><strong>CSS ç›¸å…³</strong><ul><li>@emotion/unitless åˆ¤æ–­å±æ€§å€¼æ˜¯å¦éœ€è¦å•ä½</li><li>css-to-react-native å°† css è½¬æ¢ä¸º ReactNative style å±æ€§</li><li>âœ¨<a href="https://www.npmjs.com/package/bundlesize" target="_blank" rel="noopener">stylis</a> è½»é‡çš„ CSS é¢„å¤„ç†å™¨</li></ul></li><li><strong>React ç›¸å…³</strong><ul><li>@emotion/is-prop-valid åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•çš„ DOM å±æ€§</li><li><a href="https://www.npmjs.com/package/hoist-non-react-statics" target="_blank" rel="noopener">hoist-non-react-statics</a> æå‡Reactç»„ä»¶çš„é™æ€å±æ€§ï¼Œç”¨äºé«˜é˜¶ç»„ä»¶åœºæ™¯</li><li>âœ¨<a href="https://www.npmjs.com/package/react-is" target="_blank" rel="noopener">react-is</a>: åˆ¤æ–­å„ç§ React ç»„ä»¶ç±»å‹</li><li><a href="https://github.com/lelandrichardson/react-primitives#readme" target="_blank" rel="noopener">react-primitives</a> è¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€çš„åº“ï¼Œè¿™ä¸ªåº“è¯•å›¾å›´ç»•ç€æ„å»º React åº”ç”¨æå‡ºä¸€å¥—ç†æƒ³çš„åŸè¯­ï¼Œé€šä¿—çš„è¯´å°±æ˜¯é€šè¿‡å®ƒå¯ä»¥å¯¼å…¥ä¸åŒå¹³å°çš„ç»„ä»¶ã€‚</li><li><a href="https://github.com/ryanseddon/react-frame-component" target="_blank" rel="noopener">react-frame-component</a> å°†reactæ¸²æŸ“åˆ°iframeä¸­ã€‚ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„åº“</li><li><a href="https://www.npmjs.com/package/react-live" target="_blank" rel="noopener">react-live</a> reactå®æ—¶ç¼–è¾‘å™¨å’Œå±•ç¤ºï¼Œä¸»è¦ç”¨äºæ–‡æ¡£</li></ul></li><li><strong>æ„å»ºç›¸å…³</strong><ul><li><a href="https://github.com/siddharthkp/bundlesize#readme" target="_blank" rel="noopener">bundlesize</a> æ£€æŸ¥åŒ…å¤§å°</li><li><a href="https://github.com/codemod-js/codemod/blob/master/packages/cli/README.md" target="_blank" rel="noopener">codemod</a> ä½¿ç”¨babel-pluginæ¥é‡å†™Javascriptæˆ–Typescriptä»£ç ï¼Œ ä¸€èˆ¬ç”¨äºåˆ¶ä½œå‡çº§è„šæœ¬</li><li>âœ¨<a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> ä¸€ä¸ªé›¶é…ç½®çš„æ‰“åŒ…å™¨ï¼ŒåŸºäºRollupï¼Œå¯ä»¥ç”¨äºåº“çš„æ‰“åŒ…å’Œå¼€å‘, preactä½œè€…å¼€å‘å¿…å±ç²¾å“</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨&lt;a href=&quot;https://juejin.im/post/5cdad9c7f265da039b08915d&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 03 - æ ·å¼çš„ç®¡ç†&lt;/a&gt;ä¸€æ–‡ä¸­å¹äº†ä¸€æ³¢ &lt;a href=&quot;h
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] vue-cli</title>
    <link href="https://bobi.ink/2019/05/26/vue-cli-map/"/>
    <id>https://bobi.ink/2019/05/26/vue-cli-map/</id>
    <published>2019-05-25T16:00:00.000Z</published>
    <updated>2019-06-01T08:15:46.354Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä¸ªæ–°å¼€çš„â€™å®éªŒæ€§â€™æ–‡ç« ç³»åˆ—ï¼Œå¦‚å…¶åâ€˜æŠ€æœ¯åœ°å›¾â€™ï¼Œè¿™ä¸ªç³»åˆ—è®¡åˆ’å‰–æä¸€äº›å‰ç«¯å¼€æºé¡¹ç›®ï¼Œå¯èƒ½ä¼šæ¢è®¨è¿™äº›é¡¹ç›®çš„<strong>è®¾è®¡å’Œç»„ç»‡</strong>ã€æ•´ç†ä»–ä»¬ä½¿ç”¨åˆ°<strong>æŠ€æœ¯æ ˆ</strong>ã€‚ é¦–å…ˆæ‹¿<code>vue-cli</code>å°è¯•ç‰›åˆ€ï¼Œå†å†³å®šåç»­è¦ä¸è¦ç»§ç»­è¿™ä¸ªç³»åˆ—.</p><p><br></p><p>æˆ‘ä¸€ç›´åœ¨æ€è€ƒæˆ‘ä»¬ç¼–ç¨‹ä¸»è¦åœ¨åšä»€ä¹ˆï¼Ÿæˆ‘ä»¬æœ‰ä¸€å¤§éƒ¨åˆ†å·¥ä½œå°±æ˜¯é€‰æ‹©å„ç§å·¥å…·/åº“/æ¡†æ¶ï¼Œæ¥é»åˆä¸šåŠ¡. å·¥å…·å’Œåœºæ™¯è¶ŠåŒ¹é…ã€åŸç†äº†è§£è¶Šå¤šï¼Œè¿ç”¨è¶Šå¨´ç†Ÿï¼Œæˆ‘ä»¬æ•ˆç‡å¯èƒ½å°±è¶Šé«˜. è¿™ç§è¯´æ³•å¾ˆæœ‰äº‰è®®ï¼Œå°±åƒ<code>ç¨‹åº=ç®—æ³•+æ•°æ®ç»“æ„</code>ä¸èƒ½å®Œå…¨è¡¨è¾¾ç°ä»Šçš„è½¯ä»¶å·¥ç¨‹ä¸€æ ·, è¯´æˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯å †ç Œå·¥å…·ï¼Œé»åˆä¸šåŠ¡, ä¸€å®šç¨‹åº¦ä¸Šæœ‰è‡ªè´¬çš„æ„æ€ã€‚ ä½†è¿™ç¡®å®æ˜¯å¤§éƒ¨åˆ†ç¨‹åºå‘˜çš„çœŸå®å†™ç…§ã€‚</p><p>è¿™ç³»åˆ—æ–‡ç« å…¶å®æœ‰ç‚¹ç±»ä¼¼äº github ä¸Šé¢çš„<code>Awesome</code>é¡¹ç›®. è¿™äº› Awesome é¡¹ç›®å°±æ˜¯ä¸€ä¸ª<strong>ç”Ÿæ€å±•è§ˆé¦†</strong>, é‡Œé¢é¡¹ç›®ç³ç…æ»¡ç›®. å› ä¸ºæ•°é‡å¤ªå¤šäº†ï¼Œè€Œä¸”ç¼ºå°‘è¯„åˆ†æœºåˆ¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæˆ‘ä»¬ä¸å¯èƒ½ä¸€ä¸ªä¸ªå»æŸ¥çœ‹ï¼Œå¾ˆéš¾ä»ä¸­é€‰æ‹©ç¬¦åˆéœ€æ±‚çš„é¡¹ç›®(å½“ç„¶ä½ å¸¦ç€æ˜ç¡®çš„ç›®çš„ï¼Œä¸”ç›®æ ‡èŒƒå›´éå¸¸å°ï¼Œå¯èƒ½æ¯”è¾ƒæœ‰ç”¨)ã€‚</p><center><br><img src="/images/05/awesome.png" width="400"><br></center><p>æ˜¯å¦å¯ä»¥å°è¯•æ¢ä¸ªè§’åº¦ï¼Œ<strong>é€‰å–ä¸€äº›æœ‰è¶£çš„å¼€æºé¡¹ç›®ï¼Œçœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåº”ç”¨è¿™äº›å·¥å…·çš„, æœ‰åºçš„ç½—åˆ—å‡ºæ¥? å¯¹äºæœ‰ç›¸åŒåœºæ™¯çš„é¡¹ç›®, å‚è€ƒæˆ–è€…æ¨¡ä»¿ä»·å€¼å¯èƒ½ä¼šæ›´å¤§ä¸€äº›</strong>. è¿™äº›å¼€æºé¡¹ç›®å°±æ˜¯å·¨äººï¼Œç«™åœ¨å·¨äººè‚©è†€ä¸Šæ˜¾ç„¶çœäº‹å¤šäº†</p><p>åªæ˜¯æŠ€æœ¯æ ˆç½—åˆ—æœªå…è¿‡äºç®€å•ï¼Œç¬”è€…è¿˜å¸Œæœ›ä»è¿™äº›é¡¹ç›®ä¸­å­¦ç‚¹ä¸œè¥¿ï¼Œæ¯”å¦‚ä»–çš„è®¾è®¡å’Œé¡¹ç›®ç»„ç»‡. æˆ‘ä¼šå°è¯•ç®€åŒ–å’Œé€šä¿—è§£é‡Šé‡Œé¢çš„å…³é”®çŸ¥è¯†æˆ–äº®ç‚¹, ä½†æ˜¯ä¸æ±‚ç”šè§£ã€‚ä¸ºäº†é¿å…é™·å…¥ç»†èŠ‚æ³¥æ½­ï¼Œæˆ‘ä¼šå°½é‡ä½¿ç”¨å›¾å½¢åŒ–æ–¹å¼å±•ç¤ºä»–ä»¬ç¨‹åºæµç¨‹ï¼Œé¿å…æ‹˜æ³¥äºç»†èŠ‚ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠè¿™äº›æ–‡ç« ä½œä¸ºæ·±å…¥é˜…è¯»è¿™äº›é¡¹ç›®æºç çš„å¼•å¯¼</p><p>æˆ‘ä¹Ÿå¸Œæœ›è¯»è€…åŒæˆ‘äº¤æµåé¦ˆï¼Œå…±åŒå­¦ä¹ å’Œè¿›æ­¥ã€‚</p><p><br></p><hr><p><br></p><h2 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h2><p>è¯´åˆ° CLI, ä¸å¾—ä¸æ<a href="https://ruby-china.github.io/rails-guides/getting_started.html" target="_blank" rel="noopener">Rails</a>æ¡†æ¶ï¼Œå®ƒå¯èƒ½æ˜¯<em>æ¡†æ¶æä¾› CLI çš„å…ˆç¥–</em>(å…·ä½“å†å²æ²¡æœ‰æ·±å…¥è€ƒç©¶). Rails æœ‰ä¸€ä¸ªé‡è¦çš„æŒ‡å¯¼æ€æƒ³ï¼Œå³<strong>çº¦å®šå¤§äºé…ç½®</strong>, <strong>å®ƒä¸º Web åº”ç”¨çš„å¤§å¤šæ•°éœ€æ±‚éƒ½æä¾›äº†æœ€å¥½çš„è§£å†³æ–¹æ³•ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨è¿™äº›çº¦å®šï¼Œè€Œä¸æ˜¯åœ¨é•¿é•¿çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ¯ä¸ªç»†èŠ‚</strong>ã€‚</p><p><strong>CLI ä¹Ÿæ˜¯è¿™ä¸ªæŒ‡å¯¼æ€æƒ³ä¸‹çš„äº§ç‰©</strong>, ä¾‹å¦‚é€šè¿‡å®ƒæä¾›çš„ CLIï¼Œå¯ä»¥åœ¨<a href="https://ruby-china.github.io/rails-guides/getting_started.html" target="_blank" rel="noopener">15 åˆ†é’Ÿå†…æ„å»ºä¸€ä¸ªç®€æ˜“çš„åšå®¢</a>, å¯ä»¥é€šè¿‡ CLI å¯åŠ¨æœåŠ¡å™¨å’Œ REPLã€ç”Ÿæˆé¡¹ç›®è„šæ‰‹æ¶ã€ç”Ÿæˆä»£ç æ–‡ä»¶ã€è·¯ç”±ã€æ•°æ®åº“è¿ç§»ç­‰ç­‰:</p><center><br>  <img src="/images/05/rails-cli.png" width="500"><br></center><p>Rails çš„å¾ˆå¤šè®¾è®¡åœ¨é‚£ä¸ªå¹´ä»£å°±æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜æ˜Ÿ(é—ªç PHPã€JSPã€ ASPâ€¦, æƒ³æƒ³è¦é…ç½®å„ç§æœåŠ¡å™¨ï¼Œå„ç§ xml æ–‡ä»¶)ï¼Œå®ƒçš„å¾ˆå¤šè®¾è®¡æ¨¡å¼æ·±åˆ»å½±å“äº†åé¢çš„ web æ¡†æ¶ï¼Œæ¯”å¦‚ Djangoã€Laravel, ç”šè‡³å¾ˆå¤šæ¨¡ä»¿ Rails å‘½åçš„ï¼Œå¦‚ Sailsã€Grails.</p><p>Rails å¯¹äºå‰ç«¯å¼€å‘å½±å“ä¹Ÿå¾ˆæ·±è¿œï¼Œæ¯”å¦‚åœ¨ Nodejs å‡ºæ¥ä¹‹å‰ï¼ŒRails ç¤¾åŒºå°±å¼€å§‹ä½¿ç”¨ <code>coffeescript + sass</code>é¢„ç¼–è¯‘è¯­è¨€è¿›è¡Œå‰ç«¯å¼€å‘äº†, <a href="https://ruby-china.github.io/rails-guides/asset_pipeline.html" target="_blank" rel="noopener">Asset Pipeline</a>å¯ä»¥è¯´æ˜¯æœ€æ—©çš„â€™å‰ç«¯å·¥ç¨‹åŒ–â€™, é…åˆ<a href="https://github.com/turbolinks/turbolinks" target="_blank" rel="noopener">Turbolink</a>å¯ä»¥è®©ä¼ ç»Ÿåç«¯æ¸²æŸ“é¡µé¢æ‹¥æœ‰ä¸äºšäºå•é¡µåº”ç”¨çš„ç”¨æˆ·ä½“éªŒâ€¦</p><p>å½“åˆ Rails ç»™æˆ‘å¸¦æ¥çš„å„ç§éœ‡æ’¼è¿˜å†å†åœ¨ç›®, <a href="https://ruby-china.org" target="_blank" rel="noopener">Ruby China ç¤¾åŒº</a>ä¹Ÿæ˜¯å›½å†…æœ€å¥½ç¤¾åŒºä¹‹ä¸€. ä½†æ˜¯ç›®å‰ Rails çš„å…³æ³¨åº¦ä¸å¦‚ä»å‰, åœ¨å‰ç«¯ç¤¾åŒºåƒ Rails è¿™ç§é›†å¤§æˆçš„æ¡†æ¶ä¹Ÿæ—©å·²ä¸åƒé¦™(å‚è€ƒ Ember, æŸç§ç¨‹åº¦ä¸Š Angular ä¹Ÿç®—å§?).</p><p>è¯´å®åœ¨è¯å¦‚æœä¸€ç”Ÿåªå­¦ä¸€é—¨è¯­è¨€ï¼Œæˆ‘ä¼šé€‰ Rubyï¼Œå¦‚æœé€‰ä¸€ä¸ª web æ¡†æ¶ï¼Œé‚£å°±æ˜¯ Railsã€‚</p><p>æ¨èå¤§å®¶é˜…è¯»<a href="https://ruby-china.org/wiki/the-rails-doctrine" target="_blank" rel="noopener">The Rails Doctrine - Rails ä¿¡æ¡</a> è¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰ä¸€å¥è¯ç¬”è€…éå¸¸å–œæ¬¢: <strong>â€œåªè¦æ”¾ä¸‹äº†è‡ªè´Ÿçš„ä¸ªäººå–œå¥½ï¼Œä¾¿å¯ä»¥è·³è¿‡æ— è°“çš„ä¸–ä¿—å†³å®šï¼Œä¸“æ³¨åœ¨æœ€é‡è¦çš„åœ°æ–¹ä¸‹æ›´å¿«çš„å†³å®šã€‚â€</strong>ã€‚ä¸ºäººå†™ç¨‹åºï¼Œè€Œä¸æ˜¯ä¸ºäº†æœºå™¨å†™ç¨‹åº.</p><p><strong>çº¦å®šå¤§äºé…ç½®</strong>å¯ä»¥å‡å°‘æˆ‘ä»¬åšå†³å®šçš„æ•°é‡ï¼Œå‡å°‘æ— è°“çš„äº‰è®ºå’Œè€ƒè™‘ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºæ›´é‡è¦çš„äº‹æƒ…. è¿™ä¸ªåŸåˆ™å¯ä»¥æé«˜å¼€å‘å’Œå›¢é˜Ÿåä½œæ•ˆç‡, ç”šè‡³å¯ä»¥å‡èšä¸€ä¸ªç¤¾åŒº.</p><p>ä»¥ Webpack ä¸ºä¾‹ï¼Œæ¶å¿ƒå¤æ‚çš„é…ç½®è¢«äººè¯Ÿç—…ï¼Œæ‰€ä»¥æ‰éœ€è¦ vue-cli æˆ–è€… create-react-app è¿™äº›å·¥å…·.</p><blockquote><p>æ²¡æœ‰ç”¨ Ruby/Rails å·¥ä½œè¿‡, é»˜é»˜å†™äº†ä¸ª Ruby China å°ç¨‹åº(å¾®ä¿¡æœ<code>Ruby CN</code>)ï¼Œç®—æ˜¯æ„Ÿæ©å›é¦ˆç¤¾åŒºå§</p></blockquote><p><br></p><p>Ok, å¿ä¸ä½å¹äº†ä¸€æ³¢ Rails, å›åˆ°æ­£é¢˜.</p><p>ç¬”è€…æ˜¯ä½¿ç”¨ React ä½œä¸ºä¸»åŠ›å¼€å‘çš„ï¼ŒVue ä¹Ÿæ˜¯æˆ‘éå¸¸å–œæ¬¢çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¸è¯´åˆ«çš„ï¼Œåœ¨å¼€å‘è€…çš„â€™ç”¨æˆ·ä½“éªŒâ€™æ–¹é¢ Vue æ˜¯æˆ‘è§è¿‡æœ€å¥½ä¹‹ä¸€ï¼Œä¸»è¦ä½“ç°åœ¨ API çš„ç®€æ´æ€§å’Œæ˜“ç”¨æ€§ã€æ–‡æ¡£è¿˜æœ‰é¡¹ç›®æ„å»ºå·¥å…·(ä»Šå¤©çš„ä¸»è§’).</p><p>vue-cli-ui æ˜¯æˆ‘æƒ³å†™è¿™ç³»åˆ—æ–‡ç« çš„åŠ¨æœºä¹‹ä¸€. å‰é˜µå­ç”¨äº†ä¸€ä¸‹<code>vue-cli-ui</code>, æ„Ÿè§‰å¾ˆä¸é”™, æ”¯æŒå¯è§†åŒ–é…ç½®å’Œä»»åŠ¡è¿è¡Œï¼Œæ¯”æˆ‘åœ¨ç»ˆç«¯ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸€ä¸ªé¡¹ç›®è·‘ task æ¸…çˆ½å¤šäº†. å¾ˆæƒ³åœ¨æˆ‘ä»¬è‡ªå®¶çš„æ„å»ºå·¥å…·ä¸Šä¹Ÿæä¸€å¥—ï¼Œæ€æï¼Ÿ å­¦ä¹ å®ƒçš„æºç , æˆ‘è§‰å¾—å¯ä»¥ä½œä¸ºåšå®¢è®°å½•ä¸‹æ¥.</p><p>ç°åœ¨å‰ç«¯å·¥ç¨‹å¸ˆä¹Ÿæœ‰â€˜webpack é…ç½®å·¥ç¨‹å¸ˆâ€™çš„æˆç§°ï¼Œè¿™èƒ½è¯´æ˜ webpack é…ç½®æ˜¯è´¹æ—¶è´¹åŠ›çš„è‹¦äº‹(Angular ä¾‹å¤–). è¿™ä¸åæ¥å°±æœ‰äº†<code>parcel</code>å®£ç§°é›¶é…ç½®çš„è½®å­, è¿˜æœ‰ React ç¤¾åŒºçš„<code>create-react-app</code>, vue-cli å‰æœŸæ˜¯åŸºäºæ¨¡æ¿çš„åˆ›å»ºé¡¹ç›®, ä¸ç®—æ­¤åˆ—ã€‚</p><p>åæ¥ vue-cli æ±²å–ç€å‰è€…çš„å¾ˆå¤šä¼˜ç‚¹ï¼ŒæŠŠè¿™å—åšå¤§åšä¼˜äº†(çœ‹æ¥ vue å¾ˆæ“…é•¿åšè¿™äº›äº‹æƒ…). æˆ‘ä»¬å¯ä»¥æ¥å¯¹æ¯”ä¸€ä¸‹è¿™äº›å·¥å…·:</p><p><br></p><table><thead><tr><th></th><th>Vue CLI</th><th>create-react-app</th><th>parcel</th></tr></thead><tbody><tr><td>å¿«é€ŸåŸå‹å¼€å‘</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>å…¨å±€æ¨¡å¼</td><td>é›¶é…ç½®åŸå‹å¼€å‘å°±æ˜¯å…¨å±€çš„</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>æ’ä»¶</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒï¼Œæ‰©å±•æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶è¾“å‡º</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¼ºï¼Œé€šè¿‡æ’ä»¶æ‰©å±• wepack é…ç½®</td><td>å¼±, å¼ºçº¦å®š, æ— æ³•é…ç½® webpackï¼Œå¯ä»¥ eject, ç„¶åæ‰‹å·¥é…ç½®ï¼›æ”¯æŒ babel-macro;(ä¸¥æ ¼è¯´å¯ä»¥é€šè¿‡<a href="https://github.com/timarney/react-app-rewired" target="_blank" rel="noopener">react-app-rewired</a>è¿›è¡Œæ‰©å±•)</td><td>ä¸­(å¯ä»¥é…ç½® babelï¼Œpostcssï¼ŒTypescript); æä¾›äº† Node API; æ”¯æŒæ’ä»¶æ‰©å±•æ–‡ä»¶ç±»å‹</td></tr><tr><td>å¤šé¡µé¢</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>é€‚ç”¨èŒƒå›´</td><td>Vue ç»„ä»¶çš„ç¬¬ä¸€å…¬æ°‘ã€‚é€šè¿‡æ‰©å±•å¯ä»¥æ”¯æŒä»»æ„å‰ç«¯æ¡†æ¶</td><td>é’ˆå¯¹ React å¼€å‘ï¼Œä¸æ”¯æŒå…¶ä»–æ¡†æ¶</td><td>parcel æ˜¯ä¸€ä¸ªé€šç”¨çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„ç«äº‰å¯¹æ‰‹æ˜¯ webpack</td></tr><tr><td>ç¼–è¯‘é€Ÿåº¦</td><td>cache-loader,thread-loader æ¥åŠ é€Ÿ JS å’Œ TS ç¼–è¯‘</td><td>babel-loader å¼€å¯äº† cache</td><td>ç¼–è¯‘é€Ÿåº¦å·ç§°æ˜¯ webpack çš„ä¸¤å€</td></tr><tr><td>å¯å‡çº§æ€§</td><td>æ”¯æŒå‡çº§ cli-service, æ’ä»¶éœ€è¦å•ç‹¬å‡çº§, æ’ä»¶éœ€è¦éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬. å¤ªå¤šæ’ä»¶å­˜åœ¨å‡çº§é£é™©</td><td>æ”¯æŒå‡çº§ react-script, å®˜æ–¹ç»´æŠ¤ï¼Œä¸”å¼ºçº¦å®šåŸºæœ¬å¯ä»¥ä¿éšœå‘ä¸‹å…¼å®¹</td><td>æ”¯æŒå‡çº§ parcel-bundler</td></tr><tr><td>UI</td><td>å›¾å½¢åŒ–ç®¡ç†æ˜¯ CLI çš„ç‰¹è‰²ä¹‹ä¸€</td><td>-</td><td>-</td></tr></tbody></table><p><br></p><p>é€šè¿‡ä¸Šé¢çš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡º <strong>vue-cli æ˜¯ä¸€ä¸ªæ‰©å±•æ€§éå¸¸å¼ºçš„æ„å»ºå·¥å…·ï¼Œä»¥è‡´äºå®ƒä¸ä»…é™äº Vueï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ„å»º React ç”šè‡³å…¶ä»–å‰ç«¯æ¡†æ¶</strong>ã€‚</p><p>ç›¸æ¯”è€Œè¨€ <code>create-react-app</code> å°±æ˜¯ä¸€ä¸ªéå¸¸ Opinionated(åšæŒå·±è§) çš„å·¥å…·ï¼Œå¼ºçº¦å®š. ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯å®ƒä¸å†…ç½®å¼€å¯ babel è£…é¥°å™¨è½¬è¯‘ï¼ŒCRA å›¢é˜Ÿè®¤ä¸ºå·²ç»åºŸå¼ƒ(æˆ–è€…ä¸æˆç†Ÿ)çš„è¯­è¨€ç‰¹æ€§ä¸åº”è¯¥å¸¦åˆ° CRA ä¸­; åé¢ä¸ºäº†ç»™â€˜ä¼˜é›…â€™åœ°ç»™ babel æ‰©å±•æ’ä»¶ï¼Œå°±æ£é¼“å‡ºæ¥äº†<code>babel-macro</code>, è¿™æ˜¯ä¸€ç§â€™å…é…ç½®â€™çš„ babel æ’ä»¶è§„èŒƒ.</p><p>è¿™ç§å¼ºçº¦å®šä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼Œæ¯”å¦‚ä¸éœ€è¦ç®¡ç†é…ç½®; è€Œä¸” CRA å›¢é˜Ÿè°¨æ…å¯é åœ°ç»´æŠ¤ç€ CRAï¼Œè¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ä¸€èˆ¬æ— ç—›åœ°å‡çº§ CRA. å¦‚æœè¦æ‰©å±• webpackï¼Œä¸€èˆ¬åªæœ‰ ejectï¼Œè¿™å°±èµ°å›äº†æ‰‹åŠ¨é…ç½® webpack çš„è€è·¯, ä¸å¯å–.</p><p>vue-cli ä¹Ÿæ˜¯ä¸€ä¸ªâ€™æ¸è¿›å¼â€™çš„ cliï¼Œvue-cli æä¾›äº†é»˜è®¤çš„ presetï¼Œä½†ä¸é˜»æ­¢ä½ å¯¹å…¶è¿›è¡Œæ‰©å±•. vue-cli çš„æ‰©å±•æ¥å£ä¹Ÿéå¸¸ç®€æ´(åˆç†, ä¸å¤šä¸å°‘), è¿˜æœ‰ UI ç®¡ç†ç•Œé¢ï¼Œå¯è§†åŒ–ç®¡ç†é¡¹ç›®çš„é…ç½®å’Œæ’ä»¶ï¼Œç”¨æˆ·ä½“éªŒå¾ˆæ£’ï¼Œè®¡åˆ’åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç» vue ui. å”¯ä¸€æ¯”è¾ƒä¸èˆ’æœçš„æ˜¯å¦‚æœæ»¥ç”¨è¿™ç§æ‰©å±•æ€§ï¼Œè£… N å¤šæ’ä»¶ï¼Œè€Œä¸”æ’ä»¶ä¹‹é—´è¿˜å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œä¹Ÿä¼šæˆä¸ºå‡çº§ç»´æŠ¤çš„è´Ÿæ‹….</p><p><br></p><hr><p><br></p><h2 id="åŸºæœ¬è®¾è®¡"><a href="#åŸºæœ¬è®¾è®¡" class="headerlink" title="åŸºæœ¬è®¾è®¡"></a>åŸºæœ¬è®¾è®¡</h2><p>æ³¨æ„ï¼Œæœ¬æ–‡ä¸æ˜¯ vue-cli çš„æ•™ç¨‹ï¼Œæœ€å¥½çš„æ•™ç¨‹æ˜¯<a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#prompts" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>.</p><p><br></p><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p>ä¸‹é¢æ˜¯ vue-cli çš„åŸºæœ¬ç›®å½•ç»“æ„. å¤§éƒ¨åˆ†å¤§å‹çš„å‰ç«¯é¡¹ç›®éƒ½ä½¿ç”¨ lerna å®ç° mono-repo æ¨¡å¼, ç„¶åç»Ÿä¸€åˆ†å‘åˆ° npm. è¿™ç§æ¨¡å¼æœ‰åˆ©äºé¡¹ç›®æ¨¡å—ç»„ç»‡</p><center><br>  <img src="/images/05/vue-cli-struct.png" width="700"><br></center><p><br></p><h3 id="åˆ†ç¦»-cli-å±‚å’Œ-service-å±‚"><a href="#åˆ†ç¦»-cli-å±‚å’Œ-service-å±‚" class="headerlink" title="åˆ†ç¦» CLI å±‚å’Œ Service å±‚"></a><strong>åˆ†ç¦» CLI å±‚å’Œ Service å±‚</strong></h3><p>è¿™ä¸ªè®¾è®¡æ˜¯å€Ÿé‰´<code>create-react-app</code>çš„, CLI å±‚åªæ˜¯ä¸€äº›åŸºç¡€çš„å‘½ä»¤ä¸€èˆ¬ä¸éœ€è¦é¢‘ç¹å‡çº§ï¼Œè€Œä¸”æ˜¯å…¨å±€å®‰è£…; è€Œ Service å±‚æ˜¯å¤šå˜çš„, ä½œä¸ºé¡¹ç›®çš„å±€éƒ¨ä¾èµ–ï¼Œä¸åº”è¯¥ç¡¬ç¼–ç åœ¨ CLI é‡Œé¢. CLI å’Œ Service çš„èŒè´£åˆ’åˆ†å¦‚ä¸‹:</p><p><br></p><ul><li><p>CLI: ç”¨äºé¡¹ç›®åˆ›å»ºå’Œç®¡ç†</p><ul><li>å…¨å±€å®‰è£…</li><li><code>vue create</code> åˆ›å»ºé¡¹ç›®è„šæ‰‹æ¶. æ‹‰å–æœ€æ–°çš„ Serviceï¼Œå¹¶é€‰æ‹©é…ç½®éœ€è¦çš„æ’ä»¶</li><li><code>vue ui</code>. å¯åŠ¨ UI ç®¡ç†ç•Œé¢</li><li>å¿«é€ŸåŸå‹å¼€å‘: <code>vue serve</code> | <code>vue build</code>, ç›´æ¥ä¼ºæœå’Œç¼–è¯‘ä¸€ä¸ª Vue æ–‡ä»¶</li><li>æ’ä»¶ç®¡ç†: <code>vue add</code> | <code>vue invoke</code> å®‰è£…æ’ä»¶å’Œè°ƒç”¨æ’ä»¶ç”Ÿæˆå™¨</li></ul></li><li><p>Service: è´Ÿè´£é¡¹ç›®çš„å®é™…æ„å»º</p><ul><li>å±€éƒ¨å®‰è£…</li><li>é›†æˆ webpack æ„å»ºç¯å¢ƒï¼Œ<strong>Service æœ¬èº«åªæœ‰ä¸€ä¸ªæ’ä»¶æœºåˆ¶, æ‰€æœ‰æ„å»ºç›¸å…³é€»è¾‘éƒ½ç”±å†…ç½®æ’ä»¶å’Œå¤–éƒ¨æ’ä»¶æä¾›</strong></li><li>å†…ç½®æ’ä»¶(å‘½ä»¤): serve, build, inspect</li></ul></li></ul><p><br><br><br></p><h3 id="æ’ä»¶ç³»ç»Ÿ"><a href="#æ’ä»¶ç³»ç»Ÿ" class="headerlink" title="æ’ä»¶ç³»ç»Ÿ"></a><strong>æ’ä»¶ç³»ç»Ÿ</strong></h3><p>vue-cli æä¾›äº†ç±»ä¼¼ babelã€eslint çš„æ’ä»¶æœºåˆ¶ã€‚</p><center><br>  <img src="/images/05/plugins.png" width="400"><br></center><p><br></p><h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a><strong>æ’ä»¶</strong></h4><p>æ’ä»¶æœºåˆ¶æ˜¯ vue-cli çš„æ ¸å¿ƒ, ç”¨äºæ‰©å±• Service. Service çš„<code>å‘½ä»¤</code>å’Œ webpack é…ç½®éƒ½ç”±æ’ä»¶æä¾›.</p><p>å…¶å®æ’ä»¶æœºåˆ¶æœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯éš¾åº¦, æ¢å¥è¯è¯´<strong>æ’ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªåè®®çš„è®¾è®¡</strong>. vue-cli æ’ä»¶çš„åè®®å¦‚ä¸‹:</p><ul><li><strong>å‘½å</strong>: <code>@vue/cli-plugin-*</code>æˆ–<code>vue-cli-plugin-*</code>. package.json ä¸­æŒ‰ç€è¿™ä¸ªå‘½åçº¦å®šçš„ä¾èµ–ä¼šè¢«è¯†åˆ«ä¸º vue-cli æ’ä»¶ï¼Œå¦å¤–å‘½åçº¦å®šä¹Ÿæœ‰åˆ©äºåœ¨ github æˆ– npm ä¸Šç­›é€‰</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>:<br>ä¸€ä¸ªæ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸º<code>å®‰è£…é˜¶æ®µ</code>å’Œ<code>è¿è¡Œé˜¶æ®µ</code>. <code>vue create</code>å‘½ä»¤åˆ›å»ºé¡¹ç›®è„šæ‰‹æ¶ã€<code>vue add</code>ä»¥åŠ<code>vue invoke</code>æ’ä»¶å®‰è£…å‘½ä»¤éƒ½å±äºå®‰è£…é˜¶æ®µ; è€Œ cli-service å‘½ä»¤æ‰§è¡Œæ—¶å±äºè¿è¡Œé˜¶æ®µ.</li><li><p><strong>åŸºæœ¬ç»“æ„</strong>: åŒºåˆ†äº†ç”Ÿå‘½å‘¨æœŸåï¼Œæ’ä»¶çš„ç»“æ„å°±æ¯”è¾ƒæ¸…æ™°äº†:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ generator.js  # generator (å¯é€‰)</span><br><span class="line">â”œâ”€â”€ prompts.js    # prompt æ–‡ä»¶ (å¯é€‰)</span><br><span class="line">â”œâ”€â”€ index.js      # service æ’ä»¶</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure><ul><li>å®‰è£…é˜¶æ®µ:<ul><li>prompts: æ”¶é›†ç”¨æˆ·æ„è§å’Œé…ç½®</li><li>gernerator: åœ¨å®‰è£…é˜¶æ®µç”Ÿæˆæ¨¡æ¿æ–‡ä»¶</li></ul></li><li>è¿è¡Œæ—¶: index.js<ul><li>æ³¨å…¥ service å‘½ä»¤</li><li>æ‰©å±•å’Œä¿®æ”¹ webpack é…ç½®. vue-cli é€šè¿‡<code>webpack-chain</code>å’Œ<code>webpack-merge</code>æ¥å®ç° webpack å¯é…ç½®åŒ–</li></ul></li></ul></li></ul><p><br></p><p>ä¸€ä¸ªç®€å•çš„æ’ä»¶ç»“æ„æ˜¯è¿™æ ·å­çš„:</p><center><br>  <img src="/codes/vue-plugin.png" width="600"><br></center><p><br></p><h4 id="preset"><a href="#preset" class="headerlink" title="preset"></a><strong>preset</strong></h4><p>è¿™ä¸ª preset å’Œ babel çš„ preset æ¦‚å¿µå®é™…ä¸Šæ˜¯ä¸ä¸€æ ·çš„:</p><p><strong>vue-cli çš„ preset ä¸€ä¸ªè„šæ‰‹æ¶åˆ›å»ºæ–¹æ¡ˆ</strong>, ä¹Ÿå°±æ˜¯è¯´å®ƒåªä½œç”¨äº<code>vue create</code>é˜¶æ®µã€‚æ¯”å¦‚<code>vue create</code>æ—¶é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ babel+eslint preset. preset å¯ä»¥ç®€åŒ–é¡¹ç›®è„šæ‰‹æ¶çš„åˆ›å»ºã€‚<strong>å›¢é˜Ÿå¯ä»¥å…±äº«ä¸€ä¸ª preset æ¥åˆ›å»ºè„šæ‰‹æ¶</strong>ã€‚</p><p><strong>è€Œ babel ä¸­çš„ preset æ˜¯ä¸€ä¸ªæ’ä»¶é›†åˆï¼Œä»–å¯ä»¥ç»Ÿä¸€æ”¶çº³å’Œç®¡ç†ä¸€ç»„æ’ä»¶æ–¹æ¡ˆ</strong>. ä¾‹å¦‚<code>babel-preset-react</code>ã€ <code>babel-preset-env</code>. ä¸Šæ–‡è¯´åˆ°å¦‚æœæ‰©å±•æ€§è¢«æ»¥ç”¨ï¼Œè£… N å¤šæ’ä»¶ï¼Œè€Œä¸”æ’ä»¶ä¹‹é—´è¿˜å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œä¹Ÿä¼šæˆä¸ºå‡çº§ç»´æŠ¤çš„è´Ÿæ‹…. è€Œ â€˜babel å¼â€™çš„ preset å¯ä»¥è®©æ’ä»¶æ›´æ–¹ä¾¿ç»´æŠ¤å’Œå’Œ<strong>ä¸€é”®å¼å‡çº§</strong>ã€‚</p><p>å°½ç®¡ç›®å‰ vue ä¹Ÿæä¾›äº†<code>vue upgrade</code>å¯¹æ’ä»¶è¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªæ˜¯åŸºäºè¯­ä¹‰åŒ–ç‰ˆæœ¬çº¦å®šçš„, ä¸”å½“æ’ä»¶ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»æ—¶, ä¸æ’é™¤å‡çº§å­˜åœ¨é£é™©. å°¤å…¶å¯¹äºå›¢é˜Ÿé¡¹ç›®è¿˜æ˜¯æ¨èæœ‰ç»Ÿä¸€åœ°ç®¡ç†è¿™äº›æ’ä»¶, å®ç°å‚»ç“œåŒ–çš„å‡çº§ã€‚ å®é™…ä¸Šè¿™ç§ â€˜babel å¼â€™çš„ preset æ˜¯å¯ä»¥é€šè¿‡ vue-plugin å®ç°å’Œè½¬å‘çš„ã€‚</p><p><br></p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a><strong>é…ç½®</strong></h4><p>vue æ”¯æŒåœ¨ package.json çš„ <code>vue</code> å­—æ®µæˆ–<code>vue.config.js</code>ä¸­è¿›è¡Œé…ç½®ã€‚è¿™é‡Œå¯ä»¥å¯¹ Service æ ¸å¿ƒåŠŸèƒ½å’Œæ’ä»¶è¿›è¡Œé…ç½®, ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ webpack é…ç½®. å¦å¤–éƒ¨åˆ†æ„å»ºè¡Œä¸ºæ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œå½±å“çš„ï¼Œè¿™äº›å¯ä»¥é€šè¿‡<code>.env.*</code>æ–‡ä»¶è¿›è¡Œé…ç½®</p><p><br></p><h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a><strong>åŸºæœ¬æµç¨‹</strong></h3><p>ç°åœ¨æ¥çœ‹çœ‹ä¸€ä¸ª vue-cli å†…éƒ¨çš„åŸºæœ¬æµç¨‹, Service çš„æ’ä»¶å®ç°æ˜¯ vue-cli æ¯”è¾ƒæœ‰æ„æ€çš„ç‚¹. ä»¥<code>vue serve</code>ä¸ºä¾‹:</p><center><br>  <img src="/images/05/vue-cli.png"><br></center><p>Service å¯¹è±¡æ˜¯ vue-cli çš„æ ¸å¿ƒå¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç†å’Œåº”ç”¨æ’ä»¶ï¼Œæ‰€æœ‰å‘½ä»¤å’Œ webpack é…ç½®éƒ½æ˜¯ä»¥æ’ä»¶çš„å½¢å¼å­˜åœ¨:</p><center><br>  <img src="/images/05/vue-service-struct.png" width="700"><br></center><p><strong>é¦–å…ˆåˆ’åˆ†ä¸ºé…ç½®é˜¶æ®µå’Œè¿è¡Œé˜¶æ®µ</strong>ã€‚ é…ç½®é˜¶æ®µ vue-cli ä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶æŸ¥æ‰¾å’Œåº”ç”¨æ‰€æœ‰æ’ä»¶ã€‚å°† PluginAPI å®ä¾‹å’Œé¡¹ç›®é…ç½®ä¼ é€’ç»™æ’ä»¶è¿è¡Œæ—¶, æ’ä»¶è¿è¡Œæ—¶é€šè¿‡ PluginAPI æ³¨å…¥å‘½ä»¤(registerCommand)å’Œ æ‰©å±• webpack é…ç½®(chainWebpack, configureWebpack).</p><p>è¿è¡Œé˜¶æ®µåˆ™æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‘½ä»¤åè°ƒç”¨æ’ä»¶æ³¨å…¥å‘½ä»¤ã€‚åœ¨å‘½ä»¤å®ç°å‡½æ•°ä¸­ï¼Œå¯ä»¥è°ƒç”¨ resolveWebpackConfig()æ¥ç”Ÿæˆæœ€ç»ˆçš„ webpack é…ç½®ã€‚ä»¥ serve å‘½ä»¤ä¸ºä¾‹ï¼Œè·å–åˆ° webpackConfig åä¼šåˆ›å»ºä¸€ä¸ª webpack ç¼–è¯‘å™¨ï¼Œå¹¶å¼€å¯ webpack-dev-server å¼€å‘æœåŠ¡å™¨.</p><p><br></p><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><ul><li><strong>ç»„ç»‡</strong><ul><li><a href="http://lernajs.io" target="_blank" rel="noopener">lerna</a></li></ul></li><li><strong>cli å‘½ä»¤è¡Œç›¸å…³å·¥å…·</strong><ul><li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener">chalk</a>: å‘½ä»¤è¡Œå­—ä½“é¢œè‰²æ ·å¼</li><li><a href="https://www.npmjs.com/package/cli-highlight" target="_blank" rel="noopener">cli-highlight</a>: ç»ˆç«¯è¯­æ³•é«˜äº®è¾“å‡º, ç±»ä¼¼äº Highlight.js</li><li><a href="https://www.npmjs.com/package/cliui" target="_blank" rel="noopener">cliui</a>: åœ¨ç»ˆç«¯ä¸­è¿›è¡Œå¤šåˆ—è¾“å‡º</li><li><a href="https://github.com/dcporter/didyoumean.js" target="_blank" rel="noopener">didyoumean</a>: æ ¹æ®å•è¯ç›¸ä¼¼åº¦ï¼Œæ¥å¯¹ç”¨æˆ·è¾“å…¥çº æ­£æç¤º</li><li><a href="https://www.npmjs.com/package/semver" target="_blank" rel="noopener">semver</a>: æä¾›è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ç›¸å…³çš„å·¥å…·å‡½æ•°ã€‚ ä¾‹å¦‚æ¯”è¾ƒï¼Œè§„èŒƒåŒ–</li><li><a href="https://github.com/tj/commander.js#readme" target="_blank" rel="noopener">commander</a> TJ å†™çš„å‘½ä»¤è¡Œé€‰é¡¹å’Œå‚æ•°è§£æå™¨ï¼Œæ”¯æŒå­å‘½ä»¤ï¼Œé€‰é¡¹æ ¡éªŒå’Œç±»å‹è½¬æ¢ï¼Œå¸®ç»„ä¿¡æ¯ç”Ÿæˆç­‰ç­‰. API ç®€å•ä¼˜é›…</li><li><a href="https://www.npmjs.com/package/minimist" target="_blank" rel="noopener">minimist</a>: ä¸€ä¸ªæç®€çš„å‘½ä»¤è¡Œå‚æ•°è§£æå™¨ã€‚å¦‚æœåªæ˜¯ç®€å•çš„é€‰é¡¹è§£æï¼Œå¯ä»¥ç”¨è¿™ä¸ªåº“</li><li><a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener">inquirer</a> å‘½ä»¤è¡Œè¯¢é—®</li><li><a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener">ora</a> å‘½ä»¤è¡Œ spinner</li><li><a href="https://github.com/yyx990803/launch-editor" target="_blank" rel="noopener">launch-editor</a> æ‰“å¼€ç¼–è¾‘å™¨. é€šè¿‡ node æ‰“å¼€ç¼–è¾‘å™¨ï¼Œå‰ç«¯å¯ä»¥ express æš´éœ²æ¥å£è°ƒç”¨æ‰“å¼€</li><li><a href="https://www.npmjs.com/package/open" target="_blank" rel="noopener">open</a> æ‰“å¼€ URLã€æ–‡ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶</li><li><a href="https://www.npmjs.com/package/execa" target="_blank" rel="noopener">execa</a> æ›´å¥½çš„ child_processï¼Œä¿®å¤äº†åŸç”Ÿ exec çš„ä¸€äº›é—®é¢˜</li><li>validate-npm-package-name: éªŒè¯ npm åŒ…åç§°ï¼Œæ¯”å¦‚åˆ›å»ºçš„é¡¹ç›®åæ˜¯å¦åˆæ³•</li><li><a href="https://www.npmjs.com/package/dotenv" target="_blank" rel="noopener">dotenv</a> &amp; <a href="https://www.npmjs.com/package/dotenv-expand" target="_blank" rel="noopener">dotenv-expand</a>: ä».env æ–‡ä»¶ä¸­åŠ è½½é…ç½®ï¼Œç¯å¢ƒå˜é‡</li></ul></li><li><strong>ç½‘ç»œç›¸å…³</strong><ul><li><a href="https://www.npmjs.com/package/portfinder" target="_blank" rel="noopener">portfinder</a>: è·å–å¯ç”¨çš„ç«¯å£</li><li><a href="https://www.npmjs.com/package/address" target="_blank" rel="noopener">address</a>: è·å–å½“å‰ä¸»æœºçš„ ipï¼ŒMAC å’Œ DNS æœåŠ¡å™¨</li></ul></li><li><strong>æ–‡ä»¶å¤„ç†ç›¸å…³</strong><ul><li><a href="https://www.npmjs.com/package/slash" target="_blank" rel="noopener">slash</a> ä¸€è‡´åŒ–å¤„ç†è·¯å¾„ä¸­çš„åˆ†éš”ç¬¦</li><li><a href="https://www.npmjs.com/package/fs-extra" target="_blank" rel="noopener">fs-extra</a> node fs æ¨¡å—æ‰©å±•</li><li>globby: glob æ¨¡å¼åŒ¹é…</li><li>rimraf è·¨å¹³å°æ–‡ä»¶åˆ é™¤å‘½ä»¤</li><li><a href="https://www.npmjs.com/package/memfs" target="_blank" rel="noopener">memfs</a> å…¼å®¹ Node fs API çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿ</li></ul></li><li><strong>æ•°æ®æ£€éªŒ</strong><ul><li><a href="https://www.npmjs.com/package/@hapi/joi" target="_blank" rel="noopener">@hapi/joi</a> JSON schema æ ¡éªŒ</li></ul></li><li><strong>è°ƒè¯•</strong><ul><li><a href="https://www.npmjs.com/package/debug" target="_blank" rel="noopener">debug</a>: è¿™æ˜¯ä¸€ä¸ª debug æ—¥å¿—åˆ©å™¨, æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æˆ–åŠ¨æ€è®¾ç½®æ¥ç¡®å®šæ˜¯å¦éœ€è¦è¾“å‡º; æ”¯æŒ printf é£æ ¼æ ¼å¼åŒ–</li></ul></li><li><strong>ç®—æ³•</strong><ul><li>hash-sum: æ•£åˆ—å€¼è®¡ç®—</li><li>deepmerge æ·±åˆå¹¶</li></ul></li><li><strong>å…¶ä»–</strong><ul><li><a href="https://github.com/benjamn/recast" target="_blank" rel="noopener">recast</a> Javascript è¯­æ³•æ ‘è½¬æ¢å™¨ï¼Œæ”¯æŒéç ´åæ€§çš„æ ¼å¼åŒ–è¾“å‡º. å¸¸ç”¨äºæ‰©å±• js ä»£ç </li><li><a href="https://www.npmjs.com/package/javascript-stringify" target="_blank" rel="noopener">javascript-stringify</a>: ç±»ä¼¼äº JSON.stringify, å°†å¯¹è±¡å­—ç¬¦ä¸²åŒ–ã€‚</li></ul></li><li><strong>webpack</strong><ul><li>é…ç½®å®šä¹‰<ul><li>webpack-merge: åˆå¹¶ webpack é…ç½®å¯¹è±¡</li><li>webpack-chain: é“¾å¼é…ç½® webpack. è¿™ä¸¤ä¸ªåº“æ˜¯ vue-cli æ’ä»¶çš„é‡è¦æˆå‘˜</li></ul></li><li>webpack-dev-server: webpack å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒä»£ç çƒ­é‡è½½ï¼Œé”™è¯¯ä¿¡æ¯å±•ç¤ºï¼Œæ¥å£ä»£ç†ç­‰ç­‰</li><li>webpack-bundle-analyzer: webpack åŒ…åˆ†æå™¨</li></ul></li><li><strong>æ‰©å±•(ä¸€äº›ç›¸å…³çš„æŠ€æœ¯æ ˆ)</strong><ul><li>http-server å¿«é€Ÿä¼ºæœé™æ€æ–‡ä»¶</li><li>plop æ¨¡æ¿ç”Ÿæˆå™¨</li><li>yeoman é¡¹ç›®è„šæ‰‹æ¶å·¥å…·</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæ–°å¼€çš„â€™å®éªŒæ€§â€™æ–‡ç« ç³»åˆ—ï¼Œå¦‚å…¶åâ€˜æŠ€æœ¯åœ°å›¾â€™ï¼Œè¿™ä¸ªç³»åˆ—è®¡åˆ’å‰–æä¸€äº›å‰ç«¯å¼€æºé¡¹ç›®ï¼Œå¯èƒ½ä¼šæ¢è®¨è¿™äº›é¡¹ç›®çš„&lt;strong&gt;è®¾è®¡å’Œç»„ç»‡&lt;/strong&gt;ã€æ•´ç†ä»–ä»¬ä½¿ç”¨åˆ°&lt;strong&gt;æŠ€æœ¯æ ˆ&lt;/strong&gt;ã€‚ é¦–å…ˆæ‹¿&lt;code&gt;vue-cli&lt;/code&gt;å°è¯•ç‰›åˆ€ï¼Œå†å†³å®š
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“05 - çŠ¶æ€ç®¡ç†</title>
    <link href="https://bobi.ink/2019/05/20/react-component-design-05/"/>
    <id>https://bobi.ink/2019/05/20/react-component-design-05/</id>
    <published>2019-05-19T16:00:00.000Z</published>
    <updated>2019-05-22T06:44:27.830Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯ 520ï¼Œè¿™æ˜¯æœ¬ç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦æ¶µç›– React çŠ¶æ€ç®¡ç†çš„ç›¸å…³æ–¹æ¡ˆã€‚</p><p>å‰å‡ ç¯‡æ–‡ç« åœ¨<a href="https://juejin.im" target="_blank" rel="noopener">æ˜é‡‘</a>é¦–å‘åŸºæœ¬çŸ³æ²‰å¤§æµ·, æ²¡ä»€ä¹ˆé˜…è¯»é‡. å¯èƒ½æ˜¯æ–‡ç« ç¯‡å¹…å¤ªé•¿äº†ï¼Ÿæ˜é‡‘å€¼å¤ªä½äº†ï¼Ÿ è¿˜æ˜¯é”™åˆ«å­—å¤ªå¤šäº†? åé¢é™ä¸‹å¿ƒæ¥æƒ³æƒ³ï¼Œå†™ä½œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ç§å­¦ä¹ å’Œç§¯ç´¯çš„è¿‡ç¨‹, è®©æˆ‘å­¦ä¹ æ›´å…¨é¢æ›´ç³»ç»Ÿæ€§å»æè¿°ä¸€ä¸ªäº‹ç‰©. ä½†æ˜¯å†™ä½œç¡®å®æ˜¯ä¸€ä»¶éå¸¸è€—æ—¶çš„äº‹æƒ…, æ–‡ç« çš„æ¯å¥è¯éƒ½è¦ç»†ç»†æ¨æ•², è¿˜è¦é¿å…ä¸»è§‚æ€§å¤ªå¼ºé¿å…è¯¯å¯¼äº†åˆ«äºº.</p><p>æ‰€ä»¥æ¨¡ä»¿<a href="https://kernelpanic.fm" target="_blank" rel="noopener">&lt;&lt;å†…æ ¸ææ…Œ&gt;&gt;</a>çš„å£å·: â€œæƒ³çœ‹çš„äººçœ‹ï¼Œä¸æƒ³çœ‹çš„äººå°±åˆ«çœ‹â€</p><p><br></p><p><strong>ç³»åˆ—ç›®å½•</strong></p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li><a href="/2019/05/20/react-component-design-05/">05 çŠ¶æ€ç®¡ç†</a></li></ul><p><br></p><p><strong>æ–‡ç« ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#çŠ¶æ€ç®¡ç†">çŠ¶æ€ç®¡ç†</a></li><li><a href="#ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†">ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†</a></li><li><a href="#ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†">ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†</a></li><li><a href="#redux">Redux</a></li><li><a href="#mobx">Mobx</a></li><li><a href="#rxjs">RxJS</a></li><li><a href="#å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ">å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ</a></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h2><p>ç°åœ¨çš„å‰ç«¯æ¡†æ¶ï¼ŒåŒ…æ‹¬ React çš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>æ•°æ®é©±åŠ¨è§†å›¾</strong>, å³<code>UI = f(state)</code>. è¿™ç§å¼€å‘æ–¹å¼çš„å˜åŒ–å…¶å®å¾—ç›Šäº Virtual-DOM, å®ƒä½¿å¾—æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒæµè§ˆå™¨åº•å±‚ DOM çš„æ“ä½œç»†èŠ‚ï¼Œåªéœ€å…³å¿ƒâ€˜çŠ¶æ€(state)â€™å’Œâ€˜çŠ¶æ€åˆ° UI çš„æ˜ å°„å…³ç³»(f)â€™. <strong>æ‰€ä»¥å¦‚æœä½ æ˜¯åˆå­¦è€…ï¼Œä¸èƒ½ç†è§£ä»€ä¹ˆæ˜¯â€˜æ•°æ®é©±åŠ¨â€™, è¿˜æ˜¯ä¸æ¨èç»§ç»­é˜…è¯»æ–‡ç« ä¸‹é¢çš„å†…å®¹</strong>ã€‚</p><p>ä½†æ˜¯éšç€ <code>state</code> çš„å¤æ‚åŒ–, æ¡†æ¶ç°æœ‰çš„ç»„ä»¶åŒ–æ–¹å¼å¾ˆéš¾é©¾é©­ <code>f</code>(è§†å›¾çš„æ˜ å°„å…³ç³»å˜å¾—å¤æ‚, éš¾ä»¥è¢«è¡¨è¾¾å’Œç»´æŠ¤); æˆ–è€…ç›¸å…³ç±»å‹çš„åº”ç”¨æ•°æ®æµæœ¬æ¥å°±æ¯”è¾ƒå¤æ‚, ç»„ä»¶ä¹‹é—´çš„äº¤äº’å…³ç³»å¤šæ ·ï¼Œæœ¬æ¥éš¾ä»¥ä½¿ç”¨<code>UI = f(state)</code>è¿™ç§å…³ç³»æ¥è¡¨è¾¾; æˆ–è€…åº”ç”¨çš„ç»„ä»¶çŠ¶æ€è¿‡äºç¦»æ•£ï¼Œéœ€è¦ç»Ÿä¸€çš„æ²»ç†ç­‰ç­‰. æˆ‘ä»¬å°±æœ‰äº†çŠ¶æ€ç®¡ç†çš„éœ€æ±‚.</p><p>çŠ¶æ€ç®¡ç†æœ€åŸºç¡€çš„è§£å†³æ–¹å¼å°±æ˜¯åˆ†å±‚ï¼Œä¹Ÿå°±æ˜¯è¯´å’Œä¼ ç»Ÿçš„ <code>MV*</code> æ¨¡å¼æ²¡æœ‰æœ¬è´¨åŒºåˆ«, ä¸»æµçŠ¶æ€ç®¡ç†çš„ä¸»è¦ç»“æ„åŸºæœ¬éƒ½æ˜¯è¿™æ ·çš„:</p><center><br> <img src="/images/04/mvc.png" width="500"><br></center><p>ä»–ä»¬åŸºæœ¬éƒ½åŒ…å«è¿™äº›ç‰¹ç‚¹:</p><ul><li><strong>åˆ†ç¦»è§†å›¾å’ŒçŠ¶æ€</strong>. çŠ¶æ€ç®¡ç†å™¨æ“…é•¿çŠ¶æ€ç®¡ç†ï¼Œæ‰€ä»¥ä»–ä»¬ä¸€èˆ¬ä¼šå°†åº”ç”¨çŠ¶æ€èšåˆåœ¨ä¸€èµ·ç®¡ç†ï¼Œè€Œè§†å›¾é€€åŒ–ä¸ºè´«è¡€è§†å›¾(åªå…³æ³¨å±•ç¤º)ï¼Œè¿™æ ·å°±å¯ä»¥ç®€åŒ–<code>f</code>æ˜ å°„å…³ç³», è®©<code>UI = f(state)</code>è¿™ä¸ªè¡¨è¾¾å¼æ›´å½»åº•</li><li><strong>çº¦æŸçŠ¶æ€çš„å˜æ›´</strong>ã€‚Redux è¦æ±‚é€šè¿‡<code>dispatch+reducer</code>, mobx è¦æ±‚æ•°æ®å˜æ›´å‡½æ•°ä½¿ç”¨<code>action</code>è£…é¥°æˆ–æ”¾åœ¨<a href="https://mobx.js.org/best/actions.html" target="_blank" rel="noopener"><code>flow</code></a>å‡½æ•°ä¸­ï¼Œç›®çš„å°±æ˜¯è®©çŠ¶æ€çš„å˜æ›´æ ¹æ®å¯é¢„æµ‹æ€§</li><li><strong>å•å‘æ•°æ®æµ</strong>ã€‚æ•°æ®æµæ€»æ˜¯æŒ‰ç…§ Store -&gt; View -&gt; Store è¿™æ ·çš„æ–¹å¼æµåŠ¨, ç®€åŒ–æ•°æ®æµ</li></ul><p><br></p><p>ä½†æ˜¯, React çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¤ªå¤šäº†ï¼Œé€‰æ‹©è¿™äº›æ–¹æ¡ˆå¯èƒ½ä¼šè®©äººæŠ“ç‹‚ï¼Œä½ éœ€è¦æƒè¡¡å¾ˆå¤šä¸œè¥¿:</p><ul><li>é¢å‘å¯¹è±¡è¿˜æ˜¯å‡½æ•°å¼è¿˜æ˜¯å‡½æ•°å“åº”å¼?</li><li>å• Store è¿˜æ˜¯å¤š Storeï¼Ÿ</li><li>ä¸å¯å˜æ•°æ®è¿˜æ˜¯å¯å˜æ•°æ®ï¼Ÿ</li><li>å†™ä»£ç çˆ½è¿˜æ˜¯åæœŸç»´æŠ¤çˆ½?</li><li>è‡ªç”±è¿˜æ˜¯çº¦æŸï¼Ÿ</li><li>å¼ºç±»å‹è¿˜æ˜¯å¼±ç±»å‹ï¼Ÿ</li><li>èŒƒå¼åŒ–æ•°æ®è¿˜æ˜¯éèŒƒå¼åŒ–ï¼Ÿ</li><li>React åŸç”Ÿè¿˜æ˜¯ç¬¬ä¸‰æ–¹?</li><li>â€¦</li></ul><p><br></p><hr><p><br></p><h2 id="ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†"><a href="#ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†" class="headerlink" title="ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†"></a>ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†</h2><p>å¯¹äºå¤§éƒ¨åˆ†ç®€å•çš„åº”ç”¨å’Œä¸­åå°é¡¹ç›®æ¥è¯´æ˜¯ä¸éœ€è¦çŠ¶æ€ç®¡ç†çš„ã€‚è¯´å®è¯è¿™äº›åº”ç”¨å’Œä¼ ç»Ÿ web é¡µé¢æ²¡ä»€ä¹ˆåŒºåˆ«, æ¯ä¸ªé¡µé¢éƒ½å„è‡ªç‹¬ç«‹ï¼Œæ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢æ—¶æ‹‰å–æœ€æ–°æ•°æ®ï¼Œå¢åˆ æ”¹æŸ¥ä»…æ­¤è€Œå·². å¯¹äºè¿™äº›åœºæ™¯ React çš„ç»„ä»¶çŠ¶æ€å°±å¯ä»¥æ»¡è¶³, æ²¡æœ‰å¿…è¦ä¸ºäº†çŠ¶æ€ç®¡ç†è€ŒçŠ¶æ€ç®¡ç†. è¿™ç§å„è‡ªç‹¬ç«‹çš„â€˜é™æ€â€™é¡µé¢ï¼Œå¼•å…¥çŠ¶æ€ç®¡ç†å°±æ˜¯è¿‡åº¦è®¾è®¡äº†ã€‚</p><p>åœ¨è€ƒè™‘å¼•å…¥çŠ¶æ€ç®¡ç†ä¹‹å‰è€ƒè™‘ä¸€ä¸‹è¿™äº›æ‰‹æ®µæ˜¯å¦å¯ä»¥è§£å†³ä½ çš„é—®é¢˜:</p><ul><li>æ˜¯å¦å¯ä»¥é€šè¿‡æŠ¬å‡ State æ¥å®ç°ç»„ä»¶é—´é€šä¿¡?</li><li>å¦‚æœè·¨è¶Šçš„å±‚çº§å¤ªå¤šï¼Œæ•°æ®æ˜¯å¦å¯ä»¥é€šè¿‡ Context API æ¥å®ç°å…±äº«?</li><li>ä¸€äº›å…¨å±€çŠ¶æ€æ˜¯å¦å¯ä»¥æ”¾åœ¨ localStorage æˆ– sessionStorage ä¸­ï¼Ÿ</li><li>æ•°æ®æ˜¯å¦å¯ä»¥é€šè¿‡å¤–ç½®çš„äº‹ä»¶è®¢é˜…å™¨è¿›è¡Œå…±äº«?</li><li>â€¦</li></ul><p><br></p><hr><p><br></p><h2 id="ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†"><a href="#ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†" class="headerlink" title="ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†"></a>ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†</h2><p>å½“ä½ çš„åº”ç”¨æœ‰ä»¥ä¸‹åœºæ™¯æ—¶ï¼Œå°±è¦å¼€å§‹è€ƒè™‘çŠ¶æ€ç®¡ç†:</p><ul><li>ç»„ä»¶ä¹‹é—´éœ€è¦çŠ¶æ€å…±äº«ã€‚åŒä¸€ä»½æ•°æ®éœ€è¦å“åº”åˆ°å¤šä¸ªè§†å›¾ï¼Œä¸”è¢«å¤šä¸ªè§†å›¾è¿›è¡Œå˜æ›´</li><li>éœ€è¦ç»´æŠ¤å…¨å±€çŠ¶æ€ï¼Œå¹¶åœ¨ä»–ä»¬å˜åŠ¨æ—¶å“åº”åˆ°è§†å›¾</li><li>æ•°æ®æµå˜å¾—å¤æ‚ï¼ŒReact ç»„ä»¶æœ¬èº«å·²ç»æ— æ³•é©¾é©­ã€‚ä¾‹å¦‚è·¨é¡µé¢çš„ç”¨æˆ·åä½œ</li><li>éœ€è¦ç»Ÿä¸€ç®¡ç†åº”ç”¨çš„çŠ¶æ€ã€‚æ¯”å¦‚å®ç°æŒä¹…åŒ–ï¼Œå¯æ¢å¤ï¼Œå¯æ’¤é”€/é‡åš</li><li>â€¦</li></ul><p>é¦–å…ˆç¡®å®šæ˜¯å¦éœ€è¦ Reduxã€Mobx è¿™äº›å¤æ‚çš„çŠ¶æ€ç®¡ç†å·¥å…·? åœ¨ 2019 ä»–ä»¬å¾ˆå¤šåŠŸèƒ½éƒ½å¯ä»¥è¢« React æœ¬èº«æä¾›çš„ç‰¹æ€§å–ä»£. éšç€ React 16.3 å‘å¸ƒäº†æ–°çš„ Context APIï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åœ¨å®ƒä¹‹ä¸Šåšç®€å•çš„çŠ¶æ€ç®¡ç†, æˆ‘ä»¬åº”è¯¥<strong>ä¼˜å…ˆé€‰æ‹©è¿™äº›åŸç”Ÿæ€çš„çŠ¶æ€ç®¡ç†æ–¹å¼</strong>ã€‚</p><p>ä¾‹å¦‚: ç®€å•çš„ä½¿ç”¨ Context API æ¥åšçŠ¶æ€ç®¡ç†:</p><center><br>  <img src="/codes/context-api-vuex.png" width="600"><br></center><p>æœ€è¿‘ hooks ç”¨å¾—æ¯”è¾ƒçˆ½(å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« : <a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d" target="_blank" rel="noopener">ç»„ä»¶çš„æ€ç»´</a>)ï¼Œæˆ‘å°±æƒ³é…åˆ Context API åšä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨, åæ¥å‘ç°æ—©å°±æœ‰äººè¿™ä¹ˆå¹²äº†ï¼š <a href="https://github.com/jamiebuilds/unstated-next" target="_blank" rel="noopener">unstated-next</a>, ä»£ç åªæœ‰ 38 è¡Œ(Hooks+Context)ï¼Œæ¥å£éå¸¸ç®€å•:</p><center><br> <img src="/images/04/unstated.png" width="750"><br></center><p>ä¾èµ–äº hooks æœ¬èº«çµæ´»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åšå¾ˆå¤šä¸œè¥¿, ä»…é™äºæƒ³è±¡åŠ›. ä¾‹å¦‚å¼‚æ­¥æ•°æ®è·å–:</p><center><br> <img src="/codes/useTodoList.png" width="750"><br></center><p>æŠ‘æˆ–è€…å®ç° Redux çš„æ ¸å¿ƒåŠŸèƒ½:</p><iframe src="https://codesandbox.io/embed/w1plr?fontsize=14" title="redux hooks" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><br></p><p>æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ hooks ä½œä¸ºçŠ¶æ€ç®¡ç†å™¨çš„ä¼˜ç‚¹:</p><ul><li><strong>æç®€</strong>ã€‚å¦‚ä¸Š</li><li><strong>å¯ç»„åˆæ€§</strong>. hooks åªæ˜¯æ™®é€šå‡½æ•°, å¯ä»¥ç»„åˆå…¶ä»– hooksï¼Œä»¥åŠå…¶ä»–<code>Hooks Container</code>. ä¸Šä¸€ç¯‡æ–‡ç« æåˆ° hooks å†™ç€å†™ç€å¾ˆåƒç»„ä»¶ï¼Œç»„ä»¶å†™ç€å†™ç€å¾ˆåƒ hooksï¼Œåœ¨ç”¨æ³•ä¸Šç»„ä»¶å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§â€™ç‰¹æ®Šâ€™çš„ hooksã€‚ç›¸æ¯”ç»„ä»¶, hooks æœ‰æ›´çµæ´»çš„ç»„åˆç‰¹æ€§</li><li><strong>ä»¥ react ä¹‹å</strong>. åŸºäº Context å®ç°ç»„ä»¶çŠ¶æ€å…±äº«ï¼ŒåŸºäº hooks å®ç°çŠ¶æ€ç®¡ç†, è¿™ä¸ªæ–¹å¼è¶³å¤Ÿé€šç”¨.</li><li>hooks å¾ˆå¤šçµæ´»çš„ç‰¹æ€§è¶³ä»¥å–ä»£ç±»ä¼¼ Mobx è¿™äº›æ¡†æ¶çš„å¤§éƒ¨åˆ†åŠŸèƒ½</li><li>åªæ˜¯æ™®é€šçš„ React ç»„ä»¶ï¼Œå¯ä»¥åœ¨ React inspector ä¸Šè°ƒè¯•</li><li>å¼ºç±»å‹</li><li>åŸºäºContext APIæ›´å®¹æ˜“å®ç°æ¨¡å—åŒ–(æˆ–è€…åˆ†å½¢)</li></ul><p><br></p><p>éœ€è¦æ³¨æ„çš„åœ°æ–¹</p><ul><li>æ²¡æœ‰å¤–ç½®çš„çŠ¶æ€. çŠ¶æ€åœ¨ç»„ä»¶å†…éƒ¨ï¼Œæ²¡æœ‰æ–¹æ³•ä»å¤–éƒ¨è§¦å‘çŠ¶æ€å˜æ›´</li><li>ç¼ºå°‘çº¦æŸ. æ˜¯å¥½å¤„ä¹Ÿæ˜¯åå¤„, å¯¹äºå›¢é˜Ÿå’Œåˆå­¦è€…æ¥è¯´æ²¡æœ‰çº¦æŸä¼šå¯¼è‡´é£æ ¼ä¸ç»Ÿä¸€ï¼Œæ— æ³•æ§åˆ¶é¡¹ç›®ç†µå¢ã€‚å¥½å¤„æ˜¯å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„çº¦æŸ</li><li>æ€§èƒ½ä¼˜åŒ–. éœ€è¦è€ƒè™‘ Context å˜æ›´å¸¦æ¥çš„æ€§èƒ½é—®é¢˜</li><li>è°ƒè¯•ä½“éªŒä¸å¦‚ Redux</li><li>æ²¡æœ‰æ•°æ®é•œåƒ, ä¸èƒ½å®ç°è¯¸å¦‚äº‹ä»¶ç®¡ç†çš„éœ€æ±‚</li><li>æ²¡æœ‰ Redux ä¸°å¯Œçš„ç”Ÿæ€</li></ul><p><strong>æ‰€ä»¥ Context+ Hooks å¯ä»¥ç”¨äºæ»¡è¶³ç®€å•çš„çŠ¶æ€ç®¡ç†éœ€æ±‚, å¯¹äºå¤æ‚çš„çŠ¶æ€ç®¡ç†éœ€æ±‚è¿˜æ˜¯éœ€è¦ç”¨ä¸Š Reduxã€Mobx è¿™ç±»ä¸“ä¸šçš„çŠ¶æ€ç®¡ç†å™¨.</strong></p><p><br></p><p>å…¶ä»–ç±»ä¼¼çš„æ–¹æ¡ˆ</p><ul><li><a href="https://github.com/jamiebuilds/unstated" target="_blank" rel="noopener">unstated</a> unstated-next çš„å‰èº«ï¼Œä½¿ç”¨ setState API</li><li><a href="https://github.com/dai-shi/react-hooks-global-state" target="_blank" rel="noopener">react-hooks-global-state</a></li></ul><p>æ‰©å±•</p><ul><li><a href="https://blog.bitsrc.io/react-context-api-a-replacement-for-redux-6e20790492b3" target="_blank" rel="noopener">React Context APIâ€Šâ€”â€ŠA Replacement for Redux?</a></li><li><a href="https://zhuanlan.zhihu.com/p/48219978" target="_blank" rel="noopener">unstated: å¯èƒ½æ˜¯ç®€å•çŠ¶æ€ç®¡ç†å·¥å…·ä¸­æœ€å¥½çš„</a></li></ul><p><br></p><hr><r><h2 id="redux"><a href="#redux" class="headerlink" title="Redux"></a>Redux</h2><p><code>unstated</code> æ˜¯ä¸€ä¸ªæç®€çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œå…¶ä½œè€…ä¹Ÿè¯´äº†ä¸è¦è®¤ä¸º<strong>unstated æ˜¯ä¸€ä¸ª Redux killer</strong>, ä¸è¦åœ¨å®ƒä¹‹ä¸Šæ„å»ºå¤æ‚çš„å·¥å…·ï¼Œä¹Ÿå°±æ˜¯ä¸è¦é‡å¤é€ è½®å­ã€‚æ‰€ä»¥ä¸€èˆ¬åˆ°äº†è¿™ä¸ªåœ°æ­¥, å…¶å®ä½ å°±åº”è¯¥è€ƒè™‘ Reduxã€Mobxã€Rxjs è¿™äº›å¤æ‚çš„çŠ¶æ€ç®¡ç†æ¡†æ¶äº†ã€‚</p><p>Redux æ˜¯å­¦ä¹  React ç»•ä¸è¿‡çš„ä¸€ä¸ªæ¡†æ¶. å°½ç®¡ Redux çš„ä»£ç åªæœ‰ä¸€ç™¾å¤šè¡Œï¼Œæ¦‚å¿µå´å¾ˆå¤šï¼Œå­¦ä¹ æ›²çº¿éå¸¸é™¡å³­ï¼Œçœ‹å®˜æ–¹æ–‡æ¡£å°±çŸ¥é“äº†ã€‚å³ä½¿å®ƒçš„å®ç°å¾ˆç®€æ´ï¼Œä½†æ˜¯å¼€å‘ä»£ç å¹¶ä¸ç®€æ´(å’Œ mobx ç›¸å, è„æ´»ç•™ç»™å¼€å‘è€…)ï¼Œå°¤å…¶éµå¾ªå®ƒçš„â€™æœ€ä½³å®è·µâ€™ï¼Œæ˜¯ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ªé¡¹ç›®æ˜¯éå¸¸ç¹ççš„. è¿˜åœ¨ç°åœ¨æœ‰ç±»ä¼¼ dva æˆ– rematch è¿™æ ·çš„äºŒæ¬¡å°è£…åº“æ¥ç®€åŒ–å®ƒ.</p><p>æœ¬æ–‡ä¸æ‰“ç®—æ·±å…¥ä»‹ç» Redux çš„ç›¸å…³å®è·µï¼Œ ç¤¾åŒºä¸Šé¢æœ‰éå¸¸å¤šçš„æ•™ç¨‹ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿéå¸¸è¯¦å°½. è¿™é‡Œä¼šä»‹ç» Redux çš„ä¸»è¦æ¶æ„å’Œæ ¸å¿ƒæ€æƒ³ï¼Œä»¥åŠå®ƒçš„é€‚ç”¨åœºæ™¯.</p><center><br>  <img src="/images/04/redux-design.png" width="700"><br></center><p>Redux çš„ä¸»è¦ç»“æ„å¦‚ä¸Šï¼Œåœ¨æ­¤ä¹‹å‰ä½ å…ˆè¦ææ¸…æ¥š Redux çš„åˆè¡·æ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½æ˜ç™½å®ƒä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡. åœ¨æˆ‘çœ‹æ¥ Redux ä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜:</p><ol><li><strong>å¯é¢„æµ‹çŠ¶æ€</strong></li><li><strong>ç®€åŒ–åº”ç”¨æ•°æ®æµ</strong></li></ol><p><br></p><p>å…¶å®è¿™ä¹Ÿæ˜¯ <code>flux</code> çš„åˆè¡·, åªæ˜¯æœ‰äº›å®ƒæœ‰äº›ä¸œè¥¿æ²¡åšå¥½. æ˜ç™½ Redux çš„åˆè¡·ï¼Œç°åœ¨æ¥çœ‹çœ‹å®ƒçš„è®¾è®¡å°±ä¼šæ¸…æ™°å¾ˆå¤š</p><ul><li><p><strong>å•ä¸€æ•°æ®æº</strong> -&gt; å¯é¢„æµ‹ï¼Œç®€åŒ–æ•°æ®æµï¼šæ•°æ®åªèƒ½åœ¨ä¸€ä¸ªåœ°æ–¹è¢«ä¿®æ”¹</p><ul><li><p>å¯ä»¥ç®€åŒ–åº”ç”¨æ•°æ®æµ. è§£å†³ä¼ ç»Ÿå¤š model æ¨¡å‹æ•°æ®æµæ··ä¹±é—®é¢˜(æ¯”å¦‚ä¸€ä¸ª model å¯ä»¥ä¿®æ”¹å…¶ä»– modelï¼Œä¸€ä¸ª view å—åˆ°å¤šä¸ª model é©±åŠ¨)ï¼Œè®©æ•°æ®å˜åŠ¨å˜å¾—å¯é¢„æµ‹å¯è°ƒè¯•</p><center><br> <img src="/images/04/traditional-model.png" width="400"><br></center></li><li><p>åŒæ„åŒ–åº”ç”¨å¼€å‘</p></li><li>æ–¹ä¾¿è°ƒè¯•</li><li>æ–¹ä¾¿åšæ•°æ®é•œåƒ. å¯ä»¥å®ç°æ’¤é”€/é‡åšã€æ—¶é—´æ—…è¡Œã€çƒ­é‡è½½ã€çŠ¶æ€æŒä¹…åŒ–å’Œæ¢å¤</li></ul></li><li><p><strong>å•å‘æ•°æ®æµ</strong> -&gt; ç®€åŒ–æ•°æ®æµ, å¯é¢„æµ‹</p></li><li><strong>ä¸èƒ½ç›´æ¥ä¿®æ”¹çŠ¶æ€</strong> -&gt; å¯é¢„æµ‹<ul><li>åªèƒ½é€šè¿‡ dispatch action æ¥è§¦å‘çŠ¶æ€å˜æ›´. action åªæ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œ æºå¸¦äº‹ä»¶çš„ç±»å‹å’Œ payload</li><li>reducer æ¥æ”¶ action å’Œæ—§çš„ stateï¼Œ è§„çº¦ç”Ÿæˆæ–°çš„ state. reducer åªæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå¯ä»¥åµŒå¥—ç»„åˆå­ reducer å¯¹å¤æ‚ state æ ‘è¿›è¡Œè§„çº¦</li><li>ä¸å¯å˜æ•°æ®.</li><li>å¯æµ‹è¯•.</li></ul></li><li><strong>èŒƒå¼åŒ–å’ŒåèŒƒå¼åŒ–</strong>. Store åªå­˜å‚¨èŒƒå¼åŒ–çš„æ•°æ®ï¼Œå‡å°‘æ•°æ®å†—ä½™ã€‚è§†å›¾éœ€è¦çš„æ•°æ®é€šè¿‡ reselect ç­‰æ‰‹æ®µåèŒƒå¼åŒ–</li><li><strong>é€šè¿‡ä¸­é—´ä»¶éš”ç¦»å‰¯ä½œç”¨</strong> -&gt; å¯é¢„æµ‹<br>å¯ä»¥è¯´ Redux çš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ reducerï¼Œç„¶è€Œè¿™æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚ä¸ºäº†å®ç°å¤æ‚çš„å‰¯ä½œç”¨ï¼Œredux æä¾›äº†ç±»ä¼¼ Koa çš„ä¸­é—´ä»¶æœºåˆ¶ï¼Œå®ç°å„ç§å‰¯ä½œç”¨. æ¯”å¦‚å¼‚æ­¥è¯·æ±‚. é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥åˆ©ç”¨ä¸­é—´ä»¶æœºåˆ¶ï¼Œå®ç°é€šç”¨çš„ä¸šåŠ¡æ¨¡å¼ï¼Œ å‡å°‘ä»£ç é‡å¤ã€‚</li><li><strong>Devtool</strong> -&gt; å¯é¢„æµ‹ã€‚é€šè¿‡å¼€å‘è€…å·¥å…·å¯ä»¥å¯è§†åŒ–æ•°æ®æµ</li></ul><p><br></p><p><strong>ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Redux?</strong></p><p>é¦–å…ˆè¿˜æ˜¯è­¦å‘Šä¸€ä¸‹ï¼š <a href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367" target="_blank" rel="noopener">You Might Not Need Redux</a>, Redux ä¸æ˜¯ä½ çš„ç¬¬ä¸€é€‰æ‹©ã€‚</p><p><strong>å½“æˆ‘ä»¬éœ€è¦å¤„ç†å¤æ‚çš„åº”ç”¨çŠ¶æ€ï¼Œä¸” React æœ¬èº«æ— æ³•æ»¡è¶³ä½ æ—¶</strong>. æ¯”å¦‚ï¼š</p><ul><li>ä½ éœ€è¦æŒä¹…åŒ–åº”ç”¨çŠ¶æ€, è¿™æ ·ä½ å¯ä»¥ä»æœ¬åœ°å­˜å‚¨æˆ–æœåŠ¡å™¨è¿”å›æ•°æ®ä¸­æ¢å¤åº”ç”¨</li><li>éœ€è¦å®ç°æ’¤é”€é‡åšè¿™äº›åŠŸèƒ½</li><li>å®ç°è·¨é¡µé¢çš„ç”¨æˆ·åä½œ</li><li>åº”ç”¨çŠ¶æ€å¾ˆå¤æ‚æ—¶</li><li>æ•°æ®æµæ¯”è¾ƒå¤æ‚æ—¶</li><li>è®¸å¤šä¸ç›¸å…³çš„ç»„ä»¶éœ€è¦å…±äº«å’Œæ›´æ–°çŠ¶æ€</li><li>å¤–ç½®çŠ¶æ€</li><li>â€¦</li></ul><p><br></p><p><strong>æœ€ä½³å®è·µ</strong></p><p>ä¸ªäººè§‰å¾—<a href="https://github.com/react-boilerplate/react-boilerplate/blob/master/docs/general/introduction.md" target="_blank" rel="noopener">react-boilerplate</a>æ˜¯æœ€ç¬¦åˆå®˜æ–¹â€˜æœ€ä½³å®è·µâ€™çš„é¡¹ç›®æ¨¡æ¿. å®ƒçš„åº”ç”¨å·¥ä½œæµå¦‚ä¸‹:</p><center><br> <img src="/images/04/redux-workflow.png " width="600"><br></center><p>ç‰¹æ€§:</p><ol><li>æ•´åˆäº† Redux ç”Ÿæ€æ¯”è¾ƒæµè¡Œçš„æ–¹æ¡ˆ: <code>immer</code>(ä¸å¯å˜æ•°æ®å˜æ›´)ï¼Œ<code>redux-saga</code>(å¼‚æ­¥æ•°æ®æµå¤„ç†)ï¼Œ<code>reselect</code>(é€‰å–å’Œæ˜ å°„ stateï¼Œæ”¯æŒ memoï¼Œå¯å¤åˆ)ï¼Œ<code>connected-react-router</code>(ç»‘å®š react-router v4)</li><li>æ ¹æ®é¡µé¢åˆ†å‰² saga å’Œ reducerã€‚è§ä¸‹é¢ ğŸ‘‡ å’Œç›®å½•ç»“æ„</li><li>æŒ‰éœ€åŠ è½½ saga å’Œ reducer(é€šè¿‡ replaceReducer)</li><li>åˆ’åˆ†å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶</li></ol><p>å†çœ‹çœ‹ react-boilerplate ç›®å½•ç»“æ„. è¿™æ˜¯æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„é¡¹ç›®ç»„ä»¶æ–¹å¼ï¼Œç»„ç»‡éå¸¸æ¸…æ™°ï¼Œå¾ˆæœ‰å‚è€ƒæ„ä¹‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/src</span><br><span class="line">  /components        # å±•ç¤ºç»„ä»¶</span><br><span class="line">  /containers        # ğŸ”´å®¹å™¨/é¡µé¢ç»„ä»¶</span><br><span class="line">    /App             # æ ¹ç»„ä»¶ï¼Œ ä¾‹å¦‚æ”¾ç½®Providerå’ŒRouter</span><br><span class="line">    /HomePage        # é¡µé¢ç»„ä»¶</span><br><span class="line">      index.js       # é¡µé¢å…¥å£</span><br><span class="line">      constants.js   # ğŸ”´ åœ¨è¿™é‡Œå®šä¹‰å„ç§å¸¸é‡ã€‚åŒ…æ‹¬Action Type</span><br><span class="line">      actions.js     # ğŸ”´ å®šä¹‰å„ç§Actionå‡½æ•°</span><br><span class="line">      saga.js        # ğŸ”´ redux-saga å®šä¹‰å„ç§sagaæ–¹æ³•ï¼Œ ç”¨äºå¤„ç†å¼‚æ­¥æµç¨‹</span><br><span class="line">      reducer.js     # ğŸ”´ reducerã€‚ é¡µé¢ç»„ä»¶çš„reducerå’Œsagaéƒ½ä¼šæŒ‰éœ€æ³¨å…¥åˆ°æ ¹store</span><br><span class="line">      selectors.js   # ğŸ”´ redux stateæ˜ å°„å’Œè®¡ç®—</span><br><span class="line">      message.js</span><br><span class="line">      Form.js        # å„ç§å±€éƒ¨ç»„ä»¶</span><br><span class="line">      Input.js</span><br><span class="line">      ...</span><br><span class="line">    /FeaturePage     # å…¶ä»–é¡µé¢ç»„ä»¶ç»“æ„åŒä¸Š</span><br><span class="line">    ...</span><br><span class="line">  /translations      # i18n ç¿»è¯‘æ–‡ä»¶</span><br><span class="line">  /utils</span><br><span class="line">    reducerInjectors.js  # ğŸ”´reducer æ³¨å…¥å™¨, å®ç°å’Œé¡µé¢ç»„ä»¶ä¸€èµ·æŒ‰éœ€æ³¨å…¥</span><br><span class="line">    sagaInjectors.js     # ğŸ”´saga æ³¨å…¥å™¨, åŒä¸Š</span><br><span class="line">    lodable.js</span><br><span class="line">  app.js             # åº”ç”¨å…¥å£</span><br><span class="line">  i18n.js            # i18né…ç½®</span><br><span class="line">  configureStore.js  # ğŸ”´ åˆ›å»ºå’Œé…ç½®Redux Store</span><br><span class="line">  reducers.js        # ğŸ”´ æ ¹reducers, åˆå¹¶æ‰€æœ‰'é¡µé¢çŠ¶æ€'å’Œ'å…¨å±€çŠ¶æ€'(å¦‚routerï¼Œ languageï¼Œ global(ä¾‹å¦‚ç”¨æˆ·é‰´æƒä¿¡æ¯))</span><br></pre></td></tr></table></figure><p><br></p><p><strong>ğŸ¤¬ å¼€å§‹åæ§½!</strong></p><p><br></p><ul><li><p><strong>ä¸€ï¼ŒRedux æ ¸å¿ƒåº“å¾ˆå°ï¼Œåªæä¾›äº† dispatch å’Œ reducer æœºåˆ¶ï¼Œå¯¹äºå„ç§å¤æ‚çš„å‰¯ä½œç”¨å¤„ç† Redux é€šè¿‡æä¾›ä¸­é—´ä»¶æœºåˆ¶å¤–åŒ…å‡ºå»</strong>ã€‚ç¤¾åŒºæœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼Œredux-promise, redux-saga, redux-observableâ€¦ æŸ¥çœ‹ Redux çš„<a href="https://redux.js.org/introduction/ecosystem#actions" target="_blank" rel="noopener">ç”Ÿæ€ç³»ç»Ÿ</a>.</p><p><strong>Redux ä¸­é—´ä»¶çš„å¥½å¤„æ˜¯æ‰©å±•æ€§éå¸¸å¥½, å¼€å‘è€…å¯ä»¥åˆ©ç”¨ä¸­é—´ä»¶æŠ½è±¡é‡å¤çš„ä¸šåŠ¡ e ä¸­é—´ä»¶ç”Ÿæ€ä¹Ÿç™¾èŠ±é½æ”¾, ä½†æ˜¯å¯¹äºåˆå­¦è€…åˆ™ä¸å‹å¥½</strong>.</p><p>TM èµ·ç è¿˜å¾—éœ€è¦å»äº†è§£å„ç§å„æ ·çš„åº“ï¼Œæ¨ªå‘æ¯”è¾ƒçš„ä¸€ä¸‹æ‰çŸ¥é“è‡ªå·±éœ€è¦æ­é…å“ªä¸ªåº“å§? é‚£å¥½å§ï¼Œå°±é€‰ redux-saga å§ï¼Œstar æ•°æ¯”è¾ƒå¤šã€‚åé¢åˆæœ‰ç‰›äººè¯´ä¸è¦é¢å‘ star ç¼–ç¨‹ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±å›¢é˜Ÿçš„æ‰æ˜¯æœ€å¥½çš„â€¦ æ‰€ä»¥æŒ‘é€‰åˆé€‚çš„æ–¹æ¡ˆä¹‹å‰è¿˜æ˜¯å¾—è¦äº†è§£å„ç§æ–¹æ¡ˆæœ¬èº«å§?ã€‚</p><p>Vue ä¹‹æ‰€ä»¥å­¦ä¹ æ›²çº¿æ¯”è¾ƒå¹³ç¼“ä¹Ÿåœ¨äºæ­¤å§ã€‚å®ƒå¸®åŠ©æˆ‘ä»¬åšäº†å¾ˆå¤šé€‰æ‹©ï¼Œæä¾›ç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œå¦å¤–å®˜æ–¹è¿˜æä¾›äº†é£æ ¼æŒ‡å—å’Œæœ€ä½³å®è·µ. è¿™äº›é€‰æ‹©é€‚åˆ 80%ä»¥ä¸Šçš„å¼€å‘éœ€æ±‚. å¼€å‘è€…å‡å°‘äº†å¾ˆå¤šæŠ˜è…¾çš„æ—¶é—´ï¼Œå¯ä»¥ä¸“å¿ƒå†™ä¸šåŠ¡. <strong>è¿™æ‰æ˜¯æ‰€è°“çš„â€˜<a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">æ¸è¿›å¼</a>â€™æ¡†æ¶å§, å¯¹äºä¸çˆ±æŠ˜è…¾çš„æˆ–åˆå­¦è€…ï¼Œæˆ‘ä»¬å¸®ä½ é€‰æ‹©ï¼Œä½†ä¹Ÿä¸ä¼šé˜»ç¢ä½ å¾€é«˜çº§çš„åœ°æ–¹èµ°</strong>ã€‚ è¿™é‡Œå¯ä»¥æ„Ÿå—åˆ° React ç¤¾åŒºå’Œ Vue ç¤¾åŒºçš„é£æ ¼å®Œå…¨ä¸åŒ.</p><p>åœ¨å‡ºç°é€‰æ‹©å›°éš¾ç—‡æ—¶ï¼Œè¿˜æ˜¯çœ‹çœ‹åˆ«äººæ€ä¹ˆé€‰æ‹©ï¼Œæ¯”å¦‚æ¯”è¾ƒæœ‰å½±å“åŠ›çš„å›¢é˜Ÿæˆ–è€…æµè¡Œçš„å¼€æºé¡¹ç›®(å¦‚ dvaï¼Œrematch)ï¼Œé€‰å–ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ, åç»­æœ‰å†æ…¢æ…¢æ·±å…¥ç ”ç©¶. <strong>å¯¹äº Redux ç›®å‰æ¯”è¾ƒæµè¡Œçš„ç»„åˆå°±æ˜¯: <code>immer+saga+reselect</code></strong></p><p><br></p></li><li><p><strong>äºŒï¼Œå¤ªå¤šæ¨¡æ¿ä»£ç </strong>ã€‚æ¯”å¦‚ä¸Šé¢çš„ react-boilerplate, æ¶‰åŠäº”ä¸ªæ–‡ä»¶, éœ€è¦å®šä¹‰å„ç§ Action Typeã€Actionã€ Reducerã€Sagaã€Select. æ‰€ä»¥å³ä¾¿æƒ³è¿›è¡Œä¸€ä¸ªå°çš„çŠ¶æ€å˜åŒ–ä¹Ÿéœ€è¦æ›´æ”¹å¥½å‡ ä¸ªåœ°æ–¹:</p><p><img src="/images/04/redux-page.png" alt></p><p>ç¬”è€…ä¸ªäººæ›´å–œæ¬¢ç±»ä¼¼ Vuex è¿™ç§<code>Ducks</code>é£æ ¼çš„ç»„ç»‡æ–¹å¼ï¼Œå°†æ¨¡å—ä¸‹çš„ actionï¼Œsagaï¼Œreducer å’Œ mapper éƒ½ç»„ç»‡åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸‹é¢:</p><center><br> <img src="/codes/redux-ducks.png" width="600"><br></center><p>Redux çš„äºŒæ¬¡å°è£…æ¡†æ¶åŸºæœ¬é‡‡ç”¨ç±»ä¼¼çš„é£æ ¼, å¦‚<a href="https://github.com/rematch/rematch" target="_blank" rel="noopener"><code>rematch</code></a></p><center><br> <img src="/images/04/rematch.png" width="800"><br></center><p>è¿™äº›äºŒæ¬¡å°è£…æ¡†æ¶ä¸€èˆ¬åšäº†ä»¥ä¸‹ä¼˜åŒ–(å…¶å®å¯ä»¥å½“åšæ˜¯ Vuex çš„ä¼˜ç‚¹)ï¼Œæ¥æå‡ Redux çš„å¼€å‘ä½“éªŒ:</p><ul><li><strong>ä½¿ç”¨ Ducks é£æ ¼ç»„ç»‡ä»£ç </strong>.èšåˆåˆ†æ•£çš„ reducerï¼Œsagaï¼Œactionsâ€¦</li><li><strong>æ›´ç®€åŒ–çš„ API</strong></li><li><strong>æä¾›äº†ç®€å•æ˜“ç”¨çš„æ¨¡å—åŒ–(æˆ–è€…ç§°ä¸ºâ€˜åˆ†å½¢â€™)æˆ–è€…å‘½åç©ºé—´æœºåˆ¶</strong>ã€‚æ¨¡å—æœ¬èº«æ”¯æŒâ€˜çŠ¶æ€éš”ç¦»â€™ï¼Œè®©æ¨¡å—çš„ reducerã€saga åªä¸“æ³¨äºæ¨¡å—è‡ªå·±çš„çŠ¶æ€. å¦å¤–æ¨¡å—è¿˜è€ƒè™‘<strong>åŠ¨æ€åŠ è½½</strong></li><li><strong>å†…ç½®å‰¯ä½œç”¨å¤„ç†æœºåˆ¶</strong>ã€‚å¦‚ä½¿ç”¨ saga æˆ– redux-promise</li><li><strong>ç®€åŒ–äº†ä¸å¯å˜æ•°æ®çš„æ“ä½œæ–¹å¼</strong>ã€‚ å¦‚ä½¿ç”¨ immer</li><li><strong>ç®€åŒ– reducer</strong>ã€‚Redux å†…ç½®äº† combineReducers æ¥å¤åˆå¤šä¸ª reducerï¼Œåœ¨ reducer å†…éƒ¨æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ switch è¯­å¥æ¥æ¥æ”¶ action å’Œå¤„ç†æ•°æ®å˜åŠ¨, å…¶å®å†™èµ·æ¥éå¸¸å•°å—¦. <strong>Vuex å’Œè¿™äº›å°è£…æ¡†æ¶ä¸çº¦è€ŒåŒä½¿ç”¨äº† key/value å½¢å¼</strong>, æ›´ä¸ºç®€æ´æ˜äº†</li><li><strong>ç®€åŒ– view å±‚çš„ connect æ¥å£</strong>ã€‚å¦‚ç®€åŒ– mapPropsï¼ŒmapDispatch è¿™äº›ä»£ç å†™èµ·æ¥ä¹Ÿæ¯”è¾ƒç¹ç</li></ul><p><br></p></li><li><p><strong>ä¸‰ï¼Œå¼ºåˆ¶ä¸å¯å˜æ•°æ®</strong>ã€‚å‰é¢æ–‡ç« ä¹Ÿæåˆ°è¿‡ setState å¾ˆå•°å—¦ï¼Œä¸ºäº†ä¿è¯çŠ¶æ€çš„ä¸å¯å˜æ€§æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å¯¹è±¡å±•å¼€æˆ–è€…æ•°ç»„å±•å¼€æ“ä½œç¬¦, å†å¤æ‚ç‚¹å¯ä»¥ä¸Š Immutable.js, è¿™éœ€è¦ä¸€ç‚¹å­¦ä¹ æˆæœ¬. å¥½åœ¨ç°åœ¨æœ‰ immerï¼Œå¯ä»¥æŒ‰ç…§ Javascript çš„å¯¹è±¡æ“ä½œä¹ æƒ¯æ¥å®ç°ä¸å¯å˜æ•°æ®</p><p><br></p></li><li><p><strong>å››ï¼ŒçŠ¶æ€è®¾è®¡</strong>ã€‚</p><p>æ•°æ®ç±»å‹ä¸€èˆ¬åˆ†ä¸º<strong>é¢†åŸŸæ•°æ®(Domain data)</strong>å’Œ<strong>åº”ç”¨æ•°æ®(æˆ–è€…ç§°ä¸º UI æ•°æ®)</strong>. åœ¨ä½¿ç”¨ Redux æ—¶ç»å¸¸éœ€è¦è€ƒè™‘çŠ¶æ€è¦æ”¾åœ¨ç»„ä»¶å±€éƒ¨ï¼Œè¿˜æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½æŠ½å–åˆ° Redux Storeï¼ŸæŠŠè¿™äº›æ•°æ®æ”¾åˆ° Redux Store é‡Œé¢å¤„ç†èµ·æ¥å¥½åƒæ›´éº»çƒ¦ï¼Ÿæ—¢ç„¶éƒ½ä½¿ç”¨ Redux äº†ï¼Œä¸æŠŠæ•°æ®æŠ½å–åˆ° Redux Store æ˜¯å¦ä¸ç¬¦åˆæœ€ä½³å®è·µï¼Ÿ ç¬”è€…ä¹Ÿæ—¶å¸¸æœ‰è¿™æ ·çš„å›°æƒ‘, ä½ ä¹Ÿæ˜¯<a href="https://ruby-china.org/topics/38057" target="_blank" rel="noopener">æœ€ä½³å®è·µçš„å—å®³è€…</a>?</p><p>æˆ‘è§‰å¾—å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªç‚¹è¿›è¡Œè€ƒè™‘:</p><ul><li><strong>é¢†åŸŸæ•°æ®è¿˜æ˜¯åº”ç”¨æ•°æ®?</strong> é¢†åŸŸæ•°æ®ä¸€èˆ¬æ¨èæ”¾åœ¨ ReduxStore ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°† Redux çš„ Store çœ‹ä½œä¸€ä¸ªæ•°æ®åº“ï¼Œå­˜æ”¾èŒƒå¼åŒ–çš„æ•°æ®ã€‚</li><li><strong>çŠ¶æ€æ˜¯å¦ä¼šè¢«å¤šä¸ªç»„ä»¶æˆ–è€…è·¨é¡µé¢å…±äº«ï¼Ÿ</strong> Redux Store æ˜¯ä¸€ä¸ªå…¨å±€çŠ¶æ€å­˜å‚¨å™¨ï¼Œæ—¢ç„¶ä½¿ç”¨ Redux äº†ï¼Œæœ‰ç†ç”±è®© Redux æ¥ç®¡ç†è·¨è¶Šå¤šç»„ä»¶çš„çŠ¶æ€</li><li><strong>çŠ¶æ€æ˜¯å¦éœ€è¦è¢«é•œåƒåŒ–?</strong> å¦‚æœä½ çš„åº”ç”¨è¦åšâ€˜æ—¶é—´æ—…è¡Œ(æ’¤é”€/é‡åš)â€™æˆ–è€…åº”ç”¨æŒä¹…åŒ–ï¼Œè¿™ä¸ªçŠ¶æ€éœ€è¦è¢«æ¢å¤ï¼Œé‚£ä¹ˆåº”è¯¥æ”¾åˆ° Redux Storeï¼Œé›†ä¸­åŒ–ç®¡ç†æ•°æ®æ˜¯ Redux çš„å¼ºé¡¹</li><li><strong>çŠ¶æ€æ˜¯å¦éœ€è¦è·¨è¶Šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</strong> å°†çŠ¶æ€æ”¾åœ¨ç»„ä»¶å±€éƒ¨ï¼Œå°±ä¼šè·Ÿç€ç»„ä»¶ä¸€èµ·è¢«é”€æ¯ã€‚å¦‚æœå¸Œæœ›çŠ¶æ€è·¨è¶Šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œåº”è¯¥æ”¾åˆ°çˆ¶ç»„ä»¶æˆ–è€… Redux Store ä¸­. æ¯”å¦‚ä¸€ä¸ªæ¨¡æ€æ¡†ç¼–è¾‘çš„æ•°æ®åœ¨å…³é—­åæ˜¯å¦éœ€è¦ä¿ç•™</li></ul><p><strong>åŸåˆ™æ˜¯èƒ½æ”¾åœ¨å±€éƒ¨çš„å°±æ”¾åœ¨å±€éƒ¨</strong>. åœ¨å±€éƒ¨çŠ¶æ€å’Œå…¨å±€çŠ¶æ€ä¸­å–èˆéœ€è¦ä¸€ç‚¹å¼€å‘ç»éªŒ.</p><p>å¦å¤–ä½œä¸ºä¸€ä¸ªé›†ä¸­åŒ–çš„çŠ¶æ€ç®¡ç†å™¨ï¼Œä¸ºäº†çŠ¶æ€çš„å¯è¯»æ€§(æ›´å®¹æ˜“ç†è§£)å’Œå¯æ“ä½œæ€§(æ›´å®¹æ˜“å¢åˆ æŸ¥æ”¹)ï¼Œåœ¨çŠ¶æ€ç»“æ„ä¸Šé¢çš„è®¾è®¡ä¹Ÿéœ€è¦èŠ±è´¹ä¸€äº›ç²¾åŠ›çš„. è¿™ä¸ªæ•°æ®åº“ç»“æ„çš„è®¾è®¡æ–¹æ³•æ˜¯ä¸€æ ·çš„, <strong>åœ¨è®¾è®¡çŠ¶æ€ä¹‹å‰ä½ éœ€è¦ç†æ¸…å„ç§é¢†åŸŸå¯¹è±¡ä¹‹é—´çš„å…³ç³», åœ¨æ•°æ®è·å–å’Œæ•°æ®å˜æ›´æ“ä½œå¤æ‚åº¦/æ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡</strong>.</p><p>Redux å®˜æ–¹æ¨è<a href="https://cn.redux.js.org/docs/recipes/reducers/NormalizingStateShape.html" target="_blank" rel="noopener"><strong>èŒƒå¼åŒ– State</strong></a>ï¼Œæ‰å¹³åŒ–ç»“æ„æ ‘, å‡å°‘åµŒå¥—ï¼Œå‡å°‘æ•°æ®å†—ä½™. <strong>ä¹Ÿå°±æ˜¯å€¾å‘äºæ›´æ–¹ä¾¿è¢«æ›´æ–°å’Œå­˜å‚¨ï¼Œè‡³äºè§†å›¾éœ€è¦ä»€ä¹ˆåˆ™äº¤ç”± reselect è¿™äº›åº“è¿›è¡Œè®¡ç®—æ˜ å°„å’Œç»„åˆ</strong>.</p><p>æ‰€ä»¥è¯´ Redux æ²¡é‚£ä¹ˆç®€å•, å½“ç„¶ 80%çš„ Web åº”ç”¨ä¹Ÿä¸éœ€è¦è¿™ä¹ˆå¤æ‚.</p><p><br></p></li><li><p><strong>äº”ï¼Œä¸æ–¹ä¾¿ Typescript ç±»å‹åŒ–</strong>ã€‚ä¸ç®¡æ˜¯ redux è¿˜æ˜¯äºŒæ¬¡å°è£…æ¡†æ¶éƒ½ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ Typescript è¿›è¡Œç±»å‹æ¨å¯¼ï¼Œå°¤å…¶æ˜¯åœ¨åŠ å…¥å„ç§æ‰©å±•åã€‚ä½ å¯èƒ½éœ€è¦æ˜¾å¼æ³¨è§£å¾ˆå¤šæ•°æ®ç±»å‹</p><p>æ‰©å±•: <a href="https://github.com/piotrwitek/react-redux-typescript-guide#redux---typing-patterns" target="_blank" rel="noopener">react-redux-typescript-guide</a>, <a href="https://rematch.gitbooks.io/rematch/docs/recipes/typescript.html" target="_blank" rel="noopener">rematch &amp; Typescript</a><br><br></p></li><li><p><strong>å…­ï¼Œä¸æ˜¯åˆ†å½¢(Fractal)</strong></p><p>åœ¨æ²¡æœ‰çœ‹åˆ°<a href="https://www.zhihu.com/people/yang-jian-feng/activities" target="_blank" rel="noopener">@æ¨å‰‘é”‹</a>çš„è¿™æ¡<a href="https://www.zhihu.com/question/263928256/answer/275092256" target="_blank" rel="noopener">çŸ¥ä¹å›ç­”</a>ä¹‹å‰æˆ‘ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆå«åˆ†å½¢, æˆ‘åªèƒ½å°è¯•è§£é‡Šä¸€ä¸‹æˆ‘å¯¹åˆ†å½¢çš„ç†è§£:</p><p>å‰é¢æ–‡ç« ä¹Ÿæåˆ°è¿‡â€˜åˆ†ç¦»é€»è¾‘å’Œè§†å›¾â€™å’Œâ€˜åˆ†ç¦»å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶â€™ï¼Œè¿™ä¸¤ä¸ªè§„åˆ™éƒ½æ¥è‡ªäº Redux çš„æœ€ä½³å®è·µã€‚<strong>Redux å°±æ˜¯ä¸€ä¸ªâ€™éåˆ†å½¢çš„æ¶æ„â€™ï¼Œå¦‚ä¸‹å›¾ï¼Œåœ¨è¿™ç§ç®€å•çš„â€˜æ¨ªå‘åˆ†å±‚â€™ä¸‹, è§†å›¾å’Œé€»è¾‘(æˆ–çŠ¶æ€)å¯ä»¥è¢«å•ç‹¬å¤ç”¨ï¼Œä½†åœ¨ Redux ä¸­å´å¾ˆéš¾å°†äºŒè€…ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„ç»„ä»¶æ¥å¤ç”¨</strong>:</p><p>  <center><br>  <img src="/images/04/redux-and-dumb.png" width="400"><br>  </center><br>  <em>é›†ä¸­åŒ–çš„ Storeï¼Œå†é€šè¿‡ Connect æœºåˆ¶å¯ä»¥è®©çŠ¶æ€åœ¨æ•´ä¸ªåº”ç”¨èŒƒå›´å†…è¢«å¤ç”¨ï¼›Dumb ç»„ä»¶æŠ½ç¦»çš„çŠ¶æ€å’Œè¡Œä¸ºï¼Œä¹Ÿå®¹æ˜“è¢«å¤ç”¨</em></p><p>ç°åœ¨å‡è®¾ä½ éœ€è¦å°†å•ä¸ª container æŠ½ç¦»æˆç‹¬ç«‹çš„åº”ç”¨ï¼Œå•ä¸ª container æ˜¯æ— æ³•ç‹¬ç«‹å·¥ä½œçš„ã€‚<strong>åœ¨åˆ†å½¢çš„æ¶æ„ä¸‹ï¼Œä¸€ä¸ªâ€˜åº”ç”¨â€™æœ‰æ›´å°çš„â€˜åº”ç”¨â€™ç»„æˆï¼Œâ€˜åº”ç”¨â€™å†…éƒ¨æœ‰è‡ªå·±çš„çŠ¶æ€æœºåˆ¶ï¼Œå•ä¸ªåº”ç”¨å¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå­åº”ç”¨</strong>. ä¾‹å¦‚ Redux çš„é¼»ç¥– Elm çš„æ¶æ„:</p><p>  <center><br>  <img src="/images/04/elm.jpg" width="500"><br>  </center><br>  <em>Storeçš„ç»“æ„å’Œåº”ç”¨çš„ç»“æ„ä¿æŒä¸€è‡´, æ¯ä¸ª Elm ç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ª Elm åº”ç”¨ï¼ŒåŒ…å«å®Œæ•´çš„Actionã€Updateã€Modelå’ŒView. ä½¿å¾—å•ç‹¬çš„åº”ç”¨å¯ä»¥è¢«å¤ç”¨</em></p><p><strong>Redux ä¸æ˜¯åˆ†å½¢å’Œ Redux æœ¬èº«çš„å®šä½æœ‰å…³ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯ç²¹çš„çŠ¶æ€ç®¡ç†å™¨ï¼Œä¸æ¶‰åŠç»„ä»¶çš„è§†å›¾å®ç°ï¼Œæ‰€ä»¥æ— æ³•åƒ elm å’Œ cyclejs ä¸€æ ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„åº”ç”¨é—­ç¯</strong>ã€‚ å…¶å®å¯ä»¥å‘ç° react ç»„ä»¶æœ¬èº«å°±æ˜¯åˆ†å½¢çš„ï¼Œç»„ä»¶åŸæœ¬å°±æ˜¯çŠ¶æ€å’Œè§†å›¾çš„é›†åˆ.</p><p>åˆ†å½¢çš„å¥½å¤„å°±æ˜¯å¯ä»¥å®ç°æ›´çµæ´»çš„å¤ç”¨å’Œç»„åˆï¼Œå‡å°‘èƒ¶æ°´ä»£ç ã€‚æ˜¾ç„¶ç°åœ¨æ”¯æŒçº¯åˆ†å½¢æ¶æ„çš„æ¡†æ¶å¹¶ä¸æµè¡Œï¼ŒåŸå› å¯èƒ½æ˜¯é—¨æ§›æ¯”è¾ƒé«˜ã€‚ä¸ªäººè®¤ä¸ºä¸æ”¯æŒåˆ†å½¢åœ¨å·¥ç¨‹ä¸Šè¿˜ä¸è‡³äºæˆä¸º Redux çš„ç—›ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€˜æ¨¡å—åŒ–â€™å°† Redux æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œåœ¨å¤šä¸ª Container ä¸­è¿›è¡Œç‹¬ç«‹ç»´æŠ¤ï¼Œä»æŸç§ç¨‹åº¦ä¸Šæ˜¯å¦å°±æ˜¯åˆ†å½¢ï¼Ÿå¦å¤–è¿™ç§æ¨ªå‘éš”ç¦»çš„ UI å’ŒçŠ¶æ€ï¼Œä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼Œæ¯”å¦‚ UI ç›¸æ¯”ä¸šåŠ¡çš„çŠ¶æ€å˜åŒ–çš„é¢‘åº¦ä¼šæ›´å¤§.</p><p>ä¸ªäººæ„Ÿè§‰åˆ°é¡µé¢è¿™ä¸ªçº§åˆ«çš„åˆ†åŒ–åˆšåˆšå¥½ï¼Œæ¯”å¦‚æ–¹ä¾¿åˆ†å·¥ã€‚æ¯”å¦‚æœ€è¿‘ç¬”è€…å°±æœ‰è¿™æ ·ä¸€ä¸ªé¡¹ç›®, æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªåŸç”Ÿ Windows å®¢æˆ·ç«¯è½¬æ¢æˆ electron å®ç°ï¼Œé™äºèµ„æºé—®é¢˜ï¼Œè¿™ä¸ªé¡¹ç›®æ¶‰åŠåˆ°ä¸¤ä¸ªå›¢é˜Ÿä¹‹é—´åä½œ. å¯¹äºè¿™ä¸ªé¡¹ç›®åº”ç”¨ Store å°±æ˜¯ä¸€ä¸ªæ¥å£å±‚ï¼ŒWindows å›¢é˜Ÿè´Ÿè´£åœ¨è¿™é‡Œç»´æŠ¤çŠ¶æ€å’Œå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæˆ‘ä»¬å‰ç«¯å›¢é˜Ÿåˆ™è´Ÿè´£å±•ç¤ºå±‚. è¿™æ ·ä¸€æ¥ Windows ä¸éœ€è¦å­¦ä¹  React å’Œè§†å›¾å±•ç¤ºï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å…³ç³»ä»–ä»¬å¤æ‚çš„ä¸šåŠ¡é€»è¾‘(åº•å±‚è¿˜æ˜¯ä½¿ç”¨ C++, æš´éœ²éƒ¨åˆ†æ¥å£ç»™ node)</p></li></ul><p><br></p><p><strong>ä¸ƒï¼Œå¯èƒ½è¿˜æœ‰æ€§èƒ½é—®é¢˜</strong></p><ul><li><a href="https://cn.redux.js.org/docs/faq/Performance.html" target="_blank" rel="noopener">Redux å¸¸è§é—®é¢˜ï¼šæ€§èƒ½</a></li><li><a href="https://www.zhihu.com/question/41904561/answer/93029393" target="_blank" rel="noopener">redux ä¸­çš„ state æ ‘å¤ªå¤§ä¼šä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ</a></li><li><a href="https://tech.youzan.com/mobx_vs_redux/" target="_blank" rel="noopener">æˆ‘ä¸ºä»€ä¹ˆä» Redux è¿ç§»åˆ°äº† Mobx</a></li><li><a href="https://zhuanlan.zhihu.com/p/52625410" target="_blank" rel="noopener">Mobx ä¸ Redux çš„æ€§èƒ½å¯¹æ¯”</a></li></ul><p><br></p><p>æ€»ç»“</p><p>æœ¬èŠ‚ä¸»è¦ä»‹ç»çš„ Redux è®¾è®¡çš„åŠ¨æœºï¼Œä»¥åŠå›´ç»•ç€è¿™ä¸ªåŠ¨æœºä¸€ç³»åˆ—è®¾è®¡, å†ä»‹ç»äº† Redux çš„ä¸€äº›ç¼ºç‚¹å’Œæœ€ä½³å®è·µã€‚Redux çš„ç”Ÿæ€éå¸¸ç¹è£ï¼Œå¦‚æœæ˜¯åˆå­¦è€…æˆ–ä¸æƒ³æŠ˜è…¾è¿˜æ˜¯å»ºè®®ä½¿ç”¨ Dva æˆ– rematch è¿™ç±»äºŒæ¬¡å°è£…æ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶é€šå¸¸å°±æ˜¯ Redux ä¸€äº›æœ€ä½³å®è·µçš„æ²‰æ·€, å‡å°‘æŠ˜è…¾çš„æ—¶é—´ã€‚å½“ç„¶è¿™åªæ˜¯ä¸ªå¼€å§‹ï¼Œç»„ç»‡ä¸€ä¸ªå¤§å‹é¡¹ç›®ä½ è¿˜æœ‰å¾ˆå¤šè¦å­¦çš„ã€‚</p><p><br></p><p>æ‰©å±•é˜…è¯»</p><ul><li><a href="https://www.zhihu.com/question/263928256/answer/275092256" target="_blank" rel="noopener">Redux æœ‰ä»€ä¹ˆç¼ºç‚¹</a> çŸ¥ä¹ä¸Šçš„åæ§½</li><li><a href="https://zhuanlan.zhihu.com/p/27093191" target="_blank" rel="noopener">Redux çŠ¶æ€ç®¡ç†ä¹‹ç—›ç‚¹ã€åˆ†æä¸æ”¹è‰¯</a></li><li><a href="https://www.zhihu.com/question/47995437/answer/108788493" target="_blank" rel="noopener">Redux æœ‰å“ªäº›æœ€ä½³å®è·µ?</a></li><li><a href="https://www.zhihu.com/question/38591713/answer/77634014" target="_blank" rel="noopener">å¦‚ä½•è¯„ä»·æ•°æ®æµç®¡ç†æ¶æ„ Redux?</a></li><li><a href="https://www.zhihu.com/question/284931332/answer/441399919" target="_blank" rel="noopener">2018 å¹´æˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆåŠŸèƒ½æ˜¯ Redux æ‰é€‚åˆåšçš„å—ï¼Ÿ</a></li><li><a href="https://juejin.im/post/5c166d8fe51d45242973fdd3" target="_blank" rel="noopener">Cycle.js çŠ¶æ€ç®¡ç†æ¨¡å‹</a></li><li><a href="https://dvajs.com/guide/develop-complex-spa.html#åŠ¨æ€åŠ è½½model" target="_blank" rel="noopener">ä½¿ç”¨ Dva å¼€å‘å¤æ‚ SPA</a></li><li><a href="https://hackernoon.com/redesigning-redux-b2baee8b8a38" target="_blank" rel="noopener">Redesigning Redux</a></li><li><a href="https://redux.js.org/introduction/getting-started" target="_blank" rel="noopener">Redux å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://zhuanlan.zhihu.com/p/26485702" target="_blank" rel="noopener">redux ä¸‰é‡å¢ƒ</a></li></ul><p><br></p><hr><p><br></p><h2 id="mobx"><a href="#mobx" class="headerlink" title="Mobx"></a>Mobx</h2><p>Mobx æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Vue çš„å“åº”å¼ç³»ç»Ÿï¼Œç›¸å¯¹ Redux æ¥è¯´ Mobx çš„æ¶æ„æ›´å®¹æ˜“ç†è§£ã€‚ æ‹¿å®˜æ–¹çš„å›¾æ¥çœ‹:</p><p><img src="/images/04/mobx-preview.png" alt></p><ul><li><p><strong>å“åº”å¼æ•°æ®</strong>. é¦–å…ˆä½¿ç”¨<code>@observable</code> å°†æ•°æ®è½¬æ¢ä¸ºâ€˜å“åº”å¼æ•°æ®â€™ï¼Œç±»ä¼¼äº Vue çš„ dataã€‚è¿™äº›æ•°æ®åœ¨ä¸€äº›ä¸Šä¸‹æ–‡(ä¾‹å¦‚ computedï¼Œobserver çš„åŒ…è£…çš„ React ç»„ä»¶ï¼Œreaction)ä¸­è¢«è®¿é—®æ—¶å¯ä»¥è¢«æ”¶é›†ä¾èµ–ï¼Œå½“è¿™äº›æ•°æ®å˜åŠ¨æ—¶ç›¸å…³çš„ä¾èµ–å°±ä¼šè¢«é€šçŸ¥.</p><p>å“åº”å¼æ•°æ®å¸¦æ¥çš„ä¸¤ä¸ªä¼˜ç‚¹æ˜¯ â‘  ç®€åŒ–æ•°æ®æ“ä½œæ–¹å¼(ç›¸æ¯” redux å’Œ setState); â‘¡ ç²¾ç¡®çš„æ•°æ®ç»‘å®šï¼Œåªæœ‰æ•°æ®çœŸæ­£å˜åŠ¨æ—¶ï¼Œè§†å›¾æ‰éœ€è¦æ¸²æŸ“ï¼Œç»„ä»¶ä¾èµ–çš„ç²’åº¦è¶Šå°ï¼Œè§†å›¾å°±å¯ä»¥æ›´ç²¾ç»†åœ°æ›´æ–°</p></li><li><p><strong>è¡ç”Ÿ</strong>.</p><ul><li>è¡ç”Ÿæ•°æ®ã€‚Mobx ä¹Ÿæ¨èä¸è¦åœ¨çŠ¶æ€ä¸­æ”¾ç½®å†—ä½™æˆ–å¯æ¨å¯¼çš„æ•°æ®ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>@computed</code> è®¡ç®—è¡ç”Ÿçš„çŠ¶æ€. computed çš„æ¦‚å¿µç±»ä¼¼äº Redux ä¸­çš„ reselectï¼Œå¯¹èŒƒå¼åŒ–çš„æ•°æ®è¿›è¡ŒåèŒƒå¼åŒ–æˆ–è€…èšåˆè®¡ç®—</li><li>å‰¯ä½œç”¨è¡ç”Ÿ. å½“æ•°æ®å˜åŠ¨æ—¶è§¦å‘ä¾èµ–è¯¥æ•°æ®çš„å‰¯ä½œç”¨ï¼Œå…¶ä¸­åŒ…å«â€˜è§†å›¾â€™ã€‚è§†å›¾æ˜¯å“åº”å¼æ•°æ®çš„æ˜ å°„</li></ul></li><li><p><strong>æ•°æ®å˜æ›´</strong>. mobx æ¨èåœ¨ <code>action/flow(å¼‚æ­¥æ“ä½œ)</code> ä¸­å¯¹æ•°æ®è¿›è¡Œå˜æ›´ï¼Œaction å¯ä»¥è®¤ä¸ºæ˜¯ Redux ä¸­çš„ dispatch+reducer çš„åˆä½“ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ mobx ä¼šé™åˆ¶åªèƒ½åœ¨ action å‡½æ•°ä¸­è¿›è¡Œå˜æ›´ï¼Œè¿™ä½¿å¾—çŠ¶æ€çš„å˜æ›´å¯è¢«è¿½æº¯ã€‚<strong>æ¨èåœ¨ flow å‡½æ•°ä¸­éš”ç¦»å‰¯ä½œç”¨ï¼Œè¿™ä¸ªä¸œè¥¿å’Œ Redux-saga å·®ä¸å¤šï¼Œé€šè¿‡ generator æ¥è¿›è¡Œå¼‚æ­¥æ“ä½œå’Œå‰¯ä½œç”¨éš”ç¦»</strong></p></li></ul><p><br></p><p>ä¸Šé¢å°±æ˜¯ Mobx çš„æ ¸å¿ƒæ¦‚å¿µã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><center><br><img src="/codes/mobx-demo.png" width="650"><br></center><p>ä½†æ˜¯<strong>Mobx ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶</strong>ï¼Œå®ƒä¸ä¼šåƒ Redux ä¸€æ ·å‘Šè¯‰ä½ å¦‚ä½•å»ç»„ç»‡ä»£ç ï¼Œåœ¨å“ªå­˜å‚¨çŠ¶æ€æˆ–è€…å¦‚ä½•å¤„ç†äº‹ä»¶, ä¹Ÿæ²¡æœ‰æœ€ä½³å®è·µã€‚å¥½å¤„æ˜¯ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½ç»„ä»¶é¡¹ç›®ï¼Œæ¯”å¦‚æŒ‰ç…§ Redux(Vuex)æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡æ–¹å¼ç»„ç»‡; åå¤„æ˜¯å¦‚æœä½ æ²¡æœ‰ç›¸å…³ç»éªŒ, ä¼šä¸çŸ¥æ‰€æªï¼Œä¸çŸ¥é“å¦‚ä½•ç»„ç»‡ä»£ç </p><p>Mobx ä¸€èˆ¬ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼å¯¹ Store è¿›è¡Œç»„ç»‡, å®˜æ–¹æ–‡æ¡£<a href="https://cn.mobx.js.org/best/store.html" target="_blank" rel="noopener">æ„å»ºå¤§å‹å¯æ‰©å±•å¯ç»´æŠ¤é¡¹ç›®çš„æœ€ä½³å®è·µ</a>ä¹Ÿä»‹ç»äº†è¿™ç§æ–¹å¼, è¿™ä¸ªå…¶å®å°±æ˜¯ç»å…¸çš„ MV* æ¨¡å¼:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/          # å±•ç¤ºç»„ä»¶</span><br><span class="line">  models/              # ğŸ”´ æ”¾ç½®ä¸€äº›é¢†åŸŸå¯¹è±¡</span><br><span class="line">    Order.ts</span><br><span class="line">    User.ts</span><br><span class="line">    Product.ts</span><br><span class="line">    ...</span><br><span class="line">  stores/              # store</span><br><span class="line">    AppStore.ts        # åº”ç”¨Storeï¼Œå­˜æ”¾åº”ç”¨å…¨å±€ä¿¡æ¯ï¼Œå¦‚authï¼Œlanguageï¼Œtheme</span><br><span class="line">    OrderStore.ts</span><br><span class="line">    RootStore.ts       # æ ¹Storeï¼Œç»„åˆæ‰€æœ‰ä¸‹çº§Store</span><br><span class="line">    ...</span><br><span class="line">  containers/</span><br><span class="line">    App/               # æ ¹ç»„ä»¶</span><br><span class="line">    Orders/            # é¡µé¢ç»„ä»¶</span><br><span class="line">    ...</span><br><span class="line">  utils/</span><br><span class="line">  store.ts             # storeåˆå§‹åŒ–</span><br><span class="line">  index.tsx</span><br></pre></td></tr></table></figure><p><br></p><p><strong>é¢†åŸŸå¯¹è±¡</strong></p><p>é¢å‘å¯¹è±¡é¢†åŸŸæœ‰å¤ªå¤šçš„åè¯å’Œæ¦‚å¿µï¼Œè€Œä¸”æ¯”è¾ƒæŠ½è±¡ï¼Œå¦‚æœç†è§£æœ‰è¯¯è¯·çº æ­£. æš‚ä¸”ä¸å»ç†è®ºé¢†åŸŸå¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œå°šä¸”è§†ä½œæ˜¯ç°å®ä¸–ç•Œä¸­ä¸€ä¸ªä¸šåŠ¡å®ä½“åœ¨ OOP çš„æŠ½è±¡. å…·ä½“æ¥è¯´å¯ä»¥å½“åš<code>MVC</code>æ¨¡å¼ä¸­çš„ M, æˆ–è€…æ˜¯ ORM ä¸­æ•°æ®åº“ä¸­æ˜ å°„å‡ºæ¥çš„å¯¹è±¡.</p><p>å¯¹äºå¤æ‚çš„é¢†åŸŸå¯¹è±¡ï¼Œä¼šæŠ½å–ä¸ºå•ç‹¬çš„ç±»ï¼Œæ¯”å¦‚å‰é¢ä¾‹å­ä¸­çš„<code>Todo</code>ç±», æŠ½å–ä¸ºç±»çš„å¥½å¤„æ˜¯å®ƒå…·æœ‰å°è£…æ€§ï¼Œå¯ä»¥åŒ…å«å…³è”çš„è¡Œä¸ºã€å®šä¹‰å’Œå…¶ä»–å¯¹è±¡çš„å…³è”å…³ç³»ï¼Œç›¸æ¯”çº¯å¯¹è±¡è¡¨è¾¾èƒ½åŠ›æ›´å¼º. ç¼ºç‚¹å°±æ˜¯ä¸å¥½åºåˆ—åŒ–</p><p>å› ä¸ºå®ƒä»¬å’Œé¡µé¢çš„å…³è”å…³ç³»è¾ƒå¼±ï¼Œä¸”å¯èƒ½åœ¨å¤šä¸ªé¡µé¢ä¸­è¢«å¤ç”¨, æ‰€ä»¥æ”¾åœ¨æ ¹ç›®å½•çš„<code>models/</code>ä¸‹. åœ¨ä»£ç å±‚é¢é¢†åŸŸå¯¹è±¡æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å®šä¹‰äº†ä¸€äº›å­—æ®µ(@observable)å’Œä¸€äº›é¢†åŸŸå¯¹è±¡çš„æ“ä½œæ–¹æ³•(@action), å¯èƒ½è¿˜å…³è”å…¶ä»–é¢†åŸŸå¯¹è±¡ï¼Œæ¯”å¦‚è®¢å•ä¼šå…³è”ç”¨æˆ·å’Œäº§å“</li><li>ç”± Store æ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–è€…è¯´ Store å°± Model çš„å®¹å™¨, ç›¸å½“äºæ•°æ®åº“. Store é€šå¸¸ä¹Ÿæ˜¯å•ä¾‹</li></ul><p>ç¤ºä¾‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Order &#123;</span><br><span class="line">  <span class="keyword">public</span> id: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> createdDate: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> product: Product;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> user: User;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>Store</strong></p><p>Store åªæ˜¯ä¸€ä¸ª Model å®¹å™¨ï¼Œ è´Ÿè´£ç®¡ç† model å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€å®šä¹‰è¡ç”ŸçŠ¶æ€ã€å°è£…å‰¯ä½œç”¨ã€å’Œåç«¯æ¥å£é›†æˆç­‰ç­‰. Store ä¸€èˆ¬æ˜¯å•ä¾‹. åœ¨ Mobx åº”ç”¨ä¸­ä¸€èˆ¬ä¼šåˆ’åˆ†ä¸ºå¤šä¸ª Store ç»‘å®šä¸åŒçš„é¡µé¢ã€‚</p><p>ç¤ºä¾‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, computed, reaction &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> OrderStore &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰æ¨¡å‹state</span></span><br><span class="line">  <span class="meta">@observable</span> orders: Order[] = [];</span><br><span class="line"></span><br><span class="line">  _unSubscribeOrderChange: <span class="built_in">Function</span></span><br><span class="line">  rootStore: RootStore</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰è¡ç”Ÿæ•°æ®</span></span><br><span class="line">  <span class="meta">@computed</span> <span class="keyword">get</span> finishedOrderCount() &#123;&#125;</span><br><span class="line">  <span class="meta">@computed</span> <span class="keyword">get</span> finishedOrders() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰å‰¯ä½œç”¨è¡ç”Ÿ</span></span><br><span class="line">  subscribeOrderChange() &#123;      <span class="keyword">this</span>._unSubscribeOrderChange = <span class="keyword">this</span>.orders.observe(<span class="function">(<span class="params">changeData</span>) =&gt;</span> &#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰action</span></span><br><span class="line">  <span class="meta">@action</span>  addOrder (order) &#123;&#125;</span><br><span class="line">  <span class="meta">@action</span>  removeOrder (order) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æˆ–è€…ä¸€äº›å¼‚æ­¥çš„action</span></span><br><span class="line">  <span class="keyword">async</span> fetchOrders () &#123;</span><br><span class="line">    <span class="keyword">const</span> orders = <span class="keyword">await</span> fetchOrders()</span><br><span class="line">    orders.forEach(<span class="function"><span class="params">item</span> =&gt;</span> <span class="keyword">this</span>.addOrder(<span class="keyword">new</span> OrderModel(<span class="keyword">this</span>, item)))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–æ•°æ®ç»“æ„ï¼Œåˆå§‹åŒ–è®¢é˜…ç­‰ç­‰</span></span><br><span class="line">  initialize () &#123;</span><br><span class="line">    <span class="keyword">this</span>.subscribeOrderChange()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸€äº›æ¸…ç†å·¥ä½œ</span></span><br><span class="line">  release () &#123;</span><br><span class="line">    <span class="keyword">this</span>._unSubscribeOrderChange()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">store: RootStore</span>) &#123;</span><br><span class="line">    <span class="comment">// å’ŒrootStoreè¿›è¡Œé€šä¿¡</span></span><br><span class="line">    <span class="keyword">this</span>.rootStore = store</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹ Store</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> RootStore &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.appStore = <span class="keyword">new</span> AppStore(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.orderStore = <span class="keyword">new</span> OrderStore(<span class="keyword">this</span>);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Provider rootStore=&#123;new RootStore()&#125;&gt;</span><br><span class="line">  &lt;App /&gt;</span><br><span class="line">&lt;/Provider&gt;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸ª <a href="https://github.com/gothinkster/react-mobx-realworld-example-app/blob/master/src/index.js" target="_blank" rel="noopener">çœŸå®ä¸–ç•Œçš„ä¾‹å­</a></p><p>è¿™ç§ä¼ ç»Ÿ MVC çš„ç»„ç»‡æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¼˜ç‚¹:</p><ul><li><strong>å¥½ç†è§£, å®¹æ˜“å…¥æ‰‹</strong>. ç»å…¸çš„ MVC æ¨¡å¼ã€é¢å‘å¯¹è±¡ï¼Œæˆ‘ä»¬å†ç†Ÿæ‚‰ä¸è¿‡äº†. å°¤å…¶æ˜¯ç†Ÿæ‚‰ Java è¿™äº›ä¼ ç»Ÿé¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼çš„åç«¯å¼€å‘äººå‘˜. ä¸Šæ–‡æåˆ°çš„è·¨å›¢é˜Ÿçš„é¡¹ç›®ï¼Œæˆ‘ä»¬é€‰æ‹©çš„å°±æ˜¯ mobx ä½œä¸ºçŠ¶æ€ç®¡ç†å™¨ï¼Œå¯¹äºä»–ä»¬æ¥è¯´è¿™æ˜¯æœ€å¥½ç†è§£çš„æ–¹å¼. ä½†æ˜¯<strong>å¯¹äºé¢†åŸŸå¯¹è±¡å’Œé¢†åŸŸ Store çš„æ‹†åˆ†å’Œè®¾è®¡éœ€è¦ä¸€ç‚¹ç»éªŒ</strong></li><li><strong>å¼ºç±»å‹</strong></li><li><strong>ä»£ç ç®€æ´</strong>ã€‚ç›¸å¯¹ Redux å¤šä½™çš„æ¨¡æ¿ä»£ç è€Œè¨€</li><li><strong>æ•°æ®å°è£…æ€§</strong>ã€‚ä½¿ç”¨ç±»è¡¨è¾¾çš„æ•°æ®ç»“æ„å¯ä»¥å°è£…ç›¸åº”çš„è¡Œä¸º</li></ul><p>é—®é¢˜</p><ul><li><strong>åœ¨å¤šä¸ª Store ä¹‹é—´å…±äº«æ•°æ®æ¯”è¾ƒéº»çƒ¦</strong>. æˆ‘ä»¬çš„åšæ³•æ˜¯è®©æ‰€æœ‰ Store éƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ä½œä¸ºä¸­é—´è€…ï¼Œé€šè¿‡äº‹ä»¶è®¢é˜…æ¨¡å¼åœ¨å¤šä¸ª Store é—´è¿›è¡Œæ•°æ®é€šä¿¡</li><li><strong>ç¼ºä¹ç»„ç»‡</strong>ã€‚ç›¸å¯¹ Redux è€Œè¨€, çŠ¶æ€è¿‡äºé›¶æ•£ï¼Œä¸åŠ ä»¥çº¦æŸï¼ŒçŠ¶æ€å¯ä»¥è¢«éšæ„ä¿®æ”¹ã€‚æˆ‘ä»¬å¾ˆå¤šä»£ç å°±æ˜¯è¿™æ ·ï¼Œæ‡’å¾—å†™ actionï¼Œç”šè‡³ç›´æ¥åœ¨è§†å›¾å±‚ç»™çŠ¶æ€èµ‹å€¼. æ‰€ä»¥ä¸€å®šè¦å¼€å§‹ä¸¥æ ¼æ¨¡å¼</li><li><strong>æ²¡æœ‰ Magic</strong>. è¿™æ˜¯ä¸€æŠŠåŒåˆƒå‰‘, Redux æœ‰ä¸­é—´ä»¶æœºåˆ¶ï¼Œå¯ä»¥æ‰©å±•æŠ½è±¡è®¸å¤šé‡å¤çš„å·¥ä½œ, æ¯”å¦‚ä¸ºå¼‚æ­¥æ–¹æ³•æ·»åŠ  loading çŠ¶æ€, ä½†æ˜¯å¯¹ Typescript ä¸å‹å¥½; åŸºäºç±»çš„æ–¹æ¡ˆï¼Œæ— å¤„ä¸‹æ‰‹ï¼Œä»£ç ä¼šæ¯”è¾ƒå•°å—¦ï¼Œ ä½†æ›´ç›´è§‚</li><li><strong>æ— æ•°æ®å¿«ç…§</strong>ï¼Œæ— æ³•å®ç°æ—¶é—´å›æº¯ï¼Œè¿™æ˜¯ Redux çš„å¼ºé¡¹ï¼Œä½†å¤§éƒ¨åˆ†çš„åº”ç”¨ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½; å¦å¤–å¯ä»¥é€šè¿‡ mobx-state-tree å®ç°</li><li><strong>æ— æ³• hot-reload</strong></li></ul><p><br></p><p>è¿˜æœ‰ä¸€äº› mobx æœ¬èº«çš„é—®é¢˜, è¿™äº›é—®é¢˜åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæè¿‡, å¦å¤–å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« (<a href="https://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697266952&amp;idx=2&amp;sn=a3389d1db237c2b23f523061da3b2359" target="_blank" rel="noopener">Mvvm å‰ç«¯æ•°æ®æµæ¡†æ¶ç²¾è®²</a>):</p><ul><li><p><strong>ç»„ä»¶ä¾µå…¥æ€§</strong>. éœ€è¦æ”¹å˜ React ç»„ä»¶åŸæœ¬çš„ç»“æ„, ä¾‹å¦‚æ‰€æœ‰éœ€è¦å“åº”æ•°æ®å˜åŠ¨çš„ç»„ä»¶éƒ½éœ€è¦ä½¿ç”¨ observer è£…é¥°. ç»„ä»¶æœ¬åœ°çŠ¶æ€ä¹Ÿéœ€è¦ observable è£…é¥°, ä»¥åŠæ•°æ®æ“ä½œæ–¹å¼ç­‰ç­‰. å¯¹ mobx è€¦åˆè¾ƒæ·±, æ—¥ååˆ‡æ¢æ¡†æ¶æˆ–é‡æ„çš„æˆæœ¬å¾ˆé«˜</p></li><li><p><strong>å…¼å®¹æ€§</strong>. mobx v5 åä½¿ç”¨ Proxy è¿›è¡Œé‡æ„, ä½† Proxy åœ¨ Chrome49 ä¹‹åæ‰æ”¯æŒ. å¦‚æœè¦å…¼å®¹æ—§ç‰ˆæµè§ˆå™¨åˆ™åªèƒ½ä½¿ç”¨ v4, v4 æœ‰ä¸€äº›<a href="https://cn.mobx.js.org/#mobx-4-vs-mobx-5" target="_blank" rel="noopener">å‘</a>, è¿™äº›å‘å¯¹äºä¸äº†è§£ mobx çš„æ–°æ‰‹å¾ˆéš¾å‘ç°:</p><ul><li>Observable æ•°ç»„å¹¶éçœŸæ­£çš„æ•°ç»„. æ¯”å¦‚ antd çš„ Table ç»„ä»¶å°±ä¸è®¤ mobx çš„æ•°ç»„, éœ€è¦ä¼ å…¥åˆ°ç»„ä»¶ä¹‹é—´ä½¿ç”¨ slice è¿›è¡Œè½¬æ¢</li><li>å‘ä¸€ä¸ªå·²å­˜åœ¨çš„ observable å¯¹è±¡ä¸­æ·»åŠ å±æ€§ä¸ä¼šè¢«è‡ªåŠ¨æ•è·</li></ul></li></ul><p><br></p><p><code>MV*</code> åªæ˜¯ Mobx çš„å…¶ä¸­ä¸€ç§ä¸»æµç»„ç»‡æ–¹å¼, å¾ˆå¤šæ–‡ç« åœ¨è®¨è®º Redux å’Œ mobx æ—¶å¾€å¾€ä¼šæ²¦ä¸º<strong>å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡</strong>ä¹‹äº‰ï¼Œç„¶åå°±ä¸‹ç»“è®ºè¯´ Redux æ›´é€‚åˆå¤§å‹é¡¹ç›®ï¼Œ<strong>ä¸‹è¿™ç§ç»“è®ºæœ€ä¸»è¦çš„åŸå› æ˜¯ Redux æœ‰æ›´å¤šçº¦æŸ(only one way to do it), é€‚åˆé¡¹ç›®çš„æ¼”è¿›å’Œå›¢é˜Ÿåä½œ, è€Œä¸åœ¨äºå‡½æ•°å¼å’Œé¢å‘å¯¹è±¡</strong>ã€‚å½“ç„¶å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡èŒƒå¼éƒ½æœ‰è‡ªå·±æ“…é•¿çš„é¢†åŸŸï¼Œä¾‹å¦‚å‡½æ•°å¼é€‚åˆæ•°æ®å¤„ç†å’Œå¤æ‚æ•°æ®æµæŠ½è±¡ï¼Œè€Œé¢å‘å¯¹è±¡é€‚åˆä¸šåŠ¡æ¨¡å‹çš„æŠ½è±¡, æ‰€ä»¥ä¸è¦ä¸€ç«¿å­æ‰“æ­».</p><p>æ¢å¥è¯è¯´é€‚ä¸é€‚åˆå¤§å‹é¡¹ç›®æ˜¯é¡¹ç›®ç»„ç»‡é—®é¢˜, Mobx å‰æœŸå¹¶æ²¡æœ‰æå‡ºä»»ä½•è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µã€‚è¿™ä¸åæ¥å…¶ä½œè€…ä¹Ÿå¼€å‘äº†<a href="https://github.com/mobxjs/mobx-state-tree" target="_blank" rel="noopener">mobx-state-tree</a>è¿™ä¸ªç¥å™¨ï¼Œä½œä¸º MobX å®˜æ–¹æä¾›çš„çŠ¶æ€æ¨¡å‹æ„å»ºåº“ï¼ŒMST å¸æ”¶äº† Redux ç­‰å·¥å…·çš„ä¼˜ç‚¹ï¼Œ<strong>æ—¨åœ¨ç»“åˆä¸å¯å˜æ•°æ®/å‡½æ•°å¼(transactionality, traceability and composition)å’Œå¯å˜æ•°æ®/é¢å‘å¯¹è±¡(discoverability, co-location and encapsulation)ä¸¤è€…çš„ä¼˜ç‚¹</strong>ï¼Œ æä¾›äº†å¾ˆå¤šè¯¸å¦‚æ•°æ®é•œåƒ(time travel)ã€hot reloadã€action middlewareã€é›†æˆ redux-devtools ä»¥åŠå¼ºç±»å‹(Typescript + è¿è¡Œæ—¶æ£€æŸ¥(äº‰è®®ç‚¹))ç­‰å¾ˆæœ‰ç”¨çš„ç‰¹æ€§, å…¶å®å®ƒæ›´åƒæ˜¯åç«¯ ActiveRecord è¿™ç±» ORM å·¥å…·, æ„å»ºä¸€ä¸ªå¯¹è±¡å›¾ã€‚</p><center><br>  <img src="/images/04/immutable-vs-mutable.png" width="500"><br></center><p>å…¸å‹çš„ä»£ç ï¼š</p><center><br>  <img src="/codes/mst.png" width="800"><br></center><p>é™äºç¬”è€…å¯¹ MST å®è·µä¸å¤šï¼Œè€Œä¸”æ–‡ç« ç¯‡å¹…å·²ç»å¾ˆé•¿ï¼Œæ‰€ä»¥å°±ä¸å±•å¼€äº†ï¼Œåç»­æœ‰æœºä¼šå†åˆ†äº«åˆ†äº«ã€‚</p><p><br></p><p>è¿˜æ˜¯å¾—ä¸‹ä¸€ä¸ªç»“è®º, é€‰æ‹© Mobx è¿˜æ˜¯ Redux? è¿™é‡Œè¿˜æ˜¯å¼•ç”¨æ¥è‡ª<a href="https://zhuanlan.zhihu.com/p/25989654" target="_blank" rel="noopener">MobX vs Redux: Comparing the Opposing Paradigms - React Conf 2017 çºªè¦</a>çš„ç»“è®º:</p><ul><li>éœ€è¦å¿«é€Ÿå¼€å‘ç®€å•åº”ç”¨çš„å°å›¢é˜Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ MobXï¼Œå› ä¸º MobX éœ€è¦å¼€å‘çš„ä»£ç é‡å°ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œä¸Šæ‰‹å¿«ï¼Œé€‚åˆäºå®æ—¶ç³»ç»Ÿï¼Œä»ªè¡¨ç›˜ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ¼”ç¤ºè½¯ä»¶ï¼Œä½†ä¸é€‚ç”¨äºåŸºäºäº‹ä»¶çš„ç³»ç»Ÿ</li><li>Redux é€‚ç”¨äºå¤§å›¢é˜Ÿå¼€å‘å¤æ‚åº”ç”¨ï¼ŒRedux åœ¨å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§æ–¹é¢å¯ä»¥ hold ä½å¤šäººåä½œä¸ä¸šåŠ¡éœ€æ±‚å¤šå˜ï¼Œé€‚åˆå•†ä¸šç³»ç»Ÿã€åŸºäºäº‹ä»¶çš„ç³»ç»Ÿä»¥åŠæ¶‰åŠå¤æ‚ååº”çš„æ¸¸æˆåœºæ™¯ã€‚</li></ul><p>ä¸Šè¿°ç»“è®ºçš„ä¸»è¦ä¾æ®æ˜¯ Redux å¯¹ action / event ä½œå‡ºååº”ï¼Œè€Œ MobX å¯¹ state å˜åŒ–ä½œå‡ºååº”ã€‚æ¯”å¦‚å½“ä¸€ä¸ªæ•°æ®å˜æ›´æ¶‰åŠåˆ° Mobx çš„å¤šä¸ª Storeï¼Œå¯ä»¥ä½“ç°å‡º Redux çš„æ–¹å¼æ›´åŠ ä¼˜é›…ï¼Œæ•°æ®æµæ›´åŠ æ¸…æ™°. å‰é¢éƒ½è¯¦å°½é˜è¿°äº† Mobx å’Œ Redux çš„ä¼˜ç¼ºç‚¹ï¼Œmobx è¿˜æœ‰ MST åŠ æŒï¼Œ ç›¸ä¿¡è¯»è€…å¿ƒé‡Œæ—©å·²æœ‰è‡ªå·±çš„å–œå¥½</p><p><br></p><p>æ‰©å±•</p><ul><li><a href="https://zhuanlan.zhihu.com/p/33761397" target="_blank" rel="noopener">ä½ éœ€è¦ Mobx è¿˜æ˜¯ Reduxï¼Ÿ</a></li><li><a href="https://zhuanlan.zhihu.com/p/25585910" target="_blank" rel="noopener">Mobx æ€æƒ³çš„å®ç°åŸç†ï¼ŒåŠä¸ Redux å¯¹æ¯”</a></li><li><a href="https://zhuanlan.zhihu.com/p/25989654" target="_blank" rel="noopener">MobX vs Redux: Comparing the Opposing Paradigms - React Conf 2017 çºªè¦</a></li><li><a href="https://github.com/dobjs/dob" target="_blank" rel="noopener">dob</a> æ›´è½»é‡çš„ç±»ä¼¼ mobx çš„è½®å­</li><li><a href="https://segmentfault.com/a/1190000018940757" target="_blank" rel="noopener">ç§¯æ¢¦å‰ç«¯é‡‡ç”¨çš„ React çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ: Rex</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697266952&amp;idx=2&amp;sn=a3389d1db237c2b23f523061da3b2359" target="_blank" rel="noopener">å¹²è´§ | Mvvm å‰ç«¯æ•°æ®æµæ¡†æ¶ç²¾è®²</a></li></ul><h2 id="rxjs"><a href="#rxjs" class="headerlink" title="RxJS"></a>RxJS</h2><p>å¦‚æœä¸Šæ–‡æåˆ°çš„çŠ¶æ€ç®¡ç†å·¥å…·éƒ½æ— æ³•æ»¡è¶³ä½ çš„éœ€è¦ï¼Œä½ çš„é¡¹ç›®å¤æ‚ç¨‹åº¦å¯èƒ½è¶…è¿‡å…¨å›½ 99%çš„é¡¹ç›®äº†. RxJS å¯èƒ½å¯ä»¥åŠ©ä½ ä¸€è‡‚ä¹‹åŠ›, <strong>RxJS éå¸¸é€‚åˆå¤æ‚å¼‚æ­¥äº‹ä»¶æµçš„åº”ç”¨</strong>ï¼Œç¬”è€…åœ¨è¿™æ–¹é¢å®è·µä¹Ÿæ¯”è¾ƒå°‘ï¼Œæ¨èçœ‹çœ‹<a href="https://www.zhihu.com/people/sharpmaster/posts" target="_blank" rel="noopener">å¾é£çš„ç›¸å…³æ–‡ç« </a>, å¦å¤– Redux(Redux-Observable)å’Œ Mobx å®é™…ä¸Šä¹Ÿå¯ä»¥é…åˆ RxJS ä½¿ç”¨</p><p><br></p><hr><p><br></p><h2 id="å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ"><a href="#å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ"></a>å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ</h2><ul><li>Apollo+GraphQL</li><li><a href="https://github.com/FormidableLabs/freactal/" target="_blank" rel="noopener">freactal</a></li></ul><p>æ¨èè¿™ç¯‡æ–‡ç« <a href="https://blog.bitsrc.io/state-of-react-state-management-in-2019-779647206bbc" target="_blank" rel="noopener">State of React State Management for 2019</a></p><p><br></p><hr><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/26426054" target="_blank" rel="noopener">å•é¡µåº”ç”¨çš„æ•°æ®æµæ–¹æ¡ˆæ¢ç´¢</a></li><li><a href="https://zhuanlan.zhihu.com/p/24677176" target="_blank" rel="noopener">å¤æ‚å•é¡µåº”ç”¨çš„æ•°æ®å±‚è®¾è®¡</a></li><li><a href="https://blog.bitsrc.io/state-of-react-state-management-in-2019-779647206bbc" target="_blank" rel="noopener">State of React State Management for 2019</a></li><li><a href="https://zhuanlan.zhihu.com/p/32107541" target="_blank" rel="noopener">ä»æ—¶é—´æ—…è¡Œçš„ä¹Œæ‰˜é‚¦ï¼Œçœ‹çŠ¶æ€ç®¡ç†çš„è®¾è®¡è¯¯åŒº</a></li></ul></r>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©æ˜¯ 520ï¼Œè¿™æ˜¯æœ¬ç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦æ¶µç›– React çŠ¶æ€ç®¡ç†çš„ç›¸å…³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å‰å‡ ç¯‡æ–‡ç« åœ¨&lt;a href=&quot;https://juejin.im&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ˜é‡‘&lt;/a&gt;é¦–å‘åŸºæœ¬çŸ³æ²‰å¤§æµ·, æ²¡ä»€ä¹ˆé˜…è¯»é‡.
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</title>
    <link href="https://bobi.ink/2019/05/15/react-component-design-04/"/>
    <id>https://bobi.ink/2019/05/15/react-component-design-04/</id>
    <published>2019-05-14T16:00:00.000Z</published>
    <updated>2019-07-11T14:34:42.423Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ React çš„ä¸–ç•Œé‡Œâ€<strong>ä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶</strong>â€œï¼Œ ç»„ä»¶å¯ä»¥æ˜ å°„ä½œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å‡½æ•°ï¼ŒReact çš„ç»„ä»¶å’Œå‡½æ•°ä¸€æ ·çš„çµæ´»çš„ç‰¹æ€§ä¸ä»…ä»…å¯ä»¥ç”¨äºç»˜åˆ¶ UIï¼Œè¿˜å¯ä»¥ç”¨äºå°è£…ä¸šåŠ¡çŠ¶æ€å’Œé€»è¾‘ï¼Œæˆ–è€…éå±•ç¤ºç›¸å…³çš„å‰¯ä½œç”¨, å†é€šè¿‡ç»„åˆæ–¹å¼ç»„æˆå¤æ‚çš„åº”ç”¨. æœ¬æ–‡å°è¯•è§£é‡Šç”¨ React ç»„ä»¶çš„æ€ç»´æ¥å¤„ç†å¸¸è§çš„ä¸šåŠ¡å¼€å‘åœºæ™¯.</p><p><strong>ç³»åˆ—ç›®å½•</strong></p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li><a href="/2019/05/20/react-component-design-05/">05 çŠ¶æ€ç®¡ç†</a></li></ul><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#1-é«˜é˜¶ç»„ä»¶">1. é«˜é˜¶ç»„ä»¶</a></li><li><a href="#2-render-props">2. Render Props</a></li><li><a href="#3-ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘">3. ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘</a></li><li><a href="#4-hooks-å–ä»£é«˜é˜¶ç»„ä»¶">4. hooks å–ä»£é«˜é˜¶ç»„ä»¶</a></li><li><a href="#5-hooks-å®ç°å“åº”å¼ç¼–ç¨‹">5. hooks å®ç°<code>å“åº”å¼</code>ç¼–ç¨‹</a></li><li><a href="#6-ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„">6. ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„</a></li><li><a href="#7-æ¨¡æ€æ¡†ç®¡ç†">7. æ¨¡æ€æ¡†ç®¡ç†</a></li><li><a href="#8-ä½¿ç”¨-context-è¿›è¡Œä¾èµ–æ³¨å…¥">8. ä½¿ç”¨ Context è¿›è¡Œä¾èµ–æ³¨å…¥</a></li><li><a href="#9-ä¸å¯å˜çš„çŠ¶æ€">9. ä¸å¯å˜çš„çŠ¶æ€</a></li><li><a href="#10-react-router-url-å³çŠ¶æ€">10. React-router: URL å³çŠ¶æ€</a></li><li><a href="#11-ç»„ä»¶è§„èŒƒ">11. ç»„ä»¶è§„èŒƒ</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="1-é«˜é˜¶ç»„ä»¶"><a href="#1-é«˜é˜¶ç»„ä»¶" class="headerlink" title="1. é«˜é˜¶ç»„ä»¶"></a>1. é«˜é˜¶ç»„ä»¶</h2><p>åœ¨å¾ˆé•¿ä¸€æ®µæ—¶æœŸé‡Œï¼Œé«˜é˜¶ç»„ä»¶éƒ½æ˜¯å¢å¼ºå’Œç»„åˆ React ç»„ä»¶çš„æœ€æµè¡Œçš„æ–¹å¼. è¿™ä¸ªæ¦‚å¿µæºè‡ªäºå‡½æ•°å¼ç¼–ç¨‹çš„é«˜é˜¶å‡½æ•°. é«˜é˜¶ç»„ä»¶å¯ä»¥å®šä¹‰ä¸º: <strong>é«˜é˜¶ç»„ä»¶æ˜¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶åŸå§‹ç»„ä»¶å¹¶è¿”å›åŸå§‹ç»„ä»¶çš„å¢å¼º/å¡«å……ç‰ˆæœ¬</strong>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HOC = <span class="function"><span class="params">Component</span> =&gt;</span> EnhancedComponent;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦æ˜ç™½æˆ‘ä»¬<strong>ä¸ºä»€ä¹ˆéœ€è¦é«˜é˜¶ç»„ä»¶</strong>:</p><p>React çš„<a href="https://react.docschina.org/docs/higher-order-components.html" target="_blank" rel="noopener">æ–‡æ¡£</a>è¯´çš„éå¸¸æ¸…æ¥š, <strong>é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ç§ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘æ¨¡å¼</strong>. æœ€ä¸ºå¸¸è§çš„ä¾‹å­å°±æ˜¯ redux çš„<code>connect</code>å’Œ react-router çš„ <code>withRouter</code>. é«˜é˜¶ç»„ä»¶æœ€åˆç”¨äºå–ä»£ mixin(äº†è§£<a href="https://zhuanlan.zhihu.com/p/20361937" target="_blank" rel="noopener">React Mixin çš„å‰ä¸–ä»Šç”Ÿ</a>). æ€»ç»“æ¥è¯´å°±æ˜¯ä¸¤ç‚¹:</p><ul><li>é€»è¾‘å¤ç”¨. æŠŠä¸€äº›é€šç”¨çš„ä»£ç é€»è¾‘æå–å‡ºæ¥æ”¾åˆ°é«˜é˜¶ç»„ä»¶ä¸­, è®©æ›´å¤šç»„ä»¶å¯ä»¥å…±äº«</li><li>åˆ†ç¦»å…³æ³¨ç‚¹. åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­æåˆ°â€é€»è¾‘å’Œè§†å›¾åˆ†ç¦»â€çš„åŸåˆ™. é«˜é˜¶ç»„ä»¶å¯ä»¥ä½œä¸ºå®ç°è¯¥åŸåˆ™çš„è½½ä½“. æˆ‘ä»¬ä¸€èˆ¬å°†è¡Œä¸ºå±‚æˆ–è€…ä¸šåŠ¡å±‚æŠ½å–åˆ°é«˜é˜¶ç»„ä»¶ä¸­æ¥å®ç°, è®©å±•ç¤ºç»„ä»¶åªå…³æ³¨äº UI</li></ul><p>é«˜é˜¶ç»„ä»¶çš„ä¸€äº›<strong>å®ç°æ–¹æ³•</strong>ä¸»è¦æœ‰ä¸¤ç§:</p><ul><li><p><code>å±æ€§ä»£ç†(Props Proxy)</code>: ä»£ç†ä¼ é€’ç»™è¢«åŒ…è£…ç»„ä»¶çš„ props, å¯¹ props è¿›è¡Œæ“ä½œ. è¿™ç§æ–¹å¼ç”¨å¾—æœ€å¤š. ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥åšåˆ°:</p><ul><li>æ“ä½œ props</li><li>è®¿é—®è¢«åŒ…è£…ç»„ä»¶å®ä¾‹</li><li>æå– state</li><li>ç”¨å…¶ä»–å…ƒç´ åŒ…è£¹è¢«åŒ…è£…ç»„ä»¶</li></ul></li><li><p><code>åå‘ç»§æ‰¿(Inheritance Inversion)</code>: é«˜é˜¶ç»„ä»¶ç»§æ‰¿è¢«åŒ…è£…çš„ç»„ä»¶. ä¾‹å¦‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myhoc</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> Enhancer <span class="keyword">extends</span> WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.render();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å®ç°:</p><ul><li>æ¸²æŸ“åŠ«æŒ: å³æ§åˆ¶è¢«åŒ…è£…ç»„ä»¶çš„æ¸²æŸ“è¾“å‡º.</li><li>æ“ä½œ state: state ä¸€èˆ¬å±äºç»„ä»¶çš„å†…éƒ¨ç»†èŠ‚, é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å¯ä»¥æš´éœ²ç»™å­ç±». å¯ä»¥å¢åˆ æŸ¥æ”¹è¢«åŒ…è£…ç»„ä»¶çš„ state, é™¤éä½ çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ, ä¸€èˆ¬ä¸å»ºè®®è¿™ä¹ˆåš.</li></ul></li></ul><p>å®é™…ä¸Šé«˜é˜¶ç»„ä»¶èƒ½åšçš„ä¸æ­¢ä¸Šé¢åˆ—ä¸¾çš„, é«˜é˜¶ç»„ä»¶éå¸¸çµæ´», å…¨å‡­ä½ çš„æƒ³è±¡åŠ›. è¯»è€…å¯ä»¥äº†è§£ <a href="https://github.com/acdlite/recompose/blob/master/docs/API.md" target="_blank" rel="noopener">recompose</a>è¿™ä¸ªåº“, ç®€ç›´æŠŠé«˜é˜¶ç»„ä»¶ç©å‡ºèŠ±äº†.</p><p>æ€»ç»“ä¸€ä¸‹é«˜é˜¶ç»„ä»¶çš„<strong>åº”ç”¨åœºæ™¯</strong>:</p><ul><li>æ“ä½œ props: å¢åˆ æŸ¥æ”¹ props. ä¾‹å¦‚è½¬æ¢ props, æ‰©å±• props, å›ºå®š props, é‡å‘½å props</li><li>ä¾èµ–æ³¨å…¥. æ³¨å…¥ context æˆ–å¤–éƒ¨çŠ¶æ€å’Œé€»è¾‘, ä¾‹å¦‚ redux çš„ connnect, react-router çš„ withRouter. æ—§ context æ˜¯å®éªŒæ€§ API, æ‰€ä»¥å¾ˆå¤šåº“éƒ½ä¸ä¼šå°† context ä¿ç•™å‡ºæ¥, è€Œæ˜¯é€šè¿‡é«˜é˜¶ç»„ä»¶å½¢å¼è¿›è¡Œæ³¨å…¥</li><li>æ‰©å±• state: ä¾‹å¦‚ç»™å‡½æ•°å¼ç»„ä»¶æ³¨å…¥çŠ¶æ€</li><li>é¿å…é‡å¤æ¸²æŸ“: ä¾‹å¦‚ React.memo</li><li>åˆ†ç¦»é€»è¾‘, è®©ç»„ä»¶ä¿æŒ dumb</li></ul><blockquote><p>é«˜é˜¶ç»„ä»¶ç›¸å…³æ–‡æ¡£åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤š, æœ¬æ–‡ä¸æ‰“ç®—å±•å¼€æè¿°. æ·±å…¥äº†è§£<a href="https://zhuanlan.zhihu.com/p/24776678" target="_blank" rel="noopener">é«˜é˜¶ç»„ä»¶</a></p></blockquote><p>é«˜é˜¶ç»„ä»¶çš„ä¸€äº›<strong>è§„èŒƒ</strong>:</p><ul><li><p>åŒ…è£…æ˜¾ç¤ºåå­—ä»¥ä¾¿äºè°ƒè¯•</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withSubscription</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">class</span> WithSubscription <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">  WithSubscription.displayName = <span class="string">`WithSubscription(<span class="subst">$&#123;getDisplayName(WrappedComponent)&#125;</span>)`</span>;</span><br><span class="line">  <span class="keyword">return</span> WithSubscription;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDisplayName</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> WrappedComponent.displayName || WrappedComponent.name || <span class="string">'Component'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ React.forwardRef æ¥è½¬å‘ ref</p></li><li><p>ä½¿ç”¨â€™é«˜é˜¶å‡½æ•°â€™æ¥é…ç½®â€™é«˜é˜¶ç»„ä»¶â€™, è¿™æ ·å¯ä»¥è®©é«˜é˜¶ç»„ä»¶çš„ç»„åˆæ€§æœ€å¤§åŒ–. Redux çš„ connect å°±æ˜¯å…¸å‹çš„ä¾‹å­</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ConnectedComment = connect(</span><br><span class="line">  commentSelector,</span><br><span class="line">  commentActions,</span><br><span class="line">)(Comment);</span><br></pre></td></tr></table></figure><p>å½“ä½¿ç”¨ compose è¿›è¡Œç»„åˆæ—¶å°±èƒ½ä½“ä¼šåˆ°å®ƒçš„å¥½å¤„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ğŸ™… ä¸æ¨è</span></span><br><span class="line"><span class="keyword">const</span> EnhancedComponent = withRouter(connect(commentSelector)(WrappedComponent));</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä½¿ç”¨composeæ–¹æ³•è¿›è¡Œç»„åˆ</span></span><br><span class="line"><span class="comment">// compose(f, g, h) å’Œ (...args) =&gt; f(g(h(...args)))æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="keyword">const</span> enhance = compose(</span><br><span class="line">  <span class="comment">// è¿™äº›éƒ½æ˜¯å•ç‹¬ä¸€ä¸ªå‚æ•°çš„é«˜é˜¶ç»„ä»¶</span></span><br><span class="line">  withRouter,</span><br><span class="line">  connect(commentSelector),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> EnhancedComponent = enhance(WrappedComponent);</span><br></pre></td></tr></table></figure></li><li><p>è½¬å‘æ‰€æœ‰ä¸ç›¸å…³ props å±æ€§ç»™è¢«åŒ…è£…çš„ç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; extraProp, ...passThroughProps &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;WrappedComponent</span><br><span class="line">      injectedProp=&#123;injectedProp&#125;</span><br><span class="line">      &#123;...passThroughProps&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‘½å: ä¸€èˆ¬ä»¥ with*å‘½å, å¦‚æœæºå¸¦å‚æ•°, åˆ™ä»¥ create*å‘½å</p></li></ul><p><br></p><hr><p><br></p><h2 id="2-render-props"><a href="#2-render-props" class="headerlink" title="2. Render Props"></a>2. Render Props</h2><p>Render Props(Function as Child) ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ react æ¨¡å¼, æ¯”å¦‚å®˜æ–¹çš„ <a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener">Context API</a> å’Œ <a href="https://www.react-spring.io" target="_blank" rel="noopener">react-spring</a> åŠ¨ç”»åº“. ç›®çš„é«˜é˜¶ç»„ä»¶å·®ä¸å¤š: éƒ½æ˜¯ä¸ºäº†åˆ†ç¦»å…³æ³¨ç‚¹, å¯¹ç»„ä»¶çš„é€»è¾‘è¿›è¡Œå¤ç”¨; åœ¨ä½¿ç”¨å’Œå®ç°ä¸Šæ¯”é«˜é˜¶ç»„ä»¶è¦ç®€å•, åœ¨æŸäº›åœºæ™¯å¯ä»¥å–ä»£é«˜é˜¶ç»„ä»¶. å®˜æ–¹çš„å®šä¹‰æ˜¯:</p><blockquote><p><strong>æ˜¯æŒ‡ä¸€ç§åœ¨ React ç»„ä»¶ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„ prop åœ¨ React ç»„ä»¶é—´å…±äº«ä»£ç çš„ç®€å•æŠ€æœ¯</strong></p></blockquote><p>React å¹¶æ²¡æœ‰é™å®šä»»ä½• props çš„ç±»å‹, æ‰€ä»¥ props ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å½¢å¼. å½“ props ä¸ºå‡½æ•°æ—¶, çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°ç»™å­ç»„ä»¶ä¼ é€’ä¸€äº›æ•°æ®è¿›è¡ŒåŠ¨æ€æ¸²æŸ“. å…¸å‹ä»£ç ä¸º:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;FunctionAsChild&gt;&#123;<span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;Hello,World!&lt;<span class="regexp">/div&gt;&#125;&lt;/</span>FunctionAsChild&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;Spring <span class="keyword">from</span>=&#123;&#123; opacity: <span class="number">0</span> &#125;&#125; to=&#123;&#123; opacity: <span class="number">1</span> &#125;&#125;&gt;</span><br><span class="line">  &#123;<span class="function"><span class="params">props</span> =&gt;</span> &lt;div style=&#123;props&#125;&gt;hello&lt;<span class="regexp">/div&gt;&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Spring&gt;</span><br></pre></td></tr></table></figure><p>æŸç§ç¨‹åº¦ä¸Š, è¿™ç§æ¨¡å¼ç›¸æ¯”é«˜é˜¶ç»„ä»¶è¦ç®€å•å¾ˆå¤š, ä¸ç®¡æ˜¯å®ç°è¿˜æ˜¯ä½¿ç”¨å±‚æ¬¡. ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾:</p><ul><li>å¯è¯»æ€§å·®, å°¤å…¶æ˜¯å¤šå±‚åµŒå¥—æƒ…å†µä¸‹</li><li>ç»„åˆæ€§å·®. åªèƒ½é€šè¿‡ JSX ä¸€å±‚ä¸€å±‚åµŒå¥—, ä¸€èˆ¬ä¸å®œå¤šäºä¸€å±‚</li><li>é€‚ç”¨äºåŠ¨æ€æ¸²æŸ“. å› ä¸ºå±€é™åœ¨ JSX èŠ‚ç‚¹ä¸­, å½“å‰ç»„ä»¶æ˜¯å¾ˆéš¾è·å–åˆ° render props ä¼ é€’çš„æ•°æ®. å¦‚æœè¦ä¼ é€’ç»™å½“å‰ç»„ä»¶è¿˜æ˜¯å¾—é€šè¿‡ props, ä¹Ÿå°±æ˜¯é€šè¿‡é«˜é˜¶ç»„ä»¶ä¼ é€’è¿›æ¥</li></ul><p>å†å¼€ä¸€ä¸‹è„‘æ´. é€šè¿‡ä¸€ä¸ª Fetch ç»„ä»¶æ¥è¿›è¡Œæ¥å£è¯·æ±‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;Fetch method=<span class="string">"user.getById"</span> id=&#123;userId&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; data, error, retry, loading &#125;</span>) =&gt;</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &#123;loading ? (</span><br><span class="line">        &lt;Loader /&gt;</span><br><span class="line">      ) : error ? (</span><br><span class="line">        &lt;ErrorMessage error=&#123;error&#125; retry=&#123;retry&#125; /&gt;</span><br><span class="line">      ) : data ? (</span><br><span class="line">        &lt;Detail data=&#123;data&#125; /&gt;</span><br><span class="line">      ) : <span class="literal">null</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/Container&gt;</span></span><br><span class="line"><span class="regexp">  )&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Fetch&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ React Hooks å‡ºç°ä¹‹å‰, ä¸ºäº†ç»™å‡½æ•°ç»„ä»¶(æˆ–è€…è¯´ dumb component)æ·»åŠ çŠ¶æ€, é€šå¸¸ä¼šä½¿ç”¨è¿™ç§æ¨¡å¼. æ¯”å¦‚ <a href="https://github.com/renatorib/react-powerplug" target="_blank" rel="noopener">react-powerplug</a></p><blockquote><p>å®˜æ–¹<a href="https://react.docschina.org/docs/render-props.html" target="_blank" rel="noopener">æ–‡æ¡£</a></p></blockquote><p><br></p><hr><p><br></p><h2 id="3-ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘"><a href="#3-ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘" class="headerlink" title="3. ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘"></a>3. ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘</h2><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹, ç»„ä»¶è¡¨ç¤ºæ˜¯ä¸€ä¸ª UI å¯¹è±¡. å…¶å®ç»„ä»¶ä¸å•å•å¯ä»¥è¡¨ç¤º UI, ä¹Ÿå¯ä»¥ç”¨æ¥æŠ½è±¡ä¸šåŠ¡å¯¹è±¡, æœ‰æ—¶å€™æŠ½è±¡ä¸ºç»„ä»¶å¯ä»¥å·§å¦™åœ°è§£å†³ä¸€äº›é—®é¢˜.</p><p>ä¸¾ä¸€ä¸ªä¾‹å­: å½“ä¸€ä¸ªå®¡æ‰¹äººåœ¨å®¡æ‰¹ä¸€ä¸ªè¯·æ±‚æ—¶, è¯·æ±‚å‘èµ·è€…æ˜¯ä¸èƒ½é‡æ–°ç¼–è¾‘çš„; åä¹‹å‘èµ·è€…åœ¨ç¼–è¾‘æ—¶, å®¡æ‰¹äººä¸èƒ½è¿›è¡Œå®¡æ‰¹. è¿™æ˜¯ä¸€ä¸ªé”å®šæœºåˆ¶, åç«¯ä¸€èˆ¬ä½¿ç”¨ç±»ä¼¼å¿ƒè·³æœºåˆ¶æ¥ç»´æŠ¤è¿™ä¸ªâ€™é”â€™, è¿™ä¸ªé”å¯ä»¥æ˜¾å¼é‡Šæ”¾ï¼Œä¹Ÿå¯ä»¥åœ¨è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰æ¿€æ´»æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œæ¯”å¦‚é¡µé¢å…³é—­. æ‰€ä»¥å‰ç«¯é€šå¸¸ä¼šä½¿ç”¨è½®è¯¢æœºåˆ¶æ¥æ¿€æ´»é”.</p><p>ä¸€èˆ¬çš„å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> MyPage <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸€äº›æ¡ä»¶è§¦å‘, å¯èƒ½è¿˜è¦ç›‘å¬è¿™äº›æ¡ä»¶çš„å˜åŒ–ï¼Œç„¶ååœæ­¢åŠ é”è½®è¯¢. è¿™ä¸ªé€»è¾‘å®ç°èµ·æ¥æ¯”è¾ƒå•°å—¦</span></span><br><span class="line">    <span class="keyword">if</span> (someCondition) &#123;</span><br><span class="line">      <span class="keyword">this</span>.timer = setInterval(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// è½®è¯¢</span></span><br><span class="line">        tryLock();</span><br><span class="line">        <span class="comment">// é”™è¯¯å¤„ç†ï¼Œå¯ä»¥åŠ é”å¤±è´¥...</span></span><br><span class="line">      &#125;, <span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentWillUnmount() &#123;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.timer);</span><br><span class="line">    <span class="comment">// é¡µé¢å¸è½½æ—¶æ˜¾å¼é‡Šæ”¾</span></span><br><span class="line">    releaseLock();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidUpdate() &#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬æ¡ä»¶å˜åŒ–ï¼Œå¼€å§‹æˆ–åœæ­¢é”å®š</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšç€åŠŸèƒ½çš„è¿­ä»£, MyPage ä¼šå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿, è¿™æ—¶å€™ä½ å¼€å§‹è€ƒè™‘å°†è¿™äº›ä¸šåŠ¡é€»è¾‘æŠ½å–å‡ºå». ä¸€èˆ¬æƒ…å†µä¸‹é€šè¿‡é«˜é˜¶ç»„ä»¶æˆ–è€… hook æ¥å®ç°, ä½†éƒ½ä¸å¤Ÿçµæ´», æ¯”å¦‚<strong>æ¡ä»¶é”å®šè¿™ä¸ªåŠŸèƒ½å®ç°èµ·æ¥å°±æ¯”è¾ƒåˆ«æ‰­</strong>.</p><p>æœ‰æ—¶å€™è€ƒè™‘å°†ä¸šåŠ¡æŠ½è±¡æˆä¸ºç»„ä»¶, å¯èƒ½å¯ä»¥å·§å¦™åœ°è§£å†³æˆ‘ä»¬çš„é—®é¢˜, ä¾‹å¦‚ Locker:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * é”å®šå™¨</span><br><span class="line"> */</span><br><span class="line">const Locker: FC&lt;&#123; onError: err =&gt; boolean, id: string &#125;&gt; = props =&gt; &#123;</span><br><span class="line">  const &#123;id, onError&#125; = props</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let timer</span><br><span class="line">    const poll = () =&gt; &#123;</span><br><span class="line">      timer = setTimeout(async () =&gt; &#123;</span><br><span class="line">        // ...</span><br><span class="line">        // è½®è¯¢ï¼Œå¤„ç†å¼‚å¸¸ç­‰æƒ…å†µ</span><br><span class="line">      &#125;, 5000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    poll()</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      clearTimeout(timer)</span><br><span class="line">      releaseLock()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [id])</span><br><span class="line"></span><br><span class="line">  return null</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Locker</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;someCondition &amp;&amp; &lt;Locker id=&#123;<span class="keyword">this</span>.id&#125; onError=&#123;<span class="keyword">this</span>.handleError&#125;&gt;&lt;<span class="regexp">/Locker&gt;&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªè¦ç‚¹ï¼šæˆ‘ä»¬å°†ä¸€ä¸ªä¸šåŠ¡æŠ½è±¡ä¸ºäº†ä¸€ä¸ªç»„ä»¶åï¼Œä¸šåŠ¡é€»è¾‘æœ‰äº†å’Œç»„ä»¶ä¸€æ ·çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>ç°åœ¨ç»„ä»¶å†…éƒ¨åªéœ€å…³å¿ƒè‡ªèº«çš„é€»è¾‘ï¼Œæ¯”å¦‚åªå…³å¿ƒèµ„æºè¯·æ±‚å’Œé‡Šæ”¾(å³ How)ï¼Œè€Œä½•æ—¶è¿›è¡Œï¼Œä»€ä¹ˆæ¡ä»¶è¿›è¡Œ(å³ When)åˆ™ç”±çˆ¶çº§æ¥å†³å®š</strong>, è¿™æ ·å°±ç¬¦åˆäº†å•ä¸€èŒè´£åŸåˆ™ã€‚ ä¸Šé¢çš„ä¾‹å­çˆ¶çº§é€šè¿‡ JSX çš„æ¡ä»¶æ¸²æŸ“å°±å¯ä»¥åŠ¨æ€æ§åˆ¶é”å®š, æ¯”ä¹‹å‰çš„å®ç°ç®€å•äº†å¾ˆå¤š</p><p><br></p><hr><p><br></p><h2 id="4-hooks-å–ä»£é«˜é˜¶ç»„ä»¶"><a href="#4-hooks-å–ä»£é«˜é˜¶ç»„ä»¶" class="headerlink" title="4. hooks å–ä»£é«˜é˜¶ç»„ä»¶"></a>4. hooks å–ä»£é«˜é˜¶ç»„ä»¶</h2><p>ä¸ªäººè§‰å¾— hooks å¯¹äº React å¼€å‘æ¥è¯´æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ç‰¹æ€§, å®ƒæ”¹å˜äº†å¼€å‘çš„æ€ç»´å’Œæ¨¡å¼. é¦–å…ˆè¦é—®ä¸€ä¸‹, â€œå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜? å¸¦æ¥äº†ä»€ä¹ˆæ–°çš„ä¸œè¥¿?â€</p><p>hooks é¦–å…ˆæ˜¯è¦è§£å†³é«˜é˜¶ç»„ä»¶æˆ–è€… Render Props çš„ç—›ç‚¹çš„. å®˜æ–¹åœ¨â€™<strong>åŠ¨æœº</strong>â€˜ä¸Šå°±è¯´äº†:</p><ul><li><ol><li><strong>å¾ˆéš¾åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘</strong>:</li></ol><ul><li>é—®é¢˜: React æ¡†æ¶æœ¬èº«å¹¶æ²¡æœ‰æä¾›ä¸€ç§å°†å¯å¤ç”¨çš„é€»è¾‘æ³¨å…¥åˆ°ç»„ä»¶ä¸Šçš„æ–¹å¼/åŸè¯­. RenderProps å’Œé«˜é˜¶ç»„ä»¶åªæ˜¯â€™æ¨¡å¼å±‚é¢(æˆ–è€…è¯´è¯­è¨€å±‚é¢)â€™çš„ä¸œè¥¿:</li><li>æ­¤å‰çš„æ–¹æ¡ˆ: é«˜é˜¶ç»„ä»¶å’Œ Render Propsã€‚<strong>è¿™äº›æ–¹æ¡ˆéƒ½æ˜¯åŸºäºç»„ä»¶æœ¬èº«çš„æœºåˆ¶</strong><ul><li>é«˜é˜¶ç»„ä»¶å’Œ Render Props ä¼šé€ æˆå¤šä½™çš„èŠ‚ç‚¹åµŒå¥—. å³ Wrapper hell</li><li>éœ€è¦è°ƒæ•´ä½ çš„ç»„ä»¶ç»“æ„, ä¼šè®©ä»£ç å˜å¾—ç¬¨é‡, ä¸”éš¾ä»¥ç†è§£</li><li>é«˜é˜¶ç»„ä»¶å¤æ‚, éš¾ä»¥ç†è§£</li><li>æ­¤å‰é«˜é˜¶ç»„ä»¶ä¹Ÿè¦ ref è½¬å‘é—®é¢˜ç­‰ç­‰</li></ul></li><li><p>hooks å¦‚ä½•è§£å†³:</p><ul><li>å°†çŠ¶æ€é€»è¾‘ä»ç»„ä»¶ä¸­è„±ç¦», è®©ä»–å¯ä»¥è¢«å•ç‹¬çš„æµ‹è¯•å’Œå¤ç”¨.</li><li>hooks å¯ä»¥åœ¨ç»„ä»¶ä¹‹é—´å…±äº«, ä¸ä¼šå½±å“ç»„ä»¶çš„ç»“æ„</li></ul><p><br></p></li></ul></li><li><ol start="2"><li><strong>å¤æ‚çš„ç»„ä»¶éš¾ä»¥ç†è§£</strong>: å¤æ‚ç»„ä»¶çš„ç‰¹ç‚¹æ˜¯æœ‰ä¸€å¤§å †åˆ†æ•£çš„çŠ¶æ€é€»è¾‘å’Œå‰¯ä½œç”¨. ä¾‹å¦‚æ¯ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å¸¸å¸¸åŒ…å«ä¸€äº›äº’ä¸ç›¸å…³çš„é€»è¾‘, è¿™äº›äº’ä¸ç›¸å…³çš„é€»è¾‘ä¼šæ…¢æ…¢å˜æˆé¢æ¡å¼çš„ä»£ç , ä½†æ˜¯ä½ å‘ç°å¾ˆéš¾å†å¯¹å®ƒä»¬è¿›è¡Œæ‹†è§£, æ›´åˆ«è¯´æµ‹è¯•å®ƒä»¬</li></ol><ul><li>é—®é¢˜:<ul><li>å®é™…æƒ…å†µï¼Œæˆ‘ä»¬å¾ˆéš¾å°†è¿™äº›ç»„ä»¶åˆ†è§£æˆæ›´å°çš„ç»„ä»¶ï¼Œå› ä¸ºçŠ¶æ€åˆ°å¤„éƒ½æ˜¯ã€‚æµ‹è¯•å®ƒä»¬ä¹Ÿå¾ˆå›°éš¾ã€‚</li><li>ç»å¸¸å¯¼è‡´è¿‡åˆ†æŠ½è±¡, æ¯”å¦‚ redux, éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­è·³è½¬, éœ€è¦å¾ˆå¤šæ¨¡æ¿æ–‡ä»¶å’Œæ¨¡æ¿ä»£ç </li></ul></li><li>æ­¤å‰çš„è§£å†³æ–¹æ³•: é«˜é˜¶ç»„ä»¶å’Œ Render Props æˆ–è€…çŠ¶æ€ç®¡ç†å™¨. åˆ†å‰²æŠ½ç¦»é€»è¾‘å’Œ UI, åˆ‡å‰²æˆæ›´å°ç²’åº¦çš„ç»„ä»¶</li><li><p>hooks å¦‚ä½•è§£å†³: Hooks å…è®¸æ‚¨æ ¹æ®ç›¸å…³éƒ¨åˆ†(ä¾‹å¦‚è®¾ç½®è®¢é˜…æˆ–è·å–æ•°æ®)å°†ä¸€ä¸ªç»„ä»¶åˆ†å‰²æˆæ›´å°çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶åŸºäºç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¿›è¡Œåˆ†å‰²ã€‚ä½ è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ä¸ª reducer æ¥ç®¡ç†ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ï¼Œä»¥ä½¿å…¶æ›´åŠ å¯é¢„æµ‹</p><p><br></p></li></ul></li><li><ol start="3"><li>åŸºäº class çš„ç»„ä»¶å¯¹æœºå™¨å’Œç”¨æˆ·éƒ½ä¸å‹å¥½:</li></ol><ul><li>é—®é¢˜:<ul><li>å¯¹äºäºº: éœ€è¦ç†è§£ this, ä»£ç å†—é•¿</li><li>å¯¹äºæœºå™¨: ä¸å¥½ä¼˜åŒ–</li></ul></li><li>hooks å¦‚ä½•è§£å†³: å‡½æ•°å¼ç»„ä»¶</li><li>æ–°çš„é—®é¢˜: ä½ è¦äº†è§£é—­åŒ…</li></ul></li></ul><p><br></p><p>Hooks å¸¦æ¥çš„<strong>æ–°ä¸œè¥¿</strong>: <strong>hook æ—¨åœ¨è®©ç»„ä»¶çš„å†…éƒ¨é€»è¾‘ç»„ç»‡æˆå¯å¤ç”¨çš„æ›´å°å•å…ƒï¼Œè¿™äº›å•å…ƒå„è‡ªç»´æŠ¤ä¸€éƒ¨åˆ†ç»„ä»¶â€˜çŠ¶æ€å’Œé€»è¾‘â€™</strong>ã€‚</p><p><img alt="migrate to hooks" src="/images/04/hooks-transform.png" width="800"><br>å›¾ç‰‡æ¥æºäºtwitter(<a href="https://twitter.com/threepointone/status/1056594421079261185/photo/1?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1056594421079261185&amp;ref_url=https%3A%2F%2Fmedium.com%2Fmedia%2Fe55e7bcbf2d4912af7e539a2646388e2%3FpostId%3Dfdbde8803889" target="_blank" rel="noopener">@sunil Pai</a>)</p><ul><li><strong>ä¸€ç§æ–°çš„ç»„ä»¶ç¼–å†™æ–¹å¼</strong>. å’Œæ­¤å‰åŸºäº class æˆ–çº¯å‡½æ•°ç»„ä»¶çš„å¼€å‘æ–¹å¼ä¸å¤ªä¸€æ ·, hook æä¾›äº†æ›´ç®€æ´çš„ API å’Œä»£ç å¤ç”¨æœºåˆ¶, è¿™ä½¿å¾—ç»„ä»¶ä»£ç å˜å¾—æ›´ç®€çŸ­. ä¾‹å¦‚ ğŸ‘† ä¸Šå›¾å°±æ˜¯è¿ç§»åˆ° hooks çš„ä»£ç ç»“æ„å¯¹æ¯”, è¯»è€…ä¹Ÿå¯ä»¥çœ‹è¿™ä¸ªæ¼”è®²(<a href="https://www.youtube.com/watch?v=wXLf18DsV-I" target="_blank" rel="noopener">90% Cleaner React</a>).<br><br></li><li><strong>æ›´ç»†ç²’åº¦çš„çŠ¶æ€æ§åˆ¶(useState)</strong>. ä»¥å‰ä¸€ä¸ªç»„ä»¶åªæœ‰ä¸€ä¸ª setState é›†ä¸­å¼ç®¡ç†ç»„ä»¶çŠ¶æ€, <strong>ç°åœ¨ hooks åƒç»„ä»¶ä¸€æ ·, æ˜¯ä¸€ä¸ªé€»è¾‘å’ŒçŠ¶æ€çš„èšåˆå•å…ƒ. è¿™æ„å‘³ç€ä¸åŒçš„ hook å¯ä»¥ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€</strong>.<br><br></li><li><p><strong>ä¸ç®¡æ˜¯ hook è¿˜æ˜¯ç»„ä»¶ï¼Œéƒ½æ˜¯æ™®é€šå‡½æ•°</strong>.</p><ul><li><strong>ä»æŸç§ç¨‹åº¦ä¸Šçœ‹ç»„ä»¶å’Œ hooks æ˜¯åŒè´¨çš„(éƒ½åŒ…å«çŠ¶æ€å’Œé€»è¾‘)</strong>. ç»Ÿä¸€ä½¿ç”¨å‡½æ•°å½¢å¼å¼€å‘, è¿™ä½¿å¾—ä½ ä¸éœ€è¦åœ¨ç±»ã€é«˜é˜¶ç»„ä»¶æˆ–è€… renderProps ä¸Šä¸‹æ–‡ä¹‹é—´åˆ‡æ¢, é™ä½é¡¹ç›®çš„å¤æ‚åº¦. å¯¹äº React çš„æ–°æ‰‹æ¥è¯´ï¼Œå„ç§é«˜é˜¶ç»„ä»¶ã€render props å„ç§æ¦‚å¿µæ‹‰é«˜äº†å­¦ä¹ æ›²çº¿</li><li><strong>å‡½æ•°æ˜¯ä¸€ç§æœ€ç®€å•çš„ä»£ç å¤ç”¨å•å…ƒ, æœ€ç®€å•ä¹Ÿæ„å‘³ç€æ›´çµæ´»</strong>ã€‚ç›¸æ¯”ç»„ä»¶çš„ propsï¼Œå‡½æ•°çš„ä¼ å‚æ›´åŠ çµæ´»ï¼› å‡½æ•°ä¹Ÿæ›´å®¹æ˜“è¿›è¡Œç»„åˆ, hooks ç»„åˆå…¶ä»– hook æˆ–æ™®é€šå‡½æ•°æ¥å®ç°å¤æ‚é€»è¾‘.</li><li><strong>æœ¬è´¨ä¸Šè®²ï¼Œhooks å°±æ˜¯ç»™å‡½æ•°å¸¦æ¥äº†çŠ¶æ€çš„æ¦‚å¿µ</strong><br><br></li></ul></li><li><p><strong>é«˜é˜¶ç»„ä»¶ä¹‹é—´åªèƒ½ç®€å•åµŒå¥—å¤åˆ(compose), è€Œå¤šä¸ª hooks ä¹‹é—´æ˜¯å¹³é“ºçš„, å¯ä»¥å®šä¹‰æ›´å¤æ‚çš„å…³ç³»(ä¾èµ–)</strong>.<br><br></p></li><li><strong>æ›´å®¹æ˜“è¿›è¡Œé€»è¾‘å’Œè§†å›¾åˆ†ç¦»</strong>. hooks å¤©ç„¶éš”ç¦» JSX, è§†å›¾å’Œé€»è¾‘ä¹‹é—´çš„ç•Œé™æ¯”è¾ƒæ¸…æ™°, è¿™ä½¿å¾— hooks å¯ä»¥æ›´ä¸“æ³¨ç»„ä»¶çš„è¡Œä¸º.<br><br></li><li><strong>æ·¡åŒ–ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µ, å°†æœ¬æ¥åˆ†æ•£åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸçš„ç›¸å…³é€»è¾‘èšåˆèµ·æ¥</strong><br><br></li><li><strong>ä¸€ç‚¹ç‚¹â€™å“åº”å¼ç¼–ç¨‹â€™çš„å‘³é“</strong>, æ¯ä¸ª hooks éƒ½åŒ…å«ä¸€äº›çŠ¶æ€å’Œå‰¯ä½œç”¨ï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨ hooks ä¹‹é—´ä¼ é€’æµåŠ¨å’Œå“åº”ï¼Œ è§ä¸‹æ–‡<br><br></li><li><strong>è·¨å¹³å°çš„é€»è¾‘å¤ç”¨</strong>. è¿™æ˜¯æˆ‘è‡ªå·±å¼€çš„è„‘æ´, React hooks å‡ºæ¥ä¹‹å<a href="https://github.com/yyx990803" target="_blank" rel="noopener">å°¤é›¨æºª</a>å°±æ¨äº†ä¸€ä¸ª<a href="https://github.com/yyx990803/vue-hooks" target="_blank" rel="noopener">vue-hooks</a>è¯•éªŒé¡¹ç›®, å¦‚æœåé¢å‘å±•é¡ºåˆ©, hooks æ˜¯å¯èƒ½è¢«ç”¨äºè·¨æ¡†æ¶å¤ç”¨?</li></ul><p><br></p><p>ä¸€ä¸ª<strong>ç¤ºä¾‹</strong>: æ— é™åŠ è½½åˆ—è¡¨</p><iframe src="https://codesandbox.io/embed/rwq4opm70n?codemirror=1&fontsize=14&view=editor" title="useList" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><br></p><p>ä¸€èˆ¬ hooks çš„åŸºæœ¬ä»£ç ç»“æ„ä¸º:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useHook</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸states</span></span><br><span class="line">  <span class="keyword">const</span> [someState, setSomeState] = useState(initialValue);</span><br><span class="line">  <span class="comment">// âš›ï¸derived state</span></span><br><span class="line">  <span class="keyword">const</span> computedState = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> computed, [dependencies]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸refs</span></span><br><span class="line">  <span class="keyword">const</span> refSomething = useRef();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸side effect</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, []);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, [dependencies]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸state operations</span></span><br><span class="line">  <span class="keyword">const</span> handleChange = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setSomeState(newState)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸output</span></span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;&#123;...&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ hook å’Œå‡½æ•°ç»„ä»¶çš„ä»£ç ç»“æ„åŸºæœ¬ä¸€è‡´, æ‰€ä»¥æœ‰æ—¶å€™<strong>hooks å†™ç€å†™ç€åŸæ¥è¶Šåƒç»„ä»¶, ç»„ä»¶å†™ç€å†™ç€è¶Šåƒ hooks. æˆ‘è§‰å¾—å¯ä»¥è®¤ä¸ºç»„ä»¶å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ hook, åªä¸è¿‡å®ƒè¾“å‡º Virtual DOM</strong>.</p><p><br></p><p>ä¸€äº›<strong>æ³¨æ„äº‹é¡¹</strong>:</p><ul><li>åªèƒ½åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨ hooksã€‚ä¸è¦åœ¨å¾ªç¯ï¼Œæ§åˆ¶æµå’ŒåµŒå¥—çš„å‡½æ•°ä¸­è°ƒç”¨ hooks</li><li>åªèƒ½ä» React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ hooks</li><li>è‡ªå®šä¹‰ hooks ä½¿ç”¨ use*å‘½å</li></ul><p><br></p><p>æ€»ç»“ hooks çš„<strong>å¸¸ç”¨åœºæ™¯</strong>:</p><ul><li><strong>å‰¯ä½œç”¨å°è£…å’Œç›‘å¬</strong>: ä¾‹å¦‚ useWindowSize(ç›‘å¬çª—å£å¤§å°)ï¼ŒuseOnlineStatus(åœ¨çº¿çŠ¶æ€)</li><li><strong>å‰¯ä½œç”¨è¡ç”Ÿ</strong>: useEffect, useDebounce, useThrottle, useTitle, useSetTimeout</li><li><strong>DOM äº‹ä»¶å°è£…</strong>ï¼šuseActiveï¼ŒuseFocus, useDraggable, useTouch</li><li><strong>è·å– context</strong></li><li><strong>å°è£…å¯å¤ç”¨é€»è¾‘å’ŒçŠ¶æ€</strong>: useInput, usePromise(å¼‚æ­¥è¯·æ±‚), useList(åˆ—è¡¨åŠ è½½)<ul><li>å–ä»£é«˜é˜¶ç»„ä»¶å’Œ render Props. ä¾‹å¦‚ä½¿ç”¨ useRouter å–ä»£ withRouter, useSpring å–ä»£æ—§çš„ Spring Render Props ç»„ä»¶</li><li>å–ä»£å®¹å™¨ç»„ä»¶</li><li>çŠ¶æ€ç®¡ç†å™¨: use-global-hook, unstated</li></ul></li><li><strong>æ‰©å±•çŠ¶æ€æ“ä½œ</strong>: åŸå§‹çš„ useState å¾ˆç®€å•ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤§çš„æ‰©å±•ç©ºé—´ï¼Œä¾‹å¦‚ useSetState(æ¨¡æ‹Ÿæ—§çš„ setState), useToggle(boolean å€¼åˆ‡æ¢)ï¼ŒuseArray, useLocalStorage(åŒæ­¥æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨)</li><li>ç»§ç»­å¼€è„‘æ´â€¦: hooks çš„æ¢ç´¢è¿˜åœ¨<a href="https://usehooks.com/" target="_blank" rel="noopener">ç»§ç»­</a></li></ul><p>å­¦ä¹  hooks:</p><ul><li><a href="https://react.docschina.org/docs/hooks-overview.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://zhuanlan.zhihu.com/p/50597236" target="_blank" rel="noopener">ä¸€ç¯‡çœ‹æ‡‚ React Hooks</a></li><li><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM" target="_blank" rel="noopener">React Today and Tomorrow and 90% Cleaner React With Hooks</a></li><li><a href="https://www.hooks.guide/" target="_blank" rel="noopener">hook-guide</a></li><li><a href="https://zhuanlan.zhihu.com/p/50274018" target="_blank" rel="noopener">ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹</a></li><li><a href="https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889" target="_blank" rel="noopener">Making Sense of React Hooks</a></li><li><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a></li></ul><p><br></p><hr><p><br></p><h2 id="5-hooks-å®ç°å“åº”å¼ç¼–ç¨‹"><a href="#5-hooks-å®ç°å“åº”å¼ç¼–ç¨‹" class="headerlink" title="5. hooks å®ç°å“åº”å¼ç¼–ç¨‹"></a>5. hooks å®ç°<code>å“åº”å¼</code>ç¼–ç¨‹</h2><p><code>Vue</code>çš„éä¾µå…¥æ€§<a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener">å“åº”å¼ç³»ç»Ÿ</a>æ˜¯å…¶æœ€ç‹¬ç‰¹çš„ç‰¹æ€§ä¹‹ä¸€, å¯ä»¥æŒ‰ç…§ Javascript çš„æ•°æ®æ“ä½œä¹ æƒ¯æ¥æ“ä½œç»„ä»¶çŠ¶æ€ï¼Œ ç„¶åè‡ªåŠ¨å“åº”åˆ°é¡µé¢ä¸­. è€Œ React è¿™è¾¹åˆ™æä¾›äº† setState, å¯¹äºå¤æ‚çš„ç»„ä»¶çŠ¶æ€, setState ä¼šè®©ä»£ç å˜å¾—çš„åˆè‡­åˆé•¿. ä¾‹å¦‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">  pagination: &#123;</span><br><span class="line">    ...this.state.pagination,</span><br><span class="line">    current: defaultPagination.current || <span class="number">1</span>,</span><br><span class="line">    pageSize: defaultPagination.pageSize || <span class="number">15</span>,</span><br><span class="line">    total: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åæ¥æœ‰äº†<a href="https://cn.mobx.js.org" target="_blank" rel="noopener">mobx</a>, åŸºæœ¬æ¥è¿‘äº† Vue å¼€å‘ä½“éªŒ:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@observer</span></span><br><span class="line"><span class="keyword">class</span> TodoView <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@observable</span> loading: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@observable</span> error?: <span class="built_in">Error</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@observable</span> list: Item[] = [];</span><br><span class="line">  <span class="comment">// è¡ç”ŸçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@computed</span> <span class="keyword">get</span> completed() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.list.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.completed)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.load();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> render() &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> load() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.error = <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">this</span>.loading = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">await</span> fetchList()</span><br><span class="line">      <span class="keyword">this</span>.list = list</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">this</span>.error = err</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å® mobx ä¹Ÿæœ‰æŒºå¤šç¼ºç‚¹:</p><ul><li>ä»£ç ä¾µå…¥æ€§. æ‰€æœ‰éœ€è¦å“åº”æ•°æ®å˜åŠ¨çš„ç»„ä»¶éƒ½éœ€è¦ä½¿ç”¨ observer è£…é¥°, å±æ€§éœ€è¦ä½¿ç”¨ observable è£…é¥°, ä»¥åŠæ•°æ®æ“ä½œæ–¹å¼. å¯¹ mobx è€¦åˆè¾ƒæ·±, æ—¥ååˆ‡æ¢æ¡†æ¶æˆ–é‡æ„çš„æˆæœ¬å¾ˆé«˜</li><li><p>å…¼å®¹æ€§. mobx v5 åä½¿ç”¨ Proxy è¿›è¡Œé‡æ„, Proxy åœ¨ Chrome49 ä¹‹åæ‰æ”¯æŒ. å¦‚æœè¦å…¼å®¹æ—§ç‰ˆæµè§ˆå™¨åˆ™åªèƒ½ä½¿ç”¨ v4, v4 æœ‰ä¸€äº›<a href="https://cn.mobx.js.org/#mobx-4-vs-mobx-5" target="_blank" rel="noopener">å‘</a>, è¿™äº›å‘å¯¹äºä¸äº†è§£ mobx çš„æ–°æ‰‹å¾ˆéš¾å‘ç°:</p><ul><li>Observable æ•°ç»„å¹¶éçœŸæ­£çš„æ•°ç»„. æ¯”å¦‚ antd çš„ Table ç»„ä»¶å°±ä¸è®¤ mobx çš„æ•°ç»„, éœ€è¦ä¼ å…¥åˆ°ç»„ä»¶ä¹‹é—´ä½¿ç”¨ slice è¿›è¡Œè½¬æ¢</li><li>å‘ä¸€ä¸ªå·²å­˜åœ¨çš„ observable å¯¹è±¡ä¸­æ·»åŠ å±æ€§ä¸ä¼šè¢«è‡ªåŠ¨æ•è·</li></ul></li></ul><p><br></p><p>äºæ˜¯ hooks å‡ºç°äº†, å®ƒè®©ç»„ä»¶çš„çŠ¶æ€ç®¡ç†å˜å¾—æ›´ç®€å•ç›´æ¥, è€Œä¸”å®ƒçš„æ€æƒ³ä¹Ÿå¾ˆæ¥è¿‘ mobx å“åº”å¼ç¼–ç¨‹å“²å­¦:</p><p><img src="/images/04/mobx.png" alt="mobx"></p><p><br></p><ol><li>ç®€æ´åœ°å£°æ˜çŠ¶æ€</li></ol><p><strong>çŠ¶æ€</strong> æ˜¯é©±åŠ¨åº”ç”¨çš„æ•°æ®. ä¾‹å¦‚ UI çŠ¶æ€æˆ–è€…ä¸šåŠ¡é¢†åŸŸçŠ¶æ€</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;Item[]&gt;([]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>è¡ç”Ÿ</li></ol><p>ä»»ä½• æºè‡ªçŠ¶æ€å¹¶ä¸”ä¸ä¼šå†æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„ç›¸äº’ä½œç”¨çš„ä¸œè¥¿å°±æ˜¯è¡ç”Ÿã€‚åŒ…æ‹¬ç”¨æˆ·è§†å›¾, è¡ç”ŸçŠ¶æ€, å…¶ä»–å‰¯ä½œç”¨</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props: &#123; id: <span class="built_in">string</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = props;</span><br><span class="line">  <span class="comment">// å–ä»£mobxçš„observable: è·å–åˆ—è¡¨, åœ¨æŒ‚è½½æˆ–idå˜åŠ¨æ—¶è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue, loading, error, retry] = usePromise(</span><br><span class="line">    <span class="keyword">async</span> id =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> getList(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [id],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ç”ŸçŠ¶æ€: å–ä»£mobxçš„computed</span></span><br><span class="line">  <span class="keyword">const</span> unreads = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> value.filter(<span class="function"><span class="params">i</span> =&gt;</span> !i.readed), [value]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ç”Ÿå‰¯ä½œç”¨: valueå˜åŠ¨åè‡ªåŠ¨æŒä¹…åŒ–</span></span><br><span class="line">  useDebounce(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      saveList(id, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">1000</span>,</span><br><span class="line">    [value],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ç”Ÿè§†å›¾</span></span><br><span class="line">  <span class="keyword">return</span> &lt;List data=&#123;value&#125; onChange=&#123;setValue&#125; error=&#123;error&#125; loading=&#123;loading&#125; retry=&#123;retry&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/04/hook-stream.png" width="400"></p><p>æ‰€ä»¥è¯´ hook æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ä¸œè¥¿, å®ƒå¯ä»¥è®©ç»„ä»¶çš„çŠ¶æ€æ•°æ®æµæ›´åŠ æ¸…æ™°. æ¢åš class ç»„ä»¶, æˆ‘ä»¬é€šå¸¸çš„åšæ³•å¯èƒ½æ˜¯åœ¨ <code>componentDidUpdate</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è¿›è¡Œæ•°æ®æ¯”è¾ƒ, ç„¶åå‘½ä»¤å¼åœ°è§¦å‘ä¸€äº›æ–¹æ³•. æ¯”å¦‚ id å˜åŒ–æ—¶è§¦å‘ getList, list å˜åŒ–æ—¶è¿›è¡Œ saveList.</p><p><strong>hook ä¼¼ä¹åœ¨æ·¡åŒ–ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µ, è®©å¼€å‘è€…æ›´ä¸“æ³¨äºçŠ¶æ€çš„å…³ç³», ä»¥æ•°æ®æµçš„æ–¹å¼æ¥æ€è€ƒç»„ä»¶çš„å¼€å‘</strong>. <a href="https://mobile.twitter.com/dan_abramov" target="_blank" rel="noopener">Dan Abramov</a>åœ¨<a href="https://overreacted.io/zh-hans/writing-resilient-components/" target="_blank" rel="noopener">ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</a>ä¹Ÿæåˆ°äº†ä¸€ä¸ªåŸåˆ™â€ä¸è¦é˜»æ–­æ•°æ®æµâ€, è¯å®äº†ç¬”è€…çš„æƒ³æ³•:</p><blockquote><p>æ— è®ºä½•æ—¶ä½¿ç”¨ props å’Œ stateï¼Œè¯·è€ƒè™‘å¦‚æœå®ƒä»¬å‘ç”Ÿå˜åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸åº”ä»¥ä¸åŒæ–¹å¼å¤„ç†åˆå§‹æ¸²æŸ“å’Œæ›´æ–°æµç¨‹ã€‚è¿™ä½¿å®ƒèƒ½å¤Ÿé€‚åº”é€»è¾‘ä¸Šçš„å˜åŒ–ã€‚</p></blockquote><p>è¯»è€…å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://github.com/rehooks/awesome-react-hooks" target="_blank" rel="noopener">awesome-react-hooks</a>, è¿™äº›å¼€æºçš„ hook æ–¹æ¡ˆéƒ½æŒºæœ‰æ„æ€. ä¾‹å¦‚<a href="https://github.com/LeetCode-OpenSource/rxjs-hooks" target="_blank" rel="noopener">rxjs-hooks</a>, å·§å¦™åœ°å°† react hooks å’Œ rxjs ç»“åˆçš„èµ·æ¥:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">props: &#123; foo: <span class="built_in">number</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å“åº”propsçš„å˜åŠ¨</span></span><br><span class="line">  <span class="keyword">const</span> value = useObservable(inputs$ =&gt; inputs$.pipe(map(<span class="function">(<span class="params">[val]</span>) =&gt;</span> val + <span class="number">1</span>)), <span class="number">200</span>, [props.foo]);</span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;&#123;value&#125;&lt;<span class="regexp">/h1&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h2 id="6-ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„"><a href="#6-ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„" class="headerlink" title="6. ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„"></a>6. ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„</h2><p>å°±å¦‚ react å®˜æ–¹æ–‡æ¡£è¯´çš„: â€œæˆ‘ä»¬çš„ React ä½¿ç”¨äº†æ•°ä»¥åƒè®¡çš„ç»„ä»¶ï¼Œç„¶è€Œå´è¿˜æœªå‘ç°ä»»ä½•éœ€è¦æ¨èä½ ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µã€‚â€, React åå‘äºå‡½æ•°å¼ç¼–ç¨‹çš„ç»„åˆæ¨¡å¼, é¢å‘å¯¹è±¡çš„ç»§æ‰¿å®é™…çš„åº”ç”¨åœºæ™¯å¾ˆå°‘.</p><p>å½“æˆ‘ä»¬éœ€è¦å°†ä¸€äº›ä¼ ç»Ÿçš„ç¬¬ä¸‰æ–¹åº“è½¬æ¢æˆ React ç»„ä»¶åº“æ—¶, ç»§æ‰¿å°±å¯èƒ½æ´¾ä¸Šç”¨åœº. å› ä¸ºè¿™äº›åº“å¤§éƒ¨åˆ†æ˜¯ä½¿ç”¨é¢å‘å¯¹è±¡çš„èŒƒå¼æ¥ç»„ç»‡çš„, æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯åœ°å›¾ SDK. ä»¥<a href="http://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference_3_0.html" target="_blank" rel="noopener">ç™¾åº¦åœ°å›¾</a>ä¸ºä¾‹:</p><p><img src="/images/04/overlay.png" alt="baidu overlay"></p><p>ç™¾åº¦åœ°å›¾æœ‰å„ç§ç»„ä»¶ç±»å‹: controls, overlays, tileLayers. è¿™äº›ç±»å‹éƒ½æœ‰å¤šä¸ªå­ç±», å¦‚ä¸Šå›¾, overlay æœ‰ Label, Marker, Polyline ç­‰è¿™äº›å­ç±», ä¸”è¿™äº›å­ç±»æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ, éƒ½æ˜¯é€šè¿‡ addOverlay æ–¹æ³•æ¥æ¸²æŸ“åˆ°åœ°å›¾ç”»å¸ƒä¸Š. æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å°†ä»–ä»¬ç”Ÿå‘½å‘¨æœŸç®¡ç†æŠ½å–åˆ°çˆ¶ç±»ä¸Š, ä¾‹å¦‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// OverlayæŠ½è±¡ç±», è´Ÿè´£ç®¡ç†Overlayçš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">abstract</span> <span class="keyword">class</span> Overlay&lt;P&gt; <span class="keyword">extends</span> React.PureComponent&lt;OverlayProps &amp; P&gt; &#123;</span><br><span class="line">  <span class="keyword">protected</span> initialize?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// å­ç±»åœ¨constructoræˆ–initializeæ–¹æ³•ä¸­è¿›è¡Œå®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.initialize) &#123;</span><br><span class="line">      <span class="keyword">this</span>.initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.instance &amp;&amp; <span class="keyword">this</span>.context) &#123;</span><br><span class="line">      <span class="comment">// æ¸²æŸ“åˆ°Mapç”»å¸ƒä¸­</span></span><br><span class="line">      <span class="keyword">this</span>.context.nativeInstance!.addOverlay(<span class="keyword">this</span>.instance);</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–å‚æ•°</span></span><br><span class="line">      <span class="keyword">this</span>.initialProperties();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidUpdate(prevProps: P &amp; OverlayProps) &#123;</span><br><span class="line">    <span class="comment">// å±æ€§æ›´æ–°</span></span><br><span class="line">    <span class="keyword">this</span>.updateProperties(prevProps);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentWillUnmount() &#123;</span><br><span class="line">    <span class="comment">// ç»„ä»¶å¸è½½</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.instance &amp;&amp; <span class="keyword">this</span>.context) &#123;</span><br><span class="line">      <span class="keyword">this</span>.context.nativeInstance!.removeOverlay(<span class="keyword">this</span>.instance);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// å…¶ä»–é€šç”¨æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">private</span> forceReloadIfNeed(props: P, prevProps: P) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­ç±»çš„å·¥ä½œå°±å˜å¾—ç®€å•å¾ˆå¤š, å£°æ˜è‡ªå·±çš„å±æ€§/äº‹ä»¶å’Œå®ä¾‹åŒ–å…·ä½“ç±»:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Label <span class="keyword">extends</span> Overlay&lt;LabelProps&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    enableMassClear: <span class="literal">true</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">props: LabelProps</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">const</span> &#123; position, content &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="comment">// å£°æ˜æ”¯æŒçš„å±æ€§å’Œå›è°ƒ</span></span><br><span class="line">    <span class="keyword">this</span>.extendedProperties = PROPERTIES;</span><br><span class="line">    <span class="keyword">this</span>.extendedEnableableProperties = ENABLEABLE_PROPERTIES;</span><br><span class="line">    <span class="keyword">this</span>.extendedEvents = EVENTS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–å…·ä½“ç±»</span></span><br><span class="line">    <span class="keyword">this</span>.instance = <span class="keyword">new</span> BMap.Label(content, &#123;</span><br><span class="line">      position,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»£ç æ¥æºäº <a href="https://github.com/ivan-94/react-bdmap" target="_blank" rel="noopener">react-bdmap</a></p></blockquote><p>å½“ç„¶è¿™ä¸ªä¸æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ³•, ä½¿ç”¨é«˜é˜¶ç»„ä»¶å’Œ hooks åŒæ ·èƒ½å¤Ÿå®ç°. åªä¸è¿‡å¯¹äºåŸæœ¬å°±é‡‡ç”¨é¢å‘å¯¹è±¡èŒƒå¼ç»„ç»‡çš„åº“, ä½¿ç”¨ç»§æ‰¿æ–¹å¼ä¼šæ›´åŠ å¥½ç†è§£</p><p><br></p><hr><p><br></p><h2 id="7-æ¨¡æ€æ¡†ç®¡ç†"><a href="#7-æ¨¡æ€æ¡†ç®¡ç†" class="headerlink" title="7. æ¨¡æ€æ¡†ç®¡ç†"></a>7. æ¨¡æ€æ¡†ç®¡ç†</h2><p><img src="/images/04/modal-demo.png" alt="modal demo"></p><p>æ¨¡æ€æ¡†æ˜¯åº”ç”¨å¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ç»„ä»¶ï¼Œå°¤å…¶åœ¨ä¸­åå°ç®¡ç†ç³»ç»Ÿä¸­. ä½†æ˜¯åœ¨ React ä¸­ç”¨ç€å¹¶ä¸æ˜¯ç‰¹åˆ«çˆ½, å…¸å‹çš„ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Demo: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  const [visible, setVisible] = useState(false);</span><br><span class="line">  const [editing, setEditing] = useState();</span><br><span class="line">  const handleCancel = () =&gt; &#123;</span><br><span class="line">    setVisible(false);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const prepareEdit = async (item: Item) =&gt; &#123;</span><br><span class="line">    // åŠ è½½è¯¦æƒ…</span><br><span class="line">    const detail = await loadingDeatil(item.id);</span><br><span class="line">    setEditing(detail);</span><br><span class="line">    setVisible(true);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleOk = async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const values = await form.validate();</span><br><span class="line">      // ä¿å­˜</span><br><span class="line">      await save(editing.id, values);</span><br><span class="line">      // éšè—</span><br><span class="line">      setVisible(false);</span><br><span class="line">    &#125; catch &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return;</span><br><span class="line">  &lt;&gt;</span><br><span class="line">    &lt;Table</span><br><span class="line">      dataSource=&#123;list&#125;</span><br><span class="line">      columns=&#123;[</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æ“ä½œ&apos;,</span><br><span class="line">          render: item =&gt; &#123;</span><br><span class="line">            return &lt;a onClick=&#123;() =&gt; prepareEdit(item)&#125;&gt;ç¼–è¾‘&lt;/a&gt;;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ]&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;Modal visible=&#123;visible&#125; onOk=&#123;handleOk&#125; onCancel=&#123;handleHide&#125;&gt;</span><br><span class="line">      &#123;/* è¡¨å•æ¸²æŸ“ */&#125;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  &lt;/&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å¤ªä¸‘äº†ï¼Œ ä¸ç›¸å…³é€»è¾‘å †ç§¯åœ¨ä¸€ä¸ªç»„ä»¶ä¸‹ ï¼Œä¸ç¬¦åˆå•ä¸€èŒè´£. æ‰€ä»¥æˆ‘ä»¬è¦å°†æ¨¡æ€æ¡†ç›¸å…³ä»£ç æŠ½å–å‡ºå», æ”¾åˆ° EditModal ä¸­:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const EditModal: FC&lt;&#123; id?: string; visible: boolean; onCancel: () =&gt; void; onOk: () =&gt; void &#125;&gt; = props =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  const &#123; visible, id, onHide, onOk &#125; = props;</span><br><span class="line">  const detail = usePromise(async (id: string) =&gt; &#123;</span><br><span class="line">    return loadDetail(id);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (id != null) &#123;</span><br><span class="line">      detail.call(id);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [id]);</span><br><span class="line"></span><br><span class="line">  const handleOk = () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const values = await form.validate();</span><br><span class="line">      // ä¿å­˜</span><br><span class="line">      await save(editing.id, values);</span><br><span class="line">      onOk();</span><br><span class="line">    &#125; catch &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Modal visible=&#123;visible&#125; onOk=&#123;onOk&#125; onCancel=&#123;onCancel&#125;&gt;</span><br><span class="line">      &#123;detail.value &amp;&amp;</span><br><span class="line">        &#123;</span><br><span class="line">          /* è¡¨å•æ¸²æŸ“ */</span><br><span class="line">        &#125;&#125;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä½¿ç”¨</span><br><span class="line"> */</span><br><span class="line">const Demo: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  const [visible, setVisible] = useState(false);</span><br><span class="line">  const [editing, setEditing] = useState&lt;string | undefined&gt;(undefined);</span><br><span class="line">  const handleHide = () =&gt; &#123;</span><br><span class="line">    setVisible(false);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const prepareEdit = async (item: Item) =&gt; &#123;</span><br><span class="line">    setEditing(item.id);</span><br><span class="line">    setVisible(true);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return;</span><br><span class="line">  &lt;&gt;</span><br><span class="line">    &lt;Table</span><br><span class="line">      dataSource=&#123;list&#125;</span><br><span class="line">      columns=&#123;[</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æ“ä½œ&apos;,</span><br><span class="line">          render: item =&gt; &#123;</span><br><span class="line">            return &lt;a onClick=&#123;() =&gt; prepareEdit(item)&#125;&gt;ç¼–è¾‘&lt;/a&gt;;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ]&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;EditModal id=&#123;editing&#125; visible=&#123;visible&#125; onOk=&#123;handleHide&#125; onCancel=&#123;handleHide&#125;&gt;</span><br><span class="line">      &#123;&apos; &apos;&#125;</span><br><span class="line">    &lt;/EditModal&gt;</span><br><span class="line">  &lt;/&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç¼–è¾‘ç›¸å…³çš„é€»è¾‘æŠ½å–åˆ°äº† EditModal ä¸Šï¼Œä½†æ˜¯ Demo ç»„ä»¶è¿˜è¦ç»´æŠ¤æ¨¡æ€æ¡†çš„æ‰“å¼€çŠ¶æ€å’Œä¸€äº›æ•°æ®çŠ¶æ€ã€‚ä¸€ä¸ªå¤æ‚çš„é¡µé¢å¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¨¡æ€æ¡†ï¼Œè¿™æ ·çš„ä»£ç ä¼šå˜å¾—è¶Šæ¥è¶Šæ¶å¿ƒï¼Œ å„ç§ xxxVisible çŠ¶æ€æ»¡å¤©é£. ä»å®é™…å¼€å‘è§’åº¦ä¸Šå°†ï¼Œæ¨¡æ€æ¡†æ§åˆ¶çš„æœ€ç®€å•çš„æ–¹å¼åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const handleEdit = item =&gt; &#123;</span><br><span class="line">  EditModal.show(&#123;</span><br><span class="line">    // ğŸ”´ é€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼å‡ºå‘å¼¹çª—. è¿™ç¬¦åˆå¯¹æ¨¡æ€æ¡†çš„ä¹ æƒ¯ç”¨æ³•, ä¸å…³å¿ƒæ¨¡æ€æ¡†çš„å¯è§çŠ¶æ€. ä¾‹å¦‚window.confirm, wx.showModal().</span><br><span class="line">    id: item.id, // ğŸ”´ ä¼ é€’æ•°æ®ç»™æ¨¡æ€æ¡†</span><br><span class="line">    onOk: saved =&gt; &#123;</span><br><span class="line">      // ğŸ”´ äº‹ä»¶å›è°ƒ</span><br><span class="line">      refreshList(saved);</span><br><span class="line">    &#125;,</span><br><span class="line">    onCancel: async () =&gt; &#123;</span><br><span class="line">      return confirm(&apos;ç¡®è®¤å–æ¶ˆ&apos;); // æ§åˆ¶æ¨¡æ€æ¡†æ˜¯å¦éšè—</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼åœ¨ç¤¾åŒºä¸Šä¹Ÿæ˜¯æœ‰äº‰è®®çš„ï¼Œæœ‰äº›äººè®¤ä¸ºè¿™æ˜¯ React çš„åæ¨¡å¼ï¼Œ<a href="https://www.zhihu.com/people/yu-san-geng" target="_blank" rel="noopener">@æ¬²ä¸‰æ›´</a>åœ¨<a href="https://zhuanlan.zhihu.com/p/54492049" target="_blank" rel="noopener">Modal.confirm è¿åäº† React çš„æ¨¡å¼å—ï¼Ÿ</a>å°±æ¢è®¨äº†è¿™ä¸ªé—®é¢˜ã€‚ ä»¥å›¾ä¸ºä¾‹ï¼š</p><p><img src="/images/04/modal-confirm.jpg" alt="modal confirm"></p><p>çº¢çº¿è¡¨ç¤ºæ—¶é—´é©±åŠ¨(æˆ–è€…è¯´æ—¶æœºé©±åŠ¨), è“çº¿è¡¨ç¤ºæ•°æ®é©±åŠ¨ã€‚æ¬²ä¸‰æ›´è®¤ä¸ºâ€œå“ªæ€•ä¸€ä¸ªå¸¦æœ‰æ˜æ˜¾æ•°æ®é©±åŠ¨ç‰¹è‰²çš„ React é¡¹ç›®ï¼Œä¹Ÿå­˜åœ¨å¾ˆå¤šéƒ¨åˆ†ä¸æ˜¯æ•°æ®é©±åŠ¨è€Œæ˜¯äº‹ä»¶é©±åŠ¨çš„. æ•°æ®åªèƒ½é©±åŠ¨å‡ºçŠ¶æ€ï¼Œåªæœ‰æ—¶æœºæ‰èƒ½é©±åŠ¨å‡ºè¡Œä¸º, å¯¹äºä¸€ä¸ªæ—¶æœºé©±åŠ¨çš„è¡Œä¸ºï¼Œä½ éå¾—æŠŠå®ƒç¡¬å³æˆä¸€ä¸ªæ•°æ®é©±åŠ¨çš„çŠ¶æ€ï¼Œä½ ä¸è§‰å¾—å¾ˆå¥‡æ€ªå—?â€. ä»–çš„è§‚ç‚¹æ­£ä¸æ­£ç¡®ç¬”è€…ä¸åšè¯„åˆ¤, ä½†æ˜¯æŸäº›åœºæ™¯ä¸¥æ ¼è¦æ±‚â€˜æ•°æ®é©±åŠ¨â€™ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¨¡æ¿ä»£ç ï¼Œå†™ç€ä¼šå¾ˆéš¾å—.</p><p>So æ€ä¹ˆå®ç°?</p><p>å¯ä»¥å‚è€ƒ antd <a href="https://github.com/ant-design/ant-design/blob/master/components/modal/confirm.tsx" target="_blank" rel="noopener">Modal.confirm</a>çš„å®ç°, å®ƒä½¿ç”¨<code>ReactDOM.render</code>æ¥è¿›è¡Œå¤–æŒ‚æ¸²æŸ“ï¼Œä¹Ÿæœ‰äººä½¿ç”¨<a href="https://medium.com/@BogdanSoare/how-to-use-reacts-new-context-api-to-easily-manage-modals-2ae45c7def81" target="_blank" rel="noopener">Context API</a>æ¥å®ç°çš„. ç¬”è€…è®¤ä¸ºæ¯”è¾ƒæ¥è¿‘ç†æƒ³çš„(è‡³å°‘ API ä¸Šçœ‹)æ˜¯<a href="https://github.com/haradakunihiko/react-confirm" target="_blank" rel="noopener">react-comfirm</a>è¿™æ ·çš„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * EditModal.tsx</span><br><span class="line"> */</span><br><span class="line">import &#123; confirmable &#125; from &apos;react-confirm&apos;;</span><br><span class="line">const EditModal = props =&gt; &#123;</span><br><span class="line">  /*...*/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default confirmable(EditModal);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  Demo.tsx</span><br><span class="line"> */</span><br><span class="line">import EditModal from &apos;./EditModal&apos;;</span><br><span class="line"></span><br><span class="line">const showEditModal = createConfirmation(EditModal);</span><br><span class="line"></span><br><span class="line">const Demo: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  const prepareEdit = async (item: Item) =&gt; &#123;</span><br><span class="line">    showEditModal(&#123;</span><br><span class="line">      id: item.id, // ğŸ”´ ä¼ é€’æ•°æ®ç»™æ¨¡æ€æ¡†</span><br><span class="line">      onOk: saved =&gt; &#123;</span><br><span class="line">        // ğŸ”´ äº‹ä»¶å›è°ƒ</span><br><span class="line">        refreshList(saved);</span><br><span class="line">      &#125;,</span><br><span class="line">      onCancel: async someValues =&gt; &#123;</span><br><span class="line">        return confirm(&apos;ç¡®è®¤å–æ¶ˆ&apos;); // æ§åˆ¶æ¨¡æ€æ¡†æ˜¯å¦éšè—</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ReactDOM.render</code>å¤–æŒ‚æ¸²æŸ“å½¢å¼çš„ç¼ºç‚¹å°±æ˜¯æ— æ³•è®¿é—® Contextï¼Œæ‰€ä»¥è¿˜æ˜¯è¦å¦¥åä¸€ä¸‹ï¼Œç»“åˆ Context API æ¥å®ç°ç¤ºä¾‹ï¼š</p><iframe src="https://codesandbox.io/embed/lryom9617l?autoresize=1&fontsize=14" title="useModal" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>æ‰©å±•</p><ul><li><a href="https://github.com/ant-design/ant-design/blob/master/components/modal/confirm.tsx" target="_blank" rel="noopener">Modal.confirm</a></li><li><a href="https://zhuanlan.zhihu.com/p/54492049" target="_blank" rel="noopener">Modal.confirm è¿åäº† React çš„æ¨¡å¼å—ï¼Ÿ</a></li><li><a href="https://www.zhihu.com/search?type=content&amp;q=react%20modal" target="_blank" rel="noopener">ä½¿ç”¨ render props æŠ½è±¡ Modal ç»„ä»¶çš„çŠ¶æ€</a></li><li><a href="https://github.com/haradakunihiko/react-confirm" target="_blank" rel="noopener">react-confirm</a></li><li><a href="https://medium.com/@BogdanSoare/how-to-use-reacts-new-context-api-to-easily-manage-modals-2ae45c7def81" target="_blank" rel="noopener">How to use Reactâ€™s new Context API to easily manage modals</a> åŸºäº Context çš„æ–¹æ¡ˆ</li></ul><p><br></p><hr><p><br></p><h2 id="8-ä½¿ç”¨-context-è¿›è¡Œä¾èµ–æ³¨å…¥"><a href="#8-ä½¿ç”¨-context-è¿›è¡Œä¾èµ–æ³¨å…¥" class="headerlink" title="8. ä½¿ç”¨ Context è¿›è¡Œä¾èµ–æ³¨å…¥"></a>8. ä½¿ç”¨ Context è¿›è¡Œä¾èµ–æ³¨å…¥</h2><p>Context ä¸ºç»„ä»¶æ ‘æä¾›äº†ä¸€ä¸ªä¼ é€’æ•°æ®çš„æ–¹æ³•ï¼Œä»è€Œé¿å…äº†åœ¨æ¯ä¸€ä¸ªå±‚çº§æ‰‹åŠ¨çš„ä¼ é€’ props å±æ€§.</p><p>Context åœ¨ React åº”ç”¨ä¸­ä½¿ç”¨éå¸¸é¢‘ç¹, æ–°çš„<a href="https://react.docschina.org/docs/context.html#when-to-use-context" target="_blank" rel="noopener">Context API</a>ä¹Ÿéå¸¸æ˜“ç”¨. Context å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯:</p><ul><li><strong>å…±äº«é‚£äº›è¢«è®¤ä¸ºå¯¹äºä¸€ä¸ªâ€™ç»„ä»¶æ ‘â€™è€Œè¨€æ˜¯â€œå…¨å±€â€çš„æ•°æ®</strong>. å¦‚å½“å‰è®¤è¯çš„ç”¨æˆ·, ä¸»é¢˜, i18n é…ç½®, è¡¨å•çŠ¶æ€</li><li><strong>ç»„ä»¶é…ç½®</strong>. é…ç½®ç»„ä»¶çš„è¡Œä¸º, å¦‚ antd çš„ ConfigProvider</li><li><strong>è·¨ç»„ä»¶é€šä¿¡</strong>. ä¸æ¨èé€šè¿‡â€™äº‹ä»¶â€™è¿›è¡Œé€šä¿¡, è€Œæ˜¯é€šè¿‡â€™çŠ¶æ€â€™è¿›è¡Œé€šä¿¡</li><li><strong>ä¾èµ–æ³¨å…¥</strong></li><li><strong>çŠ¶æ€ç®¡ç†å™¨</strong>. Context ç»è¿‡ä¸€äº›å°è£…å¯ä»¥åŸºæœ¬å–ä»£ Redux å’Œ Mobx è¿™äº›çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ. åç»­æœ‰ä¸“é—¨æ–‡ç« ä»‹ç»</li></ul><p>Context çš„ä½œç”¨åŸŸæ˜¯å­æ ‘, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Context Provider å¯ä»¥åº”ç”¨äºå¤šä¸ªå­æ ‘, å­æ ‘çš„ Provider ä¹Ÿå¯ä»¥è¦†ç›–çˆ¶çº§çš„ Provider çš„ value. åŸºæœ¬ç»“æ„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;useState, useContext&#125; from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">export inteface MyContextValue &#123;</span><br><span class="line">  state: number</span><br><span class="line">  setState: (state: number) =&gt; void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const MyContext = React.createContext&lt;MyContextValue&gt;(</span><br><span class="line">  &#123;</span><br><span class="line">    state: 1,</span><br><span class="line">    // è®¾ç½®é»˜è®¤å€¼, æŠ›å‡ºé”™è¯¯, å¿…é¡»é…åˆProviderä½¿ç”¨</span><br><span class="line">    setState: () =&gt; throw new Error(&apos;è¯·æ±‚MyContextProviderç»„ä»¶ä¸‹çº§è°ƒç”¨&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export const MyContextProvider: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  const [state, setState] = useState(1)</span><br><span class="line">  return &lt;MyContext.Provider value=&#123;&#123;state, setState&#125;&#125;&gt;&#123;props.children&#125;&lt;/MyContext.Provider&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function useMyContext() &#123;</span><br><span class="line">  return useContext(MyContext)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default MyContextProvider</span><br></pre></td></tr></table></figure><blockquote><p>Context é»˜è®¤å€¼ä¸­çš„æ–¹æ³•åº”è¯¥æŠ›å‡ºé”™è¯¯, è­¦å‘Šä¸è§„èŒƒçš„ä½¿ç”¨</p></blockquote><p>æ‰©å±•ï¼š</p><ul><li><a href="https://zhuanlan.zhihu.com/p/50336226" target="_blank" rel="noopener">é¿å… React Context å¯¼è‡´çš„é‡å¤æ¸²æŸ“</a></li></ul><p><br></p><hr><p><br></p><h2 id="9-ä¸å¯å˜çš„çŠ¶æ€"><a href="#9-ä¸å¯å˜çš„çŠ¶æ€" class="headerlink" title="9. ä¸å¯å˜çš„çŠ¶æ€"></a>9. ä¸å¯å˜çš„çŠ¶æ€</h2><p>å¯¹äºå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼çš„ React æ¥è¯´ï¼Œä¸å¯å˜çŠ¶æ€æœ‰é‡è¦çš„æ„ä¹‰.</p><ul><li><p>ä¸å¯å˜æ•°æ®å…·æœ‰å¯é¢„æµ‹æ€§ã€‚ å¯ä¸å˜æ•°æ®å¯ä»¥è®©åº”ç”¨æ›´å¥½è°ƒè¯•ï¼Œå¯¹è±¡çš„å˜æ›´æ›´å®¹æ˜“è¢«è·Ÿè¸ªå’Œæ¨å¯¼.<br>å°±æ¯”å¦‚ Redux, å®ƒè¦æ±‚åªèƒ½é€šè¿‡ dispatch+reducer è¿›è¡ŒçŠ¶æ€å˜æ›´ï¼Œé…åˆå®ƒçš„ Devtool å¯ä»¥å¾ˆå¥½çš„è·Ÿè¸ªçŠ¶æ€æ˜¯å¦‚ä½•è¢«å˜æ›´çš„. è¿™ä¸ªç‰¹æ€§å¯¹äºå¤§å‹åº”ç”¨æ¥è¯´æ„ä¹‰é‡å¤§ï¼Œå› ä¸ºå®ƒçš„çŠ¶æ€éå¸¸å¤æ‚ï¼Œå¦‚æœä¸åŠ ä»¥ç»„ç»‡å’Œçº¦æŸï¼Œä½ ä¸çŸ¥é“æ˜¯å“ªä¸ªåœ°æ–¹ä¿®æ”¹äº†çŠ¶æ€ï¼Œ å‡ºç° bug æ—¶å¾ˆéš¾è·Ÿè¸ª.</p><p>æ‰€ä»¥è¯´å¯¹äºä¸¥æ ¼è¦æ±‚å•å‘æ•°æ®æµçš„çŠ¶æ€ç®¡ç†å™¨(Redux)æ¥è¯´ï¼Œä¸å¯å˜æ•°æ®æ˜¯åŸºæœ¬è¦æ±‚ï¼Œå®ƒè¦æ±‚æ•´ä¸ªåº”ç”¨ç”±ä¸€ä¸ªå•ä¸€çš„çŠ¶æ€è¿›è¡Œæ˜ å°„ï¼Œä¸å¯å˜æ•°æ®å¯ä»¥è®©æ•´ä¸ªåº”ç”¨å˜å¾—å¯è¢«é¢„æµ‹.</p></li><li><p>ä¸å¯å˜æ•°æ®è¿˜ä½¿ä¸€äº›å¤æ‚çš„åŠŸèƒ½æ›´å®¹æ˜“å®ç°ã€‚é¿å…æ•°æ®æ”¹å˜ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå®‰å…¨ä¿ç•™å¯¹æ—§æ•°æ®çš„å¼•ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°æ’¤é”€é‡åšï¼Œæˆ–è€…æ—¶é—´æ—…è¡Œè¿™äº›åŠŸèƒ½</p></li><li>å¯ä»¥ç²¾ç¡®åœ°è¿›è¡Œé‡æ–°æ¸²æŸ“åˆ¤æ–­ã€‚å¯ä»¥ç®€åŒ– shouldComponentUpdate æ¯”è¾ƒã€‚</li></ul><p>å®ç°ä¸å¯å˜æ•°æ®çš„æµè¡Œæ–¹æ³•:</p><ul><li><a href="https://github.com/immerjs/immer" target="_blank" rel="noopener">immer</a></li><li><a href="https://github.com/immutable-js/immutable-js" target="_blank" rel="noopener">Immutable.js</a></li></ul><p>ç¬”è€…æ¯”è¾ƒå–œæ¬¢ immerï¼Œæ²¡æœ‰ä»€ä¹ˆå¿ƒæ™ºè´Ÿæ‹…, æŒ‰ç…§ JS ä¹ æƒ¯çš„å¯¹è±¡æ“ä½œæ–¹å¼å°±å¯ä»¥å®ç°ä¸å¯å˜æ•°æ®ã€‚</p><p><br></p><hr><p><br></p><h2 id="10-react-router-url-å³çŠ¶æ€"><a href="#10-react-router-url-å³çŠ¶æ€" class="headerlink" title="10. React-router: URL å³çŠ¶æ€"></a>10. React-router: URL å³çŠ¶æ€</h2><center><br> <img src="/images/04/static-router.png" width="300"><br></center><p>ä¼ ç»Ÿçš„è·¯ç”±ä¸»è¦ç”¨äºåŒºåˆ†é¡µé¢, æ‰€ä»¥ä¸€å¼€å§‹å‰ç«¯è·¯ç”±è®¾è®¡ä¹Ÿåƒåç«¯è·¯ç”±(ä¹Ÿç§°ä¸º<strong>é™æ€è·¯ç”±</strong>)ä¸€æ ·, ä½¿ç”¨å¯¹è±¡é…ç½®æ–¹å¼, ç»™ä¸åŒçš„ url åˆ†é…ä¸åŒçš„é¡µé¢ç»„ä»¶, å½“åº”ç”¨å¯åŠ¨æ—¶, åœ¨è·¯ç”±é…ç½®è¡¨ä¸­æŸ¥æ‰¾åŒ¹é… URL çš„ç»„ä»¶å¹¶æ¸²æŸ“å‡ºæ¥.</p><p>React-Router v4 ç®—æ˜¯ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šç¬¦åˆ<em>ç»„ä»¶åŒ–</em>æ€ç»´çš„è·¯ç”±åº“, React-Router å®˜æ–¹ç§°ä¹‹ä¸ºâ€˜åŠ¨æ€è·¯ç”±â€™, å®˜æ–¹çš„è§£é‡Šæ˜¯â€æŒ‡çš„æ˜¯åœ¨åº”ç”¨ç¨‹åºæ¸²æŸ“æ—¶å‘ç”Ÿçš„è·¯ç”±ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œåº”ç”¨ç¨‹åºä¹‹å¤–çš„é…ç½®æˆ–çº¦å®šä¸­å‘ç”Ÿçš„è·¯ç”±â€, å…·ä½“è¯´, <code>&lt;Route/&gt;</code>å˜æˆäº†ä¸€ä¸ªæ™®é€š React ç»„ä»¶, å®ƒåœ¨æ¸²æŸ“æ—¶åˆ¤æ–­æ˜¯å¦åŒ¹é… URL, å¦‚æœåŒ¹é…å°±æ¸²æŸ“æŒ‡å®šçš„ç»„ä»¶, ä¸åŒ¹é…å°±è¿”å› null.</p><p>è¿™æ—¶å€™ URL æ„ä¹‰å·²ç»ä¸ä¸€æ ·äº†, <strong>URL ä¸å†æ˜¯ç®€å•çš„é¡µé¢æ ‡å¿—, è€Œæ˜¯åº”ç”¨çš„çŠ¶æ€</strong>; <strong>åº”ç”¨æ„æˆä¹Ÿä¸å†å±€é™äºæ‰å¹³é¡µé¢, è€Œæ˜¯å¤šä¸ªå¯ä»¥å“åº” URL çŠ¶æ€çš„åŒºåŸŸ(å¯åµŒå¥—)</strong>. å› ä¸ºæ€ç»´è½¬å˜å¾ˆå¤§, æ‰€ä»¥å®ƒåˆšå‡ºæ¥æ—¶å¹¶ä¸å—é’ç. è¿™ç§æ–¹å¼æ›´åŠ çµæ´»ï¼Œ æ‰€ä»¥é€‰æ‹© v4 ä¸ä»£è¡¨æ”¾å¼ƒæ—§çš„è·¯ç”±æ–¹å¼, ä½ å®Œå…¨å¯ä»¥æŒ‰ç…§<a href="https://react-router.docschina.org/core/guides/static-routes" target="_blank" rel="noopener">æ—§çš„æ–¹å¼</a>æ¥å®ç°é¡µé¢è·¯ç”±.</p><p>ä¸¾ä¸ªåº”ç”¨å®ä¾‹: ä¸€ä¸ªåº”ç”¨ç”±ä¸‰ä¸ªåŒºåŸŸç»„æˆ: ä¾§è¾¹æ æ”¾ç½®å¤šä¸ªå…¥å£, ç‚¹å‡»è¿™äº›å…¥å£ä¼šåŠ è½½å¯¹åº”ç±»å‹çš„åˆ—è¡¨, ç‚¹å‡»åˆ—è¡¨é¡¹éœ€è¦åŠ è½½è¯¦æƒ…. ä¸‰ä¸ªåŒºåŸŸå­˜åœ¨çº§è”å…³ç³»</p><p><img src="/images/04/router-demo.png" alt="router demo"></p><p>é¦–å…ˆè®¾è®¡èƒ½å¤Ÿè¡¨è¾¾è¿™ç§çº§è”å…³ç³»çš„ URL, æ¯”å¦‚<code>/{group}/{id}</code>, URL è®¾è®¡ä¸€èˆ¬éµå¾ª<a href="https://ruby-china.github.io/rails-guides/v5.0/routing.html#åµŒå¥—èµ„æº" target="_blank" rel="noopener">REST é£æ ¼</a>, é‚£ä¹ˆåº”ç”¨çš„å¤§æ¦‚ç»“æ„æ˜¯è¿™æ ·å­:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// App</span><br><span class="line">const App = () =&gt; &#123;</span><br><span class="line">  &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">    &lt;SideBar /&gt;</span><br><span class="line">    &lt;Route path=&quot;/:group&quot; component=&#123;ListPage&#125; /&gt;</span><br><span class="line">    &lt;Route path=&quot;/:group/:id&quot; component=&#123;Detail&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// SideBar</span><br><span class="line">const Sidebar = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;sidebar&quot;&gt;</span><br><span class="line">      &#123;/* ä½¿ç”¨NavLink åœ¨åŒ¹é…æ—¶æ˜¾ç¤ºæ¿€æ´»çŠ¶æ€ */&#125;</span><br><span class="line">      &lt;NavLink to=&quot;/message&quot;&gt;æ¶ˆæ¯&lt;/NavLink&gt;</span><br><span class="line">      &lt;NavLink to=&quot;/task&quot;&gt;ä»»åŠ¡&lt;/NavLink&gt;</span><br><span class="line">      &lt;NavLink to=&quot;/location&quot;&gt;å®šä½&lt;/NavLink&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// ListPage</span><br><span class="line">const ListPage = props =&gt; &#123;</span><br><span class="line">  const &#123; group &#125; = props.match.params;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  // å“åº”groupå˜åŒ–, å¹¶åŠ è½½æŒ‡å®šç±»å‹åˆ—è¡¨</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    load(group);</span><br><span class="line">  &#125;, [group]);</span><br><span class="line"></span><br><span class="line">  // åˆ—è¡¨é¡¹ä¹Ÿä¼šä½¿ç”¨NavLink, ç”¨äºåŒ¹é…å½“å‰å±•ç¤ºçš„è¯¦æƒ…, æ¿€æ´»æ˜¾ç¤º</span><br><span class="line">  return &lt;div className=&quot;list&quot;&gt;&#123;renderList()&#125;&lt;/div&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// DetailPage</span><br><span class="line">const DetailPage = props =&gt; &#123;</span><br><span class="line">  const &#123; group, id &#125; = props.match.params;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  // å“åº”groupå’Œid, å¹¶åŠ è½½è¯¦æƒ…</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadDetail(group, id);</span><br><span class="line">  &#125;, [group, id]);</span><br><span class="line"></span><br><span class="line">  return &lt;div className=&quot;detail&quot;&gt;&#123;renderDetail()&#125;&lt;/div&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ‰©å±•</p><ul><li><a href="https://react-router.docschina.org/core/guides/philosophy" target="_blank" rel="noopener">React Router å“²å­¦</a></li><li><a href="https://juejin.im/post/5986d1456fb9a03c3f405bd2" target="_blank" rel="noopener">èŠèŠ React Router v4 çš„è®¾è®¡æ€æƒ³</a></li></ul><p><br></p><hr><p><br></p><h2 id="11-ç»„ä»¶è§„èŒƒ"><a href="#11-ç»„ä»¶è§„èŒƒ" class="headerlink" title="11. ç»„ä»¶è§„èŒƒ"></a>11. ç»„ä»¶è§„èŒƒ</h2><ul><li>å¼€å¯ä¸¥æ ¼æ¨¡å¼: å¼€å¯ StrictModeï¼Œå°½æ—©å‘ç°æ½œåœ¨é—®é¢˜å’Œä¸è§„èŒƒç”¨æ³•</li><li>ç¬¬ä¸‰æ–¹å¼€å‘è§„èŒƒ:<ul><li><a href="https://github.com/airbnb/javascript/tree/master/react#ordering" target="_blank" rel="noopener">Airbnb React/JSX Style Guide</a></li><li><a href="https://vasanthk.gitbooks.io/react-bits/patterns/30.component-switch.html" target="_blank" rel="noopener">React bits</a></li><li><a href="https://github.com/krasimir/react-in-patterns" target="_blank" rel="noopener">react-in-patterns</a></li></ul></li></ul><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://github.com/acdlite/recompose/blob/master/docs/API.md" target="_blank" rel="noopener">recompose</a></li><li><a href="https://overreacted.io/zh-hans/writing-resilient-components/" target="_blank" rel="noopener">ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ React çš„ä¸–ç•Œé‡Œâ€&lt;strong&gt;ä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶&lt;/strong&gt;â€œï¼Œ ç»„ä»¶å¯ä»¥æ˜ å°„ä½œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å‡½æ•°ï¼ŒReact çš„ç»„ä»¶å’Œå‡½æ•°ä¸€æ ·çš„çµæ´»çš„ç‰¹æ€§ä¸ä»…ä»…å¯ä»¥ç”¨äºç»˜åˆ¶ UIï¼Œè¿˜å¯ä»¥ç”¨äºå°è£…ä¸šåŠ¡çŠ¶æ€å’Œé€»è¾‘ï¼Œæˆ–è€…éå±•ç¤ºç›¸å…³çš„å‰¯ä½œç”¨, å†é€šè¿‡ç»„åˆæ–¹å¼ç»„æˆå¤æ‚çš„åº”ç”¨. æœ¬æ–‡å°è¯•
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
</feed>
