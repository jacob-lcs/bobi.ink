<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bobi.ink</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://bobi.ink/"/>
  <updated>2019-06-07T09:01:44.492Z</updated>
  <id>https://bobi.ink/</id>
  
  <author>
    <name>Ivan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] preact</title>
    <link href="https://bobi.ink/2019/06/02/preact-map/"/>
    <id>https://bobi.ink/2019/06/02/preact-map/</id>
    <published>2019-06-01T16:00:00.000Z</published>
    <updated>2019-06-07T09:01:44.492Z</updated>
    
    <content type="html"><![CDATA[<p>React çš„ä»£ç åº“ç°åœ¨å·²ç»æ¯”è¾ƒåºå¤§äº†ï¼ŒåŠ ä¸Š v16 çš„ Fiber é‡æ„ï¼Œå¾ˆå®¹æ˜“åˆå­¦è€…é™·å…¥ç»†èŠ‚çš„æ±ªæ´‹å¤§æµ·ï¼Œææ‡‚äº†ä¼šè®©äººè§‰å¾—è‡ªå·±å¾ˆç‰›é€¼ï¼Œæä¸æ‡‚å¾ˆå®¹æ˜“è®©äººå¤±å»ä¿¡å¿ƒ, æ€€ç–‘è‡ªå·±æ˜¯å¦åº”è¯¥ç»§ç»­æå‰ç«¯ã€‚é‚£ä¹ˆå°è¯•åœ¨æœ¬æ–‡è¿™é‡Œæ‰¾å›ä¸€ç‚¹è‡ªä¿¡å§(é«˜æ‰‹ç»•è·¯).</p><p>Preact æ˜¯ React çš„ç¼©ç•¥ç‰ˆ, ä½“ç§¯éå¸¸å°, ä½†äº”è„ä¿±å…¨. å¦‚æœä½ æƒ³äº†è§£ React çš„åŸºæœ¬åŸç†, å¯ä»¥å»å­¦ä¹ å­¦ä¹  Preact çš„æºç , è¿™ä¹Ÿæ­£æ˜¯æœ¬æ–‡çš„ç›®çš„ã€‚</p><p>å…³äº React åŸç†çš„ä¼˜ç§€çš„æ–‡ç« å·²ç»éå¸¸å¤š, æœ¬æ–‡å°±æ˜¯è€é…’è£…æ–°ç“¶, ç®—æ˜¯è‡ªå·±çš„ä¸€ç‚¹æ€»ç»“ï¼Œä¹Ÿä¸ºåé¢çš„æ–‡ç« ä½œä¸€ä¸‹é“ºå«å§. </p><p>æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œé˜…è¯»æ—¶é—´çº¦20minï¼Œä¸»è¦è¢«ä»£ç å æ®ï¼Œå¦å¤–ä¹Ÿç”»äº†æµç¨‹å›¾é…åˆç†è§£ä»£ç ã€‚</p><blockquote><p>æ³¨æ„ï¼šä»£ç æœ‰æ‰€ç®€åŒ–ï¼Œå¿½ç•¥æ‰ svgã€replaceNodeã€context ç­‰ç‰¹æ€§<br>æœ¬æ–‡ä»£ç åŸºäºpreact v10ç‰ˆæœ¬</p></blockquote><p><br></p><!-- TOC --><ul><li><a href="#virtual-dom">Virtual-DOM</a></li><li><a href="#ä»-createelement-å¼€å§‹">ä» createElement å¼€å§‹</a></li><li><a href="#component-çš„å®ç°">Component çš„å®ç°</a></li><li><a href="#diff-ç®—æ³•">diff ç®—æ³•</a><ul><li><a href="#diffchildren">diffChildren</a></li><li><a href="#diff">diff</a></li><li><a href="#diffelementnodes">diffElementNodes</a></li><li><a href="#diffprops">diffProps</a></li></ul></li><li><a href="#hooks-çš„å®ç°">Hooks çš„å®ç°</a><ul><li><a href="#usestate">useState</a></li><li><a href="#useeffect">useEffect</a></li></ul></li><li><a href="#æŠ€æœ¯åœ°å›¾">æŠ€æœ¯åœ°å›¾</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><h2 id="virtual-dom"><a href="#virtual-dom" class="headerlink" title="Virtual-DOM"></a>Virtual-DOM</h2><center><br> <img src="/images/07/vd.png" width="500"><br></center><p>Virtual-DOM å…¶å®å°±æ˜¯ä¸€é¢—å¯¹è±¡æ ‘ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œè¿™ä¸ªå¯¹è±¡æ ‘æœ€ç»ˆè¦æ˜ å°„åˆ°å›¾å½¢å¯¹è±¡. VirtualDOMæ¯”è¾ƒæ ¸å¿ƒçš„æ˜¯<code>diffç®—æ³•</code>.</p><p>ä½ å¯ä»¥æƒ³è±¡è¿™é‡Œæœ‰ä¸€ä¸ª<code>DOMæ˜ å°„å™¨</code>ï¼Œè§åçŸ¥ä¹‰ï¼Œ<strong>è¿™ä¸ªâ€™DOM æ˜ å°„å™¨â€˜çš„å·¥ä½œå°±æ˜¯å°† Virtual-DOM å¯¹è±¡æ ‘æ˜ å°„æµè§ˆå™¨é¡µé¢çš„ DOMï¼Œåªä¸è¿‡ä¸ºäº†æé«˜ DOM çš„â€™æ“ä½œæ€§èƒ½â€™. å®ƒä¸æ˜¯æ¯ä¸€æ¬¡éƒ½å…¨é‡æ¸²æŸ“æ•´ä¸ª Virtual-DOM æ ‘ï¼Œè€Œæ˜¯æ”¯æŒæ¥æ”¶ä¸¤é¢— Virtual-DOM å¯¹è±¡æ ‘(ä¸€ä¸ªæ›´æ–°å‰ï¼Œä¸€ä¸ªæ›´æ–°å), é€šè¿‡ diff ç®—æ³•è®¡ç®—å‡ºä¸¤é¢— Virtual-DOM æ ‘å·®å¼‚çš„åœ°æ–¹ï¼Œç„¶ååªåº”ç”¨è¿™äº›å·®å¼‚çš„åœ°æ–¹åˆ°å®é™…çš„ DOM æ ‘, ä»è€Œå‡å°‘ DOM å˜æ›´çš„æˆæœ¬.</strong></p><p>Virtual-DOM æ˜¯æ¯”è¾ƒäº‰è®®æ€§ï¼Œæ¨èé˜…è¯»<a href="https://www.zhihu.com/question/31809713/answer/53544875" target="_blank" rel="noopener">ã€Šç½‘ä¸Šéƒ½è¯´æ“ä½œçœŸå® DOM æ…¢ï¼Œä½†æµ‹è¯•ç»“æœå´æ¯” React æ›´å¿«ï¼Œä¸ºä»€ä¹ˆï¼Ÿã€‹</a> ã€‚åˆ‡è®°æ°¸è¿œéƒ½ä¸è¦ç¦»å¼€åœºæ™¯å»è¯„åˆ¤ä¸€ä¸ªæŠ€æœ¯çš„å¥½åã€‚å½“åˆç½‘ä¸ŠæŠŠ React å¹å¾—å¤šä¹ˆç‰›é€¼, ä¸€äº›å°ç™½å°±ä¼šè§‰å¾— Virtual-DOM å¾ˆåŠï¼ŒJQuery å¼±çˆ†äº†ã€‚</p><p>æˆ‘è§‰å¾—ä¸¤ä¸ªå¯æ¯”æ€§ä¸å¤§ï¼Œä»æ€§èƒ½ä¸Šçœ‹, <strong>æ¡†æ¶å†æ€ä¹ˆç‰›é€¼å®ƒä¹Ÿæ˜¯éœ€è¦æ“ä½œåŸç”Ÿ DOM çš„ï¼Œè€Œä¸”å®ƒæœªå¿…æœ‰ä½ ä½¿ç”¨ JQuery æ‰‹åŠ¨æ“ä½œ DOM æ¥å¾—â€™ç²¾ç»†â€™</strong>. æ¡†æ¶ä¸åˆç†ä½¿ç”¨ä¹Ÿå¯èƒ½å‡ºç°ä¿®æ”¹ä¸€ä¸ªå°çŠ¶æ€ï¼Œå¯¼è‡´æ¸²æŸ“é›ªå´©(å¤§èŒƒå›´é‡æ–°æ¸²æŸ“)çš„æƒ…å†µ; åŒç†JQuery è™½ç„¶å¯ä»¥ç²¾ç»†åŒ–æ“ä½œ DOM, ä½†æ˜¯ä¸åˆç†çš„ DOM æ›´æ–°ç­–ç•¥å¯èƒ½ä¹Ÿä¼šæˆä¸ºåº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆ. æ‰€ä»¥å…³é”®è¿˜å¾—çœ‹ä½ æ€ä¹ˆç”¨.</p><p>é‚£ä¸ºä»€ä¹ˆéœ€è¦ Virtual-DOMï¼Ÿ</p><p><strong>æˆ‘ä¸ªäººçš„ç†è§£å°±æ˜¯ä¸ºäº†è§£æ”¾ç”Ÿäº§åŠ›ã€‚ç°å¦‚ä»Šç¡¬ä»¶çš„æ€§èƒ½è¶Šæ¥è¶Šå¥½ï¼Œweb åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œç”Ÿäº§åŠ›ä¹Ÿæ˜¯è¦è·Ÿä¸Šçš„ã€‚</strong>å°½ç®¡æ‰‹åŠ¨æ“ä½œ DOM å¯èƒ½å¯ä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†æ˜¯è¿™æ ·å¯¹å¤§éƒ¨åˆ†å¼€å‘è€…æ¥è¯´å¤ªä½æ•ˆäº†ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ¥å—ç‰ºç‰²ä¸€ç‚¹æ€§èƒ½æ¢å–æ›´é«˜çš„å¼€å‘æ•ˆç‡çš„.</p><p>æ‰€ä»¥è¯´Virtual-DOM æ›´å¤§çš„æ„ä¹‰åœ¨äºå¼€å‘æ–¹å¼çš„æ”¹å˜: å£°æ˜å¼ã€ æ•°æ®é©±åŠ¨, è®©å¼€å‘è€…ä¸éœ€è¦å…³å¿ƒ DOM çš„æ“ä½œç»†èŠ‚(å±æ€§æ“ä½œã€äº‹ä»¶ç»‘å®šã€DOM èŠ‚ç‚¹å˜æ›´)ï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨çš„å¼€å‘æ–¹å¼å˜æˆäº†<code>view=f(state)</code>, è¿™å¯¹ç”Ÿäº§åŠ›çš„è§£æ”¾æ˜¯æœ‰å¾ˆå¤§æ¨åŠ¨ä½œç”¨çš„.</p><p>å½“ç„¶ Virtual-DOM ä¸æ˜¯å”¯ä¸€ï¼Œä¹Ÿä¸æ˜¯ç¬¬ä¸€ä¸ªçš„è¿™æ ·è§£å†³æ–¹æ¡ˆ. æ¯”å¦‚ AngularJS, Vue1.x è¿™äº›åŸºäºæ¨¡æ¿çš„å®ç°æ–¹å¼, ä¹Ÿå¯ä»¥è¯´å®ç°è¿™ç§å¼€å‘æ–¹å¼. é‚£ç›¸å¯¹äºä»–ä»¬ Virtual-DOM çš„ä¹°ç‚¹å¯èƒ½å°±æ˜¯æ›´é«˜çš„æ€§èƒ½äº†, å¦å¤– Virtual-DOM åœ¨æ¸²æŸ“å±‚ä¸Šé¢çš„æŠ½è±¡æ›´åŠ å½»åº•, ä¸å†è€¦åˆäº DOM æœ¬èº«ï¼Œæ¯”å¦‚å¯ä»¥æ¸²æŸ“ä¸º RNï¼ŒPDFï¼Œç»ˆç«¯ UI ç­‰ç­‰ã€‚</p><p><br></p><hr><p><br></p><h2 id="ä»-createelement-å¼€å§‹"><a href="#ä»-createelement-å¼€å§‹" class="headerlink" title="ä» createElement å¼€å§‹"></a>ä» createElement å¼€å§‹</h2><p>å¾ˆå¤šå°ç™½å°† <code>JSX</code> ç­‰ä»·ä¸º Virtual-DOMï¼Œå…¶å®è¿™ä¸¤è€…å¹¶æ²¡æœ‰ç›´æ¥çš„å…³ç³», æˆ‘ä»¬çŸ¥é“ <strong>JSX ä¸è¿‡æ˜¯ä¸€ä¸ªè¯­æ³•ç³–</strong>. </p><p>ä¾‹å¦‚<code>&lt;a href=&quot;/&quot;&gt;&lt;span&gt;Home&lt;/span&gt;&lt;/a&gt;</code>æœ€ç»ˆä¼šè½¬æ¢ä¸º<code>h(&#39;a&#39;, { href:&#39;/&#39; }, h(&#39;span&#39;, null, &#39;Home&#39;))</code>è¿™ç§å½¢å¼, <code>h</code>æ˜¯ JSX Element å·¥å‚æ–¹æ³•ï¼Œ<code>h</code> åœ¨ React ä¸‹çº¦å®šæ˜¯<code>React.createElement</code>. </p><p><code>h</code> æ˜¯ <code>createElement</code> çš„åˆ«å, Vue ç”Ÿæ€ç³»ç»Ÿä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ªæƒ¯ä¾‹, å…·ä½“ä¸ºä»€ä¹ˆæ²¡ä½œè€ƒç©¶(æ¯”è¾ƒç®€çŸ­ï¼Ÿ)ã€‚</p><p>å¯æ˜¯ä½¿ç”¨<code>@jsx</code>æ³¨è§£æˆ– babel é…ç½®é¡¹æ¥é…ç½® JSX å·¥å‚ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @jsx h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">render(&lt;div&gt;hello jsx&lt;/div&gt;, el);</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸æ˜¯ react æˆ– preact çš„å…¥é—¨æ–‡ç« ï¼Œæ‰€ä»¥ç‚¹åˆ°ä¸ºæ­¢ï¼Œæ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹<a href="https://preactjs.com/guide/getting-started" target="_blank" rel="noopener">å®˜æ–¹æ•™ç¨‹</a>. ç°åœ¨æ¥çœ‹çœ‹<code>createElemet</code>, <strong>createElement ä¸è¿‡å°±æ˜¯æ„é€ ä¸€ä¸ªå¯¹è±¡(VNode)</strong>:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸type èŠ‚ç‚¹çš„ç±»å‹ï¼Œæœ‰DOMå…ƒç´ (string)å’Œè‡ªå®šä¹‰ç»„ä»¶ï¼Œä»¥åŠFragment, ä¸ºnullæ—¶è¡¨ç¤ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, children</span>) </span>&#123;</span><br><span class="line">  props.children = children;</span><br><span class="line">  <span class="comment">// âš›ï¸åº”ç”¨defaultProps</span></span><br><span class="line">  <span class="keyword">if</span> (type != <span class="literal">null</span> &amp;&amp; type.defaultProps != <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> type.defaultProps)</span><br><span class="line">      <span class="keyword">if</span> (props[i] === <span class="literal">undefined</span>) props[i] = type.defaultProps[i];</span><br><span class="line">  <span class="keyword">let</span> ref = props.ref;</span><br><span class="line">  <span class="keyword">let</span> key = props.key;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸æ„å»ºVNodeå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> createVNode(type, props, key, ref);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createVNode</span>(<span class="params">type, props, key, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; type, props, key, ref, <span class="comment">/* ... å¿½ç•¥éƒ¨åˆ†å†…ç½®å­—æ®µ */</span> <span class="keyword">constructor</span>: undefined &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><hr><p><br></p><h2 id="component-çš„å®ç°"><a href="#component-çš„å®ç°" class="headerlink" title="Component çš„å®ç°"></a>Component çš„å®ç°</h2><p>å¯¹äºä¸€ä¸ªè§†å›¾æ¡†æ¶æ¥è¯´ï¼Œç»„ä»¶å°±æ˜¯å®ƒçš„çµé­‚. å°†ä¸€ä¸ªåº”ç”¨åˆ†è€Œæ²»ä¹‹, æ‹†åˆ†å’Œç»„åˆä¸åŒçº§åˆ«çš„ç»„ä»¶ï¼Œå¯ä»¥ç®€åŒ–åº”ç”¨çš„å¼€å‘å’Œç»´æŠ¤ï¼Œè®©ç¨‹åºæ›´å¥½ç†è§£. <strong>ç»„ä»¶æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å…ƒç´ ç±»å‹ï¼Œå¯ä»¥å£°æ˜ç»„ä»¶çš„è¾“å…¥(props)ã€æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€ä»¥åŠæ–¹æ³•ã€è¾“å‡º Virtual-DOM å¯¹è±¡æ ‘</strong>.</p><p>è‡ªå®šä¹‰ç»„ä»¶æ˜¯åŸºäº Component ç±»å®ç°çš„. å¯¹ç»„ä»¶æ¥è¯´æœ€åŸºæœ¬çš„å°±æ˜¯çŠ¶æ€çš„ç»´æŠ¤, è¿™ä¸ªé€šè¿‡ setState æ¥å®ç°:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params">props, context</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸setStateå®ç°</span></span><br><span class="line">Component.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">update, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…‹éš†ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„State, _nextStateä¼šåœ¨ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹å¼ä¸­ç”¨åˆ°(ä¾‹å¦‚shouldComponentUpdate)</span></span><br><span class="line">  <span class="keyword">let</span> s = (<span class="keyword">this</span>._nextState !== <span class="keyword">this</span>.state &amp;&amp; <span class="keyword">this</span>._nextState) ||</span><br><span class="line">    (<span class="keyword">this</span>._nextState = assign(&#123;&#125;, <span class="keyword">this</span>.state));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// stateæ›´æ–°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> update !== <span class="string">'function'</span> || (update = update(s, <span class="keyword">this</span>.props))) &#123;</span><br><span class="line">    assign(s, update);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._vnode) &#123; <span class="comment">// å·²æŒ‚è½½</span></span><br><span class="line">    <span class="comment">// æ¨å…¥æ¸²æŸ“å›è°ƒé˜Ÿåˆ—, åœ¨æ¸²æŸ“å®Œæˆåæ‰¹é‡è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (callback) <span class="keyword">this</span>._renderCallbacks.push(callback);</span><br><span class="line">    <span class="comment">// æ”¾å…¥å¼‚æ­¥è°ƒåº¦é˜Ÿåˆ—</span></span><br><span class="line">    enqueueRender(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p><code>enqueueRender</code> å°†ç»„ä»¶æ”¾è¿›ä¸€ä¸ªå¼‚æ­¥çš„æ‰¹æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·å¯ä»¥å½’å¹¶é¢‘ç¹çš„ setState è°ƒç”¨ï¼Œå®ç°ä¹Ÿéå¸¸ç®€å•:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> q = [];</span><br><span class="line"><span class="comment">// å¼‚æ­¥è°ƒåº¦å™¨ï¼Œç”¨äºå¼‚æ­¥æ‰§è¡Œä¸€ä¸ªå›è°ƒ</span></span><br><span class="line"><span class="keyword">const</span> defer = <span class="keyword">typeof</span> <span class="built_in">Promise</span> == <span class="string">'function'</span></span><br><span class="line">    ? <span class="built_in">Promise</span>.prototype.then.bind(<span class="built_in">Promise</span>.resolve()) <span class="comment">// micro task</span></span><br><span class="line">    : setTimeout; <span class="comment">// å›è°ƒåˆ°setTimeout</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enqueueRender</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸éœ€è¦é‡å¤æ¨å…¥å·²ç»åœ¨é˜Ÿåˆ—çš„Component</span></span><br><span class="line">  <span class="keyword">if</span> (!c._dirty &amp;&amp; (c._dirty = <span class="literal">true</span>) &amp;&amp; q.push(c) === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“é˜Ÿåˆ—ä»ç©ºå˜ä¸ºéç©ºæ—¶ï¼Œå¼€å§‹è°ƒåº¦</span></span><br><span class="line">    defer(process);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹é‡æ¸…ç©ºé˜Ÿåˆ—, è°ƒç”¨Componentçš„forceUpdate</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> p;</span><br><span class="line">  <span class="comment">// æ’åºé˜Ÿåˆ—ï¼Œä»ä½å±‚çš„ç»„ä»¶ä¼˜å…ˆæ›´æ–°?</span></span><br><span class="line">  q.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b._depth - a._depth);</span><br><span class="line">  <span class="keyword">while</span> ((p = q.pop()))</span><br><span class="line">    <span class="keyword">if</span> (p._dirty) p.forceUpdate(<span class="literal">false</span>); <span class="comment">// falseè¡¨ç¤ºä¸è¦å¼ºåˆ¶æ›´æ–°ï¼Œå³ä¸è¦å¿½ç•¥shouldComponentUpdate</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>Ok, ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡º setState æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨ forceUpdate è¿›è¡Œç»„ä»¶é‡æ–°æ¸²æŸ“çš„ï¼Œæ¥çœ‹çœ‹ forceUpdate çš„å®ç°. è¿™é‡Œæš‚ä¸”å¿½ç•¥ diff, <strong>å°† diff è§†ä½œä¸€ä¸ªé»‘ç›’ï¼Œä»–å°±æ˜¯ä¸€ä¸ª DOM æ˜ å°„å™¨, åƒä¸Šé¢è¯´çš„ diff æ¥æ”¶ä¸¤æ£µ VNode æ ‘, ä»¥åŠä¸€ä¸ª DOM æŒ‚è½½ç‚¹, åœ¨æ¯”å¯¹çš„è¿‡ç¨‹ä¸­å®ƒå¯ä»¥ä¼šåˆ›å»ºã€ç§»é™¤æˆ–æ›´æ–°ç»„ä»¶å’Œ DOM å…ƒç´ ï¼Œè§¦å‘å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>.</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Component.prototype.forceUpdate = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123; <span class="comment">// callbackæ”¾ç½®æ¸²æŸ“å®Œæˆåçš„å›è°ƒ</span></span><br><span class="line">  <span class="keyword">let</span> vnode = <span class="keyword">this</span>._vnode, dom = <span class="keyword">this</span>._vnode._dom, parentDom = <span class="keyword">this</span>._parentDom;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (parentDom) &#123; <span class="comment">// å·²æŒ‚è½½è¿‡</span></span><br><span class="line">    <span class="keyword">const</span> force = callback !== <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> mounts = [];</span><br><span class="line">    <span class="comment">// è°ƒç”¨diffå¯¹å½“å‰ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“å’ŒVirtual-DOMæ¯”å¯¹</span></span><br><span class="line">    <span class="comment">// âš›ï¸æš‚ä¸”å¿½ç•¥è¿™äº›å‚æ•°, å°†diffè§†ä½œä¸€ä¸ªé»‘ç›’ï¼Œä»–å°±æ˜¯ä¸€ä¸ªDOMæ˜ å°„å™¨ï¼Œ</span></span><br><span class="line">    dom = diff(parentDom, vnode, vnode, mounts, <span class="keyword">this</span>._ancestorComponent, force, dom);</span><br><span class="line">    <span class="keyword">if</span> (dom != <span class="literal">null</span> &amp;&amp; dom.parentNode !== parentDom)</span><br><span class="line">      parentDom.appendChild(dom);</span><br><span class="line">    commitRoot(mounts, vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (callback) callback();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>åœ¨çœ‹çœ‹ render æ–¹æ³•, å®ç°è·Ÿ forceUpdate å·®ä¸å¤š, éƒ½æ˜¯è°ƒç”¨diffç®—æ³•æ¥æ‰§è¡ŒDOMæ›´æ–°ï¼Œåªä¸è¿‡ç”±å¤–éƒ¨æŒ‡å®šä¸€ä¸ª DOM å®¹å™¨:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–ç‰ˆ</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, parentDom</span>) </span>&#123;</span><br><span class="line">  vnode = createElement(Fragment, <span class="literal">null</span>, [vnode]);</span><br><span class="line">  parentDom.childNodes.forEach(<span class="function"><span class="params">i</span> =&gt;</span> i.remove())</span><br><span class="line">  <span class="keyword">let</span> mounts = [];</span><br><span class="line">  diffChildren(parentDom, <span class="literal">null</span> oldVNode, mounts, vnode, EMPTY_OBJ);</span><br><span class="line">  commitRoot(mounts, vnode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>æ¢³ç†ä¸€ä¸‹ä¸Šé¢çš„æµç¨‹:</p><center><br>  <img src="/images/07/setState.png" width="800"><br></center><p><br></p><hr><p><br></p><h2 id="diff-ç®—æ³•"><a href="#diff-ç®—æ³•" class="headerlink" title="diff ç®—æ³•"></a>diff ç®—æ³•</h2><p>åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œé€šè¿‡ä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼ŒcreateElement å’Œ Component é€»è¾‘éƒ½å¾ˆè–„ï¼Œ ä¸»è¦çš„é€»è¾‘è¿˜æ˜¯é›†ä¸­åœ¨ diff å‡½æ•°ä¸­. React å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <code>Reconciliation</code>, åœ¨ Preact ä¸­ç§°ä¸º <code>Differantiate</code>. ä¸ºäº†ç®€åŒ–ç¨‹åº Preact çš„å®ç°å°† diff å’Œ DOM æ‚ç³…åœ¨ä¸€èµ·, ä½†é€»è¾‘è¿˜æ˜¯å¾ˆæ¸…æ™°ï¼Œçœ‹ä¸‹ç›®å½•ç»“æ„å°±çŸ¥é“äº†:</p><p><br></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/diff</span><br><span class="line">â”œâ”€â”€ children.js # æ¯”å¯¹childrenæ•°ç»„</span><br><span class="line">â”œâ”€â”€ index.js    # æ¯”å¯¹ä¸¤ä¸ªèŠ‚ç‚¹</span><br><span class="line">â””â”€â”€ props.js    # æ¯”å¯¹ä¸¤ä¸ªDOMèŠ‚ç‚¹çš„props</span><br></pre></td></tr></table></figure><center><br>  <img src="/images/07/diff.png" width="600"><br></center><p><br></p><p>åœ¨æ·±å…¥ diff ç¨‹åºä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹åŸºæœ¬çš„å¯¹è±¡ç»“æ„, æ–¹ä¾¿åé¢ç†è§£ç¨‹åºæµç¨‹. å…ˆæ¥çœ‹ä¸‹ VNode çš„å¤–å½¢:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type ComponentFactory&lt;P&gt; = preact.ComponentClass&lt;P&gt; | FunctionalComponent&lt;P&gt;;</span><br><span class="line"></span><br><span class="line">interface VNode&lt;P = &#123;&#125;&gt; &#123;</span><br><span class="line">  <span class="comment">// èŠ‚ç‚¹ç±»å‹, å†…ç½®DOMå…ƒç´ ä¸ºstringç±»å‹ï¼Œè€Œè‡ªå®šä¹‰ç»„ä»¶åˆ™æ˜¯Componentç±»å‹ï¼Œpreactä¸­å‡½æ•°ç»„ä»¶åªæ˜¯ç‰¹æ®Šçš„Componentç±»å‹</span></span><br><span class="line">  type: string | ComponentFactory&lt;P&gt; | <span class="literal">null</span>;</span><br><span class="line">  props: P &amp; &#123; <span class="attr">children</span>: ComponentChildren &#125; | string | number | <span class="literal">null</span>;</span><br><span class="line">  key: Key</span><br><span class="line">  ref: Ref&lt;any&gt; | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å†…éƒ¨ç¼“å­˜ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// VNodeå­èŠ‚ç‚¹</span></span><br><span class="line">  _children: <span class="built_in">Array</span>&lt;VNode&gt; | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å…³è”çš„DOMèŠ‚ç‚¹, å¯¹äºFragmentæ¥è¯´ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">  _dom: PreactElement | Text | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// Fragment, æˆ–è€…ç»„ä»¶è¿”å›Fragmentçš„æœ€åä¸€ä¸ªDOMå­èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">  _lastDomChild: PreactElement | Text | <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// Componentå®ä¾‹</span></span><br><span class="line">  _component: Component | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="diffchildren"><a href="#diffchildren" class="headerlink" title="diffChildren"></a>diffChildren</h3><p>å…ˆä»æœ€ç®€å•çš„å¼€å§‹, diffChildren ç”¨äºæ¯”å¯¹ä¸¤ä¸ª VNode åˆ—è¡¨ï¼Œé¦–å…ˆè¿™é‡Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªè¡¨ç¤ºå½“å‰æ’å…¥ä½ç½®çš„å˜é‡(oldDOM). åœ¨éå†æ–° VNode åˆ—è¡¨è¿‡ç¨‹ä¸­, å°è¯•æ‰¾å‡ºç›¸åŒ key çš„æ—§VNodeï¼Œå’Œå®ƒè¿›è¡Œæ¯”å¯¹. å¦‚æœæ–° VNode å’Œæ—§ VNode ä½ç½®ä¸ä¸€æ ·ï¼Œè¿™å°±éœ€è¦ç§»åŠ¨å®ƒä»¬; å¦‚æœæ’å…¥ä½ç½®(oldDOM)å·²ç»åˆ°äº†ç»“å°¾ï¼Œåˆ™ç›´æ¥è¿½åŠ åˆ°çˆ¶èŠ‚ç‚¹ã€‚æœ€åå¸è½½æ—§ VNode åˆ—è¡¨ä¸­æœªä½¿ç”¨çš„ VNode.</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diffChildren</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentDom,         <span class="regexp">//</span> childrençš„çˆ¶DOMå…ƒç´ </span></span></span><br><span class="line"><span class="function"><span class="params">  newParentVNode,    <span class="regexp">//</span> childrençš„æ–°çˆ¶VNode</span></span></span><br><span class="line"><span class="function"><span class="params">  oldParentVNode,    <span class="regexp">//</span> childrençš„æ—§çˆ¶VNodeï¼ŒdiffChildrenä¸»è¦æ¯”å¯¹è¿™ä¸¤ä¸ªVnodeçš„children</span></span></span><br><span class="line"><span class="function"><span class="params">  mounts,            <span class="regexp">//</span> ä¿å­˜åœ¨è¿™æ¬¡æ¯”å¯¹è¿‡ç¨‹ä¸­è¢«æŒ‚è½½çš„ç»„ä»¶å®ä¾‹ï¼Œåœ¨æ¯”å¯¹åï¼Œä¼šè§¦å‘è¿™äº›ç»„ä»¶çš„componentDidMountç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span></span><br><span class="line"><span class="function"><span class="params">  ancestorComponent, <span class="regexp">//</span> childrençš„ç›´æ¥çˆ¶<span class="string">'ç»„ä»¶'</span>, å³æ¸²æŸ“(render</span>)<span class="title">VNode</span>çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="function">  <span class="title">oldDom</span>,            // å½“å‰æŒ‚è½½çš„<span class="title">DOM</span>ï¼Œå¯¹äº<span class="title">diffChildren</span>æ¥è¯´ï¼Œ<span class="title">oldDom</span>ä¸€å¼€å§‹æŒ‡å‘ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> newChildren = newParentVNode._children || toChildArray(newParentVNode.props.children, (newParentVNode._children = []), coerceToVNode, <span class="literal">true</span>,);</span><br><span class="line">  <span class="keyword">let</span> oldChildren = (oldParentVNode &amp;&amp; oldParentVNode._children) || EMPTY_ARR;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸éå†æ–°children</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; newChildren.length; i++) &#123;</span><br><span class="line">    childVNode = newChildren[i] = coerceToVNode(newChildren[i]); <span class="comment">// è§„èŒƒåŒ–VNode</span></span><br><span class="line">    <span class="keyword">if</span> (childVNode == <span class="literal">null</span>) <span class="keyword">continue</span></span><br><span class="line">    <span class="comment">// âš›ï¸æŸ¥æ‰¾oldChildrenä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å…ƒç´ ï¼Œå¦‚æœæ‰¾åˆ°åˆ™é€šè¿‡è®¾ç½®ä¸ºundefinedï¼Œä»oldChildrenä¸­ç§»é™¤</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™ä¿æŒä¸ºnull</span></span><br><span class="line">    oldVNode = oldChildren[i];</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; oldChildrenLength; j++) &#123;</span><br><span class="line">      oldVNode = oldChildren[j];</span><br><span class="line">      <span class="keyword">if</span> (oldVNode &amp;&amp; childVNode.key == oldVNode.key &amp;&amp; childVNode.type === oldVNode.type) &#123;</span><br><span class="line">        oldChildren[j] = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      oldVNode = <span class="literal">null</span>; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ—§nodeï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªæ–°çš„</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// âš›ï¸ é€’å½’æ¯”å¯¹VNode</span></span><br><span class="line">    newDom = diff(parentDom, childVNode, oldVNode, mounts, ancestorComponent, <span class="literal">null</span>, oldDom);</span><br><span class="line">    <span class="comment">// vnodeæ²¡æœ‰è¢«diffå¸è½½æ‰</span></span><br><span class="line">    <span class="keyword">if</span> (newDom != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (childVNode._lastDomChild != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸å½“å‰VNodeæ˜¯Fragmentç±»å‹</span></span><br><span class="line">        <span class="comment">// åªæœ‰Fragmentæˆ–ç»„ä»¶è¿”å›Fragmentçš„Vnodeä¼šæœ‰énullçš„_lastDomChild, ä»Fragmentçš„ç»“å°¾çš„DOMæ ‘å¼€å§‹æ¯”å¯¹:</span></span><br><span class="line">        <span class="comment">// &lt;A&gt;                               &lt;A&gt;</span></span><br><span class="line">        <span class="comment">//  &lt;&gt;                                 &lt;&gt;   ğŸ‘ˆ Fragmentç±»å‹ï¼Œdiffä¼šé€’å½’æ¯”å¯¹å®ƒçš„childrenï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬åªéœ€è¦å°†newDomæŒ‡å‘æ¯”å¯¹åçš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å³å¯</span></span><br><span class="line">        <span class="comment">//    &lt;a&gt;a&lt;/a&gt;           &lt;- diff -&gt;      &lt;b&gt;b&lt;/b&gt;</span></span><br><span class="line">        <span class="comment">//    &lt;b&gt;b&lt;/b&gt;                           &lt;a&gt;a&lt;/a&gt; ----+</span></span><br><span class="line">        <span class="comment">//  &lt;/&gt;                                &lt;/&gt;             \</span></span><br><span class="line">        <span class="comment">//                                     &lt;div&gt;x&lt;/div&gt;     ğŸ‘ˆoldDomä¼šæŒ‡å‘è¿™é‡Œ</span></span><br><span class="line">        <span class="comment">// &lt;/A&gt;                              &lt;/A&gt;</span></span><br><span class="line">        newDom = childVNode._lastDomChild;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVNode == <span class="literal">null</span> || newDom != oldDom || newDom.parentNode == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ newDomå’Œå½“å‰oldDomä¸åŒ¹é…ï¼Œå°è¯•æ–°å¢æˆ–ä¿®æ”¹ä½ç½®</span></span><br><span class="line">        outer: <span class="keyword">if</span> (oldDom == <span class="literal">null</span> || oldDom.parentNode !== parentDom) &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸oldDomæŒ‡å‘äº†ç»“å°¾, å³åé¢æ²¡æœ‰æ›´å¤šå…ƒç´ äº†ï¼Œç›´æ¥æ’å…¥å³å¯; é¦–æ¬¡æ¸²æŸ“ä¸€èˆ¬ä¼šè°ƒç”¨åˆ°è¿™é‡Œ</span></span><br><span class="line">          parentDom.appendChild(newDom);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ªä¼˜åŒ–æªæ–½ï¼Œå»æ‰ä¹Ÿä¸ä¼šå½±å“æ­£å¸¸ç¨‹åº. ä¸ºäº†ä¾¿äºç†è§£å¯ä»¥å¿½ç•¥è¿™æ®µä»£ç </span></span><br><span class="line">          <span class="comment">// å°è¯•å‘åæŸ¥æ‰¾oldChildLength/2ä¸ªå…ƒç´ ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ä¸éœ€è¦è°ƒç”¨insertBefore. è¿™æ®µä»£ç å¯ä»¥å‡å°‘insertBeforeçš„è°ƒç”¨é¢‘ç‡</span></span><br><span class="line">          <span class="keyword">for</span> (sibDom = oldDom, j = <span class="number">0</span>; (sibDom = sibDom.nextSibling) &amp;&amp; j &lt; oldChildrenLength; j += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sibDom == newDom)</span><br><span class="line">              <span class="keyword">break</span> outer;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// âš›ï¸insertBefore() å°†newDomç§»åŠ¨åˆ°oldDomä¹‹å‰ </span></span><br><span class="line">          parentDom.insertBefore(newDom, oldDom);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// âš›ï¸å…¶ä»–æƒ…å†µï¼ŒnewDom === oldDOMä¸éœ€è¦å¤„ç†</span></span><br><span class="line">      <span class="comment">// âš›ï¸ oldDomæŒ‡å‘ä¸‹ä¸€ä¸ªDOMèŠ‚ç‚¹</span></span><br><span class="line">      oldDom = newDom.nextSibling;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸ å¸è½½æ‰æ²¡æœ‰è¢«ç½®ä¸ºundefinedçš„å…ƒç´ </span></span><br><span class="line">  <span class="keyword">for</span> (i = oldChildrenLength; i--; )</span><br><span class="line">    <span class="keyword">if</span> (oldChildren[i] != <span class="literal">null</span>) unmount(oldChildren[i], ancestorComponent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>é…å›¾ç†è§£ä¸€ä¸‹ diffChilrend çš„è°ƒç”¨è¿‡ç¨‹:</p><center><br>  <img src="/images/07/diffChildren.png" width="600"><br></center><p><br></p><p>æ€»ç»“ä¸€ä¸‹æµç¨‹å›¾</p><center><br>  <img src="/images/07/diffChildren-process.png" width="800"><br></center><p><br></p><hr><p><br></p><h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><p>diff ç”¨äºæ¯”å¯¹ä¸¤ä¸ª VNode èŠ‚ç‚¹. diff å‡½æ•°æ¯”è¾ƒå†—é•¿, ä½†æ˜¯è¿™é‡Œé¢å¹¶æ²¡æœ‰ç‰¹åˆ«å¤æ‚é€»è¾‘ï¼Œä¸»è¦æ˜¯ä¸€äº›è‡ªå®šä¹‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„å¤„ç†ã€‚æ‰€ä»¥å…ˆä¸Šæµç¨‹å›¾ï¼Œä»£ç ä¸æ„Ÿå…´è¶£å¯ä»¥è·³è¿‡.</p><center><br>  <img src="/images/07/diff-process.png" width="800"><br></center><p><br></p><p>æºä»£ç è§£æï¼š</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diff</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentDom,         <span class="regexp">//</span> çˆ¶DOMèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="function"><span class="params">  newVNode,          <span class="regexp">//</span> æ–°VNode</span></span></span><br><span class="line"><span class="function"><span class="params">  oldVNode,          <span class="regexp">//</span> æ—§VNode</span></span></span><br><span class="line"><span class="function"><span class="params">  mounts,            <span class="regexp">//</span> å­˜æ”¾å·²æŒ‚è½½çš„ç»„ä»¶, å°†åœ¨diffç»“æŸåæ‰¹é‡å¤„ç†</span></span></span><br><span class="line"><span class="function"><span class="params">  ancestorComponent, <span class="regexp">//</span> ç›´æ¥çˆ¶ç»„ä»¶</span></span></span><br><span class="line"><span class="function"><span class="params">  force,             <span class="regexp">//</span> æ˜¯å¦å¼ºåˆ¶æ›´æ–°, ä¸ºtrueå°†å¿½ç•¥æ‰shouldComponentUpdate</span></span></span><br><span class="line"><span class="function"><span class="params">  oldDom,            <span class="regexp">//</span> å½“å‰æŒ‚è½½çš„DOMèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    outer: <span class="keyword">if</span> (oldVNode.type === Fragment || newType === Fragment) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸ Fragmentç±»å‹ï¼Œä½¿ç”¨diffChildrenè¿›è¡Œæ¯”å¯¹</span></span><br><span class="line">      diffChildren(parentDom, newVNode, oldVNode, mounts, ancestorComponent, oldDom);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸è®°å½•Fragmentçš„èµ·å§‹DOMå’Œç»“æŸDOM</span></span><br><span class="line">      <span class="keyword">let</span> i = newVNode._children.length;</span><br><span class="line">      <span class="keyword">if</span> (i &amp;&amp; (tmp = newVNode._children[<span class="number">0</span>]) != <span class="literal">null</span>) &#123;</span><br><span class="line">        newVNode._dom = tmp._dom;</span><br><span class="line">        <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">          tmp = newVNode._children[i];</span><br><span class="line">          <span class="keyword">if</span> (newVNode._lastDomChild = tmp &amp;&amp; (tmp._lastDomChild || tmp._dom))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> newType === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸è‡ªå®šä¹‰ç»„ä»¶ç±»å‹</span></span><br><span class="line">      <span class="keyword">if</span> (oldVNode._component) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ ï¸å·²ç»å­˜åœ¨ç»„ä»¶å®ä¾‹</span></span><br><span class="line">        c = newVNode._component = oldVNode._component;</span><br><span class="line">        newVNode._dom = oldVNode._dom;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸åˆå§‹åŒ–ç»„ä»¶å®ä¾‹</span></span><br><span class="line">        <span class="keyword">if</span> (newType.prototype &amp;&amp; newType.prototype.render) &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ç±»ç»„ä»¶</span></span><br><span class="line">          newVNode._component = c = <span class="keyword">new</span> newType(newVNode.props, cctx); <span class="comment">// eslint-disable-line new-cap</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸å‡½æ•°ç»„ä»¶</span></span><br><span class="line">          newVNode._component = c = <span class="keyword">new</span> Component(newVNode.props, cctx);</span><br><span class="line">          c.constructor = newType;</span><br><span class="line">          c.render = doRender;</span><br><span class="line">        &#125;</span><br><span class="line">        c._ancestorComponent = ancestorComponent;</span><br><span class="line">        c.props = newVNode.props;</span><br><span class="line">        <span class="keyword">if</span> (!c.state) c.state = &#123;&#125;;</span><br><span class="line">        isNew = c._dirty = <span class="literal">true</span>;</span><br><span class="line">        c._renderCallbacks = [];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      c._vnode = newVNode;</span><br><span class="line">      <span class="keyword">if</span> (c._nextState == <span class="literal">null</span>) c._nextState = c.state;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸getDerivedStateFromProps ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">      <span class="keyword">if</span> (newType.getDerivedStateFromProps != <span class="literal">null</span>)</span><br><span class="line">        assign(c._nextState == c.state</span><br><span class="line">            ? (c._nextState = assign(&#123;&#125;, c._nextState)) <span class="comment">// æƒ°æ€§æ‹·è´</span></span><br><span class="line">            : c._nextState,</span><br><span class="line">          newType.getDerivedStateFromProps(newVNode.props, c._nextState),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (isNew) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ è°ƒç”¨æŒ‚è½½å‰çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// âš›ï¸ componentWillMount</span></span><br><span class="line">        <span class="keyword">if</span> (newType.getDerivedStateFromProps == <span class="literal">null</span> &amp;&amp; c.componentWillMount != <span class="literal">null</span>) c.componentWillMount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš›ï¸ componentDidMount</span></span><br><span class="line">        <span class="comment">// å°†ç»„ä»¶æ¨å…¥mountsæ•°ç»„ï¼Œåœ¨æ•´ä¸ªç»„ä»¶æ ‘diffå®Œæˆåæ‰¹é‡è°ƒç”¨, ä»–ä»¬åœ¨commitRootæ–¹æ³•ä¸­è¢«è°ƒç”¨</span></span><br><span class="line">        <span class="comment">// æŒ‰ç…§å…ˆè¿›åå‡º(æ ˆ)çš„é¡ºåºè°ƒç”¨, å³å­ç»„ä»¶çš„componentDidMountä¼šå…ˆè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (c.componentDidMount != <span class="literal">null</span>) mounts.push(c);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ è°ƒç”¨é‡æ–°æ¸²æŸ“ç›¸å…³çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// âš›ï¸ componentWillReceiveProps</span></span><br><span class="line">        <span class="keyword">if</span> (newType.getDerivedStateFromProps == <span class="literal">null</span> &amp;&amp; force == <span class="literal">null</span> &amp;&amp; c.componentWillReceiveProps != <span class="literal">null</span>)</span><br><span class="line">          c.componentWillReceiveProps(newVNode.props, cctx);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš›ï¸ shouldComponentUpdate</span></span><br><span class="line">        <span class="keyword">if</span> (!force &amp;&amp; c.shouldComponentUpdate != <span class="literal">null</span> &amp;&amp; c.shouldComponentUpdate(newVNode.props, c._nextState, cctx) === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="comment">// shouldComponentUpdateè¿”å›falseï¼Œå–æ¶ˆæ¸²æŸ“æ›´æ–°</span></span><br><span class="line">          c.props = newVNode.props;</span><br><span class="line">          c.state = c._nextState;</span><br><span class="line">          c._dirty = <span class="literal">false</span>;</span><br><span class="line">          newVNode._lastDomChild = oldVNode._lastDomChild;</span><br><span class="line">          <span class="keyword">break</span> outer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš›ï¸ componentWillUpdate</span></span><br><span class="line">        <span class="keyword">if</span> (c.componentWillUpdate != <span class="literal">null</span>) c.componentWillUpdate(newVNode.props, c._nextState, cctx);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸è‡³æ­¤propså’Œstateå·²ç»ç¡®å®šä¸‹æ¥ï¼Œç¼“å­˜å’Œæ›´æ–°propså’Œstateå‡†å¤‡æ¸²æŸ“</span></span><br><span class="line">      oldProps = c.props;</span><br><span class="line">      oldState = c.state;</span><br><span class="line">      c.props = newVNode.props;</span><br><span class="line">      c.state = c._nextState;</span><br><span class="line">      <span class="keyword">let</span> prev = c._prevVNode || <span class="literal">null</span>;</span><br><span class="line">      c._dirty = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸æ¸²æŸ“</span></span><br><span class="line">      <span class="keyword">let</span> vnode = (c._prevVNode = coerceToVNode(c.render(c.props, c.state)));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸getSnapshotBeforeUpdate</span></span><br><span class="line">      <span class="keyword">if</span> (!isNew &amp;&amp; c.getSnapshotBeforeUpdate != <span class="literal">null</span>) snapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ç»„ä»¶å±‚çº§ï¼Œä¼šå½±å“æ›´æ–°çš„ä¼˜å…ˆçº§</span></span><br><span class="line">      c._depth = ancestorComponent ? (ancestorComponent._depth || <span class="number">0</span>) + <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// âš›ï¸é€’å½’diffæ¸²æŸ“ç»“æœ</span></span><br><span class="line">      c.base = newVNode._dom = diff(parentDom, vnode, prev, mounts, c, <span class="literal">null</span>, oldDom);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (vnode != <span class="literal">null</span>) &#123;</span><br><span class="line">        newVNode._lastDomChild = vnode._lastDomChild;</span><br><span class="line">      &#125;</span><br><span class="line">      c._parentDom = parentDom;</span><br><span class="line">      <span class="comment">// âš›ï¸åº”ç”¨ref</span></span><br><span class="line">      <span class="keyword">if</span> ((tmp = newVNode.ref)) applyRef(tmp, c, ancestorComponent);</span><br><span class="line">      <span class="comment">// âš›ï¸è°ƒç”¨renderCallbacksï¼Œå³setStateçš„å›è°ƒ</span></span><br><span class="line">      <span class="keyword">while</span> ((tmp = c._renderCallbacks.pop())) tmp.call(c);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸componentDidUpdate</span></span><br><span class="line">      <span class="keyword">if</span> (!isNew &amp;&amp; oldProps != <span class="literal">null</span> &amp;&amp; c.componentDidUpdate != <span class="literal">null</span>) c.componentDidUpdate(oldProps, oldState, snapshot);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸æ¯”å¯¹ä¸¤ä¸ªDOMå…ƒç´ </span></span><br><span class="line">      newVNode._dom = diffElementNodes(oldVNode._dom, newVNode, oldVNode, mounts, ancestorComponent);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((tmp = newVNode.ref) &amp;&amp; oldVNode.ref !== tmp) applyRef(tmp, newVNode._dom, ancestorComponent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸æ•è·æ¸²æŸ“é”™è¯¯ï¼Œä¼ é€’ç»™ä¸Šçº§ç»„ä»¶çš„didCatchç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">    catchErrorInComponent(e, ancestorComponent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newVNode._dom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><hr><p><br></p><h3 id="diffelementnodes"><a href="#diffelementnodes" class="headerlink" title="diffElementNodes"></a>diffElementNodes</h3><p>æ¯”å¯¹ä¸¤ä¸ª DOM å…ƒç´ , æµç¨‹éå¸¸ç®€å•:</p><center><br>  <img src="/images/07/diffElementNodes-process.png" width="600"><br></center><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diffElementNodes</span>(<span class="params">dom, newVNode, oldVNode, mounts, ancestorComponent</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸åˆ›å»ºDOMèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (dom == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newVNode.type === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸æ–‡æœ¬èŠ‚ç‚¹, æ²¡æœ‰å±æ€§å’Œå­çº§ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">document</span>.createTextNode(newProps);</span><br><span class="line">    &#125;</span><br><span class="line">    dom = <span class="built_in">document</span>.createElement(newVNode.type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newVNode.type === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸æ–‡æœ¬èŠ‚ç‚¹æ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (oldProps !== newProps) dom.data = newProps;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (newVNode !== oldVNode) &#123;</span><br><span class="line">      <span class="comment">// newVNode !== oldVNode è¿™è¯´æ˜æ˜¯ä¸€ä¸ªé™æ€èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">let</span> oldProps = oldVNode.props || EMPTY_OBJ;</span><br><span class="line">      <span class="keyword">let</span> newProps = newVNode.props;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ dangerouslySetInnerHTMLå¤„ç†</span></span><br><span class="line">      <span class="keyword">let</span> oldHtml = oldProps.dangerouslySetInnerHTML;</span><br><span class="line">      <span class="keyword">let</span> newHtml = newProps.dangerouslySetInnerHTML;</span><br><span class="line">      <span class="keyword">if</span> (newHtml || oldHtml)</span><br><span class="line">        <span class="keyword">if</span> (!newHtml || !oldHtml || newHtml.__html != oldHtml.__html)</span><br><span class="line">          dom.innerHTML = (newHtml &amp;&amp; newHtml.__html) || <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸é€’å½’æ¯”å¯¹å­å…ƒç´ </span></span><br><span class="line">      diffChildren(dom, newVNode, oldVNode, context, mounts, ancestorComponent, EMPTY_OBJ);</span><br><span class="line">      <span class="comment">// âš›ï¸é€’å½’æ¯”å¯¹DOMå±æ€§</span></span><br><span class="line">      diffProps(dom, newProps, oldProps, isSvg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><hr><p><br></p><h3 id="diffprops"><a href="#diffprops" class="headerlink" title="diffProps"></a>diffProps</h3><p>diffProps ç”¨äºæ›´æ–° DOM å…ƒç´ çš„å±æ€§</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diffProps</span>(<span class="params">dom, newProps, oldProps, isSvg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(newProps).sort();</span><br><span class="line">  <span class="comment">// âš›ï¸æ¯”è¾ƒå¹¶è®¾ç½®å±æ€§</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> k = keys[i];</span><br><span class="line">    <span class="keyword">if</span> (k !== <span class="string">'children'</span> &amp;&amp; k !== <span class="string">'key'</span> &amp;&amp;</span><br><span class="line">      (!oldProps || (k === <span class="string">'value'</span> || k === <span class="string">'checked'</span> ? dom : oldProps)[k] !== newProps[k])) </span><br><span class="line">      setProperty(dom, k, newProps[k], oldProps[k], isSvg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸æ¸…ç©ºå±æ€§</span></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> oldProps)</span><br><span class="line">    <span class="keyword">if</span> (i !== <span class="string">'children'</span> &amp;&amp; i !== <span class="string">'key'</span> &amp;&amp; !(i <span class="keyword">in</span> newProps))</span><br><span class="line">      setProperty(dom, i, <span class="literal">null</span>, oldProps[i], isSvg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>diffProps å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯éå†ä¸€ä¸‹å±æ€§æœ‰æ²¡æœ‰å˜åŠ¨ï¼Œæœ‰å˜åŠ¨åˆ™é€šè¿‡ setProperty è®¾ç½®å±æ€§ã€‚å¯¹äºå¤±æ•ˆçš„ props ä¹Ÿä¼šé€šè¿‡ setProperty ç½®ç©ºã€‚è¿™é‡Œé¢ç¨å¾®æœ‰ç‚¹å¤æ‚çš„æ˜¯ setProperty. è¿™é‡Œæ¶‰åŠåˆ°äº‹ä»¶çš„å¤„ç†, å‘½åçš„è½¬æ¢ç­‰ç­‰:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setProperty</span>(<span class="params">dom, name, value, oldValue, isSvg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (name === <span class="string">'style'</span>) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸æ ·å¼è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">set</span> = assign(assign(&#123;&#125;, oldValue), value);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> <span class="keyword">set</span>) &#123;</span><br><span class="line">      <span class="comment">// æ ·å¼å±æ€§æ²¡æœ‰å˜åŠ¨</span></span><br><span class="line">      <span class="keyword">if</span> ((value || EMPTY_OBJ)[i] === (oldValue || EMPTY_OBJ)[i]) <span class="keyword">continue</span>;</span><br><span class="line">      dom.style.setProperty(</span><br><span class="line">        i[<span class="number">0</span>] === <span class="string">'-'</span> &amp;&amp; i[<span class="number">1</span>] === <span class="string">'-'</span> ? i : i.replace(CAMEL_REG, <span class="string">'-$&amp;'</span>),</span><br><span class="line">        value &amp;&amp; i <span class="keyword">in</span> value</span><br><span class="line">          ? <span class="keyword">typeof</span> <span class="keyword">set</span>[i] === 'number' &amp;&amp; IS_NON_DIMENSIONAL.test(i) === false</span><br><span class="line">            ? <span class="keyword">set</span>[i] + 'px'</span><br><span class="line">            : <span class="keyword">set</span>[i]</span><br><span class="line">          : '', // æ¸…ç©º</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else if (name[0] === 'o' &amp;&amp; name[1] === 'n') &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸äº‹ä»¶ç»‘å®š</span></span><br><span class="line">    <span class="keyword">let</span> useCapture = name !== (name = name.replace(<span class="regexp">/Capture$/</span>, <span class="string">''</span>));</span><br><span class="line">    <span class="keyword">let</span> nameLower = name.toLowerCase();</span><br><span class="line">    name = (nameLower <span class="keyword">in</span> dom ? nameLower : name).slice(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸é¦–æ¬¡æ·»åŠ äº‹ä»¶, æ³¨æ„è¿™é‡Œæ˜¯eventProxyä¸ºäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">      <span class="comment">// preactç»Ÿä¸€å°†æ‰€æœ‰äº‹ä»¶å¤„ç†å™¨æ”¶é›†åœ¨dom._listenerså¯¹è±¡ä¸­ï¼Œç»Ÿä¸€è¿›è¡Œåˆ†å‘</span></span><br><span class="line">      <span class="comment">// function eventProxy(e) &#123;</span></span><br><span class="line">      <span class="comment">//   return this._listeners[e.type](options.event ? options.event(e) : e);</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="keyword">if</span> (!oldValue) dom.addEventListener(name, eventProxy, useCapture);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ç§»é™¤äº‹ä»¶</span></span><br><span class="line">      dom.removeEventListener(name, eventProxy, useCapture);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¿å­˜äº‹ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    (dom._listeners || (dom._listeners = &#123;&#125;))[name] = value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name !== <span class="string">'list'</span> &amp;&amp; name !== <span class="string">'tagName'</span> &amp;&amp; name <span class="keyword">in</span> dom) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸DOMå¯¹è±¡å±æ€§</span></span><br><span class="line">    dom[name] = value == <span class="literal">null</span> ? <span class="string">''</span> : value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> value !== <span class="string">'function'</span> &amp;&amp;</span><br><span class="line">    name !== <span class="string">'dangerouslySetInnerHTML'</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸DOMå…ƒç´ å±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span> || value === <span class="literal">false</span>) &#123;</span><br><span class="line">      dom.removeAttribute(name);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dom.setAttribute(name, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p>ok è‡³æ­¤ Diff ç®—æ³•ä»‹ç»å®Œæ¯•ï¼Œå…¶å®è¿™é‡Œé¢çš„é€»è¾‘å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚, å½“ç„¶ preact åªæ˜¯ä¸€ä¸ªæåº¦ç²¾ç®€çš„æ¡†æ¶ï¼ŒReact å¤æ‚åº¦è¦é«˜å¾—å¤šï¼Œå°¤å…¶ React Fiber é‡æ„ä¹‹åã€‚ä½ ä¹Ÿå¯ä»¥æŠŠ preact å½“åš react çš„å†å²å›é¡¾ï¼Œæœ‰å…´è¶£å†æ·±å…¥äº†è§£ React çš„æœ€æ–°æ¶æ„ã€‚</p><p><br></p><hr><p><br></p><h2 id="hooks-çš„å®ç°"><a href="#hooks-çš„å®ç°" class="headerlink" title="Hooks çš„å®ç°"></a>Hooks çš„å®ç°</h2><p>React16.8 æ­£å¼å¼•å…¥çš„ hooksï¼Œè¿™ç©æ„å¸¦æ¥äº†å…¨æ–°çš„ React ç»„ä»¶å¼€å‘æ–¹å¼ï¼Œè®©ä»£ç å˜å¾—æ›´åŠ ç®€æ´ã€‚ <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a>è¿™ç¯‡æ–‡ç« å·²ç»æ­ç¤ºäº† hooks çš„åŸºæœ¬å®ç°åŸç†, å®ƒä¸è¿‡æ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚preact ä¹Ÿå®ç°äº† hooks æœºåˆ¶ï¼Œå®ç°ä»£ç ä¹Ÿå°±ç™¾æ¥è¡Œï¼Œè®©æˆ‘ä»¬æ¥ä½“ä¼šä½“ä¼š.</p><p>hooks åŠŸèƒ½æœ¬èº«æ˜¯æ²¡æœ‰é›†æˆåœ¨ preact ä»£ç åº“å†…éƒ¨çš„ï¼Œè€Œæ˜¯é€šè¿‡<code>preact/hooks</code>å¯¼å…¥</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">'preact'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'preact/hooks'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'mounted'</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello hooks&lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>preact æä¾›äº†<code>options</code>å¯¹è±¡å¯¹ preact è¿›è¡Œæ‰©å±•ï¼Œoptions ç±»ä¼¼äº Preact ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œåœ¨ diff è¿‡ç¨‹ä¸­è¢«è°ƒç”¨(ä¸ºäº†è¡Œæ–‡ç®€æ´ï¼Œä¸Šé¢çš„ä»£ç æˆ‘å¿½ç•¥æ‰äº†)ã€‚ä¾‹å¦‚:</p><!-- prettier-ignore-start --><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">diff</span>(<span class="params"><span class="regexp">/*...*/</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸å¼€å§‹diff</span></span><br><span class="line">  <span class="keyword">if</span> ((tmp = options.diff)) tmp(newVNode);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    outer: <span class="keyword">if</span> (oldVNode.type === Fragment || newType === Fragment) &#123;</span><br><span class="line">      <span class="comment">// Fragment diff</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> newType === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment">// è‡ªå®šä¹‰ç»„ä»¶diff</span></span><br><span class="line">      <span class="comment">// âš›ï¸å¼€å§‹æ¸²æŸ“</span></span><br><span class="line">      <span class="keyword">if</span> ((tmp = options.render)) tmp(newVNode);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line">        c.render(c.props, c.state, c.context),</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸æ•è·å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> ((tmp = options.catchRender) &amp;&amp; tmp(e, c)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// DOM element diff</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// âš›ï¸diffç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> ((tmp = options.diffed)) tmp(newVNode);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    catchErrorInComponent(e, ancestorComponent);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newVNode._dom;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><h3 id="usestate"><a href="#usestate" class="headerlink" title="useState"></a>useState</h3><p>å…ˆä» useState å¼€å§‹:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initialState</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸OKåªæ˜¯æ•°ç»„ï¼Œæ²¡æœ‰Magicï¼Œæ¯ä¸ªhooksè°ƒç”¨éƒ½ä¼šé€’å¢currenIndex, ä»å½“å‰ç»„ä»¶ä¸­å–å‡ºçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> hookState = getHookState(currentIndex++);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸ åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (!hookState._component) &#123;</span><br><span class="line">    hookState._component = currentComponent; <span class="comment">// å½“å‰ç»„ä»¶å®ä¾‹</span></span><br><span class="line">    hookState._value = [</span><br><span class="line">      <span class="comment">// âš›ï¸state, åˆå§‹åŒ–state</span></span><br><span class="line">      <span class="keyword">typeof</span> initialState === <span class="string">'function'</span> ? initialState() : initialState,</span><br><span class="line">      <span class="comment">// âš›ï¸dispatch</span></span><br><span class="line">      value =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> nextValue = <span class="keyword">typeof</span> value === <span class="string">'function'</span> ? value(hookState._value[<span class="number">0</span>]) : value;</span><br><span class="line">        <span class="keyword">if</span> (hookState._value[<span class="number">0</span>] !== nextValue) &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ ä¿å­˜çŠ¶æ€å¹¶è°ƒç”¨setStateå¼ºåˆ¶æ›´æ–°</span></span><br><span class="line">          hookState._value[<span class="number">0</span>] = nextValue;</span><br><span class="line">          hookState._component.setState(&#123;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hookState._value; <span class="comment">// [state, dispatch]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®åœ¨äº<code>getHookState</code>çš„å®ç°</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; options &#125; <span class="keyword">from</span> <span class="string">'preact'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> currentIndex; <span class="comment">// ä¿å­˜å½“å‰hookçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">let</span> currentComponent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸render é’©å­, åœ¨ç»„ä»¶å¼€å§‹æ¸²æŸ“ä¹‹å‰è°ƒç”¨</span></span><br><span class="line"><span class="comment">// å› ä¸ºpreactæ˜¯åŒæ­¥é€’å½’å‘ä¸‹æ¸²æŸ“çš„ï¼Œè€Œä¸”Javascriptæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°å¼•ç”¨å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line">options.render = <span class="function"><span class="params">vnode</span> =&gt;</span> &#123;</span><br><span class="line">  currentComponent = vnode._component; <span class="comment">// ä¿å­˜å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶</span></span><br><span class="line">  currentIndex = <span class="number">0</span>;                    <span class="comment">// å¼€å§‹æ¸²æŸ“æ—¶indexé‡ç½®ä¸º0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æš‚æ—¶å¿½ç•¥ï¼Œä¸‹é¢è®²åˆ°useEffectå°±èƒ½ç†è§£</span></span><br><span class="line">  <span class="comment">// æ¸…ç©ºä¸Šæ¬¡æ¸²æŸ“æœªå¤„ç†çš„Effect(useEffect)ï¼Œåªæœ‰åœ¨å¿«é€Ÿé‡æ–°æ¸²æŸ“æ—¶æ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬åœ¨å¼‚æ­¥é˜Ÿåˆ—ä¸­è¢«å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (currentComponent.__hooks) &#123;</span><br><span class="line">    currentComponent.__hooks._pendingEffects = handleEffects(</span><br><span class="line">      currentComponent.__hooks._pendingEffects,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸no magic!, åªæ˜¯ä¸€ä¸ªæ•°ç»„, çŠ¶æ€ä¿å­˜åœ¨ç»„ä»¶å®ä¾‹çš„_listæ•°ç»„ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHookState</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–æˆ–åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> hooks = currentComponent.__hooks ||</span><br><span class="line">    (currentComponent.__hooks = &#123;</span><br><span class="line">      _list: [],                  <span class="comment">// æ”¾ç½®çŠ¶æ€</span></span><br><span class="line">      _pendingEffects: [],        <span class="comment">// æ”¾ç½®å¾…å¤„ç†çš„effectï¼Œç”±useEffectä¿å­˜</span></span><br><span class="line">      _pendingLayoutEffects: [],  <span class="comment">// æ”¾ç½®å¾…å¤„ç†çš„layoutEffectï¼Œæœ‰useLayoutEffectä¿å­˜</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–°å»ºçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span> (index &gt;= hooks._list.length) &#123;</span><br><span class="line">    hooks._list.push(&#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hooks._list[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹:</p><center><br>  <img src="/images/07/useState.png" width="800"><br></center><p><br></p><h3 id="useeffect"><a href="#useeffect" class="headerlink" title="useEffect"></a>useEffect</h3><p>å†çœ‹çœ‹ useEffect å’Œ useLayoutEffect. useEffect å’Œ useLayouteEffect å·®ä¸å¤š, åªæ˜¯è§¦å‘ effect çš„æ—¶æœºä¸ä¸€æ ·ï¼ŒuseEffect åœ¨å®Œæˆæ¸²æŸ“åç»˜åˆ¶è§¦å‘ï¼Œè€Œ useLayoutEffect åœ¨ diff å®Œæˆåè§¦å‘:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> state = getHookState(currentIndex++);</span><br><span class="line">  <span class="keyword">if</span> (argsChanged(state._args, args)) &#123; <span class="comment">// âš›ï¸çŠ¶æ€å˜åŒ–</span></span><br><span class="line">    state._value = callback;</span><br><span class="line">    state._args = args;</span><br><span class="line">    currentComponent.__hooks._pendingEffects.push(state); <span class="comment">// âš›ï¸æ¨è¿›_pendingEffectsé˜Ÿåˆ—</span></span><br><span class="line">    afterPaint(currentComponent);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useLayoutEffect</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> state = getHookState(currentIndex++);</span><br><span class="line">  <span class="keyword">if</span> (argsChanged(state._args, args)) &#123; <span class="comment">// âš›ï¸çŠ¶æ€å˜åŒ–</span></span><br><span class="line">    state._value = callback;</span><br><span class="line">    state._args = args;</span><br><span class="line">    currentComponent.__hooks._pendingLayoutEffects.push(state); <span class="comment">// âš›ï¸æ¨è¿›_pendingLayoutEffectsé˜Ÿåˆ—</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹çœ‹å¦‚ä½•è§¦å‘ effect. useEffectå’Œä¸Šé¢çœ‹åˆ°çš„<code>enqueueRender</code>å·®ä¸å¤šï¼Œæ”¾è¿›ä¸€ä¸ªå¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œç”±<code>requestAnimationFrame</code>è¿›è¡Œè°ƒåº¦ï¼Œæ‰¹é‡å¤„ç†:</p><!-- prettier-ignore-start --><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äºä¸Šé¢æåˆ°çš„å¼‚æ­¥é˜Ÿåˆ—</span></span><br><span class="line">afterPaint = <span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!component._afterPaintQueued &amp;&amp; <span class="comment">// é¿å…ç»„ä»¶é‡å¤æ¨å…¥</span></span><br><span class="line">    (component._afterPaintQueued = <span class="literal">true</span>) &amp;&amp;</span><br><span class="line">    afterPaintEffects.push(component) === <span class="number">1</span> <span class="comment">// å¼€å§‹è°ƒåº¦</span></span><br><span class="line">  )</span><br><span class="line">    requestAnimationFrame(scheduleFlushAfterPaint);  <span class="comment">// ç”±requestAnimationFrameè°ƒåº¦</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scheduleFlushAfterPaint</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(flushAfterPaintEffects);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushAfterPaintEffects</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  afterPaintEffects.some(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">    component._afterPaintQueued = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (component._parentDom)</span><br><span class="line">      <span class="comment">// æ¸…ç©º_pendingEffectsé˜Ÿåˆ—</span></span><br><span class="line">      component.__hooks._pendingEffects = handleEffects(component.__hooks._pendingEffects);</span><br><span class="line">  &#125;);</span><br><span class="line">  afterPaintEffects = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleEffects</span>(<span class="params">effects</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…ˆæ¸…é™¤åè°ƒç”¨effect</span></span><br><span class="line">  effects.forEach(invokeCleanup); <span class="comment">// è¯·è°ƒç”¨æ¸…ç†</span></span><br><span class="line">  effects.forEach(invokeEffect);  <span class="comment">// å†è°ƒç”¨effect</span></span><br><span class="line">  <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeCleanup</span>(<span class="params">hook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (hook._cleanup) hook._cleanup();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeEffect</span>(<span class="params">hook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = hook._value();</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> result === <span class="string">'function'</span>) hook._cleanup = result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- prettier-ignore-end --><p><br></p><p>å†çœ‹çœ‹å¦‚ä½•è§¦å‘ LayoutEffect, å¾ˆç®€å•ï¼Œåœ¨diffå®Œæˆåè§¦å‘, è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">options.diffed = <span class="function"><span class="params">vnode</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> c = vnode._component;</span><br><span class="line">  <span class="keyword">if</span> (!c) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">const</span> hooks = c.__hooks;</span><br><span class="line">  <span class="keyword">if</span> (hooks) &#123;</span><br><span class="line">    hooks._pendingLayoutEffects = handleEffects(hooks._pendingLayoutEffects);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ğŸ‘Œï¼Œhooks åŸºæœ¬åŸç†åŸºæœ¬äº†è§£å®Œæ¯•, æœ€åè¿˜æ˜¯ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹å§ã€‚</p><center><br>  <img src="/images/07/hooks.png" width="800"><br></center><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><p>æ–‡ç« ç¯‡å¹…å¾ˆé•¿ï¼Œä¸»è¦æ˜¯å¤ªå¤šä»£ç äº†, æˆ‘è‡ªå·±ä¹Ÿä¸å–œæ¬¢çœ‹è¿™ç§æ–‡ç« ï¼Œæ‰€ä»¥æ²¡æœŸæœ›è¯»è€…ä¼šçœ‹åˆ°è¿™é‡Œ. åé¢æ–‡ç« å†æƒ³åŠæ³•æ”¹å–„æ”¹å–„. è°¢è°¢ä½ é˜…è¯»åˆ°è¿™é‡Œã€‚</p><p>æœ¬æœŸçš„ä¸»è§’æœ¬èº«æ˜¯ä¸€ä¸ªå°è€Œç¾çš„è§†å›¾æ¡†æ¶ï¼Œæ²¡æœ‰å…¶ä»–æŠ€æœ¯æ ˆ. è¿™é‡Œå°±å®‰åˆ©ä¸€ä¸‹preactä½œè€…<a href="https://github.com/developit" target="_blank" rel="noopener">developit</a>çš„å¦å¤–ä¸€äº›å°è€Œç¾çš„åº“å§.</p><ul><li><a href="https://github.com/developit/workerize" target="_blank" rel="noopener">Workerize</a> ä¼˜é›…åœ°åœ¨webWorkerä¸­æ‰§è¡Œå’Œè°ƒç”¨ç¨‹åº</li><li><a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> é›¶é…ç½®çš„åº“æ‰“åŒ…å·¥å…·</li><li><a href="https://github.com/developit/greenlet" target="_blank" rel="noopener">greenlet</a> å’Œworkerizeå·®ä¸å¤šï¼Œè¿™ä¸ªå°†å•ä¸ªå¼‚æ­¥å‡½æ•°æ”¾åˆ°webworkerä¸­æ‰§è¡Œï¼Œè€Œworkerizeæ˜¯å°†ä¸€ä¸ªæ¨¡å—</li><li><a href="https://github.com/developit/mitt" target="_blank" rel="noopener">mitt</a> 200byteçš„EventEmitter</li><li><a href="https://github.com/developit/dlv" target="_blank" rel="noopener">dlv</a> å®‰å…¨åœ°è®¿é—®æ·±åµŒå¥—çš„å¯¹è±¡å±æ€§ï¼Œç±»ä¼¼äºlodashçš„getæ–¹æ³•</li><li><a href="https://github.com/developit/snarkdown" target="_blank" rel="noopener">snarkdown</a> 1kbçš„markdown parser</li><li><a href="https://github.com/developit/unistore" target="_blank" rel="noopener">unistore</a> ç®€æ´ç±»ReduxçŠ¶æ€å®¹å™¨ï¼Œæ”¯æŒreactå’Œpreact</li><li><a href="https://github.com/developit/stockroom" target="_blank" rel="noopener">stockroom</a> åœ¨webWorkeræ”¯æŒçŠ¶æ€ç®¡ç†å™¨</li></ul><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://juejin.im/entry/59b9284a5188257e6571b9b4" target="_blank" rel="noopener">Preactï¼šInto the void 0ï¼ˆè¯‘ï¼‰</a></li><li><a href="https://auth0.com/blog/face-off-virtual-dom-vs-incremental-dom-vs-glimmer/" target="_blank" rel="noopener">React Virtual DOM vs Incremental DOM vs Emberâ€™s Glimmer: Fight</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;React çš„ä»£ç åº“ç°åœ¨å·²ç»æ¯”è¾ƒåºå¤§äº†ï¼ŒåŠ ä¸Š v16 çš„ Fiber é‡æ„ï¼Œå¾ˆå®¹æ˜“åˆå­¦è€…é™·å…¥ç»†èŠ‚çš„æ±ªæ´‹å¤§æµ·ï¼Œææ‡‚äº†ä¼šè®©äººè§‰å¾—è‡ªå·±å¾ˆç‰›é€¼ï¼Œæä¸æ‡‚å¾ˆå®¹æ˜“è®©äººå¤±å»ä¿¡å¿ƒ, æ€€ç–‘è‡ªå·±æ˜¯å¦åº”è¯¥ç»§ç»­æå‰ç«¯ã€‚é‚£ä¹ˆå°è¯•åœ¨æœ¬æ–‡è¿™é‡Œæ‰¾å›ä¸€ç‚¹è‡ªä¿¡å§(é«˜æ‰‹ç»•è·¯).&lt;/p&gt;
&lt;p&gt;Preact æ˜¯ R
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] ğŸ’…styled-components ğŸ’…</title>
    <link href="https://bobi.ink/2019/05/29/styled-components-map/"/>
    <id>https://bobi.ink/2019/05/29/styled-components-map/</id>
    <published>2019-05-28T16:00:00.000Z</published>
    <updated>2019-06-01T09:18:28.099Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="https://juejin.im/post/5cdad9c7f265da039b08915d" target="_blank" rel="noopener">React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 03 - æ ·å¼çš„ç®¡ç†</a>ä¸€æ–‡ä¸­å¹äº†ä¸€æ³¢ <a href="https://www.styled-components.com" target="_blank" rel="noopener">styled-components</a> åï¼Œæœ¬æ–‡æƒ³æ·±å…¥æ¥äº†è§£ä¸€ä¸‹ styled-components çš„åŸç†. å¦‚æœä½ å¯¹ styled-components è¿˜ä¸äº†è§£ï¼Œå»ºè®®å…ˆé˜…è¯»ä¸€ä¸‹å®˜æ–¹<a href="http://styled-components.com" target="_blank" rel="noopener">æ–‡æ¡£</a>æˆ–å‰é¢çš„æ–‡ç« .</p><blockquote><p>æœ¬æ–‡åŸºäº styled-components v4.13 ç‰ˆæœ¬</p></blockquote><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#ä»-tagged-template-literals-è¯´èµ·">ä» Tagged Template Literals è¯´èµ·</a></li><li><a href="#æºç å¯¼è¯»">æºç å¯¼è¯»</a><ul><li><a href="#1-å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡">1. å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</a></li><li><a href="#2-react-ç»„ä»¶çš„å°è£…">2. React ç»„ä»¶çš„å°è£…</a></li><li><a href="#3-æ ·å¼å’Œç±»åçš„ç”Ÿæˆ">3. æ ·å¼å’Œç±»åçš„ç”Ÿæˆ</a></li><li><a href="#4-dom-å±‚æ“ä½œ">4. DOM å±‚æ“ä½œ</a></li><li><a href="#5-æ€»ç»“">5. æ€»ç»“</a></li></ul></li><li><a href="#æŠ€æœ¯åœ°å›¾">æŠ€æœ¯åœ°å›¾</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="ä»-tagged-template-literals-è¯´èµ·"><a href="#ä»-tagged-template-literals-è¯´èµ·" class="headerlink" title="ä» Tagged Template Literals è¯´èµ·"></a>ä» Tagged Template Literals è¯´èµ·</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank" rel="noopener"><strong>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡(Tagged Template Literals)</strong></a>æ˜¯ ES6 æ–°å¢çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ <strong>è‡ªå®šä¹‰å­—ç¬¦ä¸²çš„å†…æ’(interpolation)è§„åˆ™</strong>, styled-components æ­£æ˜¯åŸºäºè¿™ä¸ªç‰¹æ€§æ„å»º:</p><center><br>  <img src="/images/06/styled-sample.png" width="400"><br></center><p>å®ƒçš„åŸç†éå¸¸ç®€å•ï¼Œæ‰€æœ‰é™æ€å­—ç¬¦ä¸²ä¼šè¢«æ‹†åˆ†å‡ºæ¥åˆå¹¶æˆä¸ºæ•°ç»„, ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥åˆ°ç›®æ ‡å‡½æ•°ï¼Œè€Œå†…æ’(interpolation)è¡¨è¾¾å¼çš„å€¼åˆ™ä¼šä½œä¸º rest å‚æ•°ä¼ å…¥:</p><center><br>  <img src="/images/06/tag-template.png" width="400"><br></center><p><strong>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡ç›¸æ¯”æ™®é€šçš„æ¨¡æ¿å­—é¢é‡æ›´åŠ çµæ´». æ™®é€šæ¨¡æ¿å­—ç¬¦ä¸²ä¼šå°†æ‰€æœ‰å†…æ’å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œ<code>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</code>åˆ™ç”±ä½ è‡ªå·±æ¥æ§åˆ¶</strong>:</p><center><br>  <img src="/images/06/tag-template-pros.png" width="600"><br></center><p>å› ä¸ºæ ‡ç­¾æ¨¡æ¿å­—ç¬¦ä¸²ç®€æ´çš„è¯­æ³•å’Œçµæ´»æ€§ï¼Œå®ƒæ¯”è¾ƒé€‚ç”¨äºä½œä¸º<code>DSL</code>, ä¸éœ€è¦åœ¨è¯­è¨€å±‚é¢è¿›è¡Œæ”¯æŒï¼Œæ¯”å¦‚å‰é˜µå­<a href="https://github.com/preactjs/preact" target="_blank" rel="noopener">preact</a>ä½œè€…å¼€å‘çš„<a href="https://github.com/developit/htm" target="_blank" rel="noopener">htm</a>, å£å·å°±æ˜¯â€å–ä»£ JSXï¼Œè€Œä¸”ä¸éœ€è¦ç¼–è¯‘å™¨æ”¯æŒâ€, é€šè¿‡è¿™ç§æ–¹å¼æ˜¯å¯ä»¥ä¼˜é›…åœ°å®ç°<a href="https://juejin.im/post/5ceacf09e51d454f73356cc4" target="_blank" rel="noopener">â€˜ä½ çš„ç½‘ç«™æˆ–è®¸ä¸éœ€è¦å‰ç«¯æ„å»ºâ€™</a>.</p><center><br>  <img src="/images/06/htm.png" width="700"><br></center><p>å¦ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯ <code>jest</code> çš„<a href="https://jestjs.io/docs/en/api#testeachtable-name-fn-timeout" target="_blank" rel="noopener"><code>è¡¨æ ¼æµ‹è¯•</code></a>, è¿™æ ·å½¢å¼å¯è¯»æ€§æ›´é«˜:</p><center><br>  <img src="/images/06/jest.png" width="700"><br></center><p>æ ‡ç­¾æ¨¡æ¿å­—é¢é‡çš„è„‘æ´è¿˜åœ¨ç»§ç»­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨æ¥å†™ markdownï¼Œå†ç”Ÿæˆ react ç»„ä»¶ã€‚é™äºç¯‡å¹…å°±ä¸å•°å—¦äº†</p><p>æ‰©å±•:</p><ul><li><a href="https://mxstbr.blog/2016/11/styled-components-magic-explained/" target="_blank" rel="noopener">The magic behind ğŸ’… styled-components</a></li></ul><p><br></p><hr><p><br></p><h2 id="æºç å¯¼è¯»"><a href="#æºç å¯¼è¯»" class="headerlink" title="æºç å¯¼è¯»"></a>æºç å¯¼è¯»</h2><p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹ styled-components çš„å®ç°ã€‚ä¸ºäº†è¡Œæ–‡ç®€æ´ï¼Œæˆ‘ä»¬åªå…³å¿ƒ styled-components çš„æ ¸å¿ƒé€»è¾‘ï¼Œæ‰€ä»¥æˆ‘å¯¹æºä»£ç è¿›è¡Œäº†å¤§é‡çš„ç®€åŒ–ï¼Œæ¯”å¦‚å¿½ç•¥æ‰æœåŠ¡ç«¯æ¸²æŸ“ã€ReactNative å®ç°ã€babel æ’ä»¶ç­‰ç­‰.</p><h3 id="1-å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡"><a href="#1-å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡" class="headerlink" title="1. å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡"></a>1. å¤„ç†æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</h3><p>å…ˆä» <code>styled</code> æ„é€ å‡½æ•°çœ‹èµ·:</p><center><br>  <img src="/images/06/styled-code.png" width="500"><br></center><p>styled æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªåŒ…è£…ç»„ä»¶ targetï¼Œè€Œæ ‡ç­¾æ¨¡æ¿å­—é¢é‡åˆ™ç”±<a href="https://www.styled-components.com/docs/api#css" target="_blank" rel="noopener"><code>css</code></a>å‡½æ•°è¿›è¡Œå¤„ç†çš„. è¿™ä¸ªå‡½æ•°åœ¨ styled-components ä¸­éå¸¸å¸¸ç”¨ï¼Œç±»ä¼¼äº <code>SCSS</code> çš„ <code>mixin</code> è§’è‰². <code>css</code> å‡½æ•°ä¼šæ ‡ç­¾æ¨¡æ¿å­—é¢é‡è§„èŒƒåŒ–, ä¾‹å¦‚:</p><center><br>  <img src="/images/06/css.png" width="750"><br></center><p> css å®ç°ä¹Ÿéå¸¸ç®€å•:</p><center><br>  <img src="/images/06/css-code.png" width="700"><br></center><p><code>interleave</code>å‡½æ•°å°†å°†é™æ€å­—ç¬¦ä¸²æ•°ç»„å’Œå†…æ’å€¼â€™æ‹‰é“¾å¼â€˜äº¤å‰åˆå¹¶ä¸ºå•ä¸ªæ•°ç»„, æ¯”å¦‚[1, 2] + [a, b]ä¼šåˆå¹¶ä¸º[1, a, 2, b]</p><p>å…³é”®åœ¨äºå¦‚ä½•å°†æ•°ç»„è¿›è¡Œæ‰å¹³åŒ–, è¿™ä¸ªç”± <code>flatten</code> å‡½æ•°å®ç°. flatten å‡½æ•°ä¼šå°†åµŒå¥—çš„ css(æ•°ç»„å½¢å¼)é€’å½’ concat åœ¨ä¸€èµ·ï¼Œå°† StyledComponent ç»„ä»¶è½¬æ¢ä¸ºç±»åå¼•ç”¨ã€è¿˜æœ‰å¤„ç† keyframe ç­‰ç­‰. æœ€ç»ˆå‰©ä¸‹é™æ€å­—ç¬¦ä¸²å’Œå‡½æ•°, è¾“å‡ºç»“æœå¦‚ä¸Šæ‰€ç¤ºã€‚</p><p><strong>å®é™…ä¸Š styled-components ä¼šè¿›è¡Œä¸¤æ¬¡ flattenï¼Œç¬¬ä¸€æ¬¡ flatten å°†èƒ½å¤Ÿé™æ€åŒ–çš„éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå°†åµŒå¥—çš„ css ç»“æ„æ‰“å¹³, åªå‰©ä¸‹ä¸€äº›å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åªèƒ½åœ¨è¿è¡Œæ—¶(æ¯”å¦‚åœ¨ç»„ä»¶æ¸²æŸ“æ—¶)æ‰§è¡Œï¼›ç¬¬äºŒæ¬¡æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œæ‹¿åˆ°å‡½æ•°çš„è¿è¡Œä¸Šä¸‹æ–‡(propsã€theme ç­‰ç­‰)å, æ‰§è¡Œæ‰€æœ‰å‡½æ•°ï¼Œå°†å‡½æ•°çš„æ‰§è¡Œç»“æœè¿›è¡Œé€’å½’åˆå¹¶ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ˜¯ä¸€ä¸ªçº¯å­—ç¬¦ä¸²æ•°ç»„</strong>. å¯¹äºæ ‡ç­¾æ¨¡æ¿å­—é¢é‡çš„å¤„ç†å¤§æ¦‚éƒ½æ˜¯è¿™ä¸ªè¿‡ç¨‹. çœ‹çœ‹ flatten çš„å®ç°:</p><center><br>  <img src="/images/06/flatten-code.png" width="700"><br></center><p>æ€»ç»“ä¸€ä¸‹æ ‡ç­¾æ¨¡æ¿å­—é¢é‡çš„å¤„ç†æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·å­:</p><center><br><img src="/images/06/flatten.png" width="700"><br></center><p><br></p><hr><p><br></p><h3 id="2-react-ç»„ä»¶çš„å°è£…"><a href="#2-react-ç»„ä»¶çš„å°è£…" class="headerlink" title="2. React ç»„ä»¶çš„å°è£…"></a>2. React ç»„ä»¶çš„å°è£…</h3><p>ç°åœ¨çœ‹çœ‹å¦‚ä½•æ„é€ å‡º React ç»„ä»¶ã€‚styled-components é€šè¿‡ createStyledComponent é«˜é˜¶ç»„ä»¶å°†ç»„ä»¶å°è£…ä¸º StyledComponent ç»„ä»¶:</p><center><br><img src="/images/06/create-component.png" width="800"><br></center><p>createStyledComponent æ˜¯ä¸€ä¸ªå…¸å‹çš„é«˜é˜¶ç»„ä»¶ï¼Œå®ƒåœ¨æ‰§è¡ŒæœŸé—´ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç»„ä»¶ id å’Œåˆ›å»º<code>ComponentStyle</code>å¯¹è±¡. ComponentStyle å¯¹è±¡ç”¨äºç»´æŠ¤ css å‡½æ•°ç”Ÿæˆçš„ cssRules, åœ¨è¿è¡Œæ—¶(ç»„ä»¶æ¸²æŸ“æ—¶)å¾—åˆ°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡åç”Ÿæˆæœ€ç»ˆçš„æ ·å¼å’Œç±»åã€‚</p><p>å†æ¥çœ‹çœ‹ StyledComponent çš„å®ç°, StyledComponent åœ¨ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œå°†å½“å‰çš„ props+theme ä½œä¸º context ä¼ é€’ç»™ ComponentStyleï¼Œç”Ÿæˆç±»å.</p><center><br><img src="/images/06/StyledComponent.png" width="800"><br></center><p><br></p><hr><p><br></p><h3 id="3-æ ·å¼å’Œç±»åçš„ç”Ÿæˆ"><a href="#3-æ ·å¼å’Œç±»åçš„ç”Ÿæˆ" class="headerlink" title="3. æ ·å¼å’Œç±»åçš„ç”Ÿæˆ"></a>3. æ ·å¼å’Œç±»åçš„ç”Ÿæˆ</h3><p>ä¸Šé¢çœ‹åˆ° StyleComponent é€šè¿‡ ComponentStyle ç±»æ¥æ„é€ æ ·å¼è¡¨å¹¶ç”Ÿæˆç±»å, ComponentStyle æ‹¿åˆ° context åï¼Œå†æ¬¡è°ƒç”¨ flatten å°† css rule æ‰å¹³åŒ–ï¼Œå¾—åˆ°ä¸€ä¸ªçº¯å­—ç¬¦ä¸²æ•°ç»„ã€‚é€šè¿‡ä½¿ç”¨ hash ç®—æ³•ç”Ÿæˆç±»å, å¹¶ä½¿ç”¨stylis å¯¹æ ·å¼è¿›è¡Œé¢„å¤„ç†. æœ€åé€šè¿‡ StyleSheet å¯¹è±¡å°†æ ·å¼è§„åˆ™æ’å…¥åˆ° DOM ä¸­</p><center><br><img src="/images/06/ComponentStyle.png" width="800"><br></center><p><a href="https://github.com/thysultan/stylis.js/blob/master/README.md" target="_blank" rel="noopener">stylis</a>æ˜¯ä¸€ä¸ª 3kb çš„è½»é‡çš„ CSS é¢„å¤„ç†å™¨, styled-components æ‰€æœ‰çš„ CSS ç‰¹æ€§éƒ½ä¾èµ–äºå®ƒï¼Œ ä¾‹å¦‚åµŒå¥—è§„åˆ™(<code>a {&amp;:hover{}}</code>)ã€å‚å•†å‰ç¼€ã€å‹ç¼©ç­‰ç­‰.</p><p><br></p><hr><p><br></p><h3 id="4-dom-å±‚æ“ä½œ"><a href="#4-dom-å±‚æ“ä½œ" class="headerlink" title="4. DOM å±‚æ“ä½œ"></a>4. DOM å±‚æ“ä½œ</h3><p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹ StyleSheet, StyleSheet è´Ÿè´£æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„æ ·å¼è§„åˆ™ï¼Œå¹¶æ’å…¥åˆ° DOM ä¸­</p><center><br><img src="/images/06/StyleSheet.png" width="800"><br></center><p>çœ‹çœ‹ç®€åŒ–ç‰ˆçš„ makeTag</p><center><br><img src="/images/06/makeTag.png" width="800"><br></center><p><br></p><hr><p><br></p><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h3><p>ä»£ç å¯èƒ½çœ‹æ™•äº†ï¼Œé€šè¿‡æµç¨‹å›¾æ¥æ¢³ç†ä¸€ä¸‹è¿‡ç¨‹.</p><blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://juejin.im/post/5cedb26451882566477b7235" target="_blank" rel="noopener">æŠ€æœ¯åœ°å›¾ - vue-cli</a>ä¸€ç‚¹ä»£ç ä¹Ÿæ²¡æœ‰ç½—åˆ—ï¼Œåªæœ‰ä¸€ä¸ªæµç¨‹å›¾, è¯»è€…å¯èƒ½ä¸€ä¸‹å­å°±å‚»çœ¼äº†, ä¸çŸ¥é“åœ¨è¯´äº›ä»€ä¹ˆ; è€Œä¸”è¿™ä¸ªæµç¨‹å›¾å¤ªå¤§ï¼Œåœ¨ç§»åŠ¨ç«¯ä¸å¥½é˜…è¯». è¿™æœŸç¨å¾®æ”¹è¿›ä¸€ä¸‹ï¼Œæ–°å¢â€™æºç å¯¼è¯»â€˜ä¸€èŠ‚ï¼Œä»£ç è¡¨è¾¾èƒ½åŠ›æ¯«æ— ç–‘é—®æ˜¯èƒœäºæµç¨‹å›¾çš„ï¼Œä½†æ˜¯ä»£ç ç›¸å¯¹æ¯”è¾ƒç»†èŠ‚çç¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ˜¯å°†ä»£ç è¿›è¡Œç®€åŒ–ï¼Œç•™ä¸‹æ ¸å¿ƒçš„é€»è¾‘ï¼Œç¬¬äºŒæ˜¯ä½¿ç”¨æµç¨‹å›¾è¡¨ç¤ºå¤§æ¦‚çš„ç¨‹åºæµç¨‹ï¼Œä»¥åŠæµç¨‹ä¸»ä½“ä¹‹é—´çš„å…³ç³».</p></blockquote><p><img src="/images/06/process.png" alt></p><p><br></p><p>å¦‚ä¸Šå›¾ styled-components ä¸»è¦æœ‰å››ä¸ªæ ¸å¿ƒå¯¹è±¡:</p><ul><li><strong>WrappedComponent</strong>: è¿™æ˜¯ createStyledComponent åˆ›å»ºçš„åŒ…è£…ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¿å­˜çš„è¢«åŒ…è£…çš„ targetã€å¹¶ç”Ÿæˆç»„ä»¶ id å’Œ ComponentStyle å¯¹è±¡</li><li><strong>StyledComponent</strong>: è¿™æ˜¯æ ·å¼ç»„ä»¶ï¼Œåœ¨å®ƒ render æ—¶ä¼šå°† props ä½œä¸º context ä¼ é€’ç»™ ComponentStyleï¼Œå¹¶ç”Ÿæˆç±»å</li><li><strong>ComponentStyle</strong>: è´Ÿè´£ç”Ÿæˆæœ€ç»ˆçš„æ ·å¼è¡¨å’Œå”¯ä¸€çš„ç±»åï¼Œå¹¶è°ƒç”¨ StyleSheet å°†ç”Ÿæˆçš„æ ·è¡¨æ³¨å…¥åˆ°æ–‡æ¡£ä¸­</li><li><strong>StyleSheet</strong>: è´Ÿè´£ç®¡ç†å·²ç”Ÿæˆçš„æ ·å¼è¡¨, å¹¶æ³¨å…¥åˆ°æ–‡æ¡£ä¸­</li></ul><p><br></p><p><strong>styled-components æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong></p><p>styled-components æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è®¡ç®— cssRuleï¼Œå¹¶è¿›è¡Œ hash è®¡ç®—å‡º classNameï¼Œå¦‚æœå·²ç»å¯¹åº”çš„ className è¿˜æ²¡æ’å…¥åˆ°æ ·å¼è¡¨ä¸­ï¼Œåˆ™ä½¿ç”¨ stylis è¿›è¡Œé¢„å¤„ç†ï¼Œå¹¶æ’å…¥åˆ°æ ·å¼è¡¨ä¸­; </p><p>å¦å¤– styled-components å¯¹é™æ€ cssRule(æ²¡æœ‰ä»»ä½•å†…æ’å‡½æ•°)è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå®ƒä»¬ä¸ä¼šç›‘å¬ ThemeContext å˜åŒ–, ä¸”åœ¨æ¸²æŸ“æ—¶ä¸ä¼šé‡æ–°è®¡ç®—ã€‚</p><p>é€šè¿‡è¿™äº›è§„åˆ™å¯ä»¥å¾—å‡ºä»¥ä¸‹æ€§èƒ½ä¼˜åŒ–çš„å»ºè®®:</p><ul><li><strong>é™æ€åŒ–çš„ cssRule æ€§èƒ½æ˜¯æœ€å¥½çš„</strong></li><li><p><strong>é™ä½ StyledComponent çŠ¶æ€å¤æ‚åº¦</strong>. styled-components å¹¶ä¸ä¼šå¯¹å·²æœ‰çš„ä¸å˜çš„æ ·å¼è§„åˆ™è¿›è¡Œå¤ç”¨ï¼Œä¸€æ—¦çŠ¶æ€å˜åŒ– styled-component ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„æ ·å¼è§„åˆ™å’Œç±»å. è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§å®ç°, é¿å…äº†æ ·å¼å¤ç”¨çš„å¤æ‚æ€§ï¼ŒåŒæ—¶ä¿æŒæ ·å¼çš„éš”ç¦»æ€§, é—®é¢˜å°±æ˜¯ä¼šäº§ç”Ÿæ ·å¼å†—ä½™ã€‚ ä¾‹å¦‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Foo = styled.div&lt;&#123; active: boolean &#125;&gt;`</span><br><span class="line">  color: red;</span><br><span class="line">  background: $&#123;props =&gt; (props.active ? &apos;blue&apos; : &apos;red&apos;)&#125;;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure><p>active åˆ‡æ¢ä¹‹é—´ä¼šç”Ÿæˆä¸¤ä¸ªç±»å:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.cQAOKL</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.kklCtT</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæŠŠ StyledComponent çœ‹åšæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œé‚£ä¹ˆ styled-components å¯èƒ½ä¼šä¸ºæ¯ä¸€ä¸ªå¯èƒ½çš„çŠ¶æ€ç”Ÿæˆç‹¬ç«‹çš„æ ·å¼. å¦‚æœ StyledComponent æ ·å¼å¾ˆå¤š, è€Œä¸”çŠ¶æ€æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆä¼šç”Ÿæˆå¾ˆå¤šå†—ä½™çš„æ ·å¼.</p></li><li><p>âŒ <strong>ä¸è¦ç”¨äºåŠ¨ç”»</strong>ã€‚ä¸Šé¢äº†è§£åˆ° styled-component ä¼šä¸ºæ¯ä¸ªçŠ¶æ€ç”Ÿæˆä¸€ä¸ªæ ·å¼è¡¨. åŠ¨ç”»ä¸€èˆ¬ä¼šæœ‰å¾ˆå¤šä¸­é—´å€¼ï¼Œåœ¨çŸ­æ—¶é—´å†…è¿›è¡Œå˜åŒ–ï¼Œå¦‚æœåŠ¨ç”»å€¼é€šè¿‡propsä¼ å…¥è¯¥StyledComponentæ¥åº”ç”¨æ ·å¼ï¼Œè¿™æ ·ä¼šç”Ÿæˆå¾ˆå¤šæ ·å¼ï¼Œæ€§èƒ½éå¸¸å·®:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Bar = styled.div&lt;&#123; width: boolean &#125;&gt;`</span><br><span class="line">  color: red;</span><br><span class="line">  // åƒä¸‡åˆ«è¿™ä¹ˆå¹²</span><br><span class="line">  width: $&#123;props =&gt; props.width&#125;;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure><p>è¿™ç§åŠ¨ç”»åœºæ™¯æœ€å¥½ä½¿ç”¨ style å†…è”æ ·å¼æ¥åš</p></li></ul><p><br></p><p>OK, è¡Œæ–‡ç»“æŸã€‚styled-components ä¸è¿‡å¦‚æ­¤æ˜¯å§ï¼Ÿ</p><p><br></p><hr><p><br></p><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><ul><li><strong>CSS ç›¸å…³</strong><ul><li>@emotion/unitless åˆ¤æ–­å±æ€§å€¼æ˜¯å¦éœ€è¦å•ä½</li><li>css-to-react-native å°† css è½¬æ¢ä¸º ReactNative style å±æ€§</li><li>âœ¨<a href="https://www.npmjs.com/package/bundlesize" target="_blank" rel="noopener">stylis</a> è½»é‡çš„ CSS é¢„å¤„ç†å™¨</li></ul></li><li><strong>React ç›¸å…³</strong><ul><li>@emotion/is-prop-valid åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•çš„ DOM å±æ€§</li><li><a href="https://www.npmjs.com/package/hoist-non-react-statics" target="_blank" rel="noopener">hoist-non-react-statics</a> æå‡Reactç»„ä»¶çš„é™æ€å±æ€§ï¼Œç”¨äºé«˜é˜¶ç»„ä»¶åœºæ™¯</li><li>âœ¨<a href="https://www.npmjs.com/package/react-is" target="_blank" rel="noopener">react-is</a>: åˆ¤æ–­å„ç§ React ç»„ä»¶ç±»å‹</li><li><a href="https://github.com/lelandrichardson/react-primitives#readme" target="_blank" rel="noopener">react-primitives</a> è¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€çš„åº“ï¼Œè¿™ä¸ªåº“è¯•å›¾å›´ç»•ç€æ„å»º React åº”ç”¨æå‡ºä¸€å¥—ç†æƒ³çš„åŸè¯­ï¼Œé€šä¿—çš„è¯´å°±æ˜¯é€šè¿‡å®ƒå¯ä»¥å¯¼å…¥ä¸åŒå¹³å°çš„ç»„ä»¶ã€‚</li><li><a href="https://github.com/ryanseddon/react-frame-component" target="_blank" rel="noopener">react-frame-component</a> å°†reactæ¸²æŸ“åˆ°iframeä¸­ã€‚ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„åº“</li><li><a href="https://www.npmjs.com/package/react-live" target="_blank" rel="noopener">react-live</a> reactå®æ—¶ç¼–è¾‘å™¨å’Œå±•ç¤ºï¼Œä¸»è¦ç”¨äºæ–‡æ¡£</li></ul></li><li><strong>æ„å»ºç›¸å…³</strong><ul><li><a href="https://github.com/siddharthkp/bundlesize#readme" target="_blank" rel="noopener">bundlesize</a> æ£€æŸ¥åŒ…å¤§å°</li><li><a href="https://github.com/codemod-js/codemod/blob/master/packages/cli/README.md" target="_blank" rel="noopener">codemod</a> ä½¿ç”¨babel-pluginæ¥é‡å†™Javascriptæˆ–Typescriptä»£ç ï¼Œ ä¸€èˆ¬ç”¨äºåˆ¶ä½œå‡çº§è„šæœ¬</li><li>âœ¨<a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> ä¸€ä¸ªé›¶é…ç½®çš„æ‰“åŒ…å™¨ï¼ŒåŸºäºRollupï¼Œå¯ä»¥ç”¨äºåº“çš„æ‰“åŒ…å’Œå¼€å‘, preactä½œè€…å¼€å‘å¿…å±ç²¾å“</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨&lt;a href=&quot;https://juejin.im/post/5cdad9c7f265da039b08915d&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 03 - æ ·å¼çš„ç®¡ç†&lt;/a&gt;ä¸€æ–‡ä¸­å¹äº†ä¸€æ³¢ &lt;a href=&quot;h
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] vue-cli</title>
    <link href="https://bobi.ink/2019/05/26/vue-cli-map/"/>
    <id>https://bobi.ink/2019/05/26/vue-cli-map/</id>
    <published>2019-05-25T16:00:00.000Z</published>
    <updated>2019-06-01T08:15:46.354Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä¸ªæ–°å¼€çš„â€™å®éªŒæ€§â€™æ–‡ç« ç³»åˆ—ï¼Œå¦‚å…¶åâ€˜æŠ€æœ¯åœ°å›¾â€™ï¼Œè¿™ä¸ªç³»åˆ—è®¡åˆ’å‰–æä¸€äº›å‰ç«¯å¼€æºé¡¹ç›®ï¼Œå¯èƒ½ä¼šæ¢è®¨è¿™äº›é¡¹ç›®çš„<strong>è®¾è®¡å’Œç»„ç»‡</strong>ã€æ•´ç†ä»–ä»¬ä½¿ç”¨åˆ°<strong>æŠ€æœ¯æ ˆ</strong>ã€‚ é¦–å…ˆæ‹¿<code>vue-cli</code>å°è¯•ç‰›åˆ€ï¼Œå†å†³å®šåç»­è¦ä¸è¦ç»§ç»­è¿™ä¸ªç³»åˆ—.</p><p><br></p><p>æˆ‘ä¸€ç›´åœ¨æ€è€ƒæˆ‘ä»¬ç¼–ç¨‹ä¸»è¦åœ¨åšä»€ä¹ˆï¼Ÿæˆ‘ä»¬æœ‰ä¸€å¤§éƒ¨åˆ†å·¥ä½œå°±æ˜¯é€‰æ‹©å„ç§å·¥å…·/åº“/æ¡†æ¶ï¼Œæ¥é»åˆä¸šåŠ¡. å·¥å…·å’Œåœºæ™¯è¶ŠåŒ¹é…ã€åŸç†äº†è§£è¶Šå¤šï¼Œè¿ç”¨è¶Šå¨´ç†Ÿï¼Œæˆ‘ä»¬æ•ˆç‡å¯èƒ½å°±è¶Šé«˜. è¿™ç§è¯´æ³•å¾ˆæœ‰äº‰è®®ï¼Œå°±åƒ<code>ç¨‹åº=ç®—æ³•+æ•°æ®ç»“æ„</code>ä¸èƒ½å®Œå…¨è¡¨è¾¾ç°ä»Šçš„è½¯ä»¶å·¥ç¨‹ä¸€æ ·, è¯´æˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯å †ç Œå·¥å…·ï¼Œé»åˆä¸šåŠ¡, ä¸€å®šç¨‹åº¦ä¸Šæœ‰è‡ªè´¬çš„æ„æ€ã€‚ ä½†è¿™ç¡®å®æ˜¯å¤§éƒ¨åˆ†ç¨‹åºå‘˜çš„çœŸå®å†™ç…§ã€‚</p><p>è¿™ç³»åˆ—æ–‡ç« å…¶å®æœ‰ç‚¹ç±»ä¼¼äº github ä¸Šé¢çš„<code>Awesome</code>é¡¹ç›®. è¿™äº› Awesome é¡¹ç›®å°±æ˜¯ä¸€ä¸ª<strong>ç”Ÿæ€å±•è§ˆé¦†</strong>, é‡Œé¢é¡¹ç›®ç³ç…æ»¡ç›®. å› ä¸ºæ•°é‡å¤ªå¤šäº†ï¼Œè€Œä¸”ç¼ºå°‘è¯„åˆ†æœºåˆ¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæˆ‘ä»¬ä¸å¯èƒ½ä¸€ä¸ªä¸ªå»æŸ¥çœ‹ï¼Œå¾ˆéš¾ä»ä¸­é€‰æ‹©ç¬¦åˆéœ€æ±‚çš„é¡¹ç›®(å½“ç„¶ä½ å¸¦ç€æ˜ç¡®çš„ç›®çš„ï¼Œä¸”ç›®æ ‡èŒƒå›´éå¸¸å°ï¼Œå¯èƒ½æ¯”è¾ƒæœ‰ç”¨)ã€‚</p><center><br><img src="/images/05/awesome.png" width="400"><br></center><p>æ˜¯å¦å¯ä»¥å°è¯•æ¢ä¸ªè§’åº¦ï¼Œ<strong>é€‰å–ä¸€äº›æœ‰è¶£çš„å¼€æºé¡¹ç›®ï¼Œçœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåº”ç”¨è¿™äº›å·¥å…·çš„, æœ‰åºçš„ç½—åˆ—å‡ºæ¥? å¯¹äºæœ‰ç›¸åŒåœºæ™¯çš„é¡¹ç›®, å‚è€ƒæˆ–è€…æ¨¡ä»¿ä»·å€¼å¯èƒ½ä¼šæ›´å¤§ä¸€äº›</strong>. è¿™äº›å¼€æºé¡¹ç›®å°±æ˜¯å·¨äººï¼Œç«™åœ¨å·¨äººè‚©è†€ä¸Šæ˜¾ç„¶çœäº‹å¤šäº†</p><p>åªæ˜¯æŠ€æœ¯æ ˆç½—åˆ—æœªå…è¿‡äºç®€å•ï¼Œç¬”è€…è¿˜å¸Œæœ›ä»è¿™äº›é¡¹ç›®ä¸­å­¦ç‚¹ä¸œè¥¿ï¼Œæ¯”å¦‚ä»–çš„è®¾è®¡å’Œé¡¹ç›®ç»„ç»‡. æˆ‘ä¼šå°è¯•ç®€åŒ–å’Œé€šä¿—è§£é‡Šé‡Œé¢çš„å…³é”®çŸ¥è¯†æˆ–äº®ç‚¹, ä½†æ˜¯ä¸æ±‚ç”šè§£ã€‚ä¸ºäº†é¿å…é™·å…¥ç»†èŠ‚æ³¥æ½­ï¼Œæˆ‘ä¼šå°½é‡ä½¿ç”¨å›¾å½¢åŒ–æ–¹å¼å±•ç¤ºä»–ä»¬ç¨‹åºæµç¨‹ï¼Œé¿å…æ‹˜æ³¥äºç»†èŠ‚ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠè¿™äº›æ–‡ç« ä½œä¸ºæ·±å…¥é˜…è¯»è¿™äº›é¡¹ç›®æºç çš„å¼•å¯¼</p><p>æˆ‘ä¹Ÿå¸Œæœ›è¯»è€…åŒæˆ‘äº¤æµåé¦ˆï¼Œå…±åŒå­¦ä¹ å’Œè¿›æ­¥ã€‚</p><p><br></p><hr><p><br></p><h2 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h2><p>è¯´åˆ° CLI, ä¸å¾—ä¸æ<a href="https://ruby-china.github.io/rails-guides/getting_started.html" target="_blank" rel="noopener">Rails</a>æ¡†æ¶ï¼Œå®ƒå¯èƒ½æ˜¯<em>æ¡†æ¶æä¾› CLI çš„å…ˆç¥–</em>(å…·ä½“å†å²æ²¡æœ‰æ·±å…¥è€ƒç©¶). Rails æœ‰ä¸€ä¸ªé‡è¦çš„æŒ‡å¯¼æ€æƒ³ï¼Œå³<strong>çº¦å®šå¤§äºé…ç½®</strong>, <strong>å®ƒä¸º Web åº”ç”¨çš„å¤§å¤šæ•°éœ€æ±‚éƒ½æä¾›äº†æœ€å¥½çš„è§£å†³æ–¹æ³•ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨è¿™äº›çº¦å®šï¼Œè€Œä¸æ˜¯åœ¨é•¿é•¿çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ¯ä¸ªç»†èŠ‚</strong>ã€‚</p><p><strong>CLI ä¹Ÿæ˜¯è¿™ä¸ªæŒ‡å¯¼æ€æƒ³ä¸‹çš„äº§ç‰©</strong>, ä¾‹å¦‚é€šè¿‡å®ƒæä¾›çš„ CLIï¼Œå¯ä»¥åœ¨<a href="https://ruby-china.github.io/rails-guides/getting_started.html" target="_blank" rel="noopener">15 åˆ†é’Ÿå†…æ„å»ºä¸€ä¸ªç®€æ˜“çš„åšå®¢</a>, å¯ä»¥é€šè¿‡ CLI å¯åŠ¨æœåŠ¡å™¨å’Œ REPLã€ç”Ÿæˆé¡¹ç›®è„šæ‰‹æ¶ã€ç”Ÿæˆä»£ç æ–‡ä»¶ã€è·¯ç”±ã€æ•°æ®åº“è¿ç§»ç­‰ç­‰:</p><center><br>  <img src="/images/05/rails-cli.png" width="500"><br></center><p>Rails çš„å¾ˆå¤šè®¾è®¡åœ¨é‚£ä¸ªå¹´ä»£å°±æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜æ˜Ÿ(é—ªç PHPã€JSPã€ ASPâ€¦, æƒ³æƒ³è¦é…ç½®å„ç§æœåŠ¡å™¨ï¼Œå„ç§ xml æ–‡ä»¶)ï¼Œå®ƒçš„å¾ˆå¤šè®¾è®¡æ¨¡å¼æ·±åˆ»å½±å“äº†åé¢çš„ web æ¡†æ¶ï¼Œæ¯”å¦‚ Djangoã€Laravel, ç”šè‡³å¾ˆå¤šæ¨¡ä»¿ Rails å‘½åçš„ï¼Œå¦‚ Sailsã€Grails.</p><p>Rails å¯¹äºå‰ç«¯å¼€å‘å½±å“ä¹Ÿå¾ˆæ·±è¿œï¼Œæ¯”å¦‚åœ¨ Nodejs å‡ºæ¥ä¹‹å‰ï¼ŒRails ç¤¾åŒºå°±å¼€å§‹ä½¿ç”¨ <code>coffeescript + sass</code>é¢„ç¼–è¯‘è¯­è¨€è¿›è¡Œå‰ç«¯å¼€å‘äº†, <a href="https://ruby-china.github.io/rails-guides/asset_pipeline.html" target="_blank" rel="noopener">Asset Pipeline</a>å¯ä»¥è¯´æ˜¯æœ€æ—©çš„â€™å‰ç«¯å·¥ç¨‹åŒ–â€™, é…åˆ<a href="https://github.com/turbolinks/turbolinks" target="_blank" rel="noopener">Turbolink</a>å¯ä»¥è®©ä¼ ç»Ÿåç«¯æ¸²æŸ“é¡µé¢æ‹¥æœ‰ä¸äºšäºå•é¡µåº”ç”¨çš„ç”¨æˆ·ä½“éªŒâ€¦</p><p>å½“åˆ Rails ç»™æˆ‘å¸¦æ¥çš„å„ç§éœ‡æ’¼è¿˜å†å†åœ¨ç›®, <a href="https://ruby-china.org" target="_blank" rel="noopener">Ruby China ç¤¾åŒº</a>ä¹Ÿæ˜¯å›½å†…æœ€å¥½ç¤¾åŒºä¹‹ä¸€. ä½†æ˜¯ç›®å‰ Rails çš„å…³æ³¨åº¦ä¸å¦‚ä»å‰, åœ¨å‰ç«¯ç¤¾åŒºåƒ Rails è¿™ç§é›†å¤§æˆçš„æ¡†æ¶ä¹Ÿæ—©å·²ä¸åƒé¦™(å‚è€ƒ Ember, æŸç§ç¨‹åº¦ä¸Š Angular ä¹Ÿç®—å§?).</p><p>è¯´å®åœ¨è¯å¦‚æœä¸€ç”Ÿåªå­¦ä¸€é—¨è¯­è¨€ï¼Œæˆ‘ä¼šé€‰ Rubyï¼Œå¦‚æœé€‰ä¸€ä¸ª web æ¡†æ¶ï¼Œé‚£å°±æ˜¯ Railsã€‚</p><p>æ¨èå¤§å®¶é˜…è¯»<a href="https://ruby-china.org/wiki/the-rails-doctrine" target="_blank" rel="noopener">The Rails Doctrine - Rails ä¿¡æ¡</a> è¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰ä¸€å¥è¯ç¬”è€…éå¸¸å–œæ¬¢: <strong>â€œåªè¦æ”¾ä¸‹äº†è‡ªè´Ÿçš„ä¸ªäººå–œå¥½ï¼Œä¾¿å¯ä»¥è·³è¿‡æ— è°“çš„ä¸–ä¿—å†³å®šï¼Œä¸“æ³¨åœ¨æœ€é‡è¦çš„åœ°æ–¹ä¸‹æ›´å¿«çš„å†³å®šã€‚â€</strong>ã€‚ä¸ºäººå†™ç¨‹åºï¼Œè€Œä¸æ˜¯ä¸ºäº†æœºå™¨å†™ç¨‹åº.</p><p><strong>çº¦å®šå¤§äºé…ç½®</strong>å¯ä»¥å‡å°‘æˆ‘ä»¬åšå†³å®šçš„æ•°é‡ï¼Œå‡å°‘æ— è°“çš„äº‰è®ºå’Œè€ƒè™‘ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºæ›´é‡è¦çš„äº‹æƒ…. è¿™ä¸ªåŸåˆ™å¯ä»¥æé«˜å¼€å‘å’Œå›¢é˜Ÿåä½œæ•ˆç‡, ç”šè‡³å¯ä»¥å‡èšä¸€ä¸ªç¤¾åŒº.</p><p>ä»¥ Webpack ä¸ºä¾‹ï¼Œæ¶å¿ƒå¤æ‚çš„é…ç½®è¢«äººè¯Ÿç—…ï¼Œæ‰€ä»¥æ‰éœ€è¦ vue-cli æˆ–è€… create-react-app è¿™äº›å·¥å…·.</p><blockquote><p>æ²¡æœ‰ç”¨ Ruby/Rails å·¥ä½œè¿‡, é»˜é»˜å†™äº†ä¸ª Ruby China å°ç¨‹åº(å¾®ä¿¡æœ<code>Ruby CN</code>)ï¼Œç®—æ˜¯æ„Ÿæ©å›é¦ˆç¤¾åŒºå§</p></blockquote><p><br></p><p>Ok, å¿ä¸ä½å¹äº†ä¸€æ³¢ Rails, å›åˆ°æ­£é¢˜.</p><p>ç¬”è€…æ˜¯ä½¿ç”¨ React ä½œä¸ºä¸»åŠ›å¼€å‘çš„ï¼ŒVue ä¹Ÿæ˜¯æˆ‘éå¸¸å–œæ¬¢çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¸è¯´åˆ«çš„ï¼Œåœ¨å¼€å‘è€…çš„â€™ç”¨æˆ·ä½“éªŒâ€™æ–¹é¢ Vue æ˜¯æˆ‘è§è¿‡æœ€å¥½ä¹‹ä¸€ï¼Œä¸»è¦ä½“ç°åœ¨ API çš„ç®€æ´æ€§å’Œæ˜“ç”¨æ€§ã€æ–‡æ¡£è¿˜æœ‰é¡¹ç›®æ„å»ºå·¥å…·(ä»Šå¤©çš„ä¸»è§’).</p><p>vue-cli-ui æ˜¯æˆ‘æƒ³å†™è¿™ç³»åˆ—æ–‡ç« çš„åŠ¨æœºä¹‹ä¸€. å‰é˜µå­ç”¨äº†ä¸€ä¸‹<code>vue-cli-ui</code>, æ„Ÿè§‰å¾ˆä¸é”™, æ”¯æŒå¯è§†åŒ–é…ç½®å’Œä»»åŠ¡è¿è¡Œï¼Œæ¯”æˆ‘åœ¨ç»ˆç«¯ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸€ä¸ªé¡¹ç›®è·‘ task æ¸…çˆ½å¤šäº†. å¾ˆæƒ³åœ¨æˆ‘ä»¬è‡ªå®¶çš„æ„å»ºå·¥å…·ä¸Šä¹Ÿæä¸€å¥—ï¼Œæ€æï¼Ÿ å­¦ä¹ å®ƒçš„æºç , æˆ‘è§‰å¾—å¯ä»¥ä½œä¸ºåšå®¢è®°å½•ä¸‹æ¥.</p><p>ç°åœ¨å‰ç«¯å·¥ç¨‹å¸ˆä¹Ÿæœ‰â€˜webpack é…ç½®å·¥ç¨‹å¸ˆâ€™çš„æˆç§°ï¼Œè¿™èƒ½è¯´æ˜ webpack é…ç½®æ˜¯è´¹æ—¶è´¹åŠ›çš„è‹¦äº‹(Angular ä¾‹å¤–). è¿™ä¸åæ¥å°±æœ‰äº†<code>parcel</code>å®£ç§°é›¶é…ç½®çš„è½®å­, è¿˜æœ‰ React ç¤¾åŒºçš„<code>create-react-app</code>, vue-cli å‰æœŸæ˜¯åŸºäºæ¨¡æ¿çš„åˆ›å»ºé¡¹ç›®, ä¸ç®—æ­¤åˆ—ã€‚</p><p>åæ¥ vue-cli æ±²å–ç€å‰è€…çš„å¾ˆå¤šä¼˜ç‚¹ï¼ŒæŠŠè¿™å—åšå¤§åšä¼˜äº†(çœ‹æ¥ vue å¾ˆæ“…é•¿åšè¿™äº›äº‹æƒ…). æˆ‘ä»¬å¯ä»¥æ¥å¯¹æ¯”ä¸€ä¸‹è¿™äº›å·¥å…·:</p><p><br></p><table><thead><tr><th></th><th>Vue CLI</th><th>create-react-app</th><th>parcel</th></tr></thead><tbody><tr><td>å¿«é€ŸåŸå‹å¼€å‘</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>å…¨å±€æ¨¡å¼</td><td>é›¶é…ç½®åŸå‹å¼€å‘å°±æ˜¯å…¨å±€çš„</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>æ’ä»¶</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒï¼Œæ‰©å±•æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶è¾“å‡º</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¼ºï¼Œé€šè¿‡æ’ä»¶æ‰©å±• wepack é…ç½®</td><td>å¼±, å¼ºçº¦å®š, æ— æ³•é…ç½® webpackï¼Œå¯ä»¥ eject, ç„¶åæ‰‹å·¥é…ç½®ï¼›æ”¯æŒ babel-macro;(ä¸¥æ ¼è¯´å¯ä»¥é€šè¿‡<a href="https://github.com/timarney/react-app-rewired" target="_blank" rel="noopener">react-app-rewired</a>è¿›è¡Œæ‰©å±•)</td><td>ä¸­(å¯ä»¥é…ç½® babelï¼Œpostcssï¼ŒTypescript); æä¾›äº† Node API; æ”¯æŒæ’ä»¶æ‰©å±•æ–‡ä»¶ç±»å‹</td></tr><tr><td>å¤šé¡µé¢</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>é€‚ç”¨èŒƒå›´</td><td>Vue ç»„ä»¶çš„ç¬¬ä¸€å…¬æ°‘ã€‚é€šè¿‡æ‰©å±•å¯ä»¥æ”¯æŒä»»æ„å‰ç«¯æ¡†æ¶</td><td>é’ˆå¯¹ React å¼€å‘ï¼Œä¸æ”¯æŒå…¶ä»–æ¡†æ¶</td><td>parcel æ˜¯ä¸€ä¸ªé€šç”¨çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„ç«äº‰å¯¹æ‰‹æ˜¯ webpack</td></tr><tr><td>ç¼–è¯‘é€Ÿåº¦</td><td>cache-loader,thread-loader æ¥åŠ é€Ÿ JS å’Œ TS ç¼–è¯‘</td><td>babel-loader å¼€å¯äº† cache</td><td>ç¼–è¯‘é€Ÿåº¦å·ç§°æ˜¯ webpack çš„ä¸¤å€</td></tr><tr><td>å¯å‡çº§æ€§</td><td>æ”¯æŒå‡çº§ cli-service, æ’ä»¶éœ€è¦å•ç‹¬å‡çº§, æ’ä»¶éœ€è¦éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬. å¤ªå¤šæ’ä»¶å­˜åœ¨å‡çº§é£é™©</td><td>æ”¯æŒå‡çº§ react-script, å®˜æ–¹ç»´æŠ¤ï¼Œä¸”å¼ºçº¦å®šåŸºæœ¬å¯ä»¥ä¿éšœå‘ä¸‹å…¼å®¹</td><td>æ”¯æŒå‡çº§ parcel-bundler</td></tr><tr><td>UI</td><td>å›¾å½¢åŒ–ç®¡ç†æ˜¯ CLI çš„ç‰¹è‰²ä¹‹ä¸€</td><td>-</td><td>-</td></tr></tbody></table><p><br></p><p>é€šè¿‡ä¸Šé¢çš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡º <strong>vue-cli æ˜¯ä¸€ä¸ªæ‰©å±•æ€§éå¸¸å¼ºçš„æ„å»ºå·¥å…·ï¼Œä»¥è‡´äºå®ƒä¸ä»…é™äº Vueï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ„å»º React ç”šè‡³å…¶ä»–å‰ç«¯æ¡†æ¶</strong>ã€‚</p><p>ç›¸æ¯”è€Œè¨€ <code>create-react-app</code> å°±æ˜¯ä¸€ä¸ªéå¸¸ Opinionated(åšæŒå·±è§) çš„å·¥å…·ï¼Œå¼ºçº¦å®š. ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯å®ƒä¸å†…ç½®å¼€å¯ babel è£…é¥°å™¨è½¬è¯‘ï¼ŒCRA å›¢é˜Ÿè®¤ä¸ºå·²ç»åºŸå¼ƒ(æˆ–è€…ä¸æˆç†Ÿ)çš„è¯­è¨€ç‰¹æ€§ä¸åº”è¯¥å¸¦åˆ° CRA ä¸­; åé¢ä¸ºäº†ç»™â€˜ä¼˜é›…â€™åœ°ç»™ babel æ‰©å±•æ’ä»¶ï¼Œå°±æ£é¼“å‡ºæ¥äº†<code>babel-macro</code>, è¿™æ˜¯ä¸€ç§â€™å…é…ç½®â€™çš„ babel æ’ä»¶è§„èŒƒ.</p><p>è¿™ç§å¼ºçº¦å®šä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼Œæ¯”å¦‚ä¸éœ€è¦ç®¡ç†é…ç½®; è€Œä¸” CRA å›¢é˜Ÿè°¨æ…å¯é åœ°ç»´æŠ¤ç€ CRAï¼Œè¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ä¸€èˆ¬æ— ç—›åœ°å‡çº§ CRA. å¦‚æœè¦æ‰©å±• webpackï¼Œä¸€èˆ¬åªæœ‰ ejectï¼Œè¿™å°±èµ°å›äº†æ‰‹åŠ¨é…ç½® webpack çš„è€è·¯, ä¸å¯å–.</p><p>vue-cli ä¹Ÿæ˜¯ä¸€ä¸ªâ€™æ¸è¿›å¼â€™çš„ cliï¼Œvue-cli æä¾›äº†é»˜è®¤çš„ presetï¼Œä½†ä¸é˜»æ­¢ä½ å¯¹å…¶è¿›è¡Œæ‰©å±•. vue-cli çš„æ‰©å±•æ¥å£ä¹Ÿéå¸¸ç®€æ´(åˆç†, ä¸å¤šä¸å°‘), è¿˜æœ‰ UI ç®¡ç†ç•Œé¢ï¼Œå¯è§†åŒ–ç®¡ç†é¡¹ç›®çš„é…ç½®å’Œæ’ä»¶ï¼Œç”¨æˆ·ä½“éªŒå¾ˆæ£’ï¼Œè®¡åˆ’åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç» vue ui. å”¯ä¸€æ¯”è¾ƒä¸èˆ’æœçš„æ˜¯å¦‚æœæ»¥ç”¨è¿™ç§æ‰©å±•æ€§ï¼Œè£… N å¤šæ’ä»¶ï¼Œè€Œä¸”æ’ä»¶ä¹‹é—´è¿˜å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œä¹Ÿä¼šæˆä¸ºå‡çº§ç»´æŠ¤çš„è´Ÿæ‹….</p><p><br></p><hr><p><br></p><h2 id="åŸºæœ¬è®¾è®¡"><a href="#åŸºæœ¬è®¾è®¡" class="headerlink" title="åŸºæœ¬è®¾è®¡"></a>åŸºæœ¬è®¾è®¡</h2><p>æ³¨æ„ï¼Œæœ¬æ–‡ä¸æ˜¯ vue-cli çš„æ•™ç¨‹ï¼Œæœ€å¥½çš„æ•™ç¨‹æ˜¯<a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#prompts" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>.</p><p><br></p><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p>ä¸‹é¢æ˜¯ vue-cli çš„åŸºæœ¬ç›®å½•ç»“æ„. å¤§éƒ¨åˆ†å¤§å‹çš„å‰ç«¯é¡¹ç›®éƒ½ä½¿ç”¨ lerna å®ç° mono-repo æ¨¡å¼, ç„¶åç»Ÿä¸€åˆ†å‘åˆ° npm. è¿™ç§æ¨¡å¼æœ‰åˆ©äºé¡¹ç›®æ¨¡å—ç»„ç»‡</p><center><br>  <img src="/images/05/vue-cli-struct.png" width="700"><br></center><p><br></p><h3 id="åˆ†ç¦»-cli-å±‚å’Œ-service-å±‚"><a href="#åˆ†ç¦»-cli-å±‚å’Œ-service-å±‚" class="headerlink" title="åˆ†ç¦» CLI å±‚å’Œ Service å±‚"></a><strong>åˆ†ç¦» CLI å±‚å’Œ Service å±‚</strong></h3><p>è¿™ä¸ªè®¾è®¡æ˜¯å€Ÿé‰´<code>create-react-app</code>çš„, CLI å±‚åªæ˜¯ä¸€äº›åŸºç¡€çš„å‘½ä»¤ä¸€èˆ¬ä¸éœ€è¦é¢‘ç¹å‡çº§ï¼Œè€Œä¸”æ˜¯å…¨å±€å®‰è£…; è€Œ Service å±‚æ˜¯å¤šå˜çš„, ä½œä¸ºé¡¹ç›®çš„å±€éƒ¨ä¾èµ–ï¼Œä¸åº”è¯¥ç¡¬ç¼–ç åœ¨ CLI é‡Œé¢. CLI å’Œ Service çš„èŒè´£åˆ’åˆ†å¦‚ä¸‹:</p><p><br></p><ul><li><p>CLI: ç”¨äºé¡¹ç›®åˆ›å»ºå’Œç®¡ç†</p><ul><li>å…¨å±€å®‰è£…</li><li><code>vue create</code> åˆ›å»ºé¡¹ç›®è„šæ‰‹æ¶. æ‹‰å–æœ€æ–°çš„ Serviceï¼Œå¹¶é€‰æ‹©é…ç½®éœ€è¦çš„æ’ä»¶</li><li><code>vue ui</code>. å¯åŠ¨ UI ç®¡ç†ç•Œé¢</li><li>å¿«é€ŸåŸå‹å¼€å‘: <code>vue serve</code> | <code>vue build</code>, ç›´æ¥ä¼ºæœå’Œç¼–è¯‘ä¸€ä¸ª Vue æ–‡ä»¶</li><li>æ’ä»¶ç®¡ç†: <code>vue add</code> | <code>vue invoke</code> å®‰è£…æ’ä»¶å’Œè°ƒç”¨æ’ä»¶ç”Ÿæˆå™¨</li></ul></li><li><p>Service: è´Ÿè´£é¡¹ç›®çš„å®é™…æ„å»º</p><ul><li>å±€éƒ¨å®‰è£…</li><li>é›†æˆ webpack æ„å»ºç¯å¢ƒï¼Œ<strong>Service æœ¬èº«åªæœ‰ä¸€ä¸ªæ’ä»¶æœºåˆ¶, æ‰€æœ‰æ„å»ºç›¸å…³é€»è¾‘éƒ½ç”±å†…ç½®æ’ä»¶å’Œå¤–éƒ¨æ’ä»¶æä¾›</strong></li><li>å†…ç½®æ’ä»¶(å‘½ä»¤): serve, build, inspect</li></ul></li></ul><p><br><br><br></p><h3 id="æ’ä»¶ç³»ç»Ÿ"><a href="#æ’ä»¶ç³»ç»Ÿ" class="headerlink" title="æ’ä»¶ç³»ç»Ÿ"></a><strong>æ’ä»¶ç³»ç»Ÿ</strong></h3><p>vue-cli æä¾›äº†ç±»ä¼¼ babelã€eslint çš„æ’ä»¶æœºåˆ¶ã€‚</p><center><br>  <img src="/images/05/plugins.png" width="400"><br></center><p><br></p><h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a><strong>æ’ä»¶</strong></h4><p>æ’ä»¶æœºåˆ¶æ˜¯ vue-cli çš„æ ¸å¿ƒ, ç”¨äºæ‰©å±• Service. Service çš„<code>å‘½ä»¤</code>å’Œ webpack é…ç½®éƒ½ç”±æ’ä»¶æä¾›.</p><p>å…¶å®æ’ä»¶æœºåˆ¶æœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯éš¾åº¦, æ¢å¥è¯è¯´<strong>æ’ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªåè®®çš„è®¾è®¡</strong>. vue-cli æ’ä»¶çš„åè®®å¦‚ä¸‹:</p><ul><li><strong>å‘½å</strong>: <code>@vue/cli-plugin-*</code>æˆ–<code>vue-cli-plugin-*</code>. package.json ä¸­æŒ‰ç€è¿™ä¸ªå‘½åçº¦å®šçš„ä¾èµ–ä¼šè¢«è¯†åˆ«ä¸º vue-cli æ’ä»¶ï¼Œå¦å¤–å‘½åçº¦å®šä¹Ÿæœ‰åˆ©äºåœ¨ github æˆ– npm ä¸Šç­›é€‰</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>:<br>ä¸€ä¸ªæ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸º<code>å®‰è£…é˜¶æ®µ</code>å’Œ<code>è¿è¡Œé˜¶æ®µ</code>. <code>vue create</code>å‘½ä»¤åˆ›å»ºé¡¹ç›®è„šæ‰‹æ¶ã€<code>vue add</code>ä»¥åŠ<code>vue invoke</code>æ’ä»¶å®‰è£…å‘½ä»¤éƒ½å±äºå®‰è£…é˜¶æ®µ; è€Œ cli-service å‘½ä»¤æ‰§è¡Œæ—¶å±äºè¿è¡Œé˜¶æ®µ.</li><li><p><strong>åŸºæœ¬ç»“æ„</strong>: åŒºåˆ†äº†ç”Ÿå‘½å‘¨æœŸåï¼Œæ’ä»¶çš„ç»“æ„å°±æ¯”è¾ƒæ¸…æ™°äº†:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ generator.js  # generator (å¯é€‰)</span><br><span class="line">â”œâ”€â”€ prompts.js    # prompt æ–‡ä»¶ (å¯é€‰)</span><br><span class="line">â”œâ”€â”€ index.js      # service æ’ä»¶</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure><ul><li>å®‰è£…é˜¶æ®µ:<ul><li>prompts: æ”¶é›†ç”¨æˆ·æ„è§å’Œé…ç½®</li><li>gernerator: åœ¨å®‰è£…é˜¶æ®µç”Ÿæˆæ¨¡æ¿æ–‡ä»¶</li></ul></li><li>è¿è¡Œæ—¶: index.js<ul><li>æ³¨å…¥ service å‘½ä»¤</li><li>æ‰©å±•å’Œä¿®æ”¹ webpack é…ç½®. vue-cli é€šè¿‡<code>webpack-chain</code>å’Œ<code>webpack-merge</code>æ¥å®ç° webpack å¯é…ç½®åŒ–</li></ul></li></ul></li></ul><p><br></p><p>ä¸€ä¸ªç®€å•çš„æ’ä»¶ç»“æ„æ˜¯è¿™æ ·å­çš„:</p><center><br>  <img src="/codes/vue-plugin.png" width="600"><br></center><p><br></p><h4 id="preset"><a href="#preset" class="headerlink" title="preset"></a><strong>preset</strong></h4><p>è¿™ä¸ª preset å’Œ babel çš„ preset æ¦‚å¿µå®é™…ä¸Šæ˜¯ä¸ä¸€æ ·çš„:</p><p><strong>vue-cli çš„ preset ä¸€ä¸ªè„šæ‰‹æ¶åˆ›å»ºæ–¹æ¡ˆ</strong>, ä¹Ÿå°±æ˜¯è¯´å®ƒåªä½œç”¨äº<code>vue create</code>é˜¶æ®µã€‚æ¯”å¦‚<code>vue create</code>æ—¶é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ babel+eslint preset. preset å¯ä»¥ç®€åŒ–é¡¹ç›®è„šæ‰‹æ¶çš„åˆ›å»ºã€‚<strong>å›¢é˜Ÿå¯ä»¥å…±äº«ä¸€ä¸ª preset æ¥åˆ›å»ºè„šæ‰‹æ¶</strong>ã€‚</p><p><strong>è€Œ babel ä¸­çš„ preset æ˜¯ä¸€ä¸ªæ’ä»¶é›†åˆï¼Œä»–å¯ä»¥ç»Ÿä¸€æ”¶çº³å’Œç®¡ç†ä¸€ç»„æ’ä»¶æ–¹æ¡ˆ</strong>. ä¾‹å¦‚<code>babel-preset-react</code>ã€ <code>babel-preset-env</code>. ä¸Šæ–‡è¯´åˆ°å¦‚æœæ‰©å±•æ€§è¢«æ»¥ç”¨ï¼Œè£… N å¤šæ’ä»¶ï¼Œè€Œä¸”æ’ä»¶ä¹‹é—´è¿˜å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œä¹Ÿä¼šæˆä¸ºå‡çº§ç»´æŠ¤çš„è´Ÿæ‹…. è€Œ â€˜babel å¼â€™çš„ preset å¯ä»¥è®©æ’ä»¶æ›´æ–¹ä¾¿ç»´æŠ¤å’Œå’Œ<strong>ä¸€é”®å¼å‡çº§</strong>ã€‚</p><p>å°½ç®¡ç›®å‰ vue ä¹Ÿæä¾›äº†<code>vue upgrade</code>å¯¹æ’ä»¶è¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªæ˜¯åŸºäºè¯­ä¹‰åŒ–ç‰ˆæœ¬çº¦å®šçš„, ä¸”å½“æ’ä»¶ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»æ—¶, ä¸æ’é™¤å‡çº§å­˜åœ¨é£é™©. å°¤å…¶å¯¹äºå›¢é˜Ÿé¡¹ç›®è¿˜æ˜¯æ¨èæœ‰ç»Ÿä¸€åœ°ç®¡ç†è¿™äº›æ’ä»¶, å®ç°å‚»ç“œåŒ–çš„å‡çº§ã€‚ å®é™…ä¸Šè¿™ç§ â€˜babel å¼â€™çš„ preset æ˜¯å¯ä»¥é€šè¿‡ vue-plugin å®ç°å’Œè½¬å‘çš„ã€‚</p><p><br></p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a><strong>é…ç½®</strong></h4><p>vue æ”¯æŒåœ¨ package.json çš„ <code>vue</code> å­—æ®µæˆ–<code>vue.config.js</code>ä¸­è¿›è¡Œé…ç½®ã€‚è¿™é‡Œå¯ä»¥å¯¹ Service æ ¸å¿ƒåŠŸèƒ½å’Œæ’ä»¶è¿›è¡Œé…ç½®, ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ webpack é…ç½®. å¦å¤–éƒ¨åˆ†æ„å»ºè¡Œä¸ºæ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œå½±å“çš„ï¼Œè¿™äº›å¯ä»¥é€šè¿‡<code>.env.*</code>æ–‡ä»¶è¿›è¡Œé…ç½®</p><p><br></p><h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a><strong>åŸºæœ¬æµç¨‹</strong></h3><p>ç°åœ¨æ¥çœ‹çœ‹ä¸€ä¸ª vue-cli å†…éƒ¨çš„åŸºæœ¬æµç¨‹, Service çš„æ’ä»¶å®ç°æ˜¯ vue-cli æ¯”è¾ƒæœ‰æ„æ€çš„ç‚¹. ä»¥<code>vue serve</code>ä¸ºä¾‹:</p><center><br>  <img src="/images/05/vue-cli.png"><br></center><p>Service å¯¹è±¡æ˜¯ vue-cli çš„æ ¸å¿ƒå¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç†å’Œåº”ç”¨æ’ä»¶ï¼Œæ‰€æœ‰å‘½ä»¤å’Œ webpack é…ç½®éƒ½æ˜¯ä»¥æ’ä»¶çš„å½¢å¼å­˜åœ¨:</p><center><br>  <img src="/images/05/vue-service-struct.png" width="700"><br></center><p><strong>é¦–å…ˆåˆ’åˆ†ä¸ºé…ç½®é˜¶æ®µå’Œè¿è¡Œé˜¶æ®µ</strong>ã€‚ é…ç½®é˜¶æ®µ vue-cli ä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶æŸ¥æ‰¾å’Œåº”ç”¨æ‰€æœ‰æ’ä»¶ã€‚å°† PluginAPI å®ä¾‹å’Œé¡¹ç›®é…ç½®ä¼ é€’ç»™æ’ä»¶è¿è¡Œæ—¶, æ’ä»¶è¿è¡Œæ—¶é€šè¿‡ PluginAPI æ³¨å…¥å‘½ä»¤(registerCommand)å’Œ æ‰©å±• webpack é…ç½®(chainWebpack, configureWebpack).</p><p>è¿è¡Œé˜¶æ®µåˆ™æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‘½ä»¤åè°ƒç”¨æ’ä»¶æ³¨å…¥å‘½ä»¤ã€‚åœ¨å‘½ä»¤å®ç°å‡½æ•°ä¸­ï¼Œå¯ä»¥è°ƒç”¨ resolveWebpackConfig()æ¥ç”Ÿæˆæœ€ç»ˆçš„ webpack é…ç½®ã€‚ä»¥ serve å‘½ä»¤ä¸ºä¾‹ï¼Œè·å–åˆ° webpackConfig åä¼šåˆ›å»ºä¸€ä¸ª webpack ç¼–è¯‘å™¨ï¼Œå¹¶å¼€å¯ webpack-dev-server å¼€å‘æœåŠ¡å™¨.</p><p><br></p><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><ul><li><strong>ç»„ç»‡</strong><ul><li><a href="http://lernajs.io" target="_blank" rel="noopener">lerna</a></li></ul></li><li><strong>cli å‘½ä»¤è¡Œç›¸å…³å·¥å…·</strong><ul><li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener">chalk</a>: å‘½ä»¤è¡Œå­—ä½“é¢œè‰²æ ·å¼</li><li><a href="https://www.npmjs.com/package/cli-highlight" target="_blank" rel="noopener">cli-highlight</a>: ç»ˆç«¯è¯­æ³•é«˜äº®è¾“å‡º, ç±»ä¼¼äº Highlight.js</li><li><a href="https://www.npmjs.com/package/cliui" target="_blank" rel="noopener">cliui</a>: åœ¨ç»ˆç«¯ä¸­è¿›è¡Œå¤šåˆ—è¾“å‡º</li><li><a href="https://github.com/dcporter/didyoumean.js" target="_blank" rel="noopener">didyoumean</a>: æ ¹æ®å•è¯ç›¸ä¼¼åº¦ï¼Œæ¥å¯¹ç”¨æˆ·è¾“å…¥çº æ­£æç¤º</li><li><a href="https://www.npmjs.com/package/semver" target="_blank" rel="noopener">semver</a>: æä¾›è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ç›¸å…³çš„å·¥å…·å‡½æ•°ã€‚ ä¾‹å¦‚æ¯”è¾ƒï¼Œè§„èŒƒåŒ–</li><li><a href="https://github.com/tj/commander.js#readme" target="_blank" rel="noopener">commander</a> TJ å†™çš„å‘½ä»¤è¡Œé€‰é¡¹å’Œå‚æ•°è§£æå™¨ï¼Œæ”¯æŒå­å‘½ä»¤ï¼Œé€‰é¡¹æ ¡éªŒå’Œç±»å‹è½¬æ¢ï¼Œå¸®ç»„ä¿¡æ¯ç”Ÿæˆç­‰ç­‰. API ç®€å•ä¼˜é›…</li><li><a href="https://www.npmjs.com/package/minimist" target="_blank" rel="noopener">minimist</a>: ä¸€ä¸ªæç®€çš„å‘½ä»¤è¡Œå‚æ•°è§£æå™¨ã€‚å¦‚æœåªæ˜¯ç®€å•çš„é€‰é¡¹è§£æï¼Œå¯ä»¥ç”¨è¿™ä¸ªåº“</li><li><a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener">inquirer</a> å‘½ä»¤è¡Œè¯¢é—®</li><li><a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener">ora</a> å‘½ä»¤è¡Œ spinner</li><li><a href="https://github.com/yyx990803/launch-editor" target="_blank" rel="noopener">launch-editor</a> æ‰“å¼€ç¼–è¾‘å™¨. é€šè¿‡ node æ‰“å¼€ç¼–è¾‘å™¨ï¼Œå‰ç«¯å¯ä»¥ express æš´éœ²æ¥å£è°ƒç”¨æ‰“å¼€</li><li><a href="https://www.npmjs.com/package/open" target="_blank" rel="noopener">open</a> æ‰“å¼€ URLã€æ–‡ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶</li><li><a href="https://www.npmjs.com/package/execa" target="_blank" rel="noopener">execa</a> æ›´å¥½çš„ child_processï¼Œä¿®å¤äº†åŸç”Ÿ exec çš„ä¸€äº›é—®é¢˜</li><li>validate-npm-package-name: éªŒè¯ npm åŒ…åç§°ï¼Œæ¯”å¦‚åˆ›å»ºçš„é¡¹ç›®åæ˜¯å¦åˆæ³•</li><li><a href="https://www.npmjs.com/package/dotenv" target="_blank" rel="noopener">dotenv</a> &amp; <a href="https://www.npmjs.com/package/dotenv-expand" target="_blank" rel="noopener">dotenv-expand</a>: ä».env æ–‡ä»¶ä¸­åŠ è½½é…ç½®ï¼Œç¯å¢ƒå˜é‡</li></ul></li><li><strong>ç½‘ç»œç›¸å…³</strong><ul><li><a href="https://www.npmjs.com/package/portfinder" target="_blank" rel="noopener">portfinder</a>: è·å–å¯ç”¨çš„ç«¯å£</li><li><a href="https://www.npmjs.com/package/address" target="_blank" rel="noopener">address</a>: è·å–å½“å‰ä¸»æœºçš„ ipï¼ŒMAC å’Œ DNS æœåŠ¡å™¨</li></ul></li><li><strong>æ–‡ä»¶å¤„ç†ç›¸å…³</strong><ul><li><a href="https://www.npmjs.com/package/slash" target="_blank" rel="noopener">slash</a> ä¸€è‡´åŒ–å¤„ç†è·¯å¾„ä¸­çš„åˆ†éš”ç¬¦</li><li><a href="https://www.npmjs.com/package/fs-extra" target="_blank" rel="noopener">fs-extra</a> node fs æ¨¡å—æ‰©å±•</li><li>globby: glob æ¨¡å¼åŒ¹é…</li><li>rimraf è·¨å¹³å°æ–‡ä»¶åˆ é™¤å‘½ä»¤</li><li><a href="https://www.npmjs.com/package/memfs" target="_blank" rel="noopener">memfs</a> å…¼å®¹ Node fs API çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿ</li></ul></li><li><strong>æ•°æ®æ£€éªŒ</strong><ul><li><a href="https://www.npmjs.com/package/@hapi/joi" target="_blank" rel="noopener">@hapi/joi</a> JSON schema æ ¡éªŒ</li></ul></li><li><strong>è°ƒè¯•</strong><ul><li><a href="https://www.npmjs.com/package/debug" target="_blank" rel="noopener">debug</a>: è¿™æ˜¯ä¸€ä¸ª debug æ—¥å¿—åˆ©å™¨, æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æˆ–åŠ¨æ€è®¾ç½®æ¥ç¡®å®šæ˜¯å¦éœ€è¦è¾“å‡º; æ”¯æŒ printf é£æ ¼æ ¼å¼åŒ–</li></ul></li><li><strong>ç®—æ³•</strong><ul><li>hash-sum: æ•£åˆ—å€¼è®¡ç®—</li><li>deepmerge æ·±åˆå¹¶</li></ul></li><li><strong>å…¶ä»–</strong><ul><li><a href="https://github.com/benjamn/recast" target="_blank" rel="noopener">recast</a> Javascript è¯­æ³•æ ‘è½¬æ¢å™¨ï¼Œæ”¯æŒéç ´åæ€§çš„æ ¼å¼åŒ–è¾“å‡º. å¸¸ç”¨äºæ‰©å±• js ä»£ç </li><li><a href="https://www.npmjs.com/package/javascript-stringify" target="_blank" rel="noopener">javascript-stringify</a>: ç±»ä¼¼äº JSON.stringify, å°†å¯¹è±¡å­—ç¬¦ä¸²åŒ–ã€‚</li></ul></li><li><strong>webpack</strong><ul><li>é…ç½®å®šä¹‰<ul><li>webpack-merge: åˆå¹¶ webpack é…ç½®å¯¹è±¡</li><li>webpack-chain: é“¾å¼é…ç½® webpack. è¿™ä¸¤ä¸ªåº“æ˜¯ vue-cli æ’ä»¶çš„é‡è¦æˆå‘˜</li></ul></li><li>webpack-dev-server: webpack å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒä»£ç çƒ­é‡è½½ï¼Œé”™è¯¯ä¿¡æ¯å±•ç¤ºï¼Œæ¥å£ä»£ç†ç­‰ç­‰</li><li>webpack-bundle-analyzer: webpack åŒ…åˆ†æå™¨</li></ul></li><li><strong>æ‰©å±•(ä¸€äº›ç›¸å…³çš„æŠ€æœ¯æ ˆ)</strong><ul><li>http-server å¿«é€Ÿä¼ºæœé™æ€æ–‡ä»¶</li><li>plop æ¨¡æ¿ç”Ÿæˆå™¨</li><li>yeoman é¡¹ç›®è„šæ‰‹æ¶å·¥å…·</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæ–°å¼€çš„â€™å®éªŒæ€§â€™æ–‡ç« ç³»åˆ—ï¼Œå¦‚å…¶åâ€˜æŠ€æœ¯åœ°å›¾â€™ï¼Œè¿™ä¸ªç³»åˆ—è®¡åˆ’å‰–æä¸€äº›å‰ç«¯å¼€æºé¡¹ç›®ï¼Œå¯èƒ½ä¼šæ¢è®¨è¿™äº›é¡¹ç›®çš„&lt;strong&gt;è®¾è®¡å’Œç»„ç»‡&lt;/strong&gt;ã€æ•´ç†ä»–ä»¬ä½¿ç”¨åˆ°&lt;strong&gt;æŠ€æœ¯æ ˆ&lt;/strong&gt;ã€‚ é¦–å…ˆæ‹¿&lt;code&gt;vue-cli&lt;/code&gt;å°è¯•ç‰›åˆ€ï¼Œå†å†³å®š
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“05 - çŠ¶æ€ç®¡ç†</title>
    <link href="https://bobi.ink/2019/05/20/react-component-design-05/"/>
    <id>https://bobi.ink/2019/05/20/react-component-design-05/</id>
    <published>2019-05-19T16:00:00.000Z</published>
    <updated>2019-05-22T06:44:27.830Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯ 520ï¼Œè¿™æ˜¯æœ¬ç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦æ¶µç›– React çŠ¶æ€ç®¡ç†çš„ç›¸å…³æ–¹æ¡ˆã€‚</p><p>å‰å‡ ç¯‡æ–‡ç« åœ¨<a href="https://juejin.im" target="_blank" rel="noopener">æ˜é‡‘</a>é¦–å‘åŸºæœ¬çŸ³æ²‰å¤§æµ·, æ²¡ä»€ä¹ˆé˜…è¯»é‡. å¯èƒ½æ˜¯æ–‡ç« ç¯‡å¹…å¤ªé•¿äº†ï¼Ÿæ˜é‡‘å€¼å¤ªä½äº†ï¼Ÿ è¿˜æ˜¯é”™åˆ«å­—å¤ªå¤šäº†? åé¢é™ä¸‹å¿ƒæ¥æƒ³æƒ³ï¼Œå†™ä½œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ç§å­¦ä¹ å’Œç§¯ç´¯çš„è¿‡ç¨‹, è®©æˆ‘å­¦ä¹ æ›´å…¨é¢æ›´ç³»ç»Ÿæ€§å»æè¿°ä¸€ä¸ªäº‹ç‰©. ä½†æ˜¯å†™ä½œç¡®å®æ˜¯ä¸€ä»¶éå¸¸è€—æ—¶çš„äº‹æƒ…, æ–‡ç« çš„æ¯å¥è¯éƒ½è¦ç»†ç»†æ¨æ•², è¿˜è¦é¿å…ä¸»è§‚æ€§å¤ªå¼ºé¿å…è¯¯å¯¼äº†åˆ«äºº.</p><p>æ‰€ä»¥æ¨¡ä»¿<a href="https://kernelpanic.fm" target="_blank" rel="noopener">&lt;&lt;å†…æ ¸ææ…Œ&gt;&gt;</a>çš„å£å·: â€œæƒ³çœ‹çš„äººçœ‹ï¼Œä¸æƒ³çœ‹çš„äººå°±åˆ«çœ‹â€</p><p><br></p><p><strong>ç³»åˆ—ç›®å½•</strong></p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li><a href="/2019/05/20/react-component-design-05/">05 çŠ¶æ€ç®¡ç†</a></li></ul><p><br></p><p><strong>æ–‡ç« ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#çŠ¶æ€ç®¡ç†">çŠ¶æ€ç®¡ç†</a></li><li><a href="#ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†">ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†</a></li><li><a href="#ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†">ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†</a></li><li><a href="#redux">Redux</a></li><li><a href="#mobx">Mobx</a></li><li><a href="#rxjs">RxJS</a></li><li><a href="#å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ">å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ</a></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h2><p>ç°åœ¨çš„å‰ç«¯æ¡†æ¶ï¼ŒåŒ…æ‹¬ React çš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>æ•°æ®é©±åŠ¨è§†å›¾</strong>, å³<code>UI = f(state)</code>. è¿™ç§å¼€å‘æ–¹å¼çš„å˜åŒ–å…¶å®å¾—ç›Šäº Virtual-DOM, å®ƒä½¿å¾—æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒæµè§ˆå™¨åº•å±‚ DOM çš„æ“ä½œç»†èŠ‚ï¼Œåªéœ€å…³å¿ƒâ€˜çŠ¶æ€(state)â€™å’Œâ€˜çŠ¶æ€åˆ° UI çš„æ˜ å°„å…³ç³»(f)â€™. <strong>æ‰€ä»¥å¦‚æœä½ æ˜¯åˆå­¦è€…ï¼Œä¸èƒ½ç†è§£ä»€ä¹ˆæ˜¯â€˜æ•°æ®é©±åŠ¨â€™, è¿˜æ˜¯ä¸æ¨èç»§ç»­é˜…è¯»æ–‡ç« ä¸‹é¢çš„å†…å®¹</strong>ã€‚</p><p>ä½†æ˜¯éšç€ <code>state</code> çš„å¤æ‚åŒ–, æ¡†æ¶ç°æœ‰çš„ç»„ä»¶åŒ–æ–¹å¼å¾ˆéš¾é©¾é©­ <code>f</code>(è§†å›¾çš„æ˜ å°„å…³ç³»å˜å¾—å¤æ‚, éš¾ä»¥è¢«è¡¨è¾¾å’Œç»´æŠ¤); æˆ–è€…ç›¸å…³ç±»å‹çš„åº”ç”¨æ•°æ®æµæœ¬æ¥å°±æ¯”è¾ƒå¤æ‚, ç»„ä»¶ä¹‹é—´çš„äº¤äº’å…³ç³»å¤šæ ·ï¼Œæœ¬æ¥éš¾ä»¥ä½¿ç”¨<code>UI = f(state)</code>è¿™ç§å…³ç³»æ¥è¡¨è¾¾; æˆ–è€…åº”ç”¨çš„ç»„ä»¶çŠ¶æ€è¿‡äºç¦»æ•£ï¼Œéœ€è¦ç»Ÿä¸€çš„æ²»ç†ç­‰ç­‰. æˆ‘ä»¬å°±æœ‰äº†çŠ¶æ€ç®¡ç†çš„éœ€æ±‚.</p><p>çŠ¶æ€ç®¡ç†æœ€åŸºç¡€çš„è§£å†³æ–¹å¼å°±æ˜¯åˆ†å±‚ï¼Œä¹Ÿå°±æ˜¯è¯´å’Œä¼ ç»Ÿçš„ <code>MV*</code> æ¨¡å¼æ²¡æœ‰æœ¬è´¨åŒºåˆ«, ä¸»æµçŠ¶æ€ç®¡ç†çš„ä¸»è¦ç»“æ„åŸºæœ¬éƒ½æ˜¯è¿™æ ·çš„:</p><center><br> <img src="/images/04/mvc.png" width="500"><br></center><p>ä»–ä»¬åŸºæœ¬éƒ½åŒ…å«è¿™äº›ç‰¹ç‚¹:</p><ul><li><strong>åˆ†ç¦»è§†å›¾å’ŒçŠ¶æ€</strong>. çŠ¶æ€ç®¡ç†å™¨æ“…é•¿çŠ¶æ€ç®¡ç†ï¼Œæ‰€ä»¥ä»–ä»¬ä¸€èˆ¬ä¼šå°†åº”ç”¨çŠ¶æ€èšåˆåœ¨ä¸€èµ·ç®¡ç†ï¼Œè€Œè§†å›¾é€€åŒ–ä¸ºè´«è¡€è§†å›¾(åªå…³æ³¨å±•ç¤º)ï¼Œè¿™æ ·å°±å¯ä»¥ç®€åŒ–<code>f</code>æ˜ å°„å…³ç³», è®©<code>UI = f(state)</code>è¿™ä¸ªè¡¨è¾¾å¼æ›´å½»åº•</li><li><strong>çº¦æŸçŠ¶æ€çš„å˜æ›´</strong>ã€‚Redux è¦æ±‚é€šè¿‡<code>dispatch+reducer</code>, mobx è¦æ±‚æ•°æ®å˜æ›´å‡½æ•°ä½¿ç”¨<code>action</code>è£…é¥°æˆ–æ”¾åœ¨<a href="https://mobx.js.org/best/actions.html" target="_blank" rel="noopener"><code>flow</code></a>å‡½æ•°ä¸­ï¼Œç›®çš„å°±æ˜¯è®©çŠ¶æ€çš„å˜æ›´æ ¹æ®å¯é¢„æµ‹æ€§</li><li><strong>å•å‘æ•°æ®æµ</strong>ã€‚æ•°æ®æµæ€»æ˜¯æŒ‰ç…§ Store -&gt; View -&gt; Store è¿™æ ·çš„æ–¹å¼æµåŠ¨, ç®€åŒ–æ•°æ®æµ</li></ul><p><br></p><p>ä½†æ˜¯, React çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¤ªå¤šäº†ï¼Œé€‰æ‹©è¿™äº›æ–¹æ¡ˆå¯èƒ½ä¼šè®©äººæŠ“ç‹‚ï¼Œä½ éœ€è¦æƒè¡¡å¾ˆå¤šä¸œè¥¿:</p><ul><li>é¢å‘å¯¹è±¡è¿˜æ˜¯å‡½æ•°å¼è¿˜æ˜¯å‡½æ•°å“åº”å¼?</li><li>å• Store è¿˜æ˜¯å¤š Storeï¼Ÿ</li><li>ä¸å¯å˜æ•°æ®è¿˜æ˜¯å¯å˜æ•°æ®ï¼Ÿ</li><li>å†™ä»£ç çˆ½è¿˜æ˜¯åæœŸç»´æŠ¤çˆ½?</li><li>è‡ªç”±è¿˜æ˜¯çº¦æŸï¼Ÿ</li><li>å¼ºç±»å‹è¿˜æ˜¯å¼±ç±»å‹ï¼Ÿ</li><li>èŒƒå¼åŒ–æ•°æ®è¿˜æ˜¯éèŒƒå¼åŒ–ï¼Ÿ</li><li>React åŸç”Ÿè¿˜æ˜¯ç¬¬ä¸‰æ–¹?</li><li>â€¦</li></ul><p><br></p><hr><p><br></p><h2 id="ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†"><a href="#ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†" class="headerlink" title="ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†"></a>ä½ ä¸éœ€è¦çŠ¶æ€ç®¡ç†</h2><p>å¯¹äºå¤§éƒ¨åˆ†ç®€å•çš„åº”ç”¨å’Œä¸­åå°é¡¹ç›®æ¥è¯´æ˜¯ä¸éœ€è¦çŠ¶æ€ç®¡ç†çš„ã€‚è¯´å®è¯è¿™äº›åº”ç”¨å’Œä¼ ç»Ÿ web é¡µé¢æ²¡ä»€ä¹ˆåŒºåˆ«, æ¯ä¸ªé¡µé¢éƒ½å„è‡ªç‹¬ç«‹ï¼Œæ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢æ—¶æ‹‰å–æœ€æ–°æ•°æ®ï¼Œå¢åˆ æ”¹æŸ¥ä»…æ­¤è€Œå·². å¯¹äºè¿™äº›åœºæ™¯ React çš„ç»„ä»¶çŠ¶æ€å°±å¯ä»¥æ»¡è¶³, æ²¡æœ‰å¿…è¦ä¸ºäº†çŠ¶æ€ç®¡ç†è€ŒçŠ¶æ€ç®¡ç†. è¿™ç§å„è‡ªç‹¬ç«‹çš„â€˜é™æ€â€™é¡µé¢ï¼Œå¼•å…¥çŠ¶æ€ç®¡ç†å°±æ˜¯è¿‡åº¦è®¾è®¡äº†ã€‚</p><p>åœ¨è€ƒè™‘å¼•å…¥çŠ¶æ€ç®¡ç†ä¹‹å‰è€ƒè™‘ä¸€ä¸‹è¿™äº›æ‰‹æ®µæ˜¯å¦å¯ä»¥è§£å†³ä½ çš„é—®é¢˜:</p><ul><li>æ˜¯å¦å¯ä»¥é€šè¿‡æŠ¬å‡ State æ¥å®ç°ç»„ä»¶é—´é€šä¿¡?</li><li>å¦‚æœè·¨è¶Šçš„å±‚çº§å¤ªå¤šï¼Œæ•°æ®æ˜¯å¦å¯ä»¥é€šè¿‡ Context API æ¥å®ç°å…±äº«?</li><li>ä¸€äº›å…¨å±€çŠ¶æ€æ˜¯å¦å¯ä»¥æ”¾åœ¨ localStorage æˆ– sessionStorage ä¸­ï¼Ÿ</li><li>æ•°æ®æ˜¯å¦å¯ä»¥é€šè¿‡å¤–ç½®çš„äº‹ä»¶è®¢é˜…å™¨è¿›è¡Œå…±äº«?</li><li>â€¦</li></ul><p><br></p><hr><p><br></p><h2 id="ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†"><a href="#ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†" class="headerlink" title="ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†"></a>ä½ ä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†</h2><p>å½“ä½ çš„åº”ç”¨æœ‰ä»¥ä¸‹åœºæ™¯æ—¶ï¼Œå°±è¦å¼€å§‹è€ƒè™‘çŠ¶æ€ç®¡ç†:</p><ul><li>ç»„ä»¶ä¹‹é—´éœ€è¦çŠ¶æ€å…±äº«ã€‚åŒä¸€ä»½æ•°æ®éœ€è¦å“åº”åˆ°å¤šä¸ªè§†å›¾ï¼Œä¸”è¢«å¤šä¸ªè§†å›¾è¿›è¡Œå˜æ›´</li><li>éœ€è¦ç»´æŠ¤å…¨å±€çŠ¶æ€ï¼Œå¹¶åœ¨ä»–ä»¬å˜åŠ¨æ—¶å“åº”åˆ°è§†å›¾</li><li>æ•°æ®æµå˜å¾—å¤æ‚ï¼ŒReact ç»„ä»¶æœ¬èº«å·²ç»æ— æ³•é©¾é©­ã€‚ä¾‹å¦‚è·¨é¡µé¢çš„ç”¨æˆ·åä½œ</li><li>éœ€è¦ç»Ÿä¸€ç®¡ç†åº”ç”¨çš„çŠ¶æ€ã€‚æ¯”å¦‚å®ç°æŒä¹…åŒ–ï¼Œå¯æ¢å¤ï¼Œå¯æ’¤é”€/é‡åš</li><li>â€¦</li></ul><p>é¦–å…ˆç¡®å®šæ˜¯å¦éœ€è¦ Reduxã€Mobx è¿™äº›å¤æ‚çš„çŠ¶æ€ç®¡ç†å·¥å…·? åœ¨ 2019 ä»–ä»¬å¾ˆå¤šåŠŸèƒ½éƒ½å¯ä»¥è¢« React æœ¬èº«æä¾›çš„ç‰¹æ€§å–ä»£. éšç€ React 16.3 å‘å¸ƒäº†æ–°çš„ Context APIï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åœ¨å®ƒä¹‹ä¸Šåšç®€å•çš„çŠ¶æ€ç®¡ç†, æˆ‘ä»¬åº”è¯¥<strong>ä¼˜å…ˆé€‰æ‹©è¿™äº›åŸç”Ÿæ€çš„çŠ¶æ€ç®¡ç†æ–¹å¼</strong>ã€‚</p><p>ä¾‹å¦‚: ç®€å•çš„ä½¿ç”¨ Context API æ¥åšçŠ¶æ€ç®¡ç†:</p><center><br>  <img src="/codes/context-api-vuex.png" width="600"><br></center><p>æœ€è¿‘ hooks ç”¨å¾—æ¯”è¾ƒçˆ½(å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« : <a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d" target="_blank" rel="noopener">ç»„ä»¶çš„æ€ç»´</a>)ï¼Œæˆ‘å°±æƒ³é…åˆ Context API åšä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨, åæ¥å‘ç°æ—©å°±æœ‰äººè¿™ä¹ˆå¹²äº†ï¼š <a href="https://github.com/jamiebuilds/unstated-next" target="_blank" rel="noopener">unstated-next</a>, ä»£ç åªæœ‰ 38 è¡Œ(Hooks+Context)ï¼Œæ¥å£éå¸¸ç®€å•:</p><center><br> <img src="/images/04/unstated.png" width="750"><br></center><p>ä¾èµ–äº hooks æœ¬èº«çµæ´»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åšå¾ˆå¤šä¸œè¥¿, ä»…é™äºæƒ³è±¡åŠ›. ä¾‹å¦‚å¼‚æ­¥æ•°æ®è·å–:</p><center><br> <img src="/codes/useTodoList.png" width="750"><br></center><p>æŠ‘æˆ–è€…å®ç° Redux çš„æ ¸å¿ƒåŠŸèƒ½:</p><iframe src="https://codesandbox.io/embed/w1plr?fontsize=14" title="redux hooks" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><br></p><p>æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ hooks ä½œä¸ºçŠ¶æ€ç®¡ç†å™¨çš„ä¼˜ç‚¹:</p><ul><li><strong>æç®€</strong>ã€‚å¦‚ä¸Š</li><li><strong>å¯ç»„åˆæ€§</strong>. hooks åªæ˜¯æ™®é€šå‡½æ•°, å¯ä»¥ç»„åˆå…¶ä»– hooksï¼Œä»¥åŠå…¶ä»–<code>Hooks Container</code>. ä¸Šä¸€ç¯‡æ–‡ç« æåˆ° hooks å†™ç€å†™ç€å¾ˆåƒç»„ä»¶ï¼Œç»„ä»¶å†™ç€å†™ç€å¾ˆåƒ hooksï¼Œåœ¨ç”¨æ³•ä¸Šç»„ä»¶å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§â€™ç‰¹æ®Šâ€™çš„ hooksã€‚ç›¸æ¯”ç»„ä»¶, hooks æœ‰æ›´çµæ´»çš„ç»„åˆç‰¹æ€§</li><li><strong>ä»¥ react ä¹‹å</strong>. åŸºäº Context å®ç°ç»„ä»¶çŠ¶æ€å…±äº«ï¼ŒåŸºäº hooks å®ç°çŠ¶æ€ç®¡ç†, è¿™ä¸ªæ–¹å¼è¶³å¤Ÿé€šç”¨.</li><li>hooks å¾ˆå¤šçµæ´»çš„ç‰¹æ€§è¶³ä»¥å–ä»£ç±»ä¼¼ Mobx è¿™äº›æ¡†æ¶çš„å¤§éƒ¨åˆ†åŠŸèƒ½</li><li>åªæ˜¯æ™®é€šçš„ React ç»„ä»¶ï¼Œå¯ä»¥åœ¨ React inspector ä¸Šè°ƒè¯•</li><li>å¼ºç±»å‹</li><li>åŸºäºContext APIæ›´å®¹æ˜“å®ç°æ¨¡å—åŒ–(æˆ–è€…åˆ†å½¢)</li></ul><p><br></p><p>éœ€è¦æ³¨æ„çš„åœ°æ–¹</p><ul><li>æ²¡æœ‰å¤–ç½®çš„çŠ¶æ€. çŠ¶æ€åœ¨ç»„ä»¶å†…éƒ¨ï¼Œæ²¡æœ‰æ–¹æ³•ä»å¤–éƒ¨è§¦å‘çŠ¶æ€å˜æ›´</li><li>ç¼ºå°‘çº¦æŸ. æ˜¯å¥½å¤„ä¹Ÿæ˜¯åå¤„, å¯¹äºå›¢é˜Ÿå’Œåˆå­¦è€…æ¥è¯´æ²¡æœ‰çº¦æŸä¼šå¯¼è‡´é£æ ¼ä¸ç»Ÿä¸€ï¼Œæ— æ³•æ§åˆ¶é¡¹ç›®ç†µå¢ã€‚å¥½å¤„æ˜¯å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„çº¦æŸ</li><li>æ€§èƒ½ä¼˜åŒ–. éœ€è¦è€ƒè™‘ Context å˜æ›´å¸¦æ¥çš„æ€§èƒ½é—®é¢˜</li><li>è°ƒè¯•ä½“éªŒä¸å¦‚ Redux</li><li>æ²¡æœ‰æ•°æ®é•œåƒ, ä¸èƒ½å®ç°è¯¸å¦‚äº‹ä»¶ç®¡ç†çš„éœ€æ±‚</li><li>æ²¡æœ‰ Redux ä¸°å¯Œçš„ç”Ÿæ€</li></ul><p><strong>æ‰€ä»¥ Context+ Hooks å¯ä»¥ç”¨äºæ»¡è¶³ç®€å•çš„çŠ¶æ€ç®¡ç†éœ€æ±‚, å¯¹äºå¤æ‚çš„çŠ¶æ€ç®¡ç†éœ€æ±‚è¿˜æ˜¯éœ€è¦ç”¨ä¸Š Reduxã€Mobx è¿™ç±»ä¸“ä¸šçš„çŠ¶æ€ç®¡ç†å™¨.</strong></p><p><br></p><p>å…¶ä»–ç±»ä¼¼çš„æ–¹æ¡ˆ</p><ul><li><a href="https://github.com/jamiebuilds/unstated" target="_blank" rel="noopener">unstated</a> unstated-next çš„å‰èº«ï¼Œä½¿ç”¨ setState API</li><li><a href="https://github.com/dai-shi/react-hooks-global-state" target="_blank" rel="noopener">react-hooks-global-state</a></li></ul><p>æ‰©å±•</p><ul><li><a href="https://blog.bitsrc.io/react-context-api-a-replacement-for-redux-6e20790492b3" target="_blank" rel="noopener">React Context APIâ€Šâ€”â€ŠA Replacement for Redux?</a></li><li><a href="https://zhuanlan.zhihu.com/p/48219978" target="_blank" rel="noopener">unstated: å¯èƒ½æ˜¯ç®€å•çŠ¶æ€ç®¡ç†å·¥å…·ä¸­æœ€å¥½çš„</a></li></ul><p><br></p><hr><r><h2 id="redux"><a href="#redux" class="headerlink" title="Redux"></a>Redux</h2><p><code>unstated</code> æ˜¯ä¸€ä¸ªæç®€çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œå…¶ä½œè€…ä¹Ÿè¯´äº†ä¸è¦è®¤ä¸º<strong>unstated æ˜¯ä¸€ä¸ª Redux killer</strong>, ä¸è¦åœ¨å®ƒä¹‹ä¸Šæ„å»ºå¤æ‚çš„å·¥å…·ï¼Œä¹Ÿå°±æ˜¯ä¸è¦é‡å¤é€ è½®å­ã€‚æ‰€ä»¥ä¸€èˆ¬åˆ°äº†è¿™ä¸ªåœ°æ­¥, å…¶å®ä½ å°±åº”è¯¥è€ƒè™‘ Reduxã€Mobxã€Rxjs è¿™äº›å¤æ‚çš„çŠ¶æ€ç®¡ç†æ¡†æ¶äº†ã€‚</p><p>Redux æ˜¯å­¦ä¹  React ç»•ä¸è¿‡çš„ä¸€ä¸ªæ¡†æ¶. å°½ç®¡ Redux çš„ä»£ç åªæœ‰ä¸€ç™¾å¤šè¡Œï¼Œæ¦‚å¿µå´å¾ˆå¤šï¼Œå­¦ä¹ æ›²çº¿éå¸¸é™¡å³­ï¼Œçœ‹å®˜æ–¹æ–‡æ¡£å°±çŸ¥é“äº†ã€‚å³ä½¿å®ƒçš„å®ç°å¾ˆç®€æ´ï¼Œä½†æ˜¯å¼€å‘ä»£ç å¹¶ä¸ç®€æ´(å’Œ mobx ç›¸å, è„æ´»ç•™ç»™å¼€å‘è€…)ï¼Œå°¤å…¶éµå¾ªå®ƒçš„â€™æœ€ä½³å®è·µâ€™ï¼Œæ˜¯ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ªé¡¹ç›®æ˜¯éå¸¸ç¹ççš„. è¿˜åœ¨ç°åœ¨æœ‰ç±»ä¼¼ dva æˆ– rematch è¿™æ ·çš„äºŒæ¬¡å°è£…åº“æ¥ç®€åŒ–å®ƒ.</p><p>æœ¬æ–‡ä¸æ‰“ç®—æ·±å…¥ä»‹ç» Redux çš„ç›¸å…³å®è·µï¼Œ ç¤¾åŒºä¸Šé¢æœ‰éå¸¸å¤šçš„æ•™ç¨‹ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿéå¸¸è¯¦å°½. è¿™é‡Œä¼šä»‹ç» Redux çš„ä¸»è¦æ¶æ„å’Œæ ¸å¿ƒæ€æƒ³ï¼Œä»¥åŠå®ƒçš„é€‚ç”¨åœºæ™¯.</p><center><br>  <img src="/images/04/redux-design.png" width="700"><br></center><p>Redux çš„ä¸»è¦ç»“æ„å¦‚ä¸Šï¼Œåœ¨æ­¤ä¹‹å‰ä½ å…ˆè¦ææ¸…æ¥š Redux çš„åˆè¡·æ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½æ˜ç™½å®ƒä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡. åœ¨æˆ‘çœ‹æ¥ Redux ä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜:</p><ol><li><strong>å¯é¢„æµ‹çŠ¶æ€</strong></li><li><strong>ç®€åŒ–åº”ç”¨æ•°æ®æµ</strong></li></ol><p><br></p><p>å…¶å®è¿™ä¹Ÿæ˜¯ <code>flux</code> çš„åˆè¡·, åªæ˜¯æœ‰äº›å®ƒæœ‰äº›ä¸œè¥¿æ²¡åšå¥½. æ˜ç™½ Redux çš„åˆè¡·ï¼Œç°åœ¨æ¥çœ‹çœ‹å®ƒçš„è®¾è®¡å°±ä¼šæ¸…æ™°å¾ˆå¤š</p><ul><li><p><strong>å•ä¸€æ•°æ®æº</strong> -&gt; å¯é¢„æµ‹ï¼Œç®€åŒ–æ•°æ®æµï¼šæ•°æ®åªèƒ½åœ¨ä¸€ä¸ªåœ°æ–¹è¢«ä¿®æ”¹</p><ul><li><p>å¯ä»¥ç®€åŒ–åº”ç”¨æ•°æ®æµ. è§£å†³ä¼ ç»Ÿå¤š model æ¨¡å‹æ•°æ®æµæ··ä¹±é—®é¢˜(æ¯”å¦‚ä¸€ä¸ª model å¯ä»¥ä¿®æ”¹å…¶ä»– modelï¼Œä¸€ä¸ª view å—åˆ°å¤šä¸ª model é©±åŠ¨)ï¼Œè®©æ•°æ®å˜åŠ¨å˜å¾—å¯é¢„æµ‹å¯è°ƒè¯•</p><center><br> <img src="/images/04/traditional-model.png" width="400"><br></center></li><li><p>åŒæ„åŒ–åº”ç”¨å¼€å‘</p></li><li>æ–¹ä¾¿è°ƒè¯•</li><li>æ–¹ä¾¿åšæ•°æ®é•œåƒ. å¯ä»¥å®ç°æ’¤é”€/é‡åšã€æ—¶é—´æ—…è¡Œã€çƒ­é‡è½½ã€çŠ¶æ€æŒä¹…åŒ–å’Œæ¢å¤</li></ul></li><li><p><strong>å•å‘æ•°æ®æµ</strong> -&gt; ç®€åŒ–æ•°æ®æµ, å¯é¢„æµ‹</p></li><li><strong>ä¸èƒ½ç›´æ¥ä¿®æ”¹çŠ¶æ€</strong> -&gt; å¯é¢„æµ‹<ul><li>åªèƒ½é€šè¿‡ dispatch action æ¥è§¦å‘çŠ¶æ€å˜æ›´. action åªæ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œ æºå¸¦äº‹ä»¶çš„ç±»å‹å’Œ payload</li><li>reducer æ¥æ”¶ action å’Œæ—§çš„ stateï¼Œ è§„çº¦ç”Ÿæˆæ–°çš„ state. reducer åªæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå¯ä»¥åµŒå¥—ç»„åˆå­ reducer å¯¹å¤æ‚ state æ ‘è¿›è¡Œè§„çº¦</li><li>ä¸å¯å˜æ•°æ®.</li><li>å¯æµ‹è¯•.</li></ul></li><li><strong>èŒƒå¼åŒ–å’ŒåèŒƒå¼åŒ–</strong>. Store åªå­˜å‚¨èŒƒå¼åŒ–çš„æ•°æ®ï¼Œå‡å°‘æ•°æ®å†—ä½™ã€‚è§†å›¾éœ€è¦çš„æ•°æ®é€šè¿‡ reselect ç­‰æ‰‹æ®µåèŒƒå¼åŒ–</li><li><strong>é€šè¿‡ä¸­é—´ä»¶éš”ç¦»å‰¯ä½œç”¨</strong> -&gt; å¯é¢„æµ‹<br>å¯ä»¥è¯´ Redux çš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ reducerï¼Œç„¶è€Œè¿™æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚ä¸ºäº†å®ç°å¤æ‚çš„å‰¯ä½œç”¨ï¼Œredux æä¾›äº†ç±»ä¼¼ Koa çš„ä¸­é—´ä»¶æœºåˆ¶ï¼Œå®ç°å„ç§å‰¯ä½œç”¨. æ¯”å¦‚å¼‚æ­¥è¯·æ±‚. é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥åˆ©ç”¨ä¸­é—´ä»¶æœºåˆ¶ï¼Œå®ç°é€šç”¨çš„ä¸šåŠ¡æ¨¡å¼ï¼Œ å‡å°‘ä»£ç é‡å¤ã€‚</li><li><strong>Devtool</strong> -&gt; å¯é¢„æµ‹ã€‚é€šè¿‡å¼€å‘è€…å·¥å…·å¯ä»¥å¯è§†åŒ–æ•°æ®æµ</li></ul><p><br></p><p><strong>ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Redux?</strong></p><p>é¦–å…ˆè¿˜æ˜¯è­¦å‘Šä¸€ä¸‹ï¼š <a href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367" target="_blank" rel="noopener">You Might Not Need Redux</a>, Redux ä¸æ˜¯ä½ çš„ç¬¬ä¸€é€‰æ‹©ã€‚</p><p><strong>å½“æˆ‘ä»¬éœ€è¦å¤„ç†å¤æ‚çš„åº”ç”¨çŠ¶æ€ï¼Œä¸” React æœ¬èº«æ— æ³•æ»¡è¶³ä½ æ—¶</strong>. æ¯”å¦‚ï¼š</p><ul><li>ä½ éœ€è¦æŒä¹…åŒ–åº”ç”¨çŠ¶æ€, è¿™æ ·ä½ å¯ä»¥ä»æœ¬åœ°å­˜å‚¨æˆ–æœåŠ¡å™¨è¿”å›æ•°æ®ä¸­æ¢å¤åº”ç”¨</li><li>éœ€è¦å®ç°æ’¤é”€é‡åšè¿™äº›åŠŸèƒ½</li><li>å®ç°è·¨é¡µé¢çš„ç”¨æˆ·åä½œ</li><li>åº”ç”¨çŠ¶æ€å¾ˆå¤æ‚æ—¶</li><li>æ•°æ®æµæ¯”è¾ƒå¤æ‚æ—¶</li><li>è®¸å¤šä¸ç›¸å…³çš„ç»„ä»¶éœ€è¦å…±äº«å’Œæ›´æ–°çŠ¶æ€</li><li>å¤–ç½®çŠ¶æ€</li><li>â€¦</li></ul><p><br></p><p><strong>æœ€ä½³å®è·µ</strong></p><p>ä¸ªäººè§‰å¾—<a href="https://github.com/react-boilerplate/react-boilerplate/blob/master/docs/general/introduction.md" target="_blank" rel="noopener">react-boilerplate</a>æ˜¯æœ€ç¬¦åˆå®˜æ–¹â€˜æœ€ä½³å®è·µâ€™çš„é¡¹ç›®æ¨¡æ¿. å®ƒçš„åº”ç”¨å·¥ä½œæµå¦‚ä¸‹:</p><center><br> <img src="/images/04/redux-workflow.png " width="600"><br></center><p>ç‰¹æ€§:</p><ol><li>æ•´åˆäº† Redux ç”Ÿæ€æ¯”è¾ƒæµè¡Œçš„æ–¹æ¡ˆ: <code>immer</code>(ä¸å¯å˜æ•°æ®å˜æ›´)ï¼Œ<code>redux-saga</code>(å¼‚æ­¥æ•°æ®æµå¤„ç†)ï¼Œ<code>reselect</code>(é€‰å–å’Œæ˜ å°„ stateï¼Œæ”¯æŒ memoï¼Œå¯å¤åˆ)ï¼Œ<code>connected-react-router</code>(ç»‘å®š react-router v4)</li><li>æ ¹æ®é¡µé¢åˆ†å‰² saga å’Œ reducerã€‚è§ä¸‹é¢ ğŸ‘‡ å’Œç›®å½•ç»“æ„</li><li>æŒ‰éœ€åŠ è½½ saga å’Œ reducer(é€šè¿‡ replaceReducer)</li><li>åˆ’åˆ†å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶</li></ol><p>å†çœ‹çœ‹ react-boilerplate ç›®å½•ç»“æ„. è¿™æ˜¯æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„é¡¹ç›®ç»„ä»¶æ–¹å¼ï¼Œç»„ç»‡éå¸¸æ¸…æ™°ï¼Œå¾ˆæœ‰å‚è€ƒæ„ä¹‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/src</span><br><span class="line">  /components        # å±•ç¤ºç»„ä»¶</span><br><span class="line">  /containers        # ğŸ”´å®¹å™¨/é¡µé¢ç»„ä»¶</span><br><span class="line">    /App             # æ ¹ç»„ä»¶ï¼Œ ä¾‹å¦‚æ”¾ç½®Providerå’ŒRouter</span><br><span class="line">    /HomePage        # é¡µé¢ç»„ä»¶</span><br><span class="line">      index.js       # é¡µé¢å…¥å£</span><br><span class="line">      constants.js   # ğŸ”´ åœ¨è¿™é‡Œå®šä¹‰å„ç§å¸¸é‡ã€‚åŒ…æ‹¬Action Type</span><br><span class="line">      actions.js     # ğŸ”´ å®šä¹‰å„ç§Actionå‡½æ•°</span><br><span class="line">      saga.js        # ğŸ”´ redux-saga å®šä¹‰å„ç§sagaæ–¹æ³•ï¼Œ ç”¨äºå¤„ç†å¼‚æ­¥æµç¨‹</span><br><span class="line">      reducer.js     # ğŸ”´ reducerã€‚ é¡µé¢ç»„ä»¶çš„reducerå’Œsagaéƒ½ä¼šæŒ‰éœ€æ³¨å…¥åˆ°æ ¹store</span><br><span class="line">      selectors.js   # ğŸ”´ redux stateæ˜ å°„å’Œè®¡ç®—</span><br><span class="line">      message.js</span><br><span class="line">      Form.js        # å„ç§å±€éƒ¨ç»„ä»¶</span><br><span class="line">      Input.js</span><br><span class="line">      ...</span><br><span class="line">    /FeaturePage     # å…¶ä»–é¡µé¢ç»„ä»¶ç»“æ„åŒä¸Š</span><br><span class="line">    ...</span><br><span class="line">  /translations      # i18n ç¿»è¯‘æ–‡ä»¶</span><br><span class="line">  /utils</span><br><span class="line">    reducerInjectors.js  # ğŸ”´reducer æ³¨å…¥å™¨, å®ç°å’Œé¡µé¢ç»„ä»¶ä¸€èµ·æŒ‰éœ€æ³¨å…¥</span><br><span class="line">    sagaInjectors.js     # ğŸ”´saga æ³¨å…¥å™¨, åŒä¸Š</span><br><span class="line">    lodable.js</span><br><span class="line">  app.js             # åº”ç”¨å…¥å£</span><br><span class="line">  i18n.js            # i18né…ç½®</span><br><span class="line">  configureStore.js  # ğŸ”´ åˆ›å»ºå’Œé…ç½®Redux Store</span><br><span class="line">  reducers.js        # ğŸ”´ æ ¹reducers, åˆå¹¶æ‰€æœ‰'é¡µé¢çŠ¶æ€'å’Œ'å…¨å±€çŠ¶æ€'(å¦‚routerï¼Œ languageï¼Œ global(ä¾‹å¦‚ç”¨æˆ·é‰´æƒä¿¡æ¯))</span><br></pre></td></tr></table></figure><p><br></p><p><strong>ğŸ¤¬ å¼€å§‹åæ§½!</strong></p><p><br></p><ul><li><p><strong>ä¸€ï¼ŒRedux æ ¸å¿ƒåº“å¾ˆå°ï¼Œåªæä¾›äº† dispatch å’Œ reducer æœºåˆ¶ï¼Œå¯¹äºå„ç§å¤æ‚çš„å‰¯ä½œç”¨å¤„ç† Redux é€šè¿‡æä¾›ä¸­é—´ä»¶æœºåˆ¶å¤–åŒ…å‡ºå»</strong>ã€‚ç¤¾åŒºæœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼Œredux-promise, redux-saga, redux-observableâ€¦ æŸ¥çœ‹ Redux çš„<a href="https://redux.js.org/introduction/ecosystem#actions" target="_blank" rel="noopener">ç”Ÿæ€ç³»ç»Ÿ</a>.</p><p><strong>Redux ä¸­é—´ä»¶çš„å¥½å¤„æ˜¯æ‰©å±•æ€§éå¸¸å¥½, å¼€å‘è€…å¯ä»¥åˆ©ç”¨ä¸­é—´ä»¶æŠ½è±¡é‡å¤çš„ä¸šåŠ¡ e ä¸­é—´ä»¶ç”Ÿæ€ä¹Ÿç™¾èŠ±é½æ”¾, ä½†æ˜¯å¯¹äºåˆå­¦è€…åˆ™ä¸å‹å¥½</strong>.</p><p>TM èµ·ç è¿˜å¾—éœ€è¦å»äº†è§£å„ç§å„æ ·çš„åº“ï¼Œæ¨ªå‘æ¯”è¾ƒçš„ä¸€ä¸‹æ‰çŸ¥é“è‡ªå·±éœ€è¦æ­é…å“ªä¸ªåº“å§? é‚£å¥½å§ï¼Œå°±é€‰ redux-saga å§ï¼Œstar æ•°æ¯”è¾ƒå¤šã€‚åé¢åˆæœ‰ç‰›äººè¯´ä¸è¦é¢å‘ star ç¼–ç¨‹ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±å›¢é˜Ÿçš„æ‰æ˜¯æœ€å¥½çš„â€¦ æ‰€ä»¥æŒ‘é€‰åˆé€‚çš„æ–¹æ¡ˆä¹‹å‰è¿˜æ˜¯å¾—è¦äº†è§£å„ç§æ–¹æ¡ˆæœ¬èº«å§?ã€‚</p><p>Vue ä¹‹æ‰€ä»¥å­¦ä¹ æ›²çº¿æ¯”è¾ƒå¹³ç¼“ä¹Ÿåœ¨äºæ­¤å§ã€‚å®ƒå¸®åŠ©æˆ‘ä»¬åšäº†å¾ˆå¤šé€‰æ‹©ï¼Œæä¾›ç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œå¦å¤–å®˜æ–¹è¿˜æä¾›äº†é£æ ¼æŒ‡å—å’Œæœ€ä½³å®è·µ. è¿™äº›é€‰æ‹©é€‚åˆ 80%ä»¥ä¸Šçš„å¼€å‘éœ€æ±‚. å¼€å‘è€…å‡å°‘äº†å¾ˆå¤šæŠ˜è…¾çš„æ—¶é—´ï¼Œå¯ä»¥ä¸“å¿ƒå†™ä¸šåŠ¡. <strong>è¿™æ‰æ˜¯æ‰€è°“çš„â€˜<a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">æ¸è¿›å¼</a>â€™æ¡†æ¶å§, å¯¹äºä¸çˆ±æŠ˜è…¾çš„æˆ–åˆå­¦è€…ï¼Œæˆ‘ä»¬å¸®ä½ é€‰æ‹©ï¼Œä½†ä¹Ÿä¸ä¼šé˜»ç¢ä½ å¾€é«˜çº§çš„åœ°æ–¹èµ°</strong>ã€‚ è¿™é‡Œå¯ä»¥æ„Ÿå—åˆ° React ç¤¾åŒºå’Œ Vue ç¤¾åŒºçš„é£æ ¼å®Œå…¨ä¸åŒ.</p><p>åœ¨å‡ºç°é€‰æ‹©å›°éš¾ç—‡æ—¶ï¼Œè¿˜æ˜¯çœ‹çœ‹åˆ«äººæ€ä¹ˆé€‰æ‹©ï¼Œæ¯”å¦‚æ¯”è¾ƒæœ‰å½±å“åŠ›çš„å›¢é˜Ÿæˆ–è€…æµè¡Œçš„å¼€æºé¡¹ç›®(å¦‚ dvaï¼Œrematch)ï¼Œé€‰å–ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ, åç»­æœ‰å†æ…¢æ…¢æ·±å…¥ç ”ç©¶. <strong>å¯¹äº Redux ç›®å‰æ¯”è¾ƒæµè¡Œçš„ç»„åˆå°±æ˜¯: <code>immer+saga+reselect</code></strong></p><p><br></p></li><li><p><strong>äºŒï¼Œå¤ªå¤šæ¨¡æ¿ä»£ç </strong>ã€‚æ¯”å¦‚ä¸Šé¢çš„ react-boilerplate, æ¶‰åŠäº”ä¸ªæ–‡ä»¶, éœ€è¦å®šä¹‰å„ç§ Action Typeã€Actionã€ Reducerã€Sagaã€Select. æ‰€ä»¥å³ä¾¿æƒ³è¿›è¡Œä¸€ä¸ªå°çš„çŠ¶æ€å˜åŒ–ä¹Ÿéœ€è¦æ›´æ”¹å¥½å‡ ä¸ªåœ°æ–¹:</p><p><img src="/images/04/redux-page.png" alt></p><p>ç¬”è€…ä¸ªäººæ›´å–œæ¬¢ç±»ä¼¼ Vuex è¿™ç§<code>Ducks</code>é£æ ¼çš„ç»„ç»‡æ–¹å¼ï¼Œå°†æ¨¡å—ä¸‹çš„ actionï¼Œsagaï¼Œreducer å’Œ mapper éƒ½ç»„ç»‡åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸‹é¢:</p><center><br> <img src="/codes/redux-ducks.png" width="600"><br></center><p>Redux çš„äºŒæ¬¡å°è£…æ¡†æ¶åŸºæœ¬é‡‡ç”¨ç±»ä¼¼çš„é£æ ¼, å¦‚<a href="https://github.com/rematch/rematch" target="_blank" rel="noopener"><code>rematch</code></a></p><center><br> <img src="/images/04/rematch.png" width="800"><br></center><p>è¿™äº›äºŒæ¬¡å°è£…æ¡†æ¶ä¸€èˆ¬åšäº†ä»¥ä¸‹ä¼˜åŒ–(å…¶å®å¯ä»¥å½“åšæ˜¯ Vuex çš„ä¼˜ç‚¹)ï¼Œæ¥æå‡ Redux çš„å¼€å‘ä½“éªŒ:</p><ul><li><strong>ä½¿ç”¨ Ducks é£æ ¼ç»„ç»‡ä»£ç </strong>.èšåˆåˆ†æ•£çš„ reducerï¼Œsagaï¼Œactionsâ€¦</li><li><strong>æ›´ç®€åŒ–çš„ API</strong></li><li><strong>æä¾›äº†ç®€å•æ˜“ç”¨çš„æ¨¡å—åŒ–(æˆ–è€…ç§°ä¸ºâ€˜åˆ†å½¢â€™)æˆ–è€…å‘½åç©ºé—´æœºåˆ¶</strong>ã€‚æ¨¡å—æœ¬èº«æ”¯æŒâ€˜çŠ¶æ€éš”ç¦»â€™ï¼Œè®©æ¨¡å—çš„ reducerã€saga åªä¸“æ³¨äºæ¨¡å—è‡ªå·±çš„çŠ¶æ€. å¦å¤–æ¨¡å—è¿˜è€ƒè™‘<strong>åŠ¨æ€åŠ è½½</strong></li><li><strong>å†…ç½®å‰¯ä½œç”¨å¤„ç†æœºåˆ¶</strong>ã€‚å¦‚ä½¿ç”¨ saga æˆ– redux-promise</li><li><strong>ç®€åŒ–äº†ä¸å¯å˜æ•°æ®çš„æ“ä½œæ–¹å¼</strong>ã€‚ å¦‚ä½¿ç”¨ immer</li><li><strong>ç®€åŒ– reducer</strong>ã€‚Redux å†…ç½®äº† combineReducers æ¥å¤åˆå¤šä¸ª reducerï¼Œåœ¨ reducer å†…éƒ¨æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ switch è¯­å¥æ¥æ¥æ”¶ action å’Œå¤„ç†æ•°æ®å˜åŠ¨, å…¶å®å†™èµ·æ¥éå¸¸å•°å—¦. <strong>Vuex å’Œè¿™äº›å°è£…æ¡†æ¶ä¸çº¦è€ŒåŒä½¿ç”¨äº† key/value å½¢å¼</strong>, æ›´ä¸ºç®€æ´æ˜äº†</li><li><strong>ç®€åŒ– view å±‚çš„ connect æ¥å£</strong>ã€‚å¦‚ç®€åŒ– mapPropsï¼ŒmapDispatch è¿™äº›ä»£ç å†™èµ·æ¥ä¹Ÿæ¯”è¾ƒç¹ç</li></ul><p><br></p></li><li><p><strong>ä¸‰ï¼Œå¼ºåˆ¶ä¸å¯å˜æ•°æ®</strong>ã€‚å‰é¢æ–‡ç« ä¹Ÿæåˆ°è¿‡ setState å¾ˆå•°å—¦ï¼Œä¸ºäº†ä¿è¯çŠ¶æ€çš„ä¸å¯å˜æ€§æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å¯¹è±¡å±•å¼€æˆ–è€…æ•°ç»„å±•å¼€æ“ä½œç¬¦, å†å¤æ‚ç‚¹å¯ä»¥ä¸Š Immutable.js, è¿™éœ€è¦ä¸€ç‚¹å­¦ä¹ æˆæœ¬. å¥½åœ¨ç°åœ¨æœ‰ immerï¼Œå¯ä»¥æŒ‰ç…§ Javascript çš„å¯¹è±¡æ“ä½œä¹ æƒ¯æ¥å®ç°ä¸å¯å˜æ•°æ®</p><p><br></p></li><li><p><strong>å››ï¼ŒçŠ¶æ€è®¾è®¡</strong>ã€‚</p><p>æ•°æ®ç±»å‹ä¸€èˆ¬åˆ†ä¸º<strong>é¢†åŸŸæ•°æ®(Domain data)</strong>å’Œ<strong>åº”ç”¨æ•°æ®(æˆ–è€…ç§°ä¸º UI æ•°æ®)</strong>. åœ¨ä½¿ç”¨ Redux æ—¶ç»å¸¸éœ€è¦è€ƒè™‘çŠ¶æ€è¦æ”¾åœ¨ç»„ä»¶å±€éƒ¨ï¼Œè¿˜æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½æŠ½å–åˆ° Redux Storeï¼ŸæŠŠè¿™äº›æ•°æ®æ”¾åˆ° Redux Store é‡Œé¢å¤„ç†èµ·æ¥å¥½åƒæ›´éº»çƒ¦ï¼Ÿæ—¢ç„¶éƒ½ä½¿ç”¨ Redux äº†ï¼Œä¸æŠŠæ•°æ®æŠ½å–åˆ° Redux Store æ˜¯å¦ä¸ç¬¦åˆæœ€ä½³å®è·µï¼Ÿ ç¬”è€…ä¹Ÿæ—¶å¸¸æœ‰è¿™æ ·çš„å›°æƒ‘, ä½ ä¹Ÿæ˜¯<a href="https://ruby-china.org/topics/38057" target="_blank" rel="noopener">æœ€ä½³å®è·µçš„å—å®³è€…</a>?</p><p>æˆ‘è§‰å¾—å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªç‚¹è¿›è¡Œè€ƒè™‘:</p><ul><li><strong>é¢†åŸŸæ•°æ®è¿˜æ˜¯åº”ç”¨æ•°æ®?</strong> é¢†åŸŸæ•°æ®ä¸€èˆ¬æ¨èæ”¾åœ¨ ReduxStore ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°† Redux çš„ Store çœ‹ä½œä¸€ä¸ªæ•°æ®åº“ï¼Œå­˜æ”¾èŒƒå¼åŒ–çš„æ•°æ®ã€‚</li><li><strong>çŠ¶æ€æ˜¯å¦ä¼šè¢«å¤šä¸ªç»„ä»¶æˆ–è€…è·¨é¡µé¢å…±äº«ï¼Ÿ</strong> Redux Store æ˜¯ä¸€ä¸ªå…¨å±€çŠ¶æ€å­˜å‚¨å™¨ï¼Œæ—¢ç„¶ä½¿ç”¨ Redux äº†ï¼Œæœ‰ç†ç”±è®© Redux æ¥ç®¡ç†è·¨è¶Šå¤šç»„ä»¶çš„çŠ¶æ€</li><li><strong>çŠ¶æ€æ˜¯å¦éœ€è¦è¢«é•œåƒåŒ–?</strong> å¦‚æœä½ çš„åº”ç”¨è¦åšâ€˜æ—¶é—´æ—…è¡Œ(æ’¤é”€/é‡åš)â€™æˆ–è€…åº”ç”¨æŒä¹…åŒ–ï¼Œè¿™ä¸ªçŠ¶æ€éœ€è¦è¢«æ¢å¤ï¼Œé‚£ä¹ˆåº”è¯¥æ”¾åˆ° Redux Storeï¼Œé›†ä¸­åŒ–ç®¡ç†æ•°æ®æ˜¯ Redux çš„å¼ºé¡¹</li><li><strong>çŠ¶æ€æ˜¯å¦éœ€è¦è·¨è¶Šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</strong> å°†çŠ¶æ€æ”¾åœ¨ç»„ä»¶å±€éƒ¨ï¼Œå°±ä¼šè·Ÿç€ç»„ä»¶ä¸€èµ·è¢«é”€æ¯ã€‚å¦‚æœå¸Œæœ›çŠ¶æ€è·¨è¶Šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œåº”è¯¥æ”¾åˆ°çˆ¶ç»„ä»¶æˆ–è€… Redux Store ä¸­. æ¯”å¦‚ä¸€ä¸ªæ¨¡æ€æ¡†ç¼–è¾‘çš„æ•°æ®åœ¨å…³é—­åæ˜¯å¦éœ€è¦ä¿ç•™</li></ul><p><strong>åŸåˆ™æ˜¯èƒ½æ”¾åœ¨å±€éƒ¨çš„å°±æ”¾åœ¨å±€éƒ¨</strong>. åœ¨å±€éƒ¨çŠ¶æ€å’Œå…¨å±€çŠ¶æ€ä¸­å–èˆéœ€è¦ä¸€ç‚¹å¼€å‘ç»éªŒ.</p><p>å¦å¤–ä½œä¸ºä¸€ä¸ªé›†ä¸­åŒ–çš„çŠ¶æ€ç®¡ç†å™¨ï¼Œä¸ºäº†çŠ¶æ€çš„å¯è¯»æ€§(æ›´å®¹æ˜“ç†è§£)å’Œå¯æ“ä½œæ€§(æ›´å®¹æ˜“å¢åˆ æŸ¥æ”¹)ï¼Œåœ¨çŠ¶æ€ç»“æ„ä¸Šé¢çš„è®¾è®¡ä¹Ÿéœ€è¦èŠ±è´¹ä¸€äº›ç²¾åŠ›çš„. è¿™ä¸ªæ•°æ®åº“ç»“æ„çš„è®¾è®¡æ–¹æ³•æ˜¯ä¸€æ ·çš„, <strong>åœ¨è®¾è®¡çŠ¶æ€ä¹‹å‰ä½ éœ€è¦ç†æ¸…å„ç§é¢†åŸŸå¯¹è±¡ä¹‹é—´çš„å…³ç³», åœ¨æ•°æ®è·å–å’Œæ•°æ®å˜æ›´æ“ä½œå¤æ‚åº¦/æ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡</strong>.</p><p>Redux å®˜æ–¹æ¨è<a href="https://cn.redux.js.org/docs/recipes/reducers/NormalizingStateShape.html" target="_blank" rel="noopener"><strong>èŒƒå¼åŒ– State</strong></a>ï¼Œæ‰å¹³åŒ–ç»“æ„æ ‘, å‡å°‘åµŒå¥—ï¼Œå‡å°‘æ•°æ®å†—ä½™. <strong>ä¹Ÿå°±æ˜¯å€¾å‘äºæ›´æ–¹ä¾¿è¢«æ›´æ–°å’Œå­˜å‚¨ï¼Œè‡³äºè§†å›¾éœ€è¦ä»€ä¹ˆåˆ™äº¤ç”± reselect è¿™äº›åº“è¿›è¡Œè®¡ç®—æ˜ å°„å’Œç»„åˆ</strong>.</p><p>æ‰€ä»¥è¯´ Redux æ²¡é‚£ä¹ˆç®€å•, å½“ç„¶ 80%çš„ Web åº”ç”¨ä¹Ÿä¸éœ€è¦è¿™ä¹ˆå¤æ‚.</p><p><br></p></li><li><p><strong>äº”ï¼Œä¸æ–¹ä¾¿ Typescript ç±»å‹åŒ–</strong>ã€‚ä¸ç®¡æ˜¯ redux è¿˜æ˜¯äºŒæ¬¡å°è£…æ¡†æ¶éƒ½ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ Typescript è¿›è¡Œç±»å‹æ¨å¯¼ï¼Œå°¤å…¶æ˜¯åœ¨åŠ å…¥å„ç§æ‰©å±•åã€‚ä½ å¯èƒ½éœ€è¦æ˜¾å¼æ³¨è§£å¾ˆå¤šæ•°æ®ç±»å‹</p><p>æ‰©å±•: <a href="https://github.com/piotrwitek/react-redux-typescript-guide#redux---typing-patterns" target="_blank" rel="noopener">react-redux-typescript-guide</a>, <a href="https://rematch.gitbooks.io/rematch/docs/recipes/typescript.html" target="_blank" rel="noopener">rematch &amp; Typescript</a><br><br></p></li><li><p><strong>å…­ï¼Œä¸æ˜¯åˆ†å½¢(Fractal)</strong></p><p>åœ¨æ²¡æœ‰çœ‹åˆ°<a href="https://www.zhihu.com/people/yang-jian-feng/activities" target="_blank" rel="noopener">@æ¨å‰‘é”‹</a>çš„è¿™æ¡<a href="https://www.zhihu.com/question/263928256/answer/275092256" target="_blank" rel="noopener">çŸ¥ä¹å›ç­”</a>ä¹‹å‰æˆ‘ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆå«åˆ†å½¢, æˆ‘åªèƒ½å°è¯•è§£é‡Šä¸€ä¸‹æˆ‘å¯¹åˆ†å½¢çš„ç†è§£:</p><p>å‰é¢æ–‡ç« ä¹Ÿæåˆ°è¿‡â€˜åˆ†ç¦»é€»è¾‘å’Œè§†å›¾â€™å’Œâ€˜åˆ†ç¦»å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶â€™ï¼Œè¿™ä¸¤ä¸ªè§„åˆ™éƒ½æ¥è‡ªäº Redux çš„æœ€ä½³å®è·µã€‚<strong>Redux å°±æ˜¯ä¸€ä¸ªâ€™éåˆ†å½¢çš„æ¶æ„â€™ï¼Œå¦‚ä¸‹å›¾ï¼Œåœ¨è¿™ç§ç®€å•çš„â€˜æ¨ªå‘åˆ†å±‚â€™ä¸‹, è§†å›¾å’Œé€»è¾‘(æˆ–çŠ¶æ€)å¯ä»¥è¢«å•ç‹¬å¤ç”¨ï¼Œä½†åœ¨ Redux ä¸­å´å¾ˆéš¾å°†äºŒè€…ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„ç»„ä»¶æ¥å¤ç”¨</strong>:</p><p>  <center><br>  <img src="/images/04/redux-and-dumb.png" width="400"><br>  </center><br>  <em>é›†ä¸­åŒ–çš„ Storeï¼Œå†é€šè¿‡ Connect æœºåˆ¶å¯ä»¥è®©çŠ¶æ€åœ¨æ•´ä¸ªåº”ç”¨èŒƒå›´å†…è¢«å¤ç”¨ï¼›Dumb ç»„ä»¶æŠ½ç¦»çš„çŠ¶æ€å’Œè¡Œä¸ºï¼Œä¹Ÿå®¹æ˜“è¢«å¤ç”¨</em></p><p>ç°åœ¨å‡è®¾ä½ éœ€è¦å°†å•ä¸ª container æŠ½ç¦»æˆç‹¬ç«‹çš„åº”ç”¨ï¼Œå•ä¸ª container æ˜¯æ— æ³•ç‹¬ç«‹å·¥ä½œçš„ã€‚<strong>åœ¨åˆ†å½¢çš„æ¶æ„ä¸‹ï¼Œä¸€ä¸ªâ€˜åº”ç”¨â€™æœ‰æ›´å°çš„â€˜åº”ç”¨â€™ç»„æˆï¼Œâ€˜åº”ç”¨â€™å†…éƒ¨æœ‰è‡ªå·±çš„çŠ¶æ€æœºåˆ¶ï¼Œå•ä¸ªåº”ç”¨å¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå­åº”ç”¨</strong>. ä¾‹å¦‚ Redux çš„é¼»ç¥– Elm çš„æ¶æ„:</p><p>  <center><br>  <img src="/images/04/elm.jpg" width="500"><br>  </center><br>  <em>Storeçš„ç»“æ„å’Œåº”ç”¨çš„ç»“æ„ä¿æŒä¸€è‡´, æ¯ä¸ª Elm ç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ª Elm åº”ç”¨ï¼ŒåŒ…å«å®Œæ•´çš„Actionã€Updateã€Modelå’ŒView. ä½¿å¾—å•ç‹¬çš„åº”ç”¨å¯ä»¥è¢«å¤ç”¨</em></p><p><strong>Redux ä¸æ˜¯åˆ†å½¢å’Œ Redux æœ¬èº«çš„å®šä½æœ‰å…³ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯ç²¹çš„çŠ¶æ€ç®¡ç†å™¨ï¼Œä¸æ¶‰åŠç»„ä»¶çš„è§†å›¾å®ç°ï¼Œæ‰€ä»¥æ— æ³•åƒ elm å’Œ cyclejs ä¸€æ ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„åº”ç”¨é—­ç¯</strong>ã€‚ å…¶å®å¯ä»¥å‘ç° react ç»„ä»¶æœ¬èº«å°±æ˜¯åˆ†å½¢çš„ï¼Œç»„ä»¶åŸæœ¬å°±æ˜¯çŠ¶æ€å’Œè§†å›¾çš„é›†åˆ.</p><p>åˆ†å½¢çš„å¥½å¤„å°±æ˜¯å¯ä»¥å®ç°æ›´çµæ´»çš„å¤ç”¨å’Œç»„åˆï¼Œå‡å°‘èƒ¶æ°´ä»£ç ã€‚æ˜¾ç„¶ç°åœ¨æ”¯æŒçº¯åˆ†å½¢æ¶æ„çš„æ¡†æ¶å¹¶ä¸æµè¡Œï¼ŒåŸå› å¯èƒ½æ˜¯é—¨æ§›æ¯”è¾ƒé«˜ã€‚ä¸ªäººè®¤ä¸ºä¸æ”¯æŒåˆ†å½¢åœ¨å·¥ç¨‹ä¸Šè¿˜ä¸è‡³äºæˆä¸º Redux çš„ç—›ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€˜æ¨¡å—åŒ–â€™å°† Redux æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œåœ¨å¤šä¸ª Container ä¸­è¿›è¡Œç‹¬ç«‹ç»´æŠ¤ï¼Œä»æŸç§ç¨‹åº¦ä¸Šæ˜¯å¦å°±æ˜¯åˆ†å½¢ï¼Ÿå¦å¤–è¿™ç§æ¨ªå‘éš”ç¦»çš„ UI å’ŒçŠ¶æ€ï¼Œä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼Œæ¯”å¦‚ UI ç›¸æ¯”ä¸šåŠ¡çš„çŠ¶æ€å˜åŒ–çš„é¢‘åº¦ä¼šæ›´å¤§.</p><p>ä¸ªäººæ„Ÿè§‰åˆ°é¡µé¢è¿™ä¸ªçº§åˆ«çš„åˆ†åŒ–åˆšåˆšå¥½ï¼Œæ¯”å¦‚æ–¹ä¾¿åˆ†å·¥ã€‚æ¯”å¦‚æœ€è¿‘ç¬”è€…å°±æœ‰è¿™æ ·ä¸€ä¸ªé¡¹ç›®, æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªåŸç”Ÿ Windows å®¢æˆ·ç«¯è½¬æ¢æˆ electron å®ç°ï¼Œé™äºèµ„æºé—®é¢˜ï¼Œè¿™ä¸ªé¡¹ç›®æ¶‰åŠåˆ°ä¸¤ä¸ªå›¢é˜Ÿä¹‹é—´åä½œ. å¯¹äºè¿™ä¸ªé¡¹ç›®åº”ç”¨ Store å°±æ˜¯ä¸€ä¸ªæ¥å£å±‚ï¼ŒWindows å›¢é˜Ÿè´Ÿè´£åœ¨è¿™é‡Œç»´æŠ¤çŠ¶æ€å’Œå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæˆ‘ä»¬å‰ç«¯å›¢é˜Ÿåˆ™è´Ÿè´£å±•ç¤ºå±‚. è¿™æ ·ä¸€æ¥ Windows ä¸éœ€è¦å­¦ä¹  React å’Œè§†å›¾å±•ç¤ºï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å…³ç³»ä»–ä»¬å¤æ‚çš„ä¸šåŠ¡é€»è¾‘(åº•å±‚è¿˜æ˜¯ä½¿ç”¨ C++, æš´éœ²éƒ¨åˆ†æ¥å£ç»™ node)</p></li></ul><p><br></p><p><strong>ä¸ƒï¼Œå¯èƒ½è¿˜æœ‰æ€§èƒ½é—®é¢˜</strong></p><ul><li><a href="https://cn.redux.js.org/docs/faq/Performance.html" target="_blank" rel="noopener">Redux å¸¸è§é—®é¢˜ï¼šæ€§èƒ½</a></li><li><a href="https://www.zhihu.com/question/41904561/answer/93029393" target="_blank" rel="noopener">redux ä¸­çš„ state æ ‘å¤ªå¤§ä¼šä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ</a></li><li><a href="https://tech.youzan.com/mobx_vs_redux/" target="_blank" rel="noopener">æˆ‘ä¸ºä»€ä¹ˆä» Redux è¿ç§»åˆ°äº† Mobx</a></li><li><a href="https://zhuanlan.zhihu.com/p/52625410" target="_blank" rel="noopener">Mobx ä¸ Redux çš„æ€§èƒ½å¯¹æ¯”</a></li></ul><p><br></p><p>æ€»ç»“</p><p>æœ¬èŠ‚ä¸»è¦ä»‹ç»çš„ Redux è®¾è®¡çš„åŠ¨æœºï¼Œä»¥åŠå›´ç»•ç€è¿™ä¸ªåŠ¨æœºä¸€ç³»åˆ—è®¾è®¡, å†ä»‹ç»äº† Redux çš„ä¸€äº›ç¼ºç‚¹å’Œæœ€ä½³å®è·µã€‚Redux çš„ç”Ÿæ€éå¸¸ç¹è£ï¼Œå¦‚æœæ˜¯åˆå­¦è€…æˆ–ä¸æƒ³æŠ˜è…¾è¿˜æ˜¯å»ºè®®ä½¿ç”¨ Dva æˆ– rematch è¿™ç±»äºŒæ¬¡å°è£…æ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶é€šå¸¸å°±æ˜¯ Redux ä¸€äº›æœ€ä½³å®è·µçš„æ²‰æ·€, å‡å°‘æŠ˜è…¾çš„æ—¶é—´ã€‚å½“ç„¶è¿™åªæ˜¯ä¸ªå¼€å§‹ï¼Œç»„ç»‡ä¸€ä¸ªå¤§å‹é¡¹ç›®ä½ è¿˜æœ‰å¾ˆå¤šè¦å­¦çš„ã€‚</p><p><br></p><p>æ‰©å±•é˜…è¯»</p><ul><li><a href="https://www.zhihu.com/question/263928256/answer/275092256" target="_blank" rel="noopener">Redux æœ‰ä»€ä¹ˆç¼ºç‚¹</a> çŸ¥ä¹ä¸Šçš„åæ§½</li><li><a href="https://zhuanlan.zhihu.com/p/27093191" target="_blank" rel="noopener">Redux çŠ¶æ€ç®¡ç†ä¹‹ç—›ç‚¹ã€åˆ†æä¸æ”¹è‰¯</a></li><li><a href="https://www.zhihu.com/question/47995437/answer/108788493" target="_blank" rel="noopener">Redux æœ‰å“ªäº›æœ€ä½³å®è·µ?</a></li><li><a href="https://www.zhihu.com/question/38591713/answer/77634014" target="_blank" rel="noopener">å¦‚ä½•è¯„ä»·æ•°æ®æµç®¡ç†æ¶æ„ Redux?</a></li><li><a href="https://www.zhihu.com/question/284931332/answer/441399919" target="_blank" rel="noopener">2018 å¹´æˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆåŠŸèƒ½æ˜¯ Redux æ‰é€‚åˆåšçš„å—ï¼Ÿ</a></li><li><a href="https://juejin.im/post/5c166d8fe51d45242973fdd3" target="_blank" rel="noopener">Cycle.js çŠ¶æ€ç®¡ç†æ¨¡å‹</a></li><li><a href="https://dvajs.com/guide/develop-complex-spa.html#åŠ¨æ€åŠ è½½model" target="_blank" rel="noopener">ä½¿ç”¨ Dva å¼€å‘å¤æ‚ SPA</a></li><li><a href="https://hackernoon.com/redesigning-redux-b2baee8b8a38" target="_blank" rel="noopener">Redesigning Redux</a></li><li><a href="https://redux.js.org/introduction/getting-started" target="_blank" rel="noopener">Redux å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://zhuanlan.zhihu.com/p/26485702" target="_blank" rel="noopener">redux ä¸‰é‡å¢ƒ</a></li></ul><p><br></p><hr><p><br></p><h2 id="mobx"><a href="#mobx" class="headerlink" title="Mobx"></a>Mobx</h2><p>Mobx æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Vue çš„å“åº”å¼ç³»ç»Ÿï¼Œç›¸å¯¹ Redux æ¥è¯´ Mobx çš„æ¶æ„æ›´å®¹æ˜“ç†è§£ã€‚ æ‹¿å®˜æ–¹çš„å›¾æ¥çœ‹:</p><p><img src="/images/04/mobx-preview.png" alt></p><ul><li><p><strong>å“åº”å¼æ•°æ®</strong>. é¦–å…ˆä½¿ç”¨<code>@observable</code> å°†æ•°æ®è½¬æ¢ä¸ºâ€˜å“åº”å¼æ•°æ®â€™ï¼Œç±»ä¼¼äº Vue çš„ dataã€‚è¿™äº›æ•°æ®åœ¨ä¸€äº›ä¸Šä¸‹æ–‡(ä¾‹å¦‚ computedï¼Œobserver çš„åŒ…è£…çš„ React ç»„ä»¶ï¼Œreaction)ä¸­è¢«è®¿é—®æ—¶å¯ä»¥è¢«æ”¶é›†ä¾èµ–ï¼Œå½“è¿™äº›æ•°æ®å˜åŠ¨æ—¶ç›¸å…³çš„ä¾èµ–å°±ä¼šè¢«é€šçŸ¥.</p><p>å“åº”å¼æ•°æ®å¸¦æ¥çš„ä¸¤ä¸ªä¼˜ç‚¹æ˜¯ â‘  ç®€åŒ–æ•°æ®æ“ä½œæ–¹å¼(ç›¸æ¯” redux å’Œ setState); â‘¡ ç²¾ç¡®çš„æ•°æ®ç»‘å®šï¼Œåªæœ‰æ•°æ®çœŸæ­£å˜åŠ¨æ—¶ï¼Œè§†å›¾æ‰éœ€è¦æ¸²æŸ“ï¼Œç»„ä»¶ä¾èµ–çš„ç²’åº¦è¶Šå°ï¼Œè§†å›¾å°±å¯ä»¥æ›´ç²¾ç»†åœ°æ›´æ–°</p></li><li><p><strong>è¡ç”Ÿ</strong>.</p><ul><li>è¡ç”Ÿæ•°æ®ã€‚Mobx ä¹Ÿæ¨èä¸è¦åœ¨çŠ¶æ€ä¸­æ”¾ç½®å†—ä½™æˆ–å¯æ¨å¯¼çš„æ•°æ®ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>@computed</code> è®¡ç®—è¡ç”Ÿçš„çŠ¶æ€. computed çš„æ¦‚å¿µç±»ä¼¼äº Redux ä¸­çš„ reselectï¼Œå¯¹èŒƒå¼åŒ–çš„æ•°æ®è¿›è¡ŒåèŒƒå¼åŒ–æˆ–è€…èšåˆè®¡ç®—</li><li>å‰¯ä½œç”¨è¡ç”Ÿ. å½“æ•°æ®å˜åŠ¨æ—¶è§¦å‘ä¾èµ–è¯¥æ•°æ®çš„å‰¯ä½œç”¨ï¼Œå…¶ä¸­åŒ…å«â€˜è§†å›¾â€™ã€‚è§†å›¾æ˜¯å“åº”å¼æ•°æ®çš„æ˜ å°„</li></ul></li><li><p><strong>æ•°æ®å˜æ›´</strong>. mobx æ¨èåœ¨ <code>action/flow(å¼‚æ­¥æ“ä½œ)</code> ä¸­å¯¹æ•°æ®è¿›è¡Œå˜æ›´ï¼Œaction å¯ä»¥è®¤ä¸ºæ˜¯ Redux ä¸­çš„ dispatch+reducer çš„åˆä½“ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ mobx ä¼šé™åˆ¶åªèƒ½åœ¨ action å‡½æ•°ä¸­è¿›è¡Œå˜æ›´ï¼Œè¿™ä½¿å¾—çŠ¶æ€çš„å˜æ›´å¯è¢«è¿½æº¯ã€‚<strong>æ¨èåœ¨ flow å‡½æ•°ä¸­éš”ç¦»å‰¯ä½œç”¨ï¼Œè¿™ä¸ªä¸œè¥¿å’Œ Redux-saga å·®ä¸å¤šï¼Œé€šè¿‡ generator æ¥è¿›è¡Œå¼‚æ­¥æ“ä½œå’Œå‰¯ä½œç”¨éš”ç¦»</strong></p></li></ul><p><br></p><p>ä¸Šé¢å°±æ˜¯ Mobx çš„æ ¸å¿ƒæ¦‚å¿µã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><center><br><img src="/codes/mobx-demo.png" width="650"><br></center><p>ä½†æ˜¯<strong>Mobx ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶</strong>ï¼Œå®ƒä¸ä¼šåƒ Redux ä¸€æ ·å‘Šè¯‰ä½ å¦‚ä½•å»ç»„ç»‡ä»£ç ï¼Œåœ¨å“ªå­˜å‚¨çŠ¶æ€æˆ–è€…å¦‚ä½•å¤„ç†äº‹ä»¶, ä¹Ÿæ²¡æœ‰æœ€ä½³å®è·µã€‚å¥½å¤„æ˜¯ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½ç»„ä»¶é¡¹ç›®ï¼Œæ¯”å¦‚æŒ‰ç…§ Redux(Vuex)æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡æ–¹å¼ç»„ç»‡; åå¤„æ˜¯å¦‚æœä½ æ²¡æœ‰ç›¸å…³ç»éªŒ, ä¼šä¸çŸ¥æ‰€æªï¼Œä¸çŸ¥é“å¦‚ä½•ç»„ç»‡ä»£ç </p><p>Mobx ä¸€èˆ¬ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼å¯¹ Store è¿›è¡Œç»„ç»‡, å®˜æ–¹æ–‡æ¡£<a href="https://cn.mobx.js.org/best/store.html" target="_blank" rel="noopener">æ„å»ºå¤§å‹å¯æ‰©å±•å¯ç»´æŠ¤é¡¹ç›®çš„æœ€ä½³å®è·µ</a>ä¹Ÿä»‹ç»äº†è¿™ç§æ–¹å¼, è¿™ä¸ªå…¶å®å°±æ˜¯ç»å…¸çš„ MV* æ¨¡å¼:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/          # å±•ç¤ºç»„ä»¶</span><br><span class="line">  models/              # ğŸ”´ æ”¾ç½®ä¸€äº›é¢†åŸŸå¯¹è±¡</span><br><span class="line">    Order.ts</span><br><span class="line">    User.ts</span><br><span class="line">    Product.ts</span><br><span class="line">    ...</span><br><span class="line">  stores/              # store</span><br><span class="line">    AppStore.ts        # åº”ç”¨Storeï¼Œå­˜æ”¾åº”ç”¨å…¨å±€ä¿¡æ¯ï¼Œå¦‚authï¼Œlanguageï¼Œtheme</span><br><span class="line">    OrderStore.ts</span><br><span class="line">    RootStore.ts       # æ ¹Storeï¼Œç»„åˆæ‰€æœ‰ä¸‹çº§Store</span><br><span class="line">    ...</span><br><span class="line">  containers/</span><br><span class="line">    App/               # æ ¹ç»„ä»¶</span><br><span class="line">    Orders/            # é¡µé¢ç»„ä»¶</span><br><span class="line">    ...</span><br><span class="line">  utils/</span><br><span class="line">  store.ts             # storeåˆå§‹åŒ–</span><br><span class="line">  index.tsx</span><br></pre></td></tr></table></figure><p><br></p><p><strong>é¢†åŸŸå¯¹è±¡</strong></p><p>é¢å‘å¯¹è±¡é¢†åŸŸæœ‰å¤ªå¤šçš„åè¯å’Œæ¦‚å¿µï¼Œè€Œä¸”æ¯”è¾ƒæŠ½è±¡ï¼Œå¦‚æœç†è§£æœ‰è¯¯è¯·çº æ­£. æš‚ä¸”ä¸å»ç†è®ºé¢†åŸŸå¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œå°šä¸”è§†ä½œæ˜¯ç°å®ä¸–ç•Œä¸­ä¸€ä¸ªä¸šåŠ¡å®ä½“åœ¨ OOP çš„æŠ½è±¡. å…·ä½“æ¥è¯´å¯ä»¥å½“åš<code>MVC</code>æ¨¡å¼ä¸­çš„ M, æˆ–è€…æ˜¯ ORM ä¸­æ•°æ®åº“ä¸­æ˜ å°„å‡ºæ¥çš„å¯¹è±¡.</p><p>å¯¹äºå¤æ‚çš„é¢†åŸŸå¯¹è±¡ï¼Œä¼šæŠ½å–ä¸ºå•ç‹¬çš„ç±»ï¼Œæ¯”å¦‚å‰é¢ä¾‹å­ä¸­çš„<code>Todo</code>ç±», æŠ½å–ä¸ºç±»çš„å¥½å¤„æ˜¯å®ƒå…·æœ‰å°è£…æ€§ï¼Œå¯ä»¥åŒ…å«å…³è”çš„è¡Œä¸ºã€å®šä¹‰å’Œå…¶ä»–å¯¹è±¡çš„å…³è”å…³ç³»ï¼Œç›¸æ¯”çº¯å¯¹è±¡è¡¨è¾¾èƒ½åŠ›æ›´å¼º. ç¼ºç‚¹å°±æ˜¯ä¸å¥½åºåˆ—åŒ–</p><p>å› ä¸ºå®ƒä»¬å’Œé¡µé¢çš„å…³è”å…³ç³»è¾ƒå¼±ï¼Œä¸”å¯èƒ½åœ¨å¤šä¸ªé¡µé¢ä¸­è¢«å¤ç”¨, æ‰€ä»¥æ”¾åœ¨æ ¹ç›®å½•çš„<code>models/</code>ä¸‹. åœ¨ä»£ç å±‚é¢é¢†åŸŸå¯¹è±¡æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å®šä¹‰äº†ä¸€äº›å­—æ®µ(@observable)å’Œä¸€äº›é¢†åŸŸå¯¹è±¡çš„æ“ä½œæ–¹æ³•(@action), å¯èƒ½è¿˜å…³è”å…¶ä»–é¢†åŸŸå¯¹è±¡ï¼Œæ¯”å¦‚è®¢å•ä¼šå…³è”ç”¨æˆ·å’Œäº§å“</li><li>ç”± Store æ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–è€…è¯´ Store å°± Model çš„å®¹å™¨, ç›¸å½“äºæ•°æ®åº“. Store é€šå¸¸ä¹Ÿæ˜¯å•ä¾‹</li></ul><p>ç¤ºä¾‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Order &#123;</span><br><span class="line">  <span class="keyword">public</span> id: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> createdDate: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> product: Product;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> user: User;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>Store</strong></p><p>Store åªæ˜¯ä¸€ä¸ª Model å®¹å™¨ï¼Œ è´Ÿè´£ç®¡ç† model å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€å®šä¹‰è¡ç”ŸçŠ¶æ€ã€å°è£…å‰¯ä½œç”¨ã€å’Œåç«¯æ¥å£é›†æˆç­‰ç­‰. Store ä¸€èˆ¬æ˜¯å•ä¾‹. åœ¨ Mobx åº”ç”¨ä¸­ä¸€èˆ¬ä¼šåˆ’åˆ†ä¸ºå¤šä¸ª Store ç»‘å®šä¸åŒçš„é¡µé¢ã€‚</p><p>ç¤ºä¾‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, computed, reaction &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> OrderStore &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰æ¨¡å‹state</span></span><br><span class="line">  <span class="meta">@observable</span> orders: Order[] = [];</span><br><span class="line"></span><br><span class="line">  _unSubscribeOrderChange: <span class="built_in">Function</span></span><br><span class="line">  rootStore: RootStore</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰è¡ç”Ÿæ•°æ®</span></span><br><span class="line">  <span class="meta">@computed</span> <span class="keyword">get</span> finishedOrderCount() &#123;&#125;</span><br><span class="line">  <span class="meta">@computed</span> <span class="keyword">get</span> finishedOrders() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰å‰¯ä½œç”¨è¡ç”Ÿ</span></span><br><span class="line">  subscribeOrderChange() &#123;      <span class="keyword">this</span>._unSubscribeOrderChange = <span class="keyword">this</span>.orders.observe(<span class="function">(<span class="params">changeData</span>) =&gt;</span> &#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰action</span></span><br><span class="line">  <span class="meta">@action</span>  addOrder (order) &#123;&#125;</span><br><span class="line">  <span class="meta">@action</span>  removeOrder (order) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æˆ–è€…ä¸€äº›å¼‚æ­¥çš„action</span></span><br><span class="line">  <span class="keyword">async</span> fetchOrders () &#123;</span><br><span class="line">    <span class="keyword">const</span> orders = <span class="keyword">await</span> fetchOrders()</span><br><span class="line">    orders.forEach(<span class="function"><span class="params">item</span> =&gt;</span> <span class="keyword">this</span>.addOrder(<span class="keyword">new</span> OrderModel(<span class="keyword">this</span>, item)))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–æ•°æ®ç»“æ„ï¼Œåˆå§‹åŒ–è®¢é˜…ç­‰ç­‰</span></span><br><span class="line">  initialize () &#123;</span><br><span class="line">    <span class="keyword">this</span>.subscribeOrderChange()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸€äº›æ¸…ç†å·¥ä½œ</span></span><br><span class="line">  release () &#123;</span><br><span class="line">    <span class="keyword">this</span>._unSubscribeOrderChange()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">store: RootStore</span>) &#123;</span><br><span class="line">    <span class="comment">// å’ŒrootStoreè¿›è¡Œé€šä¿¡</span></span><br><span class="line">    <span class="keyword">this</span>.rootStore = store</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹ Store</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> RootStore &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.appStore = <span class="keyword">new</span> AppStore(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.orderStore = <span class="keyword">new</span> OrderStore(<span class="keyword">this</span>);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Provider rootStore=&#123;new RootStore()&#125;&gt;</span><br><span class="line">  &lt;App /&gt;</span><br><span class="line">&lt;/Provider&gt;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸ª <a href="https://github.com/gothinkster/react-mobx-realworld-example-app/blob/master/src/index.js" target="_blank" rel="noopener">çœŸå®ä¸–ç•Œçš„ä¾‹å­</a></p><p>è¿™ç§ä¼ ç»Ÿ MVC çš„ç»„ç»‡æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¼˜ç‚¹:</p><ul><li><strong>å¥½ç†è§£, å®¹æ˜“å…¥æ‰‹</strong>. ç»å…¸çš„ MVC æ¨¡å¼ã€é¢å‘å¯¹è±¡ï¼Œæˆ‘ä»¬å†ç†Ÿæ‚‰ä¸è¿‡äº†. å°¤å…¶æ˜¯ç†Ÿæ‚‰ Java è¿™äº›ä¼ ç»Ÿé¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼çš„åç«¯å¼€å‘äººå‘˜. ä¸Šæ–‡æåˆ°çš„è·¨å›¢é˜Ÿçš„é¡¹ç›®ï¼Œæˆ‘ä»¬é€‰æ‹©çš„å°±æ˜¯ mobx ä½œä¸ºçŠ¶æ€ç®¡ç†å™¨ï¼Œå¯¹äºä»–ä»¬æ¥è¯´è¿™æ˜¯æœ€å¥½ç†è§£çš„æ–¹å¼. ä½†æ˜¯<strong>å¯¹äºé¢†åŸŸå¯¹è±¡å’Œé¢†åŸŸ Store çš„æ‹†åˆ†å’Œè®¾è®¡éœ€è¦ä¸€ç‚¹ç»éªŒ</strong></li><li><strong>å¼ºç±»å‹</strong></li><li><strong>ä»£ç ç®€æ´</strong>ã€‚ç›¸å¯¹ Redux å¤šä½™çš„æ¨¡æ¿ä»£ç è€Œè¨€</li><li><strong>æ•°æ®å°è£…æ€§</strong>ã€‚ä½¿ç”¨ç±»è¡¨è¾¾çš„æ•°æ®ç»“æ„å¯ä»¥å°è£…ç›¸åº”çš„è¡Œä¸º</li></ul><p>é—®é¢˜</p><ul><li><strong>åœ¨å¤šä¸ª Store ä¹‹é—´å…±äº«æ•°æ®æ¯”è¾ƒéº»çƒ¦</strong>. æˆ‘ä»¬çš„åšæ³•æ˜¯è®©æ‰€æœ‰ Store éƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ä½œä¸ºä¸­é—´è€…ï¼Œé€šè¿‡äº‹ä»¶è®¢é˜…æ¨¡å¼åœ¨å¤šä¸ª Store é—´è¿›è¡Œæ•°æ®é€šä¿¡</li><li><strong>ç¼ºä¹ç»„ç»‡</strong>ã€‚ç›¸å¯¹ Redux è€Œè¨€, çŠ¶æ€è¿‡äºé›¶æ•£ï¼Œä¸åŠ ä»¥çº¦æŸï¼ŒçŠ¶æ€å¯ä»¥è¢«éšæ„ä¿®æ”¹ã€‚æˆ‘ä»¬å¾ˆå¤šä»£ç å°±æ˜¯è¿™æ ·ï¼Œæ‡’å¾—å†™ actionï¼Œç”šè‡³ç›´æ¥åœ¨è§†å›¾å±‚ç»™çŠ¶æ€èµ‹å€¼. æ‰€ä»¥ä¸€å®šè¦å¼€å§‹ä¸¥æ ¼æ¨¡å¼</li><li><strong>æ²¡æœ‰ Magic</strong>. è¿™æ˜¯ä¸€æŠŠåŒåˆƒå‰‘, Redux æœ‰ä¸­é—´ä»¶æœºåˆ¶ï¼Œå¯ä»¥æ‰©å±•æŠ½è±¡è®¸å¤šé‡å¤çš„å·¥ä½œ, æ¯”å¦‚ä¸ºå¼‚æ­¥æ–¹æ³•æ·»åŠ  loading çŠ¶æ€, ä½†æ˜¯å¯¹ Typescript ä¸å‹å¥½; åŸºäºç±»çš„æ–¹æ¡ˆï¼Œæ— å¤„ä¸‹æ‰‹ï¼Œä»£ç ä¼šæ¯”è¾ƒå•°å—¦ï¼Œ ä½†æ›´ç›´è§‚</li><li><strong>æ— æ•°æ®å¿«ç…§</strong>ï¼Œæ— æ³•å®ç°æ—¶é—´å›æº¯ï¼Œè¿™æ˜¯ Redux çš„å¼ºé¡¹ï¼Œä½†å¤§éƒ¨åˆ†çš„åº”ç”¨ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½; å¦å¤–å¯ä»¥é€šè¿‡ mobx-state-tree å®ç°</li><li><strong>æ— æ³• hot-reload</strong></li></ul><p><br></p><p>è¿˜æœ‰ä¸€äº› mobx æœ¬èº«çš„é—®é¢˜, è¿™äº›é—®é¢˜åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæè¿‡, å¦å¤–å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« (<a href="https://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697266952&amp;idx=2&amp;sn=a3389d1db237c2b23f523061da3b2359" target="_blank" rel="noopener">Mvvm å‰ç«¯æ•°æ®æµæ¡†æ¶ç²¾è®²</a>):</p><ul><li><p><strong>ç»„ä»¶ä¾µå…¥æ€§</strong>. éœ€è¦æ”¹å˜ React ç»„ä»¶åŸæœ¬çš„ç»“æ„, ä¾‹å¦‚æ‰€æœ‰éœ€è¦å“åº”æ•°æ®å˜åŠ¨çš„ç»„ä»¶éƒ½éœ€è¦ä½¿ç”¨ observer è£…é¥°. ç»„ä»¶æœ¬åœ°çŠ¶æ€ä¹Ÿéœ€è¦ observable è£…é¥°, ä»¥åŠæ•°æ®æ“ä½œæ–¹å¼ç­‰ç­‰. å¯¹ mobx è€¦åˆè¾ƒæ·±, æ—¥ååˆ‡æ¢æ¡†æ¶æˆ–é‡æ„çš„æˆæœ¬å¾ˆé«˜</p></li><li><p><strong>å…¼å®¹æ€§</strong>. mobx v5 åä½¿ç”¨ Proxy è¿›è¡Œé‡æ„, ä½† Proxy åœ¨ Chrome49 ä¹‹åæ‰æ”¯æŒ. å¦‚æœè¦å…¼å®¹æ—§ç‰ˆæµè§ˆå™¨åˆ™åªèƒ½ä½¿ç”¨ v4, v4 æœ‰ä¸€äº›<a href="https://cn.mobx.js.org/#mobx-4-vs-mobx-5" target="_blank" rel="noopener">å‘</a>, è¿™äº›å‘å¯¹äºä¸äº†è§£ mobx çš„æ–°æ‰‹å¾ˆéš¾å‘ç°:</p><ul><li>Observable æ•°ç»„å¹¶éçœŸæ­£çš„æ•°ç»„. æ¯”å¦‚ antd çš„ Table ç»„ä»¶å°±ä¸è®¤ mobx çš„æ•°ç»„, éœ€è¦ä¼ å…¥åˆ°ç»„ä»¶ä¹‹é—´ä½¿ç”¨ slice è¿›è¡Œè½¬æ¢</li><li>å‘ä¸€ä¸ªå·²å­˜åœ¨çš„ observable å¯¹è±¡ä¸­æ·»åŠ å±æ€§ä¸ä¼šè¢«è‡ªåŠ¨æ•è·</li></ul></li></ul><p><br></p><p><code>MV*</code> åªæ˜¯ Mobx çš„å…¶ä¸­ä¸€ç§ä¸»æµç»„ç»‡æ–¹å¼, å¾ˆå¤šæ–‡ç« åœ¨è®¨è®º Redux å’Œ mobx æ—¶å¾€å¾€ä¼šæ²¦ä¸º<strong>å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡</strong>ä¹‹äº‰ï¼Œç„¶åå°±ä¸‹ç»“è®ºè¯´ Redux æ›´é€‚åˆå¤§å‹é¡¹ç›®ï¼Œ<strong>ä¸‹è¿™ç§ç»“è®ºæœ€ä¸»è¦çš„åŸå› æ˜¯ Redux æœ‰æ›´å¤šçº¦æŸ(only one way to do it), é€‚åˆé¡¹ç›®çš„æ¼”è¿›å’Œå›¢é˜Ÿåä½œ, è€Œä¸åœ¨äºå‡½æ•°å¼å’Œé¢å‘å¯¹è±¡</strong>ã€‚å½“ç„¶å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡èŒƒå¼éƒ½æœ‰è‡ªå·±æ“…é•¿çš„é¢†åŸŸï¼Œä¾‹å¦‚å‡½æ•°å¼é€‚åˆæ•°æ®å¤„ç†å’Œå¤æ‚æ•°æ®æµæŠ½è±¡ï¼Œè€Œé¢å‘å¯¹è±¡é€‚åˆä¸šåŠ¡æ¨¡å‹çš„æŠ½è±¡, æ‰€ä»¥ä¸è¦ä¸€ç«¿å­æ‰“æ­».</p><p>æ¢å¥è¯è¯´é€‚ä¸é€‚åˆå¤§å‹é¡¹ç›®æ˜¯é¡¹ç›®ç»„ç»‡é—®é¢˜, Mobx å‰æœŸå¹¶æ²¡æœ‰æå‡ºä»»ä½•è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µã€‚è¿™ä¸åæ¥å…¶ä½œè€…ä¹Ÿå¼€å‘äº†<a href="https://github.com/mobxjs/mobx-state-tree" target="_blank" rel="noopener">mobx-state-tree</a>è¿™ä¸ªç¥å™¨ï¼Œä½œä¸º MobX å®˜æ–¹æä¾›çš„çŠ¶æ€æ¨¡å‹æ„å»ºåº“ï¼ŒMST å¸æ”¶äº† Redux ç­‰å·¥å…·çš„ä¼˜ç‚¹ï¼Œ<strong>æ—¨åœ¨ç»“åˆä¸å¯å˜æ•°æ®/å‡½æ•°å¼(transactionality, traceability and composition)å’Œå¯å˜æ•°æ®/é¢å‘å¯¹è±¡(discoverability, co-location and encapsulation)ä¸¤è€…çš„ä¼˜ç‚¹</strong>ï¼Œ æä¾›äº†å¾ˆå¤šè¯¸å¦‚æ•°æ®é•œåƒ(time travel)ã€hot reloadã€action middlewareã€é›†æˆ redux-devtools ä»¥åŠå¼ºç±»å‹(Typescript + è¿è¡Œæ—¶æ£€æŸ¥(äº‰è®®ç‚¹))ç­‰å¾ˆæœ‰ç”¨çš„ç‰¹æ€§, å…¶å®å®ƒæ›´åƒæ˜¯åç«¯ ActiveRecord è¿™ç±» ORM å·¥å…·, æ„å»ºä¸€ä¸ªå¯¹è±¡å›¾ã€‚</p><center><br>  <img src="/images/04/immutable-vs-mutable.png" width="500"><br></center><p>å…¸å‹çš„ä»£ç ï¼š</p><center><br>  <img src="/codes/mst.png" width="800"><br></center><p>é™äºç¬”è€…å¯¹ MST å®è·µä¸å¤šï¼Œè€Œä¸”æ–‡ç« ç¯‡å¹…å·²ç»å¾ˆé•¿ï¼Œæ‰€ä»¥å°±ä¸å±•å¼€äº†ï¼Œåç»­æœ‰æœºä¼šå†åˆ†äº«åˆ†äº«ã€‚</p><p><br></p><p>è¿˜æ˜¯å¾—ä¸‹ä¸€ä¸ªç»“è®º, é€‰æ‹© Mobx è¿˜æ˜¯ Redux? è¿™é‡Œè¿˜æ˜¯å¼•ç”¨æ¥è‡ª<a href="https://zhuanlan.zhihu.com/p/25989654" target="_blank" rel="noopener">MobX vs Redux: Comparing the Opposing Paradigms - React Conf 2017 çºªè¦</a>çš„ç»“è®º:</p><ul><li>éœ€è¦å¿«é€Ÿå¼€å‘ç®€å•åº”ç”¨çš„å°å›¢é˜Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ MobXï¼Œå› ä¸º MobX éœ€è¦å¼€å‘çš„ä»£ç é‡å°ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œä¸Šæ‰‹å¿«ï¼Œé€‚åˆäºå®æ—¶ç³»ç»Ÿï¼Œä»ªè¡¨ç›˜ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ¼”ç¤ºè½¯ä»¶ï¼Œä½†ä¸é€‚ç”¨äºåŸºäºäº‹ä»¶çš„ç³»ç»Ÿ</li><li>Redux é€‚ç”¨äºå¤§å›¢é˜Ÿå¼€å‘å¤æ‚åº”ç”¨ï¼ŒRedux åœ¨å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§æ–¹é¢å¯ä»¥ hold ä½å¤šäººåä½œä¸ä¸šåŠ¡éœ€æ±‚å¤šå˜ï¼Œé€‚åˆå•†ä¸šç³»ç»Ÿã€åŸºäºäº‹ä»¶çš„ç³»ç»Ÿä»¥åŠæ¶‰åŠå¤æ‚ååº”çš„æ¸¸æˆåœºæ™¯ã€‚</li></ul><p>ä¸Šè¿°ç»“è®ºçš„ä¸»è¦ä¾æ®æ˜¯ Redux å¯¹ action / event ä½œå‡ºååº”ï¼Œè€Œ MobX å¯¹ state å˜åŒ–ä½œå‡ºååº”ã€‚æ¯”å¦‚å½“ä¸€ä¸ªæ•°æ®å˜æ›´æ¶‰åŠåˆ° Mobx çš„å¤šä¸ª Storeï¼Œå¯ä»¥ä½“ç°å‡º Redux çš„æ–¹å¼æ›´åŠ ä¼˜é›…ï¼Œæ•°æ®æµæ›´åŠ æ¸…æ™°. å‰é¢éƒ½è¯¦å°½é˜è¿°äº† Mobx å’Œ Redux çš„ä¼˜ç¼ºç‚¹ï¼Œmobx è¿˜æœ‰ MST åŠ æŒï¼Œ ç›¸ä¿¡è¯»è€…å¿ƒé‡Œæ—©å·²æœ‰è‡ªå·±çš„å–œå¥½</p><p><br></p><p>æ‰©å±•</p><ul><li><a href="https://zhuanlan.zhihu.com/p/33761397" target="_blank" rel="noopener">ä½ éœ€è¦ Mobx è¿˜æ˜¯ Reduxï¼Ÿ</a></li><li><a href="https://zhuanlan.zhihu.com/p/25585910" target="_blank" rel="noopener">Mobx æ€æƒ³çš„å®ç°åŸç†ï¼ŒåŠä¸ Redux å¯¹æ¯”</a></li><li><a href="https://zhuanlan.zhihu.com/p/25989654" target="_blank" rel="noopener">MobX vs Redux: Comparing the Opposing Paradigms - React Conf 2017 çºªè¦</a></li><li><a href="https://github.com/dobjs/dob" target="_blank" rel="noopener">dob</a> æ›´è½»é‡çš„ç±»ä¼¼ mobx çš„è½®å­</li><li><a href="https://segmentfault.com/a/1190000018940757" target="_blank" rel="noopener">ç§¯æ¢¦å‰ç«¯é‡‡ç”¨çš„ React çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ: Rex</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697266952&amp;idx=2&amp;sn=a3389d1db237c2b23f523061da3b2359" target="_blank" rel="noopener">å¹²è´§ | Mvvm å‰ç«¯æ•°æ®æµæ¡†æ¶ç²¾è®²</a></li></ul><h2 id="rxjs"><a href="#rxjs" class="headerlink" title="RxJS"></a>RxJS</h2><p>å¦‚æœä¸Šæ–‡æåˆ°çš„çŠ¶æ€ç®¡ç†å·¥å…·éƒ½æ— æ³•æ»¡è¶³ä½ çš„éœ€è¦ï¼Œä½ çš„é¡¹ç›®å¤æ‚ç¨‹åº¦å¯èƒ½è¶…è¿‡å…¨å›½ 99%çš„é¡¹ç›®äº†. RxJS å¯èƒ½å¯ä»¥åŠ©ä½ ä¸€è‡‚ä¹‹åŠ›, <strong>RxJS éå¸¸é€‚åˆå¤æ‚å¼‚æ­¥äº‹ä»¶æµçš„åº”ç”¨</strong>ï¼Œç¬”è€…åœ¨è¿™æ–¹é¢å®è·µä¹Ÿæ¯”è¾ƒå°‘ï¼Œæ¨èçœ‹çœ‹<a href="https://www.zhihu.com/people/sharpmaster/posts" target="_blank" rel="noopener">å¾é£çš„ç›¸å…³æ–‡ç« </a>, å¦å¤– Redux(Redux-Observable)å’Œ Mobx å®é™…ä¸Šä¹Ÿå¯ä»¥é…åˆ RxJS ä½¿ç”¨</p><p><br></p><hr><p><br></p><h2 id="å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ"><a href="#å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ"></a>å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ</h2><ul><li>Apollo+GraphQL</li><li><a href="https://github.com/FormidableLabs/freactal/" target="_blank" rel="noopener">freactal</a></li></ul><p>æ¨èè¿™ç¯‡æ–‡ç« <a href="https://blog.bitsrc.io/state-of-react-state-management-in-2019-779647206bbc" target="_blank" rel="noopener">State of React State Management for 2019</a></p><p><br></p><hr><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/26426054" target="_blank" rel="noopener">å•é¡µåº”ç”¨çš„æ•°æ®æµæ–¹æ¡ˆæ¢ç´¢</a></li><li><a href="https://zhuanlan.zhihu.com/p/24677176" target="_blank" rel="noopener">å¤æ‚å•é¡µåº”ç”¨çš„æ•°æ®å±‚è®¾è®¡</a></li><li><a href="https://blog.bitsrc.io/state-of-react-state-management-in-2019-779647206bbc" target="_blank" rel="noopener">State of React State Management for 2019</a></li><li><a href="https://zhuanlan.zhihu.com/p/32107541" target="_blank" rel="noopener">ä»æ—¶é—´æ—…è¡Œçš„ä¹Œæ‰˜é‚¦ï¼Œçœ‹çŠ¶æ€ç®¡ç†çš„è®¾è®¡è¯¯åŒº</a></li></ul></r>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©æ˜¯ 520ï¼Œè¿™æ˜¯æœ¬ç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦æ¶µç›– React çŠ¶æ€ç®¡ç†çš„ç›¸å…³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å‰å‡ ç¯‡æ–‡ç« åœ¨&lt;a href=&quot;https://juejin.im&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ˜é‡‘&lt;/a&gt;é¦–å‘åŸºæœ¬çŸ³æ²‰å¤§æµ·, æ²¡ä»€ä¹ˆé˜…è¯»é‡.
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</title>
    <link href="https://bobi.ink/2019/05/15/react-component-design-04/"/>
    <id>https://bobi.ink/2019/05/15/react-component-design-04/</id>
    <published>2019-05-14T16:00:00.000Z</published>
    <updated>2019-05-17T04:15:59.848Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ React çš„ä¸–ç•Œé‡Œâ€<strong>ä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶</strong>â€œï¼Œ ç»„ä»¶å¯ä»¥æ˜ å°„ä½œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å‡½æ•°ï¼ŒReact çš„ç»„ä»¶å’Œå‡½æ•°ä¸€æ ·çš„çµæ´»çš„ç‰¹æ€§ä¸ä»…ä»…å¯ä»¥ç”¨äºç»˜åˆ¶ UIï¼Œè¿˜å¯ä»¥ç”¨äºå°è£…ä¸šåŠ¡çŠ¶æ€å’Œé€»è¾‘ï¼Œæˆ–è€…éå±•ç¤ºç›¸å…³çš„å‰¯ä½œç”¨, å†é€šè¿‡ç»„åˆæ–¹å¼ç»„æˆå¤æ‚çš„åº”ç”¨. æœ¬æ–‡å°è¯•è§£é‡Šç”¨ React ç»„ä»¶çš„æ€ç»´æ¥å¤„ç†å¸¸è§çš„ä¸šåŠ¡å¼€å‘åœºæ™¯.</p><p><strong>ç³»åˆ—ç›®å½•</strong></p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li>05 çŠ¶æ€ç®¡ç† å¾…æ›´æ–°</li></ul><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#1-é«˜é˜¶ç»„ä»¶">1. é«˜é˜¶ç»„ä»¶</a></li><li><a href="#2-render-props">2. Render Props</a></li><li><a href="#3-ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘">3. ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘</a></li><li><a href="#4-hooks-å–ä»£é«˜é˜¶ç»„ä»¶">4. hooks å–ä»£é«˜é˜¶ç»„ä»¶</a></li><li><a href="#5-hooks-å®ç°å“åº”å¼ç¼–ç¨‹">5. hooks å®ç°<code>å“åº”å¼</code>ç¼–ç¨‹</a></li><li><a href="#6-ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„">6. ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„</a></li><li><a href="#7-æ¨¡æ€æ¡†ç®¡ç†">7. æ¨¡æ€æ¡†ç®¡ç†</a></li><li><a href="#8-ä½¿ç”¨-context-è¿›è¡Œä¾èµ–æ³¨å…¥">8. ä½¿ç”¨ Context è¿›è¡Œä¾èµ–æ³¨å…¥</a></li><li><a href="#9-ä¸å¯å˜çš„çŠ¶æ€">9. ä¸å¯å˜çš„çŠ¶æ€</a></li><li><a href="#10-react-router-url-å³çŠ¶æ€">10. React-router: URL å³çŠ¶æ€</a></li><li><a href="#11-ç»„ä»¶è§„èŒƒ">11. ç»„ä»¶è§„èŒƒ</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="1-é«˜é˜¶ç»„ä»¶"><a href="#1-é«˜é˜¶ç»„ä»¶" class="headerlink" title="1. é«˜é˜¶ç»„ä»¶"></a>1. é«˜é˜¶ç»„ä»¶</h2><p>åœ¨å¾ˆé•¿ä¸€æ®µæ—¶æœŸé‡Œï¼Œé«˜é˜¶ç»„ä»¶éƒ½æ˜¯å¢å¼ºå’Œç»„åˆ React ç»„ä»¶çš„æœ€æµè¡Œçš„æ–¹å¼. è¿™ä¸ªæ¦‚å¿µæºè‡ªäºå‡½æ•°å¼ç¼–ç¨‹çš„é«˜é˜¶å‡½æ•°. é«˜é˜¶ç»„ä»¶å¯ä»¥å®šä¹‰ä¸º: <strong>é«˜é˜¶ç»„ä»¶æ˜¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶åŸå§‹ç»„ä»¶å¹¶è¿”å›åŸå§‹ç»„ä»¶çš„å¢å¼º/å¡«å……ç‰ˆæœ¬</strong>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HOC = <span class="function"><span class="params">Component</span> =&gt;</span> EnhancedComponent;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦æ˜ç™½æˆ‘ä»¬<strong>ä¸ºä»€ä¹ˆéœ€è¦é«˜é˜¶ç»„ä»¶</strong>:</p><p>React çš„<a href="https://react.docschina.org/docs/higher-order-components.html" target="_blank" rel="noopener">æ–‡æ¡£</a>è¯´çš„éå¸¸æ¸…æ¥š, <strong>é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ç§ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘æ¨¡å¼</strong>. æœ€ä¸ºå¸¸è§çš„ä¾‹å­å°±æ˜¯ redux çš„<code>connect</code>å’Œ react-router çš„ <code>withRouter</code>. é«˜é˜¶ç»„ä»¶æœ€åˆç”¨äºå–ä»£ mixin(äº†è§£<a href="https://zhuanlan.zhihu.com/p/20361937" target="_blank" rel="noopener">React Mixin çš„å‰ä¸–ä»Šç”Ÿ</a>). æ€»ç»“æ¥è¯´å°±æ˜¯ä¸¤ç‚¹:</p><ul><li>é€»è¾‘å¤ç”¨. æŠŠä¸€äº›é€šç”¨çš„ä»£ç é€»è¾‘æå–å‡ºæ¥æ”¾åˆ°é«˜é˜¶ç»„ä»¶ä¸­, è®©æ›´å¤šç»„ä»¶å¯ä»¥å…±äº«</li><li>åˆ†ç¦»å…³æ³¨ç‚¹. åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­æåˆ°â€é€»è¾‘å’Œè§†å›¾åˆ†ç¦»â€çš„åŸåˆ™. é«˜é˜¶ç»„ä»¶å¯ä»¥ä½œä¸ºå®ç°è¯¥åŸåˆ™çš„è½½ä½“. æˆ‘ä»¬ä¸€èˆ¬å°†è¡Œä¸ºå±‚æˆ–è€…ä¸šåŠ¡å±‚æŠ½å–åˆ°é«˜é˜¶ç»„ä»¶ä¸­æ¥å®ç°, è®©å±•ç¤ºç»„ä»¶åªå…³æ³¨äº UI</li></ul><p>é«˜é˜¶ç»„ä»¶çš„ä¸€äº›<strong>å®ç°æ–¹æ³•</strong>ä¸»è¦æœ‰ä¸¤ç§:</p><ul><li><p><code>å±æ€§ä»£ç†(Props Proxy)</code>: ä»£ç†ä¼ é€’ç»™è¢«åŒ…è£…ç»„ä»¶çš„ props, å¯¹ props è¿›è¡Œæ“ä½œ. è¿™ç§æ–¹å¼ç”¨å¾—æœ€å¤š. ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥åšåˆ°:</p><ul><li>æ“ä½œ props</li><li>è®¿é—®è¢«åŒ…è£…ç»„ä»¶å®ä¾‹</li><li>æå– state</li><li>ç”¨å…¶ä»–å…ƒç´ åŒ…è£¹è¢«åŒ…è£…ç»„ä»¶</li></ul></li><li><p><code>åå‘ç»§æ‰¿(Inheritance Inversion)</code>: é«˜é˜¶ç»„ä»¶ç»§æ‰¿è¢«åŒ…è£…çš„ç»„ä»¶. ä¾‹å¦‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myhoc</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> Enhancer <span class="keyword">extends</span> WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.render();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å®ç°:</p><ul><li>æ¸²æŸ“åŠ«æŒ: å³æ§åˆ¶è¢«åŒ…è£…ç»„ä»¶çš„æ¸²æŸ“è¾“å‡º.</li><li>æ“ä½œ state: state ä¸€èˆ¬å±äºç»„ä»¶çš„å†…éƒ¨ç»†èŠ‚, é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å¯ä»¥æš´éœ²ç»™å­ç±». å¯ä»¥å¢åˆ æŸ¥æ”¹è¢«åŒ…è£…ç»„ä»¶çš„ state, é™¤éä½ çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ, ä¸€èˆ¬ä¸å»ºè®®è¿™ä¹ˆåš.</li></ul></li></ul><p>å®é™…ä¸Šé«˜é˜¶ç»„ä»¶èƒ½åšçš„ä¸æ­¢ä¸Šé¢åˆ—ä¸¾çš„, é«˜é˜¶ç»„ä»¶éå¸¸çµæ´», å…¨å‡­ä½ çš„æƒ³è±¡åŠ›. è¯»è€…å¯ä»¥äº†è§£ <a href="https://github.com/acdlite/recompose/blob/master/docs/API.md" target="_blank" rel="noopener">recompose</a>è¿™ä¸ªåº“, ç®€ç›´æŠŠé«˜é˜¶ç»„ä»¶ç©å‡ºèŠ±äº†.</p><p>æ€»ç»“ä¸€ä¸‹é«˜é˜¶ç»„ä»¶çš„<strong>åº”ç”¨åœºæ™¯</strong>:</p><ul><li>æ“ä½œ props: å¢åˆ æŸ¥æ”¹ props. ä¾‹å¦‚è½¬æ¢ props, æ‰©å±• props, å›ºå®š props, é‡å‘½å props</li><li>ä¾èµ–æ³¨å…¥. æ³¨å…¥ context æˆ–å¤–éƒ¨çŠ¶æ€å’Œé€»è¾‘, ä¾‹å¦‚ redux çš„ connnect, react-router çš„ withRouter. æ—§ context æ˜¯å®éªŒæ€§ API, æ‰€ä»¥å¾ˆå¤šåº“éƒ½ä¸ä¼šå°† context ä¿ç•™å‡ºæ¥, è€Œæ˜¯é€šè¿‡é«˜é˜¶ç»„ä»¶å½¢å¼è¿›è¡Œæ³¨å…¥</li><li>æ‰©å±• state: ä¾‹å¦‚ç»™å‡½æ•°å¼ç»„ä»¶æ³¨å…¥çŠ¶æ€</li><li>é¿å…é‡å¤æ¸²æŸ“: ä¾‹å¦‚ React.memo</li><li>åˆ†ç¦»é€»è¾‘, è®©ç»„ä»¶ä¿æŒ dumb</li></ul><blockquote><p>é«˜é˜¶ç»„ä»¶ç›¸å…³æ–‡æ¡£åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤š, æœ¬æ–‡ä¸æ‰“ç®—å±•å¼€æè¿°. æ·±å…¥äº†è§£<a href="https://zhuanlan.zhihu.com/p/24776678" target="_blank" rel="noopener">é«˜é˜¶ç»„ä»¶</a></p></blockquote><p>é«˜é˜¶ç»„ä»¶çš„ä¸€äº›<strong>è§„èŒƒ</strong>:</p><ul><li><p>åŒ…è£…æ˜¾ç¤ºåå­—ä»¥ä¾¿äºè°ƒè¯•</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withSubscription</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">class</span> WithSubscription <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">  WithSubscription.displayName = <span class="string">`WithSubscription(<span class="subst">$&#123;getDisplayName(WrappedComponent)&#125;</span>)`</span>;</span><br><span class="line">  <span class="keyword">return</span> WithSubscription;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDisplayName</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> WrappedComponent.displayName || WrappedComponent.name || <span class="string">'Component'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ React.forwardRef æ¥è½¬å‘ ref</p></li><li><p>ä½¿ç”¨â€™é«˜é˜¶å‡½æ•°â€™æ¥é…ç½®â€™é«˜é˜¶ç»„ä»¶â€™, è¿™æ ·å¯ä»¥è®©é«˜é˜¶ç»„ä»¶çš„ç»„åˆæ€§æœ€å¤§åŒ–. Redux çš„ connect å°±æ˜¯å…¸å‹çš„ä¾‹å­</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ConnectedComment = connect(</span><br><span class="line">  commentSelector,</span><br><span class="line">  commentActions,</span><br><span class="line">)(Comment);</span><br></pre></td></tr></table></figure><p>å½“ä½¿ç”¨ compose è¿›è¡Œç»„åˆæ—¶å°±èƒ½ä½“ä¼šåˆ°å®ƒçš„å¥½å¤„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ğŸ™… ä¸æ¨è</span></span><br><span class="line"><span class="keyword">const</span> EnhancedComponent = withRouter(connect(commentSelector)(WrappedComponent));</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä½¿ç”¨composeæ–¹æ³•è¿›è¡Œç»„åˆ</span></span><br><span class="line"><span class="comment">// compose(f, g, h) å’Œ (...args) =&gt; f(g(h(...args)))æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="keyword">const</span> enhance = compose(</span><br><span class="line">  <span class="comment">// è¿™äº›éƒ½æ˜¯å•ç‹¬ä¸€ä¸ªå‚æ•°çš„é«˜é˜¶ç»„ä»¶</span></span><br><span class="line">  withRouter,</span><br><span class="line">  connect(commentSelector),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> EnhancedComponent = enhance(WrappedComponent);</span><br></pre></td></tr></table></figure></li><li><p>è½¬å‘æ‰€æœ‰ä¸ç›¸å…³ props å±æ€§ç»™è¢«åŒ…è£…çš„ç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; extraProp, ...passThroughProps &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;WrappedComponent</span><br><span class="line">      injectedProp=&#123;injectedProp&#125;</span><br><span class="line">      &#123;...passThroughProps&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‘½å: ä¸€èˆ¬ä»¥ with*å‘½å, å¦‚æœæºå¸¦å‚æ•°, åˆ™ä»¥ create*å‘½å</p></li></ul><p><br></p><hr><p><br></p><h2 id="2-render-props"><a href="#2-render-props" class="headerlink" title="2. Render Props"></a>2. Render Props</h2><p>Render Props(Function as Child) ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ react æ¨¡å¼, æ¯”å¦‚å®˜æ–¹çš„ <a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener">Context API</a> å’Œ <a href="https://www.react-spring.io" target="_blank" rel="noopener">react-spring</a> åŠ¨ç”»åº“. ç›®çš„é«˜é˜¶ç»„ä»¶å·®ä¸å¤š: éƒ½æ˜¯ä¸ºäº†åˆ†ç¦»å…³æ³¨ç‚¹, å¯¹ç»„ä»¶çš„é€»è¾‘è¿›è¡Œå¤ç”¨; åœ¨ä½¿ç”¨å’Œå®ç°ä¸Šæ¯”é«˜é˜¶ç»„ä»¶è¦ç®€å•, åœ¨æŸäº›åœºæ™¯å¯ä»¥å–ä»£é«˜é˜¶ç»„ä»¶. å®˜æ–¹çš„å®šä¹‰æ˜¯:</p><blockquote><p><strong>æ˜¯æŒ‡ä¸€ç§åœ¨ React ç»„ä»¶ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„ prop åœ¨ React ç»„ä»¶é—´å…±äº«ä»£ç çš„ç®€å•æŠ€æœ¯</strong></p></blockquote><p>React å¹¶æ²¡æœ‰é™å®šä»»ä½• props çš„ç±»å‹, æ‰€ä»¥ props ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å½¢å¼. å½“ props ä¸ºå‡½æ•°æ—¶, çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°ç»™å­ç»„ä»¶ä¼ é€’ä¸€äº›æ•°æ®è¿›è¡ŒåŠ¨æ€æ¸²æŸ“. å…¸å‹ä»£ç ä¸º:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;FunctionAsChild&gt;&#123;<span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;Hello,World!&lt;<span class="regexp">/div&gt;&#125;&lt;/</span>FunctionAsChild&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;Spring <span class="keyword">from</span>=&#123;&#123; opacity: <span class="number">0</span> &#125;&#125; to=&#123;&#123; opacity: <span class="number">1</span> &#125;&#125;&gt;</span><br><span class="line">  &#123;<span class="function"><span class="params">props</span> =&gt;</span> &lt;div style=&#123;props&#125;&gt;hello&lt;<span class="regexp">/div&gt;&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Spring&gt;</span><br></pre></td></tr></table></figure><p>æŸç§ç¨‹åº¦ä¸Š, è¿™ç§æ¨¡å¼ç›¸æ¯”é«˜é˜¶ç»„ä»¶è¦ç®€å•å¾ˆå¤š, ä¸ç®¡æ˜¯å®ç°è¿˜æ˜¯ä½¿ç”¨å±‚æ¬¡. ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾:</p><ul><li>å¯è¯»æ€§å·®, å°¤å…¶æ˜¯å¤šå±‚åµŒå¥—æƒ…å†µä¸‹</li><li>ç»„åˆæ€§å·®. åªèƒ½é€šè¿‡ JSX ä¸€å±‚ä¸€å±‚åµŒå¥—, ä¸€èˆ¬ä¸å®œå¤šäºä¸€å±‚</li><li>é€‚ç”¨äºåŠ¨æ€æ¸²æŸ“. å› ä¸ºå±€é™åœ¨ JSX èŠ‚ç‚¹ä¸­, å½“å‰ç»„ä»¶æ˜¯å¾ˆéš¾è·å–åˆ° render props ä¼ é€’çš„æ•°æ®. å¦‚æœè¦ä¼ é€’ç»™å½“å‰ç»„ä»¶è¿˜æ˜¯å¾—é€šè¿‡ props, ä¹Ÿå°±æ˜¯é€šè¿‡é«˜é˜¶ç»„ä»¶ä¼ é€’è¿›æ¥</li></ul><p>å†å¼€ä¸€ä¸‹è„‘æ´. é€šè¿‡ä¸€ä¸ª Fetch ç»„ä»¶æ¥è¿›è¡Œæ¥å£è¯·æ±‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;Fetch method=<span class="string">"user.getById"</span> id=&#123;userId&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; data, error, retry, loading &#125;</span>) =&gt;</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &#123;loading ? (</span><br><span class="line">        &lt;Loader /&gt;</span><br><span class="line">      ) : error ? (</span><br><span class="line">        &lt;ErrorMessage error=&#123;error&#125; retry=&#123;retry&#125; /&gt;</span><br><span class="line">      ) : data ? (</span><br><span class="line">        &lt;Detail data=&#123;data&#125; /&gt;</span><br><span class="line">      ) : <span class="literal">null</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/Container&gt;</span></span><br><span class="line"><span class="regexp">  )&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Fetch&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ React Hooks å‡ºç°ä¹‹å‰, ä¸ºäº†ç»™å‡½æ•°ç»„ä»¶(æˆ–è€…è¯´ dumb component)æ·»åŠ çŠ¶æ€, é€šå¸¸ä¼šä½¿ç”¨è¿™ç§æ¨¡å¼. æ¯”å¦‚ <a href="https://github.com/renatorib/react-powerplug" target="_blank" rel="noopener">react-powerplug</a></p><blockquote><p>å®˜æ–¹<a href="https://react.docschina.org/docs/render-props.html" target="_blank" rel="noopener">æ–‡æ¡£</a></p></blockquote><p><br></p><hr><p><br></p><h2 id="3-ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘"><a href="#3-ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘" class="headerlink" title="3. ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘"></a>3. ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼æ¥æŠ½è±¡ä¸šåŠ¡é€»è¾‘</h2><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹, ç»„ä»¶è¡¨ç¤ºæ˜¯ä¸€ä¸ª UI å¯¹è±¡. å…¶å®ç»„ä»¶ä¸å•å•å¯ä»¥è¡¨ç¤º UI, ä¹Ÿå¯ä»¥ç”¨æ¥æŠ½è±¡ä¸šåŠ¡å¯¹è±¡, æœ‰æ—¶å€™æŠ½è±¡ä¸ºç»„ä»¶å¯ä»¥å·§å¦™åœ°è§£å†³ä¸€äº›é—®é¢˜.</p><p>ä¸¾ä¸€ä¸ªä¾‹å­: å½“ä¸€ä¸ªå®¡æ‰¹äººåœ¨å®¡æ‰¹ä¸€ä¸ªè¯·æ±‚æ—¶, è¯·æ±‚å‘èµ·è€…æ˜¯ä¸èƒ½é‡æ–°ç¼–è¾‘çš„; åä¹‹å‘èµ·è€…åœ¨ç¼–è¾‘æ—¶, å®¡æ‰¹äººä¸èƒ½è¿›è¡Œå®¡æ‰¹. è¿™æ˜¯ä¸€ä¸ªé”å®šæœºåˆ¶, åç«¯ä¸€èˆ¬ä½¿ç”¨ç±»ä¼¼å¿ƒè·³æœºåˆ¶æ¥ç»´æŠ¤è¿™ä¸ªâ€™é”â€™, è¿™ä¸ªé”å¯ä»¥æ˜¾å¼é‡Šæ”¾ï¼Œä¹Ÿå¯ä»¥åœ¨è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰æ¿€æ´»æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œæ¯”å¦‚é¡µé¢å…³é—­. æ‰€ä»¥å‰ç«¯é€šå¸¸ä¼šä½¿ç”¨è½®è¯¢æœºåˆ¶æ¥æ¿€æ´»é”.</p><p>ä¸€èˆ¬çš„å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> MyPage <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸€äº›æ¡ä»¶è§¦å‘, å¯èƒ½è¿˜è¦ç›‘å¬è¿™äº›æ¡ä»¶çš„å˜åŒ–ï¼Œç„¶ååœæ­¢åŠ é”è½®è¯¢. è¿™ä¸ªé€»è¾‘å®ç°èµ·æ¥æ¯”è¾ƒå•°å—¦</span></span><br><span class="line">    <span class="keyword">if</span> (someCondition) &#123;</span><br><span class="line">      <span class="keyword">this</span>.timer = setInterval(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// è½®è¯¢</span></span><br><span class="line">        tryLock();</span><br><span class="line">        <span class="comment">// é”™è¯¯å¤„ç†ï¼Œå¯ä»¥åŠ é”å¤±è´¥...</span></span><br><span class="line">      &#125;, <span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentWillUnmount() &#123;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.timer);</span><br><span class="line">    <span class="comment">// é¡µé¢å¸è½½æ—¶æ˜¾å¼é‡Šæ”¾</span></span><br><span class="line">    releaseLock();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidUpdate() &#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬æ¡ä»¶å˜åŒ–ï¼Œå¼€å§‹æˆ–åœæ­¢é”å®š</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšç€åŠŸèƒ½çš„è¿­ä»£, MyPage ä¼šå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿, è¿™æ—¶å€™ä½ å¼€å§‹è€ƒè™‘å°†è¿™äº›ä¸šåŠ¡é€»è¾‘æŠ½å–å‡ºå». ä¸€èˆ¬æƒ…å†µä¸‹é€šè¿‡é«˜é˜¶ç»„ä»¶æˆ–è€… hook æ¥å®ç°, ä½†éƒ½ä¸å¤Ÿçµæ´», æ¯”å¦‚<strong>æ¡ä»¶é”å®šè¿™ä¸ªåŠŸèƒ½å®ç°èµ·æ¥å°±æ¯”è¾ƒåˆ«æ‰­</strong>.</p><p>æœ‰æ—¶å€™è€ƒè™‘å°†ä¸šåŠ¡æŠ½è±¡æˆä¸ºç»„ä»¶, å¯èƒ½å¯ä»¥å·§å¦™åœ°è§£å†³æˆ‘ä»¬çš„é—®é¢˜, ä¾‹å¦‚ Locker:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * é”å®šå™¨</span><br><span class="line"> */</span><br><span class="line">const Locker: FC&lt;&#123; onError: err =&gt; boolean, id: string &#125;&gt; = props =&gt; &#123;</span><br><span class="line">  const &#123;id, onError&#125; = props</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let timer</span><br><span class="line">    const poll = () =&gt; &#123;</span><br><span class="line">      timer = setTimeout(async () =&gt; &#123;</span><br><span class="line">        // ...</span><br><span class="line">        // è½®è¯¢ï¼Œå¤„ç†å¼‚å¸¸ç­‰æƒ…å†µ</span><br><span class="line">      &#125;, 5000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    poll()</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      clearTimeout(timer)</span><br><span class="line">      releaseLock()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [id])</span><br><span class="line"></span><br><span class="line">  return null</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Locker</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;someCondition &amp;&amp; &lt;Locker id=&#123;<span class="keyword">this</span>.id&#125; onError=&#123;<span class="keyword">this</span>.handleError&#125;&gt;&lt;<span class="regexp">/Locker&gt;&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªè¦ç‚¹ï¼šæˆ‘ä»¬å°†ä¸€ä¸ªä¸šåŠ¡æŠ½è±¡ä¸ºäº†ä¸€ä¸ªç»„ä»¶åï¼Œä¸šåŠ¡é€»è¾‘æœ‰äº†å’Œç»„ä»¶ä¸€æ ·çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>ç°åœ¨ç»„ä»¶å†…éƒ¨åªéœ€å…³å¿ƒè‡ªèº«çš„é€»è¾‘ï¼Œæ¯”å¦‚åªå…³å¿ƒèµ„æºè¯·æ±‚å’Œé‡Šæ”¾(å³ How)ï¼Œè€Œä½•æ—¶è¿›è¡Œï¼Œä»€ä¹ˆæ¡ä»¶è¿›è¡Œ(å³ When)åˆ™ç”±çˆ¶çº§æ¥å†³å®š</strong>, è¿™æ ·å°±ç¬¦åˆäº†å•ä¸€èŒè´£åŸåˆ™ã€‚ ä¸Šé¢çš„ä¾‹å­çˆ¶çº§é€šè¿‡ JSX çš„æ¡ä»¶æ¸²æŸ“å°±å¯ä»¥åŠ¨æ€æ§åˆ¶é”å®š, æ¯”ä¹‹å‰çš„å®ç°ç®€å•äº†å¾ˆå¤š</p><p><br></p><hr><p><br></p><h2 id="4-hooks-å–ä»£é«˜é˜¶ç»„ä»¶"><a href="#4-hooks-å–ä»£é«˜é˜¶ç»„ä»¶" class="headerlink" title="4. hooks å–ä»£é«˜é˜¶ç»„ä»¶"></a>4. hooks å–ä»£é«˜é˜¶ç»„ä»¶</h2><p>ä¸ªäººè§‰å¾— hooks å¯¹äº React å¼€å‘æ¥è¯´æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ç‰¹æ€§, å®ƒæ”¹å˜äº†å¼€å‘çš„æ€ç»´å’Œæ¨¡å¼. é¦–å…ˆè¦é—®ä¸€ä¸‹, â€œå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜? å¸¦æ¥äº†ä»€ä¹ˆæ–°çš„ä¸œè¥¿?â€</p><p>hooks é¦–å…ˆæ˜¯è¦è§£å†³é«˜é˜¶ç»„ä»¶æˆ–è€… Render Props çš„ç—›ç‚¹çš„. å®˜æ–¹åœ¨â€™<strong>åŠ¨æœº</strong>â€˜ä¸Šå°±è¯´äº†:</p><ul><li><ol><li><strong>å¾ˆéš¾åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘</strong>:</li></ol><ul><li>é—®é¢˜: React æ¡†æ¶æœ¬èº«å¹¶æ²¡æœ‰æä¾›ä¸€ç§å°†å¯å¤ç”¨çš„é€»è¾‘æ³¨å…¥åˆ°ç»„ä»¶ä¸Šçš„æ–¹å¼/åŸè¯­. RenderProps å’Œé«˜é˜¶ç»„ä»¶åªæ˜¯â€™æ¨¡å¼å±‚é¢(æˆ–è€…è¯´è¯­è¨€å±‚é¢)â€™çš„ä¸œè¥¿:</li><li>æ­¤å‰çš„æ–¹æ¡ˆ: é«˜é˜¶ç»„ä»¶å’Œ Render Propsã€‚<strong>è¿™äº›æ–¹æ¡ˆéƒ½æ˜¯åŸºäºç»„ä»¶æœ¬èº«çš„æœºåˆ¶</strong><ul><li>é«˜é˜¶ç»„ä»¶å’Œ Render Props ä¼šé€ æˆå¤šä½™çš„èŠ‚ç‚¹åµŒå¥—. å³ Wrapper hell</li><li>éœ€è¦è°ƒæ•´ä½ çš„ç»„ä»¶ç»“æ„, ä¼šè®©ä»£ç å˜å¾—ç¬¨é‡, ä¸”éš¾ä»¥ç†è§£</li><li>é«˜é˜¶ç»„ä»¶å¤æ‚, éš¾ä»¥ç†è§£</li><li>æ­¤å‰é«˜é˜¶ç»„ä»¶ä¹Ÿè¦ ref è½¬å‘é—®é¢˜ç­‰ç­‰</li></ul></li><li><p>hooks å¦‚ä½•è§£å†³:</p><ul><li>å°†çŠ¶æ€é€»è¾‘ä»ç»„ä»¶ä¸­è„±ç¦», è®©ä»–å¯ä»¥è¢«å•ç‹¬çš„æµ‹è¯•å’Œå¤ç”¨.</li><li>hooks å¯ä»¥åœ¨ç»„ä»¶ä¹‹é—´å…±äº«, ä¸ä¼šå½±å“ç»„ä»¶çš„ç»“æ„</li></ul><p><br></p></li></ul></li><li><ol start="2"><li><strong>å¤æ‚çš„ç»„ä»¶éš¾ä»¥ç†è§£</strong>: å¤æ‚ç»„ä»¶çš„ç‰¹ç‚¹æ˜¯æœ‰ä¸€å¤§å †åˆ†æ•£çš„çŠ¶æ€é€»è¾‘å’Œå‰¯ä½œç”¨. ä¾‹å¦‚æ¯ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å¸¸å¸¸åŒ…å«ä¸€äº›äº’ä¸ç›¸å…³çš„é€»è¾‘, è¿™äº›äº’ä¸ç›¸å…³çš„é€»è¾‘ä¼šæ…¢æ…¢å˜æˆé¢æ¡å¼çš„ä»£ç , ä½†æ˜¯ä½ å‘ç°å¾ˆéš¾å†å¯¹å®ƒä»¬è¿›è¡Œæ‹†è§£, æ›´åˆ«è¯´æµ‹è¯•å®ƒä»¬</li></ol><ul><li>é—®é¢˜:<ul><li>å®é™…æƒ…å†µï¼Œæˆ‘ä»¬å¾ˆéš¾å°†è¿™äº›ç»„ä»¶åˆ†è§£æˆæ›´å°çš„ç»„ä»¶ï¼Œå› ä¸ºçŠ¶æ€åˆ°å¤„éƒ½æ˜¯ã€‚æµ‹è¯•å®ƒä»¬ä¹Ÿå¾ˆå›°éš¾ã€‚</li><li>ç»å¸¸å¯¼è‡´è¿‡åˆ†æŠ½è±¡, æ¯”å¦‚ redux, éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­è·³è½¬, éœ€è¦å¾ˆå¤šæ¨¡æ¿æ–‡ä»¶å’Œæ¨¡æ¿ä»£ç </li></ul></li><li>æ­¤å‰çš„è§£å†³æ–¹æ³•: é«˜é˜¶ç»„ä»¶å’Œ Render Props æˆ–è€…çŠ¶æ€ç®¡ç†å™¨. åˆ†å‰²æŠ½ç¦»é€»è¾‘å’Œ UI, åˆ‡å‰²æˆæ›´å°ç²’åº¦çš„ç»„ä»¶</li><li><p>hooks å¦‚ä½•è§£å†³: Hooks å…è®¸æ‚¨æ ¹æ®ç›¸å…³éƒ¨åˆ†(ä¾‹å¦‚è®¾ç½®è®¢é˜…æˆ–è·å–æ•°æ®)å°†ä¸€ä¸ªç»„ä»¶åˆ†å‰²æˆæ›´å°çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶åŸºäºç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¿›è¡Œåˆ†å‰²ã€‚ä½ è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ä¸ª reducer æ¥ç®¡ç†ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ï¼Œä»¥ä½¿å…¶æ›´åŠ å¯é¢„æµ‹</p><p><br></p></li></ul></li><li><ol start="3"><li>åŸºäº class çš„ç»„ä»¶å¯¹æœºå™¨å’Œç”¨æˆ·éƒ½ä¸å‹å¥½:</li></ol><ul><li>é—®é¢˜:<ul><li>å¯¹äºäºº: éœ€è¦ç†è§£ this, ä»£ç å†—é•¿</li><li>å¯¹äºæœºå™¨: ä¸å¥½ä¼˜åŒ–</li></ul></li><li>hooks å¦‚ä½•è§£å†³: å‡½æ•°å¼ç»„ä»¶</li><li>æ–°çš„é—®é¢˜: ä½ è¦äº†è§£é—­åŒ…</li></ul></li></ul><p><br></p><p>Hooks å¸¦æ¥çš„<strong>æ–°ä¸œè¥¿</strong>: <strong>hook æ—¨åœ¨è®©ç»„ä»¶çš„å†…éƒ¨é€»è¾‘ç»„ç»‡æˆå¯å¤ç”¨çš„æ›´å°å•å…ƒï¼Œè¿™äº›å•å…ƒå„è‡ªç»´æŠ¤ä¸€éƒ¨åˆ†ç»„ä»¶â€˜çŠ¶æ€å’Œé€»è¾‘â€™</strong>ã€‚</p><p><img alt="migrate to hooks" src="/images/04/hooks-transform.png" width="800"><br>å›¾ç‰‡æ¥æºäºtwitter(<a href="https://twitter.com/threepointone/status/1056594421079261185/photo/1?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1056594421079261185&amp;ref_url=https%3A%2F%2Fmedium.com%2Fmedia%2Fe55e7bcbf2d4912af7e539a2646388e2%3FpostId%3Dfdbde8803889" target="_blank" rel="noopener">@sunil Pai</a>)</p><ul><li><strong>ä¸€ç§æ–°çš„ç»„ä»¶ç¼–å†™æ–¹å¼</strong>. å’Œæ­¤å‰åŸºäº class æˆ–çº¯å‡½æ•°ç»„ä»¶çš„å¼€å‘æ–¹å¼ä¸å¤ªä¸€æ ·, hook æä¾›äº†æ›´ç®€æ´çš„ API å’Œä»£ç å¤ç”¨æœºåˆ¶, è¿™ä½¿å¾—ç»„ä»¶ä»£ç å˜å¾—æ›´ç®€çŸ­. ä¾‹å¦‚ ğŸ‘† ä¸Šå›¾å°±æ˜¯è¿ç§»åˆ° hooks çš„ä»£ç ç»“æ„å¯¹æ¯”, è¯»è€…ä¹Ÿå¯ä»¥çœ‹è¿™ä¸ªæ¼”è®²(<a href="https://www.youtube.com/watch?v=wXLf18DsV-I" target="_blank" rel="noopener">90% Cleaner React</a>).<br><br></li><li><strong>æ›´ç»†ç²’åº¦çš„çŠ¶æ€æ§åˆ¶(useState)</strong>. ä»¥å‰ä¸€ä¸ªç»„ä»¶åªæœ‰ä¸€ä¸ª setState é›†ä¸­å¼ç®¡ç†ç»„ä»¶çŠ¶æ€, <strong>ç°åœ¨ hooks åƒç»„ä»¶ä¸€æ ·, æ˜¯ä¸€ä¸ªé€»è¾‘å’ŒçŠ¶æ€çš„èšåˆå•å…ƒ. è¿™æ„å‘³ç€ä¸åŒçš„ hook å¯ä»¥ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€</strong>.<br><br></li><li><p><strong>ä¸ç®¡æ˜¯ hook è¿˜æ˜¯ç»„ä»¶ï¼Œéƒ½æ˜¯æ™®é€šå‡½æ•°</strong>.</p><ul><li><strong>ä»æŸç§ç¨‹åº¦ä¸Šçœ‹ç»„ä»¶å’Œ hooks æ˜¯åŒè´¨çš„(éƒ½åŒ…å«çŠ¶æ€å’Œé€»è¾‘)</strong>. ç»Ÿä¸€ä½¿ç”¨å‡½æ•°å½¢å¼å¼€å‘, è¿™ä½¿å¾—ä½ ä¸éœ€è¦åœ¨ç±»ã€é«˜é˜¶ç»„ä»¶æˆ–è€… renderProps ä¸Šä¸‹æ–‡ä¹‹é—´åˆ‡æ¢, é™ä½é¡¹ç›®çš„å¤æ‚åº¦. å¯¹äº React çš„æ–°æ‰‹æ¥è¯´ï¼Œå„ç§é«˜é˜¶ç»„ä»¶ã€render props å„ç§æ¦‚å¿µæ‹‰é«˜äº†å­¦ä¹ æ›²çº¿</li><li><strong>å‡½æ•°æ˜¯ä¸€ç§æœ€ç®€å•çš„ä»£ç å¤ç”¨å•å…ƒ, æœ€ç®€å•ä¹Ÿæ„å‘³ç€æ›´çµæ´»</strong>ã€‚ç›¸æ¯”ç»„ä»¶çš„ propsï¼Œå‡½æ•°çš„ä¼ å‚æ›´åŠ çµæ´»ï¼› å‡½æ•°ä¹Ÿæ›´å®¹æ˜“è¿›è¡Œç»„åˆ, hooks ç»„åˆå…¶ä»– hook æˆ–æ™®é€šå‡½æ•°æ¥å®ç°å¤æ‚é€»è¾‘.</li><li><strong>æœ¬è´¨ä¸Šè®²ï¼Œhooks å°±æ˜¯ç»™å‡½æ•°å¸¦æ¥äº†çŠ¶æ€çš„æ¦‚å¿µ</strong><br><br></li></ul></li><li><p><strong>é«˜é˜¶ç»„ä»¶ä¹‹é—´åªèƒ½ç®€å•åµŒå¥—å¤åˆ(compose), è€Œå¤šä¸ª hooks ä¹‹é—´æ˜¯å¹³é“ºçš„, å¯ä»¥å®šä¹‰æ›´å¤æ‚çš„å…³ç³»(ä¾èµ–)</strong>.<br><br></p></li><li><strong>æ›´å®¹æ˜“è¿›è¡Œé€»è¾‘å’Œè§†å›¾åˆ†ç¦»</strong>. hooks å¤©ç„¶éš”ç¦» JSX, è§†å›¾å’Œé€»è¾‘ä¹‹é—´çš„ç•Œé™æ¯”è¾ƒæ¸…æ™°, è¿™ä½¿å¾— hooks å¯ä»¥æ›´ä¸“æ³¨ç»„ä»¶çš„è¡Œä¸º.<br><br></li><li><strong>æ·¡åŒ–ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µ, å°†æœ¬æ¥åˆ†æ•£åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸçš„ç›¸å…³é€»è¾‘èšåˆèµ·æ¥</strong><br><br></li><li><strong>ä¸€ç‚¹ç‚¹â€™å“åº”å¼ç¼–ç¨‹â€™çš„å‘³é“</strong>, æ¯ä¸ª hooks éƒ½åŒ…å«ä¸€äº›çŠ¶æ€å’Œå‰¯ä½œç”¨ï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨ hooks ä¹‹é—´ä¼ é€’æµåŠ¨å’Œå“åº”ï¼Œ è§ä¸‹æ–‡<br><br></li><li><strong>è·¨å¹³å°çš„é€»è¾‘å¤ç”¨</strong>. è¿™æ˜¯æˆ‘è‡ªå·±å¼€çš„è„‘æ´, React hooks å‡ºæ¥ä¹‹å<a href="https://github.com/yyx990803" target="_blank" rel="noopener">å°¤é›¨æºª</a>å°±æ¨äº†ä¸€ä¸ª<a href="https://github.com/yyx990803/vue-hooks" target="_blank" rel="noopener">vue-hooks</a>è¯•éªŒé¡¹ç›®, å¦‚æœåé¢å‘å±•é¡ºåˆ©, hooks æ˜¯å¯èƒ½è¢«ç”¨äºè·¨æ¡†æ¶å¤ç”¨?</li></ul><p><br></p><p>ä¸€ä¸ª<strong>ç¤ºä¾‹</strong>: æ— é™åŠ è½½åˆ—è¡¨</p><iframe src="https://codesandbox.io/embed/rwq4opm70n?codemirror=1&fontsize=14&view=editor" title="useList" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><br></p><p>ä¸€èˆ¬ hooks çš„åŸºæœ¬ä»£ç ç»“æ„ä¸º:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useHook</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸states</span></span><br><span class="line">  <span class="keyword">const</span> [someState, setSomeState] = useState(initialValue);</span><br><span class="line">  <span class="comment">// âš›ï¸derived state</span></span><br><span class="line">  <span class="keyword">const</span> computedState = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> computed, [dependencies]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸refs</span></span><br><span class="line">  <span class="keyword">const</span> refSomething = useRef();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸side effect</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, []);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, [dependencies]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸state operations</span></span><br><span class="line">  <span class="keyword">const</span> handleChange = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setSomeState(newState)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸output</span></span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;&#123;...&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ hook å’Œå‡½æ•°ç»„ä»¶çš„ä»£ç ç»“æ„åŸºæœ¬ä¸€è‡´, æ‰€ä»¥æœ‰æ—¶å€™<strong>hooks å†™ç€å†™ç€åŸæ¥è¶Šåƒç»„ä»¶, ç»„ä»¶å†™ç€å†™ç€è¶Šåƒ hooks. æˆ‘è§‰å¾—å¯ä»¥è®¤ä¸ºç»„ä»¶å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ hook, åªä¸è¿‡å®ƒè¾“å‡º Virtual DOM</strong>.</p><p><br></p><p>ä¸€äº›<strong>æ³¨æ„äº‹é¡¹</strong>:</p><ul><li>åªèƒ½åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨ hooksã€‚ä¸è¦åœ¨å¾ªç¯ï¼Œæ§åˆ¶æµå’ŒåµŒå¥—çš„å‡½æ•°ä¸­è°ƒç”¨ hooks</li><li>åªèƒ½ä» React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ hooks</li><li>è‡ªå®šä¹‰ hooks ä½¿ç”¨ use*å‘½å</li></ul><p><br></p><p>æ€»ç»“ hooks çš„<strong>å¸¸ç”¨åœºæ™¯</strong>:</p><ul><li><strong>å‰¯ä½œç”¨å°è£…å’Œç›‘å¬</strong>: ä¾‹å¦‚ useWindowSize(ç›‘å¬çª—å£å¤§å°)ï¼ŒuseOnlineStatus(åœ¨çº¿çŠ¶æ€)</li><li><strong>å‰¯ä½œç”¨è¡ç”Ÿ</strong>: useEffect, useDebounce, useThrottle, useTitle, useSetTimeout</li><li><strong>DOM äº‹ä»¶å°è£…</strong>ï¼šuseActiveï¼ŒuseFocus, useDraggable, useTouch</li><li><strong>è·å– context</strong></li><li><strong>å°è£…å¯å¤ç”¨é€»è¾‘å’ŒçŠ¶æ€</strong>: useInput, usePromise(å¼‚æ­¥è¯·æ±‚), useList(åˆ—è¡¨åŠ è½½)<ul><li>å–ä»£é«˜é˜¶ç»„ä»¶å’Œ render Props. ä¾‹å¦‚ä½¿ç”¨ useRouter å–ä»£ withRouter, useSpring å–ä»£æ—§çš„ Spring Render Props ç»„ä»¶</li><li>å–ä»£å®¹å™¨ç»„ä»¶</li><li>çŠ¶æ€ç®¡ç†å™¨: use-global-hook, unstated</li></ul></li><li><strong>æ‰©å±•çŠ¶æ€æ“ä½œ</strong>: åŸå§‹çš„ useState å¾ˆç®€å•ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤§çš„æ‰©å±•ç©ºé—´ï¼Œä¾‹å¦‚ useSetState(æ¨¡æ‹Ÿæ—§çš„ setState), useToggle(boolean å€¼åˆ‡æ¢)ï¼ŒuseArray, useLocalStorage(åŒæ­¥æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨)</li><li>ç»§ç»­å¼€è„‘æ´â€¦: hooks çš„æ¢ç´¢è¿˜åœ¨<a href="https://usehooks.com/" target="_blank" rel="noopener">ç»§ç»­</a></li></ul><p>å­¦ä¹  hooks:</p><ul><li><a href="https://react.docschina.org/docs/hooks-overview.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://zhuanlan.zhihu.com/p/50597236" target="_blank" rel="noopener">ä¸€ç¯‡çœ‹æ‡‚ React Hooks</a></li><li><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM" target="_blank" rel="noopener">React Today and Tomorrow and 90% Cleaner React With Hooks</a></li><li><a href="https://www.hooks.guide/" target="_blank" rel="noopener">hook-guide</a></li><li><a href="https://zhuanlan.zhihu.com/p/50274018" target="_blank" rel="noopener">ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹</a></li><li><a href="https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889" target="_blank" rel="noopener">Making Sense of React Hooks</a></li><li><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a></li></ul><p><br></p><hr><p><br></p><h2 id="5-hooks-å®ç°å“åº”å¼ç¼–ç¨‹"><a href="#5-hooks-å®ç°å“åº”å¼ç¼–ç¨‹" class="headerlink" title="5. hooks å®ç°å“åº”å¼ç¼–ç¨‹"></a>5. hooks å®ç°<code>å“åº”å¼</code>ç¼–ç¨‹</h2><p><code>Vue</code>çš„éä¾µå…¥æ€§<a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener">å“åº”å¼ç³»ç»Ÿ</a>æ˜¯å…¶æœ€ç‹¬ç‰¹çš„ç‰¹æ€§ä¹‹ä¸€, å¯ä»¥æŒ‰ç…§ Javascript çš„æ•°æ®æ“ä½œä¹ æƒ¯æ¥æ“ä½œç»„ä»¶çŠ¶æ€ï¼Œ ç„¶åè‡ªåŠ¨å“åº”åˆ°é¡µé¢ä¸­. è€Œ React è¿™è¾¹åˆ™æä¾›äº† setState, å¯¹äºå¤æ‚çš„ç»„ä»¶çŠ¶æ€, setState ä¼šè®©ä»£ç å˜å¾—çš„åˆè‡­åˆé•¿. ä¾‹å¦‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">  pagination: &#123;</span><br><span class="line">    ...this.state.pagination,</span><br><span class="line">    current: defaultPagination.current || <span class="number">1</span>,</span><br><span class="line">    pageSize: defaultPagination.pageSize || <span class="number">15</span>,</span><br><span class="line">    total: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åæ¥æœ‰äº†<a href="https://cn.mobx.js.org" target="_blank" rel="noopener">mobx</a>, åŸºæœ¬æ¥è¿‘äº† Vue å¼€å‘ä½“éªŒ:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@observer</span></span><br><span class="line"><span class="keyword">class</span> TodoView <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@observable</span> loading: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@observable</span> error?: <span class="built_in">Error</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@observable</span> list: Item[] = [];</span><br><span class="line">  <span class="comment">// è¡ç”ŸçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@computed</span> <span class="keyword">get</span> completed() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.list.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.completed)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.load();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> render() &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> load() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.error = <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">this</span>.loading = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">await</span> fetchList()</span><br><span class="line">      <span class="keyword">this</span>.list = list</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">this</span>.error = err</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å® mobx ä¹Ÿæœ‰æŒºå¤šç¼ºç‚¹:</p><ul><li>ä»£ç ä¾µå…¥æ€§. æ‰€æœ‰éœ€è¦å“åº”æ•°æ®å˜åŠ¨çš„ç»„ä»¶éƒ½éœ€è¦ä½¿ç”¨ observer è£…é¥°, å±æ€§éœ€è¦ä½¿ç”¨ observable è£…é¥°, ä»¥åŠæ•°æ®æ“ä½œæ–¹å¼. å¯¹ mobx è€¦åˆè¾ƒæ·±, æ—¥ååˆ‡æ¢æ¡†æ¶æˆ–é‡æ„çš„æˆæœ¬å¾ˆé«˜</li><li><p>å…¼å®¹æ€§. mobx v5 åä½¿ç”¨ Proxy è¿›è¡Œé‡æ„, Proxy åœ¨ Chrome49 ä¹‹åæ‰æ”¯æŒ. å¦‚æœè¦å…¼å®¹æ—§ç‰ˆæµè§ˆå™¨åˆ™åªèƒ½ä½¿ç”¨ v4, v4 æœ‰ä¸€äº›<a href="https://cn.mobx.js.org/#mobx-4-vs-mobx-5" target="_blank" rel="noopener">å‘</a>, è¿™äº›å‘å¯¹äºä¸äº†è§£ mobx çš„æ–°æ‰‹å¾ˆéš¾å‘ç°:</p><ul><li>Observable æ•°ç»„å¹¶éçœŸæ­£çš„æ•°ç»„. æ¯”å¦‚ antd çš„ Table ç»„ä»¶å°±ä¸è®¤ mobx çš„æ•°ç»„, éœ€è¦ä¼ å…¥åˆ°ç»„ä»¶ä¹‹é—´ä½¿ç”¨ slice è¿›è¡Œè½¬æ¢</li><li>å‘ä¸€ä¸ªå·²å­˜åœ¨çš„ observable å¯¹è±¡ä¸­æ·»åŠ å±æ€§ä¸ä¼šè¢«è‡ªåŠ¨æ•è·</li></ul></li></ul><p><br></p><p>äºæ˜¯ hooks å‡ºç°äº†, å®ƒè®©ç»„ä»¶çš„çŠ¶æ€ç®¡ç†å˜å¾—æ›´ç®€å•ç›´æ¥, è€Œä¸”å®ƒçš„æ€æƒ³ä¹Ÿå¾ˆæ¥è¿‘ mobx å“åº”å¼ç¼–ç¨‹å“²å­¦:</p><p><img src="/images/04/mobx.png" alt="mobx"></p><p><br></p><ol><li>ç®€æ´åœ°å£°æ˜çŠ¶æ€</li></ol><p><strong>çŠ¶æ€</strong> æ˜¯é©±åŠ¨åº”ç”¨çš„æ•°æ®. ä¾‹å¦‚ UI çŠ¶æ€æˆ–è€…ä¸šåŠ¡é¢†åŸŸçŠ¶æ€</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;Item[]&gt;([]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>è¡ç”Ÿ</li></ol><p>ä»»ä½• æºè‡ªçŠ¶æ€å¹¶ä¸”ä¸ä¼šå†æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„ç›¸äº’ä½œç”¨çš„ä¸œè¥¿å°±æ˜¯è¡ç”Ÿã€‚åŒ…æ‹¬ç”¨æˆ·è§†å›¾, è¡ç”ŸçŠ¶æ€, å…¶ä»–å‰¯ä½œç”¨</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props: &#123; id: <span class="built_in">string</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = props;</span><br><span class="line">  <span class="comment">// å–ä»£mobxçš„observable: è·å–åˆ—è¡¨, åœ¨æŒ‚è½½æˆ–idå˜åŠ¨æ—¶è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue, loading, error, retry] = usePromise(</span><br><span class="line">    <span class="keyword">async</span> id =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> getList(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [id],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ç”ŸçŠ¶æ€: å–ä»£mobxçš„computed</span></span><br><span class="line">  <span class="keyword">const</span> unreads = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> value.filter(<span class="function"><span class="params">i</span> =&gt;</span> !i.readed), [value]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ç”Ÿå‰¯ä½œç”¨: valueå˜åŠ¨åè‡ªåŠ¨æŒä¹…åŒ–</span></span><br><span class="line">  useDebounce(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      saveList(id, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">1000</span>,</span><br><span class="line">    [value],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ç”Ÿè§†å›¾</span></span><br><span class="line">  <span class="keyword">return</span> &lt;List data=&#123;value&#125; onChange=&#123;setValue&#125; error=&#123;error&#125; loading=&#123;loading&#125; retry=&#123;retry&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/04/hook-stream.png" width="400"></p><p>æ‰€ä»¥è¯´ hook æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ä¸œè¥¿, å®ƒå¯ä»¥è®©ç»„ä»¶çš„çŠ¶æ€æ•°æ®æµæ›´åŠ æ¸…æ™°. æ¢åš class ç»„ä»¶, æˆ‘ä»¬é€šå¸¸çš„åšæ³•å¯èƒ½æ˜¯åœ¨ <code>componentDidUpdate</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è¿›è¡Œæ•°æ®æ¯”è¾ƒ, ç„¶åå‘½ä»¤å¼åœ°è§¦å‘ä¸€äº›æ–¹æ³•. æ¯”å¦‚ id å˜åŒ–æ—¶è§¦å‘ getList, list å˜åŒ–æ—¶è¿›è¡Œ saveList.</p><p><strong>hook ä¼¼ä¹åœ¨æ·¡åŒ–ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µ, è®©å¼€å‘è€…æ›´ä¸“æ³¨äºçŠ¶æ€çš„å…³ç³», ä»¥æ•°æ®æµçš„æ–¹å¼æ¥æ€è€ƒç»„ä»¶çš„å¼€å‘</strong>. <a href="https://mobile.twitter.com/dan_abramov" target="_blank" rel="noopener">Dan Abramov</a>åœ¨<a href="https://overreacted.io/zh-hans/writing-resilient-components/" target="_blank" rel="noopener">ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</a>ä¹Ÿæåˆ°äº†ä¸€ä¸ªåŸåˆ™â€ä¸è¦é˜»æ–­æ•°æ®æµâ€, è¯å®äº†ç¬”è€…çš„æƒ³æ³•:</p><blockquote><p>æ— è®ºä½•æ—¶ä½¿ç”¨ props å’Œ stateï¼Œè¯·è€ƒè™‘å¦‚æœå®ƒä»¬å‘ç”Ÿå˜åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸åº”ä»¥ä¸åŒæ–¹å¼å¤„ç†åˆå§‹æ¸²æŸ“å’Œæ›´æ–°æµç¨‹ã€‚è¿™ä½¿å®ƒèƒ½å¤Ÿé€‚åº”é€»è¾‘ä¸Šçš„å˜åŒ–ã€‚</p></blockquote><p>è¯»è€…å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://github.com/rehooks/awesome-react-hooks" target="_blank" rel="noopener">awesome-react-hooks</a>, è¿™äº›å¼€æºçš„ hook æ–¹æ¡ˆéƒ½æŒºæœ‰æ„æ€. ä¾‹å¦‚<a href="https://github.com/LeetCode-OpenSource/rxjs-hooks" target="_blank" rel="noopener">rxjs-hooks</a>, å·§å¦™åœ°å°† react hooks å’Œ rxjs ç»“åˆçš„èµ·æ¥:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">props: &#123; foo: <span class="built_in">number</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å“åº”propsçš„å˜åŠ¨</span></span><br><span class="line">  <span class="keyword">const</span> value = useObservable(inputs$ =&gt; inputs$.pipe(map(<span class="function">(<span class="params">[val]</span>) =&gt;</span> val + <span class="number">1</span>)), <span class="number">200</span>, [props.foo]);</span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;&#123;value&#125;&lt;<span class="regexp">/h1&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h2 id="6-ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„"><a href="#6-ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„" class="headerlink" title="6. ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„"></a>6. ç±»ç»§æ‰¿ä¹Ÿæœ‰ç”¨å¤„</h2><p>å°±å¦‚ react å®˜æ–¹æ–‡æ¡£è¯´çš„: â€œæˆ‘ä»¬çš„ React ä½¿ç”¨äº†æ•°ä»¥åƒè®¡çš„ç»„ä»¶ï¼Œç„¶è€Œå´è¿˜æœªå‘ç°ä»»ä½•éœ€è¦æ¨èä½ ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µã€‚â€, React åå‘äºå‡½æ•°å¼ç¼–ç¨‹çš„ç»„åˆæ¨¡å¼, é¢å‘å¯¹è±¡çš„ç»§æ‰¿å®é™…çš„åº”ç”¨åœºæ™¯å¾ˆå°‘.</p><p>å½“æˆ‘ä»¬éœ€è¦å°†ä¸€äº›ä¼ ç»Ÿçš„ç¬¬ä¸‰æ–¹åº“è½¬æ¢æˆ React ç»„ä»¶åº“æ—¶, ç»§æ‰¿å°±å¯èƒ½æ´¾ä¸Šç”¨åœº. å› ä¸ºè¿™äº›åº“å¤§éƒ¨åˆ†æ˜¯ä½¿ç”¨é¢å‘å¯¹è±¡çš„èŒƒå¼æ¥ç»„ç»‡çš„, æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯åœ°å›¾ SDK. ä»¥<a href="http://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference_3_0.html" target="_blank" rel="noopener">ç™¾åº¦åœ°å›¾</a>ä¸ºä¾‹:</p><p><img src="/images/04/overlay.png" alt="baidu overlay"></p><p>ç™¾åº¦åœ°å›¾æœ‰å„ç§ç»„ä»¶ç±»å‹: controls, overlays, tileLayers. è¿™äº›ç±»å‹éƒ½æœ‰å¤šä¸ªå­ç±», å¦‚ä¸Šå›¾, overlay æœ‰ Label, Marker, Polyline ç­‰è¿™äº›å­ç±», ä¸”è¿™äº›å­ç±»æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ, éƒ½æ˜¯é€šè¿‡ addOverlay æ–¹æ³•æ¥æ¸²æŸ“åˆ°åœ°å›¾ç”»å¸ƒä¸Š. æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å°†ä»–ä»¬ç”Ÿå‘½å‘¨æœŸç®¡ç†æŠ½å–åˆ°çˆ¶ç±»ä¸Š, ä¾‹å¦‚:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// OverlayæŠ½è±¡ç±», è´Ÿè´£ç®¡ç†Overlayçš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">abstract</span> <span class="keyword">class</span> Overlay&lt;P&gt; <span class="keyword">extends</span> React.PureComponent&lt;OverlayProps &amp; P&gt; &#123;</span><br><span class="line">  <span class="keyword">protected</span> initialize?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// å­ç±»åœ¨constructoræˆ–initializeæ–¹æ³•ä¸­è¿›è¡Œå®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.initialize) &#123;</span><br><span class="line">      <span class="keyword">this</span>.initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.instance &amp;&amp; <span class="keyword">this</span>.context) &#123;</span><br><span class="line">      <span class="comment">// æ¸²æŸ“åˆ°Mapç”»å¸ƒä¸­</span></span><br><span class="line">      <span class="keyword">this</span>.context.nativeInstance!.addOverlay(<span class="keyword">this</span>.instance);</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–å‚æ•°</span></span><br><span class="line">      <span class="keyword">this</span>.initialProperties();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidUpdate(prevProps: P &amp; OverlayProps) &#123;</span><br><span class="line">    <span class="comment">// å±æ€§æ›´æ–°</span></span><br><span class="line">    <span class="keyword">this</span>.updateProperties(prevProps);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentWillUnmount() &#123;</span><br><span class="line">    <span class="comment">// ç»„ä»¶å¸è½½</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.instance &amp;&amp; <span class="keyword">this</span>.context) &#123;</span><br><span class="line">      <span class="keyword">this</span>.context.nativeInstance!.removeOverlay(<span class="keyword">this</span>.instance);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// å…¶ä»–é€šç”¨æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">private</span> forceReloadIfNeed(props: P, prevProps: P) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­ç±»çš„å·¥ä½œå°±å˜å¾—ç®€å•å¾ˆå¤š, å£°æ˜è‡ªå·±çš„å±æ€§/äº‹ä»¶å’Œå®ä¾‹åŒ–å…·ä½“ç±»:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Label <span class="keyword">extends</span> Overlay&lt;LabelProps&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    enableMassClear: <span class="literal">true</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">props: LabelProps</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">const</span> &#123; position, content &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="comment">// å£°æ˜æ”¯æŒçš„å±æ€§å’Œå›è°ƒ</span></span><br><span class="line">    <span class="keyword">this</span>.extendedProperties = PROPERTIES;</span><br><span class="line">    <span class="keyword">this</span>.extendedEnableableProperties = ENABLEABLE_PROPERTIES;</span><br><span class="line">    <span class="keyword">this</span>.extendedEvents = EVENTS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–å…·ä½“ç±»</span></span><br><span class="line">    <span class="keyword">this</span>.instance = <span class="keyword">new</span> BMap.Label(content, &#123;</span><br><span class="line">      position,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»£ç æ¥æºäº <a href="https://github.com/ivan-94/react-bdmap" target="_blank" rel="noopener">react-bdmap</a></p></blockquote><p>å½“ç„¶è¿™ä¸ªä¸æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ³•, ä½¿ç”¨é«˜é˜¶ç»„ä»¶å’Œ hooks åŒæ ·èƒ½å¤Ÿå®ç°. åªä¸è¿‡å¯¹äºåŸæœ¬å°±é‡‡ç”¨é¢å‘å¯¹è±¡èŒƒå¼ç»„ç»‡çš„åº“, ä½¿ç”¨ç»§æ‰¿æ–¹å¼ä¼šæ›´åŠ å¥½ç†è§£</p><p><br></p><hr><p><br></p><h2 id="7-æ¨¡æ€æ¡†ç®¡ç†"><a href="#7-æ¨¡æ€æ¡†ç®¡ç†" class="headerlink" title="7. æ¨¡æ€æ¡†ç®¡ç†"></a>7. æ¨¡æ€æ¡†ç®¡ç†</h2><p><img src="/images/04/modal-demo.png" alt="modal demo"></p><p>æ¨¡æ€æ¡†æ˜¯åº”ç”¨å¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ç»„ä»¶ï¼Œå°¤å…¶åœ¨ä¸­åå°ç®¡ç†ç³»ç»Ÿä¸­. ä½†æ˜¯åœ¨ React ä¸­ç”¨ç€å¹¶ä¸æ˜¯ç‰¹åˆ«çˆ½, å…¸å‹çš„ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Demo: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  const [visible, setVisible] = useState(false);</span><br><span class="line">  const [editing, setEditing] = useState();</span><br><span class="line">  const handleCancel = () =&gt; &#123;</span><br><span class="line">    setVisible(false);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const prepareEdit = async (item: Item) =&gt; &#123;</span><br><span class="line">    // åŠ è½½è¯¦æƒ…</span><br><span class="line">    const detail = await loadingDeatil(item.id);</span><br><span class="line">    setEditing(detail);</span><br><span class="line">    setVisible(true);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleOk = async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const values = await form.validate();</span><br><span class="line">      // ä¿å­˜</span><br><span class="line">      await save(editing.id, values);</span><br><span class="line">      // éšè—</span><br><span class="line">      setVisible(false);</span><br><span class="line">    &#125; catch &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return;</span><br><span class="line">  &lt;&gt;</span><br><span class="line">    &lt;Table</span><br><span class="line">      dataSource=&#123;list&#125;</span><br><span class="line">      columns=&#123;[</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æ“ä½œ&apos;,</span><br><span class="line">          render: item =&gt; &#123;</span><br><span class="line">            return &lt;a onClick=&#123;() =&gt; prepareEdit(item)&#125;&gt;ç¼–è¾‘&lt;/a&gt;;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ]&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;Modal visible=&#123;visible&#125; onOk=&#123;handleOk&#125; onCancel=&#123;handleHide&#125;&gt;</span><br><span class="line">      &#123;/* è¡¨å•æ¸²æŸ“ */&#125;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  &lt;/&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å¤ªä¸‘äº†ï¼Œ ä¸ç›¸å…³é€»è¾‘å †ç§¯åœ¨ä¸€ä¸ªç»„ä»¶ä¸‹ ï¼Œä¸ç¬¦åˆå•ä¸€èŒè´£. æ‰€ä»¥æˆ‘ä»¬è¦å°†æ¨¡æ€æ¡†ç›¸å…³ä»£ç æŠ½å–å‡ºå», æ”¾åˆ° EditModal ä¸­:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const EditModal: FC&lt;&#123; id?: string; visible: boolean; onCancel: () =&gt; void; onOk: () =&gt; void &#125;&gt; = props =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  const &#123; visible, id, onHide, onOk &#125; = props;</span><br><span class="line">  const detail = usePromise(async (id: string) =&gt; &#123;</span><br><span class="line">    return loadDetail(id);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (id != null) &#123;</span><br><span class="line">      detail.call(id);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [id]);</span><br><span class="line"></span><br><span class="line">  const handleOk = () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const values = await form.validate();</span><br><span class="line">      // ä¿å­˜</span><br><span class="line">      await save(editing.id, values);</span><br><span class="line">      onOk();</span><br><span class="line">    &#125; catch &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Modal visible=&#123;visible&#125; onOk=&#123;onOk&#125; onCancel=&#123;onCancel&#125;&gt;</span><br><span class="line">      &#123;detail.value &amp;&amp;</span><br><span class="line">        &#123;</span><br><span class="line">          /* è¡¨å•æ¸²æŸ“ */</span><br><span class="line">        &#125;&#125;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä½¿ç”¨</span><br><span class="line"> */</span><br><span class="line">const Demo: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  const [visible, setVisible] = useState(false);</span><br><span class="line">  const [editing, setEditing] = useState&lt;string | undefined&gt;(undefined);</span><br><span class="line">  const handleHide = () =&gt; &#123;</span><br><span class="line">    setVisible(false);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const prepareEdit = async (item: Item) =&gt; &#123;</span><br><span class="line">    setEditing(item.id);</span><br><span class="line">    setVisible(true);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return;</span><br><span class="line">  &lt;&gt;</span><br><span class="line">    &lt;Table</span><br><span class="line">      dataSource=&#123;list&#125;</span><br><span class="line">      columns=&#123;[</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æ“ä½œ&apos;,</span><br><span class="line">          render: item =&gt; &#123;</span><br><span class="line">            return &lt;a onClick=&#123;() =&gt; prepareEdit(item)&#125;&gt;ç¼–è¾‘&lt;/a&gt;;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ]&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;EditModal id=&#123;editing&#125; visible=&#123;visible&#125; onOk=&#123;handleHide&#125; onCancel=&#123;handleHide&#125;&gt;</span><br><span class="line">      &#123;&apos; &apos;&#125;</span><br><span class="line">    &lt;/EditModal&gt;</span><br><span class="line">  &lt;/&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç¼–è¾‘ç›¸å…³çš„é€»è¾‘æŠ½å–åˆ°äº† EditModal ä¸Šï¼Œä½†æ˜¯ Demo ç»„ä»¶è¿˜è¦ç»´æŠ¤æ¨¡æ€æ¡†çš„æ‰“å¼€çŠ¶æ€å’Œä¸€äº›æ•°æ®çŠ¶æ€ã€‚ä¸€ä¸ªå¤æ‚çš„é¡µé¢å¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¨¡æ€æ¡†ï¼Œè¿™æ ·çš„ä»£ç ä¼šå˜å¾—è¶Šæ¥è¶Šæ¶å¿ƒï¼Œ å„ç§ xxxVisible çŠ¶æ€æ»¡å¤©é£. ä»å®é™…å¼€å‘è§’åº¦ä¸Šå°†ï¼Œæ¨¡æ€æ¡†æ§åˆ¶çš„æœ€ç®€å•çš„æ–¹å¼åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const handleEdit = item =&gt; &#123;</span><br><span class="line">  EditModal.show(&#123;</span><br><span class="line">    // ğŸ”´ é€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼å‡ºå‘å¼¹çª—. è¿™ç¬¦åˆå¯¹æ¨¡æ€æ¡†çš„ä¹ æƒ¯ç”¨æ³•, ä¸å…³å¿ƒæ¨¡æ€æ¡†çš„å¯è§çŠ¶æ€. ä¾‹å¦‚window.confirm, wx.showModal().</span><br><span class="line">    id: item.id, // ğŸ”´ ä¼ é€’æ•°æ®ç»™æ¨¡æ€æ¡†</span><br><span class="line">    onOk: saved =&gt; &#123;</span><br><span class="line">      // ğŸ”´ äº‹ä»¶å›è°ƒ</span><br><span class="line">      refreshList(saved);</span><br><span class="line">    &#125;,</span><br><span class="line">    onCancel: async () =&gt; &#123;</span><br><span class="line">      return confirm(&apos;ç¡®è®¤å–æ¶ˆ&apos;); // æ§åˆ¶æ¨¡æ€æ¡†æ˜¯å¦éšè—</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼åœ¨ç¤¾åŒºä¸Šä¹Ÿæ˜¯æœ‰äº‰è®®çš„ï¼Œæœ‰äº›äººè®¤ä¸ºè¿™æ˜¯ React çš„åæ¨¡å¼ï¼Œ<a href="https://www.zhihu.com/people/yu-san-geng" target="_blank" rel="noopener">@æ¬²ä¸‰æ›´</a>åœ¨<a href="https://zhuanlan.zhihu.com/p/54492049" target="_blank" rel="noopener">Modal.confirm è¿åäº† React çš„æ¨¡å¼å—ï¼Ÿ</a>å°±æ¢è®¨äº†è¿™ä¸ªé—®é¢˜ã€‚ ä»¥å›¾ä¸ºä¾‹ï¼š</p><p><img src="/images/04/modal-confirm.jpg" alt="modal confirm"></p><p>çº¢çº¿è¡¨ç¤ºæ—¶é—´é©±åŠ¨(æˆ–è€…è¯´æ—¶æœºé©±åŠ¨), è“çº¿è¡¨ç¤ºæ•°æ®é©±åŠ¨ã€‚æ¬²ä¸‰æ›´è®¤ä¸ºâ€œå“ªæ€•ä¸€ä¸ªå¸¦æœ‰æ˜æ˜¾æ•°æ®é©±åŠ¨ç‰¹è‰²çš„ React é¡¹ç›®ï¼Œä¹Ÿå­˜åœ¨å¾ˆå¤šéƒ¨åˆ†ä¸æ˜¯æ•°æ®é©±åŠ¨è€Œæ˜¯äº‹ä»¶é©±åŠ¨çš„. æ•°æ®åªèƒ½é©±åŠ¨å‡ºçŠ¶æ€ï¼Œåªæœ‰æ—¶æœºæ‰èƒ½é©±åŠ¨å‡ºè¡Œä¸º, å¯¹äºä¸€ä¸ªæ—¶æœºé©±åŠ¨çš„è¡Œä¸ºï¼Œä½ éå¾—æŠŠå®ƒç¡¬å³æˆä¸€ä¸ªæ•°æ®é©±åŠ¨çš„çŠ¶æ€ï¼Œä½ ä¸è§‰å¾—å¾ˆå¥‡æ€ªå—?â€. ä»–çš„è§‚ç‚¹æ­£ä¸æ­£ç¡®ç¬”è€…ä¸åšè¯„åˆ¤, ä½†æ˜¯æŸäº›åœºæ™¯ä¸¥æ ¼è¦æ±‚â€˜æ•°æ®é©±åŠ¨â€™ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¨¡æ¿ä»£ç ï¼Œå†™ç€ä¼šå¾ˆéš¾å—.</p><p>So æ€ä¹ˆå®ç°?</p><p>å¯ä»¥å‚è€ƒ antd <a href="https://github.com/ant-design/ant-design/blob/master/components/modal/confirm.tsx" target="_blank" rel="noopener">Modal.confirm</a>çš„å®ç°, å®ƒä½¿ç”¨<code>ReactDOM.render</code>æ¥è¿›è¡Œå¤–æŒ‚æ¸²æŸ“ï¼Œä¹Ÿæœ‰äººä½¿ç”¨<a href="https://medium.com/@BogdanSoare/how-to-use-reacts-new-context-api-to-easily-manage-modals-2ae45c7def81" target="_blank" rel="noopener">Context API</a>æ¥å®ç°çš„. ç¬”è€…è®¤ä¸ºæ¯”è¾ƒæ¥è¿‘ç†æƒ³çš„(è‡³å°‘ API ä¸Šçœ‹)æ˜¯<a href="https://github.com/haradakunihiko/react-confirm" target="_blank" rel="noopener">react-comfirm</a>è¿™æ ·çš„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * EditModal.tsx</span><br><span class="line"> */</span><br><span class="line">import &#123; confirmable &#125; from &apos;react-confirm&apos;;</span><br><span class="line">const EditModal = props =&gt; &#123;</span><br><span class="line">  /*...*/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default confirmable(EditModal);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  Demo.tsx</span><br><span class="line"> */</span><br><span class="line">import EditModal from &apos;./EditModal&apos;;</span><br><span class="line"></span><br><span class="line">const showEditModal = createConfirmation(EditModal);</span><br><span class="line"></span><br><span class="line">const Demo: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  const prepareEdit = async (item: Item) =&gt; &#123;</span><br><span class="line">    showEditModal(&#123;</span><br><span class="line">      id: item.id, // ğŸ”´ ä¼ é€’æ•°æ®ç»™æ¨¡æ€æ¡†</span><br><span class="line">      onOk: saved =&gt; &#123;</span><br><span class="line">        // ğŸ”´ äº‹ä»¶å›è°ƒ</span><br><span class="line">        refreshList(saved);</span><br><span class="line">      &#125;,</span><br><span class="line">      onCancel: async someValues =&gt; &#123;</span><br><span class="line">        return confirm(&apos;ç¡®è®¤å–æ¶ˆ&apos;); // æ§åˆ¶æ¨¡æ€æ¡†æ˜¯å¦éšè—</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ReactDOM.render</code>å¤–æŒ‚æ¸²æŸ“å½¢å¼çš„ç¼ºç‚¹å°±æ˜¯æ— æ³•è®¿é—® Contextï¼Œæ‰€ä»¥è¿˜æ˜¯è¦å¦¥åä¸€ä¸‹ï¼Œç»“åˆ Context API æ¥å®ç°ç¤ºä¾‹ï¼š</p><iframe src="https://codesandbox.io/embed/lryom9617l?autoresize=1&fontsize=14" title="useModal" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>æ‰©å±•</p><ul><li><a href="https://github.com/ant-design/ant-design/blob/master/components/modal/confirm.tsx" target="_blank" rel="noopener">Modal.confirm</a></li><li><a href="https://zhuanlan.zhihu.com/p/54492049" target="_blank" rel="noopener">Modal.confirm è¿åäº† React çš„æ¨¡å¼å—ï¼Ÿ</a></li><li><a href="https://www.zhihu.com/search?type=content&amp;q=react%20modal" target="_blank" rel="noopener">ä½¿ç”¨ render props æŠ½è±¡ Modal ç»„ä»¶çš„çŠ¶æ€</a></li><li><a href="https://github.com/haradakunihiko/react-confirm" target="_blank" rel="noopener">react-confirm</a></li><li><a href="https://medium.com/@BogdanSoare/how-to-use-reacts-new-context-api-to-easily-manage-modals-2ae45c7def81" target="_blank" rel="noopener">How to use Reactâ€™s new Context API to easily manage modals</a> åŸºäº Context çš„æ–¹æ¡ˆ</li></ul><p><br></p><hr><p><br></p><h2 id="8-ä½¿ç”¨-context-è¿›è¡Œä¾èµ–æ³¨å…¥"><a href="#8-ä½¿ç”¨-context-è¿›è¡Œä¾èµ–æ³¨å…¥" class="headerlink" title="8. ä½¿ç”¨ Context è¿›è¡Œä¾èµ–æ³¨å…¥"></a>8. ä½¿ç”¨ Context è¿›è¡Œä¾èµ–æ³¨å…¥</h2><p>Context ä¸ºç»„ä»¶æ ‘æä¾›äº†ä¸€ä¸ªä¼ é€’æ•°æ®çš„æ–¹æ³•ï¼Œä»è€Œé¿å…äº†åœ¨æ¯ä¸€ä¸ªå±‚çº§æ‰‹åŠ¨çš„ä¼ é€’ props å±æ€§.</p><p>Context åœ¨ React åº”ç”¨ä¸­ä½¿ç”¨éå¸¸é¢‘ç¹, æ–°çš„<a href="https://react.docschina.org/docs/context.html#when-to-use-context" target="_blank" rel="noopener">Context API</a>ä¹Ÿéå¸¸æ˜“ç”¨. Context å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯:</p><ul><li><strong>å…±äº«é‚£äº›è¢«è®¤ä¸ºå¯¹äºä¸€ä¸ªâ€™ç»„ä»¶æ ‘â€™è€Œè¨€æ˜¯â€œå…¨å±€â€çš„æ•°æ®</strong>. å¦‚å½“å‰è®¤è¯çš„ç”¨æˆ·, ä¸»é¢˜, i18n é…ç½®, è¡¨å•çŠ¶æ€</li><li><strong>ç»„ä»¶é…ç½®</strong>. é…ç½®ç»„ä»¶çš„è¡Œä¸º, å¦‚ antd çš„ ConfigProvider</li><li><strong>è·¨ç»„ä»¶é€šä¿¡</strong>. ä¸æ¨èé€šè¿‡â€™äº‹ä»¶â€™è¿›è¡Œé€šä¿¡, è€Œæ˜¯é€šè¿‡â€™çŠ¶æ€â€™è¿›è¡Œé€šä¿¡</li><li><strong>ä¾èµ–æ³¨å…¥</strong></li><li><strong>çŠ¶æ€ç®¡ç†å™¨</strong>. Context ç»è¿‡ä¸€äº›å°è£…å¯ä»¥åŸºæœ¬å–ä»£ Redux å’Œ Mobx è¿™äº›çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ. åç»­æœ‰ä¸“é—¨æ–‡ç« ä»‹ç»</li></ul><p>Context çš„ä½œç”¨åŸŸæ˜¯å­æ ‘, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Context Provider å¯ä»¥åº”ç”¨äºå¤šä¸ªå­æ ‘, å­æ ‘çš„ Provider ä¹Ÿå¯ä»¥è¦†ç›–çˆ¶çº§çš„ Provider çš„ value. åŸºæœ¬ç»“æ„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;useState, useContext&#125; from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">export inteface MyContextValue &#123;</span><br><span class="line">  state: number</span><br><span class="line">  setState: (state: number) =&gt; void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const MyContext = React.createContext&lt;MyContextValue&gt;(</span><br><span class="line">  &#123;</span><br><span class="line">    state: 1,</span><br><span class="line">    // è®¾ç½®é»˜è®¤å€¼, æŠ›å‡ºé”™è¯¯, å¿…é¡»é…åˆProviderä½¿ç”¨</span><br><span class="line">    setState: () =&gt; throw new Error(&apos;è¯·æ±‚MyContextProviderç»„ä»¶ä¸‹çº§è°ƒç”¨&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export const MyContextProvider: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span><br><span class="line">  const [state, setState] = useState(1)</span><br><span class="line">  return &lt;MyContext.Provider value=&#123;&#123;state, setState&#125;&#125;&gt;&#123;props.children&#125;&lt;/MyContext.Provider&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function useMyContext() &#123;</span><br><span class="line">  return useContext(MyContext)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default MyContextProvider</span><br></pre></td></tr></table></figure><blockquote><p>Context é»˜è®¤å€¼ä¸­çš„æ–¹æ³•åº”è¯¥æŠ›å‡ºé”™è¯¯, è­¦å‘Šä¸è§„èŒƒçš„ä½¿ç”¨</p></blockquote><p>æ‰©å±•ï¼š</p><ul><li><a href="https://zhuanlan.zhihu.com/p/50336226" target="_blank" rel="noopener">é¿å… React Context å¯¼è‡´çš„é‡å¤æ¸²æŸ“</a></li></ul><p><br></p><hr><p><br></p><h2 id="9-ä¸å¯å˜çš„çŠ¶æ€"><a href="#9-ä¸å¯å˜çš„çŠ¶æ€" class="headerlink" title="9. ä¸å¯å˜çš„çŠ¶æ€"></a>9. ä¸å¯å˜çš„çŠ¶æ€</h2><p>å¯¹äºå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼çš„ React æ¥è¯´ï¼Œä¸å¯å˜çŠ¶æ€æœ‰é‡è¦çš„æ„ä¹‰.</p><ul><li><p>ä¸å¯å˜æ•°æ®å…·æœ‰å¯é¢„æµ‹æ€§ã€‚ å¯ä¸å˜æ•°æ®å¯ä»¥è®©åº”ç”¨æ›´å¥½è°ƒè¯•ï¼Œå¯¹è±¡çš„å˜æ›´æ›´å®¹æ˜“è¢«è·Ÿè¸ªå’Œæ¨å¯¼.<br>å°±æ¯”å¦‚ Redux, å®ƒè¦æ±‚åªèƒ½é€šè¿‡ dispatch+reducer è¿›è¡ŒçŠ¶æ€å˜æ›´ï¼Œé…åˆå®ƒçš„ Devtool å¯ä»¥å¾ˆå¥½çš„è·Ÿè¸ªçŠ¶æ€æ˜¯å¦‚ä½•è¢«å˜æ›´çš„. è¿™ä¸ªç‰¹æ€§å¯¹äºå¤§å‹åº”ç”¨æ¥è¯´æ„ä¹‰é‡å¤§ï¼Œå› ä¸ºå®ƒçš„çŠ¶æ€éå¸¸å¤æ‚ï¼Œå¦‚æœä¸åŠ ä»¥ç»„ç»‡å’Œçº¦æŸï¼Œä½ ä¸çŸ¥é“æ˜¯å“ªä¸ªåœ°æ–¹ä¿®æ”¹äº†çŠ¶æ€ï¼Œ å‡ºç° bug æ—¶å¾ˆéš¾è·Ÿè¸ª.</p><p>æ‰€ä»¥è¯´å¯¹äºä¸¥æ ¼è¦æ±‚å•å‘æ•°æ®æµçš„çŠ¶æ€ç®¡ç†å™¨(Redux)æ¥è¯´ï¼Œä¸å¯å˜æ•°æ®æ˜¯åŸºæœ¬è¦æ±‚ï¼Œå®ƒè¦æ±‚æ•´ä¸ªåº”ç”¨ç”±ä¸€ä¸ªå•ä¸€çš„çŠ¶æ€è¿›è¡Œæ˜ å°„ï¼Œä¸å¯å˜æ•°æ®å¯ä»¥è®©æ•´ä¸ªåº”ç”¨å˜å¾—å¯è¢«é¢„æµ‹.</p></li><li><p>ä¸å¯å˜æ•°æ®è¿˜ä½¿ä¸€äº›å¤æ‚çš„åŠŸèƒ½æ›´å®¹æ˜“å®ç°ã€‚é¿å…æ•°æ®æ”¹å˜ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå®‰å…¨ä¿ç•™å¯¹æ—§æ•°æ®çš„å¼•ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°æ’¤é”€é‡åšï¼Œæˆ–è€…æ—¶é—´æ—…è¡Œè¿™äº›åŠŸèƒ½</p></li><li>å¯ä»¥ç²¾ç¡®åœ°è¿›è¡Œé‡æ–°æ¸²æŸ“åˆ¤æ–­ã€‚å¯ä»¥ç®€åŒ– shouldComponentUpdate æ¯”è¾ƒã€‚</li></ul><p>å®ç°ä¸å¯å˜æ•°æ®çš„æµè¡Œæ–¹æ³•:</p><ul><li><a href="https://github.com/immerjs/immer" target="_blank" rel="noopener">immer</a></li><li><a href="https://github.com/immutable-js/immutable-js" target="_blank" rel="noopener">Immutable.js</a></li></ul><p>ç¬”è€…æ¯”è¾ƒå–œæ¬¢ immerï¼Œæ²¡æœ‰ä»€ä¹ˆå¿ƒæ™ºè´Ÿæ‹…, æŒ‰ç…§ JS ä¹ æƒ¯çš„å¯¹è±¡æ“ä½œæ–¹å¼å°±å¯ä»¥å®ç°ä¸å¯å˜æ•°æ®ã€‚</p><p><br></p><hr><p><br></p><h2 id="10-react-router-url-å³çŠ¶æ€"><a href="#10-react-router-url-å³çŠ¶æ€" class="headerlink" title="10. React-router: URL å³çŠ¶æ€"></a>10. React-router: URL å³çŠ¶æ€</h2><center><br> <img src="/images/04/static-router.png" width="300"><br></center><p>ä¼ ç»Ÿçš„è·¯ç”±ä¸»è¦ç”¨äºåŒºåˆ†é¡µé¢, æ‰€ä»¥ä¸€å¼€å§‹å‰ç«¯è·¯ç”±è®¾è®¡ä¹Ÿåƒåç«¯è·¯ç”±(ä¹Ÿç§°ä¸º<strong>é™æ€è·¯ç”±</strong>)ä¸€æ ·, ä½¿ç”¨å¯¹è±¡é…ç½®æ–¹å¼, ç»™ä¸åŒçš„ url åˆ†é…ä¸åŒçš„é¡µé¢ç»„ä»¶, å½“åº”ç”¨å¯åŠ¨æ—¶, åœ¨è·¯ç”±é…ç½®è¡¨ä¸­æŸ¥æ‰¾åŒ¹é… URL çš„ç»„ä»¶å¹¶æ¸²æŸ“å‡ºæ¥.</p><p>React-Router v4 ç®—æ˜¯ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šç¬¦åˆ<em>ç»„ä»¶åŒ–</em>æ€ç»´çš„è·¯ç”±åº“, React-Router å®˜æ–¹ç§°ä¹‹ä¸ºâ€˜åŠ¨æ€è·¯ç”±â€™, å®˜æ–¹çš„è§£é‡Šæ˜¯â€æŒ‡çš„æ˜¯åœ¨åº”ç”¨ç¨‹åºæ¸²æŸ“æ—¶å‘ç”Ÿçš„è·¯ç”±ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œåº”ç”¨ç¨‹åºä¹‹å¤–çš„é…ç½®æˆ–çº¦å®šä¸­å‘ç”Ÿçš„è·¯ç”±â€, å…·ä½“è¯´, <code>&lt;Route/&gt;</code>å˜æˆäº†ä¸€ä¸ªæ™®é€š React ç»„ä»¶, å®ƒåœ¨æ¸²æŸ“æ—¶åˆ¤æ–­æ˜¯å¦åŒ¹é… URL, å¦‚æœåŒ¹é…å°±æ¸²æŸ“æŒ‡å®šçš„ç»„ä»¶, ä¸åŒ¹é…å°±è¿”å› null.</p><p>è¿™æ—¶å€™ URL æ„ä¹‰å·²ç»ä¸ä¸€æ ·äº†, <strong>URL ä¸å†æ˜¯ç®€å•çš„é¡µé¢æ ‡å¿—, è€Œæ˜¯åº”ç”¨çš„çŠ¶æ€</strong>; <strong>åº”ç”¨æ„æˆä¹Ÿä¸å†å±€é™äºæ‰å¹³é¡µé¢, è€Œæ˜¯å¤šä¸ªå¯ä»¥å“åº” URL çŠ¶æ€çš„åŒºåŸŸ(å¯åµŒå¥—)</strong>. å› ä¸ºæ€ç»´è½¬å˜å¾ˆå¤§, æ‰€ä»¥å®ƒåˆšå‡ºæ¥æ—¶å¹¶ä¸å—é’ç. è¿™ç§æ–¹å¼æ›´åŠ çµæ´»ï¼Œ æ‰€ä»¥é€‰æ‹© v4 ä¸ä»£è¡¨æ”¾å¼ƒæ—§çš„è·¯ç”±æ–¹å¼, ä½ å®Œå…¨å¯ä»¥æŒ‰ç…§<a href="https://react-router.docschina.org/core/guides/static-routes" target="_blank" rel="noopener">æ—§çš„æ–¹å¼</a>æ¥å®ç°é¡µé¢è·¯ç”±.</p><p>ä¸¾ä¸ªåº”ç”¨å®ä¾‹: ä¸€ä¸ªåº”ç”¨ç”±ä¸‰ä¸ªåŒºåŸŸç»„æˆ: ä¾§è¾¹æ æ”¾ç½®å¤šä¸ªå…¥å£, ç‚¹å‡»è¿™äº›å…¥å£ä¼šåŠ è½½å¯¹åº”ç±»å‹çš„åˆ—è¡¨, ç‚¹å‡»åˆ—è¡¨é¡¹éœ€è¦åŠ è½½è¯¦æƒ…. ä¸‰ä¸ªåŒºåŸŸå­˜åœ¨çº§è”å…³ç³»</p><p><img src="/images/04/router-demo.png" alt="router demo"></p><p>é¦–å…ˆè®¾è®¡èƒ½å¤Ÿè¡¨è¾¾è¿™ç§çº§è”å…³ç³»çš„ URL, æ¯”å¦‚<code>/{group}/{id}</code>, URL è®¾è®¡ä¸€èˆ¬éµå¾ª<a href="https://ruby-china.github.io/rails-guides/v5.0/routing.html#åµŒå¥—èµ„æº" target="_blank" rel="noopener">REST é£æ ¼</a>, é‚£ä¹ˆåº”ç”¨çš„å¤§æ¦‚ç»“æ„æ˜¯è¿™æ ·å­:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// App</span><br><span class="line">const App = () =&gt; &#123;</span><br><span class="line">  &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">    &lt;SideBar /&gt;</span><br><span class="line">    &lt;Route path=&quot;/:group&quot; component=&#123;ListPage&#125; /&gt;</span><br><span class="line">    &lt;Route path=&quot;/:group/:id&quot; component=&#123;Detail&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// SideBar</span><br><span class="line">const Sidebar = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;sidebar&quot;&gt;</span><br><span class="line">      &#123;/* ä½¿ç”¨NavLink åœ¨åŒ¹é…æ—¶æ˜¾ç¤ºæ¿€æ´»çŠ¶æ€ */&#125;</span><br><span class="line">      &lt;NavLink to=&quot;/message&quot;&gt;æ¶ˆæ¯&lt;/NavLink&gt;</span><br><span class="line">      &lt;NavLink to=&quot;/task&quot;&gt;ä»»åŠ¡&lt;/NavLink&gt;</span><br><span class="line">      &lt;NavLink to=&quot;/location&quot;&gt;å®šä½&lt;/NavLink&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// ListPage</span><br><span class="line">const ListPage = props =&gt; &#123;</span><br><span class="line">  const &#123; group &#125; = props.match.params;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  // å“åº”groupå˜åŒ–, å¹¶åŠ è½½æŒ‡å®šç±»å‹åˆ—è¡¨</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    load(group);</span><br><span class="line">  &#125;, [group]);</span><br><span class="line"></span><br><span class="line">  // åˆ—è¡¨é¡¹ä¹Ÿä¼šä½¿ç”¨NavLink, ç”¨äºåŒ¹é…å½“å‰å±•ç¤ºçš„è¯¦æƒ…, æ¿€æ´»æ˜¾ç¤º</span><br><span class="line">  return &lt;div className=&quot;list&quot;&gt;&#123;renderList()&#125;&lt;/div&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// DetailPage</span><br><span class="line">const DetailPage = props =&gt; &#123;</span><br><span class="line">  const &#123; group, id &#125; = props.match.params;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  // å“åº”groupå’Œid, å¹¶åŠ è½½è¯¦æƒ…</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadDetail(group, id);</span><br><span class="line">  &#125;, [group, id]);</span><br><span class="line"></span><br><span class="line">  return &lt;div className=&quot;detail&quot;&gt;&#123;renderDetail()&#125;&lt;/div&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ‰©å±•</p><ul><li><a href="https://react-router.docschina.org/core/guides/philosophy" target="_blank" rel="noopener">React Router å“²å­¦</a></li><li><a href="https://juejin.im/post/5986d1456fb9a03c3f405bd2" target="_blank" rel="noopener">èŠèŠ React Router v4 çš„è®¾è®¡æ€æƒ³</a></li></ul><p><br></p><hr><p><br></p><h2 id="11-ç»„ä»¶è§„èŒƒ"><a href="#11-ç»„ä»¶è§„èŒƒ" class="headerlink" title="11. ç»„ä»¶è§„èŒƒ"></a>11. ç»„ä»¶è§„èŒƒ</h2><ul><li>å¼€å¯ä¸¥æ ¼æ¨¡å¼: å¼€å¯ StrictModeï¼Œå°½æ—©å‘ç°æ½œåœ¨é—®é¢˜å’Œä¸è§„èŒƒç”¨æ³•</li><li>ç¬¬ä¸‰æ–¹å¼€å‘è§„èŒƒ:<ul><li><a href="https://github.com/airbnb/javascript/tree/master/react#ordering" target="_blank" rel="noopener">Airbnb React/JSX Style Guide</a></li><li><a href="https://vasanthk.gitbooks.io/react-bits/patterns/30.component-switch.html" target="_blank" rel="noopener">React bits</a></li><li><a href="https://github.com/krasimir/react-in-patterns" target="_blank" rel="noopener">react-in-patterns</a></li></ul></li></ul><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://github.com/acdlite/recompose/blob/master/docs/API.md" target="_blank" rel="noopener">recompose</a></li><li><a href="https://overreacted.io/zh-hans/writing-resilient-components/" target="_blank" rel="noopener">ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ React çš„ä¸–ç•Œé‡Œâ€&lt;strong&gt;ä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶&lt;/strong&gt;â€œï¼Œ ç»„ä»¶å¯ä»¥æ˜ å°„ä½œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å‡½æ•°ï¼ŒReact çš„ç»„ä»¶å’Œå‡½æ•°ä¸€æ ·çš„çµæ´»çš„ç‰¹æ€§ä¸ä»…ä»…å¯ä»¥ç”¨äºç»˜åˆ¶ UIï¼Œè¿˜å¯ä»¥ç”¨äºå°è£…ä¸šåŠ¡çŠ¶æ€å’Œé€»è¾‘ï¼Œæˆ–è€…éå±•ç¤ºç›¸å…³çš„å‰¯ä½œç”¨, å†é€šè¿‡ç»„åˆæ–¹å¼ç»„æˆå¤æ‚çš„åº”ç”¨. æœ¬æ–‡å°è¯•
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“03 - æ ·å¼çš„ç®¡ç†</title>
    <link href="https://bobi.ink/2019/05/14/react-component-design-03/"/>
    <id>https://bobi.ink/2019/05/14/react-component-design-03/</id>
    <published>2019-05-13T16:00:00.000Z</published>
    <updated>2019-05-15T01:12:44.010Z</updated>
    
    <content type="html"><![CDATA[<p>CSS æ˜¯å‰ç«¯å¼€å‘çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å®Œç¾ï¼Œæœ¬æ–‡ä¸»è¦æ¢è®¨ React æ ·å¼ç®¡ç†æ–¹é¢çš„ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œç›®çš„æ˜¯å®ç°æ ·å¼çš„é«˜åº¦å¯å®šåˆ¶åŒ–, è®©å¤§å‹é¡¹ç›®çš„æ ·å¼ä»£ç æ›´å®¹æ˜“ç»´æŠ¤.</p><p><strong>ç³»åˆ—ç›®å½•</strong></p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li>05 çŠ¶æ€ç®¡ç† å¾…æ›´æ–°</li></ul><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#1-è®¤è¯†-css-çš„å±€é™æ€§">1. è®¤è¯† CSS çš„å±€é™æ€§</a><ul><li><a href="#1ï¸âƒ£-å…¨å±€æ€§">1ï¸âƒ£ å…¨å±€æ€§</a></li><li><a href="#2ï¸âƒ£-ä¾èµ–">2ï¸âƒ£ ä¾èµ–</a></li><li><a href="#3ï¸âƒ£-æ— ç”¨ä»£ç çš„ç§»é™¤">3ï¸âƒ£ æ— ç”¨ä»£ç çš„ç§»é™¤</a></li><li><a href="#4ï¸âƒ£-å‹ç¼©">4ï¸âƒ£ å‹ç¼©</a></li><li><a href="#5ï¸âƒ£-å¸¸é‡å…±äº«">5ï¸âƒ£ å¸¸é‡å…±äº«</a></li><li><a href="#6ï¸âƒ£-css-è§£ææ–¹å¼çš„ä¸ç¡®å®šæ€§">6ï¸âƒ£ CSS è§£ææ–¹å¼çš„ä¸ç¡®å®šæ€§</a></li></ul></li><li><a href="#2-ç»„ä»¶çš„æ ·å¼ç®¡ç†">2. ç»„ä»¶çš„æ ·å¼ç®¡ç†</a><ul><li><a href="#1ï¸âƒ£-ç»„ä»¶çš„æ ·å¼åº”è¯¥é«˜åº¦å¯å®šåˆ¶åŒ–">1ï¸âƒ£ ç»„ä»¶çš„æ ·å¼åº”è¯¥é«˜åº¦å¯å®šåˆ¶åŒ–</a></li><li><a href="#2ï¸âƒ£-é¿å…ä½¿ç”¨å†…è”-css">2ï¸âƒ£ é¿å…ä½¿ç”¨å†…è” CSS</a></li><li><a href="#3ï¸âƒ£-ä½¿ç”¨-css-in-js">3ï¸âƒ£ ä½¿ç”¨ CSS-in-js</a><ul><li><a href="#0-åŸºæœ¬ç”¨æ³•">0. åŸºæœ¬ç”¨æ³•</a></li><li><a href="#1-æ ·å¼æ‰©å±•">1. æ ·å¼æ‰©å±•</a></li><li><a href="#2-mixin-æœºåˆ¶">2. mixin æœºåˆ¶</a></li><li><a href="#3-ç±»-scss-çš„è¯­æ³•">3. ç±» SCSS çš„è¯­æ³•</a></li><li><a href="#5-js-å¸¦æ¥çš„åŠ¨æ€æ€§">5. JS å¸¦æ¥çš„åŠ¨æ€æ€§</a></li><li><a href="#6-ç»‘å®šç»„ä»¶çš„å…¨å±€æ ·å¼">6. ç»‘å®šç»„ä»¶çš„<code>å…¨å±€æ ·å¼</code></a></li><li><a href="#7-theme-æœºåˆ¶åŠ-theme-å¯¹è±¡çš„è®¾è®¡">7. Theme æœºåˆ¶åŠ Theme å¯¹è±¡çš„è®¾è®¡</a></li><li><a href="#8-æå‡å¼€å‘ä½“éªŒ">8. æå‡å¼€å‘ä½“éªŒ</a></li><li><a href="#9-äº†è§£-styled-components-çš„å±€é™æ€§">9. äº†è§£ styled-components çš„å±€é™æ€§</a></li><li><a href="#10-ä¸€äº›å¼€å‘è§„èŒƒ">10. ä¸€äº›å¼€å‘è§„èŒƒ</a></li><li><a href="#11-å…¶ä»–-css-in-js-æ–¹æ¡ˆ">11. å…¶ä»– CSS-in-js æ–¹æ¡ˆ</a></li></ul></li><li><a href="#4ï¸âƒ£-é€šç”¨çš„ç»„ä»¶åº“ä¸åº”è¯¥è€¦åˆ-css-in-jscss-module-çš„æ–¹æ¡ˆ">4ï¸âƒ£ é€šç”¨çš„ç»„ä»¶åº“ä¸åº”è¯¥è€¦åˆ CSS-in-js/CSS-module çš„æ–¹æ¡ˆ</a></li><li><a href="#5ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ-css">5ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ CSS</a></li><li><a href="#6ï¸âƒ£-é€‰æ‹©åˆé€‚è‡ªå·±å›¢é˜Ÿçš„æŠ€æœ¯æ ˆ">6ï¸âƒ£ é€‰æ‹©åˆé€‚è‡ªå·±å›¢é˜Ÿçš„æŠ€æœ¯æ ˆ</a></li><li><a href="#7ï¸âƒ£-ä½¿ç”¨-svgr-è½¬æ¢-svg-å›¾æ ‡">7ï¸âƒ£ ä½¿ç”¨ svgr è½¬æ¢ svg å›¾æ ‡</a></li><li><a href="#8ï¸âƒ£-ç»“åˆä½¿ç”¨-rem-å’Œ-em-ç­‰ç›¸å¯¹å•ä½-åˆ›å»ºæ›´æœ‰å¼¹æ€§çš„ç»„ä»¶">8ï¸âƒ£ ç»“åˆä½¿ç”¨ rem å’Œ em ç­‰ç›¸å¯¹å•ä½, åˆ›å»ºæ›´æœ‰å¼¹æ€§çš„ç»„ä»¶</a></li></ul></li><li><a href="#3-è§„èŒƒ">3. è§„èŒƒ</a><ul><li><a href="#1ï¸âƒ£-ä¿ƒè¿›å»ºç«‹ç»Ÿä¸€çš„-ui-è®¾è®¡è§„èŒƒ">1ï¸âƒ£ ä¿ƒè¿›å»ºç«‹ç»Ÿä¸€çš„ UI è®¾è®¡è§„èŒƒ</a></li><li><a href="#2ï¸âƒ£-css-ç¼–å†™è§„èŒƒ">2ï¸âƒ£ CSS ç¼–å†™è§„èŒƒ</a></li><li><a href="#3ï¸âƒ£-ä½¿ç”¨stylelintè¿›è¡Œæ ·å¼è§„èŒƒæ£€æŸ¥">3ï¸âƒ£ ä½¿ç”¨stylelintè¿›è¡Œæ ·å¼è§„èŒƒæ£€æŸ¥</a></li></ul></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="1-è®¤è¯†-css-çš„å±€é™æ€§"><a href="#1-è®¤è¯†-css-çš„å±€é™æ€§" class="headerlink" title="1. è®¤è¯† CSS çš„å±€é™æ€§"></a>1. è®¤è¯† CSS çš„å±€é™æ€§</h2><center><br> <img src="/images/04/vjeux-speak.png" alt="vjeux-speak" width="500"><br></center><p>2014 å¹´<a href="https://github.com/vjeux" target="_blank" rel="noopener">vjeux</a>ä¸€ä¸ª <a href="https://speakerd.s3.amazonaws.com/presentations/2e15908049bb013230960224c1b4b8bd/css-in-javascript.pdf" target="_blank" rel="noopener">speak</a> æ·±åˆ»æ­ç¤ºçš„åŸç”Ÿ CSS çš„ä¸€äº›å±€é™æ€§. è™½ç„¶å®ƒæœ‰äº›äº‰è®®, å¯¹äºå¼€å‘è€…æ¥è¯´æ›´å¤šçš„æ˜¯å¯å‘. è‡³ä»é‚£ä¹‹åå‡ºç°äº†å¾ˆå¤š <code>CSS-in-js</code> è§£å†³æ–¹æ¡ˆ.</p><h3 id="1ï¸âƒ£-å…¨å±€æ€§"><a href="#1ï¸âƒ£-å…¨å±€æ€§" class="headerlink" title="1ï¸âƒ£ å…¨å±€æ€§"></a>1ï¸âƒ£ å…¨å±€æ€§</h3><p>CSS çš„é€‰æ‹©å™¨æ˜¯æ²¡æœ‰éš”ç¦»æ€§çš„, ä¸ç®¡æ˜¯ä½¿ç”¨å‘½åç©ºé—´è¿˜æ˜¯ BEM æ¨¡å¼ç»„ç»‡, æœ€ç»ˆéƒ½ä¼šæ±¡æŸ“å…¨å±€å‘½åç©ºé—´. å°¤å…¶æ˜¯å¤§å‹å›¢é˜Ÿåˆä½œçš„é¡¹ç›®, å¾ˆéš¾ç¡®å®šæŸä¸ªç‰¹å®šçš„ç±»æˆ–è€…å…ƒç´ æ˜¯å¦å·²ç»èµ‹è¿‡æ ·å¼. æ‰€ä»¥åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šç»å°½è„‘æ±æ–°åˆ›å»ºä¸€ä¸ªç±»å, è€Œä¸æ˜¯å¤ç”¨å·²æœ‰çš„ç±»å‹.</p><p>è§£å†³çš„æ–¹å‘: ç”Ÿæˆå”¯ä¸€çš„ç±»å; shadow dom; å†…è”æ ·å¼; Vue-scoped æ–¹æ¡ˆ</p><p><br></p><h3 id="2ï¸âƒ£-ä¾èµ–"><a href="#2ï¸âƒ£-ä¾èµ–" class="headerlink" title="2ï¸âƒ£ ä¾èµ–"></a>2ï¸âƒ£ ä¾èµ–</h3><p>ç”±äº CSS çš„â€™å…¨å±€æ€§â€™, æ‰€ä»¥å°±äº§ç”Ÿäº†ä¾èµ–é—®é¢˜:</p><p>ä¸€æ–¹é¢æˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æ¸²æŸ“å‰å°±éœ€è¦å…ˆå°† CSS åŠ è½½å®Œæ¯•, ä½†æ˜¯<strong>å¾ˆéš¾æ¸…æ™°åœ°å®šä¹‰æŸä¸ªç‰¹å®šç»„ä»¶ä¾èµ–äºæŸæ®µç‰¹å®šçš„ CSS ä»£ç </strong>; å¦ä¸€æ–¹é¢, <strong>å…¨å±€æ€§å¯¼è‡´ä½ çš„æ ·å¼å¯èƒ½è¢«åˆ«çš„ç»„ä»¶ä¾èµ–(æŸç§ç¨‹åº¦çš„ç»†èŠ‚è€¦åˆ)</strong>, ä½ ä¸èƒ½éšä¾¿ä¿®æ”¹ä½ çš„æ ·å¼, ä»¥å…ç ´åå…¶ä»–é¡µé¢æˆ–ç»„ä»¶çš„æ ·å¼. å¦‚æœå›¢é˜Ÿæ²¡æœ‰åˆ¶å®šåˆé€‚çš„ CSS è§„èŒƒ(ä¾‹å¦‚ BEM, ä¸ç›´æ¥ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨, å‡å°‘é€‰æ‹©å™¨åµŒå¥—ç­‰ç­‰), ä»£ç å¾ˆå¿«å°±ä¼šå¤±æ§</p><p>è§£å†³çš„æ–¹å‘: ä¹‹å‰æ–‡ç« æåˆ°ç»„ä»¶æ˜¯ä¸€ä¸ªå†…èšå•å…ƒ, æ ·å¼åº”è¯¥æ˜¯å’Œç»„ä»¶ç»‘å®šçš„. æœ€åŸºæœ¬çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ç±»ä¼¼ BEM å‘½åè§„èŒƒæ¥é¿å…ç»„ä»¶ä¹‹é—´çš„å‘½åå†²çª, å†é€šè¿‡åˆ›å»ºä¼˜äºå¤ç”¨, ç»„åˆä¼˜äºç»§æ‰¿çš„åŸåˆ™, æ¥é¿å…ç»„ä»¶é—´æ ·å¼è€¦åˆ;</p><p><br></p><h3 id="3ï¸âƒ£-æ— ç”¨ä»£ç çš„ç§»é™¤"><a href="#3ï¸âƒ£-æ— ç”¨ä»£ç çš„ç§»é™¤" class="headerlink" title="3ï¸âƒ£ æ— ç”¨ä»£ç çš„ç§»é™¤"></a>3ï¸âƒ£ æ— ç”¨ä»£ç çš„ç§»é™¤</h3><p>ç”±äºä¸Šè¿°â€™ä¾èµ–â€™é—®é¢˜, ç»„ä»¶æ ·å¼ä¹‹é—´å¹¶æ²¡æœ‰æ˜ç¡®çš„è¾¹ç•Œ, å¾ˆéš¾åˆ¤æ–­å“ªäº›æ ·å¼å±äºé‚£ä¸ªç»„ä»¶; åœ¨åŠ ä¸Š CSS çš„â€™å å±‚ç‰¹æ€§â€™, æ›´æ— æ³•ç¡®å®šåˆ é™¤æ ·å¼ä¼šå¸¦æ¥ä»€ä¹ˆå½±å“.</p><blockquote><p>ç°ä»£æµè§ˆå™¨å·²æ”¯æŒ CSS æ— ç”¨ä»£ç æ£€æŸ¥. ä½†å¯¹äºæ— ç»„ç»‡çš„ CSS æ•ˆæœä¸ä¼šå¤ªå¤§</p></blockquote><p>è§£å†³çš„æ–¹å‘: å¦‚æœæ ·å¼çš„ä¾èµ–æ¯”è¾ƒæ˜ç¡®ï¼Œåˆ™å¯ä»¥å®‰å…¨åœ°ç§»é™¤æ— ç”¨ä»£ç </p><p><br></p><h3 id="4ï¸âƒ£-å‹ç¼©"><a href="#4ï¸âƒ£-å‹ç¼©" class="headerlink" title="4ï¸âƒ£ å‹ç¼©"></a>4ï¸âƒ£ å‹ç¼©</h3><p>é€‰æ‹©å™¨å’Œç±»åçš„å‹ç¼©å¯ä»¥å‡å°‘æ–‡ä»¶çš„ä½“ç§¯, æé«˜åŠ è½½çš„æ€§èƒ½. å› ä¸ºåŸç”Ÿ CSS ä¸€èˆ¬æœ‰å¼€å‘è€…ç”±é…ç½®ç±»å(åœ¨ html æˆ– js åŠ¨æ€æŒ‡å®š), æ‰€ä»¥å·¥å…·å¾ˆéš¾å¯¹ç±»åè¿›è¡Œæ§åˆ¶.</p><blockquote><p>å‹ç¼©ç±»åä¹Ÿä¼šå‡ä½ä»£ç çš„å¯è¯»æ€§, å˜å¾—éš¾ä»¥è°ƒè¯•.</p></blockquote><p>è§£å†³çš„æ–¹å‘: ç”±å·¥å…·æ¥è½¬æ¢æˆ–åˆ›å»ºç±»å</p><p><br></p><h3 id="5ï¸âƒ£-å¸¸é‡å…±äº«"><a href="#5ï¸âƒ£-å¸¸é‡å…±äº«" class="headerlink" title="5ï¸âƒ£ å¸¸é‡å…±äº«"></a>5ï¸âƒ£ å¸¸é‡å…±äº«</h3><p>å¸¸è§„çš„ CSS å¾ˆéš¾åšåˆ°åœ¨æ ·å¼å’Œ JS ä¹‹é—´å…±äº«å˜é‡, ä¾‹å¦‚è‡ªå®šä¹‰ä¸»é¢˜è‰², é€šå¸¸é€šè¿‡å†…è”æ ·å¼æ¥éƒ¨åˆ†å®ç°è¿™ç§éœ€æ±‚</p><p>è§£å†³çš„æ–¹å‘: CSS-in-js</p><p><br></p><h3 id="6ï¸âƒ£-css-è§£ææ–¹å¼çš„ä¸ç¡®å®šæ€§"><a href="#6ï¸âƒ£-css-è§£ææ–¹å¼çš„ä¸ç¡®å®šæ€§" class="headerlink" title="6ï¸âƒ£ CSS è§£ææ–¹å¼çš„ä¸ç¡®å®šæ€§"></a>6ï¸âƒ£ CSS è§£ææ–¹å¼çš„ä¸ç¡®å®šæ€§</h3><p>CSS è§„åˆ™çš„åŠ è½½é¡ºåºæ˜¯å¾ˆé‡è¦çš„, ä»–ä¼šå½±å“å±æ€§åº”ç”¨çš„ä¼˜å…ˆçº§, å¦‚æœæŒ‰éœ€åŠ è½½ CSS, åˆ™æ— æ³•ç¡®ä¿ä»–ä»¬çš„è§£æé¡ºåº, è¿›è€Œå¯¼è‡´é”™è¯¯çš„æ ·å¼åº”ç”¨åˆ°å…ƒç´ ä¸Š. æœ‰äº›å¼€å‘è€…ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, ä½¿ç”¨!important å£°æ˜å±æ€§, è¿™æ— ç–‘æ˜¯è¿›å…¥äº†å¦ä¸€ä¸ªå‘.</p><p>è§£å†³æ–¹å‘ï¼šé¿å…ä½¿ç”¨å…¨å±€æ ·å¼ï¼Œç»„ä»¶æ ·å¼éš”ç¦»ï¼›æ ·å¼åŠ è½½å’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»‘å®š</p><p><br></p><hr><p><br></p><h2 id="2-ç»„ä»¶çš„æ ·å¼ç®¡ç†"><a href="#2-ç»„ä»¶çš„æ ·å¼ç®¡ç†" class="headerlink" title="2. ç»„ä»¶çš„æ ·å¼ç®¡ç†"></a>2. ç»„ä»¶çš„æ ·å¼ç®¡ç†</h2><h3 id="1ï¸âƒ£-ç»„ä»¶çš„æ ·å¼åº”è¯¥é«˜åº¦å¯å®šåˆ¶åŒ–"><a href="#1ï¸âƒ£-ç»„ä»¶çš„æ ·å¼åº”è¯¥é«˜åº¦å¯å®šåˆ¶åŒ–" class="headerlink" title="1ï¸âƒ£ ç»„ä»¶çš„æ ·å¼åº”è¯¥é«˜åº¦å¯å®šåˆ¶åŒ–"></a>1ï¸âƒ£ ç»„ä»¶çš„æ ·å¼åº”è¯¥é«˜åº¦å¯å®šåˆ¶åŒ–</h3><p>ç»„ä»¶çš„æ ·å¼åº”è¯¥æ˜¯å¯ä»¥è‡ªç”±å®šåˆ¶çš„, å¼€å‘è€…åº”è¯¥è€ƒè™‘ç»„ä»¶çš„å„ç§ä½¿ç”¨åœºæ™¯. æ‰€ä»¥ä¸€ä¸ªå¥½çš„ç»„ä»¶å¿…é¡»æš´éœ²ç›¸å…³çš„æ ·å¼å®šåˆ¶æ¥å£. è‡³å°‘éœ€è¦æ”¯æŒä¸ºé¡¶å±‚å…ƒç´ é…ç½®<code>className</code>å’Œ<code>style</code>å±æ€§:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> ButtonProps &#123;</span><br><span class="line">  className?: <span class="built_in">string</span>;</span><br><span class="line">  style?: React.CSSProperties;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå±æ€§åº”è¯¥æ˜¯æ¯ä¸ªå±•ç¤ºå‹ç»„ä»¶åº”è¯¥æš´éœ²çš„ props, å…¶ä»–åµŒå¥—å…ƒç´ ä¹Ÿè¦è€ƒè™‘æ”¯æŒé…ç½®æ ·å¼, ä¾‹å¦‚ footerClassName, footerStyle.</p><p><br></p><hr><p><br></p><h3 id="2ï¸âƒ£-é¿å…ä½¿ç”¨å†…è”-css"><a href="#2ï¸âƒ£-é¿å…ä½¿ç”¨å†…è”-css" class="headerlink" title="2ï¸âƒ£ é¿å…ä½¿ç”¨å†…è” CSS"></a>2ï¸âƒ£ é¿å…ä½¿ç”¨å†…è” CSS</h3><ol><li>style props æ·»åŠ çš„å±æ€§ä¸èƒ½è‡ªåŠ¨å¢åŠ å‚å•†å‰ç¼€, è¿™å¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜. å¦‚æœæ·»åŠ å‚å•†å‰ç¼€åˆä¼šè®©ä»£ç å˜å¾—å•°å—¦.</li><li>å†…è” CSS ä¸æ”¯æŒå¤æ‚çš„æ ·å¼é…ç½®, ä¾‹å¦‚ä¼ªå…ƒç´ , ä¼ªç±», åŠ¨ç”»å®šä¹‰, åª’ä½“æŸ¥è¯¢å’Œåª’ä½“å›é€€(å¯¹è±¡ä¸å…è®¸åŒåå±æ€§, ä¾‹å¦‚<code>display: -webkit-flex; display: flex;</code>)</li><li>å†…è”æ ·å¼é€šè¿‡ object ä¼ å…¥ç»„ä»¶, å†…è”çš„ object æ¯æ¬¡æ¸²æŸ“ä¼šé‡æ–°ç”Ÿæˆ, ä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“. å½“ç„¶é€šè¿‡æŸäº›å·¥å…·å¯ä»¥å°†é™æ€çš„ object æå–å‡ºå»</li><li>ä¸æ–¹ä¾¿è°ƒè¯•å’Œé˜…è¯»<br>â€¦</li></ol><p>æ‰€ä»¥ å†…è” CSS é€‚åˆç”¨äºè®¾ç½®åŠ¨æ€ä¸”æ¯”è¾ƒç®€å•çš„æ ·å¼å±æ€§</p><blockquote><p>ç¤¾åŒºä¸Šæœ‰è®¸å¤š CSS-in-js æ–¹æ¡ˆæ˜¯åŸºäºå†…è” CSS çš„, ä¾‹å¦‚ Radium, å®ƒä½¿ç”¨ JS æ·»åŠ äº‹ä»¶å¤„ç†å™¨æ¥æ¨¡æ‹Ÿä¼ªç±», å¦å¤–ä¹Ÿåª’ä½“æŸ¥è¯¢å’ŒåŠ¨ç”». ä¸è¿‡ä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½å¯ä»¥é€šè¿‡ JS æ¨¡æ‹Ÿ, æ¯”å¦‚ä¼ªå…ƒç´ . æ‰€ä»¥è¿™ç±»è§£å†³æ–¹æ¡ˆç”¨å¾—æ¯”è¾ƒå°‘</p></blockquote><p><br></p><hr><p><br></p><h3 id="3ï¸âƒ£-ä½¿ç”¨-css-in-js"><a href="#3ï¸âƒ£-ä½¿ç”¨-css-in-js" class="headerlink" title="3ï¸âƒ£ ä½¿ç”¨ CSS-in-js"></a>3ï¸âƒ£ ä½¿ç”¨ CSS-in-js</h3><p>ç¤¾åŒºæœ‰å¾ˆå¤š CSS è§£å†³æ–¹æ¡ˆ, æœ‰ä¸ª<a href="https://github.com/MicheleBertoli/css-in-js" target="_blank" rel="noopener">é¡¹ç›®(MicheleBertoli/css-in-js)</a>ä¸“é—¨ç½—åˆ—å’Œå¯¹æ¯”äº†è¿™äº›æ–¹æ¡ˆ. è¯»è€…ä¹Ÿå¯ä»¥è¯»è¿™ç¯‡æ–‡ç« (<a href="https://www.javascriptstuff.com/how-to-style-react/" target="_blank" rel="noopener">What to use for React styling?</a>)å­¦ä¹ å¯¹ CSS ç›¸å…³æŠ€æœ¯è¿›è¡Œé€‰å‹å†³ç­–</p><p>ç¤¾åŒºä¸Šæœ€æµè¡Œçš„, ä¹Ÿæ˜¯ç¬”è€…è§‰å¾—ä½¿ç”¨èµ·æ¥æœ€èˆ’æœçš„æ˜¯<a href="https://www.styled-components.com" target="_blank" rel="noopener"><code>styled-components</code></a>, styled-components æœ‰ä¸‹åˆ—ç‰¹æ€§:</p><ul><li>è‡ªåŠ¨ç”Ÿæˆç±»å, è§£å†³ CSS çš„å…¨å±€æ€§å’Œæ ·å¼å†²çª. é€šè¿‡ç»„ä»¶åæ¥æ ‡å¿—æ ·å¼, è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€çš„ç±»å, å¼€å‘è€…ä¸éœ€è¦ä¸ºå…ƒç´ å®šä¹‰ç±»å.</li><li>ç»‘å®šç»„ä»¶. éš”ç¦»äº† CSS çš„ä¾èµ–é—®é¢˜, è®©ç»„ä»¶ JSX æ›´åŠ ç®€æ´, åè¿‡æ¥å¼€å‘è€…éœ€è¦è€ƒè™‘æ›´å¤šç»„ä»¶çš„è¯­ä¹‰</li><li>å¤©ç”Ÿæ”¯æŒâ€™å…³é”® CSSâ€™. æ ·å¼å’Œç»„ä»¶ç»‘å®š, å¯ä»¥å’Œç»„ä»¶ä¸€èµ·è¿›è¡Œä»£ç åˆ†å‰²å’Œå¼‚æ­¥åŠ è½½</li><li>è‡ªåŠ¨æ·»åŠ å‚å•†å‰ç¼€</li><li>çµæ´»çš„åŠ¨æ€æ ·å¼. é€šè¿‡ props å’Œå…¨å±€ theme æ¥åŠ¨æ€æ§åˆ¶æ ·å¼</li><li>æä¾›äº†ä¸€äº› CSS é¢„å¤„ç†å™¨çš„è¯­æ³•</li><li>ä¸»é¢˜æœºåˆ¶</li><li>æ”¯æŒ react-native. è¿™ä¸ªç”¨èµ·æ¥æ¯”è¾ƒçˆ½</li><li>æ”¯æŒ <a href="https://github.com/stylelint/stylelint" target="_blank" rel="noopener">stylelint</a>, ç¼–è¾‘å™¨é«˜äº®å’Œæ™ºèƒ½æç¤º</li><li>æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“</li><li>ç¬¦åˆåˆ†ç¦»å±•ç¤ºç»„ä»¶å’Œè¡Œä¸ºç»„ä»¶åŸåˆ™</li></ul><blockquote><p>æ¨èè¿™ç¯‡æ–‡ç« : <a href="https://medium.com/@gajus/stop-using-css-in-javascript-for-web-development-fa32fb873dcc" target="_blank" rel="noopener">Stop using css-in-javascript for web development</a>, styled-components å¯ä»¥åŸºæœ¬è¦†ç›–æ‰€æœ‰ CSS çš„ä½¿ç”¨åœºæ™¯:</p></blockquote><p><br></p><h4 id="0-åŸºæœ¬ç”¨æ³•"><a href="#0-åŸºæœ¬ç”¨æ³•" class="headerlink" title="0. åŸºæœ¬ç”¨æ³•"></a>0. åŸºæœ¬ç”¨æ³•</h4><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ç»„ä»¶props</span></span><br><span class="line"><span class="keyword">const</span> Title = styled.h1&lt;&#123; active?: <span class="built_in">boolean</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; (props.active ? 'red' : 'gray')&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›ºå®šæˆ–è®¡ç®—ç»„ä»¶props</span></span><br><span class="line"><span class="keyword">const</span> Input = styled.input.attrs(&#123;</span><br><span class="line">  <span class="keyword">type</span>: <span class="string">'text'</span>,</span><br><span class="line">  size: <span class="function"><span class="params">props</span> =&gt;</span> (props.small ? <span class="number">5</span> : <span class="literal">undefined</span>),</span><br><span class="line">&#125;)<span class="string">``</span>;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="1-æ ·å¼æ‰©å±•"><a href="#1-æ ·å¼æ‰©å±•" class="headerlink" title="1. æ ·å¼æ‰©å±•"></a>1. æ ·å¼æ‰©å±•</h4><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Button = styled.button<span class="string">`</span></span><br><span class="line"><span class="string">  color: palevioletred;</span></span><br><span class="line"><span class="string">  font-size: 1em;</span></span><br><span class="line"><span class="string">  margin: 1em;</span></span><br><span class="line"><span class="string">  padding: 0.25em 1em;</span></span><br><span class="line"><span class="string">  border: 2px solid palevioletred;</span></span><br><span class="line"><span class="string">  border-radius: 3px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦†ç›–å’Œæ‰©å±•å·²æœ‰çš„ç»„ä»¶, åŒ…å«styledç”Ÿæˆçš„ç»„ä»¶è¿˜æ˜¯è‡ªå®šä¹‰ç»„ä»¶(é€šè¿‡classNameä¼ å…¥)</span></span><br><span class="line"><span class="keyword">const</span> TomatoButton = styled(Button)<span class="string">`</span></span><br><span class="line"><span class="string">  color: tomato;</span></span><br><span class="line"><span class="string">  border-color: tomato;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="2-mixin-æœºåˆ¶"><a href="#2-mixin-æœºåˆ¶" class="headerlink" title="2. mixin æœºåˆ¶"></a>2. mixin æœºåˆ¶</h4><p>åœ¨ SCSS ä¸­, mixin æ˜¯é‡è¦çš„ CSS å¤ç”¨æœºåˆ¶, styled-components ä¹Ÿå¯ä»¥å®ç°:</p><p>å®šä¹‰:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; css &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// utils/styled-mixins.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">truncate</span>(<span class="params">width</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> css<span class="string">`</span></span><br><span class="line"><span class="string">    width: <span class="subst">$&#123;width&#125;</span>;</span></span><br><span class="line"><span class="string">    white-space: nowrap;</span></span><br><span class="line"><span class="string">    overflow: hidden;</span></span><br><span class="line"><span class="string">    text-overflow: ellipsis;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; truncate &#125; <span class="keyword">from</span> <span class="string">'~/utils/styled-mixins'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Box = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  // æ··å…¥</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;truncate('250px')&#125;</span></span></span><br><span class="line"><span class="string">  background: papayawhip;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="3-ç±»-scss-çš„è¯­æ³•"><a href="#3-ç±»-scss-çš„è¯­æ³•" class="headerlink" title="3. ç±» SCSS çš„è¯­æ³•"></a>3. ç±» SCSS çš„è¯­æ³•</h4><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Example = styled(Component)<span class="string">`</span></span><br><span class="line"><span class="string">  // è‡ªåŠ¨å‚å•†å‰ç¼€</span></span><br><span class="line"><span class="string">  padding: 2em 1em;</span></span><br><span class="line"><span class="string">  background: papayawhip;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // ä¼ªç±»</span></span><br><span class="line"><span class="string">  &amp;:hover &#123;</span></span><br><span class="line"><span class="string">    background: palevioletred;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // æä¾›æ ·å¼ä¼˜å…ˆçº§æŠ€å·§</span></span><br><span class="line"><span class="string">  &amp;&amp;&amp; &#123;</span></span><br><span class="line"><span class="string">    color: palevioletred;</span></span><br><span class="line"><span class="string">    font-weight: bold;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // è¦†ç›–å†…è”cssæ ·å¼</span></span><br><span class="line"><span class="string">  &amp;[style] &#123;</span></span><br><span class="line"><span class="string">    font-size: 12px !important;</span></span><br><span class="line"><span class="string">    color: blue !important;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // æ”¯æŒåª’ä½“æŸ¥è¯¢</span></span><br><span class="line"><span class="string">  @media (max-width: 600px) &#123;</span></span><br><span class="line"><span class="string">    background: tomato;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // åµŒå¥—è§„åˆ™</span></span><br><span class="line"><span class="string">    &amp;:hover &#123;</span></span><br><span class="line"><span class="string">      background: yellow;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &gt; p &#123;</span></span><br><span class="line"><span class="string">    /* descendant-selectors work as well, but are more of an escape hatch */</span></span><br><span class="line"><span class="string">    text-decoration: underline;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  /* Contextual selectors work as well */</span></span><br><span class="line"><span class="string">  html.test &amp; &#123;</span></span><br><span class="line"><span class="string">    display: none;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p><strong>å¼•ç”¨å…¶ä»–ç»„ä»¶</strong><br></p><p>ç”±äº styled-components çš„ç±»åæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„, æ‰€ä»¥ä¸èƒ½ç›´æ¥åœ¨é€‰æ‹©å™¨ä¸­å£°æ˜ä»–ä»¬, ä½†å¯ä»¥åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­å¼•ç”¨å…¶ä»–ç»„ä»¶:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Icon = styled.svg<span class="string">`</span></span><br><span class="line"><span class="string">  flex: none;</span></span><br><span class="line"><span class="string">  transition: fill 0.25s;</span></span><br><span class="line"><span class="string">  width: 48px;</span></span><br><span class="line"><span class="string">  height: 48px;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // å¼•ç”¨å…¶ä»–ç»„ä»¶çš„ç±»å. è¿™ä¸ªç»„ä»¶å¿…é¡»æ˜¯styled-componentsç”Ÿæˆæˆ–è€…åŒ…è£…çš„ç»„ä»¶</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;Link&#125;</span>:hover &amp; &#123;</span></span><br><span class="line"><span class="string">    fill: rebeccapurple;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="5-js-å¸¦æ¥çš„åŠ¨æ€æ€§"><a href="#5-js-å¸¦æ¥çš„åŠ¨æ€æ€§" class="headerlink" title="5. JS å¸¦æ¥çš„åŠ¨æ€æ€§"></a>5. JS å¸¦æ¥çš„åŠ¨æ€æ€§</h4><p>åª’ä½“æŸ¥è¯¢å¸®åŠ©æ–¹æ³•:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/styled.ts</span></span><br><span class="line"><span class="keyword">const</span> sizes = &#123;</span><br><span class="line">  giant: <span class="number">1170</span>,</span><br><span class="line">  desktop: <span class="number">992</span>,</span><br><span class="line">  tablet: <span class="number">768</span>,</span><br><span class="line">  phone: <span class="number">376</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> media = <span class="built_in">Object</span>.keys(sizes).reduce(<span class="function">(<span class="params">accumulator, label</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> emSize = sizes[label] / <span class="number">16</span>;</span><br><span class="line">  accumulator[label] = <span class="function">(<span class="params">...args</span>) =&gt;</span> css<span class="string">`</span></span><br><span class="line"><span class="string">    @media (max-width: <span class="subst">$&#123;emSize&#125;</span>em) &#123;</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;css(...args)&#125;</span></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">return</span> accumulator;</span><br><span class="line">&#125;, &#123;&#125;);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Container = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  color: #333;</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;media.desktop`padding: 0 20px;`&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;media.tablet`padding: 0 10px;`&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;media.phone`padding: 0 5px;`&#125;</span></span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><blockquote><p>SCSS ä¹Ÿæä¾›äº†å¾ˆå¤šå†…ç½®å·¥å…·æ–¹æ³•, æ¯”å¦‚é¢œè‰²çš„å¤„ç†, å°ºå¯¸çš„è®¡ç®—. styled-components æä¾›äº†ä¸€ä¸ªç±»ä¼¼çš„ js åº“: <a href="https://github.com/styled-components/polished" target="_blank" rel="noopener">polished</a>æ¥æ»¡è¶³è¿™éƒ¨åˆ†éœ€æ±‚, å¦å¤–è¿˜é›†æˆäº†å¸¸ç”¨çš„ mixin, å¦‚ clearfix. é€šè¿‡ babel æ’ä»¶å¯ä»¥åœ¨ç¼–è¯‘æ—¶è½¬æ¢ä¸ºé™æ€ä»£ç , ä¸éœ€è¦è¿è¡Œæ—¶.</p></blockquote><p><br></p><h4 id="6-ç»‘å®šç»„ä»¶çš„å…¨å±€æ ·å¼"><a href="#6-ç»‘å®šç»„ä»¶çš„å…¨å±€æ ·å¼" class="headerlink" title="6. ç»‘å®šç»„ä»¶çš„å…¨å±€æ ·å¼"></a>6. ç»‘å®šç»„ä»¶çš„<code>å…¨å±€æ ·å¼</code></h4><p>å…¨å±€æ ·å¼å’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»‘å®š, å½“ç»„ä»¶å¸è½½æ—¶ä¹Ÿä¼šåˆ é™¤å…¨å±€æ ·å¼. å…¨å±€æ ·å¼é€šå¸¸ç”¨äºè¦†ç›–ä¸€äº›ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> GlobalStyle = createGlobalStyle<span class="string">`</span></span><br><span class="line"><span class="string">  body &#123;</span></span><br><span class="line"><span class="string">    color: <span class="subst">$&#123;props =&gt; (props.whiteColor ? 'white' : 'black')&#125;</span>;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line">&lt;React.Fragment&gt;</span><br><span class="line">  &lt;GlobalStyle whiteColor /&gt;</span><br><span class="line">  &lt;Navigation /&gt; &#123;<span class="comment">/* example of other top-level stuff */</span>&#125;</span><br><span class="line">&lt;<span class="regexp">/React.Fragment&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="7-theme-æœºåˆ¶åŠ-theme-å¯¹è±¡çš„è®¾è®¡"><a href="#7-theme-æœºåˆ¶åŠ-theme-å¯¹è±¡çš„è®¾è®¡" class="headerlink" title="7. Theme æœºåˆ¶åŠ Theme å¯¹è±¡çš„è®¾è®¡"></a>7. Theme æœºåˆ¶åŠ Theme å¯¹è±¡çš„è®¾è®¡</h4><p>styled-components çš„ <a href="https://www.styled-components.com/docs/advanced#theming" target="_blank" rel="noopener">ThemeProvider</a> å¯ä»¥ç”¨äºå–ä»£ SCSS çš„å˜é‡æœºåˆ¶, åªä¸è¿‡å®ƒæ›´åŠ çµæ´», å¯ä»¥è¢«æ‰€æœ‰ä¸‹çº§ç»„ä»¶å…±äº«, å¹¶åŠ¨æ€å˜åŒ–.</p><p>å…³äº Theme å¯¹è±¡çš„è®¾è®¡æˆ‘è§‰å¾—å¯ä»¥å‚è€ƒä¼ ç»Ÿçš„ UI æ¡†æ¶, ä¾‹å¦‚<a href="https://github.com/zurb/foundation-sites/tree/develop/scss" target="_blank" rel="noopener">Foundation</a>æˆ–è€…<a href="https://github.com/twbs/bootstrap/tree/master/scss" target="_blank" rel="noopener">Bootstrap</a>, ç»è¿‡å¤šå¹´çš„è¿­ä»£å®ƒä»¬ä»£ç ç»„ç»‡éå¸¸å¥½, éå¸¸å€¼å¾—å­¦ä¹ . ä»¥ Bootstrap çš„é¡¹ç›®ç»“æ„ä¸ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ _alert.scss</span><br><span class="line">â”œâ”€â”€ ...                # å®šä¹‰å„ç§ç»„ä»¶çš„æ ·å¼</span><br><span class="line">â”œâ”€â”€ _print.scss        # æ‰“å°æ ·å¼é€‚é…</span><br><span class="line">â”œâ”€â”€ _root.scss         # ğŸ”´æ ¹æ ·å¼, å³å…¨å±€æ ·å¼</span><br><span class="line">â”œâ”€â”€ _transitions.scss  # è¿‡æ¸¡æ•ˆæœ</span><br><span class="line">â”œâ”€â”€ _type.scss         # ğŸ”´åŸºæœ¬æ’ç‰ˆæ ·å¼</span><br><span class="line">â”œâ”€â”€ _reboot.scss       # ğŸ”´æµè§ˆå™¨é‡ç½®æ ·å¼, ç±»ä¼¼äºnormalize.css</span><br><span class="line">â”œâ”€â”€ _functions.scss</span><br><span class="line">â”œâ”€â”€ _mixins.scss</span><br><span class="line">â”œâ”€â”€ _utilities.scss</span><br><span class="line">â”œâ”€â”€ _variables.scss    # ğŸ”´å˜é‡é…ç½®, åŒ…å«å…¨å±€é…ç½®å’Œæ‰€æœ‰ç»„ä»¶é…ç½®</span><br><span class="line">â”œâ”€â”€ bootstrap-grid.scss</span><br><span class="line">â”œâ”€â”€ bootstrap-reboot.scss</span><br><span class="line">â”œâ”€â”€ bootstrap.scss</span><br><span class="line">â”œâ”€â”€ mixins             # å„ç§mixin, å¯å¤ç”¨çš„cssä»£ç </span><br><span class="line">â”œâ”€â”€ utilities          # å„ç§å·¥å…·æ–¹æ³•</span><br><span class="line">â””â”€â”€ vendor</span><br><span class="line">    â””â”€â”€ _rfs.scss</span><br></pre></td></tr></table></figure><p><a href="https://github.com/twbs/bootstrap/blob/master/scss/_variables.scss" target="_blank" rel="noopener"><code>_variables.scss</code></a>åŒ…å«äº†ä»¥ä¸‹é…ç½®:</p><ul><li>é¢œè‰²ç³»ç»Ÿ: è°ƒè‰²ç›˜é…ç½®<ul><li>ç°é˜¶é¢œè‰²: æä¾›ç™½è‰²åˆ°é»‘è‰²ä¹‹é—´å¤šä¸ªçº§åˆ«çš„ç°é˜¶é¢œè‰². ä¾‹å¦‚<br><img src="/images/04/gray-scale.png" width="300"></li><li>è¯­ä¹‰é¢œè‰²: æ ¹æ® UI ä¸Šé¢çš„è¯­ä¹‰, å®šä¹‰å„ç§é¢œè‰². è¿™ä¸ªä¹Ÿæ˜¯ CSS å¼€å‘çš„å¸¸è§æ¨¡å¼<br><img src="/images/04/sem-color.png" width="300"></li></ul></li><li>å°ºå¯¸ç³»ç»Ÿ: å¤šä¸ªçº§åˆ«çš„é—´è·, å°ºå¯¸å¤§å°é…ç½®</li><li>é…ç½®å¼€å…³: å…¨å±€æ€§çš„é…ç½®å¼€å…³, ä¾‹å¦‚æ˜¯å¦æ”¯æŒåœ†è§’, é˜´å½±</li><li>é“¾æ¥æ ·å¼é…ç½®: å¦‚é¢œè‰², æ¿€æ´»çŠ¶æ€, decoration</li><li>æ’ç‰ˆ: å­—ä½“, å­—ä½“å¤§å°, font-weight, è¡Œé«˜, è¾¹æ¡†, æ ‡é¢˜ç­‰åŸºæœ¬æ’ç‰ˆé…ç½®</li><li>ç½‘æ ¼ç³»ç»Ÿæ–­ç‚¹é…ç½®</li></ul><p>bootstrap å°†è¿™äº›é…ç½®é¡¹æœ‰å¾ˆé«˜çš„å‚è€ƒæ„ä¹‰. ç»„ä»¶å¯ä»¥è®¤ä¸ºæ˜¯ UI è®¾è®¡å¸ˆ çš„äº§å‡º, å¦‚æœä½ çš„åº”ç”¨æœ‰ç»Ÿä¸€å’Œè§„èŒƒçš„è®¾è®¡è¯­è¨€(å‚è€ƒ<a href="https://ant.design/docs/spec/values-cn" target="_blank" rel="noopener">antd</a>), è¿™äº›é…ç½®ä¼šå¾ˆæœ‰æ„ä¹‰ã€‚æ ·å¼å¯é…ç½®åŒ–å¯ä»¥è®©ä½ çš„ä»£ç æ›´çµæ´», æ›´ç¨³å®š, å¯å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§æ›´é«˜. ä¸ç®¡å¯¹äº UI è®¾è®¡è¿˜æ˜¯å®¢æˆ·ç«¯å¼€å‘, è®¾è®¡è§„èŒƒå¯ä»¥æé«˜å›¢é˜Ÿå·¥ä½œæ•ˆç‡, å‡å°‘æ²Ÿé€šæˆæœ¬.</p><p>styled-components çš„ Theme ä½¿ç”¨çš„æ˜¯<code>React Context</code> API, å®˜æ–¹æ–‡æ¡£æœ‰è¯¦å°½çš„æè¿°, è¿™é‡Œå°±ä¸å±•å¼€äº†. ç‚¹å‡»è¿™é‡Œ<a href="https://www.styled-components.com/docs/advanced#theming" target="_blank" rel="noopener">äº†è§£æ›´å¤š</a>, å¦å¤–åœ¨<a href="https://www.styled-components.com/docs/api#typescript" target="_blank" rel="noopener">è¿™é‡Œ</a>äº†è§£å¦‚ä½•åœ¨ Typescript ä¸­å£°æ˜ theme ç±»å‹</p><p><br></p><h4 id="8-æå‡å¼€å‘ä½“éªŒ"><a href="#8-æå‡å¼€å‘ä½“éªŒ" class="headerlink" title="8. æå‡å¼€å‘ä½“éªŒ"></a>8. æå‡å¼€å‘ä½“éªŒ</h4><p>å¯ä»¥ä½¿ç”¨<code>babel-plugin-styled-components</code>æˆ–<a href="https://babeljs.io/blog/2017/09/11/zero-config-with-babel-macros" target="_blank" rel="noopener"><code>babel macro</code></a>æ¥æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ã€ æ ·å¼å‹ç¼©å’Œæå‡ debug ä½“éªŒ. æ¨èä½¿ç”¨ macro å½¢å¼, æ— éœ€å®‰è£…å’Œé…ç½® babel æ’ä»¶. åœ¨ create-react-app ä¸­å·²å†…ç½®æ”¯æŒ:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> styled, &#123; createGlobalStyle &#125; <span class="keyword">from</span> <span class="string">'styled-components/macro'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Thing = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  color: red;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p>è¯¦è§<a href="https://www.styled-components.com/docs/tooling#babel-macro" target="_blank" rel="noopener">Tooling</a></p><p><br></p><h4 id="9-äº†è§£-styled-components-çš„å±€é™æ€§"><a href="#9-äº†è§£-styled-components-çš„å±€é™æ€§" class="headerlink" title="9. äº†è§£ styled-components çš„å±€é™æ€§"></a>9. äº†è§£ styled-components çš„å±€é™æ€§</h4><p>æ¯”è¾ƒèƒ½æƒ³åˆ°çš„å±€é™æ€§æ˜¯æ€§èƒ½é—®é¢˜:</p><ol><li>css-in-js: éœ€è¦ä¸€ä¸ª JS è¿è¡Œæ—¶, ä¼šå¢åŠ  js åŒ…ä½“ç§¯(å¤§çº¦ 15KB)</li><li>ç›¸æ¯”åŸç”Ÿ CSS ä¼šæœ‰æ›´å¤šèŠ‚ç‚¹åµŒå¥—(ä¾‹å¦‚ ThemeConsumer)å’Œè®¡ç®—æ¶ˆè€—. è¿™ä¸ªå¯¹äºå¤æ‚çš„ç»„ä»¶æ ‘çš„æ¸²æŸ“å½±å“å°¤ä¸ºæ˜æ˜¾</li><li>ä¸èƒ½æŠ½å–ä¸º CSS æ–‡ä»¶, è¿™é€šå¸¸ä¸ç®—é—®é¢˜</li></ol><blockquote><p>å®˜æ–¹<a href="https://github.com/styled-components/styled-components/tree/master/packages/styled-components/benchmarks" target="_blank" rel="noopener">benchmark</a></p></blockquote><p>ä¸‹é¢æ˜¯åŸºäº v4.0 åŸºå‡†æµ‹è¯•å¯¹æ¯”å›¾, åœ¨ä¼—å¤š CSS-in-js æ–¹æ¡ˆä¸­, styled-components å¤„äºä¸­ä¸Šæ°´å¹³:</p><p><img src="/images/04/styled-benchmark.png" alt="styled-components benchmark"></p><p><br></p><h4 id="10-ä¸€äº›å¼€å‘è§„èŒƒ"><a href="#10-ä¸€äº›å¼€å‘è§„èŒƒ" class="headerlink" title="10. ä¸€äº›å¼€å‘è§„èŒƒ"></a>10. ä¸€äº›å¼€å‘è§„èŒƒ</h4><ul><li>é¿å…æ— æ„ä¹‰çš„ç»„ä»¶å. é¿å…ç±»ä¼¼<code>Div</code>, <code>Span</code>è¿™ç±»ç›´æ¥ç…§æ¬å…ƒç´ åçš„æ— æ„ä¹‰çš„ç»„ä»¶å‘½å</li></ul><p><br></p><ul><li><p>åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ styled-components ç»„ä»¶. å¯¹äºæ¯”è¾ƒç®€å•çš„ç»„ä»¶, ä¸€èˆ¬ä¼šåœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ styled-components ç»„ä»¶å°±è¡Œäº†. ä¸‹é¢æ˜¯å…¸å‹ç»„ä»¶çš„æ–‡ä»¶ç»“æ„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components/macro'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨é¡¶éƒ¨å®šä¹‰æ‰€æœ‰styled-componentsç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> Header = styled.header<span class="string">``</span>;</span><br><span class="line"><span class="keyword">const</span> Title = styled.div<span class="string">``</span>;</span><br><span class="line"><span class="keyword">const</span> StepName = styled.div<span class="string">``</span>;</span><br><span class="line"><span class="keyword">const</span> StepBars = styled.div<span class="string">``</span>;</span><br><span class="line"><span class="keyword">const</span> StepBar = styled.div&lt;&#123; active?: <span class="built_in">boolean</span> &#125;&gt;<span class="string">``</span>;</span><br><span class="line"><span class="keyword">const</span> FormContainer = styled.div<span class="string">``</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç»„ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Steps: FC&lt;StepsProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;&gt;...&lt;<span class="regexp">/&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Steps;</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œå¯¹äºæ¯”è¾ƒå¤æ‚çš„é¡µé¢ç»„ä»¶æ¥è¯´, ä¼šè®©æ–‡ä»¶å˜å¾—å¾ˆè‡ƒè‚¿, æ‰°ä¹±ç»„ä»¶çš„ä¸»ä½“, æ‰€ä»¥ç¬”è€…ä¸€èˆ¬ä¼šåƒæŠ½å–åˆ°å•ç‹¬çš„<code>styled.tsx</code>æ–‡ä»¶ä¸­:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Header, Title, StepName, StepBars, StepBar, FormContainer &#125; <span class="keyword">from</span> <span class="string">'./styled'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Steps: FC&lt;StepsProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;&gt;...&lt;<span class="regexp">/&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Steps;</span></span><br></pre></td></tr></table></figure></li></ul><p><br></p><ul><li><p>è€ƒè™‘å¯¼å‡º styled-components ç»„ä»¶, æ–¹ä¾¿ä¸Šçº§ç»„ä»¶è®¾ç½®æ ·å¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ---Foo/index.ts---</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Styled <span class="keyword">from</span> <span class="string">'./styled'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Styled &#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---Bar/index.ts----</span></span><br><span class="line"><span class="keyword">import</span> &#123; Styled &#125; <span class="keyword">from</span> <span class="string">'../Foo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  &amp; <span class="subst">$&#123;Styled.SomeComponent&#125;</span> &#123;</span></span><br><span class="line"><span class="string">    color: red;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure></li></ul><p><br></p><h4 id="11-å…¶ä»–-css-in-js-æ–¹æ¡ˆ"><a href="#11-å…¶ä»–-css-in-js-æ–¹æ¡ˆ" class="headerlink" title="11. å…¶ä»– CSS-in-js æ–¹æ¡ˆ"></a>11. å…¶ä»– CSS-in-js æ–¹æ¡ˆ</h4><ul><li>CSS-module</li><li>JSS</li><li>emotion</li><li>glamorous</li></ul><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯<a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener">CSS-module</a>, è¿™ä¹Ÿæ˜¯ç¤¾åŒºæ¯”è¾ƒæµè¡Œçš„è§£å†³æ–¹æ¡ˆ. ä¸¥æ ¼æ¥è¯´, è¿™ä¸æ˜¯ CSS-in-js. æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://zhuanlan.zhihu.com/p/20495964" target="_blank" rel="noopener">CSS Modules è¯¦è§£åŠ React ä¸­å®è·µ</a>.</p><p>ç‰¹æ€§:</p><ul><li>æ¯”è¾ƒè½»é‡, ä¸éœ€è¦ JS è¿è¡Œæ—¶, å› ä¸ºä»–åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œè®¡ç®—</li><li>æ‰€æœ‰æ ·å¼é»˜è®¤éƒ½æ˜¯ local, é€šè¿‡å¯¼å…¥æ¨¡å—æ–¹å¼å¯ä»¥å¯¼å…¥è¿™äº›ç”Ÿæˆçš„ç±»å</li><li>å¯ä»¥å’Œ CSS proprocessor é…åˆ</li><li>é‡‡ç”¨éæ ‡å‡†çš„è¯­æ³•, ä¾‹å¦‚:global, :local, :export, compose:</li></ul><p>CSS module åŒæ ·ä¹Ÿæœ‰å¤–éƒ¨æ ·å¼è¦†ç›–é—®é¢˜, æ‰€ä»¥éœ€è¦é€šè¿‡å…¶ä»–æ‰‹æ®µå¯¹å…³é”®èŠ‚ç‚¹æ·»åŠ å…¶ä»–å±æ€§(å¦‚ data-name).</p><blockquote><p>å¦‚æœä½¿ç”¨ css-module, å»ºè®®ä½¿ç”¨<code>*.module.css</code>æ¥å‘½å css æ–‡ä»¶, å’Œæ™®é€š CSS åŒºåˆ†å¼€æ¥.</p></blockquote><p>æ‰©å±•:</p><ul><li><a href="https://github.com/stereobooster/css-in-js-101" target="_blank" rel="noopener">CSS-in-JS 101: All you need to know</a></li></ul><p><br></p><hr><p><br></p><h3 id="4ï¸âƒ£-é€šç”¨çš„ç»„ä»¶åº“ä¸åº”è¯¥è€¦åˆ-css-in-js-css-module-çš„æ–¹æ¡ˆ"><a href="#4ï¸âƒ£-é€šç”¨çš„ç»„ä»¶åº“ä¸åº”è¯¥è€¦åˆ-css-in-js-css-module-çš„æ–¹æ¡ˆ" class="headerlink" title="4ï¸âƒ£ é€šç”¨çš„ç»„ä»¶åº“ä¸åº”è¯¥è€¦åˆ CSS-in-js/CSS-module çš„æ–¹æ¡ˆ"></a>4ï¸âƒ£ é€šç”¨çš„ç»„ä»¶åº“ä¸åº”è¯¥è€¦åˆ CSS-in-js/CSS-module çš„æ–¹æ¡ˆ</h3><p>å¦‚æœæ˜¯ä½œä¸ºç¬¬ä¸‰æ–¹ç»„ä»¶åº“å½¢å¼å¼€å‘, ä¸ªäººè§‰å¾—ä¸åº”è¯¥è€¦åˆå„ç§ CSS-in-js/CSS-module. ä¸èƒ½å¼ºæ±‚ä½ çš„ç»„ä»¶åº“ä½¿ç”¨è€…è€¦åˆè¿™äº›æŠ€æœ¯æ ˆ, è€Œä¸”éƒ¨åˆ†æŠ€æœ¯æ˜¯éœ€è¦æ„å»ºå·¥å…·æ”¯æŒçš„. å»ºè®®ä½¿ç”¨åŸç”Ÿ CSS æˆ–è€…å°† SCSS/Less è¿™äº›é¢„å¤„ç†å·¥å…·ä½œä¸ºå¢å¼ºæ–¹æ¡ˆ</p><p><br></p><hr><p><br></p><h3 id="5ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ-css"><a href="#5ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ-css" class="headerlink" title="5ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ CSS"></a>5ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ CSS</h3><p>ç¬”è€…çš„é¡¹ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨<code>styled-components</code>, ä½†å¯¹äºéƒ¨åˆ†æè‡´è¦æ±‚æ€§èƒ½çš„ç»„ä»¶, ä¸€èˆ¬æˆ‘ä¼šå›é€€ä½¿ç”¨åŸç”Ÿ CSS, å†é…åˆ BEM å‘½åè§„èŒƒ. è¿™ç§æœ€ç®€å•æ–¹å¼, èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚.</p><p><br></p><hr><p><br></p><h3 id="6ï¸âƒ£-é€‰æ‹©åˆé€‚è‡ªå·±å›¢é˜Ÿçš„æŠ€æœ¯æ ˆ"><a href="#6ï¸âƒ£-é€‰æ‹©åˆé€‚è‡ªå·±å›¢é˜Ÿçš„æŠ€æœ¯æ ˆ" class="headerlink" title="6ï¸âƒ£ é€‰æ‹©åˆé€‚è‡ªå·±å›¢é˜Ÿçš„æŠ€æœ¯æ ˆ"></a>6ï¸âƒ£ é€‰æ‹©åˆé€‚è‡ªå·±å›¢é˜Ÿçš„æŠ€æœ¯æ ˆ</h3><p>æ¯ä¸ªå›¢é˜Ÿçš„æƒ…å†µå’Œåå¥½ä¸ä¸€æ ·, é€‰æ‹©åˆé€‚è‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„. å…³äº CSS æ–¹é¢çš„æŠ€æœ¯æ ˆæ­é…ä¹Ÿéå¸¸å¤šæ ·:</p><p><img src="/images/04/css-determination.png" alt="css determination"></p><ul><li><strong>é€‰æ‹© CSS-in-js æ–¹æ¡ˆ</strong>:<br>ä¼˜ç‚¹: è¿™ä¸ªæ–¹æ¡ˆè§£å†³äº†å¤§éƒ¨åˆ† CSS çš„ç¼ºé™·, çµæ´», åŠ¨æ€æ€§å¼º, å­¦ä¹ æˆæœ¬æ¯”è¾ƒä½, éå¸¸é€‚åˆç»„ä»¶åŒ–çš„åœºæ™¯.<br>ç¼ºç‚¹: æ€§èƒ½ç›¸æ¯”é™æ€ CSS è¦å¼±, ä¸è¿‡è¿™ç‚¹å·²ç»æ…¢æ…¢åœ¨æ”¹å–„. å¯ä»¥è€ƒè™‘åœ¨éƒ¨åˆ†ç»„ä»¶ä½¿ç”¨åŸç”Ÿ CSS</li><li><strong>é€‰æ‹© CSS æ–¹æ¡ˆ</strong>:<ul><li><strong>é€‰æ‹©åŸç”Ÿ CSS æ–¹æ¡ˆ</strong>: è¿™ç§æ–¹æ¡ˆæœ€ç®€å•</li><li><strong>é€‰æ‹© Preprocessor</strong>: æ·»åŠ  CSS é¢„å¤„ç†å™¨, å¯ä»¥å¢å¼º CSS çš„å¯ç¼–ç¨‹æ€§: ä¾‹å¦‚æ¨¡å—åŒ–, å˜é‡, å‡½æ•°, mixin.<br>ä¼˜ç‚¹: é¢„å¤„ç†å™¨å¯ä»¥å‡å°‘ä»£ç é‡å¤, è®© CSS æ›´å¥½ç»´æŠ¤. é€‚åˆç»„ç»‡æ€§è¦æ±‚å¾ˆé«˜çš„å¤§å‹é¡¹ç›®.<br>ç¼ºç‚¹: å°±æ˜¯éœ€è¦å­¦ä¹ æˆæœ¬, æ‰€ä»¥è¿™é‡Œç¬”è€…å»ºè®®ä½¿ç”¨æ ‡å‡†çš„ cssnext æ¥ä»£æ›¿ SCSS/Less è¿™äº›æ–¹æ¡ˆ</li><li><strong>æ–¹æ³•è®º</strong>: CSS çš„å„ç§æ–¹æ³•è®ºæ—¨åœ¨æé«˜ CSS çš„ç»„ç»‡æ€§, æä¾›ä¸€äº›æ¶æ„å»ºè®®, è®© CSS æ›´å¥½ç»´æŠ¤.</li><li><strong>postcss</strong>: å¯¹ CSS è¿›è¡Œä¼˜åŒ–å¢å¼º, ä¾‹å¦‚æ·»åŠ å‚å•†å‰ç¼€</li><li><strong>css-module</strong>: éš”ç¦» CSS, æ”¯æŒæš´éœ²å˜é‡ç»™ JS, è§£å†³ CSS çš„ä¸€äº›ç¼ºé™·, è®© CSS é€‚åˆç»„ä»¶åŒ–åœºæ™¯.<br>å¯é€‰, é€šè¿‡åˆé€‚çš„å‘½åå’Œç»„ç»‡å…¶å®æ˜¯å¯ä»¥è§„é¿ CSS çš„ç¼ºé™·</li></ul></li></ul><p>ç»¼ä¸Šæ‰€è¿°, CSS-in-js å’Œ CSS æ–¹æ¡ˆå„æœ‰é€‚ç”¨åœºæ™¯. æ¯”å¦‚å¯¹äºç»„ä»¶åº“, å¦‚ antd åˆ™é€‰æ‹©äº† Preprocessor æ–¹æ¡ˆ; å¯¹äºä¸€èˆ¬åº”ç”¨ç¬”è€…å»ºè®®ä½¿ç”¨ CSS-in-js æ–¹æ¡ˆ, å®ƒå­¦ä¹ æˆæœ¬å¾ˆä½, å¹¶ä¸”<code>There&#39;s Only One Way To Do It</code> æ²¡æœ‰å¤ªå¤šå¿ƒæ™ºè´Ÿæ‹…, ä¸éœ€è¦å­¦ä¹ å†—æ‚çš„æ–¹æ³•è®º, ä»£ç ç›¸å¯¹æ¯”è¾ƒå¯æ§; å¦å¤–å®ƒè¿˜æ”¯æŒè·¨å¹³å°, åœ¨ ReactNative ä¸‹, styled-components æ˜¯æ›´å¥½çš„é€‰æ‹©. è€Œ CSS æ–¹æ¡ˆ, å¯¹äºå¤§å‹åº”ç”¨è¦åšåˆ°æœ‰ç»„ç»‡æœ‰çºªå¾‹å’Œè§„åˆ’åŒ–, éœ€è¦èŠ±è´¹è¾ƒå¤§çš„ç²¾åŠ›, å°¤å…¶æ˜¯å›¢é˜Ÿæˆå‘˜èƒ½åŠ›ä¸å‡æƒ…å†µä¸‹, å¾ˆå®¹æ˜“å¤±æ§</p><p><br></p><hr><p><br></p><h3 id="7ï¸âƒ£-ä½¿ç”¨-svgr-è½¬æ¢-svg-å›¾æ ‡"><a href="#7ï¸âƒ£-ä½¿ç”¨-svgr-è½¬æ¢-svg-å›¾æ ‡" class="headerlink" title="7ï¸âƒ£ ä½¿ç”¨ svgr è½¬æ¢ svg å›¾æ ‡"></a>7ï¸âƒ£ ä½¿ç”¨ svgr è½¬æ¢ svg å›¾æ ‡</h3><p>å¦‚ä»Š CSS-Image-Sprite æ—©å·²è¢« <a href="https://github.com/jkphl/svg-sprite" target="_blank" rel="noopener">SVG-Sprite</a> å–ä»£. è€Œåœ¨ React ç”Ÿæ€ä¸­ä½¿ç”¨<a href="https://github.com/smooth-code/svgr#webpack-usage" target="_blank" rel="noopener"><code>svgr</code></a>æ›´åŠ æ–¹ä¾¿, å®ƒå¯ä»¥å°† svg æ–‡ä»¶è½¬æ¢ä¸º React ç»„ä»¶, ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JS æ¨¡å—, å®ƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿:</p><ul><li>è½¬æ¢ä¸ºæ™®é€š JS æ–‡ä»¶, æ–¹ä¾¿ä»£ç åˆ†å‰²å’Œå¼‚æ­¥åŠ è½½</li><li>ç›¸æ¯” svg-sprite å’Œ iconfont æ–¹æ¡ˆæ›´å®¹æ˜“ç®¡ç†</li><li>svg å¯ä»¥é€šè¿‡ CSS/JS é…ç½®, å¯æ“ä½œæ€§æ›´å¼º; ç›¸æ¯” iconfont æ”¯æŒå¤šè‰²</li><li>æ”¯æŒ svgo å‹ç¼©</li></ul><p>åŸºæœ¬ç”¨æ³•:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> starUrl, &#123; ReactComponent <span class="keyword">as</span> Star &#125; <span class="keyword">from</span> <span class="string">'./star.svg'</span>;</span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;img src=&#123;starUrl&#125; alt=<span class="string">"star"</span> /&gt;</span><br><span class="line">    &lt;Star /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>äº†è§£<a href="https://www.smooth-code.com/open-source/svgr/docs/webpack/" target="_blank" rel="noopener">æ›´å¤š</a></p><blockquote><p>antd 3.9 ä¹‹åä½¿ç”¨ svg å›¾æ ‡<a href="https://ant.design/components/icon-cn/#SVG-å›¾æ ‡" target="_blank" rel="noopener">ä»£æ›¿äº† font å›¾æ ‡</a> <br><br>å¯¹æ¯”<a href="https://aotu.io/notes/2018/11/23/SVG_vs_Image_vs_iconfont/index.html" target="_blank" rel="noopener">SVG vs Image, SVG vs Iconfont</a></p></blockquote><p><br></p><hr><p><br></p><h3 id="8ï¸âƒ£-ç»“åˆä½¿ç”¨-rem-å’Œ-em-ç­‰ç›¸å¯¹å•ä½-åˆ›å»ºæ›´æœ‰å¼¹æ€§çš„ç»„ä»¶"><a href="#8ï¸âƒ£-ç»“åˆä½¿ç”¨-rem-å’Œ-em-ç­‰ç›¸å¯¹å•ä½-åˆ›å»ºæ›´æœ‰å¼¹æ€§çš„ç»„ä»¶" class="headerlink" title="8ï¸âƒ£ ç»“åˆä½¿ç”¨ rem å’Œ em ç­‰ç›¸å¯¹å•ä½, åˆ›å»ºæ›´æœ‰å¼¹æ€§çš„ç»„ä»¶"></a>8ï¸âƒ£ ç»“åˆä½¿ç”¨ rem å’Œ em ç­‰ç›¸å¯¹å•ä½, åˆ›å»ºæ›´æœ‰å¼¹æ€§çš„ç»„ä»¶</h3><p>Bootstrap v4 å…¨é¢ä½¿ç”¨ rem ä½œä¸ºåŸºæœ¬å•ä½, è¿™ä½¿å¾—æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥å“åº”æµè§ˆå™¨å­—ä½“çš„è°ƒæ•´:</p><p><img src="/images/04/bootstrap-rem.gif" alt></p><p>rem å¯ä»¥è®©æ•´ä¸ªæ–‡æ¡£å¯ä»¥å“åº” html å­—ä½“çš„å˜åŒ–, ç»å¸¸ç”¨äºç§»åŠ¨ç«¯ç­‰æ¯”ä¾‹è¿˜åŸè®¾è®¡ç¨¿, è¯¦è§<a href="https://www.zhihu.com/column/p/30413803" target="_blank" rel="noopener">Rem å¸ƒå±€çš„åŸç†è§£æ</a>. æˆ‘ä¸ªäººå¯¹äºè§‰å¾—å¼¹æ€§ç»„ä»¶æ¥è¯´æ›´é‡è¦çš„æ˜¯ em å•ä½, å°¤å…¶æ˜¯é‚£äº›æ¯”ä¾‹å›ºå®šç»„ä»¶, ä¾‹å¦‚ Button, Switch, Icon. æ¯”å¦‚æˆ‘ä¼šè¿™æ ·å®šä¹‰ svg Icon çš„æ ·å¼:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.svg-icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">fill</span>: currentColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åƒ iconfont ä¸€æ ·, å¤–éƒ¨åªéœ€è¦è®¾ç½®<code>font-size</code>å°±å¯ä»¥é…ç½® icon åˆ°åˆé€‚çš„å°ºå¯¸, é»˜è®¤åˆ™ç»§æ‰¿å½“å‰ä¸Šä¸‹æ–‡çš„å­—ä½“å¤§å°:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;MyIcon style=&#123;&#123; fontSize: 17 &#125;&#125; /&gt;</span><br></pre></td></tr></table></figure><p>em å¯ä»¥è®©<code>Switch</code>è¿™ç±»å›ºå®šæ¯”ä¾‹çš„ç»„ä»¶çš„æ ·å¼å¯ä»¥æ›´å®¹æ˜“çš„è¢«é…ç½®, å¯ä»¥é…åˆå‡½æ•°å°†pxè½¬æ¢ä¸ºem:</p><iframe src="https://codesandbox.io/embed/z67r8rpnr4?fontsize=14" title="Switch" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>æ‰©å±•:</p><ul><li><a href="https://www.sitepoint.com/understanding-and-using-rem-units-in-css/" target="_blank" rel="noopener">Understanding and Using rem Units in CSS</a></li><li><a href="https://www.zhihu.com/column/p/30413803" target="_blank" rel="noopener">Rem å¸ƒå±€çš„åŸç†è§£æ</a></li></ul><p><br></p><hr><p><br></p><h2 id="3-è§„èŒƒ"><a href="#3-è§„èŒƒ" class="headerlink" title="3. è§„èŒƒ"></a>3. è§„èŒƒ</h2><h3 id="1ï¸âƒ£-ä¿ƒè¿›å»ºç«‹ç»Ÿä¸€çš„-ui-è®¾è®¡è§„èŒƒ"><a href="#1ï¸âƒ£-ä¿ƒè¿›å»ºç«‹ç»Ÿä¸€çš„-ui-è®¾è®¡è§„èŒƒ" class="headerlink" title="1ï¸âƒ£ ä¿ƒè¿›å»ºç«‹ç»Ÿä¸€çš„ UI è®¾è®¡è§„èŒƒ"></a>1ï¸âƒ£ ä¿ƒè¿›å»ºç«‹ç»Ÿä¸€çš„ UI è®¾è®¡è§„èŒƒ</h3><p>ä¸Šæ–‡å·²ç»é˜è¿°äº† UI è®¾è®¡è§„èŒƒçš„é‡è¦æ€§, æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5b766ac56fb9a009aa154c27" target="_blank" rel="noopener">å¼€å‘å’Œè®¾è®¡æ²Ÿé€šæœ‰å¤šéš¾ï¼Ÿ - ä½ åªå·®ä¸€ä¸ªè®¾è®¡è§„èŒƒ</a>. ç®€å•æ€»ç»“ä¸€ä¸‹:</p><ul><li>æä¾›å›¢é˜Ÿåä½œæ•ˆç‡</li><li>æé«˜ç»„ä»¶çš„å¤ç”¨ç‡. ç»Ÿä¸€çš„ç»„ä»¶è§„èŒƒå¯ä»¥è®©ç»„ä»¶æ›´å¥½ç®¡ç†</li><li>ä¿æŒäº§å“è¿­ä»£è¿‡ç¨‹ä¸­å“ç‰Œä¸€è‡´æ€§</li></ul><h3 id="2ï¸âƒ£-css-ç¼–å†™è§„èŒƒ"><a href="#2ï¸âƒ£-css-ç¼–å†™è§„èŒƒ" class="headerlink" title="2ï¸âƒ£ CSS ç¼–å†™è§„èŒƒ"></a>2ï¸âƒ£ CSS ç¼–å†™è§„èŒƒ</h3><p>å¯ä»¥å‚è€ƒä»¥ä¸‹è§„èŒƒ:</p><ul><li><a href="https://codeguide.bootcss.com" target="_blank" rel="noopener">ç¼–ç è§„èŒƒ by @mdo</a> bootstrap ä½¿ç”¨çš„è§„èŒƒ</li><li><a href="https://github.com/airbnb/css" target="_blank" rel="noopener">Airbnb CSS/Sass styleguide</a></li><li><a href="https://guide.aotu.io/docs/css/code.html#CSS3æµè§ˆå™¨ç§æœ‰å‰ç¼€å†™æ³•" target="_blank" rel="noopener">Aotu å®éªŒå®¤ä»£ç è§„èŒƒ</a></li><li><a href="https://github.com/fex-team/styleguide/blob/master/css.md" target="_blank" rel="noopener">FEX-Team ç¼–ç è§„èŒƒ</a></li></ul><h3 id="3ï¸âƒ£-ä½¿ç”¨stylelintè¿›è¡Œæ ·å¼è§„èŒƒæ£€æŸ¥"><a href="#3ï¸âƒ£-ä½¿ç”¨stylelintè¿›è¡Œæ ·å¼è§„èŒƒæ£€æŸ¥" class="headerlink" title="3ï¸âƒ£ ä½¿ç”¨stylelintè¿›è¡Œæ ·å¼è§„èŒƒæ£€æŸ¥"></a>3ï¸âƒ£ ä½¿ç”¨stylelintè¿›è¡Œæ ·å¼è§„èŒƒæ£€æŸ¥</h3><p><br></p><hr><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://reactjs.org/docs/faq-styling.html" target="_blank" rel="noopener">Styling and CSS</a></li><li><a href="https://medium.com/@gajus/stop-using-css-in-javascript-for-web-development-fa32fb873dcc" target="_blank" rel="noopener">Stop using CSS in JavaScript for web development</a></li><li><a href="https://zhuanlan.zhihu.com/p/26878157" target="_blank" rel="noopener">ç²¾è¯»ã€Šè¯·åœæ­¢ css-in-js çš„è¡Œä¸ºã€‹</a></li><li><a href="https://github.com/MicheleBertoli/css-in-js" target="_blank" rel="noopener">MicheleBertoli/css-in-js</a></li><li><a href="https://www.javascriptstuff.com/how-to-style-react/" target="_blank" rel="noopener">What to use for React styling?</a></li><li><a href="https://www.styled-components.com/docs/faqs" target="_blank" rel="noopener">styled-components FAQ</a></li><li><a href="https://medium.com/ansarada-thinking/styled-components-v4-the-good-the-bad-and-something-completely-different-e891139e0138" target="_blank" rel="noopener">Styled components V4: the good, the bad, and something completely different</a></li><li><a href="https://reactarmory.com/answers/should-i-use-css-in-js" target="_blank" rel="noopener">Should I use CSS-in-JS?</a></li><li><a href="http://qinsman.com/1606_uispec/" target="_blank" rel="noopener">èŠèŠ UI è®¾è®¡è§„èŒƒï¼šç§»åŠ¨ç«¯ã€H5 ä¸ Web ç«¯</a></li><li><a href="https://juejin.im/post/5b768e18e51d45565d23e52c" target="_blank" rel="noopener">å¼€å‘ä¹Ÿèƒ½æ„å»º UI ç»„ä»¶è®¾è®¡è§„èŒƒ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CSS æ˜¯å‰ç«¯å¼€å‘çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å®Œç¾ï¼Œæœ¬æ–‡ä¸»è¦æ¢è®¨ React æ ·å¼ç®¡ç†æ–¹é¢çš„ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œç›®çš„æ˜¯å®ç°æ ·å¼çš„é«˜åº¦å¯å®šåˆ¶åŒ–, è®©å¤§å‹é¡¹ç›®çš„æ ·å¼ä»£ç æ›´å®¹æ˜“ç»´æŠ¤.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç³»åˆ—ç›®å½•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“02 - ç»„ä»¶çš„ç»„ç»‡</title>
    <link href="https://bobi.ink/2019/05/11/react-component-design-02/"/>
    <id>https://bobi.ink/2019/05/11/react-component-design-02/</id>
    <published>2019-05-10T16:00:00.000Z</published>
    <updated>2019-05-15T01:12:31.303Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªå¤æ‚çš„åº”ç”¨éƒ½æ˜¯ç”±ç®€å•çš„åº”ç”¨å‘å±•è€Œæ¥çš„, éšç€è¶Šæ¥è¶Šå¤šçš„åŠŸèƒ½åŠ å…¥é¡¹ç›®, ä»£ç å°±ä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥æ§åˆ¶. æœ¬æ–‡ç« ä¸»è¦æ¢è®¨åœ¨å¤§å‹é¡¹ç›®ä¸­å¦‚ä½•å¯¹ç»„ä»¶è¿›è¡Œç»„ç»‡, è®©é¡¹ç›®å…·å¤‡å¯ç»´æŠ¤æ€§.</p><p><strong>ç³»åˆ—ç›®å½•</strong></p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li>05 çŠ¶æ€ç®¡ç† å¾…æ›´æ–°</li></ul><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#1-ç»„ä»¶è®¾è®¡çš„åŸºæœ¬åŸåˆ™">1. ç»„ä»¶è®¾è®¡çš„åŸºæœ¬åŸåˆ™</a><ul><li><a href="#åŸºæœ¬åŸåˆ™"><strong>åŸºæœ¬åŸåˆ™</strong></a></li><li><a href="#é«˜è´¨é‡ç»„ä»¶çš„ç‰¹å¾"><strong>é«˜è´¨é‡ç»„ä»¶çš„ç‰¹å¾</strong></a></li></ul></li><li><a href="#2-åŸºæœ¬æŠ€å·§">2. åŸºæœ¬æŠ€å·§</a></li><li><a href="#3-ç»„ä»¶çš„åˆ†ç±»">3. ç»„ä»¶çš„åˆ†ç±»</a><ul><li><a href="#1ï¸âƒ£-å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»">1ï¸âƒ£ <strong>å®¹å™¨ç»„ä»¶</strong>å’Œ<strong>å±•ç¤ºç»„ä»¶</strong>åˆ†ç¦»</a></li><li><a href="#2ï¸âƒ£-åˆ†ç¦»é€»è¾‘å’Œè§†å›¾">2ï¸âƒ£ åˆ†ç¦»é€»è¾‘å’Œè§†å›¾</a></li><li><a href="#3ï¸âƒ£-æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶">3ï¸âƒ£ æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶</a></li><li><a href="#4ï¸âƒ£-çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶">4ï¸âƒ£ çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶</a></li><li><a href="#5ï¸âƒ£-æŒ‰ç…§-ui-åˆ’åˆ†ä¸ºå¸ƒå±€ç»„ä»¶å’Œå†…å®¹ç»„ä»¶">5ï¸âƒ£ æŒ‰ç…§ UI åˆ’åˆ†ä¸º<code>å¸ƒå±€ç»„ä»¶</code>å’Œ<code>å†…å®¹ç»„ä»¶</code></a></li><li><a href="#6ï¸âƒ£-æ¥å£ä¸€è‡´çš„æ•°æ®å½•å…¥ç»„ä»¶">6ï¸âƒ£ æ¥å£ä¸€è‡´çš„æ•°æ®å½•å…¥ç»„ä»¶</a></li></ul></li><li><a href="#4-ç›®å½•åˆ’åˆ†">4. ç›®å½•åˆ’åˆ†</a><ul><li><a href="#1ï¸âƒ£-åŸºæœ¬ç›®å½•ç»“æ„">1ï¸âƒ£ åŸºæœ¬ç›®å½•ç»“æ„</a></li><li><a href="#2ï¸âƒ£-å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†">2ï¸âƒ£ å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†</a></li><li><a href="#3ï¸âƒ£-å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†-monorepo-æ¨¡å¼">3ï¸âƒ£ å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†: monorepo æ¨¡å¼</a></li><li><a href="#4ï¸âƒ£-è·¨å¹³å°åº”ç”¨">4ï¸âƒ£ è·¨å¹³å°åº”ç”¨</a></li><li><a href="#5ï¸âƒ£-è·¨å¹³å°çš„å¦å¤–ä¸€ç§æ–¹å¼-taro">5ï¸âƒ£ è·¨å¹³å°çš„å¦å¤–ä¸€ç§æ–¹å¼: taro</a></li></ul></li><li><a href="#5-æ¨¡å—">5. æ¨¡å—</a><ul><li><a href="#1ï¸âƒ£-åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œ">1ï¸âƒ£ åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œ</a></li><li><a href="#2ï¸âƒ£-named-export-vs-default-export">2ï¸âƒ£ <code>Named export</code> vs <code>default export</code></a></li><li><a href="#3ï¸âƒ£-é¿å…å¾ªç¯ä¾èµ–">3ï¸âƒ£ é¿å…å¾ªç¯ä¾èµ–</a></li><li><a href="#4ï¸âƒ£-ç›¸å¯¹è·¯å¾„ä¸è¦è¶…è¿‡ä¸¤çº§">4ï¸âƒ£ ç›¸å¯¹è·¯å¾„ä¸è¦è¶…è¿‡ä¸¤çº§</a></li></ul></li><li><a href="#6-æ‹†åˆ†">6. æ‹†åˆ†</a><ul><li><a href="#1ï¸âƒ£-æ‹†åˆ†-render-æ–¹æ³•">1ï¸âƒ£ æ‹†åˆ† render æ–¹æ³•</a></li><li><a href="#2ï¸âƒ£-æ‹†åˆ†ä¸ºç»„ä»¶">2ï¸âƒ£ æ‹†åˆ†ä¸ºç»„ä»¶</a></li></ul></li><li><a href="#7-ç»„ä»¶åˆ’åˆ†ç¤ºä¾‹">7. ç»„ä»¶åˆ’åˆ†ç¤ºä¾‹</a><ul><li><a href="#1ï¸âƒ£-åˆ’åˆ†é¡µé¢">1ï¸âƒ£ åˆ’åˆ†é¡µé¢</a></li><li><a href="#2ï¸âƒ£-åˆ’åˆ†åŸºç¡€-ui-ç»„ä»¶">2ï¸âƒ£ åˆ’åˆ†åŸºç¡€ UI ç»„ä»¶</a></li><li><a href="#3ï¸âƒ£-è®¾è®¡ç»„ä»¶çš„çŠ¶æ€">3ï¸âƒ£ è®¾è®¡ç»„ä»¶çš„çŠ¶æ€</a></li></ul></li><li><a href="#8-æ–‡æ¡£">8. æ–‡æ¡£</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="1-ç»„ä»¶è®¾è®¡çš„åŸºæœ¬åŸåˆ™"><a href="#1-ç»„ä»¶è®¾è®¡çš„åŸºæœ¬åŸåˆ™" class="headerlink" title="1. ç»„ä»¶è®¾è®¡çš„åŸºæœ¬åŸåˆ™"></a>1. ç»„ä»¶è®¾è®¡çš„åŸºæœ¬åŸåˆ™</h2><h3 id="åŸºæœ¬åŸåˆ™"><a href="#åŸºæœ¬åŸåˆ™" class="headerlink" title="åŸºæœ¬åŸåˆ™"></a><strong>åŸºæœ¬åŸåˆ™</strong></h3><p><strong>å•ä¸€èŒè´£(Single Responsibility Principle)</strong>. è¿™åŸæœ¬æ¥æºäºé¢å‘å¯¹è±¡ç¼–ç¨‹, è§„èŒƒå®šä¹‰æ˜¯â€ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå‘ç”Ÿå˜åŒ–çš„åŸå› â€, ç™½è¯è¯´â€ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹æƒ…â€. ä¸ç®¡æ˜¯ä»€ä¹ˆç¼–ç¨‹èŒƒå¼, åªè¦æ˜¯æ¨¡å—åŒ–çš„ç¨‹åºè®¾è®¡éƒ½é€‚ç”¨å•ä¸€èŒè´£åŸåˆ™. åœ¨ React ä¸­, ç»„ä»¶å°±æ˜¯æ¨¡å—.</p><p>å•ä¸€èŒè´£è¦æ±‚å°†ç»„ä»¶é™åˆ¶åœ¨ä¸€ä¸ªâ€™åˆé€‚â€™çš„ç²’åº¦. è¿™ä¸ªç²’åº¦æ˜¯æ¯”è¾ƒä¸»è§‚çš„æ¦‚å¿µ, æ¢å¥è¯è¯´â€™å•ä¸€â€™æ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ¦‚å¿µ. æˆ‘ä¸ªäººè§‰å¾—å•ä¸€èŒè´£å¹¶ä¸æ˜¯è¿½æ±‚èŒè´£ç²’åº¦çš„â€™æœ€å°â€™åŒ–, ç²’åº¦æœ€å°åŒ–æ˜¯ä¸€ä¸ªæç«¯, å¯èƒ½ä¼šå¯¼è‡´å¤§é‡æ¨¡å—, æ¨¡å—ç¦»æ•£åŒ–ä¹Ÿä¼šè®©é¡¹ç›®å˜å¾—éš¾ä»¥ç®¡ç†. <strong>å•ä¸€èŒè´£è¦æ±‚çš„æ˜¯ä¸€ä¸ªé€‚åˆè¢«å¤ç”¨çš„ç²’åº¦</strong>.</p><p>å¾€å¾€ä¸€å¼€å§‹æˆ‘ä»¬è®¾è®¡çš„ç»„ä»¶éƒ½å¯èƒ½å¤åˆå¤šä¸ªèŒè´£, åæ¥å‡ºç°äº†ä»£ç é‡å¤æˆ–è€…æ¨¡å—è¾¹ç•Œè¢«æ‰“ç ´(æ¯”å¦‚ä¸€ä¸ªæ¨¡å—ä¾èµ–å¦ä¸€ä¸ªæ¨¡å—çš„â€™ç»†èŠ‚â€™), æˆ‘ä»¬æ‰ä¼šæƒ°æ€§å°†å¯å¤ç”¨çš„ä»£ç æŠ½ç¦». éšç€è¶Šæ¥è¶Šå¤šçš„é‡æ„å’Œè¿­ä»£, æ¨¡å—èŒè´£å¯èƒ½ä¼šè¶Šæ¥è¶Šè¶‹äºâ€™å•ä¸€â€™(ğŸ˜‚ çœ‹è°, ä¹Ÿå¯èƒ½å˜æˆé¢æ¡).</p><p>å½“ç„¶æœ‰ç»éªŒçš„å¼€å‘è€…å¯ä»¥ä¸€å¼€å§‹å°±èƒ½è€ƒè™‘ç»„ä»¶çš„å„ç§åº”ç”¨åœºæ™¯, å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡å—çš„é‡åˆè¾¹ç•Œ. <strong>å¯¹äºå…¥é—¨è€…æ¥è¯´<a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank" rel="noopener"><code>Don&#39;t repeat yourself</code></a>åŸåˆ™æ›´æœ‰ç”¨, ä¸è¦å·æ‡’/å¤šæ€è€ƒ/é‡æ„/æ¶ˆé™¤é‡å¤ä»£ç , ä½ çš„èƒ½åŠ›å°±ä¼šæ…¢æ…¢æå‡</strong></p><p>å•ä¸€èŒè´£çš„æ”¶ç›Š:</p><ul><li>é™ä½ç»„ä»¶çš„å¤æ‚åº¦. èŒè´£å•ä¸€ç»„ä»¶ä»£ç é‡å°‘, å®¹æ˜“è¢«ç†è§£, å¯è¯»æ€§é«˜</li><li>é™ä½å¯¹å…¶ä»–ç»„ä»¶çš„è€¦åˆ. å½“å˜æ›´åˆ°æ¥æ—¶å¯ä»¥é™ä½å¯¹å…¶ä»–åŠŸèƒ½çš„å½±å“, ä¸è‡³äºç‰µä¸€å‘è€ŒåŠ¨å…¨èº«</li><li>æé«˜å¯å¤ç”¨æ€§. åŠŸèƒ½è¶Šå•ä¸€å¯å¤ç”¨æ€§è¶Šé«˜, å°±æ¯”å¦‚ä¸€äº›åŸºç¡€ç»„ä»¶</li></ul><p><br></p><h3 id="é«˜è´¨é‡ç»„ä»¶çš„ç‰¹å¾"><a href="#é«˜è´¨é‡ç»„ä»¶çš„ç‰¹å¾" class="headerlink" title="é«˜è´¨é‡ç»„ä»¶çš„ç‰¹å¾"></a><strong>é«˜è´¨é‡ç»„ä»¶çš„ç‰¹å¾</strong></h3><p><strong>ä¸€ä¸ªé«˜è´¨é‡çš„ç»„ä»¶ä¸€å®šæ˜¯<code>é«˜å†…èš, ä½è€¦åˆ</code>çš„</strong>, è¿™ä¸¤ä¸ªåŸåˆ™æˆ–è€…ç‰¹å¾æ˜¯ç»„ä»¶ç‹¬ç«‹æ€§çš„ä¸€ä¸ªåˆ¤æ–­æ ‡å‡†.</p><p><strong>é«˜å†…èš</strong>, è¦æ±‚ä¸€ä¸ªç»„ä»¶æœ‰ä¸€ä¸ªæ˜ç¡®çš„ç»„ä»¶è¾¹ç•Œ, å°†ç´§å¯†ç›¸å…³çš„å†…å®¹èšé›†åœ¨ä¸€ä¸ªç»„ä»¶ä¸‹, å®ç°â€ä¸“ä¸€â€çš„åŠŸèƒ½. å’Œä¼ ç»Ÿçš„å‰ç«¯ç¼–ç¨‹ä¸ä¸€æ ·, ä¸€ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ª<strong>è‡ªåŒ…å«</strong>çš„å•å…ƒ, å®ƒåŒ…å«äº†é€»è¾‘/æ ·å¼/ç»“æ„, ç”šè‡³æ˜¯ä¾èµ–çš„é™æ€èµ„æº. è¿™ä¹Ÿä½¿å¾—ç»„ä»¶å¤©ç„¶å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‹¬ç«‹çš„ä¸ªä½“. å½“ç„¶è¿™ç§ç‹¬ç«‹æ€§æ˜¯ç›¸å¯¹çš„, ä¸ºäº†æœ€å¤§åŒ–è¿™ç§ç‹¬ç«‹æ€§, éœ€è¦æ ¹æ®<strong>å•ä¸€èŒè´£</strong>å°†ç»„ä»¶æ‹†åˆ†ä¸ºæ›´å°ç²’åº¦çš„ç»„ä»¶, è¿™æ ·å¯ä»¥è¢«æ›´çµæ´»çš„ç»„åˆå’Œå¤ç”¨.</p><p>è™½ç„¶ç»„ä»¶æ˜¯ç‹¬ç«‹çš„, ä½†æ˜¯ä»–éœ€è¦å’Œå…¶ä»–ç»„ä»¶è¿›è¡Œç»„åˆæ‰èƒ½å®ç°åº”ç”¨, è¿™å°±æœ‰äº†â€™å…³è”â€™. <strong>ä½è€¦åˆ</strong>è¦æ±‚æœ€å°åŒ–è¿™ç§å…³è”æ€§, æ¯”å¦‚æ˜ç¡®æ¨¡å—è¾¹ç•Œä¸åº”è¯¥è®¿é—®å…¶ä»–ç»„ä»¶çš„å†…éƒ¨ç»†èŠ‚, ç»„ä»¶çš„æ¥å£æœ€å°åŒ–, å•å‘æ•°æ®æµç­‰ç­‰</p><p>æ–‡ç« åç»­å†…å®¹ä¸»è¦è®¨è®ºå®ç°<em>é«˜å†…èš/ä½è€¦åˆ</em>ä¸»è¦æªæ–½</p><p><br></p><hr><p><br></p><h2 id="2-åŸºæœ¬æŠ€å·§"><a href="#2-åŸºæœ¬æŠ€å·§" class="headerlink" title="2. åŸºæœ¬æŠ€å·§"></a>2. åŸºæœ¬æŠ€å·§</h2><p>è¿™äº›æŠ€å·§æ¥æºäº<a href="https://vasanthk.gitbooks.io/react-bits/ux-variations/" target="_blank" rel="noopener">react-bits</a>:</p><ul><li>å¦‚æœç»„ä»¶ä¸éœ€è¦çŠ¶æ€, åˆ™ä½¿ç”¨<strong>æ— çŠ¶æ€ç»„ä»¶</strong></li><li>æ€§èƒ½ä¸Šæ¯”è¾ƒ: <strong>æ— çŠ¶æ€å‡½æ•° &gt; æœ‰çŠ¶æ€å‡½æ•° &gt; class ç»„ä»¶</strong></li><li>æœ€å°åŒ– props(æ¥å£). ä¸è¦ä¼ é€’è¶…è¿‡è¦æ±‚çš„ props</li><li>å¦‚æœç»„ä»¶å†…éƒ¨å­˜åœ¨è¾ƒå¤šæ¡ä»¶æ§åˆ¶æµ, è¿™é€šå¸¸æ„å‘³ç€éœ€è¦å¯¹ç»„ä»¶è¿›è¡ŒæŠ½å–</li><li>ä¸è¦è¿‡æ—©ä¼˜åŒ–. åªè¦æ±‚ç»„ä»¶åœ¨å½“å‰éœ€æ±‚ä¸‹å¯è¢«å¤ç”¨, ç„¶åâ€™éšæœºåº”å˜â€™</li></ul><p><br></p><hr><p><br></p><h2 id="3-ç»„ä»¶çš„åˆ†ç±»"><a href="#3-ç»„ä»¶çš„åˆ†ç±»" class="headerlink" title="3. ç»„ä»¶çš„åˆ†ç±»"></a>3. ç»„ä»¶çš„åˆ†ç±»</h2><h3 id="1ï¸âƒ£-å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»"><a href="#1ï¸âƒ£-å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»" class="headerlink" title="1ï¸âƒ£ å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»"></a>1ï¸âƒ£ <strong>å®¹å™¨ç»„ä»¶</strong>å’Œ<strong>å±•ç¤ºç»„ä»¶</strong>åˆ†ç¦»</h3><p><em>å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»</em>æ˜¯ React å¼€å‘çš„é‡è¦æ€æƒ³, å®ƒå½±å“çš„ React åº”ç”¨é¡¹ç›®çš„ç»„ç»‡å’Œæ¶æ„. ä¸‹é¢æ€»ç»“ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«:</p><p><br></p><table><thead><tr><th></th><th>å®¹å™¨ç»„ä»¶</th><th>å±•ç¤ºç»„ä»¶</th></tr></thead><tbody><tr><td>å…³æ³¨ç‚¹</td><td>ä¸šåŠ¡</td><td>UI</td></tr><tr><td>æ•°æ®æº</td><td>çŠ¶æ€ç®¡ç†å™¨/åç«¯</td><td>props</td></tr><tr><td>ç»„ä»¶å½¢å¼</td><td>é«˜é˜¶ç»„ä»¶</td><td>æ™®é€šç»„ä»¶</td></tr></tbody></table><p><br></p><ul><li><p><strong>å±•ç¤ºç»„ä»¶</strong>æ˜¯ä¸€ä¸ªåªå…³æ³¨å±•ç¤ºçš„â€™å…ƒä»¶â€™, ä¸ºäº†å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹è¢«å¤ç”¨, å®ƒä¸åº”è¯¥è€¦åˆâ€™ä¸šåŠ¡/åŠŸèƒ½â€™, æˆ–è€…è¯´ä¸åº”è¯¥è¿‡æ¸¡è€¦åˆ. åƒ<code>antd</code>è¿™ç±»ç»„ä»¶åº“æä¾›é€šç”¨ç»„ä»¶æ˜¾ç„¶å°±æ˜¯â€™å±•ç¤ºç»„ä»¶â€™</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åº”ç”¨ç›®å½•ç»“æ„, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<strong>å±•ç¤ºç»„ä»¶ä¸ä¸šåŠ¡/åŠŸèƒ½æ˜¯å¯èƒ½æœ‰ä¸åŒçš„è€¦åˆç¨‹åº¦çš„, å’Œä¸šåŠ¡çš„è€¦åˆç¨‹åº¦è¶Šä½, é€šç”¨æ€§/å¯å¤ç”¨æ€§è¶Šå¼º</strong>:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node_modules/antd/     ğŸ”´ é€šç”¨çš„ç»„ä»¶åº“, ä¸èƒ½å’Œä»»ä½•é¡¹ç›®çš„ä¸šåŠ¡è€¦åˆ</span><br><span class="line">src/</span><br><span class="line">  components/          ğŸ”´ é¡¹ç›®é€šç”¨çš„ç»„ä»¶åº“, å¯ä»¥è¢«å¤šä¸ªå®¹å™¨/é¡µé¢ç»„ä»¶å…±äº«</span><br><span class="line">  containers/</span><br><span class="line">    Foo/</span><br><span class="line">      components/      ğŸ”´ å®¹å™¨/é¡µé¢ç»„ä»¶ç‰¹æœ‰çš„ç»„ä»¶åº“, å’Œä¸€ä¸ªä¸šåŠ¡/åŠŸèƒ½æ·±åº¦è€¦åˆ. ä»¥è‡´äºä¸èƒ½è¢«å…¶ä»–å®¹å™¨ç»„ä»¶å…±äº«</span><br><span class="line">      index.tsx</span><br><span class="line">    Bar/</span><br><span class="line">      components/</span><br><span class="line">      index.tsx</span><br></pre></td></tr></table></figure><p>å¯¹äºå±•ç¤ºç»„ä»¶ï¼Œæˆ‘ä»¬è¦ä»¥ä¸€ç§â€™ç¬¬ä¸‰æ–¹ç»„ä»¶åº“â€™çš„æ ‡å‡†æ¥è€ƒè™‘ç»„ä»¶çš„è®¾è®¡, å‡å°‘ä¸ä¸šåŠ¡çš„è€¦åˆåº¦, è€ƒè™‘å„ç§åº”ç”¨çš„åœºæ™¯, è®¾è®¡å¥½å…¬å¼€çš„æ¥å£.</p><p><br></p></li><li><p><strong>å®¹å™¨ç»„ä»¶</strong>ä¸»è¦å…³æ³¨ä¸šåŠ¡å¤„ç†. å®¹å™¨ç»„ä»¶ä¸€èˆ¬ä»¥â€™é«˜é˜¶ç»„ä»¶â€™å½¢å¼å­˜åœ¨, å®ƒä¸€èˆ¬ â‘  ä»å¤–éƒ¨æ•°æ®æº(redux è¿™äº›çŠ¶æ€ç®¡ç†å™¨æˆ–è€…ç›´æ¥è¯·æ±‚æœåŠ¡ç«¯æ•°æ®)è·å–æ•°æ®, ç„¶å â‘¡ ç»„åˆ<em>å±•ç¤ºç»„ä»¶</em>æ¥æ„å»ºå®Œæ•´çš„è§†å›¾.</p><p><img src="/images/04/container.png" width="400"></p><p><em>å®¹å™¨ç»„ä»¶</em>é€šè¿‡ç»„åˆ<em>å±•ç¤ºç»„ä»¶</em>æ¥æ„å»ºå®Œæ•´è§†å›¾, ä½†ä¸¤è€…æœªå¿…æ˜¯ç®€å•çš„åŒ…å«ä¸è¢«åŒ…å«çš„å…³ç³».</p><p><br></p></li></ul><p><code>å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶çš„åˆ†ç¦»</code>å¯ä»¥å¸¦æ¥å¥½å¤„ä¸»è¦æ˜¯<strong>å¯å¤ç”¨æ€§</strong>å’Œ<strong>å¯ç»´æŠ¤æ€§</strong>:</p><ul><li>å¯å¤ç”¨æ€§: å±•ç¤ºç»„ä»¶å¯ä»¥ç”¨äºå¤šä¸ªä¸åŒçš„æ•°æ®æº(å®¹å™¨ç»„ä»¶). å®¹å™¨ç»„ä»¶(ä¸šåŠ¡é€»è¾‘)ä¹Ÿå¯ä»¥è¢«å¤ç”¨äºä¸åŒâ€™å¹³å°â€™çš„å±•ç¤ºç»„ä»¶</li><li>å±•ç¤ºå’Œå®¹å™¨ç»„ä»¶æ›´å¥½çš„åˆ†ç¦»ï¼Œæœ‰åŠ©äºæ›´å¥½çš„ç†è§£åº”ç”¨å’Œ UI, ä¸¤è€…å¯ä»¥è¢«ç‹¬ç«‹åœ°ç»´æŠ¤</li><li>å±•ç¤ºç»„ä»¶å˜å¾—è½»é‡(æ— çŠ¶æ€/æˆ–å±€éƒ¨çŠ¶æ€), æ›´å®¹æ˜“è¢«æµ‹è¯•</li></ul><p><br></p><p>äº†è§£æ›´å¤š<a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0" target="_blank" rel="noopener">Presentational and Container Components</a></p><p><br></p><hr><p><br></p><h3 id="2ï¸âƒ£-åˆ†ç¦»é€»è¾‘å’Œè§†å›¾"><a href="#2ï¸âƒ£-åˆ†ç¦»é€»è¾‘å’Œè§†å›¾" class="headerlink" title="2ï¸âƒ£ åˆ†ç¦»é€»è¾‘å’Œè§†å›¾"></a>2ï¸âƒ£ åˆ†ç¦»é€»è¾‘å’Œè§†å›¾</h3><p><code>å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶</code>çš„åˆ†ç¦»æœ¬è´¨ä¸Šæ˜¯<code>é€»è¾‘å’Œè§†å›¾</code>çš„åˆ†ç¦». åœ¨<a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener"><code>React Hooks</code></a>å‡ºç°å, å®¹å™¨ç»„ä»¶å¯ä»¥è¢« Hooks å½¢å¼å–ä»£, Hooks å¯ä»¥å’Œè§†å›¾å±‚æ›´è‡ªç„¶çš„åˆ†ç¦», ä¸ºè§†å›¾å±‚æä¾›çº¯ç²¹çš„æ•°æ®æ¥æº.</p><p>æŠ½ç¦»çš„åä¸šåŠ¡é€»è¾‘å¯ä»¥å¤ç”¨äºä¸åŒçš„â€™å±•ç¤ºå¹³å°â€™, ä¾‹å¦‚ web ç‰ˆå’Œ native ç‰ˆ:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Login/</span><br><span class="line">  useLogin.ts   // å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘</span><br><span class="line">  index.web.tsx</span><br><span class="line">  index.tsx</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä½¿ç”¨äº†<code>useLogin.tsx</code>æ¥å•ç‹¬ç»´æŠ¤ä¸šåŠ¡é€»è¾‘. å¯ä»¥è¢« web å¹³å°å’Œ native å¹³å°çš„ä»£ç å¤ç”¨.</p><p><br></p><p>  <img src="/images/04/demo.png" width="300"></p><p>ä¸ä»…ä»…æ˜¯<strong>ä¸šåŠ¡é€»è¾‘</strong>, å±•ç¤º<strong>ç»„ä»¶é€»è¾‘</strong>ä¹Ÿå¯ä»¥åˆ†ç¦». ä¾‹å¦‚ä¸Šå›¾, <code>FilePicker</code>å’Œ<code>ImagePicker</code>ä¸¤ä¸ªç»„ä»¶çš„â€™æ–‡ä»¶ä¸Šä¼ â€™é€»è¾‘æ˜¯å…±äº«çš„, è¿™éƒ¨åˆ†é€»è¾‘å¯ä»¥æŠ½å–åˆ°é«˜é˜¶ç»„ä»¶æˆ–è€… hooks, ç”šè‡³æ˜¯ Context ä¸­(å¯ä»¥ç»Ÿä¸€é…ç½®æ–‡ä»¶ä¸Šä¼ è¡Œä¸º)</p><p>åˆ†ç¦»é€»è¾‘å’Œè§†å›¾çš„ä¸»è¦æ–¹å¼æœ‰:</p><ul><li>hooks</li><li>é«˜é˜¶ç»„ä»¶</li><li>Render Props</li><li>Context</li></ul><p><br></p><hr><p><br></p><h3 id="3ï¸âƒ£-æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶"><a href="#3ï¸âƒ£-æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶" class="headerlink" title="3ï¸âƒ£ æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶"></a>3ï¸âƒ£ æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶</h3><p><strong>æ— çŠ¶æ€ç»„ä»¶å†…éƒ¨ä¸å­˜å‚¨çŠ¶æ€, å®Œå…¨ç”±å¤–éƒ¨çš„ props æ¥æ˜ å°„</strong>. è¿™ç±»ç»„ä»¶ä»¥å‡½æ•°ç»„ä»¶å½¢å¼å­˜åœ¨, ä½œä¸ºä½çº§/é«˜å¤ç”¨çš„åº•å±‚å±•ç¤ºå‹ç»„ä»¶.<br>æ— çŠ¶æ€ç»„ä»¶å¤©ç„¶å°±æ˜¯â€™çº¯ç»„ä»¶â€™, å¦‚æœæ— çŠ¶æ€ç»„ä»¶çš„æ˜ å°„éœ€è¦ä¸€ç‚¹æˆæœ¬, å¯ä»¥ä½¿ç”¨ React.memo åŒ…è£¹é¿å…é‡å¤æ¸²æŸ“</p><p><br></p><hr><p><br></p><h3 id="4ï¸âƒ£-çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶"><a href="#4ï¸âƒ£-çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶" class="headerlink" title="4ï¸âƒ£ çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶"></a>4ï¸âƒ£ çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶</h3><p>çº¯ç»„ä»¶çš„â€™çº¯â€™æ¥æºäºå‡½æ•°å¼ç¼–ç¨‹. æŒ‡çš„æ˜¯<strong>å¯¹äºä¸€ä¸ªå‡½æ•°è€Œè¨€, ç»™å®šç›¸åŒçš„è¾“å…¥, å®ƒæ€»æ˜¯è¿”å›ç›¸åŒçš„è¾“å‡º, è¿‡ç¨‹æ²¡æœ‰å‰¯ä½œç”¨, æ²¡æœ‰é¢å¤–çš„çŠ¶æ€ä¾èµ–</strong>. å¯¹åº”åˆ° React ä¸­, çº¯ç»„ä»¶æŒ‡çš„æ˜¯ props(ä¸¥æ ¼ä¸Šè¯´è¿˜æœ‰ state å’Œ context, å®ƒä»¬ä¹Ÿæ˜¯ç»„ä»¶çš„è¾“å…¥)æ²¡æœ‰å˜åŒ–, ç»„ä»¶çš„è¾“å‡ºå°±ä¸ä¼šå˜åŠ¨.</p><center><br>  <img src="/images/04/input-output.png" width="450"><br></center><p>å’Œ React ç»„ä»¶çš„è¾“å‡ºè¾“å‡ºæ¨¡å‹ç›¸æ¯”, <a href="http://cyclejs.cn" target="_blank" rel="noopener">Cyclejs</a>å¯¹ç»„ä»¶è¾“å…¥/è¾“å‡ºçš„æŠ½è±¡åˆ™åšçš„æ›´åŠ å½»åº•ï¼Œæ›´åŠ â€˜å‡½æ•°å¼â€™ğŸ‘‡ã€‚å®ƒçš„ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œåªæœ‰â€™å•å‘â€™çš„è¾“å…¥å’Œè¾“å‡º:</p><center><br>  <img src="/images/04/cyclejs.png" width="400"><br></center><p>å‡½æ•°å¼ç¼–ç¨‹å’Œç»„ä»¶å¼ç¼–ç¨‹æ€æƒ³æŸç§æ„ä¹‰ä¸Šæ˜¯ä¸€è‡´çš„, å®ƒä»¬éƒ½æ˜¯â€™ç»„åˆâ€™çš„è‰ºæœ¯. ä¸€ä¸ªå¤§çš„å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªèŒè´£å•ä¸€å‡½æ•°ç»„åˆè€Œæˆ. ç»„ä»¶ä¹Ÿæ˜¯å¦‚æ­¤. <strong>æˆ‘ä»¬å°†ä¸€ä¸ªå¤§çš„ç»„ä»¶æ‹†åˆ†ä¸ºå­ç»„ä»¶, å¯¹ç»„ä»¶åšæ›´ç»†ç²’åº¦çš„æ§åˆ¶, ä¿æŒå®ƒä»¬çš„çº¯å‡€æ€§, è®©å®ƒä»¬çš„èŒè´£æ›´å•ä¸€, æ›´ç‹¬ç«‹. è¿™å¸¦æ¥çš„å¥½å¤„å°±æ˜¯å¯å¤ç”¨æ€§, å¯æµ‹è¯•æ€§å’Œå¯é¢„æµ‹æ€§.</strong></p><p><strong>çº¯ç»„ä»¶å¯¹ React çš„æ€§èƒ½ä¼˜åŒ–ä¹Ÿæœ‰é‡è¦æ„ä¹‰</strong>. å¦‚æœä¸€ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªçº¯ç»„ä»¶, å¦‚æœâ€™è¾“å…¥â€™æ²¡æœ‰å˜åŠ¨, é‚£ä¹ˆè¿™ä¸ªç»„ä»¶å°±ä¸éœ€è¦é‡æ–°æ¸²æŸ“. ç»„ä»¶æ ‘è¶Šå¤§, çº¯ç»„ä»¶å¸¦æ¥çš„æ€§èƒ½ä¼˜åŒ–æ”¶ç›Šå°±è¶Šé«˜.</p><p>æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¿è¯ä¸€ä¸ªåº•å±‚ç»„ä»¶çš„çº¯å‡€æ€§, å› ä¸ºå®ƒæœ¬æ¥å°±å¾ˆç®€å•. ä½†æ˜¯å¯¹äºä¸€ä¸ªå¤æ‚çš„ç»„ä»¶æ ‘, åˆ™éœ€è¦èŠ±ç‚¹å¿ƒæ€è¿›è¡Œæ„å»º, æ‰€ä»¥å°±æœ‰äº†â€™çŠ¶æ€ç®¡ç†â€™çš„éœ€æ±‚. <strong>è¿™äº›çŠ¶æ€ç®¡ç†å™¨é€šå¸¸éƒ½åœ¨ç»„ä»¶æ ‘çš„<em>å¤–éƒ¨</em>ç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªçŠ¶æ€åº“, ç„¶åé€šè¿‡ä¾èµ–æ³¨å…¥å½¢å¼, å°†å±€éƒ¨çš„çŠ¶æ€æ³¨å…¥åˆ°å­æ ‘ä¸­. é€šè¿‡è§†å›¾å’Œé€»è¾‘åˆ†ç¦»çš„åŸåˆ™, æ¥ç»´æŒç»„ä»¶æ ‘çš„çº¯å‡€æ€§</strong>.</p><p>Redux å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„è§£å†³æ–¹æ¡ˆ, åœ¨ Redux çš„ä¸–ç•Œé‡Œå¯ä»¥è®¤ä¸º<strong>ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶æ ‘å°±æ˜¯ä¸€é¢—çŠ¶æ€æ ‘çš„æ˜ å°„</strong>, åªè¦çŠ¶æ€æ ‘(éœ€è¦ä¾é ä¸å¯å˜æ•°æ®æ¥ä¿è¯çŠ¶æ€çš„å¯é¢„æµ‹æ€§)ä¸å˜, ç»„ä»¶æ ‘å°±ä¸å˜. Redux å»ºè®®ä¿æŒç»„ä»¶çš„çº¯å‡€æ€§, å°†ç»„ä»¶çŠ¶æ€äº¤ç»™ Redux å’Œé…å¥—çš„å¼‚æ­¥å¤„ç†å·¥å…·æ¥ç»´æŠ¤, è¿™æ ·å°±å°†æ•´ä¸ªåº”ç”¨æŠ½è±¡æˆäº†ä¸€ä¸ªâ€å•å‘çš„æ•°æ®æµâ€, è¿™æ˜¯ä¸€ç§ç®€å•çš„â€è¾“å…¥/è¾“å‡ºâ€å…³ç³»</p><center><br>  <img src="/images/04/redux.png" width="400"><br></center><p>ä¸ç®¡æ˜¯ Cyclejs è¿˜æ˜¯ Reduxï¼ŒæŠ½è±¡æ˜¯éœ€è¦ä»˜å‡ºä¸€ç‚¹ä»£ä»·çš„ï¼Œå°±æ¯”å¦‚ redux ä»£ç å¯èƒ½ä¼šå¾ˆç½—å—¦; ä¸€ä¸ªå¤æ‚çš„çŠ¶æ€æ ‘, å¦‚æœç¼ºä¹è‰¯å¥½çš„ç»„ç»‡ï¼Œæ•´ä¸ªåº”ç”¨ä¼šå˜å¾—å¾ˆéš¾ç†è§£ã€‚å®é™…ä¸Š, å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½èƒ½å¤Ÿé¡ºåˆ©/ä¼˜é›…é€šè¿‡â€™æ•°æ®é©±åŠ¨â€™è¿›è¡Œè¡¨è¾¾(å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« <a href="https://zhuanlan.zhihu.com/p/54492049" target="_blank" rel="noopener">Modal.confirm è¿åäº† React çš„æ¨¡å¼å—ï¼Ÿ</a>), ä¾‹å¦‚æ–‡æœ¬æ¡†ç„¦ç‚¹, æˆ–è€…æ¨¡æ€æ¡†. æ‰€ä»¥ä¸å¿…æç«¯è¿½æ±‚æ— å‰¯ä½œç”¨æˆ–è€…æ•°æ®é©±åŠ¨</p><p>åç»­ä¼šä¸“é—¨å†™ç¯‡æ–‡ç« æ¥å›é¡¾æ€»ç»“çŠ¶æ€ç®¡ç†.</p><p>æ‰©å±•:</p><ul><li><a href="https://hackernoon.com/redesigning-redux-b2baee8b8a38" target="_blank" rel="noopener">Redesigning Redux</a></li><li><a href="http://cyclejs.cn/#-ç»„ä»¶åŒ–" target="_blank" rel="noopener">Cyclejs</a></li></ul><p><br></p><hr><p><br></p><h3 id="5ï¸âƒ£-æŒ‰ç…§-ui-åˆ’åˆ†ä¸ºå¸ƒå±€ç»„ä»¶å’Œå†…å®¹ç»„ä»¶"><a href="#5ï¸âƒ£-æŒ‰ç…§-ui-åˆ’åˆ†ä¸ºå¸ƒå±€ç»„ä»¶å’Œå†…å®¹ç»„ä»¶" class="headerlink" title="5ï¸âƒ£ æŒ‰ç…§ UI åˆ’åˆ†ä¸ºå¸ƒå±€ç»„ä»¶å’Œå†…å®¹ç»„ä»¶"></a>5ï¸âƒ£ æŒ‰ç…§ UI åˆ’åˆ†ä¸º<code>å¸ƒå±€ç»„ä»¶</code>å’Œ<code>å†…å®¹ç»„ä»¶</code></h3><ul><li>å¸ƒå±€ç»„ä»¶ç”¨äºæ§åˆ¶é¡µé¢çš„å¸ƒå±€ï¼Œä¸ºå†…å®¹ç»„ä»¶æä¾›å ä½ã€‚é€šè¿‡ props ä¼ å…¥ç»„ä»¶æ¥è¿›è¡Œå¡«å……. æ¯”å¦‚<code>Grid</code>, <code>Layout</code>, <code>HorizontalSplit</code></li><li>å†…å®¹ç»„ä»¶ä¼šåŒ…å«ä¸€äº›å†…å®¹ï¼Œè€Œä¸ä»…æœ‰å¸ƒå±€ã€‚å†…å®¹ç»„ä»¶é€šå¸¸è¢«å¸ƒå±€ç»„ä»¶çº¦æŸåœ¨å ä½å†…. æ¯”å¦‚<code>Button</code>, <code>Label</code>, <code>Input</code></li></ul><p>ä¾‹å¦‚ä¸‹å›¾, List/List.Item å°±æ˜¯å¸ƒå±€ç»„ä»¶ï¼Œè€Œ Inputï¼ŒAddress åˆ™æ˜¯å†…å®¹ç»„ä»¶</p><center><br>  <img src="/images/04/layout-vs-content.png" lazyload width="500"><br></center><p>å°†å¸ƒå±€ä»å†…å®¹ç»„ä»¶ä¸­æŠ½å–å‡ºæ¥ï¼Œåˆ†ç¦»å¸ƒå±€å’Œå†…å®¹ï¼Œå¯ä»¥è®©ä¸¤è€…æ›´å¥½ç»´æŠ¤ï¼Œæ¯”å¦‚å¸ƒå±€å˜åŠ¨ä¸ä¼šå½±å“å†…å®¹ï¼Œå†…å®¹ç»„ä»¶å¯ä»¥è¢«åº”ç”¨ä¸åŒçš„å¸ƒå±€; å¦ä¸€æ–¹é¢ç»„ä»¶æ˜¯ä¸€ä¸ªè‡ªåŒ…å«å†…èšçš„éš”ç¦»å•å…ƒ, ä¸åº”è¯¥å½±å“å…¶å¤–éƒ¨çš„çŠ¶æ€, ä¾‹å¦‚ä¸€ä¸ªæŒ‰é’®ä¸åº”è¯¥ä¿®æ”¹å¤–éƒ¨çš„å¸ƒå±€, å¦å¤–ä¹Ÿè¦é¿å…å½±å“å…¨å±€çš„æ ·å¼</p><p><br></p><hr><p><br></p><h3 id="6ï¸âƒ£-æ¥å£ä¸€è‡´çš„æ•°æ®å½•å…¥ç»„ä»¶"><a href="#6ï¸âƒ£-æ¥å£ä¸€è‡´çš„æ•°æ®å½•å…¥ç»„ä»¶" class="headerlink" title="6ï¸âƒ£ æ¥å£ä¸€è‡´çš„æ•°æ®å½•å…¥ç»„ä»¶"></a>6ï¸âƒ£ æ¥å£ä¸€è‡´çš„æ•°æ®å½•å…¥ç»„ä»¶</h3><p>æ•°æ®å½•å…¥ç»„ä»¶, æˆ–è€…ç§°ä¸ºè¡¨å•, æ˜¯å®¢æˆ·ç«¯å¼€å‘å¿…ä¸å¯å°‘çš„å…ƒç´ . å¯¹äºè‡ªå®šä¹‰è¡¨å•ç»„ä»¶, æˆ‘è®¤ä¸ºåº”è¯¥ä¿æŒä¸€è‡´çš„ API:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Props&lt;T&gt; &#123;</span><br><span class="line">  value?: T;</span><br><span class="line">  onChange: <span class="function">(<span class="params">value?: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšçš„å¥½å¤„:</p><ul><li>æ¥è¿‘åŸç”Ÿè¡¨å•å…ƒç´ åŸè¯­. è‡ªå®šä¹‰è¡¨å•ç»„ä»¶ä¸€èˆ¬ä¸éœ€è¦å°è£…åˆ° event å¯¹è±¡ä¸­</li><li>å‡ ä¹æ‰€æœ‰ç»„ä»¶åº“çš„è‡ªå®šä¹‰è¡¨å•éƒ½ä½¿ç”¨è¿™ç§ API. è¿™ä½¿å¾—æˆ‘ä»¬çš„è‡ªå®šä¹‰ç»„ä»¶å¯ä»¥å’Œç¬¬ä¸‰æ–¹åº“å…¼å®¹, æ¯”å¦‚<a href="https://ant.design/components/form-cn/#components-form-demo-validate-other" target="_blank" rel="noopener">antd çš„è¡¨å•éªŒè¯æœºåˆ¶</a></li><li>æ›´å®¹æ˜“è¢«åŠ¨æ€æ¸²æŸ“. å› ä¸ºæ¥å£ä¸€è‡´, å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡ŒåŠ¨æ€æ¸²æŸ“æˆ–é›†ä¸­åŒ–å¤„ç†, å‡å°‘ä»£ç é‡å¤</li><li><p>å›æ˜¾é—®é¢˜. çŠ¶æ€å›æ˜¾æ˜¯è¡¨å•ç»„ä»¶çš„åŠŸèƒ½ä¹‹ä¸€, æˆ‘ä¸ªäººçš„æœ€ä½³å®è·µæ˜¯<code>value</code>åº”è¯¥æ˜¯è‡ªåŒ…å«çš„:</p><p>æ¯”å¦‚ä¸€ä¸ªæ”¯æŒæœç´¢çš„ç”¨æˆ·é€‰æ‹©å™¨, option éƒ½æ˜¯å¼‚æ­¥ä»åç«¯åŠ è½½, å¦‚æœ value åªä¿å­˜ç”¨æˆ· id, é‚£ä¹ˆå›æ˜¾çš„æ—¶å€™å°±æ— æ³•æ˜¾ç¤ºç”¨æˆ·å, æŒ‰ç…§æˆ‘çš„å®è·µçš„ value çš„ç»“æ„åº”è¯¥ä¸º: <code>{id: string, name: string}</code>, è¿™æ ·å°±è§£å†³äº†å›æ˜¾é—®é¢˜. å›æ˜¾éœ€è¦çš„æ•°æ®éƒ½æ˜¯ç”±çˆ¶èŠ‚ç‚¹ä¼ é€’è¿›æ¥, è€Œä¸æ˜¯ç»„ä»¶è‡ªå·±ç»´æŠ¤</p></li><li><p>ç»„ä»¶éƒ½æ˜¯å—æ§çš„. åœ¨å®é™…çš„ React å¼€å‘ä¸­, éå—æ§ç»„ä»¶çš„åœºæ™¯éå¸¸å°‘, æˆ‘è®¤ä¸ºè‡ªå®šä¹‰ç»„ä»¶éƒ½å¯ä»¥å¿½ç•¥è¿™ç§éœ€æ±‚, åªæä¾›å®Œå…¨å—æ§è¡¨å•ç»„ä»¶, é¿å…ç»„ä»¶è‡ªå·±ç»´æŠ¤ç¼“å­˜çŠ¶æ€</p></li></ul><p><br></p><hr><p><br></p><h2 id="4-ç›®å½•åˆ’åˆ†"><a href="#4-ç›®å½•åˆ’åˆ†" class="headerlink" title="4. ç›®å½•åˆ’åˆ†"></a>4. ç›®å½•åˆ’åˆ†</h2><h3 id="1ï¸âƒ£-åŸºæœ¬ç›®å½•ç»“æ„"><a href="#1ï¸âƒ£-åŸºæœ¬ç›®å½•ç»“æ„" class="headerlink" title="1ï¸âƒ£ åŸºæœ¬ç›®å½•ç»“æ„"></a>1ï¸âƒ£ åŸºæœ¬ç›®å½•ç»“æ„</h3><p>å…³äºé¡¹ç›®ç›®å½•ç»“æ„çš„åˆ’åˆ†æœ‰ä¸¤ç§æµè¡Œçš„æ¨¡å¼:</p><ul><li><strong><a href="https://ruby-china.github.io/rails-guides/getting_started.html#say-hello-rails" target="_blank" rel="noopener">Rails-style</a>/by-type</strong>: æŒ‰ç…§æ–‡ä»¶çš„ç±»å‹åˆ’åˆ†ä¸ºä¸åŒçš„ç›®å½•ï¼Œä¾‹å¦‚<code>components</code>ã€<code>constants</code>ã€ <code>typings</code>ã€<code>views</code></li><li><strong>Domain-style/by-feature</strong>: æŒ‰ç…§ä¸€ä¸ªåŠŸèƒ½ç‰¹æ€§æˆ–ä¸šåŠ¡åˆ›å»ºå•ç‹¬çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…å«å¤šç§ç±»å‹çš„æ–‡ä»¶æˆ–ç›®å½•</li></ul><p>å®é™…çš„é¡¹ç›®ç¯å¢ƒæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯<strong>æ··åˆæ¨¡å¼</strong>ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ React é¡¹ç›®ç»“æ„:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/      # ğŸ”´ é¡¹ç›®é€šç”¨çš„â€˜å±•ç¤ºç»„ä»¶â€™</span><br><span class="line">    Button/</span><br><span class="line">      index.tsx    # ç»„ä»¶çš„å…¥å£, å¯¼å‡ºç»„ä»¶</span><br><span class="line">      Groups.tsx   # å­ç»„ä»¶</span><br><span class="line">      loading.svg  # é™æ€èµ„æº</span><br><span class="line">      style.css    # ç»„ä»¶æ ·å¼</span><br><span class="line">    ...</span><br><span class="line">    index.ts       # åˆ°å¤„æ‰€æœ‰ç»„ä»¶</span><br><span class="line">  containers/      # ğŸ”´ åŒ…å«'å®¹å™¨ç»„ä»¶'å’Œ'é¡µé¢ç»„ä»¶'</span><br><span class="line">    LoginPage/     # é¡µé¢ç»„ä»¶, ä¾‹å¦‚ç™»å½•</span><br><span class="line">      components/  # é¡µé¢çº§åˆ«å±•ç¤ºç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¸èƒ½å¤ç”¨ä¸å…¶ä»–é¡µé¢ç»„ä»¶ã€‚</span><br><span class="line">        Button.tsx # ç»„ä»¶æœªå¿…æ˜¯ä¸€ä¸ªç›®å½•å½¢å¼ï¼Œå¯¹äºä¸€ä¸ªç®€å•ç»„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªå•æ–‡ä»¶å½¢å¼. ä½†è¿˜æ˜¯æ¨èä½¿ç”¨ç›®å½•ï¼Œæ–¹ä¾¿æ‰©å±•</span><br><span class="line">        Panel.tsx</span><br><span class="line">      reducer.ts   # redux reduces</span><br><span class="line">      useLogin.ts  # (å¯é€‰)æ”¾ç½®'é€»è¾‘', æŒ‰ç…§ğŸ‘†åˆ†ç¦»é€»è¾‘å’Œè§†å›¾çš„åŸåˆ™ï¼Œå°†é€»è¾‘ã€çŠ¶æ€å¤„ç†æŠ½å–åˆ°hookæ–‡ä»¶</span><br><span class="line">      types.ts     # typescript ç±»å‹å£°æ˜</span><br><span class="line">      style.css</span><br><span class="line">      logo.png</span><br><span class="line">      message.ts</span><br><span class="line">      constants.ts</span><br><span class="line">      index.tsx</span><br><span class="line">    HomePage/</span><br><span class="line">    ...</span><br><span class="line">    index.tsx      # ğŸ”´åº”ç”¨æ ¹ç»„ä»¶</span><br><span class="line">  hooks/           # ğŸ”´å¯å¤ç”¨çš„hook</span><br><span class="line">    useList.ts</span><br><span class="line">    usePromise.ts</span><br><span class="line">  ...</span><br><span class="line">  index.tsx        # åº”ç”¨å…¥å£, åœ¨è¿™é‡Œä½¿ç”¨ReactDOMå¯¹è·Ÿç»„ä»¶è¿›è¡Œæ¸²æŸ“</span><br><span class="line">  stores.ts        # redux stores</span><br><span class="line">  contants.ts      # å…¨å±€å¸¸é‡</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä½¿ç”¨<code>Domain-style</code>é£æ ¼åˆ’åˆ†äº†<code>LoginPage</code>å’Œ<code>HomePage</code>ç›®å½•, å°†æ‰€æœ‰è¯¥ä¸šåŠ¡æˆ–è€…é¡µé¢ç›¸å…³çš„æ–‡ä»¶èšåˆåœ¨ä¸€èµ·; è¿™é‡Œä¹Ÿä½¿ç”¨<code>Rails-style</code>æ¨¡å¼æ ¹æ®æ–‡ä»¶<strong>ç±»å‹/èŒè´£</strong>åˆ’åˆ†ä¸åŒçš„ç›®å½•, æ¯”å¦‚<code>components</code>, <code>hooks</code>, <code>containers</code>; ä½ ä¼šå‘ç°åœ¨<code>LoginPage</code>å†…éƒ¨ä¹Ÿæœ‰ç±»ä¼¼<code>Rails-Style</code>çš„ç»“æ„, å¦‚<code>components</code>, åªä¸è¿‡å®ƒçš„<strong>ä½œç”¨åŸŸ</strong>ä¸åŒ, å®ƒåªå½’å±äº<code>LoginPage</code>, ä¸èƒ½è¢«å…¶ä»– Page å…±äº«</p><p>å‰ç«¯é¡¹ç›®ä¸€èˆ¬æŒ‰ç…§é¡µé¢è·¯ç”±æ¥æ‹†åˆ†ç»„ä»¶, è¿™äº›ç»„ä»¶æˆ‘ä»¬æš‚ä¸”ç§°ä¸ºâ€˜é¡µé¢ç»„ä»¶â€™, è¿™äº›ç»„ä»¶æ˜¯å’Œä¸šåŠ¡åŠŸèƒ½è€¦åˆçš„ï¼Œè€Œä¸”æ¯ä¸ªé¡µé¢ä¹‹é—´å…·æœ‰ä¸€å®šçš„ç‹¬ç«‹æ€§.</p><p>è¿™é‡Œå°†é¡µé¢ç»„ä»¶æ”¾ç½®åœ¨<code>containers</code>, å¦‚å…¶åï¼Œè¿™ä¸ªç›®å½•åŸæœ¬æ˜¯ç”¨æ¥æ”¾ç½®å®¹å™¨ç»„ä»¶çš„, å®é™…é¡¹ç›®ä¸­é€šå¸¸æ˜¯å°†â€˜å®¹å™¨ç»„ä»¶â€™å’Œâ€˜é¡µé¢ç»„ä»¶â€™æ··åˆåœ¨äº†ä¸€èµ·, ç°é˜¶æ®µå¦‚æœè¦å®ç°çº¯ç²¹çš„é€»è¾‘åˆ†ç¦»ï¼Œæˆ‘ä¸ªäººè§‰å¾—è¿˜æ˜¯åº”è¯¥æŠ½å–åˆ° hook ä¸­. è¿™ä¸ªç›®å½•ä¹Ÿå¯ä»¥å‘½åä¸º views, pagesâ€¦(whatever), å‘½åä¸º containers åªæ˜¯ä¸€ç§ä¹ æƒ¯(æ¥æºäº Redux).</p><p>æ‰©å±•:</p><ul><li><a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="noopener">react-boilerplate</a></li></ul><p><br></p><hr><p><br></p><h3 id="2ï¸âƒ£-å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†"><a href="#2ï¸âƒ£-å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†" class="headerlink" title="2ï¸âƒ£ å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†"></a>2ï¸âƒ£ å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†</h3><p>å¯¹äºå¤§å‹åº”ç”¨å¯èƒ½æœ‰å¤šä¸ªåº”ç”¨å…¥å£, ä¾‹å¦‚å¾ˆå¤š electron åº”ç”¨æœ‰å¤šä¸ª windows; å†æ¯”å¦‚å¾ˆå¤šåº”ç”¨é™¤äº† App è¿˜æœ‰åå°ç®¡ç†ç•Œé¢. æˆ‘ä¸€èˆ¬ä¼šè¿™æ ·ç»„ç»‡å¤šé¡µåº”ç”¨:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/       # å…±äº«ç»„ä»¶</span><br><span class="line">  containers/</span><br><span class="line">    Admin/          # åå°ç®¡ç†é¡µé¢</span><br><span class="line">      components/   # åå°ç‰¹å®šçš„ç»„ä»¶åº“</span><br><span class="line">      LoginPage/</span><br><span class="line">      index.tsx</span><br><span class="line">      ...</span><br><span class="line">    App/</span><br><span class="line">      components/  # Appç‰¹å®šçš„ç»„ä»¶åº“</span><br><span class="line">      LoginPage/   # Appé¡µé¢</span><br><span class="line">      index.tsx</span><br><span class="line">      stores.ts    # redux stores</span><br><span class="line">    AnotherApp/    # å¦å¤–ä¸€ä¸ªAppé¡µé¢</span><br><span class="line">  hooks/</span><br><span class="line">  ...</span><br><span class="line">  app.tsx          # åº”ç”¨å…¥å£</span><br><span class="line">  anotherApp.tsx   # åº”ç”¨å…¥å£</span><br><span class="line">  admin.tsx        # åå°å…¥å£</span><br></pre></td></tr></table></figure><p>webpack æ”¯æŒå¤šé¡µåº”ç”¨çš„æ„å»º, æˆ‘ä¸€èˆ¬ä¼šå°†åº”ç”¨å…¥å£æ–‡ä»¶å‘½åä¸º<code>*.page.tsx</code>, ç„¶ååœ¨ src è‡ªåŠ¨æ‰«æåŒ¹é…çš„æ–‡ä»¶ä½œä¸ºå…¥å£.</p><p>åˆ©ç”¨ webpack çš„<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener"><code>SplitChunksPlugin</code></a>å¯ä»¥è‡ªåŠ¨ä¸ºå¤šé¡µåº”ç”¨æŠ½å–å…±äº«çš„æ¨¡å—, è¿™ä¸ªå¯¹äºåŠŸèƒ½å·®ä¸å¤šå’Œæœ‰è¾ƒå¤šå…±äº«ä»£ç çš„å¤šé¡µåº”ç”¨å¾ˆæœ‰æ„ä¹‰. æ„å‘³ç€èµ„æºè¢«ä¸€èµ·ä¼˜åŒ–, æŠ½å–å…±äº«æ¨¡å—, æœ‰åˆ©äºå‡å°‘ç¼–è¯‘æ–‡ä»¶ä½“ç§¯, ä¹Ÿä¾¿äºå…±äº«æµè§ˆå™¨ç¼“å­˜.</p><blockquote><p><a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener"><code>html-webpack-plugin</code></a>4.0 å¼€å§‹æ”¯æŒæ³¨å…¥å…±äº« chunk. åœ¨æ­¤ä¹‹å‰éœ€è¦é€šè¿‡ SplitChunksPlugin æ˜¾å¼å®šä¹‰å…±äº«çš„ chunk, ç„¶åä¹Ÿè¦ html-webpack-plugin æ˜¾å¼æ³¨å…¥è¯¥ chunk, æ¯”è¾ƒæŒ«.</p></blockquote><p><br></p><hr><p><br></p><h3 id="3ï¸âƒ£-å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†-monorepo-æ¨¡å¼"><a href="#3ï¸âƒ£-å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†-monorepo-æ¨¡å¼" class="headerlink" title="3ï¸âƒ£ å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†: monorepo æ¨¡å¼"></a>3ï¸âƒ£ å¤šé¡µåº”ç”¨çš„ç›®å½•åˆ’åˆ†: monorepo æ¨¡å¼</h3><p>ä¸Šé¢çš„æ–¹å¼, æ‰€æœ‰é¡µé¢éƒ½èšé›†åœ¨ä¸€ä¸ªé¡¹ç›®ä¸‹é¢, å…±äº«ä¸€æ ·çš„ä¾èµ–å’Œ npm æ¨¡å—. è¿™å¯èƒ½ä¼šå¸¦äº†ä¸€äº›é—®é¢˜:</p><ol><li>ä¸èƒ½å…è®¸ä¸åŒé¡µé¢æœ‰ä¸åŒç‰ˆæœ¬çš„ä¾èµ–</li><li>å¯¹äºæ¯«æ— ç›¸å…³çš„åº”ç”¨, è¿™ç§ç»„ç»‡æ–¹å¼ä¼šè®©ä»£ç å˜å¾—æ··ä¹±, ä¾‹å¦‚ App å’Œåå°, ä»–ä»¬ä½¿ç”¨çš„æŠ€æœ¯æ ˆ/ç»„ä»¶åº“/äº¤äº’ä½“éªŒéƒ½å¯èƒ½ç›¸å·®è¾ƒå¤§, è€Œä¸”å®¹æ˜“é€ æˆå‘½åå†²çª.</li><li>æ„å»ºæ€§èƒ½. ä½ å¸Œæœ›å•ç‹¬å¯¹æŸä¸ªé¡µé¢è¿›è¡Œæ„å»ºå’Œç»´æŠ¤, è€Œä¸æ˜¯æ‰€æœ‰é¡µé¢æ··åˆåœ¨ä¸€èµ·æ„å»º</li></ol><p>è¿™ç§åœºæ™¯å¯ä»¥åˆ©ç”¨<a href="https://lernajs.io" target="_blank" rel="noopener">lerna</a>æˆ–è€… <a href="https://yarnpkg.com/zh-Hans/docs/workspaces" target="_blank" rel="noopener">yarn workspace</a> è¿™é‡Œ monorepo æœºåˆ¶, å°†å¤šé¡µåº”ç”¨éš”ç¦»åœ¨ä¸åŒçš„ npm æ¨¡å—ä¸‹, ä»¥ yarn workspace ä¸ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">package.json</span><br><span class="line">yarn.lock</span><br><span class="line">node_modules/      # æ‰€æœ‰ä¾èµ–éƒ½ä¼šå®‰è£…åœ¨è¿™é‡Œ, æ–¹ä¾¿yarnå¯¹ä¾èµ–è¿›è¡Œä¼˜åŒ–</span><br><span class="line">share/             # ğŸ”´ å…±äº«æ¨¡å—</span><br><span class="line">  hooks/</span><br><span class="line">  utils/</span><br><span class="line">admin/             # ğŸ”´ åå°ç®¡ç†åº”ç”¨</span><br><span class="line">  components/</span><br><span class="line">  containers/</span><br><span class="line">  index.tsx</span><br><span class="line">  package.json     # å£°æ˜è‡ªå·±çš„æ¨¡å—ä»¥åŠshareæ¨¡å—çš„ä¾èµ–</span><br><span class="line">app/               # ğŸ”´ åå°ç®¡ç†åº”ç”¨</span><br><span class="line">  components/</span><br><span class="line">  containers/</span><br><span class="line">  index.tsx</span><br><span class="line">  package.json     # å£°æ˜è‡ªå·±çš„æ¨¡å—ä»¥åŠshareæ¨¡å—çš„ä¾èµ–</span><br></pre></td></tr></table></figure><p>æ‰©å±•:</p><ul><li><a href="https://juejin.im/post/5cd8c1d6e51d456e55623bf2" target="_blank" rel="noopener">ç²¾è¯»ã€ŠMonorepo çš„ä¼˜åŠ¿ã€‹</a></li></ul><p><br></p><hr><p><br></p><h3 id="4ï¸âƒ£-è·¨å¹³å°åº”ç”¨"><a href="#4ï¸âƒ£-è·¨å¹³å°åº”ç”¨" class="headerlink" title="4ï¸âƒ£ è·¨å¹³å°åº”ç”¨"></a>4ï¸âƒ£ è·¨å¹³å°åº”ç”¨</h3><p>ä½¿ç”¨ ReactNative å¯ä»¥å°† React è¡ç”Ÿåˆ°åŸç”Ÿåº”ç”¨çš„å¼€å‘é¢†åŸŸ. å°½ç®¡ä¹Ÿæœ‰<a href="https://github.com/necolas/react-native-web" target="_blank" rel="noopener"><code>react-native-web</code></a>è¿™æ ·çš„è§£å†³æ–¹æ¡ˆ, Web å’Œ Native çš„ API/åŠŸèƒ½/å¼€å‘æ–¹å¼, ç”šè‡³äº§å“éœ€æ±‚ä¸Šå¯èƒ½ä¼šç›¸å·®å¾ˆå¤§, ä¹…è€Œä¹…ä¹‹å°±å¯èƒ½å‡ºç°å¤§é‡æ— æ³•æ§åˆ¶çš„é€‚é…ä»£ç ; å¦å¤– react-native-web æœ¬èº«ä¹Ÿå¯èƒ½æˆä¸ºé£é™©ç‚¹ã€‚ æ‰€ä»¥ä¸€äº›å›¢é˜Ÿéœ€è¦é’ˆå¯¹ä¸åŒå¹³å°è¿›è¡Œå¼€å‘, ä¸€èˆ¬æŒ‰ç…§ä¸‹é¢é£æ ¼æ¥ç»„ç»‡è·¨å¹³å°åº”ç”¨:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/</span><br><span class="line">    Button/</span><br><span class="line">      index.tsx     # ğŸ”´ ReactNative ç»„ä»¶</span><br><span class="line">      index.web.tsx # ğŸ”´ webç»„ä»¶, ä»¥web.tsxä¸ºåç¼€</span><br><span class="line">      loading.svg   # é™æ€èµ„æº</span><br><span class="line">      style.css     # ç»„ä»¶æ ·å¼</span><br><span class="line">    ...</span><br><span class="line">    index.ts</span><br><span class="line">    index.web.ts</span><br><span class="line">  containers/</span><br><span class="line">    LoginPage/</span><br><span class="line">      components/</span><br><span class="line">      ....</span><br><span class="line">      useLogin.ts   # ğŸ”´ å­˜æ”¾åˆ†ç¦»çš„é€»è¾‘ï¼Œå¯ä»¥åœ¨React Nativeå’ŒWebç»„ä»¶ä¸­å…±äº«</span><br><span class="line">      index.web.tsx</span><br><span class="line">      index.tsx</span><br><span class="line">    HomePage/</span><br><span class="line">    ...</span><br><span class="line">    index.tsx</span><br><span class="line">  hooks/</span><br><span class="line">    useList.ts</span><br><span class="line">    usePromise.ts</span><br><span class="line">  ...</span><br><span class="line">  index.web.tsx        # webåº”ç”¨å…¥å£</span><br><span class="line">  index.tsx            # React Native åº”ç”¨å…¥å£</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡ webpack çš„<code>resolve.extensions</code>æ¥é…ç½®æ‰©å±•åè¡¥å…¨çš„ä¼˜å…ˆçº§. æ—©æœŸçš„<a href="https://github.com/ant-design/ant-design-mobile" target="_blank" rel="noopener">antd-mobile</a>å°±æ˜¯è¿™æ ·ç»„ç»‡çš„.</p><p><br></p><hr><p><br></p><h3 id="5ï¸âƒ£-è·¨å¹³å°çš„å¦å¤–ä¸€ç§æ–¹å¼-taro"><a href="#5ï¸âƒ£-è·¨å¹³å°çš„å¦å¤–ä¸€ç§æ–¹å¼-taro" class="headerlink" title="5ï¸âƒ£ è·¨å¹³å°çš„å¦å¤–ä¸€ç§æ–¹å¼: taro"></a>5ï¸âƒ£ è·¨å¹³å°çš„å¦å¤–ä¸€ç§æ–¹å¼: taro</h3><p>å¯¹äºå›½å†…çš„å¼€å‘è€…æ¥è¯´ï¼Œè·¨å¹³å°å¯ä¸åª Native é‚£ä¹ˆç®€å•ï¼Œæˆ‘ä»¬è¿˜æœ‰å„ç§å„æ ·çš„å°ç¨‹åºã€å°åº”ç”¨ã€‚ç»ˆç«¯çš„<strong>ç¢ç‰‡åŒ–</strong>è®©å‰ç«¯çš„å¼€å‘å·¥ä½œè¶Šæ¥è¶Šæœ‰æŒ‘æˆ˜æ€§.</p><p>Taro å°±è¿™æ ·è¯ç”Ÿäº†, Taro åŸºäº React çš„æ ‡å‡†è¯­æ³•(DSL), ç»“åˆç¼–è¯‘åŸç†çš„æ€æƒ³, å°†ä¸€å¥—ä»£ç è½¬æ¢ä¸ºå¤šç§ç»ˆç«¯çš„ç›®æ ‡ä»£ç , å¹¶æä¾›ä¸€å¥—ç»Ÿä¸€çš„å†…ç½®ç»„ä»¶åº“å’Œ SDK æ¥æŠ¹å¹³å¤šç«¯çš„å·®å¼‚</p><center><br>  <img src="/images/04/taro.png" width="500"><br></center><p>å› ä¸º Taro ä½¿ç”¨ React çš„æ ‡å‡†è¯­æ³•å’Œ APIï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æŒ‰ç…§åŸæœ‰çš„ React å¼€å‘çº¦å®šå’Œä¹ æƒ¯æ¥å¼€å‘å¤šç«¯åº”ç”¨ï¼Œä¸”åªä¿æŒä¸€å¥—ä»£ç . ä½†æ˜¯ä¸è¦å¿˜äº†æŠ½è±¡éƒ½æ˜¯æœ‰ä»£ä»·çš„</p><blockquote><p>å¯ä»¥æŸ¥çœ‹ Taro å®˜æ–¹æ–‡æ¡£<a href="https://github.com/NervJS/taro" target="_blank" rel="noopener">äº†è§£æ›´å¤š</a> <br></p></blockquote><blockquote><p><a href="https://github.com/flutter/flutter" target="_blank" rel="noopener">Flutter</a>æ˜¯è¿‘æœŸæ¯”è¾ƒæˆ–çš„è·¨å¹³å°æ–¹æ¡ˆï¼Œä½†æ˜¯è·Ÿæœ¬æ–‡ä¸»é¢˜æ— å…³</p></blockquote><p><br></p><hr><p><br></p><h2 id="5-æ¨¡å—"><a href="#5-æ¨¡å—" class="headerlink" title="5. æ¨¡å—"></a>5. æ¨¡å—</h2><h3 id="1ï¸âƒ£-åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œ"><a href="#1ï¸âƒ£-åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œ" class="headerlink" title="1ï¸âƒ£ åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œ"></a>1ï¸âƒ£ åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œ</h3><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªæŸé¡µé¢çš„æ¨¡å—å¯¼å…¥ï¼Œç›¸å½“æ··ä¹±ï¼Œè¿™è¿˜ç®—å¯ä»¥æ¥å—ï¼Œç¬”è€…è¿˜è§è¿‡ä¸Šåƒè¡Œçš„ç»„ä»¶ï¼Œå…¶ä¸­æ¨¡å—å¯¼å…¥è¯­å¥å°±å ä¸€ç™¾å¤šè¡Œ. è¿™æœ‰ä¸€éƒ¨åˆ†åŸå› å¯èƒ½æ˜¯ VsCode è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½å¯¼è‡´(å¯ä»¥ä½¿ç”¨ tslint è§„åˆ™å¯¹å¯¼å…¥è¯­å¥è¿›è¡Œæ’åºå’Œåˆ†ç»„è§„èŒƒ)ï¼Œæ›´å¤§çš„åŸå› æ˜¯è¿™äº›æ¨¡å—ç¼ºä¹ç»„ç»‡ã€‚</p><center><br>  <img src="/images/04/imports.png" width="600"><br></center><p>æˆ‘è§‰å¾—åº”è¯¥åˆ›å»ºä¸¥æ ¼çš„æ¨¡å—è¾¹ç•Œï¼Œ<strong>ä¸€ä¸ªæ¨¡å—åªæœ‰ä¸€ä¸ªç»Ÿä¸€çš„â€™å‡ºå£â€™</strong>ã€‚ä¾‹å¦‚ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ComplexPage/</span><br><span class="line">  components/</span><br><span class="line">    Foo.tsx</span><br><span class="line">    Bar.tsx</span><br><span class="line">  constants.ts</span><br><span class="line">  reducers.ts</span><br><span class="line">  style.css</span><br><span class="line">  types.ts</span><br><span class="line">  index.tsx # å‡ºå£</span><br></pre></td></tr></table></figure><p>å¯ä»¥è®¤ä¸º<strong>ä¸€ä¸ªâ€˜ç›®å½•â€™å°±æ˜¯ä¸€ä¸ªæ¨¡å—è¾¹ç•Œ</strong>. ä½ <em>ä¸åº”è¯¥</em>è¿™æ ·å­å¯¼å…¥æ¨¡å—:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ComplexPage <span class="keyword">from</span> <span class="string">'../ComplexPage'</span>;</span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'../ComplexPage/components/Foo'</span>;</span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'../ComplexPage/components/Bar'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; XXX &#125; <span class="keyword">from</span> <span class="string">'../ComplexPage/components/constants'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User, ComplexPageProps &#125; <span class="keyword">from</span> <span class="string">'../ComplexPage/components/type'</span>;</span><br></pre></td></tr></table></figure><p><strong>ä¸€ä¸ªæ¨¡å—/ç›®å½•åº”è¯¥ç”±ä¸€ä¸ªâ€˜å‡ºå£â€™æ–‡ä»¶æ¥ç»Ÿä¸€ç®¡ç†æ¨¡å—çš„å¯¼å‡ºï¼Œé™å®šæ¨¡å—çš„å¯è§æ€§</strong>. æ¯”å¦‚ä¸Šé¢çš„æ¨¡å—ï¼Œ<code>components/Foo</code>ã€ <code>components/Bar</code>å’Œ<code>constants.ts</code>è¿™äº›æ–‡ä»¶å…¶å®æ˜¯ <code>ComplexPage</code> ç»„ä»¶çš„â€™å®ç°ç»†èŠ‚â€™. è¿™äº›æ˜¯å¤–éƒ¨æ¨¡å—ä¸åº”è¯¥å»è€¦åˆå®ç°ç»†èŠ‚ï¼Œä½†è¿™ä¸ªåœ¨è¯­è¨€å±‚é¢å¹¶æ²¡æœ‰ä¸€ä¸ªé™å®šæœºåˆ¶ï¼Œåªèƒ½ä¾é è§„èŒƒçº¦å®š.</p><blockquote><p>å½“å…¶ä»–æ¨¡å—ä¾èµ–æŸä¸ªæ¨¡å—çš„â€™ç»†èŠ‚â€™æ—¶, å¯èƒ½æ˜¯ä¸€ç§é‡æ„çš„ä¿¡å·: æ¯”å¦‚ä¾èµ–ä¸€ä¸ªæ¨¡å—çš„ä¸€ä¸ªå·¥å…·å‡½æ•°æˆ–è€…æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹å£°æ˜, è¿™æ—¶å€™å¯èƒ½åº”è¯¥å°†å…¶æŠ¬å‡åˆ°çˆ¶çº§æ¨¡å—, è®©å…„å¼Ÿæ¨¡å—å…±äº«å®ƒ.</p></blockquote><p>åœ¨å‰ç«¯é¡¹ç›®ä¸­ <code>index</code> æ–‡ä»¶æœ€é€‚åˆä½œä¸ºä¸€ä¸ªâ€™å‡ºå£â€™æ–‡ä»¶, å½“å¯¼å…¥ä¸€ä¸ªç›®å½•æ—¶ï¼Œæ¨¡å—æŸ¥æ‰¾å™¨ä¼šæŸ¥æ‰¾è¯¥ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨çš„ index æ–‡ä»¶. å¼€å‘è€…è®¾è®¡ä¸€ä¸ªæ¨¡å—çš„ API æ—¶, éœ€è¦è€ƒè™‘æ¨¡å—å„ç§ä½¿ç”¨æ–¹å¼, å¹¶ä½¿ç”¨ index æ–‡ä»¶æ§åˆ¶æ¨¡å—å¯è§æ€§:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥å¤–éƒ¨æ¨¡å—éœ€è¦ä½¿ç”¨çš„ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./type'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./reducers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸æš´éœ²å¤–éƒ¨ä¸éœ€è¦å…³å¿ƒçš„å®ç°ç»†èŠ‚</span></span><br><span class="line"><span class="comment">// export * from './components/Foo'</span></span><br><span class="line"><span class="comment">// export * from './components/Bar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—çš„é»˜è®¤å¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> &#123; ComplexPage <span class="keyword">as</span> <span class="keyword">default</span> &#125; <span class="keyword">from</span> <span class="string">'./ComplexPage'</span>;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯¼å…¥è¯­å¥å¯ä»¥æ›´åŠ ç®€æ´:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ComplexPage, &#123; ComplexPageProps, User, XXX &#125; <span class="keyword">from</span> <span class="string">'../ComplexPage'</span>;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿™æ¡è§„åˆ™ä¹Ÿå¯ä»¥ç”¨äºç»„ä»¶åº“. åœ¨ webpack çš„ Tree-shaking ç‰¹æ€§è¿˜ä¸æˆç†Ÿä¹‹å‰ï¼Œ æˆ‘ä»¬éƒ½ä½¿ç”¨äº†å„ç§å„æ ·çš„æŠ€å·§æ¥å®ç°<code>æŒ‰éœ€å¯¼å…¥</code>. ä¾‹å¦‚<a href="https://github.com/ant-design/babel-plugin-import" target="_blank" rel="noopener"><code>babel-plugin-import</code></a>æˆ–ç›´æ¥å­è·¯å¾„å¯¼å…¥:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> TextField <span class="keyword">from</span> <span class="string">'~/components/TextField'</span>;</span><br><span class="line"><span class="keyword">import</span> SelectField <span class="keyword">from</span> <span class="string">'~/components/SelectField'</span>;</span><br><span class="line"><span class="keyword">import</span> RaisedButton <span class="keyword">from</span> <span class="string">'~/components/RaisedButton'</span>;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥ä½¿ç”¨<code>Named import</code>ç›´æ¥å¯¼å…¥ï¼Œè®© webpack æ¥å¸®ä½ ä¼˜åŒ–:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TextField, SelectField, RaisedButton &#125; <span class="keyword">from</span> <span class="string">'~/components'</span>;</span><br></pre></td></tr></table></figure><p><strong>ä½†ä¸æ˜¯æ‰€æœ‰ç›®å½•éƒ½æœ‰å‡ºå£æ–‡ä»¶, è¿™æ—¶å€™ç›®å½•å°±ä¸æ˜¯æ¨¡å—çš„è¾¹ç•Œäº†</strong>. å…¸å‹çš„æœ‰<code>utils/</code>, <code>utils</code> åªæ˜¯ä¸€ä¸ªæ¨¡å—å‘½åç©ºé—´, <code>utils</code> ä¸‹é¢çš„æ–‡ä»¶éƒ½æ˜¯ä¸€äº›äº’ä¸ç›¸å…³æˆ–è€…ä¸åŒç±»å‹çš„æ–‡ä»¶:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">utils/</span><br><span class="line">  common.ts</span><br><span class="line">  dom.ts</span><br><span class="line">  sdk.ts</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹ æƒ¯ç›´æ¥å¼•ç”¨è¿™äº›æ–‡ä»¶, è€Œä¸æ˜¯é€šè¿‡ä¸€ä¸ªå…¥å£æ–‡ä»¶, è¿™æ ·å¯ä»¥æ›´æ˜ç¡®å¯¼å…¥çš„æ˜¯ä»€ä¹ˆç±»å‹çš„:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hide &#125; <span class="keyword">from</span> <span class="string">'./utils/dom'</span>; <span class="comment">// é€šè¿‡æ–‡ä»¶åå¯ä»¥çŸ¥é“, è¿™å¯èƒ½æ˜¯éšè—æŸä¸ªDOMå…ƒç´ </span></span><br><span class="line"><span class="keyword">import</span> &#123; hide &#125; <span class="keyword">from</span> <span class="string">'./utils/sdk'</span>; <span class="comment">// webview sdk æä¾›çš„çš„æŸä¸ªæ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>æœ€åå†æ€»ç»“ä¸€ä¸‹:</p><p>  <img src="/images/04/module-boundary.png" width="600"></p><p>æ ¹æ®æ¨¡å—è¾¹ç•ŒåŸåˆ™(å¦‚ä¸Šå›¾): <strong>ä¸€ä¸ªæ¨¡å—å¯ä»¥è®¿é—®å…„å¼Ÿ(åŒä¸ªä½œç”¨åŸŸä¸‹)ã€ ç¥–å…ˆåŠç¥–å…ˆçš„å…„å¼Ÿæ¨¡å—</strong>. ä¾‹å¦‚:</p><ul><li>Bar å¯ä»¥è®¿é—® Foo, ä½†ä¸èƒ½å†å‘ä¸‹è®¿é—®å®ƒçš„ç»†èŠ‚, å³ä¸èƒ½è®¿é—®<code>../Foo/types.ts</code>, ä½†å¯ä»¥è®¿é—®å®ƒçš„å‡ºå£æ–‡ä»¶<code>../Foo</code></li><li>src/types.ts ä¸èƒ½è®¿é—® containers/HomePage</li><li>LoginPage å’Œè®¿é—® HomePage</li><li>LoginPage å¯ä»¥è®¿é—® utils/sdk</li></ul><p><br></p><hr><p><br></p><h3 id="2ï¸âƒ£-named-export-vs-default-export"><a href="#2ï¸âƒ£-named-export-vs-default-export" class="headerlink" title="2ï¸âƒ£ Named export vs default export"></a>2ï¸âƒ£ <code>Named export</code> vs <code>default export</code></h3><p>è¿™ä¸¤ç§å¯¼å‡ºæ–¹å¼éƒ½æœ‰å„è‡ªçš„é€‚ç”¨åœºæ™¯ï¼Œè¿™é‡Œä¸åº”è¯¥ä¸€æ£’å­æ‰“æ­»å°±ä¸ä½¿ç”¨æŸç§å¯¼å‡ºæ–¹å¼. é¦–å…ˆçœ‹ä¸€ä¸‹<strong>named export æœ‰ä»€ä¹ˆä¼˜ç‚¹</strong>:</p><ul><li><p>å‘½åç¡®å®š</p><ul><li>æ–¹ä¾¿ Typescript è¿›è¡Œé‡æ„</li><li>æ–¹ä¾¿æ™ºèƒ½æé†’å’Œè‡ªåŠ¨å¯¼å…¥(auto-import)è¯†åˆ«</li><li><p>æ–¹ä¾¿ reexport</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// named</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./named-export'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// default</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> Foo &#125; <span class="keyword">from</span> <span class="string">'./default-export'</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ä¸€ä¸ªæ¨¡å—æ”¯æŒå¤šä¸ª<code>named export</code></p></li></ul><p><br></p><p><strong>å†çœ‹ä¸€ä¸‹<code>default export</code>æœ‰ä»€ä¹ˆä¼˜ç‚¹?</strong>:</p><ul><li><p><code>default export</code>ä¸€èˆ¬ä»£è¡¨â€˜æ¨¡å—æœ¬èº«â€™, å½“æˆ‘ä»¬ä½¿ç”¨â€˜é»˜è®¤å¯¼å…¥â€™å¯¼å…¥ä¸€ä¸ªæ¨¡å—æ—¶, å¼€å‘è€…æ˜¯è‡ªç„¶è€Œç„¶çŸ¥é“è¿™ä¸ªé»˜è®¤å¯¼å…¥çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆå¯¹è±¡ã€‚</p><p>ä¾‹å¦‚ react å¯¼å‡ºçš„æ˜¯ä¸€ä¸ª React å¯¹è±¡; LoginPage å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢; somg.png å¯¼å…¥çš„æ˜¯ä¸€å¼ å›¾ç‰‡. è¿™ç±»æ¨¡å—æ€»æœ‰ä¸€ä¸ªç¡®å®šçš„â€™ä¸»ä½“å¯¹è±¡â€™. æ‰€ä»¥é»˜è®¤å¯¼å…¥çš„åç§°å’Œæ¨¡å—çš„åç§°ä¸€èˆ¬æ˜¯ä¿æŒä¸€è‡´çš„(Typescript çš„ auto-import å°±æ˜¯åŸºäºæ–‡ä»¶å).</p><p>å½“ç„¶â€™ä¸»ä½“å¯¹è±¡â€™æ˜¯ä¸€ç§éšå¼çš„æ¦‚å¿µ, ä½ åªèƒ½é€šè¿‡è§„èŒƒå»çº¦æŸå®ƒ</p></li><li><p><code>default export</code>çš„å¯¼å…¥è¯­å¥æ›´åŠ ç®€æ´ã€‚ä¾‹å¦‚<code>lazy(import(&#39;./MyPage&#39;))</code></p></li></ul><p><code>default export</code>ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹:</p><ul><li>å’Œå…¶ä»–æ¨¡å—æœºåˆ¶(commonjs)äº’æ“ä½œæ—¶æ¯”è¾ƒéš¾ä»¥ç†è§£. ä¾‹å¦‚æˆ‘ä»¬ä¼šè¿™æ ·å­å¯¼å…¥<code>default export</code>: <code>require(&#39;./xx&#39;).default</code></li><li><code>named import</code> ä¼˜ç‚¹å°±æ˜¯<code>default export</code>çš„ç¼ºç‚¹</li></ul><p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹:</p><ol><li>å¯¹äºâ€™ä¸»ä½“å¯¹è±¡â€™æ˜ç¡®çš„æ¨¡å—éœ€è¦æœ‰é»˜è®¤å¯¼å‡º, ä¾‹å¦‚é¡µé¢ç»„ä»¶ï¼Œç±»</li><li>å¯¹äºâ€™ä¸»ä½“å¯¹è±¡â€™ä¸æ˜ç¡®çš„æ¨¡å—ä¸åº”è¯¥ä½¿ç”¨é»˜è®¤å¯¼å‡ºï¼Œä¾‹å¦‚ç»„ä»¶åº“ã€utils(æ”¾ç½®å„ç§å·¥å…·æ–¹æ³•)ã€contants å¸¸é‡</li></ol><p>æŒ‰ç…§è¿™ä¸ªè§„åˆ™å¯ä»¥è¿™æ ·å­ç»„ç»‡ components ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">components/</span><br><span class="line">  Foo/</span><br><span class="line">    Foo.tsx</span><br><span class="line">    types.ts</span><br><span class="line">    constants.ts</span><br><span class="line">    index.ts         # å¯¼å‡ºFooç»„ä»¶</span><br><span class="line">  Bar/</span><br><span class="line">    Bar.tsx</span><br><span class="line">    index.tsx</span><br><span class="line">  index.ts           # å¯¼å‡ºæ‰€æœ‰ç»„ä»¶</span><br></pre></td></tr></table></figure><p>å¯¹äº Foo æ¨¡å—æ¥è¯´ï¼Œ å­˜åœ¨ä¸€ä¸ªä¸»ä½“å¯¹è±¡å³ Foo ç»„ä»¶, æ‰€ä»¥è¿™é‡Œä½¿ç”¨<code>default export</code>å¯¼å‡ºçš„ Foo ç»„ä»¶ï¼Œ ä»£ç ä¸º:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.tsx</span></span><br><span class="line"><span class="comment">// è¿™ä¸‰ä¸ªæ–‡ä»¶å…¨éƒ¨ä½¿ç”¨named exportå¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./contants'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./types'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./Foo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥ä¸»ä½“å¯¹è±¡</span></span><br><span class="line"><span class="keyword">export</span> &#123; Foo <span class="keyword">as</span> <span class="keyword">default</span> &#125; <span class="keyword">from</span> <span class="string">'./Foo'</span>;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡è®¾ Bar ç»„ä»¶ä¾èµ–äº Foo:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// components/Bar/Bar.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥Fooç»„ä»¶, æ ¹æ®æ¨¡å—è¾¹ç•Œè§„åˆ™, ä¸èƒ½ç›´æ¥å¼•ç”¨../Foo/Foo.tsx</span></span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'../Foo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Bar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Foo /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Bar;</span></span><br></pre></td></tr></table></figure><p>å¯¹äº<code>components</code>æ¨¡å—æ¥è¯´ï¼Œå®ƒçš„æ‰€æœ‰å­æ¨¡å—éƒ½æ˜¯å¹³ç­‰çš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¸€ä¸ªä¸»ä½“å¯¹è±¡ï¼Œ<code>default export</code>åœ¨è¿™é‡Œä¸é€‚ç”¨ã€‚ <code>components/index.ts</code>ä»£ç :</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// components/index.ts</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./Foo'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./Bar'</span>;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="3ï¸âƒ£-é¿å…å¾ªç¯ä¾èµ–"><a href="#3ï¸âƒ£-é¿å…å¾ªç¯ä¾èµ–" class="headerlink" title="3ï¸âƒ£ é¿å…å¾ªç¯ä¾èµ–"></a>3ï¸âƒ£ é¿å…å¾ªç¯ä¾èµ–</h3><p><strong>å¾ªç¯ä¾èµ–æ˜¯æ¨¡å—ç³Ÿç³•è®¾è®¡çš„ä¸€ä¸ªè¡¨ç°</strong>, è¿™æ—¶å€™ä½ éœ€è¦è€ƒè™‘æ‹†åˆ†å’Œè®¾è®¡æ¨¡å—æ–‡ä»¶, ä¾‹å¦‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// --- Foo.tsx ---</span></span><br><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">'./Bar'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> SomeType &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Foo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">Foo.Bar = Bar;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- Bar.tsx ----</span></span><br><span class="line"><span class="keyword">import</span> &#123; SomeType &#125; <span class="keyword">from</span> <span class="string">'./Foo'</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ Foo å’Œ Bar ç»„ä»¶å°±å½¢æˆäº†ä¸€ä¸ªç®€å•å¾ªç¯ä¾èµ–, å°½ç®¡å®ƒä¸ä¼šé€ æˆä»€ä¹ˆè¿è¡Œæ—¶é—®é¢˜. è§£å†³æ–¹æ¡ˆå°±æ˜¯å°† SomeType æŠ½å–åˆ°å•ç‹¬çš„æ–‡ä»¶:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// --- types.ts ---</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> SomeType &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- Foo.tsx ---</span></span><br><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">'./Bar'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;SomeType&#125; <span class="keyword">from</span> <span class="string">'./types'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Foo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">...</span><br><span class="line">Foo.Bar = Bar;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- Bar.tsx ----</span></span><br><span class="line"><span class="keyword">import</span> &#123;SomeType&#125; <span class="keyword">from</span> <span class="string">'./types'</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="4ï¸âƒ£-ç›¸å¯¹è·¯å¾„ä¸è¦è¶…è¿‡ä¸¤çº§"><a href="#4ï¸âƒ£-ç›¸å¯¹è·¯å¾„ä¸è¦è¶…è¿‡ä¸¤çº§" class="headerlink" title="4ï¸âƒ£ ç›¸å¯¹è·¯å¾„ä¸è¦è¶…è¿‡ä¸¤çº§"></a>4ï¸âƒ£ ç›¸å¯¹è·¯å¾„ä¸è¦è¶…è¿‡ä¸¤çº§</h3><p>å½“é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚, ç›®å½•å¯èƒ½ä¼šè¶Šæ¥è¶Šæ·±, è¿™æ—¶å€™ä¼šå‡ºç°è¿™æ ·çš„å¯¼å…¥è·¯å¾„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hide &#125; <span class="keyword">from</span> <span class="string">'../../../utils/dom'</span>;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿™ç§å¯¼å…¥è¯­å¥éå¸¸ä¸ä¼˜é›…, è€Œä¸”å¯è¯»æ€§å¾ˆå·®. å½“ä½ åœ¨ä¸æ¸…æ¥šå½“å‰æ–‡ä»¶çš„ç›®å½•ä¸Šä¸‹æ–‡æ—¶, ä½ ä¸çŸ¥é“å…·ä½“æ¨¡å—åœ¨å“ª; å³ä½¿ä½ çŸ¥é“å½“å‰æ–‡ä»¶çš„ä½ç½®, ä½ ä¹Ÿéœ€è¦è·Ÿéšå¯¼å…¥è·¯å¾„åœ¨ç›®å½•æ ‘ä¸­å‘ä¸Šè¿½æº¯åœ¨èƒ½å®šä½åˆ°å…·ä½“æ¨¡å—. æ‰€ä»¥è¿™ç§ç›¸å¯¹è·¯å¾„æ˜¯æ¯”è¾ƒåäººç±»çš„.</p><p>å¦å¤–è¿™ç§å¯¼å…¥è·¯å¾„ä¸æ–¹ä¾¿æ¨¡å—è¿ç§»(å°½ç®¡ Vscode æ”¯æŒç§»åŠ¨æ–‡ä»¶æ—¶é‡æ„å¯¼å…¥è·¯å¾„), æ–‡ä»¶è¿ç§»éœ€è¦é‡å†™è¿™äº›ç›¸å¯¹å¯¼å…¥è·¯å¾„.</p><p><strong>æ‰€ä»¥ä¸€èˆ¬æ¨èç›¸å¯¹è·¯å¾„å¯¼å…¥ä¸åº”è¯¥è¶…è¿‡ä¸¤çº§, å³åªèƒ½æ˜¯<code>../</code>å’Œ<code>./</code></strong>. å¯ä»¥å°è¯•å°†<strong>ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„å½¢å¼</strong>, ä¾‹å¦‚<code>webpack</code>ä¸­å¯ä»¥é…ç½®<code>resolve.alias</code>å±æ€§æ¥å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">resolve: &#123;</span><br><span class="line">  ...</span><br><span class="line">  alias: &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨~è®¿é—®ç›¸å¯¹äºsrcç›®å½•çš„æ¨¡å—</span></span><br><span class="line">    <span class="comment">// å¦‚ ~/components/Button</span></span><br><span class="line">    <span class="string">'~'</span>: context,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·å­å¯¼å…¥ç›¸å¯¹äº<code>src</code>çš„æ¨¡å—:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hide &#125; <span class="keyword">from</span> <span class="string">'~/utils/dom'</span>;</span><br></pre></td></tr></table></figure><p>æ‰©å±•</p><ul><li>å¯¹äº Typescript å¯ä»¥é…ç½®<a href="https://www.typescriptlang.org/docs/handbook/module-resolution.html#path-mapping" target="_blank" rel="noopener">paths</a>é€‰é¡¹;</li><li>å¯¹äº babel å¯ä»¥ä½¿ç”¨<a href="https://www.npmjs.com/package/babel-plugin-module-resolver" target="_blank" rel="noopener"><code>babel-plugin-module-resolver</code></a>æ’ä»¶æ¥è½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„</li></ul><p><br></p><hr><p><br></p><h2 id="6-æ‹†åˆ†"><a href="#6-æ‹†åˆ†" class="headerlink" title="6. æ‹†åˆ†"></a>6. æ‹†åˆ†</h2><h3 id="1ï¸âƒ£-æ‹†åˆ†-render-æ–¹æ³•"><a href="#1ï¸âƒ£-æ‹†åˆ†-render-æ–¹æ³•" class="headerlink" title="1ï¸âƒ£ æ‹†åˆ† render æ–¹æ³•"></a>1ï¸âƒ£ æ‹†åˆ† render æ–¹æ³•</h3><p>å½“ render æ–¹æ³•çš„ JSX ç»“æ„éå¸¸å¤æ‚çš„æ—¶å€™, é¦–å…ˆåº”è¯¥å°è¯•åˆ†ç¦»è¿™äº› JSX, æœ€ç®€å•çš„åšæ³•çš„å°±æ˜¯æ‹†åˆ†ä¸ºå¤šä¸ªå­ render æ–¹æ³•:</p><p>  <img src="/images/04/sub-render.png" width="600"></p><p>å½“ç„¶è¿™ç§æ–¹å¼åªæ˜¯æš‚æ—¶è®© render æ–¹æ³•çœ‹èµ·æ¥æ²¡æœ‰é‚£ä¹ˆå¤æ‚, å®ƒå¹¶æ²¡æœ‰æ‹†åˆ†ç»„ä»¶æœ¬èº«, æ‰€æœ‰è¾“å…¥å’ŒçŠ¶æ€ä¾ç„¶èšé›†åœ¨ä¸€ä¸ªç»„ä»¶ä¸‹é¢. æ‰€ä»¥é€šå¸¸æ‹†åˆ† render æ–¹æ³•åªæ˜¯é‡æ„çš„ç¬¬ä¸€æ­¥: éšç€ç»„ä»¶è¶Šæ¥è¶Šå¤æ‚, è¡¨ç°ä¸ºæ–‡ä»¶è¶Šæ¥è¶Šé•¿, ç¬”è€…ä¸€èˆ¬å°† 300 è¡Œä½œä¸ºä¸€ä¸ªé˜ˆå€¼, <strong>è¶…è¿‡ 300 è¡Œåˆ™è¯´æ˜éœ€è¦å¯¹è¿™ä¸ªç»„ä»¶è¿›è¿›ä¸€æ­¥æ‹†åˆ†</strong></p><p><br></p><hr><p><br></p><h3 id="2ï¸âƒ£-æ‹†åˆ†ä¸ºç»„ä»¶"><a href="#2ï¸âƒ£-æ‹†åˆ†ä¸ºç»„ä»¶" class="headerlink" title="2ï¸âƒ£ æ‹†åˆ†ä¸ºç»„ä»¶"></a>2ï¸âƒ£ æ‹†åˆ†ä¸ºç»„ä»¶</h3><p>å¦‚æœå·²ç»æŒ‰ç…§ ğŸ‘† ä¸Šè¿°æ–¹æ³•å¯¹ç»„ä»¶çš„ render æ‹†åˆ†ä¸ºå¤šä¸ªå­ render, å½“ä¸€ä¸ªç»„ä»¶å˜å¾—è‡ƒè‚¿æ—¶, å°±å¯ä»¥æ–¹ä¾¿åœ°å°†è¿™äº›å­ render æ–¹æ³•æ‹†åˆ†ä¸ºç»„ä»¶. ä¸€èˆ¬ç»„ä»¶æŠ½ç¦»æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼:</p><ol><li>çº¯æ¸²æŸ“æ‹†åˆ†: å­ render æ–¹æ³•ä¸€èˆ¬æ˜¯çº¯æ¸²æŸ“çš„, ä»–ä»¬å¯ä»¥å¾ˆç›´æ¥åœ°æŠ½ç¦»ä¸º<em>æ— çŠ¶æ€ç»„ä»¶</em></li></ol><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> render() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; visible &#125; = <span class="keyword">this</span>.state</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Modal</span><br><span class="line">      visible=&#123;visible&#125;</span><br><span class="line">      title=&#123;<span class="keyword">this</span>.getLocale(<span class="string">'title'</span>)&#125;</span><br><span class="line">      width=&#123;<span class="keyword">this</span>.width&#125;</span><br><span class="line">      maskClosable=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">      onOk=&#123;<span class="keyword">this</span>.handleOk&#125;</span><br><span class="line">      onCancel=&#123;<span class="keyword">this</span>.handleCancel&#125;</span><br><span class="line">      footer=&#123;&lt;Footer &#123;...&#125;&gt;&lt;<span class="regexp">/Footer&gt;&#125;</span></span><br><span class="line"><span class="regexp">    &gt;</span></span><br><span class="line"><span class="regexp">    &lt;Body &#123;...&#125;&gt;&lt;/</span>Body&gt;</span><br><span class="line">  &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>çº¯é€»è¾‘æ‹†åˆ†: æŒ‰ç…§<code>é€»è¾‘å’Œè§†å›¾åˆ†ç¦»</code>çš„åŸåˆ™, å°†é€»è¾‘æ§åˆ¶éƒ¨åˆ†æŠ½ç¦»åˆ° hooks æˆ–é«˜é˜¶ç»„ä»¶ä¸­</li><li>é€»è¾‘å’Œæ¸²æŸ“æ‹†åˆ†: å°†ç›¸å…³çš„è§†å›¾å’Œé€»è¾‘æŠ½å–å‡ºå»å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶, è¿™æ˜¯æ›´ä¸ºå½»åº•çš„æ‹†åˆ†æ–¹å¼, è´¯å½»å•ä¸€èŒè´£åŸåˆ™.</li></ol><p><br></p><hr><p><br></p><h2 id="7-ç»„ä»¶åˆ’åˆ†ç¤ºä¾‹"><a href="#7-ç»„ä»¶åˆ’åˆ†ç¤ºä¾‹" class="headerlink" title="7. ç»„ä»¶åˆ’åˆ†ç¤ºä¾‹"></a>7. ç»„ä»¶åˆ’åˆ†ç¤ºä¾‹</h2><p>æˆ‘ä»¬ä¸€èˆ¬ä¼šä» UI åŸå‹å›¾ä¸­åˆ†æå’Œåˆ’åˆ†ç»„ä»¶, åœ¨ React å®˜æ–¹çš„<a href="https://react.docschina.org/docs/thinking-in-react.html" target="_blank" rel="noopener">Thinking in react</a>ä¹Ÿæåˆ°é€šè¿‡ UI æ¥åˆ’åˆ†ç»„ä»¶å±‚çº§: â€œ<em>è¿™æ˜¯å› ä¸º UI å’Œæ•°æ®æ¨¡å‹å¾€å¾€éµå¾ªç€ç›¸åŒçš„ä¿¡æ¯æ¶æ„ï¼Œè¿™æ„å‘³ç€å°† UI åˆ’åˆ†æˆç»„ä»¶çš„å·¥ä½œå¾€å¾€æ˜¯å¾ˆå®¹æ˜“çš„ã€‚åªè¦æŠŠå®ƒåˆ’åˆ†æˆèƒ½å‡†ç¡®è¡¨ç¤ºä½ æ•°æ®æ¨¡å‹çš„ä¸€éƒ¨åˆ†çš„ç»„ä»¶å°±å¯ä»¥</em>â€œ. ç»„ä»¶åˆ’åˆ†é™¤äº†éœ€è¦éµå¾ªä¸Šæ–‡ ğŸ‘† æåˆ°çš„ä¸€äº›åŸåˆ™, ä»–è¿˜ä¾èµ–äºä½ çš„å¼€å‘ç»éªŒ.</p><p>æœ¬èŠ‚é€šè¿‡ä¸€ä¸ªç®€å•çš„åº”ç”¨è®²è¿°åˆ’åˆ†ç»„ä»¶çš„è¿‡ç¨‹. è¿™æ˜¯æŸæ”¿åºœéƒ¨é—¨çš„æœåŠ¡ç”³æŠ¥ç³»ç»Ÿ, ä¸€å…±ç”±å››ä¸ªé¡µé¢ç»„æˆ:</p><center><br>  <img src="/images/04/demo-all.png" width="800"><br></center><h3 id="1ï¸âƒ£-åˆ’åˆ†é¡µé¢"><a href="#1ï¸âƒ£-åˆ’åˆ†é¡µé¢" class="headerlink" title="1ï¸âƒ£ åˆ’åˆ†é¡µé¢"></a>1ï¸âƒ£ åˆ’åˆ†é¡µé¢</h3><p>é¡µé¢é€šå¸¸æ˜¯æœ€é¡¶å±‚çš„ç»„ä»¶å•å…ƒ, åˆ’åˆ†é¡µé¢éå¸¸ç®€å•, æˆ‘ä»¬æ ¹æ®åŸå‹å›¾å°±å¯ä»¥åˆ’åˆ†å››ä¸ªé¡µé¢: <code>ListPage</code>, <code>CreatePage</code>, <code>PreviewPage</code>, <code>DetailPage</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  containers/</span><br><span class="line">    ListPage/</span><br><span class="line">    CreatePage/</span><br><span class="line">    PreviewPage/</span><br><span class="line">    DetailPage/</span><br><span class="line">    index.tsx     # æ ¹ç»„ä»¶, ä¸€èˆ¬åœ¨è¿™é‡Œå®šä¹‰è·¯ç”±</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="2ï¸âƒ£-åˆ’åˆ†åŸºç¡€-ui-ç»„ä»¶"><a href="#2ï¸âƒ£-åˆ’åˆ†åŸºç¡€-ui-ç»„ä»¶" class="headerlink" title="2ï¸âƒ£ åˆ’åˆ†åŸºç¡€ UI ç»„ä»¶"></a>2ï¸âƒ£ åˆ’åˆ†åŸºç¡€ UI ç»„ä»¶</h3><p>é¦–å…ˆçœ‹<code>ListPage</code></p><p>  <img src="/images/04/ListPage.png" width="400"></p><p>ListPage æ ¹æ® UI å¯ä»¥åˆ’åˆ†ä¸ºä¸‹é¢è¿™äº›ç»„ä»¶:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ScrollView        # æ»šåŠ¨è§†å›¾, æä¾›ä¸‹æ‹‰åˆ·æ–°, æ— é™åŠ è½½ç­‰åŠŸèƒ½</span><br><span class="line">  List            # åˆ—è¡¨å®¹å™¨, å¸ƒå±€ç»„ä»¶</span><br><span class="line">    Item          # åˆ—è¡¨é¡¹, å¸ƒå±€ç»„ä»¶, æä¾›header, bodyç­‰å ä½ç¬¦</span><br><span class="line">      props - header</span><br><span class="line">         Title       # æ¸²æŸ“æ ‡é¢˜</span><br><span class="line">      props - after</span><br><span class="line">         Time        # æ¸²æŸ“æ—¶é—´</span><br><span class="line">      props - body</span><br><span class="line">         Status      # æ¸²æŸ“åˆ—è¡¨é¡¹çš„çŠ¶æ€</span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹<code>CreatePage</code></p><p>  <img src="/images/04/CreatePage.png" width="400"></p><p>è¿™æ˜¯ä¸€ä¸ªè¡¨å•å¡«å†™é¡µé¢, ä¸ºäº†æé«˜è¡¨å•å¡«å†™ä½“éªŒ, è¿™é‡Œåˆ’åˆ†ä¸ºå¤šä¸ªæ­¥éª¤; æ¯ä¸ªæ­¥éª¤é‡Œæœ‰è¿˜æœ‰å¤šä¸ªè¡¨å•åˆ†ç»„; æ¯ä¸ªè¡¨å•çš„ç»“æ„éƒ½å·®ä¸å¤š, å·¦è¾¹æ˜¯ label å±•ç¤º, å³è¾¹æ˜¯å®é™…è¡¨å•ç»„ä»¶, æ‰€ä»¥æ ¹æ® UI å¯ä»¥å¯¹ç»„ä»¶è¿›è¡Œè¿™æ ·çš„åˆ’åˆ†:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CreatePage</span><br><span class="line">  Steps            # æ­¥éª¤å®¹å™¨, æä¾›äº†æ­¥éª¤å¸ƒå±€å’Œæ­¥éª¤åˆ‡æ¢ç­‰åŠŸèƒ½</span><br><span class="line">    Step           # å•ä¸€æ­¥éª¤å®¹å™¨</span><br><span class="line">      List         # è¡¨å•åˆ†ç»„</span><br><span class="line">        List.Item  # è¡¨å•å®¹å™¨, æ”¯æŒè®¾ç½®label</span><br><span class="line">          Input    # å…·ä½“è¡¨å•ç±»å‹</span><br><span class="line">          Address</span><br><span class="line">          NumberInput</span><br><span class="line">          Select</span><br><span class="line">          FileUpload</span><br></pre></td></tr></table></figure><blockquote><p>ç»„ä»¶å‘½åçš„å»ºè®®: å¯¹äºé›†åˆå‹ç»„ä»¶, ä¸€èˆ¬ä¼šä½¿ç”¨å•å¤æ•°å‘½å, ä¾‹å¦‚ä¸Šé¢çš„ Steps/Step; List/Item è¿™ç§å½¢å¼ä¹Ÿæ¯”è¾ƒå¸¸è§, ä¾‹å¦‚ Form/Form.Item, è¿™ç§å½¢å¼æ¯”è¾ƒé€‚åˆä½œä¸ºå­ç»„ä»¶å½¢å¼. å¯ä»¥å­¦ä¹ ä¸€ä¸‹ç¬¬ä¸‰æ–¹ç»„ä»¶åº“æ˜¯æ€ä¹ˆç»™ç»„ä»¶å‘½åçš„.</p></blockquote><p>å†çœ‹ä¸€ä¸‹<code>PreviewPage</code>, PreviewPage æ˜¯åˆ›å»ºåçš„æ•°æ®é¢„è§ˆé¡µé¢, æ•°æ®ç»“æ„å’Œé¡µé¢ç»“æ„å’Œ CreatePage å·®ä¸å¤š. å°† Steps å¯¹åº”åˆ° Preview ç»„ä»¶, Step å¯¹åº”åˆ° Preview.Item. Input å¯¹åº”åˆ° Input.Preview:</p><p>  <img src="/images/04/PreviewPage.png" width="400"></p><p><br></p><hr><p><br></p><h3 id="3ï¸âƒ£-è®¾è®¡ç»„ä»¶çš„çŠ¶æ€"><a href="#3ï¸âƒ£-è®¾è®¡ç»„ä»¶çš„çŠ¶æ€" class="headerlink" title="3ï¸âƒ£ è®¾è®¡ç»„ä»¶çš„çŠ¶æ€"></a>3ï¸âƒ£ è®¾è®¡ç»„ä»¶çš„çŠ¶æ€</h3><p>å¯¹äº ListPage æ¥è¯´çŠ¶æ€æ¯”è¾ƒç®€å•, è¿™é‡Œä¸»è¦è®¨è®º CreatePage çš„çŠ¶æ€. CreatePage çš„ç‰¹ç‚¹:</p><ul><li>è¡¨å•ç»„ä»¶ä½¿ç”¨å—æ§æ¨¡å¼, æœ¬èº«ä¸ä¼šå­˜å‚¨è¡¨å•çš„çŠ¶æ€. å¦å¤–è¡¨å•ä¹‹é—´çš„çŠ¶æ€å¯èƒ½æ˜¯è”åŠ¨çš„</li><li>çŠ¶æ€éœ€è¦åœ¨ CreatePage å’Œ PreviewPage ä¹‹é—´å…±äº«</li><li>éœ€è¦å¯¹è¡¨å•è¿›è¡Œç»Ÿä¸€æ ¡éªŒ</li><li>è‰ç¨¿ä¿å­˜</li></ul><p>ç”±äºéœ€è¦åœ¨ CreatePage å’Œ PreviewPage ä¸­å…±äº«æ•°æ®, è¡¨å•çš„çŠ¶æ€åº”è¯¥æŠ½å–å’Œæå‡åˆ°çˆ¶çº§. åœ¨è¿™ä¸ªé¡¹ç›®çš„å®é™…å¼€å‘ä¸­, æˆ‘çš„åšæ³•æ˜¯åˆ›å»ºä¸€ä¸ª FormStore çš„ Context ç»„ä»¶, ä¸‹çº§ç»„ä»¶é€šè¿‡è¿™ä¸ª context æ¥ç»Ÿä¸€å­˜å‚¨æ•°æ®. å¦å¤–æˆ‘å†³å®šä½¿ç”¨é…ç½®çš„æ–¹å¼, æ¥æ¸²æŸ“åŠ¨æ€è¿™äº›è¡¨å•. å¤§æ¦‚çš„ç»“æ„å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// CreatePage/index.tsx</span><br><span class="line">&lt;FormStore defaultValue=&#123;draft&#125; onChange=&#123;saveDraft&#125;&gt;</span><br><span class="line">  &lt;Switch&gt;</span><br><span class="line">    &lt;Route path=&quot;/create/preview&quot; component=&#123;Preview&#125; /&gt;</span><br><span class="line">    &lt;Route path=&quot;/create&quot; component=&#123;Create&#125; /&gt;</span><br><span class="line">  &lt;/Switch&gt;</span><br><span class="line">&lt;/FormStore&gt;</span><br><span class="line"></span><br><span class="line">// CreatePage/Create.tsx</span><br><span class="line">&lt;Steps&gt;</span><br><span class="line">  &#123;steps.map(i =&gt;</span><br><span class="line">    &lt;Step key=&#123;i.name&#125;&gt;</span><br><span class="line">      &lt;FormRenderer forms=&#123;i.forms&#125;  /&gt; &#123;/* formsä¸ºè¡¨å•é…ç½®, æ ¹æ®é…ç½®çš„è¡¨å•ç±»å‹æ¸²æŸ“è¡¨å•ç»„ä»¶, ä»FormStoreçš„è·å–å’Œå­˜å‚¨å€¼ */&#125;</span><br><span class="line">    &lt;/Step&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/Steps&gt;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h2 id="8-æ–‡æ¡£"><a href="#8-æ–‡æ¡£" class="headerlink" title="8. æ–‡æ¡£"></a>8. æ–‡æ¡£</h2><p>ç»„ä»¶çš„æ–‡æ¡£åŒ–æ¨èä½¿ç”¨<a href="https://storybook.js.org" target="_blank" rel="noopener">Storybook</a>, è¿™æ˜¯ä¸€ä¸ªç»„ä»¶ <code>Playground</code>, æœ‰ä»¥ä¸‹ç‰¹æ€§</p><ul><li>å¯äº¤äº’çš„ç»„ä»¶ç¤ºä¾‹</li><li>å¯ä»¥ç”¨äºå±•ç¤ºç»„ä»¶çš„æ–‡æ¡£. æ”¯æŒ props ç”Ÿæˆå’Œ markdown</li><li>å¯ä»¥ç”¨äºç»„ä»¶æµ‹è¯•. æ”¯æŒç»„ä»¶ç»“æ„æµ‹è¯•, äº¤äº’æµ‹è¯•, å¯è§†åŒ–æµ‹è¯•, å¯è®¿é—®æ€§æˆ–è€…æ‰‹åŠ¨æµ‹è¯•</li><li>ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€</li></ul><p><a href="https://storybooks-official.netlify.com" target="_blank" rel="noopener">React ç¤ºä¾‹</a>. ç”±äºç¯‡å¹…åŸå› , Storybook å°±ä¸å±•å¼€ç»†èŠ‚, æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£.</p><p><br></p><hr><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://jaysoo.ca/2016/02/28/organizing-redux-application/#rule-2-create-strict-module-boundaries" target="_blank" rel="noopener">Three Rules For Structuring (Redux) Applications</a></li><li><a href="https://www.smashingmagazine.com/2016/09/how-to-scale-react-applications/" target="_blank" rel="noopener">How To Scale React Applications</a></li><li><a href="http://cn.redux.js.org/docs/faq/CodeStructure.html" target="_blank" rel="noopener">Redux å¸¸è§é—®é¢˜ï¼šä»£ç ç»“æ„</a></li><li><a href="https://basarat.gitbooks.io/typescript/docs/tips/defaultIsBad.html" target="_blank" rel="noopener">export default considered harmful</a></li><li><a href="http://www.ruanyifeng.com/blog/2015/11/circular-dependency.html" target="_blank" rel="noopener">JavaScript æ¨¡å—çš„å¾ªç¯åŠ è½½</a></li><li><a href="https://react.docschina.org/docs/thinking-in-react.html" target="_blank" rel="noopener">thinking-in-react</a></li><li><a href="https://speakerdeck.com/vasa/building-multitenant-ui-with-react-dot-js?slide=16" target="_blank" rel="noopener">Building Multitenant UI with React.js</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€ä¸ªå¤æ‚çš„åº”ç”¨éƒ½æ˜¯ç”±ç®€å•çš„åº”ç”¨å‘å±•è€Œæ¥çš„, éšç€è¶Šæ¥è¶Šå¤šçš„åŠŸèƒ½åŠ å…¥é¡¹ç›®, ä»£ç å°±ä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥æ§åˆ¶. æœ¬æ–‡ç« ä¸»è¦æ¢è®¨åœ¨å¤§å‹é¡¹ç›®ä¸­å¦‚ä½•å¯¹ç»„ä»¶è¿›è¡Œç»„ç»‡, è®©é¡¹ç›®å…·å¤‡å¯ç»´æŠ¤æ€§.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç³»åˆ—ç›®å½•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“01 - ç±»å‹æ£€æŸ¥</title>
    <link href="https://bobi.ink/2019/05/10/react-component-design-01/"/>
    <id>https://bobi.ink/2019/05/10/react-component-design-01/</id>
    <published>2019-05-09T16:00:00.000Z</published>
    <updated>2019-05-15T01:12:07.476Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç³»åˆ—å¼•è¨€"><a href="#ç³»åˆ—å¼•è¨€" class="headerlink" title="ç³»åˆ—å¼•è¨€"></a>ç³»åˆ—å¼•è¨€</h2><p>æœ€è¿‘å‡†å¤‡åŸ¹è®­æ–°äºº, ä¸ºäº†æ–¹ä¾¿æ–°äººè¾ƒå¿«å…¥æ‰‹ React å¼€å‘å¹¶ç¼–å†™é«˜è´¨é‡çš„ç»„ä»¶ä»£ç , æˆ‘æ ¹æ®è‡ªå·±çš„å®è·µç»éªŒå¯¹<strong>React ç»„ä»¶è®¾è®¡çš„ç›¸å…³å®è·µå’Œè§„èŒƒ</strong>æ•´ç†äº†ä¸€äº›æ–‡æ¡£, å°†éƒ¨åˆ†ç« èŠ‚åˆ†äº«äº†å‡ºæ¥. ç”±äºç»éªŒæœ‰é™, æ–‡ç« å¯èƒ½ä¼šæœ‰æŸäº›é”™è¯¯, å¸Œæœ›å¤§å®¶æŒ‡å‡º, äº’ç›¸äº¤æµ.</p><p>ç”±äºç¯‡å¹…å¤ªé•¿, æ‰€ä»¥æ‹†åˆ†ä¸ºå‡ ç¯‡æ–‡ç« . ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä¸»é¢˜:</p><ul><li><a href="/2019/05/10/react-component-design-01/">01 ç±»å‹æ£€æŸ¥</a></li><li><a href="/2019/05/11/react-component-design-02/">02 ç»„ä»¶çš„ç»„ç»‡</a></li><li><a href="/2019/05/14/react-component-design-03/">03 æ ·å¼çš„ç®¡ç†</a></li><li><a href="/2019/05/15/react-component-design-04/">04 ç»„ä»¶çš„æ€ç»´</a></li><li>05 çŠ¶æ€ç®¡ç† å¾…æ›´æ–°</li></ul><h2 id="ç±»å‹æ£€æŸ¥"><a href="#ç±»å‹æ£€æŸ¥" class="headerlink" title="ç±»å‹æ£€æŸ¥"></a>ç±»å‹æ£€æŸ¥</h2><p>é™æ€ç±»å‹æ£€æŸ¥å¯¹äºå½“ä»Šçš„å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šä¸å¯æˆ–ç¼º, å°¤å…¶æ˜¯å¤§å‹é¡¹ç›®. <strong>å®ƒå¯ä»¥åœ¨å¼€å‘æ—¶å°±é¿å…è®¸å¤šç±»å‹é—®é¢˜, å‡å°‘ä½çº§é”™è¯¯çš„; å¦å¤–é€šè¿‡ç±»å‹æ™ºèƒ½æç¤º, å¯ä»¥æé«˜ç¼–ç çš„æ•ˆç‡; æœ‰åˆ©äºä¹¦å†™è‡ªæè¿°çš„ä»£ç (ç±»å‹å³æ–‡æ¡£); æ–¹ä¾¿ä»£ç é‡æ„(é…åˆ IDE å¯ä»¥è‡ªåŠ¨é‡æ„)</strong>. å¯¹äºé™æ€ç±»å‹æ£€æŸ¥çš„å¥½å¤„è¿™é‡Œå°±ä¸äºˆèµ˜è¿°, è¯»è€…å¯ä»¥æŸ¥çœ‹è¿™ä¸ªå›ç­”<a href="https://www.zhihu.com/question/28016252/answer/39056940" target="_blank" rel="noopener">flow.js/typescript è¿™ç±»å®šä¹‰å‚æ•°ç±»å‹çš„æ„ä¹‰ä½•åœ¨ï¼Ÿ</a>.</p><p>Javascript çš„ç±»å‹æ£€æŸ¥å™¨ä¸»è¦æœ‰<a href="https://www.typescriptlang.org" target="_blank" rel="noopener">Typescript</a>å’Œ<a href="https://flow.org" target="_blank" rel="noopener">Flow</a>, ç¬”è€…ä¸¤è€…éƒ½ç”¨è¿‡, Typescript æ›´å¼ºå¤§ä¸€äº›, å¯ä»¥é¿å…å¾ˆå¤šå‘, æœ‰æ›´å¥½çš„ç”Ÿæ€(ä¾‹å¦‚ç¬¬ä¸‰æ–¹åº“ç±»å‹å£°æ˜), è€Œä¸” VSCode å†…ç½®æ”¯æŒ. è€Œå¯¹äº Flow, è¿ Facebook è‡ªå·±çš„å¼€æºé¡¹ç›®(å¦‚ Yarn, Jest)éƒ½æŠ›å¼ƒäº†å®ƒ, æ‰€ä»¥ä¸å»ºè®®å…¥å‘. æ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä½¿ç”¨ Typescript(v3.3) å¯¹ React ç»„ä»¶è¿›è¡Œç±»å‹æ£€æŸ¥å£°æ˜</p><p>å»ºè®®é€šè¿‡å®˜æ–¹æ–‡æ¡£æ¥<a href="https://www.typescriptlang.org" target="_blank" rel="noopener">å­¦ä¹  Typescript</a>. ç¬”è€…æ­¤å‰ä¹Ÿæ•´ç†äº† Typescript ç›¸å…³çš„<a href="https://github.com/ivan-94/mindnodes/tree/master/è¯­è¨€/Typescript" target="_blank" rel="noopener">æ€ç»´å¯¼å›¾(mindnode)</a></p><blockquote><p>å½“ç„¶ Flow ä¹Ÿæœ‰æŸäº› Typescript æ²¡æœ‰çš„ç‰¹æ€§: <a href="https://github.com/niieani/typescript-vs-flowtype" target="_blank" rel="noopener">typescript-vs-flowtype</a></p></blockquote><blockquote><p>React ç»„ä»¶ç±»å‹æ£€æŸ¥ä¾èµ–äº<code>@types/react</code>å’Œ<code>@types/react-dom</code></p></blockquote><blockquote><p>ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨è¯•ç”¨ <br> <a href="https://codesandbox.io/s/5vx5wwmkvx?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit typescript-react-playground"></a></p></blockquote><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#ç³»åˆ—å¼•è¨€">ç³»åˆ—å¼•è¨€</a></li><li><a href="#ç±»å‹æ£€æŸ¥">ç±»å‹æ£€æŸ¥</a><ul><li><a href="#1-å‡½æ•°ç»„ä»¶">1. å‡½æ•°ç»„ä»¶</a><ul><li><a href="#1ï¸âƒ£-ä½¿ç”¨componentnameprops-å½¢å¼å‘½å-props-ç±»å‹-å¹¶å¯¼å‡º">1ï¸âƒ£ <strong>ä½¿ç”¨<code>ComponentNameProps</code> å½¢å¼å‘½å Props ç±»å‹, å¹¶å¯¼å‡º</strong></a></li><li><a href="#2ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨fcç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶">2ï¸âƒ£ <strong>ä¼˜å…ˆä½¿ç”¨<code>FC</code>ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶</strong></a></li><li><a href="#3ï¸âƒ£-ä¸è¦ç›´æ¥ä½¿ç”¨export-defaultå¯¼å‡ºç»„ä»¶">3ï¸âƒ£ <strong>ä¸è¦ç›´æ¥ä½¿ç”¨<code>export default</code>å¯¼å‡ºç»„ä»¶</strong>.</a></li><li><a href="#4ï¸âƒ£-é»˜è®¤-props-å£°æ˜">4ï¸âƒ£ <strong>é»˜è®¤ props å£°æ˜</strong></a></li><li><a href="#5ï¸âƒ£-æ³›å‹å‡½æ•°ç»„ä»¶">5ï¸âƒ£ <strong>æ³›å‹å‡½æ•°ç»„ä»¶</strong></a></li><li><a href="#6ï¸âƒ£-å­ç»„ä»¶å£°æ˜">6ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></a></li><li><a href="#7ï¸âƒ£-forwarding-refs">7ï¸âƒ£ <strong>Forwarding Refs</strong></a></li></ul></li><li><a href="#2-ç±»ç»„ä»¶">2. ç±»ç»„ä»¶</a><ul><li><a href="#1ï¸âƒ£-ç»§æ‰¿-component-æˆ–-purecomponent">1ï¸âƒ£ <strong>ç»§æ‰¿ Component æˆ– PureComponent</strong></a></li><li><a href="#2ï¸âƒ£-ä½¿ç”¨static-defaultpropså®šä¹‰é»˜è®¤-props">2ï¸âƒ£ <strong>ä½¿ç”¨<code>static defaultProps</code>å®šä¹‰é»˜è®¤ props</strong></a></li><li><a href="#3ï¸âƒ£-å­ç»„ä»¶å£°æ˜">3ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></a></li><li><a href="#4ï¸âƒ£-æ³›å‹">4ï¸âƒ£ <strong>æ³›å‹</strong></a></li></ul></li><li><a href="#3-é«˜é˜¶ç»„ä»¶">3. é«˜é˜¶ç»„ä»¶</a></li><li><a href="#4-render-props">4. Render Props</a></li><li><a href="#5-context">5. Context</a></li><li><a href="#6-æ‚é¡¹">6. æ‚é¡¹</a><ul><li><a href="#1ï¸âƒ£-ä½¿ç”¨handleeventå‘½åäº‹ä»¶å¤„ç†å™¨">1ï¸âƒ£ <strong>ä½¿ç”¨<code>handleEvent</code>å‘½åäº‹ä»¶å¤„ç†å™¨</strong>.</a></li><li><a href="#2ï¸âƒ£-å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹">2ï¸âƒ£ <strong>å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹</strong></a></li><li><a href="#3ï¸âƒ£-è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹">3ï¸âƒ£ <strong>è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹</strong></a></li><li><a href="#4ï¸âƒ£-è·å–åŸç”Ÿå…ƒç´ -props-å®šä¹‰">4ï¸âƒ£ <strong>è·å–åŸç”Ÿå…ƒç´  props å®šä¹‰</strong></a></li><li><a href="#5ï¸âƒ£-ä¸è¦ä½¿ç”¨-proptypes">5ï¸âƒ£ <strong>ä¸è¦ä½¿ç”¨ PropTypes</strong></a></li><li><a href="#6ï¸âƒ£-styled-components">6ï¸âƒ£ <strong>styled-components</strong></a></li><li><a href="#7ï¸âƒ£-ä¸ºæ²¡æœ‰æä¾›-typescript-å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜">7ï¸âƒ£ <strong>ä¸ºæ²¡æœ‰æä¾› Typescript å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜</strong></a></li><li><a href="#8ï¸âƒ£-ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡">8ï¸âƒ£ <strong>ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡</strong></a></li><li><a href="#9ï¸âƒ£-å¼€å¯-strict-æ¨¡å¼">9ï¸âƒ£ <strong>å¼€å¯ strict æ¨¡å¼</strong></a></li></ul></li><li><a href="#æ‰©å±•èµ„æ–™">æ‰©å±•èµ„æ–™</a></li></ul></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h3 id="1-å‡½æ•°ç»„ä»¶"><a href="#1-å‡½æ•°ç»„ä»¶" class="headerlink" title="1. å‡½æ•°ç»„ä»¶"></a>1. å‡½æ•°ç»„ä»¶</h3><p>React Hooks å‡ºç°å, å‡½æ•°ç»„ä»¶æœ‰äº†æ›´å¤šå‡ºé•œç‡. ç”±äºå‡½æ•°ç»„ä»¶åªæ˜¯æ™®é€šå‡½æ•°, å®ƒéå¸¸å®¹æ˜“è¿›è¡Œç±»å‹å£°æ˜</p><p><br></p><h4 id="1ï¸âƒ£-ä½¿ç”¨componentnameprops-å½¢å¼å‘½å-props-ç±»å‹-å¹¶å¯¼å‡º"><a href="#1ï¸âƒ£-ä½¿ç”¨componentnameprops-å½¢å¼å‘½å-props-ç±»å‹-å¹¶å¯¼å‡º" class="headerlink" title="1ï¸âƒ£ ä½¿ç”¨ComponentNameProps å½¢å¼å‘½å Props ç±»å‹, å¹¶å¯¼å‡º"></a>1ï¸âƒ£ <strong>ä½¿ç”¨<code>ComponentNameProps</code> å½¢å¼å‘½å Props ç±»å‹, å¹¶å¯¼å‡º</strong></h4><p><br></p><h4 id="2ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨fcç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶"><a href="#2ï¸âƒ£-ä¼˜å…ˆä½¿ç”¨fcç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶" class="headerlink" title="2ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨FCç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶"></a>2ï¸âƒ£ <strong>ä¼˜å…ˆä½¿ç”¨<code>FC</code>ç±»å‹æ¥å£°æ˜å‡½æ•°ç»„ä»¶</strong></h4><p><code>FC</code>æ˜¯<code>FunctionComponent</code>çš„ç®€å†™, è¿™ä¸ªç±»å‹å®šä¹‰äº†é»˜è®¤çš„ props(å¦‚ children)ä»¥åŠä¸€äº›é™æ€å±æ€§(å¦‚ defaultProps)</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜Propsç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyComponentProps &#123;</span><br><span class="line">  className?: <span class="built_in">string</span>;</span><br><span class="line">  style?: React.CSSProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyComponent: FC&lt;MyComponentProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello react&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ™®é€šå‡½æ•°æ¥è¿›è¡Œç»„ä»¶å£°æ˜, ä¸‹æ–‡ä¼šçœ‹åˆ°è¿™ç§å½¢å¼æ›´åŠ çµæ´»:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyComponentProps &#123;</span><br><span class="line">  className?: <span class="built_in">string</span>;</span><br><span class="line">  style?: React.CSSProperties;</span><br><span class="line">  <span class="comment">// æ‰‹åŠ¨å£°æ˜children</span></span><br><span class="line">  children?: React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">props: MyComponentProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello react&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="3ï¸âƒ£-ä¸è¦ç›´æ¥ä½¿ç”¨export-defaultå¯¼å‡ºç»„ä»¶"><a href="#3ï¸âƒ£-ä¸è¦ç›´æ¥ä½¿ç”¨export-defaultå¯¼å‡ºç»„ä»¶" class="headerlink" title="3ï¸âƒ£ ä¸è¦ç›´æ¥ä½¿ç”¨export defaultå¯¼å‡ºç»„ä»¶."></a>3ï¸âƒ£ <strong>ä¸è¦ç›´æ¥ä½¿ç”¨<code>export default</code>å¯¼å‡ºç»„ä»¶</strong>.</h4><p>è¿™ç§æ–¹å¼å¯¼å‡ºçš„ç»„ä»¶åœ¨<code>React Inspector</code>æŸ¥çœ‹æ—¶ä¼šæ˜¾ç¤ºä¸º<code>Unknown</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props: &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;hello react&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœéå¾—è¿™ä¹ˆåš, è¯·ä½¿ç”¨<code>å‘½å function</code> å®šä¹‰:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">props: &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;xxx&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="4ï¸âƒ£-é»˜è®¤-props-å£°æ˜"><a href="#4ï¸âƒ£-é»˜è®¤-props-å£°æ˜" class="headerlink" title="4ï¸âƒ£ é»˜è®¤ props å£°æ˜"></a>4ï¸âƒ£ <strong>é»˜è®¤ props å£°æ˜</strong></h4><p>å®é™…ä¸Šæˆªæ­¢ç›®å‰å¯¹äºä¸Šé¢çš„ä½¿ç”¨<code>FC</code>ç±»å‹å£°æ˜çš„å‡½æ•°ç»„ä»¶å¹¶<a href="https://github.com/Microsoft/TypeScript/issues/27425" target="_blank" rel="noopener">ä¸èƒ½å®Œç¾æ”¯æŒ defaultProps</a>:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HelloProps &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Hello: FC&lt;HelloProps&gt; = <span class="function">(<span class="params">&#123; name &#125;</span>) =&gt;</span> &lt;div&gt;Hello &#123;name&#125;!&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Hello.defaultProps = &#123; name: 'TJ' &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ âŒ! missing name</span></span><br><span class="line"><span class="regexp">&lt;Hello /</span>&gt;;</span><br></pre></td></tr></table></figure><p>ç¬”è€…ä¸€èˆ¬å–œæ¬¢è¿™æ ·å­å£°æ˜é»˜è®¤ props:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HelloProps &#123;</span><br><span class="line">  name?: <span class="built_in">string</span>; <span class="comment">// å£°æ˜ä¸ºå¯é€‰å±æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨å¯¹è±¡é»˜è®¤å±æ€§å€¼è¯­æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Hello: FC&lt;HelloProps&gt; = <span class="function">(<span class="params">&#123; name = 'TJ' &#125;</span>) =&gt;</span> &lt;div&gt;Hello &#123;name&#125;!&lt;<span class="regexp">/div&gt;;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœéå¾—ä½¿ç”¨ defaultProps, å¯ä»¥è¿™æ ·å­å£°æ˜ ğŸ‘‡. Typescript å¯ä»¥æ¨æ–­å’Œåœ¨å‡½æ•°ä¸Šå®šä¹‰çš„å±æ€§, è¿™ä¸ªç‰¹æ€§åœ¨ Typescript <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-1.html#properties-declarations-on-functions" target="_blank" rel="noopener">3.1</a>å¼€å§‹æ”¯æŒ.</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropsWithChildren &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HelloProps &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥ä½¿ç”¨å‡½æ•°å‚æ•°å£°æ˜</span></span><br><span class="line"><span class="comment">// PropsWithChildrenåªæ˜¯æ‰©å±•äº†children, å®Œå…¨å¯ä»¥è‡ªå·±å£°æ˜</span></span><br><span class="line"><span class="comment">// type PropsWithChildren&lt;P&gt; = P &amp; &#123;</span></span><br><span class="line"><span class="comment">//    children?: ReactNode;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">const</span> Hello = <span class="function">(<span class="params">&#123; name &#125;: PropsWithChildren&lt;HelloProps&gt;</span>) =&gt;</span> &lt;div&gt;Hello &#123;name&#125;!&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Hello.defaultProps = &#123; name: 'TJ' &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ âœ… ok!</span></span><br><span class="line"><span class="regexp">&lt;Hello /</span>&gt;;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¹Ÿéå¸¸ç®€æ´, åªä¸è¿‡ defaultProps çš„ç±»å‹å’Œç»„ä»¶æœ¬èº«çš„ props æ²¡æœ‰å…³è”æ€§, è¿™ä¼šä½¿å¾— defaultProps æ— æ³•å¾—åˆ°ç±»å‹çº¦æŸ, æ‰€ä»¥å¿…è¦æ—¶è¿›ä¸€æ­¥æ˜¾å¼å£°æ˜ defaultProps çš„ç±»å‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Hello.defaultProps = &#123; name: <span class="string">'TJ'</span> &#125; <span class="keyword">as</span> Partial&lt;HelloProps&gt;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="5ï¸âƒ£-æ³›å‹å‡½æ•°ç»„ä»¶"><a href="#5ï¸âƒ£-æ³›å‹å‡½æ•°ç»„ä»¶" class="headerlink" title="5ï¸âƒ£ æ³›å‹å‡½æ•°ç»„ä»¶"></a>5ï¸âƒ£ <strong>æ³›å‹å‡½æ•°ç»„ä»¶</strong></h4><p>æ³›å‹åœ¨ä¸€ä¸‹åˆ—è¡¨å‹æˆ–å®¹å™¨å‹çš„ç»„ä»¶ä¸­æ¯”è¾ƒå¸¸ç”¨, ç›´æ¥ä½¿ç”¨<code>FC</code>æ— æ³•æ»¡è¶³éœ€æ±‚:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ListProps&lt;T&gt; &#123;</span><br><span class="line">  visible: <span class="built_in">boolean</span>;</span><br><span class="line">  list: T[];</span><br><span class="line">  renderItem: <span class="function">(<span class="params">item: T, index: <span class="built_in">number</span></span>) =&gt;</span> React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">List</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: ListProps&lt;T&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;List</span><br><span class="line">      list=&#123;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</span><br><span class="line">      renderItem=&#123;<span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/*è‡ªåŠ¨æ¨æ–­iä¸ºnumberç±»å‹*/</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="6ï¸âƒ£-å­ç»„ä»¶å£°æ˜"><a href="#6ï¸âƒ£-å­ç»„ä»¶å£°æ˜" class="headerlink" title="6ï¸âƒ£ å­ç»„ä»¶å£°æ˜"></a>6ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></h4><p>ä½¿ç”¨<code>Parent.Child</code>å½¢å¼çš„ JSX å¯ä»¥è®©èŠ‚ç‚¹çˆ¶å­å…³ç³»æ›´åŠ ç›´è§‚, å®ƒç±»ä¼¼äºä¸€ç§å‘½åç©ºé—´çš„æœºåˆ¶, å¯ä»¥é¿å…å‘½åå†²çª. ç›¸æ¯”<code>ParentChild</code>è¿™ç§å‘½åæ–¹å¼, <code>Parent.Child</code>æ›´ä¸ºä¼˜é›…äº›. å½“ç„¶ä¹Ÿæœ‰å¯èƒ½è®©ä»£ç å˜å¾—å•°å—¦.</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropsWithChildren &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LayoutProps &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LayoutHeaderProps &#123;&#125; <span class="comment">// é‡‡ç”¨ParentChildPropså½¢å¼å‘½å</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LayoutFooterProps &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params">props: PropsWithChildren&lt;LayoutProps&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div className=<span class="string">"layout"</span>&gt;&#123;props.children&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ä½œä¸ºçˆ¶ç»„ä»¶çš„å±æ€§</span></span><br><span class="line"><span class="regexp">Layout.Header = (props: PropsWithChildren&lt;LayoutHeaderProps&gt;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &lt;div className="header"&gt;&#123;props.children&#125;&lt;/</span>div&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Layout.Footer = <span class="function">(<span class="params">props: PropsWithChildren&lt;LayoutFooterProps&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div className=<span class="string">"footer"</span>&gt;&#123;props.children&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ Test</span></span><br><span class="line"><span class="regexp">&lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Layout.Header&gt;header&lt;/</span>Layout.Header&gt;</span><br><span class="line">  &lt;Layout.Footer&gt;footer&lt;<span class="regexp">/Layout.Footer&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Layout&gt;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="7ï¸âƒ£-forwarding-refs"><a href="#7ï¸âƒ£-forwarding-refs" class="headerlink" title="7ï¸âƒ£ Forwarding Refs"></a>7ï¸âƒ£ <strong>Forwarding Refs</strong></h4><p><code>React.forwardRef</code> åœ¨ 16.3 æ–°å¢, å¯ä»¥ç”¨äºè½¬å‘ ref, é€‚ç”¨äº HOC å’Œå‡½æ•°ç»„ä»¶.</p><p>å‡½æ•°ç»„ä»¶åœ¨ 16.8.4 ä¹‹å‰æ˜¯ä¸æ”¯æŒ ref çš„, é…åˆ forwardRef å’Œ useImperativeHandle å¯ä»¥è®©å‡½æ•°ç»„ä»¶å‘å¤–æš´éœ²æ–¹æ³•</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*****************************</span></span><br><span class="line"><span class="comment"> * MyModal.tsx</span></span><br><span class="line"><span class="comment"> ****************************/</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useImperativeHandle, FC, useRef, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyModalProps &#123;</span><br><span class="line">  title?: React.ReactNode;</span><br><span class="line">  onOk?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  onCancel?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æš´éœ²çš„æ–¹æ³•, é€‚ç”¨`&#123;ComponentName&#125;Methods`å½¢å¼å‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MyModalMethods &#123;</span><br><span class="line">  show(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyModal = React.forwardRef&lt;MyModalMethods, MyModalProps&gt;<span class="function">(<span class="params">(<span class="params">props, ref</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> [visible, setVisible] = useState(<span class="params"></span>);</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// åˆå§‹åŒ–refæš´éœ²çš„æ–¹æ³•</span></span></span></span><br><span class="line"><span class="function"><span class="params">  useImperativeHandle(<span class="params">ref, (<span class="params"></span>) =&gt; (<span class="params">&#123;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">    show: (<span class="params"></span>) =&gt; setVisible(<span class="params"><span class="literal">true</span></span>),</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">  &#125;</span>)</span>);</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">return</span> &lt;Modal visible=&#123;visible&#125;&gt;...&lt;/Modal&gt;;</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">/*******************</span></span><br><span class="line"><span class="function"> * <span class="params">Test</span>.<span class="params">tsx</span></span></span><br><span class="line"><span class="function"> *******************/</span></span><br><span class="line"><span class="function"><span class="params">const</span> <span class="params">Test</span>: <span class="params">FC</span>&lt;&#123;&#125;&gt; = <span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> modal = useRef&lt;MyModalMethods | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> confirm = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (modal.current) &#123;</span><br><span class="line">      modal.current.show();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleOk = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;confirm&#125;&gt;show&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;MyModal ref=&#123;modal&#125; onOk=&#123;handleOk&#125; /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="2-ç±»ç»„ä»¶"><a href="#2-ç±»ç»„ä»¶" class="headerlink" title="2. ç±»ç»„ä»¶"></a>2. ç±»ç»„ä»¶</h3><p>ç›¸æ¯”å‡½æ•°, åŸºäºç±»çš„ç±»å‹æ£€æŸ¥å¯èƒ½ä¼šæ›´å¥½ç†è§£(ä¾‹å¦‚é‚£äº›ç†Ÿæ‚‰ä¼ ç»Ÿé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„å¼€å‘è€…).</p><h4 id="1ï¸âƒ£-ç»§æ‰¿-component-æˆ–-purecomponent"><a href="#1ï¸âƒ£-ç»§æ‰¿-component-æˆ–-purecomponent" class="headerlink" title="1ï¸âƒ£ ç»§æ‰¿ Component æˆ– PureComponent"></a>1ï¸âƒ£ <strong>ç»§æ‰¿ Component æˆ– PureComponent</strong></h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¦–å…ˆå¯¼å‡ºPropså£°æ˜, åŒæ ·æ˜¯&#123;ComponentName&#125;Propså½¢å¼å‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> CounterProps &#123;</span><br><span class="line">  defaultCount: <span class="built_in">number</span>; <span class="comment">// å¯é€‰props, ä¸éœ€è¦?ä¿®é¥°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»„ä»¶çŠ¶æ€, ä¸éœ€è¦æš´éœ²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> State &#123;</span><br><span class="line">  count: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç±»æ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * ç»§æ‰¿React.Component, å¹¶å£°æ˜Propså’ŒStateç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;CounterProps, State&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é»˜è®¤å‚æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    defaultCount: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–State</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> state = &#123;</span><br><span class="line">    count: <span class="keyword">this</span>.props.defaultCount,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å£°æ˜å‘¨æœŸæ–¹æ³•</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> componentDidMount() &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å»ºè®®é è¿‘componentDidMount, èµ„æºæ¶ˆè´¹å’Œèµ„æºé‡Šæ”¾é è¿‘åœ¨ä¸€èµ·, æ–¹ä¾¿review</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> componentWillUnmount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidCatch() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> componentDidUpdate(prevProps: CounterProps, prevState: State) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¸²æŸ“å‡½æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.count&#125;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.increment&#125;&gt;Increment&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;this.decrement&#125;&gt;Decrement&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span>**</span><br><span class="line">   * â‘  ç»„ä»¶ç§æœ‰æ–¹æ³•, ä¸æš´éœ²</span><br><span class="line">   * â‘¡ ä½¿ç”¨ç±»å®ä¾‹å±æ€§+ç®­å¤´å‡½æ•°å½¢å¼ç»‘å®š<span class="keyword">this</span></span><br><span class="line">   *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">  private increment = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    this.setState((&#123; count &#125;) =&gt; (&#123; count: count + 1 &#125;));</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  private decrement = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    this.setState((&#123; count &#125;) =&gt; (&#123; count: count - 1 &#125;));</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="2ï¸âƒ£-ä½¿ç”¨static-defaultpropså®šä¹‰é»˜è®¤-props"><a href="#2ï¸âƒ£-ä½¿ç”¨static-defaultpropså®šä¹‰é»˜è®¤-props" class="headerlink" title="2ï¸âƒ£ ä½¿ç”¨static defaultPropså®šä¹‰é»˜è®¤ props"></a>2ï¸âƒ£ <strong>ä½¿ç”¨<code>static defaultProps</code>å®šä¹‰é»˜è®¤ props</strong></h4><p>Typescript <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-0.html#support-for-defaultprops-in-jsx" target="_blank" rel="noopener">3.0</a>å¼€å§‹æ”¯æŒå¯¹ä½¿ç”¨ defaultProps å¯¹ JSX props è¿›è¡Œæ¨æ–­, åœ¨ defaultProps ä¸­å®šä¹‰çš„ props å¯ä»¥ä¸éœ€è¦â€™?â€™å¯é€‰æ“ä½œç¬¦ä¿®é¥°. ä»£ç å¦‚ä¸Š ğŸ‘†</p><p><br></p><h4 id="3ï¸âƒ£-å­ç»„ä»¶å£°æ˜"><a href="#3ï¸âƒ£-å­ç»„ä»¶å£°æ˜" class="headerlink" title="3ï¸âƒ£ å­ç»„ä»¶å£°æ˜"></a>3ï¸âƒ£ <strong>å­ç»„ä»¶å£°æ˜</strong></h4><p>ç±»ç»„ä»¶å¯ä»¥ä½¿ç”¨é™æ€å±æ€§å½¢å¼å£°æ˜å­ç»„ä»¶</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Layout <span class="keyword">extends</span> React.Component&lt;LayoutProps&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Header = Header;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Footer = Footer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div className=<span class="string">"layout"</span>&gt;&#123;<span class="keyword">this</span>.props.children&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="4ï¸âƒ£-æ³›å‹"><a href="#4ï¸âƒ£-æ³›å‹" class="headerlink" title="4ï¸âƒ£ æ³›å‹"></a>4ï¸âƒ£ <strong>æ³›å‹</strong></h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> List&lt;T&gt; <span class="keyword">extends</span> React.Component&lt;ListProps&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> render() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="3-é«˜é˜¶ç»„ä»¶"><a href="#3-é«˜é˜¶ç»„ä»¶" class="headerlink" title="3. é«˜é˜¶ç»„ä»¶"></a>3. é«˜é˜¶ç»„ä»¶</h3><p>åœ¨ React Hooks å‡ºæ¥ä¹‹å‰, é«˜é˜¶ç»„ä»¶æ˜¯ React çš„ä¸€ä¸ªé‡è¦é€»è¾‘å¤ç”¨æ–¹å¼. ç›¸æ¯”è¾ƒè€Œè¨€é«˜é˜¶ç»„ä»¶æ¯”è¾ƒé‡, ä¸”éš¾ä»¥ç†è§£, å®¹æ˜“é€ æˆ<code>åµŒå¥—åœ°ç‹±(wrapper)</code>. å¦å¤–å¯¹ Typescript ç±»å‹åŒ–ä¹Ÿä¸å‹å¥½(ä»¥å‰ä¼šä½¿ç”¨<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/9c1c7e78a9a2b4af8e2cda842c3693f67bb9e42d/types/react-router/index.d.ts#L137" target="_blank" rel="noopener">Omit</a>æ¥è®¡ç®—å¯¼å‡ºçš„ props). æ‰€ä»¥æ–°é¡¹ç›®è¿˜æ˜¯å»ºè®®ä½¿ç”¨ React Hooks.</p><p>ä¸€ä¸ªç®€å•çš„é«˜é˜¶ç»„ä»¶:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜æ³¨å…¥çš„Props</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeProps &#123;</span><br><span class="line">  primary: <span class="built_in">string</span>;</span><br><span class="line">  secondary: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»™æŒ‡å®šç»„ä»¶æ³¨å…¥'ä¸»é¢˜'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">withTheme</span>&lt;<span class="title">P</span>&gt;(<span class="params">Component: React.ComponentType&lt;P &amp; ThemeProps&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * WithTheme è‡ªå·±æš´éœ²çš„Props</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">interface</span> OwnProps &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é«˜é˜¶ç»„ä»¶çš„props, å¿½ç•¥ThemeProps, å¤–éƒ¨ä¸éœ€è¦ä¼ é€’è¿™äº›å±æ€§</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">type</span> WithThemeProps = P &amp; OwnProps;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é«˜é˜¶ç»„ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> WithTheme = <span class="function">(<span class="params">props: WithThemeProps</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‡è®¾themeä»contextä¸­è·å–</span></span><br><span class="line">    <span class="keyword">const</span> fakeTheme: ThemeProps = &#123;</span><br><span class="line">      primary: <span class="string">'red'</span>,</span><br><span class="line">      secondary: <span class="string">'blue'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &lt;Component &#123;...fakeTheme&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  WithTheme.displayName = <span class="string">`withTheme<span class="subst">$&#123;Component.displayName&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> WithTheme;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line"><span class="keyword">const</span> Foo: FC&lt;&#123; a: <span class="built_in">number</span> &#125; &amp; ThemeProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &lt;div style=&#123;&#123; color: props.primary &#125;&#125; /&gt;;</span><br><span class="line"><span class="keyword">const</span> FooWithTheme = withTheme(Foo);</span><br><span class="line">() =&gt; &#123;</span><br><span class="line">  &lt;FooWithTheme a=&#123;<span class="number">1</span>&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†é‡æ„ä¸€ä¸‹:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½å–å‡ºé€šç”¨çš„é«˜é˜¶ç»„ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> HOC&lt;InjectedProps, OwnProps = &#123;&#125;&gt; = &lt;P&gt;(</span><br><span class="line">  Component: React.ComponentType&lt;P &amp; InjectedProps&gt;,</span><br><span class="line">) =&gt; React.ComponentType&lt;P &amp; OwnProps&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜æ³¨å…¥çš„Props</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeProps &#123;</span><br><span class="line">  primary: <span class="built_in">string</span>;</span><br><span class="line">  secondary: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withTheme: HOC&lt;ThemeProps&gt; = <span class="function"><span class="params">Component</span> =&gt;</span> props =&gt; &#123;</span><br><span class="line">  <span class="comment">// å‡è®¾themeä»contextä¸­è·å–</span></span><br><span class="line">  <span class="keyword">const</span> fakeTheme: ThemeProps = &#123;</span><br><span class="line">    primary: <span class="string">'red'</span>,</span><br><span class="line">    secondary: <span class="string">'blue'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &lt;Component &#123;...fakeTheme&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é«˜é˜¶ç»„ä»¶è¿˜æœ‰ä¸€äº›ç—›ç‚¹:</p><ul><li>æ— æ³•å®Œç¾åœ°ä½¿ç”¨ ref(è¿™å·²ä¸ç®—ä»€ä¹ˆç—›ç‚¹)<ul><li>åœ¨ React.forwardRef å‘å¸ƒä¹‹å‰, æœ‰ä¸€äº›åº“ä¼šä½¿ç”¨ innerRef æˆ–è€… wrapperRef, è½¬å‘ç»™å°è£…çš„ç»„ä»¶çš„ ref.</li><li>æ— æ³•æ¨æ–­ ref å¼•ç”¨ç»„ä»¶çš„ç±»å‹, éœ€è¦æ˜¾å¼å£°æ˜.</li></ul></li><li>é«˜é˜¶ç»„ä»¶ç±»å‹æŠ¥é”™å¾ˆéš¾ç†è§£</li></ul><p><br></p><hr><p><br></p><h3 id="4-render-props"><a href="#4-render-props" class="headerlink" title="4. Render Props"></a>4. Render Props</h3><p>React çš„ props(åŒ…æ‹¬ children)å¹¶æ²¡æœ‰é™å®šç±»å‹, å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°. äºæ˜¯å°±æœ‰äº† render props, è¿™æ˜¯å’Œé«˜é˜¶ç»„ä»¶ä¸€æ ·å¸¸è§çš„æ¨¡å¼:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeConsumerProps &#123;</span><br><span class="line">  children: <span class="function">(<span class="params">theme: Theme</span>) =&gt;</span> React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeConsumer = <span class="function">(<span class="params">props: ThemeConsumerProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fakeTheme = &#123; primary: <span class="string">'red'</span>, secondary: <span class="string">'blue'</span> &#125;;</span><br><span class="line">  <span class="keyword">return</span> props.children(fakeTheme);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test</span></span><br><span class="line">&lt;ThemeConsumer&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; primary &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div style=&#123;&#123; color: primary &#125;&#125; /&gt;;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&lt;<span class="regexp">/ThemeConsumer&gt;;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="5-context"><a href="#5-context" class="headerlink" title="5. Context"></a>5. Context</h3><p>Context æä¾›äº†ä¸€ç§è·¨ç»„ä»¶é—´çŠ¶æ€å…±äº«æœºåˆ¶</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useContext &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Theme &#123;</span><br><span class="line">  primary: <span class="built_in">string</span>;</span><br><span class="line">  secondary: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜Contextçš„ç±»å‹, ä»¥&#123;Name&#125;ContextValueå‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThemeContextValue &#123;</span><br><span class="line">  theme: Theme;</span><br><span class="line">  onThemeChange: <span class="function">(<span class="params">theme: Theme</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºContext, å¹¶è®¾ç½®é»˜è®¤å€¼, ä»¥&#123;Name&#125;Contextå‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeContext = React.createContext&lt;ThemeContextValue&gt;(&#123;</span><br><span class="line">  theme: &#123;</span><br><span class="line">    primary: <span class="string">'red'</span>,</span><br><span class="line">    secondary: <span class="string">'blue'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  onThemeChange: noop,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Provider, ä»¥&#123;Name&#125;Providerå‘½å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeProvider: FC&lt;&#123; theme: Theme; onThemeChange: <span class="function">(<span class="params">theme: Theme</span>) =&gt;</span> <span class="built_in">void</span> &#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ThemeContext.Provider value=&#123;&#123; theme: props.theme, onThemeChange: props.onThemeChange &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * æš´éœ²hooks, ä»¥use&#123;Name&#125;å‘½å</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">export function useTheme() &#123;</span></span><br><span class="line"><span class="regexp">  return useContext(ThemeContext);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h3 id="6-æ‚é¡¹"><a href="#6-æ‚é¡¹" class="headerlink" title="6. æ‚é¡¹"></a>6. æ‚é¡¹</h3><h4 id="1ï¸âƒ£-ä½¿ç”¨handleeventå‘½åäº‹ä»¶å¤„ç†å™¨"><a href="#1ï¸âƒ£-ä½¿ç”¨handleeventå‘½åäº‹ä»¶å¤„ç†å™¨" class="headerlink" title="1ï¸âƒ£ ä½¿ç”¨handleEventå‘½åäº‹ä»¶å¤„ç†å™¨."></a>1ï¸âƒ£ <strong>ä½¿ç”¨<code>handleEvent</code>å‘½åäº‹ä»¶å¤„ç†å™¨</strong>.</h4><p>å¦‚æœå­˜åœ¨å¤šä¸ªç›¸åŒäº‹ä»¶å¤„ç†å™¨, åˆ™æŒ‰ç…§<code>handle{Type}{Event}</code>å‘½å, ä¾‹å¦‚ handleNameChange.</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> EventDemo: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback&lt;React.MouseEventHandler&gt;(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    evt.preventDefault();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;button onClick=&#123;handleClick&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="2ï¸âƒ£-å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹"><a href="#2ï¸âƒ£-å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹" class="headerlink" title="2ï¸âƒ£ å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹"></a>2ï¸âƒ£ <strong>å†…ç½®äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹</strong></h4><p><code>@types/react</code>å†…ç½®äº†ä»¥ä¸‹äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹ ğŸ‘‡</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> EventHandler&lt;E <span class="keyword">extends</span> SyntheticEvent&lt;<span class="built_in">any</span>&gt;&gt; = &#123; bivarianceHack(event: E): <span class="built_in">void</span> &#125;[<span class="string">'bivarianceHack'</span>];</span><br><span class="line"><span class="keyword">type</span> ReactEventHandler&lt;T = Element&gt; = EventHandler&lt;SyntheticEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> ClipboardEventHandler&lt;T = Element&gt; = EventHandler&lt;ClipboardEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> CompositionEventHandler&lt;T = Element&gt; = EventHandler&lt;CompositionEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> DragEventHandler&lt;T = Element&gt; = EventHandler&lt;DragEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> FocusEventHandler&lt;T = Element&gt; = EventHandler&lt;FocusEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> FormEventHandler&lt;T = Element&gt; = EventHandler&lt;FormEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> ChangeEventHandler&lt;T = Element&gt; = EventHandler&lt;ChangeEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> KeyboardEventHandler&lt;T = Element&gt; = EventHandler&lt;KeyboardEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> MouseEventHandler&lt;T = Element&gt; = EventHandler&lt;MouseEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> TouchEventHandler&lt;T = Element&gt; = EventHandler&lt;TouchEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> PointerEventHandler&lt;T = Element&gt; = EventHandler&lt;PointerEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> UIEventHandler&lt;T = Element&gt; = EventHandler&lt;UIEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> WheelEventHandler&lt;T = Element&gt; = EventHandler&lt;WheelEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> AnimationEventHandler&lt;T = Element&gt; = EventHandler&lt;AnimationEvent&lt;T&gt;&gt;;</span><br><span class="line"><span class="keyword">type</span> TransitionEventHandler&lt;T = Element&gt; = EventHandler&lt;TransitionEvent&lt;T&gt;&gt;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç®€æ´åœ°å£°æ˜äº‹ä»¶å¤„ç†å™¨ç±»å‹:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ChangeEventHandler &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> EventDemo: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å¯ä»¥é™å®šå…·ä½“Targetçš„ç±»å‹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> handleChange = useCallback&lt;ChangeEventHandler&lt;HTMLInputElement&gt;&gt;(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(evt.target.value);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;input onChange=&#123;handleChange&#125; /&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="3ï¸âƒ£-è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹"><a href="#3ï¸âƒ£-è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹" class="headerlink" title="3ï¸âƒ£ è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹"></a>3ï¸âƒ£ <strong>è‡ªå®šä¹‰ç»„ä»¶æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹</strong></h4><p>å’ŒåŸç”Ÿ html å…ƒç´ ä¸€æ ·, è‡ªå®šä¹‰ç»„ä»¶åº”è¯¥æš´éœ²è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨ç±»å‹, å°¤å…¶æ˜¯è¾ƒä¸ºå¤æ‚çš„äº‹ä»¶å¤„ç†å™¨, è¿™æ ·å¯ä»¥é¿å…å¼€å‘è€…æ‰‹åŠ¨ä¸ºæ¯ä¸ªäº‹ä»¶å¤„ç†å™¨çš„å‚æ•°å£°æ˜ç±»å‹</p><p>è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨ç±»å‹ä»¥<code>{ComponentName}{Event}Handler</code>å‘½å. ä¸ºäº†å’ŒåŸç”Ÿäº‹ä»¶å¤„ç†å™¨ç±»å‹åŒºåˆ†, ä¸ä½¿ç”¨<code>EventHandler</code>å½¢å¼çš„åç¼€</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UploadValue &#123;</span><br><span class="line">  url: <span class="built_in">string</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  size: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æš´éœ²äº‹ä»¶å¤„ç†å™¨ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> UploadChangeHandler = <span class="function">(<span class="params">value?: UploadValue, file?: File</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UploadProps &#123;</span><br><span class="line">  value?: UploadValue;</span><br><span class="line">  onChange?: UploadChangeHandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Upload: FC&lt;UploadProps&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;...&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="4ï¸âƒ£-è·å–åŸç”Ÿå…ƒç´ -props-å®šä¹‰"><a href="#4ï¸âƒ£-è·å–åŸç”Ÿå…ƒç´ -props-å®šä¹‰" class="headerlink" title="4ï¸âƒ£ è·å–åŸç”Ÿå…ƒç´  props å®šä¹‰"></a>4ï¸âƒ£ <strong>è·å–åŸç”Ÿå…ƒç´  props å®šä¹‰</strong></h4><p>æœ‰äº›åœºæ™¯æˆ‘ä»¬å¸Œæœ›åŸç”Ÿå…ƒç´ æ‰©å±•ä¸€ä¸‹ä¸€äº› props. æ‰€æœ‰åŸç”Ÿå…ƒç´  props éƒ½ç»§æ‰¿äº†<code>React.HTMLAttributes</code>, æŸäº›ç‰¹æ®Šå…ƒç´ ä¹Ÿä¼šæ‰©å±•äº†è‡ªå·±çš„å±æ€§, ä¾‹å¦‚<code>InputHTMLAttributes</code>. å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/eafef8bd049017b3998939de2edbab5d8a96423b/types/react/index.d.ts#L203" target="_blank" rel="noopener"><code>React.createElement</code></a>æ–¹æ³•çš„å®ç°</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fixClass</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">T</span> <span class="title">extends</span> <span class="title">Element</span> = <span class="title">HTMLDivElement</span>,</span></span><br><span class="line"><span class="function">  <span class="title">Attribute</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">HTMLAttributes</span>&lt;<span class="title">T</span>&gt; = <span class="title">React</span>.<span class="title">HTMLAttributes</span>&lt;<span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function">&gt;(<span class="params">cls: <span class="built_in">string</span>, <span class="keyword">type</span>: keyof React.ReactHTML = 'div'</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> FixedClassName: FC&lt;Attribute&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(<span class="keyword">type</span>, &#123; ...props, className: <span class="string">`<span class="subst">$&#123;cls&#125;</span> <span class="subst">$&#123;props.className&#125;</span>`</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> FixedClassName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Test</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> Container = fixClass(<span class="string">'card'</span>);</span><br><span class="line"><span class="keyword">const</span> Header = fixClass(<span class="string">'card__header'</span>, <span class="string">'header'</span>);</span><br><span class="line"><span class="keyword">const</span> Body = fixClass(<span class="string">'card__body'</span>, <span class="string">'main'</span>);</span><br><span class="line"><span class="keyword">const</span> Footer = fixClass(<span class="string">'card__body'</span>, <span class="string">'footer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Test = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &lt;Header&gt;header&lt;<span class="regexp">/Header&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Body&gt;header&lt;/</span>Body&gt;</span><br><span class="line">      &lt;Footer&gt;footer&lt;<span class="regexp">/Footer&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Container&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="5ï¸âƒ£-ä¸è¦ä½¿ç”¨-proptypes"><a href="#5ï¸âƒ£-ä¸è¦ä½¿ç”¨-proptypes" class="headerlink" title="5ï¸âƒ£ ä¸è¦ä½¿ç”¨ PropTypes"></a>5ï¸âƒ£ <strong>ä¸è¦ä½¿ç”¨ PropTypes</strong></h4><p>æœ‰äº† Typescript ä¹‹åå¯ä»¥å®‰å…¨åœ°çº¦æŸ Props å’Œ State, æ²¡æœ‰å¿…è¦å¼•å…¥ React.PropTypes, è€Œä¸”å®ƒçš„è¡¨è¾¾èƒ½åŠ›æ¯”è¾ƒå¼±</p><p><br></p><h4 id="6ï¸âƒ£-styled-components"><a href="#6ï¸âƒ£-styled-components" class="headerlink" title="6ï¸âƒ£ styled-components"></a>6ï¸âƒ£ <strong>styled-components</strong></h4><p>styled-components æ˜¯ç›®å‰æœ€æµè¡Œçš„<code>CSS-in-js</code>åº“, Typescript åœ¨ 2.9 æ”¯æŒæ³›å‹<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-9.html#generic-type-arguments-in-generic-tagged-templates" target="_blank" rel="noopener"><code>æ ‡ç­¾æ¨¡æ¿</code></a>. è¿™æ„å‘³ç€å¯ä»¥ç®€å•åœ°å¯¹ styled-components åˆ›å»ºçš„ç»„ä»¶è¿›è¡Œç±»å‹çº¦æŸ</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¾èµ–äº@types/styled-components</span></span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components/macro'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Title = styled.h1&lt;&#123; active?: <span class="built_in">boolean</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; (props.active ? 'red' : 'gray')&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±•å·²æœ‰ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> NewHeader = styled(Header)&lt;&#123; customColor: <span class="built_in">string</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; props.customColor&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p>äº†è§£æ›´å¤š<a href="https://www.styled-components.com/docs/api#typescript" target="_blank" rel="noopener">styled-components å’Œ Typescript</a></p><p><br></p><h4 id="7ï¸âƒ£-ä¸ºæ²¡æœ‰æä¾›-typescript-å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜"><a href="#7ï¸âƒ£-ä¸ºæ²¡æœ‰æä¾›-typescript-å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜" class="headerlink" title="7ï¸âƒ£ ä¸ºæ²¡æœ‰æä¾› Typescript å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜"></a>7ï¸âƒ£ <strong>ä¸ºæ²¡æœ‰æä¾› Typescript å£°æ˜æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“è‡ªå®šä¹‰æ¨¡å—å£°æ˜</strong></h4><p>ç¬”è€…ä¸€èˆ¬ä¹ æƒ¯åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹(å’Œ tsconfig.json åŒåœ¨ä¸€ä¸ªç›®å½•ä¸‹)æ”¾ç½®ä¸€ä¸ª<code>global.d.ts</code>. æ”¾ç½®é¡¹ç›®çš„å…¨å±€å£°æ˜æ–‡ä»¶</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /global.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ¨¡å—å£°æ˜</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> 'awesome-react-component' &#123;</span><br><span class="line">  <span class="comment">// ä¾èµ–å…¶ä»–æ¨¡å—çš„å£°æ˜æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> Foo: React.FC&lt;&#123; a: <span class="built_in">number</span>; b: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº†è§£æ›´å¤š<a href="https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html" target="_blank" rel="noopener">å¦‚ä½•å®šä¹‰å£°æ˜æ–‡ä»¶</a></p><p><br></p><h4 id="8ï¸âƒ£-ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡"><a href="#8ï¸âƒ£-ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡" class="headerlink" title="8ï¸âƒ£ ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡"></a>8ï¸âƒ£ <strong>ä¸ºæ–‡æ¡£ç”Ÿæˆåšå¥½å‡†å¤‡</strong></h4><p>ç›®å‰ç¤¾åŒºæœ‰å¤šç§ react ç»„ä»¶æ–‡æ¡£ç”Ÿæˆæ–¹æ¡ˆ, ä¾‹å¦‚<a href="https://www.docz.site" target="_blank" rel="noopener"><code>docz</code></a>, <a href="https://github.com/styleguidist/react-docgen-typescript" target="_blank" rel="noopener"><code>styleguidist</code></a>è¿˜æœ‰<a href="https://github.com/storybooks/storybook" target="_blank" rel="noopener">storybook</a>. å®ƒä»¬åº•å±‚éƒ½ä½¿ç”¨<a href="https://github.com/styleguidist/react-docgen-typescript" target="_blank" rel="noopener">react-docgen-typescript</a>å¯¹ Typescript è¿›è¡Œè§£æ. å°±ç›®å‰è€Œè¨€, å®ƒè¿˜æœ‰äº›å‘, è€Œä¸”è§£ææ¯”è¾ƒæ…¢. ä¸ç®¡ä¸å¦¨ç¢æˆ‘ä»¬ä½¿ç”¨å®ƒçš„é£æ ¼å¯¹ä»£ç è¿›è¡Œæ³¨é‡Š:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Propsæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ColumnProps <span class="keyword">extends</span> React.HTMLAttributes&lt;any&gt; &#123;</span><br><span class="line">  <span class="comment">/** prop1 description */</span></span><br><span class="line">  prop1?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">/** prop2 description */</span></span><br><span class="line">  prop2: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * prop3 description</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  prop3: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">/** prop4 description */</span></span><br><span class="line">  prop4: <span class="string">'option1'</span> | <span class="string">'option2'</span> | <span class="string">'option3'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹ç»„ä»¶è¿›è¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Column <span class="keyword">extends</span> Component&lt;ColumnProps, &#123;&#125;&gt; &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;Column&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="9ï¸âƒ£-å¼€å¯-strict-æ¨¡å¼"><a href="#9ï¸âƒ£-å¼€å¯-strict-æ¨¡å¼" class="headerlink" title="9ï¸âƒ£ å¼€å¯ strict æ¨¡å¼"></a>9ï¸âƒ£ <strong>å¼€å¯ strict æ¨¡å¼</strong></h4><p>ä¸ºäº†çœŸæ­£æŠŠ Typescript ç”¨èµ·æ¥, åº”è¯¥å§‹ç»ˆå¼€å¯ strict æ¨¡å¼, é¿å…ä½¿ç”¨ any ç±»å‹å£°æ˜.</p><p><br></p><hr><p><br></p><h3 id="æ‰©å±•èµ„æ–™"><a href="#æ‰©å±•èµ„æ–™" class="headerlink" title="æ‰©å±•èµ„æ–™"></a>æ‰©å±•èµ„æ–™</h3><ul><li><a href="https://github.com/piotrwitek/react-redux-typescript-guide" target="_blank" rel="noopener">piotrwitek/react-redux-typescript-guide</a></li><li><a href="https://www.zhihu.com/question/279911703" target="_blank" rel="noopener">TypeScript å¦‚ä½•å®Œç¾åœ°ä¹¦å†™ React ä¸­çš„ HOCï¼Ÿ</a></li><li><a href="https://www.typescriptlang.org/docs/home.html" target="_blank" rel="noopener">Typescript å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://basarat.gitbooks.io/typescript/docs/why-typescript.html" target="_blank" rel="noopener">Typescript-deep-dive</a></li><li><a href="https://github.com/ivan-94/mindnodes/tree/master/è¯­è¨€/Typescript" target="_blank" rel="noopener">Typescript æ€ç»´å¯¼å›¾</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç³»åˆ—å¼•è¨€&quot;&gt;&lt;a href=&quot;#ç³»åˆ—å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;ç³»åˆ—å¼•è¨€&quot;&gt;&lt;/a&gt;ç³»åˆ—å¼•è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘å‡†å¤‡åŸ¹è®­æ–°äºº, ä¸ºäº†æ–¹ä¾¿æ–°äººè¾ƒå¿«å…¥æ‰‹ React å¼€å‘å¹¶ç¼–å†™é«˜è´¨é‡çš„ç»„ä»¶ä»£ç , æˆ‘æ ¹æ®è‡ªå·±çš„å®è·µç»éªŒå¯¹&lt;strong&gt;R
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Rxå»ºæ¨¡å…¥é—¨</title>
    <link href="https://bobi.ink/2019/04/19/rxjs-by-example/"/>
    <id>https://bobi.ink/2019/04/19/rxjs-by-example/</id>
    <published>2019-04-18T16:00:00.000Z</published>
    <updated>2019-05-21T23:07:52.763Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rx çš„å“åº”å¼ç¼–ç¨‹æ€ç»´æ¥å¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œå»ºæ¨¡, ä½ ä¼šäº†è§£åˆ°å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿å’Œä¸šåŠ¡æŠ½è±¡èƒ½åŠ›, å­¦ä¼šå°†ç°æœ‰çš„ä¸šåŠ¡æµç¨‹ä»¥æ•°æ®æµçš„æ–¹å¼è¡¨è¾¾å‡ºæ¥. ä½ çš„å·¥å…·åº“ä¸­ä¸èƒ½å°‘äº† Rx è¿™ä»¶åˆ©å™¨.</p><p>Rx å­¦ä¹ æ›²çº¿é™¡å³­æ˜¯æ€»æ‰€å‘¨çŸ¥çš„, æˆ‘ä»¬æ¥è§¦çš„å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€æˆ–æ¡†æ¶éƒ½æ˜¯é¢å‘å¯¹è±¡çš„. åœ¨é¢å¯¹ Rx è¿™å“åº”å¼ç¼–ç¨‹çš„æ–¹å¼, ä¼šè§‰å¾—æ— ä»å…¥æ‰‹,<br>ç¬”è€…ä¹Ÿæ˜¯ Rx çš„åˆå­¦è€…, æ‹œè¯»è¿‡å¤šæ¬¡<a href="https://www.zhihu.com/people/sharpmaster/posts" target="_blank" rel="noopener">å¾é£</a>Rx çš„ç›¸å…³æ–‡ç« , åŸºæœ¬ä¸Šéƒ½æ˜¯äº‘é‡Œé›¾é‡Œ. ä¸»è¦åŸå› è¿˜æ˜¯æ€ç»´æ²¡æœ‰è½¬æ¢è¿‡æ¥.</p><p>å¦‚æœä½ ä¸ç†è§£å“åº”å¼ç¼–ç¨‹çš„å¥¥å¦™ï¼Œæ˜¯å¾ˆéš¾åœ¨<strong>â€˜é¢å‘åœºæ™¯ç¼–ç¨‹â€™</strong>æ—¶è€ƒè™‘åˆ° Rx çš„ä¼˜åŠ¿. ç¬”è€…ä¸€èˆ¬éµå¾ªâ€™é¢å‘åœºæ™¯ç¼–ç¨‹â€™, å³åœ¨å¯¹åº”çš„åœºæ™¯è€ƒè™‘ä¸åŒçš„æŠ€æœ¯æˆ–æ¡†æ¶. å¯èƒ½æ˜¯ç—›ç‚¹è¿˜æ²¡æœ‰åˆ°éš¾ä»¥å¿å—çš„åœ°æ­¥ï¼Œæˆ–è®¸æ˜¯ç°æœ‰åº”ç”¨è¿˜ä¸å¤Ÿå¤æ‚ï¼Œæˆ‘ç›®å‰ä¸ºæ­¢è¿˜æ²¡æ¥è§¦åˆ°å¿…é¡»è¦åº”ç”¨ Rx çš„åœºæ™¯.</p><p>æˆ‘è§‰å¾—åº”è¯¥åè¿‡æ¥ï¼Œé‡‡å–åˆ»æ„å­¦ä¹ çš„æ–¹å¼æ¥å­¦ä¹  Rx, ä»¥æµçš„æ–¹å¼æ¥æ€è€ƒï¼Œå†å°†å…¶æ”¾åœ¨ç°æœ‰çš„åœºæ™¯ä¸­çœ‹æ˜¯å¦æœ‰æ›´ç®€æ´çš„è§£å†³æ–¹æ¡ˆæˆ–åŒ–å­¦ååº”.<br>ä¸å¾—ä¸è¯´å†™ Rx æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„äº‹æƒ…ã€‚ ä½†ä¹Ÿè¦è®¤è¯†åˆ° Rx ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œæ­£å¦‚å¾ˆå¤šæ•™ç¨‹æ‰€è¯´çš„ Rx æ“…é•¿å¤æ‚çš„å¼‚æ­¥åè°ƒï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚åˆï¼Œä¸€äº›é—®é¢˜æœ‰æ›´ç®€æ´çš„è§£å†³æ–¹æ¡ˆ</p><p><br></p><h2 id="rx-çš„å»ºæ¨¡è¿‡ç¨‹"><a href="#rx-çš„å»ºæ¨¡è¿‡ç¨‹" class="headerlink" title="Rx çš„å»ºæ¨¡è¿‡ç¨‹"></a>Rx çš„å»ºæ¨¡è¿‡ç¨‹</h2><p>å¯¹äº Rx çš„å…¥é—¨è€…, å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æµç¨‹, ä¸€æ­¥ä¸€æ­¥å°†ä¸šåŠ¡é€»è¾‘è½¬æ¢ä¸º Rx æ•°æ®æµæ¥è¿›è¡Œè¡¨è¾¾.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æµç¨‹å›¾ -&gt; æ•°æ®æµæŠ½è±¡ -&gt; å®ç°</span><br></pre></td></tr></table></figure><h3 id="â‘ -æµç¨‹å›¾"><a href="#â‘ -æµç¨‹å›¾" class="headerlink" title="â‘  æµç¨‹å›¾"></a><code>â‘  æµç¨‹å›¾</code></h3><p>é¦–å…ˆä»æµç¨‹å›¾å¼€å§‹, è¿™ä¸ªé˜¶æ®µæ²¡ä»€ä¹ˆç‰¹åˆ«çš„, ä¸ç®¡æ˜¯å“åº”å¼ç¼–ç¨‹è¿˜æ˜¯å…¶ä»–èŒƒå¼, ç¼–ç ä¹‹å‰éƒ½éœ€è¦ç¼•æ¸…ä¸šåŠ¡é€»è¾‘.</p><p>è¿™ä¸ªé˜¶æ®µä½¿ç”¨<code>æµç¨‹å›¾</code>æ¥æè¿°æŠ€æœ¯æ— å…³çš„äº‹åŠ¡è¿‡ç¨‹, è®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…æ™°, ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬è¯†åˆ«ä¸šåŠ¡æµç¨‹çš„ä¸»ä½“å’Œå…³é”®äº‹ä»¶.</p><blockquote><p>ä»€ä¹ˆæ˜¯ä¸šåŠ¡é€»è¾‘? <a href="https://en.wikipedia.org/wiki/Business_logic" target="_blank" rel="noopener">wiki</a> ä¸Šè¿™æ ·å®šä¹‰:<br><strong>Business logic</strong> or domain logic is that part of the program which encodes the real-world business rules that determine how data can be created, displayed, stored, and changed. It prescribes how business objects interact with one another, and enforces the routes and the methods by which business objects are accessed and updated.<br><br> <strong>Business Rules</strong> describe the operations, definitions and constraints that apply to an organization. The operations collectively form a process; every business uses these processes to form systems that get things done.</p></blockquote><p><br><br><br></p><h3 id="â‘¡-æ•°æ®æµæŠ½è±¡"><a href="#â‘¡-æ•°æ®æµæŠ½è±¡" class="headerlink" title="â‘¡ æ•°æ®æµæŠ½è±¡"></a><code>â‘¡ æ•°æ®æµæŠ½è±¡</code></h3><p>Rx çš„ä¸–ç•Œé‡Œé¢<em>ä¸€åˆ‡çš†æµ</em>, æ¢å¥è¯è¯´å°±æ˜¯<strong>é¢å‘æµç¼–ç¨‹</strong>. å’Œ<em>é¢å‘å¯¹è±¡ç¼–ç¨‹</em>æŠŠç°å®ä¸–ç•Œçš„å®ä½“æŠ½è±¡ä¸ºå¯¹è±¡ä¸€æ ·. å“åº”å¼ç¼–ç¨‹å°†ä¸šåŠ¡ä¸­çš„<em>å˜åŠ¨å®ä½“</em>(<em>æƒ³ä¸åˆ°æ›´å¥½çš„è¯, æˆ–è€…å˜é‡?</em>)æŠ½è±¡ä¸ºæµ</p><p><strong>(1)é¦–å…ˆéœ€è¦è¯†åˆ«ä»€ä¹ˆæ˜¯<em>å˜åŠ¨å®ä½“</em></strong>? å˜åŠ¨å®ä½“ä¸€èˆ¬æ˜¯æ•°æ®æµçš„æºå¤´, å®ƒé©±åŠ¨ç€ä¸šåŠ¡èµ°å‘. åƒæ²³æµä¸€æ ·, æºå¤´å¯èƒ½ä¸åªä¸€ä¸ª. æˆ‘è®¤ä¸ºå˜åŠ¨å®ä½“è‡³å°‘å…·å¤‡ä»¥ä¸‹ç‰¹å¾ä¹‹ä¸€:</p><ul><li>å®ƒæ˜¯å˜åŠ¨çš„. ä¾‹å¦‚é¼ æ ‡çš„ä½ç½®, å•†å“çš„ä»·æ ¼, éšç€æ—¶é—´çš„è¿ç§»çŠ¶æ€ä¼šè¿›è¡Œå˜åŠ¨</li><li>å®ƒæ˜¯ä¸šåŠ¡çš„â€™è¾“å…¥â€™. å˜åŠ¨å®ä½“æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„è¾“å…¥(å¤–éƒ¨äº‹ä»¶)æˆ–è€…æ˜¯å¦ä¸€ä¸ªæµ(è¡ç”Ÿ)çš„è¾“å…¥.</li><li>å®ƒæ˜¯ä¸šåŠ¡çš„å‚ä¸è€…(æˆ–è€…è¯´ä¸šåŠ¡çš„ä¸»ä½“).</li><li>å®ƒè¡¨ç¤ºä¸šåŠ¡çš„çŠ¶æ€. ä¾‹å¦‚ä¸€ä¸ª todo åˆ—è¡¨, è¿™æ˜¯ä¸€ä¸ªçº¯çŠ¶æ€çš„æµ</li></ul><p><strong>(2)æ¥ç€è¯†åˆ«<em>å˜åŠ¨å®ä½“</em>ä¹‹é—´çš„å…³ç³»</strong>. ä¸»ä½“ä¹‹é—´çš„å…³ç³»ä¹Ÿå°±æ˜¯æµä¹‹é—´çš„å…³ç³», è¿™æ˜¯ Rx å»ºæ¨¡çš„æ ¸å¿ƒ. åªæœ‰ç†è§£äº†ä¸»ä½“ä¹‹é—´çš„å…³ç³», æ‰èƒ½å°†ä¸»ä½“ä¸ä¸šåŠ¡æµç¨‹ä¸²è”èµ·æ¥, æ‰èƒ½çœŸæ­£åœ°ä½¿ç”¨æ•°æ®æµçš„æ–¹å¼å°†ä¸šåŠ¡è¡¨è¾¾å‡ºæ¥. åœ¨<a href="https://www.jianshu.com/p/c95e29854cb1" target="_blank" rel="noopener">é‡æ–°ç†è§£å“åº”å¼ç¼–ç¨‹</a>ä¸€æ–‡ä¸­å¯¹â€™å“åº”å¼ç¼–ç¨‹â€™çš„å®šä¹‰å’Œç¬”è€…çš„ç†è§£éå¸¸å¥‘åˆ:</p><blockquote><p>å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é€šè¿‡å¼‚æ­¥å’Œæ•°æ®æµæ¥æ„å»ºäº‹åŠ¡å…³ç³»çš„ç¼–ç¨‹æ¨¡å‹ . äº‹åŠ¡å…³ç³»æ˜¯å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒç†å¿µ, â€œæ•°æ®æµâ€å’Œâ€œå¼‚æ­¥â€æ˜¯å®ç°è¿™ä¸ªæ ¸å¿ƒç†å¿µçš„å…³é”®.</p></blockquote><p>è¿™ç§å…³ç³»å’Œé¢å‘å¯¹è±¡çš„ç±»å…³ç³»æ˜¯ä¸ä¸€æ ·çš„, é¢å‘å¯¹è±¡çš„å…³ç³»ä¸€èˆ¬æ˜¯æŒ‡ä¾èµ–å…³ç³». è€Œ<strong>æ•°æ®æµä¹‹é—´å…³ç³», æ˜¯ä¸šåŠ¡ä¹‹é—´çš„å®é™…å…³ç³»</strong>, æ¯”å¦‚æµç¨‹ b ä¾èµ–æµç¨‹ a, æ•°æ®æµæ˜¯å˜åŠ¨å®ä½“ä¹‹é—´çš„æ²Ÿé€šæ¡¥æ¢.</p><p>ä¸€èˆ¬ä»¥ä¸‹é¢çš„æ–¹æ³•æ¥æ„å»ºæµä¹‹é—´çš„å…³ç³»:</p><ul><li>åˆ†æ²»: å°†ä¸šåŠ¡åˆ’åˆ†ä¸ºå¤šä¸ªæ¨¡å—(æµ), ä¸€ä¸ªå¤§çš„æµæ€»æ˜¯ç”±å°çš„æµç»„æˆ, å°çš„æµèŒè´£æ›´å•ä¸€, æ›´å®¹æ˜“ç†è§£å’Œæµ‹è¯•</li><li>å˜æ¢: å°†æµæ˜ å°„ä¸ºå¦å¤–ä¸€ä¸ªæµ. ä¸€èˆ¬ç”¨äºçŠ¶æ€å˜æ›´æˆ–ä¸šåŠ¡è¡ç”Ÿ(é«˜é˜¶æµå˜æ¢)</li><li>åˆå¹¶: åƒæ²³æµä¸€æ ·, æ•°æ®æµæœ€ç»ˆæ˜¯éœ€è¦æ±‡èšåœ¨ä¸€èµ·æ³¨å…¥å¤§æµ·çš„. æ‹†åˆ†å’Œåˆå¹¶çš„æ–¹å¼éƒ½æ˜¯ä¾èµ–äºæ‰€è¦è¡¨è¾¾çš„ä¸šåŠ¡é€»è¾‘</li></ul><p>æ€»çš„æ¥è¯´å˜åŠ¨å®ä½“ä¸€èˆ¬å°±æ˜¯ä¸šåŠ¡çš„â€™<strong>è¾“å…¥</strong>â€˜, æˆ‘ä»¬é¦–å…ˆæŠŠå®ƒä»¬ç¡®å®šä¸ºæµ, å†æ ¹æ®å…³ç³»è¡ç”Ÿå‡ºå…¶ä»–æµ(<strong>è¾“å‡º</strong>). å¯¹äºæµæœ¬èº«æ¥è¯´, <strong>æœ¬è´¨ä¸Šåªæœ‰è¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»</strong>:</p><p><img src="/images/03/stream.png" alt="stream"></p><p>ä¾‹å¦‚ increment$å’Œdecrement$å°±æ˜¯ action$çš„è¾“å…¥, action$å°±æ˜¯ count$çš„è¾“å…¥, ä»¥æ­¤ç±»æ¨. <strong>å“åº”å¼ç¼–ç¨‹å°†å¤æ‚ä¸šåŠ¡å…³ç³»è½¬æ¢æˆåŸå§‹çš„è¾“å‡º/è¾“å‡ºå…³ç³»</strong></p><p><strong>(3)ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„çº¦æŸ</strong>. ä¸€èˆ¬æ¥è¯´, æˆ‘ä»¬è¯´çš„å“åº”å¼ç¼–ç¨‹æŒ‡çš„æ˜¯<code>å‡½æ•°å¼å“åº”å¼ç¼–ç¨‹(Functional reactive programming FRP)</code>, æ‰€ä»¥éœ€è¦ç¬¦åˆå‡½æ•°å¼çš„ä¸€äº›çº¦æŸ:</p><ul><li><code>çº¯å‡½æ•°(Pure)</code>: å‡½æ•°åªæ˜¯è¾“å…¥å‚æ•°åˆ°è¾“å‡ºç»“æœçš„æ˜ å°„, ä¸è¦äº§ç”Ÿå‰¯ä½œç”¨<ul><li>æ²¡æœ‰å…±äº«çŠ¶æ€: ä¸ä¾èµ–å¤–éƒ¨å˜é‡æ¥ç»´æŠ¤æµç¨‹çš„çŠ¶æ€.</li><li>å¹‚ç­‰æ€§: å¹‚ç­‰æ€§åœ¨å¤æ‚æµç¨‹ä¸­å¾ˆé‡è¦, è¿™ä½¿å¾—æ•´ä¸ªæµç¨‹å¯è¢«é‡è¯•</li><li>æ²¡æœ‰å‰¯ä½œç”¨: å¯é¢„æµ‹, å¯æµ‹è¯•.</li></ul></li><li><code>ä¸å¯å˜æ€§(Immuatability)</code>: æ•°æ®ä¸€æ—¦äº§ç”Ÿ, å°±è‚¯å®šå®ƒçš„å€¼ä¸ä¼šå˜åŒ–, è¿™æœ‰åˆ©äºä»£ç çš„ç†è§£. æ˜“äºå¹¶å‘</li><li><code>å£°æ˜å¼(Declarative)</code>:<ul><li>å‡½æ•°å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹ç›¸æ¯”æœ‰è¾ƒé«˜çš„æŠ½è±¡çº§åˆ«, ä»–å¯ä»¥è®©ä½ ä¸“æ³¨äºå®šä¹‰ä¸äº‹ä»¶ç›¸äº’ä¾å­˜çš„ä¸šåŠ¡é€»è¾‘, è€Œä¸æ˜¯åœ¨å®ç°ç»†èŠ‚ä¸Š. æ¢å¥è¯è¯´, å‡½æ•°å¼ç¼–ç¨‹å®šä¹‰å…³ç³», è€Œå‘½ä»¤å¼ç¼–ç¨‹å®šä¹‰æ­¥éª¤</li><li>é›†ä¸­çš„é€»è¾‘. Rx è‡ªç„¶è€Œç„¶åœ¨ä¸€å¤„å®šä¹‰é€»è¾‘, é¿å…å…¶ä»–èŒƒå¼é€»è¾‘åˆ†æ•£åœ¨ä»£ç åº“çš„å„ä¸ªåœ°æ–¹. å¦å¤– Rx çš„ Observable é€šè¿‡è®¢é˜…æ¥åˆ›å»ºèµ„æº, é€šè¿‡å–æ¶ˆè®¢é˜…æ¥é‡Šæ”¾èµ„æº, ä¸€èˆ¬å¼€å‘å‡ ä¹ä¸éœ€è¦å»å…³å¿ƒèµ„æºçš„ç”Ÿå‘½å‘¨æœŸ, ä¾‹å¦‚æ—¶é—´å™¨.</li></ul></li></ul><p>è¿™ä¸ªé˜¶æ®µå°†ç¬¬ä¸€ä¸ªé˜¶æ®µçš„æµç¨‹å›¾è½¬æ¢ä¸º Rx <code>å¼¹ç å›¾(Marble Diagrams)</code>è¡¨ç¤º, å¼¹ç å›¾å¯ä»¥æè¿°æµä¹‹é—´å…³ç³», è¡¨ç°â€™æ—¶é—´â€™çš„æµé€, è®©å¤æ‚çš„æ•°æ®æµæ›´å®¹æ˜“ç†è§£</p><p><br><br><br></p><h3 id="â‘¢-å®ç°"><a href="#â‘¢-å®ç°" class="headerlink" title="â‘¢ å®ç°"></a><code>â‘¢ å®ç°</code></h3><p>è¿™ä¸ªé˜¶æ®µå°±æ˜¯æŠŠå¼¹ç å›¾ç¿»è¯‘ä¸ºå®ç°ä»£ç , æ ¹æ®éœ€æ±‚åœ¨ rxjs å·¥å…·ç®±ä¸­æŸ¥æ‰¾åˆé€‚çš„æ“ä½œç¬¦. å½“ç¼•æ¸…äº†ä¸šåŠ¡é€»è¾‘, ä½¿ç”¨æ•°æ®æµè¿›è¡Œå»ºæ¨¡å,<br>ä»£ç å®ç°å°±æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…äº†.</p><blockquote><p>å¯ä»¥é…åˆ Rxjs å®˜æ–¹çš„<a href="https://rxjs.dev/operator-decision-tree" target="_blank" rel="noopener">æ“ä½œç¬¦å†³ç­–æ ‘</a>é€‰æ‹©åˆé€‚çš„æ“ä½œç¬¦</p></blockquote><p><br></p><hr><p><br></p><p>ä¸‹é¢ä½¿ç”¨ä¾‹å­æ¥ä½“ä¼š Rx çš„ç¼–ç¨‹æ€ç»´:</p><h2 id="example-1-c-a-b"><a href="#example-1-c-a-b" class="headerlink" title="Example 1: c := a + b"></a>Example 1: c := a + b</h2><p>è¿™æ˜¯æœ€ç®€å•çš„å®ä¾‹, æˆ‘ä»¬æœŸæœ›å½“ a å’Œ b å˜åŠ¨æ—¶èƒ½å¤Ÿå“åº”åˆ° c, æˆ‘ä»¬æŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤å¯¹è¿™ä¸ªéœ€æ±‚è¿›è¡Œå»ºæ¨¡:</p><ul><li><p><code>æµç¨‹</code>:</p><p><img src="/images/03/process-02.png" alt="c=a+b"></p></li><li><p><code>æ•°æ®æµæŠ½è±¡</code>: ä»ä¸Šå¯ä»¥è¯†åˆ«å‡ºä¸¤ä¸ªå˜åŠ¨çš„å®ä½“ a å’Œ b, æ‰€ä»¥ a å’Œ b éƒ½å¯ä»¥è§†ä½œæµ, é‚£ä¹ˆ c å°±æ˜¯ a å’Œ b è¡ç”Ÿå‡ºæ¥çš„æµ, è¡¨ç¤º a å’Œ b çš„å®æ—¶åŠ æ³•ç»“æœ, ä½¿ç”¨å¼¹ç å›¾æ¥æè¿°ä¸‰è€…çš„å…³ç³»:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">a$</span>: ----1------------2---------------</span><br><span class="line"><span class="meta">b$</span>: --2-------4------------6------8------</span><br><span class="line">              \ (a + b) /</span><br><span class="line"><span class="meta">c$</span>: ----3-----5------6-----8------10-----</span><br></pre></td></tr></table></figure></li><li><p><code>ä»£ç å®ç°</code>: ç”±å¼¹ç å›¾å¯ä»¥çœ‹å‡º, c$æµçš„è¾“å‡ºå€¼å°±æ˜¯a$å’Œ b$è¾“å‡ºå€¼çš„å®æ—¶è®¡ç®—ç»“æœ, ä¹Ÿå°±æ˜¯è¯´c$æ¥æ”¶æ¥è‡ª a$å’Œb$ çš„æœ€æ–°æ•°æ®, è¾“å‡ºä»–ä»¬çš„å’Œ.<br>å¦å¤–ç”±åŸæœ¬çš„ä¸¤ä¸ªæµåˆå¹¶ä¸ºå•ä¸ªæµ, åœ¨ rxjs å·¥å…·ç®±ä¸­å¯ä»¥æ‰¾åˆ°<code>combineLatest</code>æ“ä½œç¬¦ç¬¦åˆè¯¥åœºæ™¯. ä»£ç å®ç°å¦‚ä¸‹:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a$ = interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">const</span> b$ = interval(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">a$.pipe(combineLatest(b$))</span><br><span class="line">  .pipe(map(<span class="function">(<span class="params">[a, b]</span>) =&gt;</span> a + b))</span><br><span class="line">  .subscribe(<span class="function"><span class="params">sum</span> =&gt;</span> <span class="built_in">console</span>.log(sum));</span><br></pre></td></tr></table></figure></li></ul><p><br></p><hr><p><br></p><h2 id="example-2-å…ƒç´ æ‹–æ‹½çš„ä¾‹å­"><a href="#example-2-å…ƒç´ æ‹–æ‹½çš„ä¾‹å­" class="headerlink" title="Example 2: å…ƒç´ æ‹–æ‹½çš„ä¾‹å­"></a>Example 2: å…ƒç´ æ‹–æ‹½çš„ä¾‹å­</h2><p>å…ƒç´ æ‹–æ‹½ä¹Ÿæ˜¯ Rx çš„ç»å…¸ä¾‹å­çš„çš„ä¾‹å­. å‡è®¾æˆ‘ä»¬éœ€è¦å…ˆç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æ”¯æŒå…ƒç´ æ‹–æ‹½ç§»åŠ¨.</p><p><code>æµç¨‹å›¾</code></p><p><img src="/images/03/process-01.png" alt></p><p><code>æ•°æ®æµæŠ½è±¡</code></p><p>è¿™é‡Œä½¿ç”¨åˆ†æ²»çš„æ–¹æ³•, å°†æµç¨‹è¿›è¡Œä¸€æ­¥æ­¥æ‹†è§£, ç„¶åä½¿ç”¨å¼¹ç å›¾çš„å½¢å¼è¿›è¡Œæè¿°.</p><p>ç”±ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥è¯†åˆ«å‡ºæ¥, down, move ä»¥åŠ up éƒ½æ˜¯<code>å˜åŠ¨å®ä½“</code>, æˆ‘ä»¬å¯ä»¥å°†ä»–ä»¬è§†ä½œâ€™æµâ€™.</p><p>â‘  down/move/up éƒ½æ˜¯æŠ½è±¡çš„äº‹ä»¶, åœ¨æ¡Œé¢ç«¯ä¸‹æ˜¯ mousedown/mousemove/mouseup, ç§»åŠ¨ç«¯ä¸‹å¯¹åº”çš„æ˜¯<br>touchstart/touchmove/touchend. æˆ‘ä»¬ä¸åŒºåˆ†è¿™äº›äº‹ä»¶, ä¾‹å¦‚æ¥æ”¶åˆ° mousedown æˆ– touchstart äº‹ä»¶éƒ½è®¤ä¸ºæ˜¯ä¸€ä¸ªâ€™downâ€™äº‹ä»¶. æ‰€ä»¥äº‹ä»¶ç›‘å¬çš„æ•°æ®æµå¦‚:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> 1</span><br><span class="line"><span class="meta">mousedown$</span> : ---d----------d--------</span><br><span class="line"><span class="meta">touchstart$</span>: -s---s-----------s-----</span><br><span class="line">        \(merge)/</span><br><span class="line"><span class="meta">down$</span>      : -s-d-s--------d--s-----</span><br></pre></td></tr></table></figure><p>move å’Œ up äº‹ä»¶åŒç†</p><p>â‘¡ æ¥ä¸‹æ¥è¦è¯†åˆ« up$, move$, down$ ä¸‰ä¸ªæ•°æ®æµä¹‹é—´çš„å…³ç³», down äº‹ä»¶è§¦å‘åæˆ‘ä»¬æ‰ä¼šå»ç›‘å¬ move å’Œ up äº‹ä»¶, ä¹Ÿå°±æ˜¯è¯´ç”± down$å¯ä»¥è¡ç”Ÿå‡º move$å’Œ up$æµ. åœ¨ up äº‹ä»¶è§¦å‘åæ•´ä¸ªæµç¨‹å°±ç»ˆæ­¢. up$æµå†³å®šäº†æ•´ä¸ªæµç¨‹çš„ç”Ÿå‘½å‘¨æœŸçš„ç»“æŸ</p><p>ä½¿ç”¨å¼¹ç å›¾çš„æè¿°ä¸‰è€…çš„å…³ç³»å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> 2</span><br><span class="line"><span class="meta">down$</span>: -----d-------------------------</span><br><span class="line">             \</span><br><span class="line"><span class="meta">up$</span>  :        ----------u|</span><br><span class="line"><span class="meta">move$</span>:        -m--m--m---|</span><br></pre></td></tr></table></figure><p>â‘¢ ä¸€ä¸ªæ‹–æ‹½ç»“æŸåè¿˜å¯ä»¥é‡æ–°å†å‘èµ·æ‹–æ‹½, å³æˆ‘ä»¬ä¼šæŒç»­ç›‘å¬ down äº‹ä»¶. ä¸Šé¢çš„æµç¨‹è¿˜è§„å®šå¦‚æœå½“å‰æ‹–æ‹½è¿˜æœªç»“æŸ,<br>å…¶ä»– down äº‹ä»¶åº”è¯¥è¢«å¿½ç•¥, åœ¨ç§»åŠ¨ç«¯ä¸‹å¤šç‚¹è§¦æ‘¸æ˜¯å¯èƒ½å¯¼è‡´å¤šä¸ª down äº‹ä»¶è§¦å‘çš„.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> 3</span><br><span class="line"><span class="meta">down$</span>: ---d---d--d---------d------    # ä¸­é—´ä¸¤ä¸ªäº‹ä»¶å› ä¸ºæ‹–æ‹½æœªå®Œæˆè¢«å¿½ç•¥</span><br><span class="line">           \                \</span><br><span class="line"><span class="meta">up$</span>:        -----u|          ------u|</span><br><span class="line"><span class="meta">move$</span>:      -m-mm-|          m-m-m--|</span><br></pre></td></tr></table></figure><p><code>å®ç°</code>:</p><p>æœ‰äº†å¼¹ç å›¾å, å°±æ˜¯æŠŠç¿»è¯‘é—®é¢˜äº†, ç°åœ¨å°±æ‰“å¼€ rxjs çš„å·¥å…·ç®±, æ‰¾æ‰¾æœ‰ä»€ä¹ˆåˆé€‚çš„å·¥å…·.</p><p>é¦–å…ˆæ˜¯æŠ½è±¡äº‹ä»¶çš„å¤„ç†. ç”±#1 å¯ä»¥çœ‹å‡º, è¿™å°±æ˜¯ä¸€ä¸ªæ•°æ®æµåˆå¹¶, è¿™ä¸ªé€‚åˆä½¿ç”¨<code>merge</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">merge(fromEvent(el, <span class="string">'touchstart'</span>), fromEvent(el, <span class="string">'mousedown'</span>));</span><br></pre></td></tr></table></figure><p>down$æµçš„åˆ‡æ¢å¯ä»¥ä½¿ç”¨<code>exhaustMap</code>æ“ä½œç¬¦, è¿™ä¸ªæ“ä½œç¬¦å¯ä»¥å°†è¾“å‡ºå€¼æ˜ å°„ä¸ºObservable, æœ€åå†ä½¿ç”¨exhaustæ“ä½œç¬¦å¯¹Observableè¿›è¡Œåˆå¹¶.<br>è¿™å¯ä»¥æ»¡è¶³æˆ‘ä»¬â€™å½“ä¸€ä¸ªæ‹–æ‹½æœªç»“æŸæ—¶, æ–°å‘èµ·çš„ down$è¾“å‡ºä¼šè¢«å¿½ç•¥, ç›´åˆ°æ‹–æ‹½å®Œç»“â€™çš„éœ€æ±‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">down$</span><br><span class="line">  .pipe(</span><br><span class="line">    exhaustMap(<span class="function"><span class="params">evt</span> =&gt;</span> <span class="comment">/* è½¬æ¢ä¸ºæ–°çš„Observableæµ */</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ exhaustMap æ¥å°† down$è¾“å‡ºå€¼è½¬æ¢ä¸ºmove$ æµ, å¹¶åœ¨ up$ è¾“å‡ºåç»“æŸ, å¯ä»¥ä½¿ç”¨<code>takeUntil</code>æ“ä½œç¬¦:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">down$</span><br><span class="line">  .pipe(</span><br><span class="line">    exhaustMap(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">      evt.preventDefault();</span><br><span class="line">      <span class="keyword">if</span> (evt.type === <span class="string">'mousedown'</span>) &#123;</span><br><span class="line">        <span class="comment">// é¼ æ ‡æ§åˆ¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123; clientX, clientY &#125; = evt <span class="keyword">as</span> MouseEvent;</span><br><span class="line">        <span class="keyword">return</span> mouseMove$.pipe(</span><br><span class="line">          map(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">              deltaX: (evt <span class="keyword">as</span> MouseEvent).clientX - clientX,</span><br><span class="line">              deltaY: (evt <span class="keyword">as</span> MouseEvent).clientY - clientY,</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;),</span><br><span class="line">          takeUntil(mouseUp$),</span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è§¦æ‘¸äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123; touches &#125; = evt <span class="keyword">as</span> TouchEvent;</span><br><span class="line">        <span class="keyword">const</span> touch = touches[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">const</span> &#123; clientX, clientY &#125; = touch;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> getTouch = <span class="function">(<span class="params">evt: TouchEvent</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> touches = <span class="built_in">Array</span>.from(evt.changedTouches);</span><br><span class="line">          <span class="keyword">return</span> touches.find(<span class="function"><span class="params">t</span> =&gt;</span> t.identifier === touch.identifier);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> touchFilter = filter(<span class="function">(<span class="params">e: Event</span>) =&gt;</span> !!getTouch(e <span class="keyword">as</span> TouchEvent));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> touchMove$.pipe(</span><br><span class="line">          touchFilter,</span><br><span class="line">          map(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> touch = getTouch(evt <span class="keyword">as</span> TouchEvent)!;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">              deltaX: touch.clientX - clientX,</span><br><span class="line">              deltaY: touch.clientY - clientY,</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;),</span><br><span class="line">          takeUntil(touchUp$.pipe(touchFilter)),</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">  )</span><br><span class="line">  .subscribe(<span class="function"><span class="params">delta</span> =&gt;</span> &#123;</span><br><span class="line">    el.style.transform = <span class="string">`translate(<span class="subst">$&#123;delta.deltaX&#125;</span>px, <span class="subst">$&#123;delta.deltaY&#125;</span>px)`</span>;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><h2 id="example-3-todos"><a href="#example-3-todos" class="headerlink" title="Example 3: Todos"></a>Example 3: Todos</h2><p>å¦‚æœä½¿ç”¨ rxjs æ¥åˆ›å»º Todos åº”ç”¨, é¦–å…ˆæ˜¯<code>æµç¨‹å›¾</code>:</p><p><img src="/images/03/process-03.png" alt></p><p><code>æ•°æ®æµæŠ½è±¡</code>:</p><p>é¦–å…ˆè¯†åˆ«å˜åŠ¨çš„å®ä½“, å˜åŠ¨çš„å®ä½“å°±æ˜¯ todos åˆ—è¡¨, æ‰€ä»¥å¯ä»¥è®¤ä¸º todos åˆ—è¡¨å°±æ˜¯ä¸€ä¸ªæµ. å®ƒä» localStorage ä¸­æ¢å¤<br>åˆå§‹åŒ–çŠ¶æ€. ç”±<code>æ–°å¢</code>, <code>åˆ é™¤</code>ç­‰äº‹ä»¶è§¦å‘çŠ¶æ€æ”¹å˜, è¿™äº›äº‹ä»¶ä¹Ÿå¯ä»¥è§†ä½œæµ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">add$</span>:      --a-----a------</span><br><span class="line"><span class="meta">modify$</span>:   ----m----------</span><br><span class="line"><span class="meta">remove$</span>    -------r-------</span><br><span class="line"><span class="meta">complete$</span>: ------c----c---</span><br><span class="line">             \(merge)/</span><br><span class="line"><span class="meta">update$</span>    --a-m-cra--c--- # å„ç§äº‹ä»¶åˆå¹¶ä¸ºupdate$æµ</span><br><span class="line">              \(reduce)/</span><br><span class="line"><span class="meta">todos$</span>:    i-u-u-uuu--u---- # i ä¸ºåˆå§‹åŒ–æ•°æ®, update$çš„è¾“å‡ºå°†è§¦å‘é‡æ–°è®¡ç®—çŠ¶æ€</span><br></pre></td></tr></table></figure><p>todos$æµä¼šå“åº”åˆ° view ä¸Š, å¦ä¸€æ–¹é¢éœ€è¦æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨. ä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªå¤šæ’­æµ.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">todos$</span>: i-u-u-uuu--u---- #</span><br><span class="line">          \(debounce)/</span><br><span class="line"><span class="meta">save$</span>   i--u--u---u----- # å­˜å‚¨æµ, ä½¿ç”¨debounceæ¥é¿å…é¢‘ç¹å­˜å‚¨</span><br></pre></td></tr></table></figure><p>å¹¶è¡Œæ¸²æŸ“åˆ°é¡µé¢:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">todos$</span>: i-u-u-uuu--u---- #</span><br><span class="line">       \(render)/</span><br><span class="line"><span class="meta">dom$</span>:   i-u-u-uuu--u---- # domæ¸²æŸ“, å‡è®¾ä¹Ÿæ˜¯æµ(cycle.jså°±æ˜¯å¦‚æ­¤)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå®ä¾‹çš„æ•°æ®æµå’Œ Redux çš„æ¨¡å‹éå¸¸åƒ, add$, modify$, remove$å’Œcomplete$å°±æ˜¯ Action, todos æµä¼šä½¿ç”¨<br>ç±»ä¼¼ Reducer çš„æœºåˆ¶æ¥å¤„ç†è¿™äº› Action ç”Ÿæˆæ–°çš„ State</p><p><img src="/images/03/redux.png" alt="redux"></p><p><code>ä»£ç å®ç°</code>:</p><p>é¦–å…ˆ add$, modify$ä»¥åŠ remove$å’Œcomplete$å¯ä»¥åˆ†åˆ«ä½¿ç”¨ä¸€ä¸ª Subject å¯¹è±¡æ¥è¡¨ç¤º, ç”¨äºæ¥æ”¶å¤–éƒ¨äº‹ä»¶. å…¶å®è¿˜å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªæµ,<br>å®ƒä»¬çš„åŒºåˆ«åªæ˜¯å‚æ•°</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Action&lt;T = any&gt; &#123;</span><br><span class="line">  <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line">  payload: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> INIT_ACTION = <span class="string">'INIT'</span>; <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">const</span> ADD_ACTION = <span class="string">'ADD'</span>;</span><br><span class="line"><span class="keyword">const</span> REMOVE_ACTION = <span class="string">'REMOVE'</span>;</span><br><span class="line"><span class="keyword">const</span> MODIFY_ACTION = <span class="string">'MODIFY'</span>;</span><br><span class="line"><span class="keyword">const</span> COMPLETE_ACTION = <span class="string">'COMPLETE'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> update$ = <span class="keyword">new</span> Subject&lt;Action&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">value: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: ADD_ACTION,</span><br><span class="line">    payload: value,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">id: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: REMOVE_ACTION,</span><br><span class="line">    payload: id,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complete</span>(<span class="params">id: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: COMPLETE_ACTION,</span><br><span class="line">    payload: id,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">modify</span>(<span class="params">id: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  update$.next(&#123;</span><br><span class="line">    <span class="keyword">type</span>: MODIFY_ACTION,</span><br><span class="line">    payload: &#123; id, value &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºtodos$æµ, å¯¹update$ çš„è¾“å‡ºè¿›è¡Œ reduce:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–Store</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initialStore</span>(<span class="params"></span>): <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> value = <span class="built_in">window</span>.localStorage.getItem(STORAGE_KEY);</span><br><span class="line">  <span class="keyword">return</span> value ? <span class="built_in">JSON</span>.parse(value) : &#123; list: [] &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todos$ = update$.pipe(</span><br><span class="line">  <span class="comment">// ä»INIT_ACTION è§¦å‘scanåˆå§‹åŒ–</span></span><br><span class="line">  startWith(&#123; <span class="keyword">type</span>: INIT_ACTION &#125; <span class="keyword">as</span> Action),</span><br><span class="line">  <span class="comment">// reducer</span></span><br><span class="line">  scan&lt;Action, Store&gt;<span class="function">(<span class="params">(<span class="params">state, &#123; <span class="keyword">type</span>, payload &#125;</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> produce(<span class="params">state, draftState =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">let</span> idx: <span class="built_in">number</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">switch</span> (<span class="params"><span class="keyword">type</span></span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> ADD_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          draftState.list.push(<span class="params">&#123;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">            id: <span class="built_in">Date</span>.now(<span class="params"></span>).toString(<span class="params"></span>),</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">            value: payload,</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">          &#125;</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> MODIFY_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          idx = draftState.list.findIndex(<span class="params">i =&gt; i.id === payload.id</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">idx !== -1</span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            draftState.list[idx].value = payload.value;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> REMOVE_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          idx = draftState.list.findIndex(<span class="params">i =&gt; i.id === payload</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">idx !== -1</span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            draftState.list.splice(<span class="params">idx, 1</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">case</span> COMPLETE_ACTION:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          idx = draftState.list.findIndex(<span class="params">i =&gt; i.id === payload</span>);</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">idx !== -1</span>) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            draftState.list[idx].completed = <span class="literal">true</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">break</span>;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="keyword">default</span>:</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, initialStore(<span class="params"></span>)</span>),</span></span><br><span class="line"><span class="function">  // æ”¯æŒå¤šæ’­</span></span><br><span class="line"><span class="function">  <span class="params">shareReplay</span><span class="params">()</span>,</span></span><br><span class="line"><span class="function">);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// æŒä¹…åŒ–</span></span><br><span class="line"><span class="function"><span class="params">todos</span>$.<span class="params">pipe</span>(<span class="params">debounceTime(<span class="params">1000</span>)</span>).<span class="params">subscribe</span>(<span class="params">store =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="built_in">window</span>.localStorage.setItem(<span class="params">STORAGE_KEY, <span class="built_in">JSON</span>.stringify(<span class="params">store</span>)</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>);</span></span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šä¾‹å­: å¾é£åœ¨<a href="https://github.com/xufei/blog/issues/44" target="_blank" rel="noopener">â€œRxJS å…¥é—¨æŒ‡å¼•å’Œåˆæ­¥åº”ç”¨&gt;â€</a>æåˆ°äº†ä¸€ä¸ªâ€å¹¸ç¦äººç”Ÿâ€çš„ä¾‹å­, æŒºæœ‰æ„æ€, è¯»è€…å¯ä»¥å°è¯•å¯¹å…¶è¿›è¡Œå»ºæ¨¡</p></blockquote><p><br></p><hr><p><br></p><p>ç»è¿‡ä¸Šè¿°è¿‡ç¨‹, å¯ä»¥æ·±åˆ»ä½“ä¼šåˆ°<em>å‡½æ•°å“åº”å¼ç¼–ç¨‹</em>çš„<strong>ä¼˜åŠ¿</strong>:</p><ul><li><strong>æ•°æ®æµæŠ½è±¡äº†å¾ˆå¤šç°å®é—®é¢˜</strong>. ä¹Ÿå°±è¯´æ•°æ®æµå¯¹ä¸šåŠ¡é€»è¾‘çš„è¡¨è¾¾èƒ½åŠ›æµç¨‹å›¾åŸºæœ¬ä¸€è‡´. å¯ä»¥è¯´å¼¹ç å›¾æ˜¯æµç¨‹å›¾çš„ç›´è§‚ç¿»è¯‘, è€Œ Rx ä»£ç åˆ™æ˜¯å¼¹ç å›¾çš„ç›´è§‚ç¿»è¯‘. ä½¿ç”¨ Rx ä»¥å£°æ˜å¼å½¢å¼ç¼–å†™ä»£ç , å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç†è§£, å› ä¸ºå®ƒä»¬æ¥è¿‘ä¸šåŠ¡æµç¨‹.</li><li><strong>æŠŠå¤æ‚çš„é—®é¢˜åˆ†è§£æˆç®€å•çš„é—®é¢˜çš„ç»„åˆ</strong>. Rx ç¼–ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®æµçš„åˆ†æ²»å’Œåˆå¹¶</li></ul><h2 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h2><ul><li><a href="https://www.jianshu.com/p/c95e29854cb1" target="_blank" rel="noopener">é‡æ–°ç†è§£å“åº”å¼ç¼–ç¨‹</a></li><li><a href="https://zhuanlan.zhihu.com/p/53009201" target="_blank" rel="noopener">ã€å“åº”å¼ç¼–ç¨‹çš„æ€ç»´è‰ºæœ¯ã€‘å“åº”å¼ Vs é¢å‘å¯¹è±¡</a></li><li><a href="http://www.uml.org.cn/zjjs/201008021.asp" target="_blank" rel="noopener">ç»†è¯´ä¸šåŠ¡é€»è¾‘</a></li><li><a href="https://en.wikipedia.org/wiki/Reactive_programming" target="_blank" rel="noopener">Reactive programming</a></li><li><a href="https://github.com/xufei/blog/issues/44" target="_blank" rel="noopener">RxJS å…¥é—¨æŒ‡å¼•å’Œåˆæ­¥åº”ç”¨</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rx çš„å“åº”å¼ç¼–ç¨‹æ€ç»´æ¥å¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œå»ºæ¨¡, ä½ ä¼šäº†è§£åˆ°å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿å’Œä¸šåŠ¡æŠ½è±¡èƒ½åŠ›, å­¦ä¼šå°†ç°æœ‰çš„ä¸šåŠ¡æµç¨‹ä»¥æ•°æ®æµçš„æ–¹å¼è¡¨è¾¾å‡ºæ¥. ä½ çš„å·¥å…·åº“ä¸­ä¸èƒ½å°‘äº† Rx è¿™ä»¶åˆ©å™¨.&lt;/p&gt;
&lt;p&gt;Rx å­¦ä¹ æ›²çº¿é™¡å³­æ˜¯æ€»æ‰€å‘¨çŸ¥çš„, æˆ‘ä»¬æ¥è§¦çš„å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€æˆ–æ¡†æ¶éƒ½
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Yarn Plug&#39;n&#39;Playå¯å¦åŠ©ä½ è„±ç¦»node_modulesè‹¦æµ·?</title>
    <link href="https://bobi.ink/2019/04/08/plug-n-play/"/>
    <id>https://bobi.ink/2019/04/08/plug-n-play/</id>
    <published>2019-04-07T16:00:00.000Z</published>
    <updated>2019-04-07T04:18:21.737Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ Yarn(v1.12+)çš„ Plugâ€™nâ€™Play æœºåˆ¶æ¥å–ä»£ node_modules. ç›®å‰è¿™è¿˜æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ç‰¹æ€§.</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p><img src="/images/node_modules-hole.png" alt="node_modules"></p><p><code>node_modules</code>æ—©å°±æˆä¸ºçš„å…¨æ°‘åæ§½çš„å¯¹è±¡, å…¶ä»–è¯­è¨€çš„å¼€å‘è€…çœ‹åˆ° node_modules å¯¹ Node å°±æœ›è€Œç¥›æ­¥äº†,<br>ç”¨ä¸€ä¸ªå­—æ¥å½¢å®¹çš„è¯å°±æ˜¯â€™é‡!â€™.</p><blockquote><p>å¦‚æœä¸äº†è§£ Node æ¨¡å—æŸ¥æ‰¾æœºåˆ¶, è¯·ç‚¹å‡»<a href="http://www.ruanyifeng.com/blog/2015/05/require.html" target="_blank" rel="noopener">require() æºç è§£è¯»</a></p></blockquote><p>ä¸€ä¸ªç®€å•çš„å‰ç«¯é¡¹ç›®(<em>create-react-app</em>)çš„å¤§å°å’Œæ–‡ä»¶æ•°:</p><center><br>  <img src="/images/front-end-project.png" alt="frontend-project" width="400"><br></center><p>è€Œ macOS çš„<code>/Library</code>ç›®å½•çš„å¤§å°çš„æ–‡ä»¶æ•°:</p><center><br>  <img src="/images/mac-library.png" alt="macos library" width="400"><br></center><p>ä¸€è¡Œ<code>hello world</code>å°±éœ€è¦å®‰è£… 130MB ä»¥ä¸Šçš„ä¾èµ–æ¨¡å—, è€Œä¸”æ–‡ä»¶æ•°æ˜¯<strong>32,313</strong>. ç›¸æ¯”ä¹‹ä¸‹ macOS çš„<code>/Library</code><br>çš„ç©ºé—´å ç”¨ 9.02GB, æ–‡ä»¶æ•°åªæ˜¯å‰è€…çš„ä¸¤å€(<strong>67,890</strong>). ç»¼ä¸Šå¯ä»¥çœ‹å‡º node_modules çš„ç‰¹ç‚¹æ˜¯:</p><ul><li>ç›®å½•æ ‘ç»“æ„å¤æ‚</li><li>æ–‡ä»¶æ•°è¾ƒå¤šä¸”éƒ½æ¯”è¾ƒå°</li><li>ä¾èµ–å¤š, ä¸€ä¸ªç®€å•çš„é¡¹ç›®å°±è¦å®‰è£…å¥½å‡ å¨ä¾èµ–</li></ul><p>æ‰€ä»¥è¯´ node_modules å¯¹äºæœºæ¢°ç¡¬ç›˜æ¥è¯´æ˜¯ä¸ªå™©æ¢¦, è®°å¾—æœ‰ä¸€æ¬¡ä¸€ä¸ªåŒäº‹åˆ é™¤ node_modules ä¸€ä¸ªä¸‹åˆéƒ½æ²¡æå®š.<br>å¯¹äºå‰ç«¯å¼€å‘è€…æ¥è¯´, æˆ‘ä»¬æœ‰ N ä¸ªéœ€è¦<code>npm install</code>çš„é¡¹ç›® ğŸ˜¹.</p><p>é™¤æ­¤ä¹‹å¤–, Node çš„æ¨¡å—æœºåˆ¶è¿˜æœ‰ä»¥ä¸‹<strong>ç¼ºç‚¹</strong>:</p><ul><li><p>Node æœ¬èº«å¹¶æ²¡æœ‰æ¨¡å—çš„æ¦‚å¿µ, å®ƒåœ¨è¿è¡Œæ—¶è¿›è¡ŒæŸ¥æ‰¾å’ŒåŠ è½½. è¿™ä¸ªç¼ºç‚¹å’Œ<em>â€˜åŠ¨æ€è¯­è¨€ä¸é™æ€è¯­è¨€çš„ä¼˜åŠ£å¯¹æ¯”â€™</em>ç›¸ä¼¼,<br>ä½ å¯èƒ½åœ¨å¼€å‘ç¯å¢ƒè¿è¡Œå¾—å¥½å¥½çš„, å¯èƒ½åˆ°äº†çº¿ä¸Šå°±è¿è¡Œä¸äº†äº†, åŸå› æ˜¯ä¸€ä¸ªæ¨¡å—æ²¡æœ‰æ·»åŠ åˆ° package.json</p></li><li><p>Node æ¨¡å—çš„æŸ¥æ‰¾ç­–ç•¥éå¸¸æµªè´¹. è¿™ä¸ªç¼ºç‚¹åœ¨å¤§éƒ¨åˆ†å‰ç«¯é¡¹ç›®ä¸­å¯ä»¥è¿›è¡Œä¼˜åŒ–,<br>æ¯”å¦‚ webpack å°±å¯ä»¥é™å®šåªåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ node_modules ä¸­æŸ¥æ‰¾, ä½†æ˜¯å¯¹äºåµŒå¥—çš„ä¾èµ–, ä¾ç„¶éœ€è¦ 2 æ¬¡ä»¥ä¸Šçš„æŸ¥æ‰¾</p></li><li><p>node_modules ä¸èƒ½æœ‰æ•ˆåœ°å¤„ç†é‡å¤çš„åŒ…. ä¸¤ä¸ªåç§°ç›¸åŒä½†æ˜¯ä¸åŒç‰ˆæœ¬çš„åŒ…æ˜¯ä¸èƒ½åœ¨ä¸€ä¸ªç›®å½•ä¸‹å…±å­˜çš„.<br>æ‰€ä»¥ä¼šå¯¼è‡´åµŒå¥—çš„ node_modules, è€Œä¸”è¿™äº›é¡¹ç›®â€™ä¾èµ–çš„ä¾èµ–â€™æ˜¯æ— æ³•å’Œé¡¹ç›®æˆ–å…¶ä»–ä¾èµ–å…±äº«çš„:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> â‘  å‡è®¾é¡¹ç›®ä¾èµ–a,b,cä¸‰ä¸ªæ¨¡å—, ä¾èµ–æ ‘ä¸º:</span><br><span class="line"><span class="meta">#</span>  +- a</span><br><span class="line"><span class="meta">#</span>    +- react@15</span><br><span class="line"><span class="meta">#</span>  +- b</span><br><span class="line"><span class="meta">#</span>    +- react@16</span><br><span class="line"><span class="meta">#</span>  +- c</span><br><span class="line"><span class="meta">#</span>    +- react@16</span><br><span class="line"><span class="meta">#</span> yarnå®‰è£…æ—¶ä¼šæŒ‰ç…§é¡¹ç›®è¢«ä¾èµ–çš„æ¬¡æ•°ä½œä¸ºæƒé‡, å°†ä¾èµ–æå‡(hoisting),</span><br><span class="line"><span class="meta">#</span> å®‰è£…åçš„node_modulesç»“æ„ä¸º:</span><br><span class="line">  .</span><br><span class="line">  â””â”€â”€ node_modules</span><br><span class="line">   Â Â  â”œâ”€â”€ a</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">   Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react  # @15</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â”œâ”€â”€ b</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â”œâ”€â”€ c</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â””â”€â”€ react  # @16 è¢«ä¾èµ–äº†ä¸¤æ¬¡, æ‰€ä»¥è¿›è¡Œæå‡</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> â‘¡ ç°åœ¨å‡è®¾åœ¨â‘ çš„åŸºç¡€ä¸Š, æ ¹é¡¹ç›®ä¾èµ–äº†react@15, å¯¹äºé¡¹ç›®è‡ªå·±çš„ä¾èµ–è‚¯å®šæ˜¯è¦æ”¾åœ¨node_modulesæ ¹ç›®å½•çš„,</span><br><span class="line"><span class="meta">#</span> ç”±äºä¸€ä¸ªç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåç›®å½•, æ‰€ä»¥react@16æ²¡æœ‰çš„æå‡æœºä¼š. </span><br><span class="line"><span class="meta">#</span> å®‰è£…ånode_moduelsç»“æ„ä¸º</span><br><span class="line">  .</span><br><span class="line">  â””â”€â”€ node_modules</span><br><span class="line">   Â Â  â”œâ”€â”€ a</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json # react@15 æå‡</span><br><span class="line">   Â Â  â”œâ”€â”€ b</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">   Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react  # @16</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â”œâ”€â”€ c</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">   Â Â  â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">   Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react  # @16</span><br><span class="line">   Â Â  â”‚Â Â  â””â”€â”€ package.json</span><br><span class="line">   Â Â  â””â”€â”€ react  # @15</span><br><span class="line"><span class="meta">#</span> ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡º, react@16å‡ºç°äº†é‡å¤</span><br></pre></td></tr></table></figure></li></ul><p>ä¸ºæ­¤ Yarn é›†æˆäº†<code>Plug&#39;n&#39;Play</code>(ç®€ç§° pnp), ä¸­æ–‡åç§°å¯ä»¥ç§°ä¸ºâ€™å³æ’å³ç”¨â€™, æ¥è§£å†³ node_modulesâ€™åœ°ç‹±â€™.</p><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><p>æŒ‰ç…§æ™®é€šçš„æŒ‰ç…§æµç¨‹, Yarn ä¼šç”Ÿæˆä¸€ä¸ª node_modules ç›®å½•, ç„¶å Node æŒ‰ç…§å®ƒçš„æ¨¡å—æŸ¥æ‰¾è§„åˆ™åœ¨ node_modules ç›®å½•ä¸­æŸ¥æ‰¾.<br>ä½†å®é™…ä¸Š Node å¹¶ä¸çŸ¥é“è¿™ä¸ªæ¨¡å—æ˜¯ä»€ä¹ˆ, å®ƒåœ¨ node_modules æŸ¥æ‰¾, æ²¡æ‰¾åˆ°å°±åœ¨çˆ¶ç›®å½•çš„ node_modules æŸ¥æ‰¾, ä»¥æ­¤ç±»æ¨.<br>è¿™ä¸ªæ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„.</p><p><strong>ä½†æ˜¯ Yarn ä½œä¸ºä¸€ä¸ªåŒ…ç®¡ç†å™¨, å®ƒçŸ¥é“ä½ çš„é¡¹ç›®çš„ä¾èµ–æ ‘. é‚£èƒ½ä¸èƒ½è®© Yarn å‘Šè¯‰ Node? è®©å®ƒç›´æ¥åˆ°æŸä¸ªç›®å½•å»åŠ è½½æ¨¡å—.<br>è¿™æ ·å³å¯ä»¥æé«˜ Node æ¨¡å—çš„æŸ¥æ‰¾æ•ˆç‡, ä¹Ÿå¯ä»¥å‡å°‘ node_modules æ–‡ä»¶çš„æ‹·è´. è¿™å°±æ˜¯<code>Plug&#39;n&#39;Play</code>çš„åŸºæœ¬åŸç†.</strong></p><p>åœ¨ pnp æ¨¡å¼ä¸‹, Yarn ä¸ä¼šåˆ›å»º node_modules ç›®å½•, å–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ª<code>.png.js</code>æ–‡ä»¶, è¿™æ˜¯ä¸€ä¸ª node ç¨‹åº,<br>è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†é¡¹ç›®çš„ä¾èµ–æ ‘ä¿¡æ¯, æ¨¡å—æŸ¥æ‰¾ç®—æ³•, ä¹ŸåŒ…å«äº†æ¨¡å—æŸ¥æ‰¾å™¨çš„ patch ä»£ç (åœ¨ Node ç¯å¢ƒ, è¦†ç›– Module._load æ–¹æ³•).</p><p><br></p><p>ä½¿ç”¨ pnp æœºåˆ¶çš„ä»¥ä¸‹<strong>ä¼˜ç‚¹</strong>:</p><ul><li>æ‘†è„± node_modules.<ul><li>æ—¶é—´ä¸Š: ç›¸æ¯”è¾ƒåœ¨çƒ­ç¼“å­˜(hot cache)ç¯å¢ƒä¸‹è¿è¡Œ<code>yarn install</code>èŠ‚çœ 70%çš„æ—¶é—´</li><li>ç©ºé—´ä¸Š: pnp æ¨¡å¼ä¸‹, æ‰€æœ‰ npm æ¨¡å—éƒ½ä¼šå­˜æ”¾åœ¨å…¨å±€çš„ç¼“å­˜ç›®å½•ä¸‹, ä¾èµ–æ ‘æ‰å¹³åŒ–, é¿å…æ‹·è´å’Œé‡å¤</li></ul></li><li>æé«˜æ¨¡å—åŠ è½½æ•ˆç‡. Node ä¸ºäº†æŸ¥æ‰¾æ¨¡å—, éœ€è¦è°ƒç”¨å¤§é‡çš„ stat å’Œ readdir ç³»ç»Ÿè°ƒç”¨.<br>pnp é€šè¿‡ Yarn è·å–æˆ–è€…æ¨¡å—ä¿¡æ¯, ç›´æ¥å®šä½æ¨¡å—</li><li>ä¸å†å—é™äº node_modules åŒåæ¨¡å—ä¸åŒç‰ˆæœ¬ä¸èƒ½åœ¨åŒä¸€ç›®å½•</li></ul><blockquote><p>åœ¨ Mac ä¸‹ Yarn çš„å®‰è£…é€Ÿåº¦éå¸¸å¿«, çƒ­ç¼“å­˜ä¸‹ä»…éœ€å‡ ç§’. åŸå› æ˜¯ SSD + APFS çš„ Copy-on-write æœºåˆ¶.<br>è¿™ä½¿å¾—æ–‡ä»¶çš„æ‹·è´ä¸ç”¨å ç”¨ç©ºé—´, ç›¸å½“äºåˆ›å»ºä¸€ä¸ªé“¾æ¥. æ‰€ä»¥æ‹·è´å’Œåˆ é™¤çš„é€Ÿåº¦éå¸¸å¿«.<br>ä½†æ˜¯ node_modules å¤æ‚çš„ç›®å½•ç»“æ„å’Œè¶…å¤šçš„æ–‡ä»¶, ä»ç„¶éœ€è¦è°ƒç”¨å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨, è¿™ä¹Ÿä¼šæ‹–æ…¢å®‰è£…è¿‡ç¨‹.<br><br><br>ğŸ’¡ å¦‚æœè§‰å¾— pnp ç¹çæˆ–ä¸å¯é , é‚£å°±èµ¶ç´§ç”¨ä¸Š SSD é…åˆæ”¯æŒ Copy-on-write çš„æ–‡ä»¶ç³»ç»Ÿ.</p></blockquote><p><br></p><p>ä½¿ç”¨ pnp çš„<strong>é£é™©</strong>:</p><p>ç›®å‰å‰ç«¯ç¤¾åŒºçš„å„ç§å·¥å…·éƒ½ä¾èµ–äº node_modules æ¨¡å—æŸ¥æ‰¾æœºåˆ¶. ä¾‹å¦‚</p><ul><li>Node</li><li>Electron, electron-builder ç­‰ç­‰</li><li>Webpack</li><li>Typescript: å®šä½ç±»å‹å£°æ˜æ–‡ä»¶</li><li>Babel: å®šä½æ’ä»¶å’Œ preset</li><li>Eslint: å®šä½æ’ä»¶å’Œ preset, rules</li><li>Jest</li><li>ç¼–è¾‘å™¨, å¦‚ VsCode</li><li>â€¦ğŸ˜¿</li></ul><p>pnp ä¸€ä¸ªéå¸¸æ–°çš„ä¸œè¥¿, åœ¨å»å¹´ 9 æœˆä»½(2018)é¢ä¸–. è¦è®©è¿™äº›å·¥å…·å’Œ pnp é›†æˆæ˜¯ä¸ªä¸å°çš„æŒ‘æˆ˜, è€Œä¸”è¿™äº›è¿™äº›å·¥å…·<br>å’Œ pnp éƒ½æ˜¯åœ¨ä¸æ–­è¿­ä»£çš„, pnp è¿˜ä¸ç¨³å®š, æœªæ¥å¯èƒ½å˜åŒ–, è¿™ä¹Ÿä¼šå¸¦æ¥æŸäº›ç»´æŠ¤æ–¹é¢çš„è´Ÿæ‹….</p><p>é™¤äº†æ¨¡å—æŸ¥æ‰¾æœºåˆ¶, æœ‰ä¸€äº›å·¥å…·æ˜¯ç›´æ¥åœ¨ node_modules ä¸­åšå…¶ä»–äº‹æƒ…çš„, æ¯”å¦‚ç¼“å­˜, å­˜æ”¾ä¸´æ—¶è¯ä¹¦. ä¾‹å¦‚<code>cache-loader</code>, <code>webpack-dev-server</code></p><h2 id="å¼€å¯-pnp"><a href="#å¼€å¯-pnp" class="headerlink" title="å¼€å¯ pnp"></a>å¼€å¯ pnp</h2><p>å¦‚æœåªæ˜¯å•çº¯çš„ Node é¡¹ç›®, è¿å…¥è¿‡ç¨‹è¿˜ç®—æ¯”è¾ƒç®€å•. é¦–å…ˆåœ¨<code>package.json</code>å¼€å¯ pnp å®‰è£…æ¨¡å¼:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"installConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"pnp"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å®‰è£…ä¾èµ–:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yarn add express</span><br></pre></td></tr></table></figure><p>å®‰è£…åé¡¹ç›®æ ¹ç›®å½•å°±ä¼šå‡ºç°ä¸€ä¸ª<code>.pnp.js</code>æ–‡ä»¶. ä¸‹ä¸€æ­¥ç¼–å†™ä»£ç :</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'Hello World!'</span>));</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>));</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯è¿è¡Œ Node ä»£ç äº†, å¦‚æœç›´æ¥<code>node index.js</code>ä¼šæŠ¥<code>Error: Cannot find module &#39;express&#39;</code>å¼‚å¸¸.<br>è¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰ patch Node çš„æ¨¡å—æŸ¥æ‰¾å™¨. å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yarn node</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æˆ–è€…</span><br><span class="line"></span><br><span class="line">node --require="./.pnp.js" index.js</span><br></pre></td></tr></table></figure><blockquote><p><code>.pnp.js</code>æ–‡ä»¶ä¸åº”è¯¥æäº¤åˆ°ç‰ˆæœ¬åº“, è¿™ä¸ªæ–‡ä»¶é‡Œé¢åŒ…å«äº†ç¡¬ç¼–ç çš„ç¼“å­˜ç›®å½•. åœ¨ Yarn v2 ä¸­ä¼šè¿›è¡Œé‡æ„</p></blockquote><h2 id="æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®"><a href="#æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®" class="headerlink" title="æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®?"></a>æ€ä¹ˆé›†æˆåˆ°ç°æœ‰é¡¹ç›®?</h2><p>pnp é›†æˆæ— éå°±æ˜¯é‡æ–°å®ç°ç°æœ‰å·¥å…·çš„æ¨¡å—æŸ¥æ‰¾æœºåˆ¶. éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„å‘å±•, ä¸€ä¸ªå‰ç«¯é¡¹ç›®ä¼šé›†æˆéå¸¸å¤šçš„å·¥å…·,<br>å¦‚æœè¿™äº›å·¥å…·æ²¡æ³•é€‚é…, å¯ä»¥è¯´ pnp å¾ˆéš¾å¾€å‰èµ°. ç„¶è€Œè¿™å¹¶ä¸æ˜¯ pnp èƒ½å¤Ÿæ§åˆ¶çš„, éœ€è¦è¿™äº›å·¥å…·å¼€å‘è€…çš„é…åˆ.</p><p>ç¤¾åŒºä¸Šä¸å°‘é¡¹ç›®å·²ç»é›†æˆäº† pnp:</p><ul><li><a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a></li><li><a href="https://github.com/gatsbyjs/gatsby" target="_blank" rel="noopener">gastby</a></li></ul><p><br></p><h3 id="node"><a href="#node" class="headerlink" title="Node"></a>Node</h3><p>å¯¹äº Node, pnp æ˜¯å¼€ç®±å³ç”¨çš„, ç›´æ¥ä½¿ç”¨<code>--require=&quot;./.pnp.js&quot;</code>å¯¼å…¥<code>.pnp.js</code>æ–‡ä»¶å³å¯,<br><code>.pnp.js</code>ä¼šå¯¹ Node çš„ Module å¯¹è±¡è¿›è¡Œ patch, é‡æ–°å®ç°æ¨¡å—æŸ¥æ‰¾æœºåˆ¶</p><h3 id="webpack"><a href="#webpack" class="headerlink" title="Webpack"></a>Webpack</h3><p>Webpack ä½¿ç”¨çš„æ¨¡å—æŸ¥æ‰¾å™¨æ˜¯<a href="https://github.com/webpack/enhanced-resolve" target="_blank" rel="noopener"><code>enhanced-resolve</code></a>, å¯ä»¥é€šè¿‡<a href="https://github.com/arcanis/pnp-webpack-plugin" target="_blank" rel="noopener"><code>pnp-webpack-plugin</code></a>æ’ä»¶æ¥æ‰©å±•<code>enhanced-resolve</code><br>æ¥æ”¯æŒ pnp.</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PnpWebpackPlugin = <span class="built_in">require</span>(<span class="string">`pnp-webpack-plugin`</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•æ¨¡å—æŸ¥æ‰¾å™¨</span></span><br><span class="line">    plugins: [PnpWebpackPlugin],</span><br><span class="line">  &#125;,</span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•loaderæ¨¡å—æŸ¥æ‰¾å™¨.</span></span><br><span class="line">    plugins: [PnpWebpackPlugin.moduleLoader(<span class="built_in">module</span>)],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="jest"><a href="#jest" class="headerlink" title="jest"></a>jest</h3><p><a href="http://jestjs.io" target="_blank" rel="noopener">jest</a>æ”¯æŒé€šè¿‡<code>resolver</code>æ¥é…ç½®æŸ¥æ‰¾å™¨:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolver: <span class="built_in">require</span>.resolve(<span class="string">`jest-pnp-resolver`</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="typescript"><a href="#typescript" class="headerlink" title="Typescript"></a>Typescript</h3><p>Typescript ä¹Ÿä½¿ç”¨è‡ªå·±çš„æ¨¡å—æŸ¥æ‰¾å™¨, TSå›¢é˜Ÿä¸ºäº†æ€§èƒ½æ–¹é¢çš„è€ƒè™‘, æš‚æ—¶ä¸å…è®¸ç¬¬ä¸‰æ–¹å·¥å…·æ¥æ‰©å±•æŸ¥æ‰¾å™¨. ä¹Ÿå°±æ˜¯è¯´<strong>æš‚æ—¶ä¸èƒ½ç”¨</strong>.</p><p>åœ¨è¿™ä¸ª<a href="https://github.com/Microsoft/TypeScript/issues/28289" target="_blank" rel="noopener">issue</a>ä¸­, æœ‰äººæå‡ºä½¿ç”¨<code>&quot;moduleResolution&quot;: &quot;yarnpnp&quot;</code>æˆ–è€…ä½¿ç”¨ç±»ä¼¼<a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener"><code>ts-loader</code></a>çš„<a href="https://github.com/arcanis/pnp-webpack-plugin/blob/b09fbdc2a9f16dc3837454b8d367963b1a30655f/index.js#L141" target="_blank" rel="noopener"><code>resolveModuleName</code></a>çš„æ–¹å¼æ”¯æŒ pnp æ¨¡å—æŸ¥æ‰¾.</p><p>TS å›¢é˜Ÿçš„å›åº”æ˜¯: pnp(æˆ–è€… npm çš„ tink)è¿˜æ˜¯æ—©æœŸé˜¶æ®µ, æœªæ¥å¯èƒ½ä¼šæœ‰å˜åŒ–, ä¾‹å¦‚<code>.pnp.js</code>æ–‡ä»¶, æ˜¾ç„¶ä¸åˆé€‚é‚£ä¹ˆæ—©å…¥å‘.<br>å¦å¤–ä¸ºäº†ä¼˜åŒ–å’Œæ§åˆ¶ç¼–è¯‘å™¨æ€§èƒ½, TS ä¹Ÿæ²¡æœ‰è®¡åˆ’åœ¨ç¼–è¯‘æœŸé—´æš´éœ²æ¥å£ç»™ç¬¬ä¸‰æ–¹æ‰§è¡Œä»£ç .</p><p>æ‰€ä»¥ç°åœ¨ Typescript è‡³ä»Šä¹Ÿæ²¡æœ‰ç±»ä¼¼ babel çš„æ’ä»¶æœºåˆ¶. é™¤éè‡ªå·±å®ç°ä¸€ä¸ªâ€™TS compiler hostâ€™, ä¾‹å¦‚<code>ts-loader</code>å°±è‡ªå·±æ‰©å±•äº†æ’ä»¶æœºåˆ¶å’Œæ¨¡å—æŸ¥æ‰¾æœºåˆ¶, æ¥æ”¯æŒç±»ä¼¼<a href="https://github.com/Brooooooklyn/ts-import-plugin" target="_blank" rel="noopener">ts-import-plugin</a>ç­‰æ’ä»¶, å› æ­¤<code>ts-loader</code>ç°åœ¨æ˜¯æ”¯æŒ pnp çš„:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PnpWebpackPlugin = <span class="built_in">require</span>(<span class="string">`pnp-webpack-plugin`</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        loader: <span class="built_in">require</span>.resolve(<span class="string">'ts-loader'</span>),</span><br><span class="line">        options: PnpWebpackPlugin.tsLoaderOptions(),</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p>æ€»ç»“, <strong><code>Typescript</code>æš‚æ—¶ä¸æ”¯æŒ</strong>, ä¸”è¿‘æœŸä¹Ÿæ²¡æœ‰å¼€å‘è®¡åˆ’, æ‰€ä»¥<code>VsCode</code>ä¹Ÿåˆ«æŒ‡æœ›äº†. <a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/181" target="_blank" rel="noopener"><code>fork-ts-checker-webpack-plugin</code></a>ä¹Ÿè¿˜æ²¡è·Ÿä¸Š. æ˜¾ç„¶ Typescript æ˜¯ pnp çš„ç¬¬ä¸€æ‹¦è·¯è™</p><p><br></p><h3 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h3><ul><li><a href="https://github.com/arcanis/rollup-plugin-pnp-resolve" target="_blank" rel="noopener">rollup-plugin-pnp-resolve</a></li><li><a href="https://yarnpkg.com/en/package/resolve" target="_blank" rel="noopener">resolve</a>: babel, gulp</li><li><a href="https://github.com/yarnpkg/yarn/pull/6449" target="_blank" rel="noopener">eslint</a>: åˆ° v6 æ‰èƒ½<a href="https://github.com/yarnpkg/berry/issues/8" target="_blank" rel="noopener">å®Œç¾æ”¯æŒ</a>.</li><li><a href="https://github.com/facebook/flow/issues/7014" target="_blank" rel="noopener">flow</a></li><li><a href="https://github.com/facebook/create-react-app/pull/5136" target="_blank" rel="noopener">create-react-app</a> æ”¯æŒ pnp, ä½†æ˜¯ Typescript æ¨¡å¼ä¸‹ä¸æ”¯æŒ</li><li>electron: æš‚æ—¶æ²¡æœ‰ç›¸å…³çš„æ¶ˆæ¯. å¯¹äºä¸€ä¸ªelectronåº”ç”¨æ¥è¯´, ä¾èµ–æ˜¯è‡ªåŒ…å«çš„, æ‰€ä»¥pnpå¯èƒ½ä¸é€‚åˆè¯¥åœºæ™¯</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»¼ä¸Š, pnp æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆ, å¯ä»¥è§£å†³ Node æ¨¡å—æœºåˆ¶çš„ç©ºé—´å’Œæ—¶é—´çš„æ•ˆç‡é—®é¢˜. ä½†æ˜¯åœ¨ç°é˜¶æ®µ, å®ƒè¿˜ä¸æ˜¯æˆç†Ÿ, æœ‰<br>å¾ˆå¤šå‘è¦è¸©, ä¸”å’Œç¤¾åŒºå„ç§å·¥å…·é›†æˆå­˜åœ¨ä¸å°‘é—®é¢˜. æ‰€ä»¥è¿˜ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨.</p><p>æ‰€ä»¥ç›®å‰é˜¶æ®µå¯¹äºæ™®é€šå¼€å‘è€…æ¥è¯´, å¦‚æœè¦æå‡npmå®‰è£…é€Ÿåº¦, è¿˜æ˜¯å¾—ä¸ŠSSD+Copy-On-Write!ğŸ˜‚</p><p>ä¸‹é¢æ˜¯å„ç§é¡¹ç›®çš„é›†æˆæƒ…å†µ(âœ…(æ”¯æŒ)|ğŸš§(è®¡åˆ’ä¸­æˆ–ä¸å®Œç¾)|âŒ(ä¸æ”¯æŒ)):</p><table><thead><tr><th>é¡¹ç›®</th><th></th></tr></thead><tbody><tr><td>Webpack</td><td>âœ…</td></tr><tr><td>rollup</td><td>âœ…</td></tr><tr><td>browserify</td><td>âœ…</td></tr><tr><td>gulp</td><td>âœ…</td></tr><tr><td>jest</td><td>âœ…</td></tr><tr><td>Node</td><td>âœ…</td></tr><tr><td>Typescript/VScode IntelliSense</td><td>âŒ</td></tr><tr><td>eslint</td><td>ğŸš§</td></tr><tr><td>flow</td><td>ğŸš§</td></tr><tr><td>create-react-app</td><td>ğŸš§</td></tr><tr><td>ts-loader</td><td>âœ…</td></tr><tr><td>fork-ts-checker-webpack-plugin</td><td>ğŸš§</td></tr></tbody></table><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/yarnpkg/rfcs/blob/master/accepted/0000-plug-an-play.md" target="_blank" rel="noopener">Plugâ€™nâ€™Play Whitepaper</a> pnpçš„è®ºæ–‡</li><li><a href="https://medium.freecodecamp.org/getting-rid-of-node-modules-with-yarn-plugn-play-a490e5e747d7" target="_blank" rel="noopener">How to get rid of node_modules with Yarn Plugâ€™nâ€™Play</a></li><li><a href="https://yarnpkg.com/en/docs/pnp" target="_blank" rel="noopener">Yarn å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/yarnpkg/pnp-sample-app" target="_blank" rel="noopener">pnp-sample-app</a> pnp å®˜æ–¹ç¤ºä¾‹</li><li><a href="https://github.com/yarnpkg/yarn/issues/6953" target="_blank" rel="noopener">Yarnâ€™s Future - v2 and beyond</a></li><li><a href="https://medium.com/@thomasreggi/yarn-plugn-play-1c398bf3e417" target="_blank" rel="noopener">Hacker News Discussion</a></li></ul><p>ç›¸å…³ issues:</p><ul><li><a href="https://github.com/yarnpkg/yarn/issues/6388" target="_blank" rel="noopener">Yarn Plug â€˜N Play should generate a static manifest file, not <code>.pnp.js</code></a></li><li><a href="https://github.com/Microsoft/TypeScript/issues/28289" target="_blank" rel="noopener">Typescript: Add new moduleResolution option: <code>yarn-pnp</code></a></li><li><a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/181" target="_blank" rel="noopener">fork-ts-checker-webpack-plugin: Custom resolveModuleName</a></li></ul><p>å…¶ä»–æ–¹æ¡ˆ</p><ul><li><a href="https://github.com/npm/tink" target="_blank" rel="noopener">npm tink</a>: a dependency unwinder for javascript</li><li><a href="https://github.com/pnpm/pnpm" target="_blank" rel="noopener">pnpm</a> Fast, disk space efficient package manager</li><li><a href="https://yarnpkg.com/en/docs/workspaces" target="_blank" rel="noopener">Yarn Workspaces</a> å¤šä¸ªé¡¹ç›®å…±æœ‰ä¾èµ–</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½¿ç”¨ Yarn(v1.12+)çš„ Plugâ€™nâ€™Play æœºåˆ¶æ¥å–ä»£ node_modules. ç›®å‰è¿™è¿˜æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ç‰¹æ€§.&lt;/p&gt;
&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Rxjs æ“ä½œç¬¦å†³ç­–æ ‘ - Mindnode</title>
    <link href="https://bobi.ink/2019/04/06/rx-operations/"/>
    <id>https://bobi.ink/2019/04/06/rx-operations/</id>
    <published>2019-04-05T16:00:00.000Z</published>
    <updated>2019-04-06T09:27:17.301Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Mindnode</strong> æ˜¯ macOS ä¸‹ä¸€ä¸ªç¾è§‚ç®€æ´çš„æ€ç»´å¯¼å›¾å·¥å…·, å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å­¦ä¹ /æ•´ç†å·¥å…·, æœ¬æ–‡åˆ—ä¸¾äº†è¿‘æ—¥å­¦ä¹ <code>rxjs</code>æ‰€æ•´ç†å‡ºæ¥çš„æ€ç»´å¯¼å›¾.</p><blockquote><p>å›¾ç‰‡è¾ƒå¤§, åŠ è½½å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´. å»ºè®®å³å‡»å›¾ç‰‡åœ¨æ–°çš„ Tab ä¸­æŸ¥çœ‹</p></blockquote><blockquote><p>Mindodeé¡¹ç›®<a href="https://github.com/ivan-94/mindnodes/tree/master/rxjs/æ“ä½œç¬¦" target="_blank" rel="noopener">åœ°å€</a>, å¯ä»¥åœ¨è¿™ä¸ªé¡¹ç›®è·å–åŸå§‹çš„Mindodeæ–‡ä»¶.</p></blockquote><h2 id="å­¦ä¹ èµ„æº"><a href="#å­¦ä¹ èµ„æº" class="headerlink" title="å­¦ä¹ èµ„æº"></a>å­¦ä¹ èµ„æº</h2><ul><li><a href="https://rxjs.dev" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://rxmarbles.com/#distinctUntilChanged" target="_blank" rel="noopener">å¯äº¤äº’çš„å¼¹ç å›¾</a> ç›´è§‚åœ°ç†è§£æ“ä½œç¬¦çš„åŠŸèƒ½</li><li><a href="https://rxjs-cn.github.io/learn-rxjs-operators/" target="_blank" rel="noopener">reactive.how</a> å­¦ä¹ å“åº”å¼ç¼–ç¨‹çš„åŠ¨ç”»å¡ç‰‡</li><li><a href="https://rxjs-cn.github.io/learn-rxjs-operators/" target="_blank" rel="noopener">å­¦ä¹ RxJSæ“ä½œç¬¦</a></li><li><a href="https://www.amazon.cn/dp/B07CXZ9D8N/ref=sr_1_1?__mk_zh_CN=äºšé©¬é€Šç½‘ç«™&amp;keywords=rxjs&amp;qid=1554539743&amp;s=gateway&amp;sr=8-1" target="_blank" rel="noopener">book: æ·±å…¥æµ…å‡ºRxJS</a></li></ul><h2 id="åˆ›å»ºæ“ä½œç¬¦"><a href="#åˆ›å»ºæ“ä½œç¬¦" class="headerlink" title="åˆ›å»ºæ“ä½œç¬¦"></a>åˆ›å»ºæ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/åˆ›å»ºæ“ä½œç¬¦.png" alt="åˆ›å»ºæ“ä½œç¬¦"></p><h2 id="è¿‡æ»¤æ“ä½œç¬¦"><a href="#è¿‡æ»¤æ“ä½œç¬¦" class="headerlink" title="è¿‡æ»¤æ“ä½œç¬¦"></a>è¿‡æ»¤æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/è¿‡æ»¤.png" alt="è¿‡æ»¤æ“ä½œç¬¦"></p><h2 id="è½¬æ¢æ“ä½œç¬¦"><a href="#è½¬æ¢æ“ä½œç¬¦" class="headerlink" title="è½¬æ¢æ“ä½œç¬¦"></a>è½¬æ¢æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/è½¬æ¢.png" alt="è½¬æ¢æ“ä½œç¬¦"></p><h2 id="ç»„åˆæ“ä½œç¬¦"><a href="#ç»„åˆæ“ä½œç¬¦" class="headerlink" title="ç»„åˆæ“ä½œç¬¦"></a>ç»„åˆæ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/ç»„åˆ.png" alt="ç»„åˆæ“ä½œç¬¦"></p><h2 id="åˆ†ç»„æ“ä½œç¬¦"><a href="#åˆ†ç»„æ“ä½œç¬¦" class="headerlink" title="åˆ†ç»„æ“ä½œç¬¦"></a>åˆ†ç»„æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/åˆ†ç»„.png" alt="åˆ†ç»„æ“ä½œç¬¦"></p><h2 id="é”™è¯¯å¤„ç†æ“ä½œç¬¦"><a href="#é”™è¯¯å¤„ç†æ“ä½œç¬¦" class="headerlink" title="é”™è¯¯å¤„ç†æ“ä½œç¬¦"></a>é”™è¯¯å¤„ç†æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/é”™è¯¯å¤„ç†.png" alt="é”™è¯¯å¤„ç†æ“ä½œç¬¦"></p><h2 id="è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦"><a href="#è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦" class="headerlink" title="è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦"></a>è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®.png" alt="è¾…åŠ©-æ¡ä»¶-æ•°å­¦-é…ç½®æ“ä½œç¬¦"></p><h2 id="å¤šæ’­æ“ä½œç¬¦"><a href="#å¤šæ’­æ“ä½œç¬¦" class="headerlink" title="å¤šæ’­æ“ä½œç¬¦"></a>å¤šæ’­æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/å¤šæ’­.png" alt="å¤šæ’­æ“ä½œç¬¦"></p><h2 id="é«˜é˜¶-observable-æ“ä½œç¬¦"><a href="#é«˜é˜¶-observable-æ“ä½œç¬¦" class="headerlink" title="é«˜é˜¶ Observable æ“ä½œç¬¦"></a>é«˜é˜¶ Observable æ“ä½œç¬¦</h2><p><img src="https://raw.githubusercontent.com/ivan-94/mindnodes/master/rxjs/æ“ä½œç¬¦/é«˜é˜¶Observable.png" alt="é«˜é˜¶Observableæ“ä½œç¬¦"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;Mindnode&lt;/strong&gt; æ˜¯ macOS ä¸‹ä¸€ä¸ªç¾è§‚ç®€æ´çš„æ€ç»´å¯¼å›¾å·¥å…·, å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å­¦ä¹ /æ•´ç†å·¥å…·, æœ¬æ–‡åˆ—ä¸¾äº†è¿‘æ—¥å­¦ä¹ &lt;code&gt;rxjs&lt;/code&gt;æ‰€æ•´ç†å‡ºæ¥çš„æ€ç»´å¯¼å›¾.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å›¾ç‰‡è¾ƒå¤§, åŠ è½½å¯èƒ½éœ€è¦ä¸€
      
    
    </summary>
    
      <category term="Mindnode" scheme="https://bobi.ink/categories/Mindnode/"/>
    
    
  </entry>
  
</feed>
