<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bobi.ink</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://bobi.ink/"/>
  <updated>2019-09-20T03:39:46.065Z</updated>
  <id>https://bobi.ink/</id>
  
  <author>
    <name>Ivan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è‡ªå·±å†™ä¸ªReactæ¸²æŸ“å™¨: ä»¥ Remax ä¸ºä¾‹(ç”¨Reactå†™å°ç¨‹åº)</title>
    <link href="https://bobi.ink/2019/09/15/remax/"/>
    <id>https://bobi.ink/2019/09/15/remax/</id>
    <published>2019-09-14T16:00:00.000Z</published>
    <updated>2019-09-20T03:39:46.065Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸ªæœˆèš‚èšé‡‘æœå‰ç«¯å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„åº”ç”¨ <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a>, å£å·æ˜¯<strong>ä½¿ç”¨çœŸæ­£çš„ã€å®Œæ•´çš„ React æ¥å¼€å‘å°ç¨‹åº</strong>.</p><p>å¯¹äºåŸæœ¬çš„Reactå¼€å‘è€…æ¥è¯´ â€˜Learn once, write anywhereâ€™ , å’Œ ReactNative å¼€å‘ä½“éªŒå·®ä¸å¤šï¼Œ<strong>è€Œå¯¹äºå°ç¨‹åºæ¥è¯´åˆ™æ˜¯å…¨æ–°çš„å¼€å‘ä½“éªŒ</strong>ã€‚</p><p><a href="https://github.com/NervJS/taro" target="_blank" rel="noopener"><code>Taro</code></a>å·ç§°æ˜¯â€˜ç±»Reactâ€™çš„å¼€å‘æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯ä½¿ç”¨é™æ€ç¼–è¯‘çš„æ–¹å¼å®ç°ï¼Œ<a href="https://www.zhihu.com/people/meck" target="_blank" rel="noopener">è¾¹æŸ³</a> åœ¨å®ƒçš„ <a href="https://zhuanlan.zhihu.com/p/79788488" target="_blank" rel="noopener">ã€ŠRemax - ä½¿ç”¨çœŸæ­£çš„ React æ„å»ºå°ç¨‹åºã€‹</a>æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹:</p><p><code>æ‰€è°“é™æ€ç¼–è¯‘ï¼Œå°±æ˜¯ä½¿ç”¨å·¥å…·æŠŠä»£ç è¯­æ³•åˆ†æä¸€éï¼ŒæŠŠå…¶ä¸­çš„ JSX éƒ¨åˆ†å’Œé€»è¾‘éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œåˆ†åˆ«ç”Ÿæˆå°ç¨‹åºçš„æ¨¡æ¿å’Œ Page å®šä¹‰ã€‚</code></p><p>è¿™ç§æ–¹æ¡ˆå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä¸”è¿è¡Œæ—¶å¹¶æ²¡æœ‰ React å­˜åœ¨ã€‚</p><p><br></p><p>ç›¸æ¯”è€Œè¨€ï¼Œ<a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> çš„è§£å†³æ–¹æ¡ˆå°±ç®€å•å¾ˆå¤šï¼Œ<strong>å®ƒä¸è¿‡å°±æ˜¯æ–°çš„Reactæ¸²æŸ“å™¨</strong>.</p><p><img src="/images/remax/01.png" alt></p><p><br></p><blockquote><p>å› ä¸º <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> åˆšå‘å¸ƒä¸ä¹…ï¼Œæ ¸å¿ƒä»£ç æ¯”è¾ƒç®€å•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å» <a href="https://github.com/remaxjs/remax" target="_blank" rel="noopener">github</a> è§‚æ‘©è´¡çŒ®</p></blockquote><blockquote><p>å¯ä»¥é€šè¿‡ CodeSandbox æ¸¸ä¹åœºè¯•ç©è‡ªå®šä¹‰Renderer: <a href="https://codesandbox.io/s/react-custom-renderer-mm9kl?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit react-custom-renderer"></a></p></blockquote><blockquote><p>æ–‡ç« çœ‹èµ·æ¥æ¯”è¾ƒé•¿ï¼Œå¥½æˆåœ¨åå¤´ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ ğŸ¦–</p></blockquote><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#å…³äºreactçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ">å…³äºReactçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ</a></li><li><a href="#è‡ªå®šä¹‰reactæ¸²æŸ“å™¨">è‡ªå®šä¹‰Reactæ¸²æŸ“å™¨</a></li><li><a href="#hostconfig-æ¸²æŸ“å™¨é€‚é…">HostConfig æ¸²æŸ“å™¨é€‚é…</a></li><li><a href="#å®¿ä¸»ç»„ä»¶">å®¿ä¸»ç»„ä»¶</a></li><li><a href="#é•œåƒæ ‘çš„æ„å»ºå’Œæ“ä½œ">é•œåƒæ ‘çš„æ„å»ºå’Œæ“ä½œ</a></li><li><a href="#èŠ‚ç‚¹æ›´æ–°">èŠ‚ç‚¹æ›´æ–°</a></li><li><a href="#å‰¯ä½œç”¨æäº¤">å‰¯ä½œç”¨æäº¤</a></li><li><a href="#hostconfigæ‰§è¡Œæµç¨‹æ€»ç»“">HostConfigæ‰§è¡Œæµç¨‹æ€»ç»“</a></li><li><a href="#åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹">åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹</a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><p><br></p><h2 id="å…³äºreactçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ"><a href="#å…³äºreactçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å…³äºReactçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ"></a>å…³äºReactçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ</h2><p>åˆ›å»ºä¸€ä¸ª React è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼Œä½ éœ€è¦å¯¹Reactæ¸²æŸ“çš„åŸºæœ¬åŸç†æœ‰ä¸€å®šçš„äº†è§£ã€‚æ‰€ä»¥åœ¨æ·±å…¥é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå…ˆè¦ç¡®ä¿ä½ èƒ½å¤Ÿç†è§£ä»¥ä¸‹å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ:</p><ul><li><p><strong>Element</strong> - æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>JSX</code> æˆ–è€… <code>React.createElement</code> æ¥åˆ›å»º Elementï¼Œç”¨æ¥æè¿°æˆ‘ä»¬è¦åˆ›å»ºçš„è§†å›¾èŠ‚ç‚¹ã€‚æ¯”å¦‚:</p>  <figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">'button button-blue'</span>&gt;</span><br><span class="line">  &lt;b&gt;</span><br><span class="line">    OK!</span><br><span class="line">  &lt;<span class="regexp">/b&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>button&gt;</span><br></pre></td></tr></table></figure><p>  <code>JSX</code> ä¼šè¢«è½¬ä¹‰è¯‘ä¸º:</p>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">  <span class="string">"button"</span>,</span><br><span class="line">  &#123; <span class="attr">class</span>: <span class="string">'button button-blue'</span> &#125;,</span><br><span class="line">  React.createElement(<span class="string">"b"</span>, <span class="literal">null</span>, <span class="string">"OK!"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>  <code>React.createElement</code> æœ€ç»ˆæ„å»ºå‡ºç±»ä¼¼è¿™æ ·çš„å¯¹è±¡:</p>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'button'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    className: <span class="string">'button button-blue'</span>,</span><br><span class="line">    children: &#123;</span><br><span class="line">      type: <span class="string">'b'</span>,</span><br><span class="line">      props: &#123;</span><br><span class="line">        children: <span class="string">'OK!'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä¹Ÿå°±æ˜¯è¯´ <strong>Element å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œæè¿°ç”¨æˆ·åˆ›å»ºçš„èŠ‚ç‚¹ç±»å‹ã€props ä»¥åŠ children</strong>ã€‚è¿™äº› Elements ç»„åˆæˆæ ‘ï¼Œæè¿°ç”¨æˆ·è§†å›¾</p><p>  <br></p></li><li><p><strong>Component</strong> - å¯ä»¥è®¤ä¸ºæ˜¯ Element çš„ç±»å‹ï¼Œå®ƒæœ‰ä¸¤ç§ç±»å‹ï¼š</p><ul><li><p><strong>Host Component</strong>: å®¿ä¸»ç»„ä»¶ï¼Œè¿™æ˜¯ç”±æ¸²æŸ“çš„å¹³å°æä¾›çš„â€˜å†…ç½®â€™ç»„ä»¶ï¼Œä¾‹å¦‚<code>ReactDOM</code> å¹³å°ä¸‹é¢çš„ <code>DOM</code> èŠ‚ç‚¹ï¼Œå¦‚ <code>div</code>ã€<code>span</code>â€¦ è¿™äº›ç»„ä»¶ç±»å‹ä¸ºå­—ç¬¦ä¸²</p></li><li><p><strong>Composite Component</strong>: å¤åˆç»„ä»¶ï¼Œè¿™æ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰çš„ç»„ä»¶å°è£…å•ä½ã€‚é€šå¸¸åŒ…å«è‡ªå®šä¹‰çš„é€»è¾‘ã€çŠ¶æ€ä»¥åŠè¾“å‡º Element æ ‘ã€‚å¤åˆç±»å‹å¯ä»¥ä¸ºç±»æˆ–å‡½æ•°</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> DeleteAccount = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Are you sure?<span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &lt;DangerButton&gt;Yep&lt;<span class="regexp">/DangerButton&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Button color='blue'&gt;Cancel&lt;/</span>Button&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>Instance</strong> - å½“ React å¼€å§‹æ¸²æŸ“ä¸€ä¸ª Element æ—¶ï¼Œä¼šæ ¹æ®ç»„ä»¶ç±»å‹ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªâ€˜å®ä¾‹â€™ï¼Œä¾‹å¦‚ç±»ç»„ä»¶ï¼Œä¼šè°ƒç”¨<code>new</code>æ“ä½œç¬¦å®ä¾‹åŒ–ã€‚è¿™ä¸ªå®ä¾‹ä¼šä¸€ç›´å¼•ç”¨ï¼Œç›´åˆ° Element ä» Element Tree ä¸­è¢«ç§»é™¤ã€‚</p><p>  <code>é¦–æ¬¡æ¸²æŸ“</code>: React ä¼šå®ä¾‹åŒ–ä¸€ä¸ª <code>MyButton</code> å®ä¾‹ï¼Œè°ƒç”¨æŒ‚è½½ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¹¶æ‰§è¡Œ <code>render</code> æ–¹æ³•ï¼Œé€’å½’æ¸²æŸ“ä¸‹çº§</p>  <figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">MyButton</span>&gt;</span>foo<span class="tag">&lt;/<span class="name">MyButton</span>&gt;</span></span>, container)</span><br></pre></td></tr></table></figure><p>  <br></p><p>  <code>æ›´æ–°</code>: å› ä¸ºç»„ä»¶ç±»å‹æ²¡æœ‰å˜åŒ–ï¼ŒReact ä¸ä¼šå†å®ä¾‹åŒ–ï¼Œè¿™ä¸ªå±äºâ€˜èŠ‚ç‚¹æ›´æ–°â€™ï¼ŒReact ä¼šæ‰§è¡Œæ›´æ–°ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¦‚<code>shouldComponentUpdate</code>ã€‚å¦‚æœéœ€è¦æ›´æ–°åˆ™å†æ¬¡æ‰§è¡Œ<code>render</code>æ–¹æ³•</p>  <figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">MyButton</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">MyButton</span>&gt;</span></span>, container)</span><br></pre></td></tr></table></figure><p>  <br></p><p>  <code>å¸è½½</code>: ç»„ä»¶ç±»å‹ä¸ä¸€æ ·äº†, åŸæœ‰çš„ MyButton è¢«æ›¿æ¢. MyButton çš„å®ä¾‹å°†è¦è¢«é”€æ¯ï¼ŒReact ä¼šæ‰§è¡Œå¸è½½ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¦‚<code>componentWillUnmount</code></p>  <figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>, container)</span><br></pre></td></tr></table></figure><p>  <br></p></li><li><p><strong>Reconciler</strong> &amp; <strong>Renderer</strong> - <code>Reconciler</code> å’Œ <code>Renderer</code> çš„å…³ç³»å¯ä»¥é€šè¿‡ä¸‹å›¾ç¼•æ¸…æ¥š.</p><p><strong>Reconciler çš„èŒè´£æ˜¯ç»´æŠ¤ VirtualDOM æ ‘ï¼Œå†…éƒ¨å®ç°äº† Diff/Fiber ç®—æ³•ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™æ›´æ–°ã€ä»¥åŠè¦æ›´æ–°ä»€ä¹ˆ</strong></p><p>è€Œ <strong>Renderer è´Ÿè´£å…·ä½“å¹³å°çš„æ¸²æŸ“å·¥ä½œï¼Œå®ƒä¼šæä¾›å®¿ä¸»ç»„ä»¶ã€å¤„ç†äº‹ä»¶ç­‰ç­‰</strong>ã€‚ä¾‹å¦‚ReactDOMå°±æ˜¯ä¸€ä¸ªæ¸²æŸ“å™¨ï¼Œè´Ÿè´£DOMèŠ‚ç‚¹çš„æ¸²æŸ“å’ŒDOMäº‹ä»¶å¤„ç†ã€‚</p><p><br></p><p><img src="/images/remax/02.png" alt></p><p><br></p></li><li><p><strong>Fiber çš„ä¸¤ä¸ªé˜¶æ®µ</strong> - React ä½¿ç”¨äº† Fiber æ¶æ„ä¹‹åï¼Œæ›´æ–°è¿‡ç¨‹è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ(Phase)</p><ul><li><strong>åè°ƒé˜¶æ®µ(Reconciliation Phase)</strong> è¿™ä¸ªé˜¶æ®µ React ä¼šæ‰¾å‡ºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ¯”å¦‚æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„äº‹ä»¶è¦å¤„ç†æ—¶ã€‚</li><li><p><strong>æäº¤é˜¶æ®µ(Commit Phase)</strong> å°†ä¸Šä¸€ä¸ªé˜¶æ®µè®¡ç®—å‡ºæ¥çš„éœ€è¦å¤„ç†çš„<strong>å‰¯ä½œç”¨(Effects)</strong>ä¸€æ¬¡æ€§æ‰§è¡Œäº†ã€‚è¿™ä¸ªé˜¶æ®µå¿…é¡»åŒæ­¥æ‰§è¡Œï¼Œä¸èƒ½è¢«æ‰“æ–­</p><p><br></p><p>å¦‚æœæŒ‰ç…§<code>render</code>ä¸ºç•Œï¼Œå¯ä»¥å°†ç”Ÿå‘½å‘¨æœŸå‡½æ•°æŒ‰ç…§ä¸¤ä¸ªé˜¶æ®µè¿›è¡Œåˆ’åˆ†ï¼š</p></li><li><p>åè°ƒé˜¶æ®µ</p><ul><li><code>constructor</code></li><li><code>componentWillMount</code> åºŸå¼ƒ</li><li><code>componentWillReceiveProps</code> åºŸå¼ƒ</li><li><code>static getDerivedStateFromProps</code></li><li><code>shouldComponentUpdate</code></li><li><code>componentWillUpdate</code> åºŸå¼ƒ</li><li><code>render</code></li><li><code>getSnapshotBeforeUpdate()</code></li></ul></li><li>æäº¤é˜¶æ®µ<ul><li><code>componentDidMount</code></li><li><code>componentDidUpdate</code></li><li><code>componentWillUnmount</code></li></ul></li></ul></li></ul><p><br></p><blockquote><p>æ²¡ç†è§£ï¼Ÿé‚£ä¹ˆä¸‹æ–‡è¯»èµ·æ¥å¯¹ä½ å¯èƒ½æ¯”è¾ƒåƒåŠ›ï¼Œå»ºè®®é˜…è¯»ä¸€äº›å…³äºReactåŸºæœ¬åŸç†çš„ç›¸å…³æ–‡ç« ã€‚</p></blockquote><p>å°±ç›®å‰è€Œè¨€ï¼ŒReact å¤§éƒ¨åˆ†æ ¸å¿ƒçš„å·¥ä½œå·²ç»åœ¨ Reconciler ä¸­å®Œæˆï¼Œå¥½åœ¨ React çš„æ¶æ„å’Œæ¨¡å—åˆ’åˆ†è¿˜æ¯”è¾ƒæ¸…æ™°ï¼ŒReactå®˜æ–¹ä¹Ÿæš´éœ²äº†ä¸€äº›åº“ï¼Œè¿™æå¤§ç®€åŒ–äº†æˆ‘ä»¬å¼€å‘ Renderer çš„éš¾åº¦ã€‚å¼€å§‹å§ï¼</p><p><br></p><h2 id="è‡ªå®šä¹‰reactæ¸²æŸ“å™¨"><a href="#è‡ªå®šä¹‰reactæ¸²æŸ“å™¨" class="headerlink" title="è‡ªå®šä¹‰Reactæ¸²æŸ“å™¨"></a>è‡ªå®šä¹‰Reactæ¸²æŸ“å™¨</h2><p>Reactå®˜æ–¹æš´éœ²äº†ä¸€äº›åº“ä¾›å¼€å‘è€…æ¥æ‰©å±•è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼š</p><ul><li><a href="https://github.com/facebook/react/tree/master/packages/react-reconciler" target="_blank" rel="noopener">react-reconciler</a> - è¿™å°±æ˜¯ React çš„åè°ƒå™¨, React çš„æ ¸å¿ƒæ‰€åœ¨ã€‚æˆ‘ä»¬ä¸»è¦é€šè¿‡å®ƒæ¥å¼€å‘æ¸²æŸ“å™¨ã€‚</li><li><a href="https://github.com/facebook/react/tree/master/packages/scheduler" target="_blank" rel="noopener">scheduler</a> - åˆä½œè°ƒåº¦å™¨çš„ä¸€äº› API ã€‚æœ¬æ–‡ä¸ä¼šç”¨åˆ°</li></ul><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>è¿™äº›åŒ…è¿˜æ˜¯å®éªŒæ€§çš„</strong>ï¼ŒAPIå¯èƒ½ä¸å¤ªç¨³å®šã€‚å¦å¤–ï¼Œæ²¡æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼Œä½ éœ€è¦æŸ¥çœ‹æºä»£ç æˆ–è€…å…¶ä»–æ¸²æŸ“å™¨å®ç°ï¼›æœ¬æ–‡ä»¥åŠæ‰©å±•é˜…è¯»ä¸­çš„æ–‡ç« ä¹Ÿæ˜¯å¾ˆå¥½çš„å­¦ä¹ èµ„æ–™ã€‚</p></blockquote><p><br></p><p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ¸²æŸ“å™¨åªéœ€ä¸¤æ­¥:</p><p><img src="/images/remax/04.png" alt></p><p>ç¬¬ä¸€æ­¥: <strong>å®ç°å®¿ä¸»é…ç½®</strong>ï¼Œè¿™æ˜¯<code>react-reconciler</code>è¦æ±‚å®¿ä¸»æä¾›çš„ä¸€äº›é€‚é…å™¨æ–¹æ³•å’Œé…ç½®é¡¹ã€‚è¿™äº›é…ç½®é¡¹å®šä¹‰äº†å¦‚ä½•åˆ›å»ºèŠ‚ç‚¹å®ä¾‹ã€æ„å»ºèŠ‚ç‚¹æ ‘ã€æäº¤å’Œæ›´æ–°ç­‰æ“ä½œã€‚ä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»è¿™äº›é…ç½®é¡¹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Reconciler = <span class="built_in">require</span>(<span class="string">'react-reconciler'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HostConfig = &#123;</span><br><span class="line">  <span class="comment">// ... å®ç°é€‚é…å™¨æ–¹æ³•å’Œé…ç½®é¡¹</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p>ç¬¬äºŒæ­¥ï¼š<strong>å®ç°æ¸²æŸ“å‡½æ•°</strong>ï¼Œç±»ä¼¼äº<a href="https://reactjs.org/docs/react-dom.html#render" target="_blank" rel="noopener"><code>ReactDOM.render()</code></a> æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºReconcilerå®ä¾‹, å¹¶å°†HostConfigä¼ é€’ç»™Reconciler</span></span><br><span class="line"><span class="keyword">const</span> MyRenderer = Reconciler(HostConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡è®¾å’ŒReactDOMä¸€æ ·ï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"> * render(&lt;MyComponent /&gt;, container, () =&gt; console.log('rendered'))</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">element, container, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºæ ¹å®¹å™¨</span></span><br><span class="line">  <span class="keyword">if</span> (!container._rootContainer) &#123;</span><br><span class="line">    container._rootContainer = ReactReconcilerInst.createContainer(container, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–°æ ¹å®¹å™¨</span></span><br><span class="line">  <span class="keyword">return</span> ReactReconcilerInst.updateContainer(element, container._rootContainer, <span class="literal">null</span>, callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¹å™¨æ—¢æ˜¯ React ç»„ä»¶æ ‘æŒ‚è½½çš„<code>ç›®æ ‡</code>(ä¾‹å¦‚ ReactDOM æˆ‘ä»¬é€šå¸¸ä¼šæŒ‚è½½åˆ° <code>#root</code> å…ƒç´ ï¼Œ<code>#root</code> å°±æ˜¯ä¸€ä¸ªå®¹å™¨)ã€ä¹Ÿæ˜¯ç»„ä»¶æ ‘çš„ <code>æ ¹FiberèŠ‚ç‚¹(FiberRoot)</code>ã€‚æ ¹èŠ‚ç‚¹æ˜¯æ•´ä¸ªç»„ä»¶æ ‘çš„å…¥å£ï¼Œå®ƒå°†ä¼šè¢« Reconciler ç”¨æ¥ä¿å­˜ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠç®¡ç†æ‰€æœ‰èŠ‚ç‚¹çš„æ›´æ–°å’Œæ¸²æŸ“ã€‚</p><p>å…³äº Fiber æ¶æ„çš„ä¸€äº›ç»†èŠ‚å¯ä»¥çœ‹è¿™äº›æ–‡ç« :</p><ul><li><a href="https://zhuanlan.zhihu.com/p/57346388" target="_blank" rel="noopener">&lt;[è¯‘]æ·±å…¥React fiberæ¶æ„åŠæºç &gt;</a></li><li><a href="https://juejin.im/post/5ab7b3a2f265da2378403e57" target="_blank" rel="noopener"><react fiber></react></a> æœ‰èƒ½åŠ›çš„åŒå­¦ï¼Œå¯ä»¥ç›´æ¥çœ‹<a href="https://www.youtube.com/watch?v=ZCuYPiUIONs" target="_blank" rel="noopener">Lin Clark</a>çš„æ¼”è®²</li></ul><p><br></p><h2 id="hostconfig-æ¸²æŸ“å™¨é€‚é…"><a href="#hostconfig-æ¸²æŸ“å™¨é€‚é…" class="headerlink" title="HostConfig æ¸²æŸ“å™¨é€‚é…"></a>HostConfig æ¸²æŸ“å™¨é€‚é…</h2><p><code>HostConfig</code> æ”¯æŒéå¸¸å¤šçš„å‚æ•°ï¼Œå®Œæ•´åˆ—è¡¨å¯ä»¥çœ‹<a href="https://github.com/facebook/react/blob/master/packages/react-reconciler/src/forks/ReactFiberHostConfig.custom.js" target="_blank" rel="noopener">è¿™é‡Œ</a>. ä¸‹é¢æ˜¯ä¸€äº›è‡ªå®šä¹‰æ¸²æŸ“å™¨<strong>å¿…é¡»</strong>æä¾›çš„å‚æ•°ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> HostConfig &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç”¨äºåˆ†äº«ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// è·å–æ ¹å®¹å™¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯, åªåœ¨æ ¹èŠ‚ç‚¹è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">  getRootHostContext(rootContainerInstance: Container): HostContext;</span><br><span class="line">  <span class="comment">// è·å–å­èŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯, æ¯éå†ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">  getChildHostContext(parentHostContext: HostContext, <span class="keyword">type</span>: Type, rootContainerInstance: Container): HostContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * èŠ‚ç‚¹å®ä¾‹çš„åˆ›å»º</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// æ™®é€šèŠ‚ç‚¹å®ä¾‹åˆ›å»ºï¼Œä¾‹å¦‚DOMçš„Elementç±»å‹</span></span><br><span class="line">  createInstance(<span class="keyword">type</span>: Type, props: Props, rootContainerInstance: Container, hostContext: HostContext, internalInstanceHandle: OpaqueHandle,): Instance;</span><br><span class="line">  <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹çš„åˆ›å»ºï¼Œä¾‹å¦‚DOMçš„Textç±»å‹</span></span><br><span class="line">  createTextInstance(text: <span class="built_in">string</span>, rootContainerInstance: Container, hostContext: HostContext, internalInstanceHandle: OpaqueHandle): TextInstance;</span><br><span class="line">  <span class="comment">// å†³å®šæ˜¯å¦è¦å¤„ç†å­èŠ‚ç‚¹/å­æ–‡æœ¬èŠ‚ç‚¹. å¦‚æœä¸æƒ³åˆ›å»ºåˆ™è¿”å›true. ä¾‹å¦‚ReactDOMä¸­ä½¿ç”¨dangerouslySetInnerHTML, è¿™æ—¶å€™å­èŠ‚ç‚¹ä¼šè¢«å¿½ç•¥</span></span><br><span class="line">  shouldSetTextContent(<span class="keyword">type</span>: Type, props: Props): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * èŠ‚ç‚¹æ ‘æ„å»º</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å¦‚æœèŠ‚ç‚¹åœ¨*æœªæŒ‚è½½*çŠ¶æ€ä¸‹ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ¥æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">  appendInitialChild(parentInstance: Instance, child: Instance | TextInstance): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// **ä¸‹é¢éƒ½æ˜¯å‰¯ä½œç”¨(Effect)ï¼Œåœ¨â€™æäº¤â€˜é˜¶æ®µè¢«æ‰§è¡Œ**</span></span><br><span class="line">  <span class="comment">// æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">  appendChild?(parentInstance: Instance, child: Instance | TextInstance): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// æ·»åŠ å­èŠ‚ç‚¹åˆ°å®¹å™¨èŠ‚ç‚¹(æ ¹èŠ‚ç‚¹)</span></span><br><span class="line">  appendChildToContainer?(container: Container, child: Instance | TextInstance): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// æ’å…¥å­èŠ‚ç‚¹</span></span><br><span class="line">  insertBefore?(parentInstance: Instance, child: Instance | TextInstance, beforeChild: Instance | TextInstance): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// æ’å…¥å­èŠ‚ç‚¹åˆ°å®¹å™¨èŠ‚ç‚¹(æ ¹èŠ‚ç‚¹)</span></span><br><span class="line">  insertInContainerBefore?(container: Container, child: Instance | TextInstance, beforeChild: Instance | TextInstance,): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// åˆ é™¤å­èŠ‚ç‚¹</span></span><br><span class="line">  removeChild?(parentInstance: Instance, child: Instance | TextInstance): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// ä»å®¹å™¨èŠ‚ç‚¹(æ ¹èŠ‚ç‚¹)ä¸­ç§»é™¤å­èŠ‚ç‚¹</span></span><br><span class="line">  removeChildFromContainer?(container: Container, child: Instance | TextInstance): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * èŠ‚ç‚¹æŒ‚è½½</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// åœ¨å®Œæˆæ‰€æœ‰å­èŠ‚ç‚¹åˆå§‹åŒ–æ—¶(æ‰€æœ‰å­èŠ‚ç‚¹éƒ½appendInitialChildå®Œæ¯•)æ—¶è¢«è°ƒç”¨, å¦‚æœè¿”å›trueï¼Œåˆ™commitMountå°†ä¼šè¢«è§¦å‘</span></span><br><span class="line">  <span class="comment">// ReactDOMé€šè¿‡è¿™ä¸ªå±æ€§å’ŒcommitMounté…ç½®å®ç°è¡¨å•å…ƒç´ çš„autofocusåŠŸèƒ½</span></span><br><span class="line">  finalizeInitialChildren(parentInstance: Instance, <span class="keyword">type</span>: Type, props: Props, rootContainerInstance: Container, hostContext: HostContext): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// å’ŒfinalizeInitialChildrené…åˆä½¿ç”¨ï¼ŒcommitRootä¼šåœ¨â€™æäº¤â€˜å®Œæˆå(resetAfterCommit)æ‰§è¡Œ, ä¹Ÿå°±æ˜¯è¯´ç»„ä»¶æ ‘æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œ</span></span><br><span class="line">  commitMount?(instance: Instance, <span class="keyword">type</span>: Type, newProps: Props, internalInstanceHandle: OpaqueHandle): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * èŠ‚ç‚¹æ›´æ–°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å‡†å¤‡èŠ‚ç‚¹æ›´æ–°. å¦‚æœè¿”å›ç©ºåˆ™è¡¨ç¤ºä¸æ›´æ–°ï¼Œè¿™æ—¶å€™commitUpdateåˆ™ä¸ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">  prepareUpdate(instance: Instance, <span class="keyword">type</span>: Type, oldProps: Props, newProps: Props, rootContainerInstance: Container, hostContext: HostContext,): <span class="literal">null</span> | UpdatePayload;</span><br><span class="line">  <span class="comment">// **ä¸‹é¢éƒ½æ˜¯å‰¯ä½œç”¨(Effect)ï¼Œåœ¨â€™æäº¤â€˜é˜¶æ®µè¢«æ‰§è¡Œ**</span></span><br><span class="line">  <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹æäº¤</span></span><br><span class="line">  commitTextUpdate?(textInstance: TextInstance, oldText: <span class="built_in">string</span>, newText: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// æ™®é€šèŠ‚ç‚¹æäº¤</span></span><br><span class="line">  commitUpdate?(instance: Instance, updatePayload: UpdatePayload, <span class="keyword">type</span>: Type, oldProps: Props, newProps: Props, internalInstanceHandle: OpaqueHandle): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// é‡ç½®æ™®é€šèŠ‚ç‚¹æ–‡æœ¬å†…å®¹, è¿™ä¸ªéœ€è¦å’ŒshouldSetTextContent(è¿”å›trueæ—¶)é…åˆä½¿ç”¨ï¼Œ</span></span><br><span class="line">  resetTextContent?(instance: Instance): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æäº¤</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å¼€å§‹â€™æäº¤â€˜ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ¯”å¦‚è¿™é‡Œå¯ä»¥ä¿å­˜ä¸€äº›çŠ¶æ€ï¼Œåœ¨â€™æäº¤â€˜å®Œæˆåæ¢å¤çŠ¶æ€ã€‚æ¯”å¦‚ReactDOMä¼šä¿å­˜å½“å‰å…ƒç´ çš„ç„¦ç‚¹çŠ¶æ€ï¼Œåœ¨æäº¤åæ¢å¤</span></span><br><span class="line">  <span class="comment">// æ‰§è¡Œå®ŒprepareForCommitï¼Œå°±ä¼šå¼€å§‹æ‰§è¡ŒEffects(èŠ‚ç‚¹æ›´æ–°)</span></span><br><span class="line">  prepareForCommit(containerInfo: Container): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// å’ŒprepareForCommitå¯¹åº”ï¼Œåœ¨æäº¤å®Œæˆåè¢«æ‰§è¡Œ</span></span><br><span class="line">  resetAfterCommit(containerInfo: Container): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è°ƒåº¦</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// è¿™ä¸ªå‡½æ•°å°†è¢«Reconcilerç”¨æ¥è®¡ç®—å½“å‰æ—¶é—´, æ¯”å¦‚è®¡ç®—ä»»åŠ¡å‰©ä½™æ—¶é—´ </span></span><br><span class="line">  <span class="comment">// ReactDOMä¸­ä¼šä¼˜å…ˆä½¿ç”¨Performance.now, æ™®é€šåœºæ™¯ç”¨Date.nowå³å¯</span></span><br><span class="line">  now(): <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰è®¡æ—¶å™¨</span></span><br><span class="line">  setTimeout(handler: <span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt;</span> <span class="built_in">void</span>, timeout: <span class="built_in">number</span>): TimeoutHandle | NoTimeout;</span><br><span class="line">  <span class="comment">// å–æ¶ˆè®¡æ—¶å™¨</span></span><br><span class="line">  clearTimeout(handle: TimeoutHandle | NoTimeout): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// è¡¨ç¤ºä¸€ä¸ªç©ºçš„è®¡æ—¶å™¨ï¼Œè§ğŸ‘†clearTimeoutçš„ç­¾å</span></span><br><span class="line">  noTimeout: NoTimeout;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ? åŠŸèƒ½æœªçŸ¥</span></span><br><span class="line">  shouldDeprioritizeSubtree(<span class="keyword">type</span>: Type, props: Props): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// åºŸå¼ƒ</span></span><br><span class="line">  scheduleDeferredCallback(callback: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">any</span>, options?: &#123; timeout: <span class="built_in">number</span> &#125;): <span class="built_in">any</span>;</span><br><span class="line">  <span class="comment">// åºŸå¼ƒ</span></span><br><span class="line">  cancelDeferredCallback(callbackID: <span class="built_in">any</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åŠŸèƒ½å¼€å¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å¼€å¯èŠ‚ç‚¹ä¿®æ”¹ï¼Œä¸€èˆ¬æ¸²æŸ“å™¨éƒ½ä¼šå¼€å¯ï¼Œä¸ç„¶æ— æ³•æ›´æ–°èŠ‚ç‚¹</span></span><br><span class="line">  supportsMutation: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// å¼€å¯æŒä¹…åŒ– ?</span></span><br><span class="line">  supportsPersistence: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// å¼€å¯hydrateï¼Œä¸€èˆ¬ç”¨äºæœåŠ¡ç«¯æ¸²æŸ“</span></span><br><span class="line">  supportsHydration: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ‚é¡¹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// è·å–å¯å…¬å¼€çš„èŠ‚ç‚¹å®ä¾‹ï¼Œå³ä½ æ„¿æ„æš´éœ²ç»™ç”¨æˆ·çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œç”¨æˆ·é€šè¿‡refå¯ä»¥è·å–åˆ°è¿™ä¸ªå¯¹è±¡ã€‚ä¸€èˆ¬è‡ªå®šä¹‰æ¸²æŸ“å™¨åŸæ ·è¿”å›å³å¯, é™¤éä½ æƒ³æœ‰é€‰æ‹©åœ°ç»™ç”¨æˆ·æš´éœ²ä¿¡æ¯</span></span><br><span class="line">  getPublicInstance(instance: Instance | TextInstance): PublicInstance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... è¿˜æœ‰å¾ˆå¤šå‚æ•°ï¼Œç”±äºä¸€èˆ¬æ¸²æŸ“å™¨ä¸ä¼šç”¨åˆ°ï¼Œæš‚æ—¶ä¸è®²äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚æœæŒ‰ç…§<code>Fiberçš„ä¸¤ä¸ªé˜¶æ®µ</code>æ¥åˆ’åˆ†çš„è¯ï¼Œæ¥å£åˆ†ç±»æ˜¯è¿™æ ·çš„:</p><table><thead><tr><th><strong>åè°ƒé˜¶æ®µ</strong></th><th><strong>å¼€å§‹æäº¤</strong></th><th><strong>æäº¤é˜¶æ®µ</strong></th><th><strong>æäº¤å®Œæˆ</strong></th></tr></thead><tbody><tr><td>createInstance</td><td>prepareCommit</td><td>appendChild</td><td>resetAfterCommit</td></tr><tr><td>createTextInstance</td><td></td><td>appendChildToContainer</td><td>commitMount</td></tr><tr><td>shouldSetTextContent</td><td></td><td>insertBefore</td><td></td></tr><tr><td>appendInitialChild</td><td></td><td>insertInContainerBefore</td><td></td></tr><tr><td>finalizeInitialChildren</td><td></td><td>removeChild</td><td></td></tr><tr><td>prepareUpdate</td><td></td><td>removeChildFromContainer</td><td></td></tr><tr><td></td><td></td><td>commitTextUpdate</td><td></td></tr><tr><td></td><td></td><td>commitUpdate</td><td></td></tr><tr><td></td><td></td><td>resetTextContent</td></tr></tbody></table><p><br></p><p>é€šè¿‡ä¸Šé¢æ¥å£å®šä¹‰å¯ä»¥çŸ¥é“ <code>HostConfig</code> é…ç½®æ¯”è¾ƒä¸°å¯Œï¼Œæ¶‰åŠèŠ‚ç‚¹æ“ä½œã€æŒ‚è½½ã€æ›´æ–°ã€è°ƒåº¦ã€ä»¥åŠå„ç§ç”Ÿå‘½å‘¨æœŸé’©å­, å¯ä»¥æ§åˆ¶æ¸²æŸ“å™¨çš„å„ç§è¡Œä¸º.</p><p>çœ‹å¾—æœ‰ç‚¹è’™åœˆï¼Ÿæ²¡å…³ç³», ä½ æš‚æ—¶æ²¡æœ‰å¿…è¦äº†è§£æ‰€æœ‰çš„å‚æ•°ï¼Œä¸‹é¢ä¼šä¸€ç‚¹ä¸€ç‚¹å±•å¼€è§£é‡Šè¿™äº›åŠŸèƒ½ã€‚ä½ å¯ä»¥æœ€åå†å›æ¥çœ‹è¿™é‡Œã€‚</p><p><br></p><h2 id="å®¿ä¸»ç»„ä»¶"><a href="#å®¿ä¸»ç»„ä»¶" class="headerlink" title="å®¿ä¸»ç»„ä»¶"></a>å®¿ä¸»ç»„ä»¶</h2><p>Reactä¸­æœ‰ä¸¤ç§ç»„ä»¶ç±»å‹ï¼Œä¸€ç§æ˜¯<code>å®¿ä¸»ç»„ä»¶(Host Component)</code>, å¦ä¸€ç§æ˜¯<code>å¤åˆç»„ä»¶(CompositeComponent)</code>. <code>å®¿ä¸»ç»„ä»¶</code>æ˜¯å¹³å°æä¾›çš„ï¼Œä¾‹å¦‚ <code>ReactDOM</code> å¹³å°æä¾›äº† <code>div</code>ã€<code>span</code>ã€<code>h1</code>â€¦ ç­‰ç»„ä»¶. è¿™äº›ç»„ä»¶é€šå¸¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œç›´æ¥æ¸²æŸ“ä¸ºå¹³å°ä¸‹é¢çš„è§†å›¾èŠ‚ç‚¹ã€‚</p><p>è€Œ<code>å¤åˆç»„ä»¶</code>ï¼Œä¹Ÿç§°ä¸º<code>è‡ªå®šä¹‰ç»„ä»¶</code>ï¼Œç”¨äºç»„åˆå…¶ä»–<code>å¤åˆç»„ä»¶</code>å’Œ<code>å®¿ä¸»ç»„ä»¶</code>ï¼Œé€šå¸¸æ˜¯ç±»æˆ–å‡½æ•°ã€‚</p><p>æ¸²æŸ“å™¨ä¸éœ€è¦å…³å¿ƒ<code>å¤åˆç»„ä»¶</code>çš„å¤„ç†, Reconciler äº¤ç»™æ¸²æŸ“å™¨çš„æ˜¯ä¸€é¢—<code>å®¿ä¸»ç»„ä»¶æ ‘</code>ã€‚</p><p>å½“ç„¶åœ¨ <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> ä¸­ï¼Œä¹Ÿå®šä¹‰äº†å¾ˆå¤šå°ç¨‹åºç‰¹å®šçš„<code>å®¿ä¸»ç»„ä»¶</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å­ä½¿ç”¨å®ƒä»¬:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;view&gt;&lt;text&gt;hello world&lt;<span class="regexp">/text&gt;&lt;/</span>view&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><code>Reconciler</code> ä¼šè°ƒç”¨ <code>HostConfig</code> çš„ <code>createInstance</code> å’Œ<code>createTextInstance</code> æ¥åˆ›å»º<code>å®¿ä¸»ç»„ä»¶</code>çš„å®ä¾‹ï¼Œæ‰€ä»¥è‡ªå®šä¹‰æ¸²æŸ“å™¨å¿…é¡»å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•. çœ‹çœ‹ <code>Remax</code> æ˜¯æ€ä¹ˆåšçš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HostConfig = &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºå®¿ä¸»ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  createInstance(type: string, <span class="attr">newProps</span>: any, <span class="attr">container</span>: Container) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = generate();</span><br><span class="line">    <span class="comment">// é¢„å¤„ç†props, remaxä¼šå¯¹äº‹ä»¶ç±»å‹Propsè¿›è¡Œä¸€äº›ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">    <span class="keyword">const</span> props = processProps(newProps, container, id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> VNode(&#123;</span><br><span class="line">      id,</span><br><span class="line">      type,</span><br><span class="line">      props,</span><br><span class="line">      container,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºå®¿ä¸»ç»„ä»¶æ–‡æœ¬èŠ‚ç‚¹å®ä¾‹</span></span><br><span class="line">  createTextInstance(text: string, <span class="attr">container</span>: Container) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = generate();</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> VNode(&#123;</span><br><span class="line">      id,</span><br><span class="line">      type: TYPE_TEXT,</span><br><span class="line">      props: <span class="literal">null</span>,</span><br><span class="line">      container,</span><br><span class="line">    &#125;);</span><br><span class="line">    node.text = text;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦å¤„ç†å­èŠ‚ç‚¹ã€‚å¦‚æœè¿”å›trueåˆ™ä¸åˆ›å»ºï¼Œæ•´ä¸ªä¸‹çº§ç»„ä»¶æ ‘éƒ½ä¼šè¢«å¿½ç•¥ã€‚</span></span><br><span class="line">  <span class="comment">// æœ‰ä¸€äº›åœºæ™¯æ˜¯ä¸éœ€è¦åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹çš„ï¼Œè€Œæ˜¯ç”±çˆ¶èŠ‚ç‚¹å†…éƒ¨æ¶ˆåŒ–ã€‚</span></span><br><span class="line">  <span class="comment">// ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ReactDOMä¸­ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹è®¾ç½®äº†dangerouslySetInnerHTMLï¼Œé‚£ä¹ˆå®ƒçš„childrenåº”è¯¥è¢«å¿½ç•¥ï¼Œ</span></span><br><span class="line">  <span class="comment">// è¿™æ—¶å€™ shouldSetTextContentåˆ™åº”è¯¥è¿”å›true</span></span><br><span class="line">  shouldSetTextContent(type, nextProps) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ ReactDOM ä¸­ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ä¼šé€šè¿‡ <code>document.createElement</code> å’Œ <code>document.createTextNode</code> æ¥åˆ›å»º<code>å®¿ä¸»ç»„ä»¶</code>(å³<code>DOMèŠ‚ç‚¹</code>)ã€‚</p><p><br></p><p><img src="/images/remax/wxm.png" alt></p><p>ä¸Šé¢æ˜¯å¾®ä¿¡å°ç¨‹åºçš„æ¶æ„å›¾(å›¾ç‰‡æ¥æº: <a href="https://mp.weixin.qq.com/s/3QE3g0NmaBAi91lbrihhVw" target="_blank" rel="noopener">ä¸€èµ·è„±å»å°ç¨‹åºçš„å¤–å¥— - å¾®ä¿¡å°ç¨‹åºæ¶æ„è§£æ</a>)ã€‚</p><p><strong>å› ä¸ºå°ç¨‹åºéš”ç¦»äº†<code>æ¸²æŸ“è¿›ç¨‹</code>å’Œ<code>é€»è¾‘è¿›ç¨‹</code>ã€‚<a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> æ˜¯è·‘åœ¨<code>é€»è¾‘è¿›ç¨‹</code>ä¸Šçš„ï¼Œåœ¨<code>é€»è¾‘è¿›ç¨‹</code>ä¸­æ— æ³•è¿›è¡Œå®é™…çš„æ¸²æŸ“, åªèƒ½é€šè¿‡<code>setData</code>æ–¹å¼å°†æ›´æ–°æŒ‡ä»¤ä¼ é€’ç»™<code>æ¸²æŸ“è¿›ç¨‹</code>åï¼Œå†è¿›è¡Œè§£ææ¸²æŸ“</strong>ã€‚</p><p>æ‰€ä»¥<a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a>é€‰æ‹©åœ¨<code>é€»è¾‘è¿›ç¨‹</code>ä¸­å…ˆæ„æˆä¸€é¢—<code>é•œåƒæ ‘</code>(Mirror Tree), ç„¶åå†åŒæ­¥åˆ°<code>æ¸²æŸ“è¿›ç¨‹</code>ä¸­ï¼Œå¦‚ä¸‹å›¾:</p><p><img src="/images/remax/03.png" alt></p><p><br></p><p><strong>ä¸Šé¢çš„ <code>VNode</code> å°±æ˜¯é•œåƒæ ‘ä¸­çš„<code>è™šæ‹ŸèŠ‚ç‚¹</code>ï¼Œä¸»è¦ç”¨äºä¿å­˜ä¸€äº›èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¸åšä»»ä½•ç‰¹æ®Šå¤„ç†</strong>, å®ƒçš„ç»“æ„å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VNode</span> </span>&#123;</span><br><span class="line">  id: number;                  <span class="comment">// å”¯ä¸€çš„èŠ‚ç‚¹id</span></span><br><span class="line">  container: Container;</span><br><span class="line">  children: VNode[];           <span class="comment">// å­èŠ‚ç‚¹</span></span><br><span class="line">  mounted = <span class="literal">false</span>;             <span class="comment">// èŠ‚ç‚¹æ˜¯å¦å·²ç»æŒ‚è½½</span></span><br><span class="line">  type: string | symbol;       <span class="comment">// èŠ‚ç‚¹çš„ç±»å‹</span></span><br><span class="line">  props?: any;                 <span class="comment">// èŠ‚ç‚¹çš„props</span></span><br><span class="line">  parent: VNode | <span class="literal">null</span> = <span class="literal">null</span>; <span class="comment">// çˆ¶èŠ‚ç‚¹å¼•ç”¨</span></span><br><span class="line">  text?: string;               <span class="comment">// å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œè¿™é‡Œä¿å­˜æ–‡æœ¬å†…å®¹</span></span><br><span class="line">  path(): Path                 <span class="comment">// èŠ‚ç‚¹çš„è·¯å¾„. åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹åï¼Œé€šè¿‡pathæ¢å¤åˆ°æ ‘ä¸­</span></span><br><span class="line">  <span class="comment">// å­èŠ‚ç‚¹æ“ä½œ</span></span><br><span class="line">  appendChild(node: VNode, <span class="attr">immediately</span>: boolean)</span><br><span class="line">  removeChild(node: VNode, <span class="attr">immediately</span>: boolean)</span><br><span class="line">  insertBefore(newNode: VNode, <span class="attr">referenceNode</span>: VNode, <span class="attr">immediately</span>: boolean)</span><br><span class="line"></span><br><span class="line">  update()                     <span class="comment">// è§¦å‘åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">  toJSON(): string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>VNode çš„å®Œæ•´ä»£ç å¯ä»¥çœ‹<a href="https://github.com/remaxjs/remax/blob/master/packages/remax/src/VNode.ts" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p><br></p><h2 id="é•œåƒæ ‘çš„æ„å»ºå’Œæ“ä½œ"><a href="#é•œåƒæ ‘çš„æ„å»ºå’Œæ“ä½œ" class="headerlink" title="é•œåƒæ ‘çš„æ„å»ºå’Œæ“ä½œ"></a>é•œåƒæ ‘çš„æ„å»ºå’Œæ“ä½œ</h2><p>è¦æ„å»ºå‡ºå®Œæ•´çš„èŠ‚ç‚¹æ ‘éœ€è¦å®ç°<code>HostConfig</code> çš„ <code>appendChild</code>ã€<code>insertBefore</code>ã€<code>removeChild</code> ç­‰æ–¹æ³•, å¦‚ä¸‹ï¼Œ è¿™äº›æ–¹æ³•éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿‡å¤šè§£é‡Šã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HostConfig = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¯æŒèŠ‚ç‚¹ä¿®æ”¹</span></span><br><span class="line">  <span class="comment">// æœ‰äº›é™æ€æ¸²æŸ“çš„åœºæ™¯ï¼Œä¾‹å¦‚æ¸²æŸ“ä¸ºpdfæ–‡æ¡£ï¼Œè¿™æ—¶å€™å¯ä»¥å…³é—­</span></span><br><span class="line">  <span class="comment">// å½“å…³é—­æ—¶ï¼Œåªéœ€è¦å®ç°appendInitiaChild</span></span><br><span class="line">  supportsMutation: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”¨äºåˆå§‹åŒ–(é¦–æ¬¡)æ—¶æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">  appendInitialChild: <span class="function">(<span class="params">parent: VNode, child: VNode</span>) =&gt;</span> &#123;</span><br><span class="line">    parent.appendChild(child, <span class="literal">false</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">  appendChild(parent: VNode, <span class="attr">child</span>: VNode) &#123;</span><br><span class="line">    parent.appendChild(child, <span class="literal">false</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’å…¥å­èŠ‚ç‚¹</span></span><br><span class="line">  insertBefore(parent: VNode, <span class="attr">child</span>: VNode, <span class="attr">beforeChild</span>: VNode) &#123;</span><br><span class="line">    parent.insertBefore(child, beforeChild, <span class="literal">false</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">  removeChild(parent: VNode, <span class="attr">child</span>: VNode) &#123;</span><br><span class="line">    parent.removeChild(child, <span class="literal">false</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ èŠ‚ç‚¹åˆ°å®¹å™¨èŠ‚ç‚¹ï¼Œä¸€èˆ¬æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦å’ŒappendChildç‰¹æ®ŠåŒºåˆ†</span></span><br><span class="line">  appendChildToContainer(container: any, <span class="attr">child</span>: VNode) &#123;</span><br><span class="line">    container.appendChild(child);</span><br><span class="line">    child.mounted = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’å…¥èŠ‚ç‚¹åˆ°å®¹å™¨èŠ‚ç‚¹</span></span><br><span class="line">  insertInContainerBefore(container: any, <span class="attr">child</span>: VNode, <span class="attr">beforeChild</span>: VNode) &#123;</span><br><span class="line">    container.insertBefore(child, beforeChild);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»å®¹å™¨èŠ‚ç‚¹ç§»é™¤èŠ‚ç‚¹</span></span><br><span class="line">  removeChildFromContainer(container: any, <span class="attr">child</span>: VNode) &#123;</span><br><span class="line">    container.removeChild(child);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="èŠ‚ç‚¹æ›´æ–°"><a href="#èŠ‚ç‚¹æ›´æ–°" class="headerlink" title="èŠ‚ç‚¹æ›´æ–°"></a>èŠ‚ç‚¹æ›´æ–°</h2><p>ä¸Šä¸€èŠ‚è®²çš„æ˜¯æ ‘ç»“æ„å±‚é¢çš„æ›´æ–°ï¼Œå½“èŠ‚ç‚¹å±æ€§å˜åŠ¨æˆ–è€…æ–‡æœ¬å†…å®¹å˜åŠ¨æ—¶ï¼Œä¹Ÿéœ€è¦è¿›è¡Œæ›´æ–°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹åˆ— <code>HostConfig</code> é…ç½®æ¥å¤„ç†è¿™ç±»æ›´æ–°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HostConfig = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ›´æ–°ç›¸å…³</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å¯ä»¥åœ¨è¿™é‡Œæ¯”å¯¹propsï¼Œå¦‚æœpropsæ²¡æœ‰å˜åŒ–åˆ™ä¸è¿›è¡Œæ›´æ–°ï¼Œè¿™å’ŒReactç»„ä»¶çš„shouldComponentUpdateå·®ä¸å¤š</span></span><br><span class="line">  <span class="comment">// **è¿”å›â€™ç©ºâ€˜åˆ™è¡¨ç¤ºä¸æ›´æ–°è¯¥èŠ‚ç‚¹, è¿™æ—¶å€™commitUpdateåˆ™ä¸ä¼šè¢«è°ƒç”¨**</span></span><br><span class="line">  prepareUpdate(node: VNode, <span class="attr">type</span>: string, <span class="attr">oldProps</span>: any, <span class="attr">newProps</span>: any) &#123;</span><br><span class="line">    oldProps = processProps(oldProps, node.container, node.id);</span><br><span class="line">    newProps = processProps(newProps, node.container, node.id);</span><br><span class="line">    <span class="keyword">if</span> (!shallowequal(newProps, oldProps)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿›è¡ŒèŠ‚ç‚¹æ›´æ–°</span></span><br><span class="line">  commitUpdate(</span><br><span class="line">    node: VNode,</span><br><span class="line">    updatePayload: any,</span><br><span class="line">    type: string,</span><br><span class="line">    oldProps: any,</span><br><span class="line">    newProps: any</span><br><span class="line">  ) &#123;</span><br><span class="line">    node.props = processProps(newProps, node.container, node.id);</span><br><span class="line">    node.update();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿›è¡Œæ–‡æœ¬èŠ‚ç‚¹æ›´æ–°</span></span><br><span class="line">  commitTextUpdate(node: VNode, <span class="attr">oldText</span>: string, <span class="attr">newText</span>: string) &#123;</span><br><span class="line">    <span class="keyword">if</span> (oldText !== newText) &#123;</span><br><span class="line">      node.text = newText;</span><br><span class="line">      <span class="comment">// æ›´æ–°èŠ‚ç‚¹</span></span><br><span class="line">      node.update();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ok, è¿™ä¸ªä¹Ÿæ¯”è¾ƒå¥½ç†è§£ã€‚<br>å¯¹äºæ™®é€šèŠ‚ç‚¹æ›´æ–°ï¼Œ<code>Reconciler</code> ä¼šå…ˆè°ƒç”¨ <code>prepareUpdate</code>, ç¡®å®šæ˜¯å¦è¦æ›´æ–°ï¼Œå¦‚æœè¿”å›éç©ºæ•°æ®ï¼Œ<code>Reconciler</code> å°±ä¼šå°†èŠ‚ç‚¹æ”¾å…¥ <code>Effects</code> é“¾ä¸­ï¼Œåœ¨<code>æäº¤</code>é˜¶æ®µè°ƒç”¨ <code>commitUpdate</code> æ¥æ‰§è¡Œæ›´æ–°ã€‚<br>æ–‡æœ¬èŠ‚ç‚¹æ›´æ–°åˆ™ç›´æ¥è°ƒç”¨ <code>commitTextUpdate</code>ï¼Œä¸åœ¨è¯ä¸‹.</p><p><br></p><h2 id="å‰¯ä½œç”¨æäº¤"><a href="#å‰¯ä½œç”¨æäº¤" class="headerlink" title="å‰¯ä½œç”¨æäº¤"></a>å‰¯ä½œç”¨æäº¤</h2><p>React çš„<code>æ›´æ–°çš„ä¸¤ä¸ªé˜¶æ®µ</code>è¿™ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼Œè¿™ä¸ªä¹Ÿä½“ç°åœ¨HostConfigä¸Š:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HostConfig = &#123;</span><br><span class="line">  <span class="comment">// Reconcilerè¯´ï¼Œæˆ‘è¦å¼€å§‹æäº¤äº†ï¼Œä½ æäº¤å‰è¦åšä»€ä¹ˆï¼Œå°±åœ¨è¿™åšå§</span></span><br><span class="line">  <span class="comment">// æ¯”å¦‚ReactDOMä¼šåœ¨è¿™é‡Œä¿å­˜å½“å‰DOMæ–‡æ¡£çš„é€‰ä¸­çŠ¶æ€å’Œç„¦ç‚¹çŠ¶æ€, ä»¥åŠç¦ç”¨äº‹ä»¶å¤„ç†ã€‚å› ä¸ºDOMæ›´æ–°å¯èƒ½ä¼šç ´åè¿™äº›çŠ¶æ€</span></span><br><span class="line">  prepareForCommit: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Reconcilerè¯´ï¼Œæˆ‘å·²ç»æäº¤å®Œäº†</span></span><br><span class="line">  <span class="comment">// ReactDOMä¼šåœ¨è¿™é‡Œæ¢å¤æäº¤å‰çš„DOMæ–‡æ¡£çš„é€‰ä¸­çŠ¶æ€å’Œç„¦ç‚¹çŠ¶æ€</span></span><br><span class="line">  resetAfterCommit: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨åè°ƒé˜¶æ®µï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å®Œæˆ'åˆ›å»º'åè°ƒç”¨ã€‚å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œåˆ™åœ¨æ‰€æœ‰å­èŠ‚ç‚¹appendInitialChildå®Œæˆåè°ƒç”¨</span></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªbooleanå€¼è¡¨ç¤ºâ€™å®Œæˆæäº¤â€˜åæ˜¯å¦è¦è°ƒç”¨commitMount. é€šä¿—è®²å°±æ˜¯å‘Šè¯‰Reconcilerï¼Œå½“å‰èŠ‚ç‚¹å®Œæˆâ€™æŒ‚è½½â€˜åè¦æ‰§è¡ŒæŸäº›ä¸œè¥¿</span></span><br><span class="line">  <span class="comment">// ReactDOMä¼šä½¿ç”¨è¿™ä¸ªé’©å­æ¥å¤„ç†å¸¦æœ‰autofoucså±æ€§çš„èŠ‚ç‚¹ï¼Œåœ¨commitMountä¸­å®ç°è‡ªåŠ¨è·å–ç„¦ç‚¹</span></span><br><span class="line">  finalizeInitialChildren: <span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å’ŒfinalizeInitialChildrené…åˆä½¿ç”¨ï¼Œå¦‚æœå‰è€…è¿”å›trueï¼Œåœ¨Reconcilerå®Œæˆæäº¤åï¼Œå¯¹åº”èŠ‚ç‚¹çš„commitMountä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">  commitMount: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å°†ä¸Šæ–‡è®²åˆ°çš„æ‰€æœ‰é’©å­éƒ½èšåˆèµ·æ¥ï¼ŒæŒ‰ç…§æ›´æ–°çš„é˜¶æ®µå’Œåº”ç”¨çš„ç›®æ ‡(target)è¿›è¡Œåˆ’åˆ†ï¼Œå®ƒä»¬çš„åˆ†å¸ƒæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/images/remax/overview.png" alt></p><p><br></p><p>é‚£ä¹ˆå¯¹äº <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> æ¥è¯´, ä»€ä¹ˆæ—¶å€™åº”è¯¥å°†â€™æ›´æ–°â€™æäº¤åˆ°<code>æ¸²æŸ“è¿›ç¨‹</code>å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸Šå›¾æ‰€æœ‰åœ¨<code>æäº¤é˜¶æ®µ</code>çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ã€‚</p><p><code>æäº¤é˜¶æ®µ</code>åŸæ„å°±æ˜¯ç”¨äºæ‰§è¡Œå„ç§å‰¯ä½œç”¨çš„ï¼Œä¾‹å¦‚è§†å›¾æ›´æ–°ã€è¿œç¨‹æ–¹æ³•è¯·æ±‚ã€è®¢é˜…â€¦ æ‰€ä»¥ <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> ä¹Ÿä¼šåœ¨è¿™ä¸ªé˜¶æ®µæ”¶é›†<code>æ›´æ–°æŒ‡ä»¤</code>ï¼Œåœ¨ä¸‹ä¸€ä¸ªå¾ªç¯æ¨é€ç»™æ¸²æŸ“è¿›ç¨‹ã€‚</p><p><br></p><h2 id="hostconfigæ‰§è¡Œæµç¨‹æ€»ç»“"><a href="#hostconfigæ‰§è¡Œæµç¨‹æ€»ç»“" class="headerlink" title="HostConfigæ‰§è¡Œæµç¨‹æ€»ç»“"></a>HostConfigæ‰§è¡Œæµç¨‹æ€»ç»“</h2><p>å›é¡¾ä¸€ä¸‹è‡ªå®šä¹‰æ¸²æŸ“å™¨å„ç§æ–¹æ³•è°ƒç”¨çš„æµç¨‹, é¦–å…ˆçœ‹ä¸€ä¸‹<strong>æŒ‚è½½</strong>çš„æµç¨‹:</p><p>å‡è®¾æˆ‘ä»¬çš„ç»„ä»¶ç»“æ„å¦‚ä¸‹:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="keyword">new</span> Container()</span><br><span class="line"><span class="keyword">const</span> MyComp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;span&gt;hello world&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;div className=<span class="string">"root"</span>&gt;</span><br><span class="line">    &lt;MyComp /&gt;</span><br><span class="line">    &lt;span&gt;--custom renderer&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;,</span><br><span class="line">  container,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"rendered"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>React ç»„ä»¶æ ‘çš„ç»“æ„å¦‚ä¸‹(å·¦å›¾)ï¼Œä½†å¯¹äºæ¸²æŸ“å™¨æ¥è¯´ï¼Œæ ‘ç»“æ„æ˜¯å³å›¾ã€‚<br>è‡ªå®šä¹‰ç»„ä»¶æ˜¯React å±‚çº§çš„ä¸œè¥¿ï¼Œæ¸²æŸ“å™¨åªéœ€è¦å…³å¿ƒæœ€ç»ˆéœ€è¦æ¸²æŸ“çš„è§†å›¾ç»“æ„, æ¢å¥è¯è¯´æ¸²æŸ“å™¨åªå…³å¿ƒ<code>å®¿ä¸»ç»„ä»¶</code>:</p><p><img src="/images/remax/tree-compare.png" alt></p><p><br></p><p>æŒ‚è½½ä¼šç»å†ä»¥ä¸‹æµç¨‹:</p><p><img src="/images/remax/mount.png" alt></p><p>é€šè¿‡ä¸Šé¢çš„æµç¨‹å›¾ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çœ‹åˆ°æ¯ä¸ªé’©å­çš„è°ƒç”¨æ—¶æœºã€‚</p><p><br></p><p>åŒç†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹èŠ‚ç‚¹<strong>æ›´æ–°</strong>æ—¶çš„æµç¨‹. æˆ‘ä»¬ç¨å¾®æ”¹é€ ä¸€ä¸‹ä¸Šé¢çš„ç¨‹åºï¼Œè®©å®ƒå®šæ—¶è§¦å‘æ›´æ–°:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyComp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> isEven = count % <span class="number">2</span> === <span class="number">0</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// é€’å¢è®¡æ•°å™¨</span></span><br><span class="line">      setCount(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>)</span><br><span class="line">    &#125;, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> clearInterval(timer)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"mycomp"</span> style=&#123;&#123; <span class="attr">color</span>: isEven ? <span class="string">"red"</span> : <span class="string">"blue"</span> &#125;&#125;&gt;</span><br><span class="line">      &#123;isEven ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>even<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="literal">null</span>&#125;</span><br><span class="line">      &lt;span className=<span class="string">"foo"</span>&gt;hello world &#123;count&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä¸‹é¢æ˜¯æ›´æ–°çš„æµç¨‹:</p><p><img src="/images/remax/update.png" alt></p><p><br></p><p>å½“<code>MyComp</code>çš„ <code>count</code> ç”±1å˜ä¸º2æ—¶ï¼Œ<code>MyComp</code> ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™æ–°å¢äº†ä¸€ä¸ª<code>div</code> èŠ‚ç‚¹(çº¢è‰²è™šæ¡†), å¦å¤– <code>hello world 1</code> ä¹Ÿå˜æˆäº† <code>hello world 2</code>ã€‚</p><p>æ–°å¢çš„ <code>div</code> èŠ‚ç‚¹åˆ›å»ºæµç¨‹å’ŒæŒ‚è½½æ—¶ä¸€æ ·ï¼Œåªä¸è¿‡å®ƒä¸ä¼šç«‹å³æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯å…ˆæ”¾åˆ°<code>Effect</code>é“¾è¡¨ä¸­ï¼Œåœ¨<code>æäº¤é˜¶æ®µ</code>ç»Ÿä¸€æ‰§è¡Œã€‚</p><p>åŒç†<code>hello world {count}</code>æ–‡æœ¬èŠ‚ç‚¹çš„æ›´æ–°ã€ä»¥åŠå…¶ä»–èŠ‚ç‚¹çš„ Props æ›´æ–°éƒ½æ˜¯æ”¾åˆ°Effecté“¾è¡¨ä¸­ï¼Œæœ€åæ—¶åˆ»æ‰æ›´æ–°æäº¤. å¦‚ä¸Šå›¾çš„ <code>insertBefore</code>ã€<code>commitTextUpdate</code>ã€<code>commitUpdate</code>.</p><p>å¦å¤–ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ˜¯ <code>prepareUpdate</code> é’©å­ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå‘Šè¯‰ Reconcilerï¼ŒèŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå¦‚æœéœ€è¦æ›´æ–°åˆ™è¿”å›éç©ºå€¼ï¼Œè¿™æ · <code>commitUpdate</code> æ‰ä¼šè¢«è§¦å‘ã€‚</p><p><br></p><h2 id="åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹"><a href="#åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹" class="headerlink" title="åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹"></a>åŒæ­¥åˆ°æ¸²æŸ“è¿›ç¨‹</h2><p>React è‡ªå®šä¹‰æ¸²æŸ“å™¨å·®ä¸å¤šå°±è¿™æ ·äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¹³å°ç›¸å…³çš„äº‹æƒ…äº†ã€‚<br><a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> ç›®å‰çš„åšæ³•æ˜¯åœ¨è§¦å‘æ›´æ–°åï¼Œé€šè¿‡å°ç¨‹åº <code>Page</code> å¯¹è±¡çš„ <code>setData</code> æ–¹æ³•å°†<code>æ›´æ–°æŒ‡ä»¤</code>ä¼ é€’ç»™æ¸²æŸ“è¿›ç¨‹;<br><code>æ¸²æŸ“è¿›ç¨‹</code>ä¾§å†é€šè¿‡ <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxs/" target="_blank" rel="noopener"><code>WXS</code></a> æœºåˆ¶ï¼Œå°†<code>æ›´æ–°æŒ‡ä»¤</code>æ¢å¤åˆ°æ ‘ä¸­ï¼› æœ€åå†é€šè¿‡<code>æ¨¡æ¿</code>æœºåˆ¶ï¼Œå°†æ ‘é€’å½’æ¸²æŸ“å‡ºæ¥ã€‚</p><p>æ•´ä½“çš„æ¶æ„å¦‚ä¸‹:</p><p><img src="/images/remax/07.png" alt></p><p><br></p><p>å…ˆæ¥çœ‹çœ‹<code>é€»è¾‘è¿›ç¨‹</code>ä¾§æ˜¯å¦‚ä½•æ¨é€æ›´æ–°æŒ‡ä»¤çš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æ ¹å®¹å™¨ä¸Šç®¡ç†æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">  requestUpdate(</span><br><span class="line">    path: Path,</span><br><span class="line">    start: number,</span><br><span class="line">    deleteCount: number,</span><br><span class="line">    immediately: boolean,</span><br><span class="line">    ...items: RawNode[]</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">const</span> update: SpliceUpdate = &#123;</span><br><span class="line">      path, <span class="comment">// æ›´æ–°èŠ‚ç‚¹çš„æ ‘è·¯å¾„</span></span><br><span class="line">      start, <span class="comment">// æ›´æ–°èŠ‚ç‚¹åœ¨childrenä¸­çš„ç´¢å¼•</span></span><br><span class="line">      deleteCount,</span><br><span class="line">      items, <span class="comment">// å½“å‰èŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (immediately) &#123;</span><br><span class="line">      <span class="keyword">this</span>.updateQueue.push(update);</span><br><span class="line">      <span class="keyword">this</span>.applyUpdate();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ”¾å…¥æ›´æ–°é˜Ÿåˆ—ï¼Œå»¶æ—¶æ”¶é›†æ›´æ–°æŒ‡ä»¤</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.updateQueue.length === <span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.applyUpdate());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.updateQueue.push(update);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  applyUpdate() &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123;</span><br><span class="line">      type: <span class="string">'splice'</span>,</span><br><span class="line">      payload: <span class="keyword">this</span>.updateQueue.map(<span class="function"><span class="params">update</span> =&gt;</span> (&#123;</span><br><span class="line">        path: stringPath(update.path),</span><br><span class="line">        start: update.start,</span><br><span class="line">        deleteCount: update.deleteCount,</span><br><span class="line">        item: update.items[<span class="number">0</span>],</span><br><span class="line">      &#125;)),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡setDataé€šçŸ¥æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">    <span class="keyword">this</span>.context.setData(&#123; action &#125;);</span><br><span class="line">    <span class="keyword">this</span>.updateQueue = [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„ï¼Œå³å°†éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹(åŒ…å«èŠ‚ç‚¹è·¯å¾„ã€èŠ‚ç‚¹ä¿¡æ¯)æ¨å…¥æ›´æ–°é˜Ÿåˆ—ï¼Œç„¶åè§¦å‘ <code>setData</code> é€šçŸ¥åˆ°<code>æ¸²æŸ“è¿›ç¨‹</code>ã€‚</p><p><br></p><p><code>æ¸²æŸ“è¿›ç¨‹</code>ä¾§ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>WXS</code> æœºåˆ¶ï¼Œç›¸å¯¹åº”åœ°å°†<code>æ›´æ–°æŒ‡ä»¤</code>æ¢å¤åˆ°<code>æ¸²æŸ“æ ‘</code>ä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸²æŸ“æ ‘</span></span><br><span class="line"><span class="keyword">var</span> tree = &#123;</span><br><span class="line">  root: &#123;</span><br><span class="line">    children: [],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æŒ‡ä»¤åº”ç”¨åˆ°æ¸²æŸ“æ ‘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'splice'</span>:</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; action.payload.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> value = <span class="keyword">get</span>(tree, action.payload[i].path);</span><br><span class="line">        if (action.payload[i].item) &#123;</span><br><span class="line">          value.splice(</span><br><span class="line">            action.payload[i].start,</span><br><span class="line">            action.payload[i].deleteCount,</span><br><span class="line">            action.payload[i].item</span><br><span class="line">          );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          value.splice(action.payload[i].start, action.payload[i].deleteCount);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(tree, action.payload[i].path, value);</span><br><span class="line">      &#125;</span><br><span class="line">      return tree;</span><br><span class="line">    default:</span><br><span class="line">      return tree;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>OK, æ¥ç€å¼€å§‹æ¸²æŸ“, <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> é‡‡ç”¨äº†<code>æ¨¡æ¿</code>çš„å½¢å¼è¿›è¡Œæ¸²æŸ“:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">src</span>=<span class="string">"../../helper.wxs"</span> <span class="attr">module</span>=<span class="string">"helper"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">"../../base.wxml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"REMAX_TPL"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;tree: helper.reduce(action)&#125;&#125;"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> ä¸ºæ¯ä¸ªç»„ä»¶ç±»å‹éƒ½ç”Ÿæˆäº†ä¸€ä¸ª<code>template</code>ï¼ŒåŠ¨æ€â€™é€’å½’â€™æ¸²æŸ“æ•´é¢—æ ‘:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">"REMAX_TPL"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;tree.root.children&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"&#123;&#123;id&#125;&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"REMAX_TPL_1_CONTAINER"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;i: item&#125;&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">module</span>=<span class="string">"_h"</span>&gt;</span></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">  v: function(value) &#123;</span><br><span class="line">  return value !== undefined ? value : '';</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æŒ‰ç…§å±‚çº§ç”Ÿæˆæ¨¡æ¿ --&gt;</span></span><br><span class="line">&lt;% for (var i = 1; i &lt;= depth; i++) &#123; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">%var</span> <span class="attr">id</span> = <span class="string">i;</span> %&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ç”Ÿæˆç»„ä»¶æ¨¡æ¿ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span> (<span class="attr">let</span> <span class="attr">component</span> <span class="attr">of</span> <span class="attr">components</span>) &#123; %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>('<span class="attr">.</span>/<span class="attr">component.ejs</span>', &#123;</span></span><br><span class="line"><span class="tag">        <span class="attr">props:</span> <span class="attr">component.props</span>,</span></span><br><span class="line"><span class="tag">        <span class="attr">id:</span> <span class="attr">component.id</span>,</span></span><br><span class="line"><span class="tag">        <span class="attr">templateId:</span> <span class="attr">id</span>,</span></span><br><span class="line"><span class="tag">      &#125;) %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">"REMAX_TPL_&lt;%=id%&gt;_plain-text"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;i: i&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span>&gt;</span>&#123;&#123;i.text&#125;&#125;<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  æŠŠåŠ¨æ€é€‰æ‹©æ¨¡æ¿çš„é€»è¾‘æ”¾å…¥ä¸€ä¸ªæ¨¡æ¿å†…ï¼Œå¯ä»¥æå‡æ€§èƒ½é—®é¢˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">"REMAX_TPL_&lt;%=id%&gt;_CONTAINER"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;i: i&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"&#123;&#123;'REMAX_TPL_&lt;%=id%&gt;_' + i.type&#125;&#125;"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;i: i&#125;&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>é™äºå°ç¨‹åºçš„æ¸²æŸ“æœºåˆ¶ï¼Œä»¥ä¸‹å› ç´ å¯èƒ½ä¼šå½±å“æ¸²æŸ“çš„æ€§èƒ½:</p><ul><li>è¿›ç¨‹IPCã€‚æ›´æ–°æŒ‡ä»¤é€šè¿‡IPCé€šçŸ¥åˆ°æ¸²æŸ“è¿›ç¨‹ï¼Œé¢‘ç¹æ›´æ–°å¯èƒ½ä¼šå½±å“æ€§èƒ½.  ReactNative ä¸­æ¶‰åŠåˆ° Native å’Œ JSå¼•æ“ä¹‹é—´çš„é€šä¿¡ï¼Œä¹Ÿæ˜¯å­˜åœ¨è¿™ä¸ªé—®é¢˜çš„ã€‚<br>æ‰€ä»¥å°ç¨‹åºæ‰æœ‰äº† <code>WXS</code> è¿™ç±»æ–¹æ¡ˆï¼Œç”¨æ¥å¤„ç†å¤æ‚çš„è§†å›¾äº¤äº’é—®é¢˜ï¼Œæ¯”å¦‚åŠ¨ç”»ã€‚æœªæ¥ <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> ä¹Ÿéœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜</li><li><code>Reconciler</code>è¿™ä¸€å±‚å·²ç»è¿›è¡Œäº† Diffï¼Œåˆ°<code>æ¸²æŸ“è¿›ç¨‹</code>å¯èƒ½éœ€è¦é‡å¤å†åšä¸€éï¼Ÿ</li><li>åŸºäºæ¨¡æ¿çš„æ–¹æ¡ˆï¼Œå±€éƒ¨æ›´æ–°æ˜¯å¦ä¼šå¯¼è‡´é¡µé¢çº§åˆ«é‡æ–°æ¸²æŸ“ï¼Ÿå’Œå°ç¨‹åºåŸç”Ÿçš„è‡ªå®šä¹‰ç»„ä»¶ç›¸æ¯”æ€§èƒ½å¦‚ä½•ï¼Ÿ</li></ul><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»¥ <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a> ä¸ºä¾‹ï¼Œç§‘æ™®ä¸€ä¸ª React è‡ªå®šä¹‰æ¸²æŸ“å™¨æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚å¯¹äº <a href="https://github.com/remaxjs" target="_blank" rel="noopener"><code>Remax</code></a>ï¼Œç›®å‰è¿˜å¤„äºå¼€å‘é˜¶æ®µï¼Œå¾ˆå¤šåŠŸèƒ½è¿˜ä¸å®Œå–„ã€‚è‡³äº<a href="https://github.com/remaxjs/remax/issues/156" target="_blank" rel="noopener">æ€§èƒ½å¦‚ä½•</a>ï¼Œç¬”è€…è¿˜ä¸å¥½åšè¯„è®ºï¼Œå¯ä»¥çœ‹å®˜æ–¹ç»™å‡ºçš„åˆæ­¥<a href="https://github.com/remaxjs/benchmark" target="_blank" rel="noopener">åŸºå‡†æµ‹è¯•</a>ã€‚æœ‰èƒ½åŠ›çš„åŒå­¦ï¼Œå¯ä»¥å‚ä¸ä»£ç è´¡çŒ®æˆ–è€… Issue è®¨è®ºã€‚</p><p>æœ€åè°¢è°¢<a href="https://www.zhihu.com/people/meck" target="_blank" rel="noopener">è¾¹æŸ³</a>å¯¹æœ¬æ–‡å®¡æ ¡å’Œå»ºè®®ã€‚</p><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/79788488" target="_blank" rel="noopener">Remax - ä½¿ç”¨çœŸæ­£çš„ React æ„å»ºå°ç¨‹åº</a></li><li><a href="https://zhuanlan.zhihu.com/p/26027085" target="_blank" rel="noopener">React Fiberæ˜¯ä»€ä¹ˆ</a></li><li><a href="https://zhuanlan.zhihu.com/p/57346388" target="_blank" rel="noopener">[è¯‘]æ·±å…¥React fiberæ¶æ„åŠæºç </a></li><li><a href="https://medium.com/@agent_hunt/hello-world-custom-react-renderer-9a95b7cd04bc" target="_blank" rel="noopener">Hello World Custom React Renderer - Shailesh - Medium</a></li><li><a href="https://blog.atulr.com/react-custom-renderer-1/" target="_blank" rel="noopener">âš›ï¸ğŸ‘† Part 1/3 - Beginners guide to Custom React Renderers. How to build your own renderer from scratch?</a> è¿™ç³»åˆ—æ–‡ç« å¾ˆæ£’</li><li><a href="https://zhuanlan.zhihu.com/p/82741561" target="_blank" rel="noopener">è°œä¹‹wxsï¼Œuni-appå¦‚ä½•ç”¨å®ƒå¤§å¹…æå‡æ€§èƒ½</a></li><li><a href="https://zhuanlan.zhihu.com/p/59787245" target="_blank" rel="noopener">å…¨æ–°é‡æ„ï¼Œuni-appå®ç°å¾®ä¿¡ç«¯æ€§èƒ½ç¿»å€</a></li><li><a href="https://www.zhihu.com/search?type=content&amp;q=å°ç¨‹åºåŸç†" target="_blank" rel="noopener">æµ…è°ˆå°ç¨‹åºè¿è¡Œæœºåˆ¶</a></li></ul><p><br></p><p><img src="/images/sponsor.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šä¸ªæœˆèš‚èšé‡‘æœå‰ç«¯å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„åº”ç”¨ &lt;a href=&quot;https://github.com/remaxjs&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;Remax&lt;/code&gt;&lt;/a&gt;, å£å·æ˜¯&lt;strong&gt;ä½¿ç”¨çœŸæ­£çš„ã€å®Œæ•´çš„ React
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>é€è¿‡ç°è±¡çœ‹æœ¬è´¨: å¸¸è§çš„å‰ç«¯æ¶æ„é£æ ¼å’Œæ¡ˆä¾‹</title>
    <link href="https://bobi.ink/2019/09/11/arch-pattern/"/>
    <id>https://bobi.ink/2019/09/11/arch-pattern/</id>
    <published>2019-09-10T16:00:00.000Z</published>
    <updated>2019-09-16T21:24:24.973Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‰€è°“è½¯ä»¶æ¶æ„é£æ ¼ï¼Œæ˜¯æŒ‡æè¿°æŸä¸ªç‰¹å®šåº”ç”¨é¢†åŸŸä¸­ç³»ç»Ÿç»„ç»‡æ–¹å¼çš„æƒ¯ç”¨æ¨¡å¼ã€‚æ¶æ„é£æ ¼å®šä¹‰ä¸€ä¸ªè¯æ±‡è¡¨å’Œä¸€ç»„çº¦æŸï¼Œè¯æ±‡è¡¨ä¸­åŒ…å«ä¸€äº›ç»„ä»¶åŠè¿æ¥å™¨ï¼Œçº¦æŸåˆ™æŒ‡å‡ºç³»ç»Ÿå¦‚ä½•å°†æ„å»ºå’Œè¿æ¥å™¨ç»„åˆèµ·æ¥ã€‚è½¯ä»¶æ¶æ„é£æ ¼åæ˜ äº†é¢†åŸŸä¸­ä¼—å¤šç³»ç»Ÿæ‰€å…±æœ‰çš„ç»“æ„å’Œè¯­ä¹‰ç‰¹æ€§ï¼Œå¹¶æŒ‡å¯¼å¦‚ä½•å°†ç³»ç»Ÿä¸­çš„å„ä¸ªæ¨¡å—å’Œå­ç³»ç»Ÿæœ‰æœºçš„ç»“åˆä¸ºä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿ</p></blockquote><p>æ²¡å¤šå°‘äººèƒ½è®°ä½ä¸Šé¢çš„å®šä¹‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æœ¬æ–‡ä¸æ˜¯ä¸“ä¸šè®¨è®ºç³»ç»Ÿæ¶æ„çš„æ–‡ç« ï¼Œç¬”è€…ä¹Ÿè¿˜æ²¡åˆ°é‚£ä¸ªæ°´å¹³. æ‰€ä»¥æš‚æ—¶æ²¡å¿…è¦çº ç»“äºä»€ä¹ˆæ˜¯æ¶æ„æ¨¡å¼ã€ä»€ä¹ˆæ˜¯æ¶æ„é£æ ¼ã€‚åœ¨è¿™é‡Œ<strong>å°šä¸”æŠŠå®ƒä»¬éƒ½å½“æˆä¸€ä¸ªç³»ç»Ÿæ¶æ„ä¸Šçš„å¥—è·¯, æ‰€è°“çš„å¥—è·¯å°±æ˜¯ä¸€äº›é€šç”¨çš„ã€å¯å¤ç”¨çš„ï¼Œç”¨äºåº”å¯¹æŸç±»é—®é¢˜çš„æ–¹å¼æ–¹æ³•. å¯ä»¥ç†è§£ä¸ºç±»ä¼¼â€œè®¾è®¡æ¨¡å¼â€çš„ä¸œè¥¿ï¼Œåªæ˜¯è§£å†³é—®é¢˜çš„å±‚æ¬¡ä¸ä¸€æ ·</strong>ã€‚</p><p>é€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œæœ¬æ–‡å°†å¸¦ä½ é¢†ç•¥å‰ç«¯é¢†åŸŸä¸€äº›æµè¡ŒæŠ€æœ¯æ ˆèƒŒåçš„æ¶æ„æ€æƒ³ã€‚ç›´æ¥è¿›å…¥æ­£é¢˜å§</p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#åˆ†å±‚é£æ ¼">åˆ†å±‚é£æ ¼</a><ul><li><a href="#virtual-dom">Virtual DOM</a></li><li><a href="#taro">Taro</a></li></ul></li><li><a href="#ç®¡é“å’Œè¿‡æ»¤å™¨">ç®¡é“å’Œè¿‡æ»¤å™¨</a><ul><li><a href="#ä¸­é—´ä»¶middleware">ä¸­é—´ä»¶(Middleware)</a></li></ul></li><li><a href="#äº‹ä»¶é©±åŠ¨">äº‹ä»¶é©±åŠ¨</a></li><li><a href="#mv">MV*</a><ul><li><a href="#å®¶å–»æˆ·æ™“çš„mvc">å®¶å–»æˆ·æ™“çš„MVC</a></li><li><a href="#redux">Redux</a></li></ul></li><li><a href="#å¤åˆ¶é£æ ¼">å¤åˆ¶é£æ ¼</a></li><li><a href="#å¾®å†…æ ¸æ¶æ„">å¾®å†…æ ¸æ¶æ„</a></li><li><a href="#å¾®å‰ç«¯">å¾®å‰ç«¯</a></li><li><a href="#ç»„ä»¶åŒ–æ¶æ„">ç»„ä»¶åŒ–æ¶æ„</a></li><li><a href="#å…¶ä»–">å…¶ä»–</a></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><p><br></p><h2 id="åˆ†å±‚é£æ ¼"><a href="#åˆ†å±‚é£æ ¼" class="headerlink" title="åˆ†å±‚é£æ ¼"></a>åˆ†å±‚é£æ ¼</h2><blockquote><p>æ²¡æœ‰ä»€ä¹ˆé—®é¢˜æ˜¯åˆ†å±‚è§£å†³ä¸äº†ï¼Œå¦‚æœè§£å†³ä¸äº†, å°±å†åŠ ä¸€å±‚ â€”â€” é²è¿… <br><br>ä¸ä¸ï¼ŒåŸè¯æ˜¯: <code>Any problem  in computer science can be solved by anther layer of indirection.</code></p></blockquote><p>åˆ†å±‚æ¶æ„æ˜¯æœ€å¸¸è§çš„è½¯ä»¶æ¶æ„ï¼Œä½ è¦ä¸çŸ¥é“ç”¨ä»€ä¹ˆæ¶æ„ï¼Œæˆ–è€…ä¸çŸ¥é“æ€ä¹ˆè§£å†³é—®é¢˜ï¼Œé‚£å°±å°è¯•åŠ å¤šä¸€å±‚ã€‚</p><p>ä¸€ä¸ªåˆ†å±‚ç³»ç»Ÿæ˜¯æŒ‰ç…§å±‚æ¬¡æ¥ç»„ç»‡çš„ï¼Œæ¯ä¸€å±‚ä¸ºåœ¨å…¶ä¹‹ä¸Šçš„å±‚æä¾›æœåŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨åœ¨å…¶ä¹‹ä¸‹çš„å±‚æ‰€æä¾›çš„æœåŠ¡. <strong>åˆ†å±‚é€šå¸¸å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜</strong>ï¼Ÿ</p><ul><li><p><strong>æ˜¯éš”ç¦»ä¸šåŠ¡å¤æ‚åº¦ä¸æŠ€æœ¯å¤æ‚åº¦çš„åˆ©å™¨</strong>. å…¸å‹çš„ä¾‹å­æ˜¯ç½‘ç»œåè®®, è¶Šé«˜å±‚è¶Šé¢å‘äººç±»ï¼Œè¶Šåº•å±‚è¶Šé¢å‘æœºå™¨ã€‚ä¸€å±‚ä¸€å±‚å¾€ä¸Šï¼Œå¾ˆå¤šæŠ€æœ¯çš„ç»†èŠ‚éƒ½è¢«éšè—äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨<code>HTTP</code>æ—¶ï¼Œä¸éœ€è¦è€ƒè™‘<code>TCP</code>å±‚çš„æ¡æ‰‹å’ŒåŒ…ä¼ è¾“ç»†èŠ‚ï¼Œ<code>TCP</code>å±‚ä¸éœ€è¦å…³å¿ƒ<code>IP</code>å±‚çš„å¯»å€å’Œè·¯ç”±ã€‚</p><p><img src="/images/arch-pattern/tcp-ip-model.png" alt></p><p><br></p></li><li><p><strong>åˆ†ç¦»å…³æ³¨ç‚¹å’Œå¤ç”¨</strong>ã€‚å‡å°‘è·¨è¶Šå¤šå±‚çš„è€¦åˆ, å½“ä¸€å±‚å˜åŠ¨æ—¶ä¸ä¼šå½±å“åˆ°å…¶ä»–å±‚ã€‚ä¾‹å¦‚æˆ‘ä»¬å‰ç«¯é¡¹ç›®å»ºè®®æ‹†åˆ†é€»è¾‘å±‚å’Œè§†å›¾å±‚ï¼Œä¸€æ–¹é¢å¯ä»¥é™ä½é€»è¾‘å’Œè§†å›¾ä¹‹é—´çš„è€¦åˆï¼Œå½“è§†å›¾å±‚å…ƒç´ å˜åŠ¨æ—¶å¯ä»¥å°½é‡å‡å°‘å¯¹é€»è¾‘å±‚çš„å½±å“ï¼›å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯, å½“é€»è¾‘æŠ½å–å‡ºå»åï¼Œå¯ä»¥è¢«ä¸åŒå¹³å°çš„è§†å›¾å¤ç”¨ã€‚</p></li></ul><p><br></p><p>å…³æ³¨ç‚¹åˆ†ç¦»ä¹‹åï¼Œè½¯ä»¶çš„ç»“æ„ä¼šå˜å¾—å®¹æ˜“ç†è§£å’Œå¼€å‘, æ¯ä¸€å±‚å¯ä»¥è¢«å¤ç”¨, å®¹æ˜“è¢«æµ‹è¯•, å…¶ä»–å±‚çš„æ¥å£é€šè¿‡æ¨¡æ‹Ÿè§£å†³. ä½†æ˜¯åˆ†å±‚æ¶æ„ï¼Œä¹Ÿä¸æ˜¯å…¨æ˜¯ä¼˜ç‚¹ï¼Œ<strong>åˆ†å±‚çš„æŠ½è±¡å¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•ˆç‡å’Œçµæ´»æ€§</strong>, æ¯”å¦‚ç¼–ç¨‹è¯­è¨€å°±æœ‰â€™å±‚æ¬¡â€™(æ­¤ä¾‹å¯èƒ½ä¸å¤ªä¸¥è°¨)ï¼Œè¯­è¨€æŠ½è±¡çš„å±‚æ¬¡è¶Šé«˜ï¼Œä¸€èˆ¬è¿è¡Œæ•ˆç‡å¯èƒ½ä¼šæœ‰æ‰€è¡°å‡:</p><p><img src="/images/arch-pattern/lang.png" alt></p><p>åˆ†å±‚æ¶æ„åœ¨è½¯ä»¶é¢†åŸŸçš„æ¡ˆä¾‹å®åœ¨å¤ªå¤šå¤ªå¤šäº†ï¼Œå’±è®²è®²å‰ç«¯çš„ä¸€äº›â€™åˆ†å±‚â€™æ¡ˆä¾‹ï¼š</p><p><br></p><h3 id="virtual-dom"><a href="#virtual-dom" class="headerlink" title="Virtual DOM"></a>Virtual DOM</h3><p>å‰ç«¯çŸ³å™¨æ—¶ä»£ï¼Œæˆ‘ä»¬é¡µé¢äº¤äº’å’Œæ¸²æŸ“ï¼Œæ˜¯é€šè¿‡æœåŠ¡ç«¯æ¸²æŸ“æˆ–è€…ç›´æ¥æ“ä½œDOMå®ç°çš„, æœ‰ç‚¹åƒC/C++è¿™ç±»ç³»ç»Ÿç¼–ç¨‹è¯­è¨€æ‰‹åŠ¨æ“çºµå†…å­˜. é‚£æ—¶å€™<code>JQuery</code>å¾ˆç«:</p><p><img src="/images/arch-pattern/jquery.png" alt></p><p>åæ¥éšç€è½¯ç¡¬ä»¶æ€§èƒ½è¶Šæ¥è¶Šå¥½ã€Webåº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå‰ç«¯å¼€å‘è€…çš„ç”Ÿäº§åŠ›ä¹Ÿè¦è·Ÿä¸Šï¼Œç±»ä¼¼JQueryè¿™ç§å‘½ä»¤å¼çš„ç¼–ç¨‹æ–¹å¼æ— ç–‘æ˜¯æ¯”è¾ƒä½æ•ˆçš„. å°½ç®¡æ‰‹åŠ¨æ“ä½œ DOM å¯èƒ½å¯ä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†æ˜¯è¿™æ ·å¯¹å¤§éƒ¨åˆ†å¼€å‘è€…æ¥è¯´å¤ªä½æ•ˆäº†ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ¥å—ç‰ºç‰²ä¸€ç‚¹æ€§èƒ½æ¢å–æ›´é«˜çš„å¼€å‘æ•ˆç‡çš„.</p><p>æ€ä¹ˆè§£å†³ï¼Œå†åŠ ä¸€å±‚å§ï¼Œåæ¥Reactå°±æäº†ä¸€å±‚VirtualDOMã€‚æˆ‘ä»¬å¯ä»¥å£°æ˜å¼ã€ç»„åˆå¼åœ°æ„å»ºä¸€é¢—å¯¹è±¡æ ‘, ç„¶åäº¤ç”±Reactå°†å®ƒæ˜ å°„åˆ°DOMï¼š</p><p><img src="/images/arch-pattern/vd1.png" alt></p><p>ä¸€å¼€å§‹VirtualDOMå’ŒDOMçš„å…³ç³»æ¯”è¾ƒæš§æ˜§ï¼Œä¸¤è€…æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ã€‚åé¢æœ‰äººæƒ³ï¼Œæˆ‘ä»¬æœ‰äº†VirtualDOMè¿™ä¸ªæŠ½è±¡å±‚ï¼Œé‚£åº”è¯¥èƒ½å¤šæç‚¹åˆ«çš„ï¼Œæ¯”å¦‚æ¸²æŸ“åˆ°ç§»åŠ¨ç«¯åŸç”Ÿç»„ä»¶ã€PDFã€Canvasã€ç»ˆç«¯UIç­‰ç­‰ã€‚</p><p>åæ¥VirtualDOMè¿›è¡Œäº†æ›´å½»åº•çš„åˆ†å±‚ï¼Œæœ‰ç€è¿™ä¸ªæŠ½è±¡å±‚æˆ‘ä»¬å¯ä»¥å°†VirtualDOMæ˜ å°„åˆ°æ›´å¤šç±»ä¼¼åº”ç”¨åœºæ™¯:</p><p><img src="/images/arch-pattern/vd2.png" alt></p><p>æ‰€ä»¥è¯´ VirtualDOM æ›´å¤§çš„æ„ä¹‰åœ¨äºå¼€å‘æ–¹å¼çš„è½¬å˜: å£°æ˜å¼ã€ æ•°æ®é©±åŠ¨, è®©å¼€å‘è€…ä¸éœ€è¦å…³å¿ƒ DOM çš„æ“ä½œç»†èŠ‚(å±æ€§æ“ä½œã€äº‹ä»¶ç»‘å®šã€DOM èŠ‚ç‚¹å˜æ›´)ï¼Œæ¢å¥è¯è¯´åº”ç”¨çš„å¼€å‘æ–¹å¼å˜æˆäº†<code>view=f(state)</code>, è¿™å¯¹ç”Ÿäº§åŠ›çš„è§£æ”¾æ˜¯æœ‰å¾ˆå¤§æ¨åŠ¨ä½œç”¨çš„; å¦å¤–æœ‰äº†VirtualDOMè¿™ä¸€å±‚æŠ½è±¡å±‚ï¼Œä½¿å¾—å¤šå¹³å°æ¸²æŸ“æˆä¸ºå¯èƒ½ã€‚</p><p>å½“ç„¶VirtualDOMæˆ–è€…Reactï¼Œä¸æ˜¯å”¯ä¸€ï¼Œä¹Ÿä¸æ˜¯ç¬¬ä¸€ä¸ªè¿™æ ·çš„è§£å†³æ–¹æ¡ˆã€‚å…¶ä»–å‰ç«¯æ¡†æ¶ï¼Œä¾‹å¦‚Vueã€AngularåŸºæœ¬éƒ½æ˜¯è¿™æ ·ä¸€ä¸ªå‘å±•å†ç¨‹ã€‚</p><p>ä¸Šé¢è¯´äº†ï¼Œåˆ†å±‚ä¸æ˜¯é“¶å¼¹ã€‚æˆ‘ä»¬é€šè¿‡ReactNativeå¯ä»¥å¼€å‘è·¨å¹³å°çš„ç§»åŠ¨åº”ç”¨ï¼Œä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒè¿è¡Œæ•ˆç‡æˆ–è€…çµæ´»æ€§æš‚æ—¶æ˜¯æ— æ³•ä¸åŸç”Ÿåº”ç”¨æ¯”æ‹Ÿçš„ã€‚</p><p><br></p><h3 id="taro"><a href="#taro" class="headerlink" title="Taro"></a>Taro</h3><p><strong><a href="https://taro-docs.jd.com/taro/docs/README.html" target="_blank" rel="noopener">Taro</a> å’ŒReactä¸€æ ·ä¹Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„é£æ ¼ï¼Œåªä¸è¿‡ä»–ä»¬è§£å†³çš„é—®é¢˜æ˜¯ç›¸åçš„ã€‚ReactåŠ ä¸Šä¸€ä¸ªåˆ†å±‚ï¼Œå¯ä»¥æ¸²æŸ“åˆ°ä¸åŒçš„è§†å›¾å½¢æ€ï¼›è€ŒTaroåˆ™æ˜¯ä¸ºäº†ç»Ÿä¸€å¤šæ ·çš„è§†å›¾å½¢æ€</strong>: å›½å†…ç°å¦‚ä»Šå¸‚é¢ä¸Šç«¯çš„å½¢æ€å¤šç§å¤šæ ·ï¼ŒWebã€React-Nativeã€å¾®ä¿¡å°ç¨‹åºâ€¦â€¦ é’ˆå¯¹ä¸åŒçš„ç«¯å»ç¼–å†™å¤šå¥—ä»£ç çš„æˆæœ¬éå¸¸é«˜ï¼Œè¿™ç§éœ€æ±‚å‚¬ç”Ÿäº†Taroè¿™ç±»æ¡†æ¶çš„è¯ç”Ÿ. ä½¿ç”¨ Taroï¼Œæˆ‘ä»¬å¯ä»¥åªä¹¦å†™ä¸€å¥—ä»£ç , é€šè¿‡ç¼–è¯‘å·¥å…·å¯ä»¥è¾“å‡ºåˆ°ä¸åŒçš„ç«¯:</p><p><img src="/images/arch-pattern/taro.jpg" alt><br>(å›¾ç‰‡æ¥æº: <a href="https://aotu.io/notes/2018/06/07/Taro/" target="_blank" rel="noopener">å¤šç«¯ç»Ÿä¸€å¼€å‘æ¡†æ¶ - Taro</a>)</p><p><br><br><br></p><h2 id="ç®¡é“å’Œè¿‡æ»¤å™¨"><a href="#ç®¡é“å’Œè¿‡æ»¤å™¨" class="headerlink" title="ç®¡é“å’Œè¿‡æ»¤å™¨"></a>ç®¡é“å’Œè¿‡æ»¤å™¨</h2><p>åœ¨ç®¡é“/è¿‡æ»¤å™¨æ¶æ„é£æ ¼ä¸­ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ç»„è¾“å…¥å’Œè¾“å‡ºï¼Œæ¯ä¸ªç»„ä»¶èŒè´£éƒ½å¾ˆå•ä¸€, æ•°æ®è¾“å…¥ç»„ä»¶ï¼Œç»è¿‡å†…éƒ¨å¤„ç†ï¼Œç„¶åå°†å¤„ç†è¿‡çš„æ•°æ®è¾“å‡ºã€‚æ‰€ä»¥è¿™äº›ç»„ä»¶ä¹Ÿç§°ä¸ºè¿‡æ»¤å™¨ï¼Œè¿æ¥å™¨æŒ‰ç…§ä¸šåŠ¡éœ€æ±‚å°†ç»„ä»¶è¿æ¥èµ·æ¥ï¼Œå…¶å½¢çŠ¶å°±åƒâ€˜ç®¡é“â€™ä¸€æ ·ï¼Œè¿™ç§æ¶æ„é£æ ¼ç”±æ­¤å¾—åã€‚</p><p><img src="/images/arch-pattern/pipeline.png" alt></p><p>è¿™é‡Œé¢æœ€ç»å…¸çš„æ¡ˆä¾‹æ˜¯<code>*unix</code> Shellå‘½ä»¤ï¼ŒUnixçš„å“²å­¦å°±æ˜¯â€œåªåšä¸€ä»¶äº‹ï¼ŒæŠŠå®ƒåšå¥½â€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸ç”¨çš„Unixå‘½ä»¤åŠŸèƒ½éƒ½éå¸¸å•ä¸€ï¼Œä½†æ˜¯Unix Shellè¿˜æœ‰ä¸€ä»¶æ³•å®å°±æ˜¯ç®¡é“ï¼Œé€šè¿‡ç®¡é“æˆ‘ä»¬å¯ä»¥å°†å‘½ä»¤é€šè¿‡<code>æ ‡å‡†è¾“å…¥è¾“å‡º</code>ä¸²è”èµ·æ¥å®ç°å¤æ‚çš„åŠŸèƒ½:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> è·å–ç½‘é¡µï¼Œå¹¶è¿›è¡Œæ‹¼å†™æ£€æŸ¥ã€‚ä»£ç æ¥æºäºwiki</span><br><span class="line">curl "http://en.wikipedia.org/wiki/Pipeline_(Unix)" | \</span><br><span class="line">sed 's/[^a-zA-Z ]/ /g' | \</span><br><span class="line">tr 'A-Z ' 'a-z\n' | \</span><br><span class="line">grep '[a-z]' | \</span><br><span class="line">sort -u | \</span><br><span class="line">comm -23 - /usr/share/dict/words | \</span><br><span class="line">less</span><br></pre></td></tr></table></figure><p><br></p><p>å¦ä¸€ä¸ªå’ŒUnixç®¡é“ç›¸ä¼¼çš„ä¾‹å­æ˜¯<code>ReactiveX</code>, ä¾‹å¦‚<a href="https://github.com/ReactiveX/rxjs" target="_blank" rel="noopener">RxJS</a>. å¾ˆå¤šæ•™ç¨‹å°†Rxæ¯”å–»æˆæ²³æµï¼Œè¿™ä¸ªæ²³æµçš„å¼€å¤´å°±æ˜¯ä¸€ä¸ªäº‹ä»¶æºï¼Œè¿™ä¸ªäº‹ä»¶æºæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡å‘å¸ƒäº‹ä»¶ã€‚RxçœŸæ­£å¼ºå¤§çš„å…¶å®æ˜¯å®ƒçš„æ“ä½œç¬¦ï¼Œæœ‰äº†è¿™äº›æ“ä½œç¬¦ï¼Œä½ å¯ä»¥å¯¹è¿™æ¡æ²³æµ<a href="https://rxjs.dev/operator-decision-tree" target="_blank" rel="noopener">åšä¸€åˆ‡å¯ä»¥åšçš„äº‹æƒ…</a>ï¼Œä¾‹å¦‚åˆ†æµã€èŠ‚æµã€å»ºå¤§åã€è½¬æ¢ã€ç»Ÿè®¡ã€åˆå¹¶ã€äº§ç”Ÿæ²³æµçš„æ²³æµâ€¦â€¦</p><p>è¿™äº›æ“ä½œç¬¦å’ŒUnixçš„å‘½ä»¤ä¸€æ ·ï¼ŒèŒè´£éƒ½å¾ˆå•ä¸€ï¼Œåªå¹²å¥½ä¸€ä»¶äº‹æƒ…ã€‚ä½†æˆ‘ä»¬ç®¡é“å°†å®ƒä»¬ç»„åˆèµ·æ¥çš„æ—¶å€™ï¼Œå°±è¿¸å‘äº†æ— é™çš„èƒ½åŠ›.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromEvent &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; throttleTime, map, scan &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line">fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">  .pipe(</span><br><span class="line">    throttleTime(<span class="number">1000</span>),</span><br><span class="line">    map(<span class="function"><span class="params">event</span> =&gt;</span> event.clientX),</span><br><span class="line">    scan(<span class="function">(<span class="params">count, clientX</span>) =&gt;</span> count + clientX, <span class="number">0</span>)</span><br><span class="line">  )</span><br><span class="line">  .subscribe(<span class="function"><span class="params">count</span> =&gt;</span> <span class="built_in">console</span>.log(count));</span><br></pre></td></tr></table></figure><p><br></p><p>é™¤äº†ä¸Šè¿°çš„RxJSï¼Œç®¡é“æ¨¡å¼åœ¨å‰ç«¯é¢†åŸŸä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨ï¼Œä¸»è¦é›†ä¸­åœ¨å‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸã€‚ä¾‹å¦‚â€™è€ç‰Œâ€™çš„é¡¹ç›®æ„å»ºå·¥å…·<a href="https://www.gulpjs.com.cn/" target="_blank" rel="noopener">Gulp</a>, Gulpä½¿ç”¨ç®¡é“åŒ–æ¨¡å¼æ¥å¤„ç†å„ç§æ–‡ä»¶ç±»å‹ï¼Œç®¡é“ä¸­çš„æ¯ä¸€ä¸ªæ­¥éª¤ç§°ä¸ºTranspiler(è½¬è¯‘å™¨), å®ƒä»¬ä»¥ NodeJS çš„Stream ä½œä¸ºè¾“å…¥è¾“å‡ºã€‚æ•´ä¸ªè¿‡ç¨‹é«˜æ•ˆè€Œç®€å•ã€‚</p><p><img src="/images/arch-pattern/gulp.png" alt></p><p><br></p><p>ä¸ç¡®å®šæ˜¯å¦å—åˆ°Gulpçš„å½±å“ï¼Œç°ä»£çš„<a href="https://www.webpackjs.com/" target="_blank" rel="noopener">Webpack</a>æ‰“åŒ…å·¥å…·ï¼Œä¹Ÿä½¿ç”¨åŒæ ·çš„æ¨¡å¼æ¥å®ç°å¯¹æ–‡ä»¶çš„å¤„ç†, å³<a href="https://www.webpackjs.com/concepts/loaders/" target="_blank" rel="noopener">Loader</a>, Loader ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢, é€šè¿‡Loaderçš„ç»„åˆï¼Œå¯ä»¥å®ç°å¤æ‚çš„æ–‡ä»¶è½¬è¯‘éœ€æ±‚.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">          loader: <span class="string">"style-loader"</span> <span class="comment">// å°† JS å­—ç¬¦ä¸²ç”Ÿæˆä¸º style èŠ‚ç‚¹</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">          loader: <span class="string">"css-loader"</span> <span class="comment">// å°† CSS è½¬åŒ–æˆ CommonJS æ¨¡å—</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">          loader: <span class="string">"sass-loader"</span> <span class="comment">// å°† Sass ç¼–è¯‘æˆ CSS</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="ä¸­é—´ä»¶-middleware"><a href="#ä¸­é—´ä»¶-middleware" class="headerlink" title="ä¸­é—´ä»¶(Middleware)"></a>ä¸­é—´ä»¶(Middleware)</h3><p><img src="/images/arch-pattern/middleware.png" alt></p><p>å¦‚æœå¼€å‘è¿‡<code>Express</code>ã€<code>Koa</code>æˆ–è€…<code>Redux</code>, ä½ å¯èƒ½ä¼šå‘ç°ä¸­é—´ä»¶æ¨¡å¼å’Œä¸Šè¿°çš„ç®¡é“æ¨¡å¼æœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ï¼Œå¦‚ä¸Šå›¾ã€‚ç›¸æ¯”ç®¡é“ï¼Œä¸­é—´ä»¶æ¨¡å¼å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ´‹è‘±å‰–é¢æ¥å½¢å®¹. ä½†å’Œç®¡é“ç›¸æ¯”ï¼Œä¸€èˆ¬çš„ä¸­é—´ä»¶å®ç°æœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p><ul><li>ä¸­é—´ä»¶æ²¡æœ‰æ˜¾å¼çš„è¾“å…¥è¾“å‡ºã€‚è¿™äº›ä¸­é—´ä»¶ä¹‹é—´é€šå¸¸é€šè¿‡é›†ä¸­å¼çš„ä¸Šä¸‹æ–‡å¯¹è±¡æ¥å…±äº«çŠ¶æ€</li><li>æœ‰ä¸€ä¸ªå¾ªç¯çš„è¿‡ç¨‹ã€‚ç®¡é“ä¸­ï¼Œæ•°æ®å¤„ç†å®Œæ¯•åäº¤ç»™ä¸‹æ¸¸äº†ï¼Œåé¢å°±ä¸ç®¡äº†ã€‚è€Œä¸­é—´ä»¶è¿˜æœ‰ä¸€ä¸ªå›å½’çš„è¿‡ç¨‹ï¼Œå½“ä¸‹æ¸¸å¤„ç†å®Œæ¯•åä¼šè¿›è¡Œå›æº¯ï¼Œæ‰€ä»¥æœ‰æœºä¼šå¹²é¢„ä¸‹æ¸¸çš„å¤„ç†ç»“æœã€‚</li></ul><p>æˆ‘åœ¨è°·æ­Œä¸Šæœäº†è€åŠå¤©ä¸­é—´ä»¶ï¼Œå¯¹äºä¸­é—´ä»¶éƒ½æ²¡æœ‰å¾—åˆ°ä¸€ä¸ªä»¤æˆ‘æ»¡æ„çš„å®šä¹‰. <strong>æš‚ä¸”æŠŠå®ƒå½“ä½œä¸€ä¸ªç‰¹æ®Šå½¢å¼çš„ç®¡é“æ¨¡å¼å§</strong>ã€‚è¿™ç§æ¨¡å¼é€šå¸¸ç”¨äºåç«¯ï¼Œå®ƒå¯ä»¥å¹²å‡€åœ°åˆ†ç¦»å‡ºè¯·æ±‚çš„ä¸åŒé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯åˆ†ç¦»å…³æ³¨ç‚¹ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºè¿™äº›ä¸­é—´ä»¶ï¼š</p><ul><li>æ—¥å¿—ï¼š è®°å½•å¼€å§‹æ—¶é—´ â¸ è®¡ç®—å“åº”æ—¶é—´ï¼Œè¾“å‡ºè¯·æ±‚æ—¥å¿—</li><li>è®¤è¯ï¼š éªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•</li><li>æˆæƒï¼š éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æ‰§è¡Œè¯¥æ“ä½œçš„æƒé™</li><li>ç¼“å­˜ï¼š æ˜¯å¦æœ‰ç¼“å­˜ç»“æœï¼Œæœ‰çš„è¯å°±ç›´æ¥è¿”å› â¸ å½“ä¸‹æ¸¸å“åº”å®Œæˆåï¼Œå†åˆ¤æ–­ä¸€ä¸‹å“åº”æ˜¯å¦å¯ä»¥è¢«ç¼“å­˜</li><li>æ‰§è¡Œï¼š æ‰§è¡Œå®é™…çš„è¯·æ±‚å¤„ç† â¸ å“åº”</li></ul><p>æœ‰äº†ä¸­é—´ä»¶ä¹‹åï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸ªå“åº”å¤„ç†æ–¹æ³•ä¸­éƒ½åŒ…å«è¿™äº›é€»è¾‘ï¼Œå…³æ³¨å¥½è‡ªå·±è¯¥åšçš„äº‹æƒ…ã€‚ä¸‹é¢æ˜¯Koaçš„ç¤ºä¾‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">const</span> rt = ctx.response.get(<span class="string">'X-Response-Time'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;rt&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// x-response-time</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start;</span><br><span class="line">  ctx.set(<span class="string">'X-Response-Time'</span>, <span class="string">`<span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// response</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p><br></p><h2 id="äº‹ä»¶é©±åŠ¨"><a href="#äº‹ä»¶é©±åŠ¨" class="headerlink" title="äº‹ä»¶é©±åŠ¨"></a>äº‹ä»¶é©±åŠ¨</h2><p>äº‹ä»¶é©±åŠ¨, æˆ–è€…ç§°ä¸º<code>å‘å¸ƒ-è®¢é˜…</code>é£æ ¼ï¼Œ å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´æ˜¯å†ç†Ÿæ‚‰ä¸è¿‡çš„æ¦‚å¿µäº†. å®ƒ<strong>å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</strong>ï¼Œ åœ¨äº‹ä»¶é©±åŠ¨ç³»ç»Ÿé£æ ¼ä¸­ï¼Œç»„ä»¶ä¸ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªç»„ä»¶ï¼Œè€Œæ˜¯è§¦å‘æˆ–å¹¿æ’­ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ã€‚ç³»ç»Ÿä¸­çš„å…¶ä»–ç»„ä»¶åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ä¸­æ³¨å†Œã€‚å½“ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€šçŸ¥åœ¨è¿™ä¸ªäº‹ä»¶ä¸­æ³¨å†Œçš„æ‰€æœ‰ç»„ä»¶. </p><p>è¿™æ ·å°±<strong>åˆ†ç¦»äº†å…³æ³¨ç‚¹ï¼Œè®¢é˜…è€…ä¾èµ–äºäº‹ä»¶è€Œä¸æ˜¯ä¾èµ–äºå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…ä¹Ÿä¸éœ€è¦å…³å¿ƒè®¢é˜…è€…ï¼Œä¸¤è€…è§£é™¤äº†è€¦åˆ</strong>ã€‚</p><p>ç”Ÿæ´»ä¸­ä¹Ÿæœ‰å¾ˆå¤š<code>å‘å¸ƒ-è®¢é˜…</code>çš„ä¾‹å­ï¼Œæ¯”å¦‚å¾®ä¿¡å…¬ä¼—å·ä¿¡æ¯è®¢é˜…ï¼Œå½“æ–°å¢ä¸€ä¸ªè®¢é˜…è€…çš„æ—¶å€™ï¼Œå‘å¸ƒè€…å¹¶ä¸éœ€è¦ä½œå‡ºä»»ä½•è°ƒæ•´ï¼ŒåŒæ ·å‘å¸ƒè€…è°ƒæ•´çš„æ—¶å€™ä¹Ÿä¸ä¼šå½±å“åˆ°è®¢é˜…è€…ï¼Œåªè¦åè®®æ²¡æœ‰å˜åŒ–ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<strong>å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´å…¶å®æ˜¯ä¸€ç§å¼±åŒ–çš„åŠ¨æ€çš„å…³è”å…³ç³»</strong>ã€‚</p><p><strong>è§£é™¤è€¦åˆç›®çš„æ˜¯ä¸€æ–¹é¢, å¦ä¸€æ–¹é¢ä¹Ÿå¯èƒ½ç”±åŸºå› å†³å®šçš„ï¼Œä¸€äº›äº‹æƒ…å¤©ç„¶å°±ä¸é€‚åˆæˆ–ä¸æ”¯æŒç”¨åŒæ­¥çš„æ–¹å¼å»è°ƒç”¨ï¼Œæˆ–è€…è¿™äº›è¡Œä¸ºæ˜¯å¼‚æ­¥è§¦å‘çš„</strong>ã€‚</p><p>JavaScriptçš„åŸºå› å†³å®šäº‹ä»¶é©±åŠ¨æ¨¡å¼åœ¨å‰ç«¯é¢†åŸŸçš„å¹¿æ³›ä½¿ç”¨. åœ¨<a href="https://juejin.im/post/5d693d8b6fb9a06aca383488" target="_blank" rel="noopener">æµè§ˆå™¨å’ŒNodeä¸­çš„JavaScriptæ˜¯å¦‚ä½•å·¥ä½œçš„? å¯è§†åŒ–è§£é‡Š</a> ç®€å•ä»‹ç»äº†Javascriptçš„æ‰§è¡ŒåŸç†ï¼Œå…¶ä¸­æåˆ°JavaScriptæ˜¯å•çº¿ç¨‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸ºäº†åº”å¯¹å„ç§å®é™…çš„åº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªçº¿ç¨‹ä»¥å‹æ ¹å¿™ä¸è¿‡æ¥çš„ï¼Œäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ–¹å¼æ˜¯JavaScriptçš„æ•‘å‘½ç¨»è‰.</p><p>æµè§ˆå™¨æ–¹é¢ï¼Œæµè§ˆå™¨å°±æ˜¯ä¸€ä¸ªGUIç¨‹åºï¼Œ<strong>GUIç¨‹åºæ˜¯ä¸€ä¸ªå¾ªç¯(æ›´ä¸“ä¸šçš„åå­—æ˜¯äº‹ä»¶å¾ªç¯)ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œç¨‹åºå¤„ç†ç„¶ååé¦ˆåˆ°é¡µé¢ï¼Œå†æ¥æ”¶ç”¨æˆ·è¾“å…¥â€¦</strong> ç”¨æˆ·çš„è¾“å…¥æ˜¯å¼‚æ­¥ï¼Œå°†ç”¨æˆ·è¾“å…¥æŠ½è±¡ä¸ºäº‹ä»¶æ˜¯æœ€ç®€æ´ã€è‡ªç„¶ã€çµæ´»çš„æ–¹å¼ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šäº‹ä»¶é©±åŠ¨å’Œå¼‚æ­¥æ˜¯ä¸èƒ½åˆ’ç­‰å·çš„ã€‚å¼‚æ­¥ !== äº‹ä»¶é©±åŠ¨ï¼Œäº‹ä»¶é©±åŠ¨ !== å¼‚æ­¥</p></blockquote><p><strong>æ‰©å±•</strong>:</p><ul><li><strong>å“åº”å¼ç¼–ç¨‹</strong>: å“åº”å¼ç¼–ç¨‹æœ¬è´¨ä¸Šä¹Ÿæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œä¸‹é¢æ˜¯å‰ç«¯é¢†åŸŸæ¯”è¾ƒæµè¡Œçš„ä¸¤ç§å“åº”å¼æ¨¡å¼ï¼š<ul><li><code>å‡½æ•°å“åº”å¼(Functional Reactive Programming)</code>, å…¸å‹ä»£è¡¨RxJS</li><li><code>é€æ˜çš„å‡½æ•°å“åº”å¼ç¼–ç¨‹(Transparently applying Functional Reactive Programming - TFRP)</code>, å…¸å‹ä»£è¡¨Vueã€Mobx</li></ul></li><li><strong>æ¶ˆæ¯æ€»çº¿</strong>ï¼šæŒ‡æ¥æ”¶ã€å‘é€æ¶ˆæ¯çš„è½¯ä»¶ç³»ç»Ÿã€‚æ¶ˆæ¯åŸºäºä¸€ç»„å·²çŸ¥çš„æ ¼å¼ï¼Œä»¥ä¾¿ç³»ç»Ÿæ— éœ€çŸ¥é“å®é™…æ¥æ”¶è€…å°±èƒ½äº’ç›¸é€šä¿¡</li></ul><p><br></p><h2 id="mv"><a href="#mv" class="headerlink" title="MV*"></a>MV*</h2><p><code>MV*</code>æ¶æ„é£æ ¼åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ã€‚æˆ‘è§‰MV*æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§åˆ†å±‚æ¶æ„ï¼Œä¸€æ ·å¼ºè°ƒèŒè´£åˆ†ç¦»ã€‚å…¶ä¸­æœ€ä¸ºç»å…¸çš„æ˜¯MVCæ¶æ„é£æ ¼ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰å„ç§è¡ç”Ÿé£æ ¼ï¼Œä¾‹å¦‚<code>MVP</code>ã€<code>MVVM</code>ã€<a href="https://medium.com/@fkrautwald/plug-and-play-all-your-observable-streams-with-cycle-js-e543fc287872#.by4c219c8" target="_blank" rel="noopener"><code>MVI(Model View Intent)</code></a>. è¿˜æœ‰æœ‰ç‚¹å…³è”<code>Flux</code>æˆ–è€…<code>Redux</code>æ¨¡å¼ã€‚</p><p><br></p><h3 id="å®¶å–»æˆ·æ™“çš„mvc"><a href="#å®¶å–»æˆ·æ™“çš„mvc" class="headerlink" title="å®¶å–»æˆ·æ™“çš„MVC"></a>å®¶å–»æˆ·æ™“çš„MVC</h3><p><img src="/images/arch-pattern/mvc.png" alt></p><p>å¦‚å…¶åï¼ŒMVCå°†åº”ç”¨åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>è§†å›¾å±‚(View) å‘ˆç°æ•°æ®ç»™ç”¨æˆ·</li><li>æ§åˆ¶å™¨(Controller) æ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„çº½å¸¦ï¼Œèµ·åˆ°ä¸åŒå±‚çš„ç»„ç»‡ä½œç”¨ï¼š<ul><li>å¤„ç†äº‹ä»¶å¹¶ä½œå‡ºå“åº”ã€‚ä¸€èˆ¬äº‹ä»¶æœ‰ç”¨æˆ·çš„è¡Œä¸º(æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»ã€å®¢æˆ·ç«¯è¯·æ±‚)ï¼Œæ¨¡å‹å±‚çš„å˜æ›´</li><li>æ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚æ ¹æ®è¯·æ±‚é€‰æ‹©é€‚å½“çš„æ¨¡å‹è¿›è¡Œå¤„ç†ï¼Œç„¶åé€‰æ‹©é€‚å½“çš„è§†å›¾è¿›è¡Œæ¸²æŸ“ï¼Œæœ€åå‘ˆç°ç»™ç”¨æˆ·</li></ul></li><li>æ¨¡å‹(Model) å°è£…ä¸åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„æ•°æ®ä»¥åŠå¯¹æ•°æ®çš„å¤„ç†æ–¹æ³•, é€šå¸¸å®ƒéœ€è¦å’Œæ•°æ®æŒä¹…åŒ–å±‚è¿›è¡Œé€šä¿¡</li></ul><p>ç›®å‰å‰ç«¯åº”ç”¨å¾ˆå°‘æœ‰çº¯ç²¹ä½¿ç”¨MVCçš„ï¼Œè¦ä¹ˆè§†å›¾å±‚æ··åˆäº†æ§åˆ¶å™¨å±‚ï¼Œè¦ä¹ˆå°±æ˜¯æ¨¡å‹å’Œæ§åˆ¶å™¨æ··åˆï¼Œæˆ–è€…å¹²è„†å°±æ²¡æœ‰æ‰€è°“çš„æ§åˆ¶å™¨. ä½†ä¸€ç‚¹å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå¾ˆå¤šåº”ç”¨éƒ½ä¸çº¦è€ŒåŒåˆ†ç¦»äº†â€™é€»è¾‘å±‚â€™å’Œâ€™è§†å›¾å±‚â€™ã€‚</p><p>ä¸‹é¢æ˜¯å…¸å‹çš„AngularJSä»£ç , è§†å›¾å±‚:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Todo<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"TodoListController as todoList"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;todoList.remaining()&#125;&#125; of &#123;&#123;todoList.todos.length&#125;&#125; remaining<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  [ <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">ng-click</span>=<span class="string">"todoList.archive()"</span>&gt;</span>archive<span class="tag">&lt;/<span class="name">a</span>&gt;</span> ]</span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"unstyled"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"todo in todoList.todos"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"todo.done"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"done-&#123;&#123;todo.done&#125;&#125;"</span>&gt;</span>&#123;&#123;todo.text&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"todoList.addTodo()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"todoList.todoText"</span>  <span class="attr">size</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">placeholder</span>=<span class="string">"add new todo here"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"btn-primary"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"add"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é€»è¾‘å±‚:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'todoApp'</span>, [])</span><br><span class="line">  .controller(<span class="string">'TodoListController'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> todoList = <span class="keyword">this</span>;</span><br><span class="line">    todoList.todos = [</span><br><span class="line">      &#123;<span class="attr">text</span>:<span class="string">'learn AngularJS'</span>, <span class="attr">done</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">text</span>:<span class="string">'build an AngularJS app'</span>, <span class="attr">done</span>:<span class="literal">false</span>&#125;];</span><br><span class="line"></span><br><span class="line">    todoList.addTodo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      todoList.todos.push(&#123;<span class="attr">text</span>:todoList.todoText, <span class="attr">done</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">      todoList.todoText = <span class="string">''</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    todoList.remaining = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">      angular.forEach(todoList.todos, <span class="function"><span class="keyword">function</span>(<span class="params">todo</span>) </span>&#123;</span><br><span class="line">        count += todo.done ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    todoList.archive = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> oldTodos = todoList.todos;</span><br><span class="line">      todoList.todos = [];</span><br><span class="line">      angular.forEach(oldTodos, <span class="function"><span class="keyword">function</span>(<span class="params">todo</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!todo.done) todoList.todos.push(todo);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>è‡³äºMVPã€MVVMï¼Œè¿™äº›MVCæ¨¡å¼çš„å»¶å±•æˆ–è€…å‡çº§ï¼Œç½‘ä¸Šéƒ½å¤§é‡çš„èµ„æºï¼Œè¿™é‡Œå°±ä¸äºˆèµ˜è¿°ã€‚</p><p><br></p><h3 id="redux"><a href="#redux" class="headerlink" title="Redux"></a>Redux</h3><p>Reduxæ˜¯Fluxæ¶æ„çš„æ”¹è¿›ã€èåˆäº†Elmè¯­è¨€ä¸­å‡½æ•°å¼çš„æ€æƒ³. ä¸‹é¢æ˜¯Reduxçš„æ¶æ„å›¾:</p><p><img src="/images/arch-pattern/redux.png" alt></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºReduxæ¶æ„æœ‰ä»¥ä¸‹è¦ç‚¹:</p><ul><li><strong>å•ä¸€çš„æ•°æ®æº</strong>.</li><li><strong>å•å‘çš„æ•°æ®æµ</strong>.</li></ul><p>å•ä¸€æ•°æ®æº, é¦–å…ˆè§£å†³çš„æ˜¯ä¼ ç»ŸMVCæ¶æ„å¤šæ¨¡å‹æ•°æ®æµæ··ä¹±é—®é¢˜(å¦‚ä¸‹å›¾)ã€‚å•ä¸€çš„æ•°æ®æºå¯ä»¥è®©åº”ç”¨çš„çŠ¶æ€å¯é¢„æµ‹å’Œå¯è¢«è°ƒè¯•ã€‚å¦å¤–å•ä¸€æ•°æ®æºä¹Ÿæ–¹ä¾¿åšæ•°æ®é•œåƒï¼Œå®ç°æ’¤é”€/é‡åšï¼Œæ•°æ®æŒä¹…åŒ–ç­‰ç­‰åŠŸèƒ½</p><p><img src="/images/arch-pattern/multi-model.png" alt></p><p>å•å‘æ•°æ®æµç”¨äºè¾…åŠ©å•ä¸€æ•°æ®æº, ä¸»è¦ç›®çš„æ˜¯é˜»æ­¢åº”ç”¨ä»£ç ç›´æ¥ä¿®æ”¹æ•°æ®æºï¼Œè¿™æ ·ä¸€æ–¹é¢ç®€åŒ–æ•°æ®æµï¼ŒåŒæ ·ä¹Ÿè®©åº”ç”¨çŠ¶æ€å˜åŒ–å˜å¾—å¯é¢„æµ‹ã€‚</p><p>ä¸Šé¢ä¸¤ä¸ªç‰¹ç‚¹æ˜¯Reduxæ¶æ„é£æ ¼çš„æ ¸å¿ƒï¼Œè‡³äºReduxè¿˜å¼ºè°ƒä¸å¯å˜æ•°æ®ã€åˆ©ç”¨ä¸­é—´ä»¶å°è£…å‰¯ä½œç”¨ã€èŒƒå¼åŒ–çŠ¶æ€æ ‘ï¼Œåªæ˜¯ä¸€ç§æœ€ä½³å®è·µã€‚è¿˜æœ‰è®¸å¤š<code>ç±»Redux</code>çš„æ¡†æ¶ï¼Œä¾‹å¦‚<a href="http://vuex.vuejs.org" target="_blank" rel="noopener"><code>Vuex</code></a>ã€<a href="https://ngrx.io" target="_blank" rel="noopener">ngrx</a>ï¼Œåœ¨æ¶æ„æ€æƒ³å±‚æ¬¡æ˜¯ä¸€è‡´çš„:</p><p><img src="/images/arch-pattern/vuex.png" alt></p><p><br></p><h2 id="å¤åˆ¶é£æ ¼"><a href="#å¤åˆ¶é£æ ¼" class="headerlink" title="å¤åˆ¶é£æ ¼"></a>å¤åˆ¶é£æ ¼</h2><p><img src="/images/arch-pattern/pm2.png" alt></p><p>åŸºäºå¤åˆ¶(Replication)é£æ ¼çš„ç³»ç»Ÿï¼Œä¼šåˆ©ç”¨å¤šä¸ªå®ä¾‹æä¾›ç›¸åŒçš„æœåŠ¡ï¼Œæ¥æ”¹å–„æœåŠ¡çš„å¯è®¿é—®æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼Œä»¥åŠæ€§èƒ½ã€‚è¿™ç§æ¶æ„é£æ ¼å¯ä»¥æ”¹å–„ç”¨æˆ·å¯å¯Ÿè§‰çš„æ€§èƒ½ï¼Œç®€å•æœåŠ¡å“åº”çš„å»¶è¿Ÿã€‚</p><p>è¿™ç§é£æ ¼åœ¨åç«¯ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä¸¾å‰ç«¯æ¯”è¾ƒç†Ÿæ‚‰çš„ä¾‹å­ï¼ŒNodeJS. NodeJSæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºäº†åˆ©ç”¨å¤šæ ¸èµ„æºï¼ŒNodeJSæ ‡å‡†åº“æä¾›äº†ä¸€ä¸ª<a href="https://nodejs.org/api/cluster.html" target="_blank" rel="noopener"><code>cluster</code></a>æ¨¡å—ï¼Œå®ƒå¯ä»¥æ ¹æ®CPUæ•°åˆ›å»ºå¤šä¸ªWorkerè¿›ç¨‹ï¼Œè¿™äº›Workerè¿›ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªæœåŠ¡å™¨ç«¯å£ï¼Œå¯¹å¤–æä¾›åŒè´¨çš„æœåŠ¡, Masterè¿›ç¨‹ä¼šæ ¹æ®ä¸€å®šçš„ç­–ç•¥å°†èµ„æºåˆ†é…ç»™Worker:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> numCPUs = <span class="built_in">require</span>(<span class="string">'os'</span>).cpus().length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Master <span class="subst">$&#123;process.pid&#125;</span> is running`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fork workers.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">    cluster.fork();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster.on(<span class="string">'exit'</span>, (worker, code, signal) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker <span class="subst">$&#123;worker.process.pid&#125;</span> died`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Workerså¯ä»¥å…±äº«ä»»æ„çš„TCPè¿æ¥ </span></span><br><span class="line">  <span class="comment">// æ¯”å¦‚å…±äº«HTTPæœåŠ¡å™¨ </span></span><br><span class="line">  http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>);</span><br><span class="line">    res.end(<span class="string">'hello world\n'</span>);</span><br><span class="line">  &#125;).listen(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Worker <span class="subst">$&#123;process.pid&#125;</span> started`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨å¤šæ ¸èƒ½åŠ›å¯ä»¥æå‡åº”ç”¨çš„æ€§èƒ½å’Œå¯é æ€§ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨<a href="http://pm2.keymetrics.io/docs/usage/cluster-mode/" target="_blank" rel="noopener">PM2</a>è¿™æ ·çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œæ¥ç®€åŒ–Nodeé›†ç¾¤çš„ç®¡ç†ï¼Œå®ƒæ”¯æŒå¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼Œä¾‹å¦‚é›†ç¾¤èŠ‚ç‚¹é‡å¯ã€æ—¥å¿—å½’é›†ã€æ€§èƒ½ç›‘è§†ç­‰ã€‚</p><p>å¤åˆ¶é£æ ¼å¸¸ç”¨äºç½‘ç»œæœåŠ¡å™¨ã€‚æµè§ˆå™¨å’ŒNodeéƒ½æœ‰<code>Worker</code>çš„æ¦‚å¿µï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½åªæ¨èåœ¨CPUå¯†é›†å‹çš„åœºæ™¯ä½¿ç”¨å®ƒä»¬ï¼Œå› ä¸ºæµè§ˆå™¨æˆ–è€…NodeJSå†…ç½®çš„å¼‚æ­¥æ“ä½œå·²ç»éå¸¸é«˜æ•ˆã€‚å®é™…ä¸Šå‰ç«¯åº”ç”¨CPUå¯†é›†å‹åœºæ™¯å¹¶ä¸å¤šï¼Œæˆ–è€…ç›®å‰é˜¶æ®µä¸æ˜¯ç‰¹åˆ«å®ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ä½ è¿˜è¦æƒè¡¡è¿›ç¨‹é—´é€šä¿¡çš„æ•ˆç‡ã€Workerç®¡ç†å¤æ‚åº¦ã€å¼‚å¸¸å¤„ç†ç­‰äº‹æƒ…ã€‚</p><p>æœ‰ä¸€ä¸ªå…¸å‹çš„CPUå¯†é›†å‹çš„åœºæ™¯ï¼Œå³æºæ–‡ä»¶è½¬è¯‘. å…¸å‹çš„ä¾‹å­æ˜¯<a href="https://codesandbox.io/dashboard" target="_blank" rel="noopener">CodeSandbox</a>, å®ƒå°±æ˜¯åˆ©ç”¨æµè§ˆå™¨çš„Workeræœºåˆ¶æ¥æé«˜æºæ–‡ä»¶çš„è½¬è¯‘æ€§èƒ½çš„:</p><p><img src="/images/arch-pattern/codesandbox.png" alt></p><p>é™¤äº†å¤„ç†CPUå¯†é›†å‹ä»»åŠ¡ï¼Œå¯¹äºæµè§ˆå™¨æ¥è¯´ï¼ŒWorkerä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„å®‰å…¨æœºåˆ¶ï¼Œç”¨äºéš”ç¦»ä¸å®‰å…¨ä»£ç çš„æ‰§è¡Œï¼Œæˆ–è€…é™åˆ¶è®¿é—®æµè§ˆå™¨DOMç›¸å…³çš„ä¸œè¥¿ã€‚å°ç¨‹åºæŠ½ç¦»é€»è¾‘è¿›ç¨‹çš„åŸå› ä¹‹ä¸€å°±æ˜¯å®‰å…¨æ€§</p><p>å…¶ä»–ç¤ºä¾‹ï¼š</p><ul><li>ServerLess</li></ul><p><br></p><h2 id="å¾®å†…æ ¸æ¶æ„"><a href="#å¾®å†…æ ¸æ¶æ„" class="headerlink" title="å¾®å†…æ ¸æ¶æ„"></a>å¾®å†…æ ¸æ¶æ„</h2><p><img src="/images/arch-pattern/plugin-architecture.png" alt></p><p>å¾®å†…æ ¸æ¶æ„(MicroKernel)åˆç§°ä¸ºâ€æ’ä»¶æ¶æ„â€, æŒ‡çš„æ˜¯è½¯ä»¶çš„å†…æ ¸ç›¸å¯¹è¾ƒå°ï¼Œä¸»è¦åŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘éƒ½é€šè¿‡æ’ä»¶å½¢å¼å®ç°ã€‚å†…æ ¸åªåŒ…å«ç³»ç»Ÿè¿è¡Œçš„æœ€å°åŠŸèƒ½ã€‚æ’ä»¶ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ’ä»¶ä¹‹é—´çš„é€šä¿¡ï¼Œåº”è¯¥é™åˆ°æœ€ä½ï¼Œå‡å°‘ç›¸äº’ä¾èµ–ã€‚</p><p>å¾®å†…æ ¸ç»“æ„çš„éš¾ç‚¹åœ¨äºå»ºç«‹ä¸€å¥—ç²’åº¦åˆé€‚çš„æ’ä»¶åè®®ã€ä»¥åŠå¯¹æ’ä»¶ä¹‹é—´è¿›è¡Œé€‚å½“çš„éš”ç¦»å’Œè§£è€¦ã€‚ä»è€Œæ‰èƒ½ä¿è¯è‰¯å¥½çš„æ‰©å±•æ€§ã€çµæ´»æ€§å’Œå¯è¿ç§»æ€§ã€‚</p><p>å‰ç«¯é¢†åŸŸæ¯”è¾ƒå…¸å‹çš„ä¾‹å­æ˜¯<code>Webpack</code>ã€<code>Babel</code>ã€<code>PostCSS</code>ä»¥åŠ<code>ESLint</code>, è¿™äº›åº”ç”¨éœ€è¦åº”å¯¹å¤æ‚çš„å®šåˆ¶éœ€æ±‚ï¼Œè€Œä¸”è¿™äº›éœ€æ±‚æ—¶åˆ»åœ¨å˜ï¼Œåªæœ‰å¾®å†…æ ¸æ¶æ„æ‰èƒ½ä¿è¯çµæ´»å’Œå¯æ‰©å±•æ€§ã€‚</p><p>ä»¥Webpackä¸ºä¾‹ã€‚Webpackçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªCompilerï¼Œè¿™ä¸ªCompilerä¸»è¦åŠŸèƒ½æ˜¯é›†æˆæ’ä»¶ç³»ç»Ÿã€ç»´æŠ¤<code>æ¨¡å—å¯¹è±¡å›¾</code>, å¯¹äºæ¨¡å—ä»£ç å…·ä½“ç¼–è¯‘å·¥ä½œã€æ¨¡å—çš„æ‰“åŒ…ã€ä¼˜åŒ–ã€åˆ†æã€èšåˆç»Ÿç»Ÿéƒ½æ˜¯åŸºäºå¤–éƒ¨æ’ä»¶å®Œæˆçš„.</p><p>å¦‚ä¸Šæ–‡è¯´çš„Loaderè¿ç”¨äº†ç®¡é“æ¨¡å¼ï¼Œè´Ÿè´£å¯¹æºæ–‡ä»¶è¿›è¡Œè½¬è¯‘ï¼›é‚£Pluginåˆ™å¯ä»¥å°†è¡Œä¸ºæ³¨å…¥åˆ°Compilerè¿è¡Œçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„é’©å­ä¸­, å®Œå…¨è®¿é—®Compilerçš„å½“å‰çŠ¶æ€ã€‚</p><blockquote><p><a href="https://twitter.com/thelarkinn" target="_blank" rel="noopener">Sean Larkin</a>æœ‰ä¸ªæ¼”è®²: <a href="https://www.youtube.com/watch?v=4tQiJaFzuJ8" target="_blank" rel="noopener">Everything is a plugin! Mastering webpack from the inside out </a></p></blockquote><p><img src="/images/arch-pattern/webpack.png" alt></p><p><br></p><p>è¿™é‡Œè¿˜æœ‰ä¸€ç¯‡æ–‡ç« <a href="https://yunsong0922.github.io/2018/12/09/%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84%E5%BA%94%E7%94%A8%E7%A0%94%E7%A9%B6/" target="_blank" rel="noopener">&lt;å¾®å†…æ ¸æ¶æ„åº”ç”¨ç ”ç©¶&gt;</a>ä¸“é—¨å†™äº†å‰ç«¯å¾®å†…æ ¸æ¶æ„æ¨¡å¼çš„ä¸€äº›åº”ç”¨ï¼Œæ¨èé˜…è¯»ä¸€ä¸‹ã€‚</p><p><br></p><h2 id="å¾®å‰ç«¯"><a href="#å¾®å‰ç«¯" class="headerlink" title="å¾®å‰ç«¯"></a>å¾®å‰ç«¯</h2><p>å‰å‡ å¤©å¬äº†<a href="http://codetimecn.com/" target="_blank" rel="noopener">ä»£ç æ—¶é—´</a>ä¸Š<a href="https://coolshell.cn/haoel" target="_blank" rel="noopener">å·¦è€³æœµè€—å­</a>çš„ä¸€æœŸ<a href="http://codetimecn.com/episodes/manager" target="_blank" rel="noopener">èŠ‚ç›®</a>, ä»–ä»‹ç»å¾—äº†äºšé©¬é€Šå†…éƒ¨æœ‰å¾ˆå¤šå°å›¢é˜Ÿï¼Œäºšé©¬é€Šç½‘ç«™ä¸Šä¸€å—è±†è…å—å¤§å°çš„åŒºåŸŸå¯èƒ½æ˜¯ä¸€ä¸ªå›¢é˜Ÿåœ¨ç»´æŠ¤ï¼Œæ¯”å¦‚åœ°å€é€‰æ‹©å™¨ã€è´­ç‰©è½¦ã€è¿è¾¾æ—¶é—´è®¡ç®—â€¦ å¤§å‚çš„è¿™ç§è¶…çº§é¡¹ç›®æ˜¯æ€ä¹ˆåè°ƒå’Œç»´æŠ¤çš„å‘¢ï¼Ÿ è¿™ä¹Ÿè®¸å°±æ˜¯å¾®å‰ç«¯æˆ–è€…å¾®æœåŠ¡å‡ºç°çš„åŸå› å§ã€‚</p><p>å¾®å‰ç«¯æ—¨åœ¨å°†<code>å•ä½“å‰ç«¯</code>åˆ†è§£æˆæ›´å°ã€æ›´ç®€å•çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯ä»¥è¢«ç‹¬ç«‹çš„å›¢é˜Ÿè¿›è¡Œå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ï¼Œæœ€åå†ç»„åˆæˆä¸€ä¸ªå¤§å‹çš„æ•´ä½“ã€‚</p><p><img src="/images/arch-pattern/microfrontend.jpg" alt></p><p>å¾®å‰ç«¯ä¸‹å„ä¸ªåº”ç”¨æ¨¡å—æ˜¯ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œç›¸å¯¹åº”çš„ä¼šé…å¤‡æ›´åŠ è‡ªæ²»çš„å›¢é˜Ÿ(ä¸€ä¸ªå›¢é˜Ÿå¹²å¥½ä¸€ä»¶äº‹æƒ…)ã€‚ å¾®å‰ç«¯çš„å®æ–½è¿˜éœ€è¦æœ‰ç¨³å›ºçš„å‰ç«¯åŸºç¡€è®¾æ–½å’Œç ”å‘ä½“ç³»çš„æ”¯æ’‘ã€‚</p><p>å¦‚æœä½ æƒ³æ·±å…¥å­¦ä¹ å¾®å‰ç«¯æ¶æ„ï¼Œå»ºè®®é˜…è¯»<a href="https://www.zhihu.com/people/phodal/activities" target="_blank" rel="noopener">Phodal</a>çš„<a href="https://juejin.im/user/5567e339e4b0349d3313190b/posts" target="_blank" rel="noopener">ç›¸å…³æ–‡ç« </a>ï¼Œè¿˜æœ‰ä»–çš„æ–°ä¹¦<a href="https://www.amazon.cn/dp/B07TJ7R9DX/ref=sr_1_1?__mk_zh_CN=%E4%BA%9A%E9%A9%AC%E9%80%8A%E7%BD%91%E7%AB%99&amp;keywords=%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84&amp;qid=1568279892&amp;s=gateway&amp;sr=8-1" target="_blank" rel="noopener">ã€Šå‰ç«¯æ¶æ„ï¼šä»å…¥é—¨åˆ°å¾®å‰ç«¯ã€‹</a></p><p><br></p><h2 id="ç»„ä»¶åŒ–æ¶æ„"><a href="#ç»„ä»¶åŒ–æ¶æ„" class="headerlink" title="ç»„ä»¶åŒ–æ¶æ„"></a>ç»„ä»¶åŒ–æ¶æ„</h2><p>ç»„ä»¶åŒ–å¼€å‘å¯¹ç°åœ¨çš„æˆ‘ä»¬æ¥è¯´å¦‚æ­¤è‡ªç„¶ï¼Œå°±åƒæ°´å¯¹é±¼ä¸€æ ·ã€‚ ä»¥è‡´äºæˆ‘ä»¬å¿˜äº†ç»„ä»¶åŒ–ä¹Ÿæ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ¶æ„æ€æƒ³ï¼Œå®ƒçš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯åˆ†è€Œæ²»ä¹‹ã€‚æŒ‰ç…§Wikiä¸Šé¢çš„å®šä¹‰æ˜¯ï¼š<code>ç»„ä»¶åŒ–å°±æ˜¯åŸºäºå¯å¤ç”¨ç›®çš„ï¼Œå°†ä¸€ä¸ªå¤§çš„è½¯ä»¶ç³»ç»ŸæŒ‰ç…§åˆ†ç¦»å…³æ³¨ç‚¹çš„å½¢å¼ï¼Œæ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œä¸»è¦ç›®çš„å°±æ˜¯å‡å°‘è€¦åˆ</code>.</p><p>ä»å‰ç«¯çš„è§’åº¦å…·ä½“æ¥è®²ï¼Œå¦‚ä¸‹å›¾ï¼ŒçŸ³å™¨æ—¶ä»£å¼€å‘æ–¹å¼(å³ä¾§), ç»„ä»¶æ—¶ä»£(å·¦ä¾§):</p><p><img src="/images/arch-pattern/components2.png" alt><br>(å›¾ç‰‡æ¥æº: <a href="http://www.alloyteam.com/2015/11/we-will-be-componentized-web-long-text" target="_blank" rel="noopener">http://www.alloyteam.com/2015/11/we-will-be-componentized-web-long-text</a>)</p><p>æŒ‰ç…§Vueå®˜ç½‘çš„è¯´æ³•: <code>ç»„ä»¶ç³»ç»Ÿæ˜¯ Vue çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ç§æŠ½è±¡ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨å°å‹ã€ç‹¬ç«‹å’Œé€šå¸¸å¯å¤ç”¨çš„ç»„ä»¶æ„å»ºå¤§å‹åº”ç”¨ã€‚ä»”ç»†æƒ³æƒ³ï¼Œå‡ ä¹ä»»æ„ç±»å‹çš„åº”ç”¨ç•Œé¢éƒ½å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªç»„ä»¶æ ‘</code>ï¼š</p><p><img src="/images/arch-pattern/components.png" alt></p><p>æŒ‰ç…§æˆ‘çš„ç†è§£<strong>ç»„ä»¶è·Ÿå‡½æ•°æ˜¯ä¸€æ ·çš„ä¸œè¥¿ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³åœ¨Reactä¸­ä¼šåº”ç”¨çš„å¦‚æ­¤è‡ªç„¶</strong>ã€‚è‹¥å¹²ä¸ªç®€å•å‡½æ•°ï¼Œå¯ä»¥å¤åˆæˆå¤æ‚çš„å‡½æ•°ï¼Œå¤æ‚çš„å‡½æ•°å†å¤åˆæˆå¤æ‚çš„åº”ç”¨ã€‚å¯¹äºå‰ç«¯æ¥è¯´ï¼Œé¡µé¢ä¹Ÿæ˜¯è¿™ä¹ˆæ¥çš„ï¼Œä¸€ä¸ªå¤æ‚çš„é¡µé¢å°±æ˜¯æœ‰ä¸åŒç²’åº¦çš„ç»„ä»¶å¤åˆè€Œæˆçš„ã€‚</p><p>ç»„ä»¶å¦å¤–ä¸€ä¸ªé‡è¦çš„ç‰¹å¾å°±æ˜¯<strong>å†…èšæ€§</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œè‡ªåŒ…å«äº†æ‰€æœ‰éœ€è¦çš„èµ„æºã€‚ä¾‹å¦‚ä¸€ä¸ªå‰ç«¯ç»„ä»¶è¾ƒåŒ…å«æ ·å¼ã€è§†å›¾ç»“æ„ã€ç»„ä»¶é€»è¾‘:</p><p><img src="/images/arch-pattern/vue-component.png" alt></p><p><br></p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p><strong>æˆ‘ç»ˆäºç¼–ä¸ä¸‹å»äº†</strong>ï¼è¿˜æœ‰å¾ˆå¤šæ¶æ„é£æ ¼ï¼Œé™äºæ–‡ç« ç¯‡å¹…, ä¸”è¿™äº›é£æ ¼ä¸»è¦åº”ç”¨äºåç«¯é¢†åŸŸï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€é˜è¿°äº†ã€‚ä½ å¯ä»¥é€šè¿‡æ‰©å±•é˜…è¯»äº†è§£è¿™äº›æ¨¡å¼</p><ul><li>é¢å‘å¯¹è±¡é£æ ¼: å°†åº”ç”¨æˆ–ç³»ç»Ÿä»»åŠ¡åˆ†å‰²ä¸ºå•ç‹¬ã€å¯å¤ç”¨ã€å¯è‡ªç»™çš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«æ•°æ®ã€ä»¥åŠå¯¹è±¡ç›¸å…³çš„è¡Œä¸º</li><li>C/S å®¢æˆ·ç«¯/æœåŠ¡å™¨é£æ ¼</li><li>é¢å‘æœåŠ¡æ¶æ„(SOA): æŒ‡é‚£äº›åˆ©ç”¨å¥‘çº¦å’Œæ¶ˆæ¯å°†åŠŸèƒ½æš´éœ²ä¸ºæœåŠ¡ã€æ¶ˆè´¹åŠŸèƒ½æœåŠ¡çš„åº”ç”¨</li><li>Nå±‚/ä¸‰å±‚: å’Œåˆ†å±‚æ¶æ„å·®ä¸å¤šï¼Œä¾§é‡ç‰©ç†å±‚. ä¾‹å¦‚C/Sé£æ ¼å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„Nå±‚æ¶æ„</li><li>ç‚¹å¯¹ç‚¹é£æ ¼</li></ul><p>é€šè¿‡ä¸Šæ–‡ï¼Œä½ ä¼°è®¡ä¼šè§‰å¾—æ¶æ„é£æ ¼æ¯”è®¾è®¡æ¨¡å¼æˆ–è€…ç®—æ³•å¥½ç†è§£å¤šçš„ï¼Œæ­£æ‰€è°“â€˜<strong>å¤§é“è‡³ç®€</strong>â€™ï¼Œä½†æ˜¯â€˜<strong>ç®€æ´è€Œä¸ç®€å•</strong>â€™ï¼å¤§éƒ¨åˆ†é¡¹ç›®çš„æ¶æ„ä¸æ˜¯ä¸€å¼€å§‹å°±æ˜¯è¿™æ ·çš„ï¼Œå®ƒä»¬å¯èƒ½ç»è¿‡é•¿æœŸçš„è¿­ä»£ï¼Œè¸©ç€å·¨äººçš„è‚©è†€ï¼Œä¸€è·¯èµ°è¿‡æ¥æ‰æˆä¸ºä»Šå¤©çš„æ ·å­ã€‚</p><p>å¸Œæœ›æœ¬æ–‡å¯ä»¥ç»™ä½ ä¸€ç‚¹å¯å‘ï¼Œå¯¹äºæˆ‘ä»¬å‰ç«¯å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œæœ€ç‰›çš„ä¸æ˜¯èƒ½åšå¤šé…·çš„é¡µé¢ã€æŒæ¡å¤šå°‘APIï¼Œè¦å­¦ä¼šé€šè¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œä¸¾ä¸€åä¸‰èä¼šè´¯é€šï¼Œè¿™æ‰æ˜¯è¿›é˜¶ä¹‹é“ã€‚</p><p>æœ¬æ–‡å®Œï¼</p><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://wxs.me/2069" target="_blank" rel="noopener">å‡ ç§å¸¸è§çš„è½¯ä»¶æ¶æ„é£æ ¼ä»‹ç»</a></li><li><a href="https://docs.huihoo.com/rest/REST_cn.pdf" target="_blank" rel="noopener">æ¶æ„é£æ ¼ä¸åŸºäºç½‘ç»œçš„è½¯ä»¶æ¶æ„è®¾è®¡</a> RESTæè®®è€…ï¼ŒRoy Thomas Fieldingçš„åšå£«è®ºæ–‡</li><li><a href="http://www.ruanyifeng.com/blog/2016/09/software-architecture.html" target="_blank" rel="noopener">è½¯ä»¶æ¶æ„å…¥é—¨</a></li><li><a href="https://zh.wikipedia.org/wiki/ç®¡é“_\(Unix\" target="_blank" rel="noopener">ç®¡é“ (Unix)</a>)</li><li><a href="https://zhuanlan.zhihu.com/p/20597452" target="_blank" rel="noopener">redux middleware è¯¦è§£</a></li><li><a href="https://juejin.im/post/593021272f301e0058273468" target="_blank" rel="noopener">æµ…æå‰ç«¯å¼€å‘ä¸­çš„ MVC/MVP/MVVM æ¨¡å¼</a></li><li><a href="https://juejin.im/post/5d1e0dea51882514bf5bedfa#comment" target="_blank" rel="noopener">CodeSandbox æµè§ˆå™¨ç«¯çš„webpackæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ä¸Šç¯‡</a></li><li><a href="https://mp.weixin.qq.com/s/KT288QNmtJzKe-jaPyFtFA" target="_blank" rel="noopener">ä¸‡é‡‘æ²¹CSä¸åˆ†å±‚</a></li><li><a href="https://www.infoq.cn/article/03*BeU3zQegIbIytRsX9" target="_blank" rel="noopener">å¤§å‰ç«¯æ—¶ä»£ä¸‹çš„å¾®å‰ç«¯æ¶æ„ï¼šå®ç°å¢é‡å‡çº§ã€ä»£ç è§£è€¦ã€ç‹¬ç«‹éƒ¨ç½²</a></li><li><a href="https://www.iteye.com/blog/moon-walker-2393310" target="_blank" rel="noopener">ç³»ç»Ÿç»„ä»¶åŒ–æ¶æ„è®¾è®¡</a></li><li><a href="https://github.com/xufei/blog/issues/19" target="_blank" rel="noopener">2015å‰ç«¯ç»„ä»¶åŒ–æ¡†æ¶ä¹‹è·¯</a></li></ul><p><br></p><p><img src="/images/sponsor.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ‰€è°“è½¯ä»¶æ¶æ„é£æ ¼ï¼Œæ˜¯æŒ‡æè¿°æŸä¸ªç‰¹å®šåº”ç”¨é¢†åŸŸä¸­ç³»ç»Ÿç»„ç»‡æ–¹å¼çš„æƒ¯ç”¨æ¨¡å¼ã€‚æ¶æ„é£æ ¼å®šä¹‰ä¸€ä¸ªè¯æ±‡è¡¨å’Œä¸€ç»„çº¦æŸï¼Œè¯æ±‡è¡¨ä¸­åŒ…å«ä¸€äº›ç»„ä»¶åŠè¿æ¥å™¨ï¼Œçº¦æŸåˆ™æŒ‡å‡ºç³»ç»Ÿå¦‚ä½•å°†æ„å»ºå’Œè¿æ¥å™¨ç»„åˆèµ·æ¥ã€‚è½¯ä»¶æ¶æ„é£æ ¼åæ˜ äº†é¢†åŸŸä¸­ä¼—å¤šç³»ç»Ÿæ‰€å…±æœ‰çš„ç»“æ„å’Œè¯­ä¹‰ç‰¹æ€§ï¼Œå¹¶æŒ‡å¯¼å¦‚ä½•å°†ç³»ç»Ÿä¸­
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å…³äºReactçš„ä¸€ä¸ªV8æ€§èƒ½ç“¶é¢ˆèƒŒåçš„æ•…äº‹</title>
    <link href="https://bobi.ink/2019/09/07/react-cliff/"/>
    <id>https://bobi.ink/2019/09/07/react-cliff/</id>
    <published>2019-09-06T16:00:00.000Z</published>
    <updated>2019-09-08T13:08:08.958Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯‘æ³¨: åŸæ–‡ä½œè€…æ˜¯<a href="https://twitter.com/mathias" target="_blank" rel="noopener">Mathias Bynens</a>, ä»–æ˜¯V8å¼€å‘è€…ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨<a href="https://v8.dev/blog" target="_blank" rel="noopener">V8çš„åšå®¢</a>ä¸Šã€‚ä»–çš„<a href="https://mathiasbynens.be" target="_blank" rel="noopener">ç›¸å…³æ–‡ç« </a>è´¨é‡éå¸¸é«˜ï¼Œå¦‚æœä½ æƒ³äº†è§£JavaScriptå¼•æ“å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»–çš„æ–‡ç« ä¸€å®šä¸èƒ½é”™è¿‡ã€‚åé¢æˆ‘è¿˜ä¼šç¿»è¯‘ä»–çš„å…¶ä»–æ–‡ç« ï¼Œä¸€æ–¹é¢æ˜¯ä»–æ–‡ç« è´¨é‡å¾ˆé«˜ï¼Œå¦å¤–ä¸€æ–¹é¢æ˜¯æˆ‘æƒ³å­¦ä¹ ä¸€ä¸‹ä»–ä»¬æ˜¯æ€ä¹ˆå†™æ–‡ç« çš„ï¼Œé€šè¿‡ç¿»è¯‘æ–‡ç« ï¼Œè®©æˆ‘å¯ä»¥æ›´å¥½åœ°æ¶ˆåŒ–çŸ¥è¯†å’Œæ¨¡ä»¿å†™ä½œæŠ€å·§, æœ€åå¥‡æ–‡å…±èµï¼</p></blockquote><p>åŸæ–‡é“¾æ¥: <a href="https://v8.dev/blog/react-cliff" target="_blank" rel="noopener">The story of a V8 performance cliff in React</a></p><p><a href="https://mathiasbynens.be/notes/shapes-ics" target="_blank" rel="noopener">ä¹‹å‰</a>æˆ‘ä»¬è®¨è®ºè¿‡Javascriptå¼•æ“æ˜¯å¦‚ä½•é€šè¿‡Shape(å¤–å½¢)å’Œå†…è”ç¼“å­˜(Inline Caches)æ¥ä¼˜åŒ–å¯¹è±¡å’Œæ•°ç»„çš„è®¿é—®çš„, æˆ‘ä»¬è¿˜ç‰¹åˆ«æ¢è®¨äº†<a href="https://mathiasbynens.be/notes/prototypes" target="_blank" rel="noopener">Javascriptå¼•æ“æ˜¯å¦‚ä½•åŠ é€ŸåŸå‹å±æ€§è®¿é—®</a>. è¿™ç¯‡æ–‡ç« è®²è¿°<strong>V8å¦‚ä½•ä¸ºä¸åŒçš„Javascriptå€¼é€‰æ‹©æœ€ä½³çš„å†…å­˜è¡¨ç¤º(representations), ä»¥åŠå®ƒæ˜¯å¦‚ä½•å½±å“å¤–å½¢æœºåˆ¶(shape machinery)çš„</strong>ã€‚è¿™äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£é‡Šæœ€è¿‘Reactå†…æ ¸å‡ºç°çš„V8æ€§èƒ½ç“¶é¢ˆ(Performance cliff)é—®é¢˜</p><blockquote><p>å¦‚æœä¸æƒ³çœ‹æ–‡ç« ï¼Œå¯ä»¥çœ‹è¿™ä¸ªæ¼”è®²ï¼š <a href="https://www.youtube.com/watch?v=0I0d8LkDqyc" target="_blank" rel="noopener">â€œJavaScript engine fundamentals: the good, the bad, and the uglyâ€</a></p></blockquote><p><br></p><h2 id="javascript-ç±»å‹"><a href="#javascript-ç±»å‹" class="headerlink" title="JavaScript ç±»å‹"></a>JavaScript ç±»å‹</h2><p>æ¯ä¸€ä¸ªJavascriptå€¼éƒ½å±äºä»¥ä¸‹å…«ä¸ªç±»å‹ä¹‹ä¸€(ç›®å‰): <code>Number</code>, <code>String</code>, <code>Symbol</code>, <code>BigInt</code>, <code>Boolean</code>, <code>Undefined</code>, <code>Null</code>, ä»¥åŠ <code>Object</code>.</p><p><img src="/images/react-cliff/01-javascript-types.svg" alt></p><p>ä½†æ˜¯æœ‰ä¸ªæ€»æ‰€å‘¨çŸ¥çš„ä¾‹å¤–ï¼Œåœ¨JavaScriptä¸­å¯ä»¥é€šè¿‡<code>typeof</code>æ“ä½œç¬¦è§‚å¯Ÿå€¼çš„ç±»å‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">42</span>;</span><br><span class="line"><span class="comment">// â†’ 'number'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">'foo'</span>;</span><br><span class="line"><span class="comment">// â†’ 'string'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>(<span class="string">'bar'</span>);</span><br><span class="line"><span class="comment">// â†’ 'symbol'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">42</span>n;</span><br><span class="line"><span class="comment">// â†’ 'bigint'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// â†’ 'boolean'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>;</span><br><span class="line"><span class="comment">// â†’ 'undefined'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// â†’ 'object' ğŸ¤”</span></span><br><span class="line"><span class="keyword">typeof</span> &#123; <span class="attr">x</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="comment">// â†’ 'object'</span></span><br></pre></td></tr></table></figure><p><code>typeof null</code>è¿”å›çš„æ˜¯â€™<code>object</code>â€˜, è€Œä¸æ˜¯â€™<code>null</code>â€˜, å°½ç®¡<code>Null</code>æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»å‹ã€‚è¦ç†è§£ä¸ºä»€ä¹ˆï¼Œè€ƒè™‘å°†æ‰€æœ‰Javascriptç±»å‹çš„é›†åˆåˆ†ä¸ºä¸¤ç»„ï¼š</p><ul><li><em>å¯¹è±¡ç±»å‹</em> (i.e. <code>Object</code>ç±»å‹)</li><li><em>åŸå§‹(primitives)ç±»å‹</em> (i.e. ä»»ä½•éå¯¹è±¡å€¼)</li></ul><p>å› æ­¤, <code>null</code>å¯ä»¥ç†è§£ä¸ºâ€æ— å¯¹è±¡å€¼â€, è€Œ<code>undefined</code>åˆ™è¡¨ç¤ºä¸ºâ€œæ— å€¼â€.</p><blockquote><p>è¯‘æ³¨ï¼šä¹Ÿå°±æ˜¯ï¼Œnullå¯ä»¥ç†è§£ä¸ºå¯¹è±¡ç±»å‹çš„â€™undefinedâ€™ï¼›è€Œundefinedæ˜¯æ‰€æœ‰ç±»å‹çš„â€™undefinedâ€™</p></blockquote><p><img src="/images/react-cliff/02-primitives-objects.svg" alt></p><p>éµå¾ªè¿™ä¸ªæ€è·¯ï¼ŒBrendan Eich åœ¨è®¾è®¡Javascriptçš„æ—¶å€™å—åˆ°äº†Javaçš„å½±å“ï¼Œè®©<code>typeof</code>å³ä¾§æ‰€æœ‰å€¼(å³æ‰€æœ‰å¯¹è±¡å’Œnullå€¼)éƒ½è¿”å›â€™objectâ€™. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<code>typeof null === &#39;object&#39;</code>çš„åŸå› , å°½ç®¡è§„èŒƒä¸­æœ‰ä¸€ä¸ªå•ç‹¬çš„<code>Null</code>ç±»å‹ã€‚</p><p><img src="/images/react-cliff/03-primitives-objects-typeof.svg" alt></p><p><br></p><h2 id="å€¼çš„è¡¨ç¤º"><a href="#å€¼çš„è¡¨ç¤º" class="headerlink" title="å€¼çš„è¡¨ç¤º"></a>å€¼çš„è¡¨ç¤º</h2><p>Javascriptå¼•æ“å¿…é¡»èƒ½å¤Ÿåœ¨å†…å­˜ä¸­è¡¨ç¤ºä»»æ„çš„Javascriptå€¼. ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>Javascriptçš„å€¼ç±»å‹å’ŒJavascriptå¼•æ“å¦‚ä½•åœ¨å†…å­˜ä¸­è¡¨ç¤ºå®ƒä»¬æ˜¯ä¸¤å›äº‹</strong>.</p><p>ä¾‹å¦‚å€¼ <code>42</code>ï¼ŒJavascriptä¸­æ˜¯<code>number</code>ç±»å‹ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">42</span>;</span><br><span class="line"><span class="comment">// â†’ 'number'</span></span><br></pre></td></tr></table></figure><p>åœ¨å†…å­˜ä¸­æœ‰å¾ˆå¤šç§æ–¹å¼æ¥è¡¨ç¤ºç±»ä¼¼<code>42</code>è¿™æ ·çš„æ•´å‹æ•°å­—:</p><table><thead><tr><th>è¡¨ç¤º</th><th>ä½</th></tr></thead><tbody><tr><td>8-bitäºŒè¿›åˆ¶è¡¥ç </td><td><code>0010 1010</code></td></tr><tr><td>32-bitäºŒè¿›åˆ¶è¡¥ç </td><td><code>0000 0000 0000 0000 0000 0000 0010 1010</code></td></tr><tr><td>å‹ç¼©äºŒè¿›åˆ¶ç¼–ç åè¿›åˆ¶(packed binary-coded decimal (BCD))</td><td><code>0100 0010</code></td></tr><tr><td>32-bit IEEE-754 æµ®ç‚¹æ•°</td><td><code>0100 0010 0010 1000 0000 0000 0000 0000</code></td></tr><tr><td>64-bit IEEE-754 æµ®ç‚¹æ•°</td><td><code>0100 0000 0100 0101 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000</code></td></tr></tbody></table><p>ECMAScriptæ ‡å‡†çš„æ•°å­—ç±»å‹æ˜¯64ä½çš„æµ®ç‚¹æ•°ï¼Œæˆ–è€…ç§°ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°æˆ–è€…Float64. ç„¶è€Œï¼Œè¿™ä¸æ˜¯æ„å‘³ç€Javascriptå¼•æ“å°±ä¸€å®šè¦ä¸€ç›´æŒ‰ç…§Float64è¡¨ç¤ºä¿å­˜æ•°å­— â€”â€” è¿™ä¹ˆåšä¼šéå¸¸ä½æ•ˆï¼å¼•æ“å¯ä»¥é€‰æ‹©å…¶ä»–å†…éƒ¨è¡¨ç¤ºï¼Œåªè¦å¯è¢«å¯Ÿè§‰çš„è¡Œä¸ºå’ŒFloat64å®Œå…¨åŒ¹é…å°±è¡Œã€‚</p><p>å®é™…çš„JavaScriptåº”ç”¨ä¸­ï¼Œå¤§å¤šæ•°æ•°å­—ç¢°å·§éƒ½æ˜¯<a href="https://tc39.es/ecma262/#array-index" target="_blank" rel="noopener">åˆæ³•ECMAScriptæ•°ç»„ç´¢å¼•</a>ã€‚å³0 to 2Â³Â²âˆ’2ä¹‹é—´çš„æ•´å‹å€¼.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">array[<span class="number">0</span>]; <span class="comment">// æœ€å°åˆæ³•çš„æ•°ç»„ç´¢å¼•.</span></span><br><span class="line">array[<span class="number">42</span>];</span><br><span class="line">array[<span class="number">2</span>**<span class="number">32</span><span class="number">-2</span>]; <span class="comment">// æœ€å¤§åˆæ³•æ•°ç»„ç´¢å¼•.</span></span><br></pre></td></tr></table></figure><p>JavaScriptå¼•æ“å¯ä»¥ä¸ºè¿™ç±»æ•°å­—é€‰æ‹©æœ€ä¼˜å†…å­˜è¡¨ç¤ºï¼Œæ¥ä¼˜åŒ–é€šè¿‡ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ çš„ä»£ç ã€‚ä¸ºäº†è®©å¤„ç†å™¨å¯ä»¥æ‰§è¡Œå†…å­˜è®¿é—®æ“ä½œï¼Œæ•°ç»„ç´¢å¼•å¿…é¡»æ˜¯<a href="https://en.wikipedia.org/wiki/Two%27s_complement" target="_blank" rel="noopener">äºŒè¿›åˆ¶è¡¥ç </a>. å°†æ•°ç»„ç´¢å¼•è¡¨ç¤ºä¸ºFloat64å®é™…ä¸Šæ˜¯ä¸€ç§æµªè´¹ï¼Œå› ä¸ºå¼•æ“å¿…é¡»åœ¨æ¯æ¬¡æœ‰äººè®¿é—®æ•°ç»„å…ƒç´ æ—¶åœ¨float64å’ŒäºŒè¿›åˆ¶è¡¥ç ä¹‹é—´æ¥å›è½¬æ¢</p><p>32ä½çš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºä¸ä»…ä»…å¯¹æ•°ç»„æ“ä½œæœ‰ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>å¤„ç†å™¨æ‰§è¡Œæ•´å‹æ“ä½œä¼šæ¯”æµ®ç‚¹å‹æ“ä½œè¦å¿«å¾—å¤š</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸‹ä¸€ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªå¾ªç¯æ‰§è¡Œé€Ÿåº¦æ˜¯ç¬¬äºŒä¸ªå¾ªç¯çš„ä¸¤å€.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) &#123;</span><br><span class="line">  <span class="comment">// fast ğŸš€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0.1</span>; i &lt; <span class="number">1000.1</span>; ++i) &#123;</span><br><span class="line">  <span class="comment">// slow ğŸŒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ“ä½œç¬¦ä¹Ÿä¸€æ ·ã€‚ä¸‹é¢ä»£ç ç‰‡æ®µä¸­ï¼Œå–æ¨¡æ“ä½œç¬¦çš„æ€§èƒ½ä¾èµ–äºæ“ä½œæ•°æ˜¯å¦æ˜¯æ•´å‹.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> remainder = value % divisor;</span><br><span class="line"><span class="comment">// Fast ğŸš€ å¦‚æœ `value` å’Œ `divisor` éƒ½è¡¨ç¤ºä¸ºæ•´å‹,</span></span><br><span class="line"><span class="comment">// slow ğŸŒ å…¶ä»–æƒ…å†µ</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½è¡¨ç¤ºä¸ºæ•´å‹ï¼ŒCPUå°±å¯ä»¥éå¸¸é«˜æ•ˆåœ°è®¡ç®—ç»“æœã€‚å¦‚æœ<code>divisor</code>æ˜¯2çš„å¹‚, V8è¿˜æœ‰é¢å¤–çš„å¿«é€Ÿé€šé“(fast-paths)ã€‚å¯¹äºè¡¨ç¤ºä¸ºæµ®ç‚¹æ ‘çš„å€¼ï¼Œè®¡ç®—åˆ™è¦å¤æ‚çš„å¤šï¼Œå¹¶ä¸”éœ€è¦æ›´é•¿çš„æ—¶é—´.</p><p>å› ä¸ºæ•´å‹æ“ä½œé€šå¸¸éƒ½æ¯”æµ®ç‚¹å‹æ“ä½œè¦å¿«å¾—å¤šï¼Œæ‰€ä»¥å¼•æ“ä¼¼ä¹å¯ä»¥æ€»æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç æ¥è¡¨ç¤ºæ‰€æœ‰æ•´å‹å€¼å’Œæ•´å‹çš„è®¡ç®—ç»“æœã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¼šè¿åECMAScriptè§„èŒƒï¼ECMAScriptæ˜¯åœ¨Float64åŸºç¡€ä¸Šè¿›è¡Œæ ‡å‡†åŒ–ï¼Œå› æ­¤å®é™…ä¸ŠæŸäº›æ•´æ•°æ“ä½œä¹Ÿå¯èƒ½ä¼šè¾“å‡ºæµ®ç‚¹æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJSå¼•æ“è¾“å‡ºæ­£ç¡®çš„ç»“æœæ›´é‡è¦ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Float64 çš„å®‰å…¨æ•´å‹èŒƒå›´æ˜¯ 53 bits. è¶…è¿‡è¿™ä¸ªè¿”å›ä¼šå¤±å»ç²¾åº¦,</span></span><br><span class="line"><span class="number">2</span>**<span class="number">53</span> === <span class="number">2</span>**<span class="number">53</span>+<span class="number">1</span>;</span><br><span class="line"><span class="comment">// â†’ true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Float64 æ”¯æŒ-0, ç´¢å¼• -1 * 0 å¿…é¡»æ˜¯ -0, ä½†æ˜¯äºŒè¿›åˆ¶è¡¥ç æ˜¯æ²¡åŠæ³•è¡¨ç¤º-0.</span></span><br><span class="line"><span class="number">-1</span>*<span class="number">0</span> === <span class="number">-0</span>;</span><br><span class="line"><span class="comment">// â†’ true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Float64 å¯ä»¥é€šè¿‡é™¤ä»¥0æ¥å¾—åˆ°æ— ç©·å¤§.</span></span><br><span class="line"><span class="number">1</span>/<span class="number">0</span> === <span class="literal">Infinity</span>;</span><br><span class="line"><span class="comment">// â†’ true</span></span><br><span class="line"><span class="number">-1</span>/<span class="number">0</span> === -<span class="literal">Infinity</span>;</span><br><span class="line"><span class="comment">// â†’ true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Float64 è¿˜æœ‰NaN.</span></span><br><span class="line"><span class="number">0</span>/<span class="number">0</span> === <span class="literal">NaN</span>;</span><br></pre></td></tr></table></figure><p>å°½ç®¡å·¦ä¾§éƒ½æ˜¯æ•´å‹ï¼Œå³ä¾§æ‰€æœ‰å€¼å´éƒ½æ˜¯æµ®ç‚¹å‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ32ä½äºŒè¿›åˆ¶è¡¥ç ä¸èƒ½æ­£ç¡®åœ°æ‰§è¡Œä¸Šé¢è¿™äº›æ“ä½œã€‚æ‰€ä»¥JavaScriptå¼•æ“å¿…é¡»ç‰¹åˆ«è°¨æ…ï¼Œä»¥ç¡®ä¿æ•´æ•°æ“ä½œå¯ä»¥é€‚å½“åœ°å›é€€ï¼Œä»è€Œè¾“å‡ºèŠ±å“¨(ç¬¦åˆè§„èŒƒ)çš„Float64ç»“æœã€‚</p><p>å¯¹äº31ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´å†…çš„å°æ•´æ•°ï¼ŒV8ä½¿ç”¨ä¸€ä¸ªç§°ä¸º<code>Smi</code>(è¯‘æ³¨: Small Integer)çš„ç‰¹æ®Šè¡¨ç¤ºã€‚å…¶ä»–é<code>Smi</code>çš„è¡¨ç¤ºç§°ä¸º<code>HeapObject</code>ï¼Œå³æŒ‡å‘å†…å­˜ä¸­æŸäº›å®ä½“çš„åœ°å€ã€‚å¯¹äºæ•°å­—ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„<code>HeapObject</code>, å°šä¸”ç§°ä¸º<code>HeapNumber</code>, ç”¨æ¥è¡¨ç¤ºä¸åœ¨SmièŒƒå›´å†…çš„æ•°å­—.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> -<span class="literal">Infinity</span> <span class="comment">// HeapNumber</span></span><br><span class="line">-(<span class="number">2</span>**<span class="number">30</span>)<span class="number">-1</span> <span class="comment">// HeapNumber</span></span><br><span class="line">  -(<span class="number">2</span>**<span class="number">30</span>) <span class="comment">// Smi</span></span><br><span class="line">       <span class="number">-42</span> <span class="comment">// Smi</span></span><br><span class="line">        <span class="number">-0</span> <span class="comment">// HeapNumber</span></span><br><span class="line">         <span class="number">0</span> <span class="comment">// Smi</span></span><br><span class="line">       <span class="number">4.2</span> <span class="comment">// HeapNumber</span></span><br><span class="line">        <span class="number">42</span> <span class="comment">// Smi</span></span><br><span class="line">   <span class="number">2</span>**<span class="number">30</span><span class="number">-1</span> <span class="comment">// Smi</span></span><br><span class="line">     <span class="number">2</span>**<span class="number">30</span> <span class="comment">// HeapNumber</span></span><br><span class="line">  <span class="literal">Infinity</span> <span class="comment">// HeapNumber</span></span><br><span class="line">       <span class="literal">NaN</span> <span class="comment">// HeapNumber</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä¸€äº›JavaScriptæ•°å­—è¡¨ç¤ºä¸º<code>Smi</code>ï¼Œè€Œå¦ä¸€äº›åˆ™è¡¨ç¤ºä¸º<code>HeapNumber</code>. V8ç‰¹æ„ä¸º<code>Smi</code>ä¼˜åŒ–è¿‡ï¼Œå› ä¸ºå°æ•´æ•°åœ¨å®é™…JavaScriptç¨‹åºä¸­å¤ªå¸¸è§äº†ã€‚<code>Smi</code>ä¸éœ€è¦åœ¨å†…å­˜ä¸­é¢å¤–åˆ†é…ä¸“é—¨çš„å®ä½“, å¯ä»¥è¿›è¡Œå¿«é€Ÿçš„æ•´å‹æ“ä½œ.</p><p>è¿™é‡Œæ›´é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œ<strong>å³ä½¿æ˜¯ç›¸åŒJavascriptç±»å‹çš„å€¼ï¼Œä¸ºäº†ä¼˜åŒ–ï¼ŒèƒŒåå¯èƒ½ä¼šä»¥å®Œå…¨ä¸åŒçš„æ–¹å¼è¿›è¡Œè¡¨ç¤º</strong>ã€‚</p><p><br><br><br></p><h2 id="smi-vs-heapnumber-vs-mutableheapnumber"><a href="#smi-vs-heapnumber-vs-mutableheapnumber" class="headerlink" title="Smi vs. HeapNumber vs. MutableHeapNumber"></a>Smi vs. HeapNumber vs. MutableHeapNumber</h2><p>ä¸‹é¢ä»‹ç»å®ƒä»¬åº•å±‚æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚å‡è®¾ä½ æœ‰ä¸‹åˆ—å¯¹è±¡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  x: <span class="number">42</span>,  <span class="comment">// Smi</span></span><br><span class="line">  y: <span class="number">4.2</span>, <span class="comment">// HeapNumber</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>x</code>çš„å€¼<code>42</code>å¯ä»¥è¢«ç¼–ç ä¸º<code>Smi</code>ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨å¯¹è±¡è‡ªå·±å†…éƒ¨è¿›è¡Œä¿å­˜ã€‚å¦ä¸€æ–¹é¢ï¼Œå€¼<code>4.2</code>åˆ™éœ€è¦ä¸€ä¸ªå•ç‹¬çš„å®ä½“æ¥ä¿å­˜ï¼Œç„¶åå¯¹è±¡å†æŒ‡å‘è¿™ä¸ªå®ä½“.</p><p><img src="/images/react-cliff/04-smi-vs-heapnumber.svg" alt></p><p>ç°åœ¨å¼€å§‹æ‰§è¡Œä¸‹é¢çš„Javascriptç‰‡æ®µ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">o.x += <span class="number">10</span>;</span><br><span class="line"><span class="comment">// â†’ o.x ç°åœ¨æ˜¯ 52</span></span><br><span class="line">o.y += <span class="number">1</span>;</span><br><span class="line"><span class="comment">// â†’ o.y ç°åœ¨æ˜¯ 5.2</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>x</code>çš„å€¼å¯ä»¥è¢«åŸåœ°(in-place)æ›´æ–°ï¼Œå› ä¸ºæ–°çš„å€¼<code>52</code>è¿˜æ˜¯ç¬¦åˆ<code>Smi</code>çš„èŒƒå›´.</p><p><img src="/images/react-cliff/05-update-smi.svg" alt></p><p>ç„¶è€Œï¼Œæ–°å€¼<code>y=5.2</code>ä¸ç¬¦åˆ<code>Smi</code>ï¼Œä¸”å’Œä¹‹å‰çš„å€¼<code>4.2</code>ä¸ä¸€æ ·ï¼Œæ‰€ä»¥V8å¿…é¡»åˆ†é…ä¸€ä¸ªæ–°çš„<code>HeapNumber</code>å®ä½“ï¼Œå†èµ‹å€¼ç»™yã€‚</p><p><img src="/images/react-cliff/06-update-heapnumber.svg" alt></p><p><code>HeapNumber</code>æ˜¯ä¸å¯å˜çš„ï¼Œè¿™ä¹Ÿè®©æŸäº›ä¼˜åŒ–æˆä¸ºå¯èƒ½ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å°†yçš„å€¼èµ‹ç»™x:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">o.x = o.y;</span><br><span class="line"><span class="comment">// â†’ o.x ç°åœ¨æ˜¯ 5.2</span></span><br></pre></td></tr></table></figure><p>â€¦æˆ‘ä»¬ç°åœ¨å¯ä»¥ç®€å•åœ°é“¾æ¥åˆ°åŒä¸€ä¸ªHeapNumberï¼Œè€Œä¸æ˜¯åˆ†é…ä¸€ä¸ªæ–°çš„.</p><p><img src="/images/react-cliff/07-heapnumbers.svg" alt></p><p><code>HeapNumbers</code>ä¸å¯å˜çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œé¢‘ç¹æ›´æ–°å­—æ®µä¸åœ¨<code>Smi</code>èŒƒå›´å†…çš„å€¼ä¼šæ¯”è¾ƒæ…¢ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª `HeapNumber` å®ä¾‹.</span></span><br><span class="line"><span class="keyword">const</span> o = &#123; <span class="attr">x</span>: <span class="number">0.1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºå¦ä¸€ä¸ª `HeapNumber` å®ä¾‹.</span></span><br><span class="line">  o.x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œé€šè¿‡åˆå§‹åŒ–å€¼<code>0.1</code>åˆ›å»ºä¸€ä¸ª<code>HeapNumber</code>å®ä¾‹ã€‚å¾ªç¯ä½“å°†å®ƒçš„å€¼æ”¹å˜ä¸º<code>1.1</code>ã€<code>2.1</code>ã€<code>3.1</code>ã€<code>4.1</code>ã€æœ€åæ˜¯<code>5.1</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹æ€»å…±åˆ›å»ºäº†6ä¸ª<code>HeapNumber</code>å®ä¾‹ï¼Œå…¶ä¸­5ä¸ªä¼šåœ¨å¾ªç¯ç»“æŸåè¢«åƒåœ¾å›æ”¶ã€‚</p><p><img src="/images/react-cliff/08-garbage-heapnumbers.svg" alt></p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒV8ä¹Ÿæä¾›äº†ä¸€ç§æœºåˆ¶æ¥åŸåœ°æ›´æ–°é<code>Smi</code>æ•°å­—å­—æ®µä½œä¸ºä¼˜åŒ–ã€‚å½“ä¸€ä¸ªæ•°å­—å­—æ®µä¿å­˜çš„å€¼è¶…å‡ºäº†<code>Smi</code>çš„èŒƒå›´åï¼ŒV8ä¼šåœ¨<code>Shape</code>ä¸­å°†è¿™ä¸ªå­—æ®µæ ‡è®°ä¸º<code>Double</code>, å¹¶ä¸”åˆ†é…ä¸€ä¸ªç§°ä¸º<code>MutableHeapNumber</code>å®ä½“æ¥ä¿å­˜å®é™…çš„å€¼ã€‚</p><p><img src="/images/react-cliff/09-mutableheapnumber.svg" alt></p><blockquote><p>è¯‘æ³¨: å…³äº<code>Shape</code>æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡<a href="https://mathiasbynens.be/notes/shapes-ics" target="_blank" rel="noopener">æ–‡ç« </a>, ç®€å•è¯´<code>Shape</code>å°±æ˜¯ä¸€ä¸ªå¯¹è±¡çš„â€˜å¤–å½¢â€™ï¼ŒJavaScriptå¼•æ“å¯ä»¥é€šè¿‡<code>Shape</code>æ¥ä¼˜åŒ–å¯¹è±¡çš„å±æ€§è®¿é—®ã€‚</p></blockquote><p>ç°åœ¨å½“å­—æ®µçš„å€¼å˜åŠ¨æ—¶ï¼ŒV8ä¸éœ€è¦åœ¨åˆ†é…ä¸€ä¸ªæ–°çš„<code>HeapNumber</code>ï¼Œè€Œæ˜¯ç›´æ¥åŸåœ°æ›´æ–°<code>MutableHeapNumber</code>.</p><p><img src="/images/react-cliff/10-update-mutableheapnumber.svg" alt></p><p>ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸€ä¸ªç¼ºé™·ã€‚å› ä¸ºMutableHeapNumberçš„å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™äº›å€¼ä¸èƒ½å®‰å…¨ä¼ é€’ç»™å…¶ä»–å˜é‡</p><p><img src="/images/react-cliff/11-mutableheapnumber-to-heapnumber.svg" alt></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ å°†<code>o.x</code>èµ‹å€¼ç»™å…¶ä»–å˜é‡<code>y</code>ï¼Œä½ å¯ä¸æƒ³ä¸‹ä¸€æ¬¡<code>o.x</code>å˜åŠ¨æ—¶å½±å“åˆ°<code>y</code>çš„å€¼ â€”â€” è¿™è¿åäº†JavaScriptè§„èŒƒï¼å› æ­¤ï¼Œå½“<code>o.x</code>è¢«è®¿é—®åï¼Œåœ¨å°†å…¶èµ‹å€¼ç»™<code>y</code>ä¹‹å‰ï¼Œå¿…é¡»å°†è¯¥æ•°å­—é‡æ–°è£…ç®±(re-boxed)æˆä¸€ä¸ªå¸¸è§„çš„<code>HeapNumber</code>ã€‚</p><p>å¯¹äºæµ®ç‚¹æ•°ï¼ŒV8ä¼šåœ¨èƒŒåæ‰§è¡Œæ‰€æœ‰ä¸Šé¢æåˆ°çš„â€œåŒ…è£…(boxing)â€é­”æ³•ã€‚ä½†æ˜¯å¯¹äºå°æ•´æ•°æ¥è¯´ï¼Œä½¿ç”¨<code>MutableHeapNumber</code>å°±æ˜¯æµªè´¹ï¼Œå› ä¸º<code>Smi</code>æ˜¯æ›´é«˜æ•ˆçš„è¡¨ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> object = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="comment">// â†’ ä¸éœ€è¦â€˜åŒ…è£…â€™xå­—æ®µ</span></span><br><span class="line"></span><br><span class="line">object.x += <span class="number">1</span>;</span><br><span class="line"><span class="comment">// â†’ ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨æ›´æ–°</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…ä½æ•ˆç‡ï¼Œå¯¹äºå°æ•´æ•°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨<code>Shape</code>ä¸Šå°†è¯¥å­—æ®µæ ‡è®°ä¸º<code>Smi</code>è¡¨ç¤ºï¼Œåªè¦ç¬¦åˆå°æ•´æ•°çš„èŒƒå›´ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•åœ°åŸåœ°æ›´æ–°æ•°å­—å€¼ã€‚</p><p><img src="/images/react-cliff/12-smi-no-boxing.svg" alt></p><p><br></p><h2 id="shape-åºŸå¼ƒå’Œè¿ç§»"><a href="#shape-åºŸå¼ƒå’Œè¿ç§»" class="headerlink" title="Shape åºŸå¼ƒå’Œè¿ç§»"></a>Shape åºŸå¼ƒå’Œè¿ç§»</h2><p>é‚£ä¹ˆï¼Œå¦‚æœä¸€ä¸ªå­—æ®µåˆå§‹åŒ–æ—¶æ˜¯<code>Smi</code>ï¼Œä½†æ˜¯åç»­ä¿å­˜äº†ä¸€ä¸ªè¶…å‡ºå°æ•´æ•°æ–¹ä½çš„å€¼å‘¢ï¼Ÿæ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼Œä¸¤ä¸ªå¯¹è±¡éƒ½ä½¿ç”¨ç›¸åŒçš„<code>Shape</code>ï¼Œå³<code>x</code>åœ¨åˆå§‹åŒ–æ—¶è¡¨ç¤ºä¸º<code>Smi</code>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> b = &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="comment">// â†’ å¯¹è±¡ç°åœ¨å°† `x`å­—æ®µ è¡¨ç¤ºä¸º `Smi`</span></span><br><span class="line"></span><br><span class="line">b.x = <span class="number">0.2</span>;</span><br><span class="line"><span class="comment">// â†’ `b.x` ç°åœ¨è¡¨ç¤ºä¸º `Double`</span></span><br><span class="line"></span><br><span class="line">y = a.x;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä¸¤ä¸ªå¯¹è±¡éƒ½æŒ‡å‘åŒä¸€ä¸ª<code>Shape</code>ï¼Œ<code>x</code>è¢«æ ‡è®°ä¸º<code>Smi</code>è¡¨ç¤ºï¼š</p><p><img src="/images/react-cliff/13-shape.svg" alt></p><p>å½“<code>b.x</code>ä¿®æ”¹ä¸º<code>Double</code>è¡¨ç¤ºæ—¶ï¼ŒV8ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„<code>Shape</code>ï¼Œå°†<code>x</code>è®¾ç½®ä¸º<code>Double</code>è¡¨ç¤ºï¼Œå¹¶ä¸”å®ƒä¼šæŒ‡å‘å›<code>ç©ºShape</code>(è¯‘æ³¨ï¼šShapeæ˜¯æ ‘ç»“æ„)ã€‚å¦å¤–V8è¿˜ä¼šåˆ†é…ä¸€ä¸ª<code>MutableHeapNumber</code>æ¥ä¿å­˜<code>x</code>çš„æ–°å€¼<code>0.2</code>. æ¥ç€æˆ‘ä»¬æ›´æ–°å¯¹è±¡<code>b</code>æŒ‡å‘æ–°çš„<code>Shape</code>ï¼Œå¹¶ä¸”ä¿®æ”¹å¯¹è±¡çš„<code>x</code>æŒ‡å‘åˆšæ‰åˆ†é…çš„<code>MutableHeapNumber</code>ã€‚æœ€åï¼Œæˆ‘ä»¬æ ‡è®°æ—§çš„<code>Shape</code>ä¸ºåºŸå¼ƒçŠ¶æ€ï¼Œå¹¶ä»è½¬æ¢æ ‘(transition tree)ä¸­ç§»é™¤ã€‚è¿™æ˜¯é€šè¿‡å°†<code>â€œxâ€</code>ä»ç©º<code>Shape</code>è½¬æ¢ä¸ºæ–°åˆ›å»ºçš„<code>Shape</code>çš„æ–¹å¼æ¥å®Œæˆçš„ã€‚</p><p><img src="/images/react-cliff/14-shape-transition.svg" alt></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜ä¸èƒ½å®Œå…¨å°†<code>æ—§Shape</code>åˆ é™¤æ‰ï¼Œå› ä¸ºå®ƒè¿˜è¢«<code>a</code>ä½¿ç”¨ç€ï¼Œè€Œä¸”ä½ ä¸èƒ½ç€æ€¥éå†å†…å­˜æ¥æ‰¾å‡ºæ‰€æœ‰æŒ‡å‘<code>æ—§Shape</code>çš„å¯¹è±¡ï¼Œè¿™ç§åšæ³•å¤ªä½æ•ˆã€‚æ‰€ä»¥V8é‡‡ç”¨æƒ°æ€§æ–¹å¼: å¯¹äº<code>a</code>çš„ä»»æ„å±æ€§çš„è®¿é—®å’Œèµ‹å€¼ï¼Œä¼šé¦–å…ˆè¿ç§»åˆ°æ–°çš„<code>Shape</code>ã€‚è¿™æ ·åš, æœ€ç»ˆå¯ä»¥å°†åºŸå¼ƒçš„Shapeå˜æˆâ€˜ä¸èƒ½åˆ°è¾¾(unreachable)â€™, è®©åƒåœ¾å›æ”¶å™¨é‡Šæ”¾æ‰å®ƒã€‚</p><p><img src="/images/react-cliff/15-shape-deprecation.svg" alt></p><p>å¦‚æœä¿®æ”¹è¡¨ç¤ºçš„å­—æ®µä¸æ˜¯é“¾ä¸­çš„æœ€åä¸€ä¸ªå­—æ®µï¼Œåˆ™ä¼šå‡ºç°æ›´æ£˜æ‰‹çš„æƒ…å†µï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  x: <span class="number">1</span>,</span><br><span class="line">  y: <span class="number">2</span>,</span><br><span class="line">  z: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">o.y = <span class="number">0.1</span>;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µï¼ŒV8éœ€è¦æ‰¾åˆ°æ‰€è°“çš„<code>åˆ†å‰²Shape</code>(split shape), å³ç›¸å…³å±æ€§åœ¨è¢«å¼•å…¥åˆ°<code>Shape</code>é“¾ä¹‹å‰çš„<code>Shape</code>ã€‚è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹çš„æ˜¯<code>y</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¼•å…¥<code>y</code>ä¹‹å‰çš„æœ€åä¸€ä¸ª<code>Shape</code>ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­è¿™ä¸ª<code>Shape</code>å°±æ˜¯<code>x</code>ï¼š</p><p><img src="/images/react-cliff/16-split-shape.svg" alt></p><p>ä»<code>åˆ†å‰²Shape</code>(å³x)å¼€å§‹ï¼Œæˆ‘ä»¬ä¸ºyåˆ›å»ºä¸€ä¸ªæ–°çš„è½¬æ¢é“¾, å®ƒå°†yæ ‡è®°ä¸º<code>Double</code>è¡¨ç¤ºï¼Œå¹¶é‡æ”¾(replay)ä¹‹å‰çš„å…¶ä»–è½¬æ¢. æˆ‘ä»¬å°†å¯¹<code>y</code>åº”ç”¨è¿™ä¸ªæ–°çš„è½¬æ¢é“¾ï¼Œå°†æ—§çš„æ ‘æ ‡è®°ä¸ºåºŸå¼ƒã€‚åœ¨æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°†å®ä¾‹<code>o</code>è¿ç§»åˆ°æ–°çš„<code>Shape</code>ï¼Œç°åœ¨ä½¿ç”¨ä¸€ä¸ª<code>MutableHeapNumber</code>æ¥ä¿å­˜<code>y</code>çš„å€¼ã€‚åé¢æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä¸ä¼šä½¿ç”¨æ—§çš„<code>Shape</code>çš„è·¯å¾„ï¼Œä¸€æ—¦æ‰€æœ‰æ—§<code>Shape</code>çš„å¼•ç”¨éƒ½ç§»é™¤äº†ï¼Œ<code>Shape</code>æ ‘çš„åºŸå¼ƒéƒ¨åˆ†å°±ä¼šè¢«é”€æ¯ã€‚</p><h2 id="å¯æ‰©å±•æ€§å’Œå®Œæ•´æ€§çº§åˆ«è½¬æ¢"><a href="#å¯æ‰©å±•æ€§å’Œå®Œæ•´æ€§çº§åˆ«è½¬æ¢" class="headerlink" title="å¯æ‰©å±•æ€§å’Œå®Œæ•´æ€§çº§åˆ«è½¬æ¢"></a>å¯æ‰©å±•æ€§å’Œå®Œæ•´æ€§çº§åˆ«è½¬æ¢</h2><p><code>Object.preventExtensions()</code>é˜»æ­¢æ–°çš„å±æ€§æ·»åŠ åˆ°å¯¹è±¡ä¸­, å¦åˆ™å®ƒå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚(å¦‚æœä½ ä¸åœ¨ä¸¥æ ¼æ¨¡å¼ï¼Œå®ƒå°†ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯ä»€ä¹ˆéƒ½ä¸å¹²)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> object = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(object);</span><br><span class="line">object.y = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// TypeError: Cannot add property y;</span></span><br><span class="line"><span class="comment">//            object is not extensible</span></span><br></pre></td></tr></table></figure><p><code>Object.seal</code>å’Œ<code>Object.preventExtensions</code>ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒå°†æ‰€æœ‰å±æ€§æ ‡è®°ä¸º<code>non-configurable</code>, è¿™æ„å‘³ç€ä½ ä¸èƒ½åˆ é™¤å®ƒä»¬, æˆ–è€…æ”¹å˜å®ƒä»¬çš„<code>Configurable</code>ã€<code>Enumerable</code>ã€<code>Writable</code>å±æ€§ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> object = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.seal(object);</span><br><span class="line">object.y = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// TypeError: Cannot add property y;</span></span><br><span class="line"><span class="comment">//            object is not extensible</span></span><br><span class="line"><span class="keyword">delete</span> object.x;</span><br><span class="line"><span class="comment">// TypeError: Cannot delete property x</span></span><br></pre></td></tr></table></figure><p><code>Object.freeze</code>å’Œ<code>Object.seal</code>å·®ä¸å¤š, åªä¸è¿‡å®ƒè¿˜ä¼šé˜»æ­¢å·²å­˜åœ¨çš„å±æ€§è¢«ä¿®æ”¹ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> object = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.freeze(object);</span><br><span class="line">object.y = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// TypeError: Cannot add property y;</span></span><br><span class="line"><span class="comment">//            object is not extensible</span></span><br><span class="line"><span class="keyword">delete</span> object.x;</span><br><span class="line"><span class="comment">// TypeError: Cannot delete property x</span></span><br><span class="line">object.x = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// TypeError: Cannot assign to read-only property x</span></span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬è€ƒè™‘è¿™æ ·ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä¸‹é¢ä¸¤ä¸ªå¯¹è±¡éƒ½åŒ…å«å•ä¸ª<code>x</code>å±æ€§ï¼Œåè€…è¿˜é˜»æ­¢äº†å¯¹è±¡æ‰©å±•ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> b = &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(b);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½çŸ¥é“å®ƒä¸€å¼€å§‹ä¼šä»ç©º<code>Shape</code>è½¬æ¢ä¸ºä¸€ä¸ªåŒ…å«<code>x</code>(è¡¨ç¤ºä¸ºSmi)çš„æ–°<code>Shape</code>ã€‚å½“æˆ‘ä»¬é˜»æ­¢<code>b</code>è¢«æ‰©å±•æ—¶ï¼Œæˆ‘ä»¬ä¼šæ‰§è¡Œä¸€é¡¹ç‰¹æ®Šçš„è½¬æ¢ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„<code>Shape</code>å¹¶æ ‡è®°ä¸ºâ€™ä¸å¯æ‰©å±•â€™ã€‚è¿™ä¸ªç‰¹æ®Šçš„è½¬æ¢ä¸ä¼šå¼•å…¥ä»»ä½•æ–°çš„å±æ€§ â€”â€” å®ƒåªæ˜¯ä¸€ä¸ªæ ‡è®°</p><p><img src="/images/react-cliff/17-shape-nonextensible.svg" alt></p><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½åŸåœ°æ›´æ–°<code>x</code>çš„<code>Shape</code>ï¼Œå› ä¸ºå®ƒè¿˜è¢«<code>a</code>å¯¹è±¡å¼•ç”¨ï¼Œ<code>a</code>å¯¹è±¡è¿˜æ˜¯å¯æ‰©å±•çš„ã€‚</p><p><br></p><h2 id="reactçš„æ€§èƒ½é—®é¢˜"><a href="#reactçš„æ€§èƒ½é—®é¢˜" class="headerlink" title="Reactçš„æ€§èƒ½é—®é¢˜"></a>Reactçš„æ€§èƒ½é—®é¢˜</h2><p>è®©æˆ‘ä»¬å°†ä¸Šè¿°æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œç”¨æˆ‘ä»¬å­¦åˆ°çš„çŸ¥è¯†æ¥ç†è§£<a href="https://github.com/facebook/react/issues/14365" target="_blank" rel="noopener">æœ€è¿‘çš„React Issue #14365</a>. å½“Reactå›¢é˜Ÿåœ¨åˆ†æä¸€ä¸ªçœŸå®çš„åº”ç”¨æ—¶ï¼Œä»–ä»¬å‘ç°äº†V8ä¸€ä¸ªå½±å“React æ ¸å¿ƒçš„å¥‡æ€ªæ€§èƒ½é—®é¢˜. ä¸‹é¢æ˜¯è¿™ä¸ªbugçš„ç®€å•å¤ç°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(o);</span><br><span class="line">o.y = <span class="number">0.2</span>;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æˆ‘ä»¬è¿™ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ª<code>Smi</code>è¡¨ç¤ºçš„å­—æ®µã€‚æ¥ç€æˆ‘ä»¬è¿˜é˜»æ­¢äº†å¯¹è±¡æ‰©å±•ï¼Œæœ€åè¿˜å¼ºåˆ¶å°†ç¬¬äºŒä¸ªå­—æ®µè½¬æ¢ä¸º<code>Double</code>è¡¨ç¤ºã€‚</p><p>æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢æè¿°çš„ï¼Œè¿™å¤§æ¦‚ä¼šåˆ›å»ºä»¥ä¸‹ä¸œè¥¿ï¼š</p><p><img src="/images/react-cliff/18-repro-shape-setup.svg" alt></p><p>ä¸¤ä¸ªå±æ€§éƒ½ä¼šè¢«æ ‡è®°ä¸º<code>Smi</code>è¡¨ç¤ºï¼Œæœ€åä¸€ä¸ªè½¬æ¢æ˜¯å¯æ‰©å±•æ€§è½¬æ¢ï¼Œç”¨äºå°†Shapeæ ‡è®°ä¸ºä¸å¯æ‰©å±•ã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦å°†<code>y</code>è½¬æ¢ä¸º<code>Double</code>è¡¨ç¤ºï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åˆè¦å¼€å§‹æ‰¾å‡º<code>åˆ†å‰²Shape</code>. åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>åˆ†å‰²Shape</code>å°±æ˜¯å¼•å…¥<code>x</code>çš„é‚£ä¸ª<code>Shape</code>ã€‚ä½†æ˜¯V8ä¼šæœ‰ç‚¹è¿·æƒ‘ï¼Œå› ä¸º<code>åˆ†å‰²Shape</code>æ˜¯å¯æ‰©å±•çš„ï¼Œè€Œå½“å‰<code>Shape</code>å´è¢«æ ‡è®°ä¸ºä¸å¯æ‰©å±•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒV8å¹¶ä¸çŸ¥é“å¦‚ä½•æ­£ç¡®åœ°é‡æ”¾è½¬æ¢ã€‚æ‰€ä»¥V8å¹²è„†ä¸Šæ”¾å¼ƒäº†å°è¯•ç†è§£å®ƒï¼Œç›´æ¥åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„Shapeï¼Œå®ƒæ²¡æœ‰è¿æ¥åˆ°ç°æœ‰çš„Shapeæ ‘ï¼Œä¹Ÿæ²¡æœ‰ä¸ä»»ä½•å…¶ä»–å¯¹è±¡å…±äº«ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª<code>å­¤å„¿Shape</code>ï¼š</p><p><img src="/images/react-cliff/19-orphaned-shape.svg" alt></p><p>ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰å¾ˆå¤šå¯¹è±¡éƒ½è¿™æ ·å­æœ‰å¤šç³Ÿç³•ï¼Œè¿™ä¼šè®©æ•´ä¸ª<code>Shape</code>ç³»ç»Ÿå˜å¾—æ¯«æ— ç”¨å¤„ã€‚</p><p>åœ¨Reactçš„åœºæ™¯ä¸­ï¼Œæ¯ä¸ªFiberNodeåœ¨æ‰“å¼€åˆ†æå™¨æ—¶éƒ½ä¼šæœ‰å¥½å‡ ä¸ªå­—æ®µç”¨äºä¿å­˜æ—¶é—´æˆ³.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FiberNode</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.actualStartTime = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Object</span>.preventExtensions(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> node1 = <span class="keyword">new</span> FiberNode();</span><br><span class="line"><span class="keyword">const</span> node2 = <span class="keyword">new</span> FiberNode();</span><br></pre></td></tr></table></figure><p>è¿™äº›å­—æ®µ(ä¾‹å¦‚actualStartTime)è¢«åˆå§‹åŒ–ä¸º0æˆ–-1ï¼Œå³ä¸€å¼€å§‹æ—¶æ˜¯<code>Smi</code>è¡¨ç¤ºã€‚åæ¥ï¼Œè¿™äº›å­—æ®µèµ‹å€¼ä¸º<code>performance.now()</code>è¾“å‡ºçš„æ—¶é—´æˆ³ï¼Œè¿™äº›æ—¶é—´æˆ³å®é™…æ˜¯æµ®ç‚¹å‹çš„ã€‚å› ä¸ºä¸ç¬¦åˆ<code>Smi</code>èŒƒå›´ï¼Œå®ƒä»¬éœ€è¦è½¬æ¢ä¸º<code>Double</code>è¡¨ç¤ºã€‚æ°å¥½åœ¨è¿™é‡Œï¼ŒReactè¿˜é˜»æ­¢äº†FiberNodeå®ä¾‹çš„å¯æ‰©å±•æ€§ã€‚</p><p>ä¸Šé¢ä¾‹å­çš„åˆå§‹çŠ¶æ€å¦‚ä¸‹:</p><p><img src="/images/react-cliff/20-fibernode-shape.svg" alt></p><p>æŒ‰ç…§æˆ‘ä»¬è®¾æƒ³çš„ä¸€æ ·, è¿™ä¸¤ä¸ªå®ä¾‹å…±äº«äº†åŒä¸€ä¸ªShareæ ‘. åé¢ï¼Œå½“ä½ ä¿å­˜çœŸæ­£çš„æ—¶é—´æˆ³æ—¶ï¼ŒV8æ‰¾åˆ°<code>åˆ†å‰²Shape</code>å°±è¿·æƒ‘äº†ï¼š</p><p><img src="/images/react-cliff/21-orphan-islands.svg" alt></p><p>V8ç»™<code>node1</code>åˆ†é…äº†ä¸€ä¸ªæ–°çš„<code>å­¤å„¿Shape</code>ï¼Œ<code>node2</code>åŒç†ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†ä¸¤ä¸ªå­¤å²›ï¼Œæ¯ä¸ªå­¤å²›éƒ½æœ‰è‡ªå·±ä¸ç›¸äº¤çš„Shapeã€‚å¤§éƒ¨åˆ†çœŸå®çš„Reactåº”ç”¨æœ‰ä¸Šåƒä¸Šä¸‡ä¸ªFiberNodeã€‚å¯ä»¥æƒ³è±¡åˆ°ï¼Œè¿™ç§æƒ…å†µå¯¹V8çš„æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«ä¹è§‚ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨V8 <a href="https://v8.dev/blog/v8-release-74" target="_blank" rel="noopener">v7.4</a>ä¿®å¤äº†è¿™ä¸ª<a href="https://chromium-review.googlesource.com/c/v8/v8/+/1442640/" target="_blank" rel="noopener">æ€§èƒ½é—®é¢˜</a>, æˆ‘ä»¬ä¹Ÿæ­£åœ¨ç ”ç©¶<a href="https://bit.ly/v8-in-place-field-representation-changes" target="_blank" rel="noopener">å¦‚ä½•é™ä½ä¿®æ”¹å­—æ®µè¡¨ç¤ºçš„æˆæœ¬</a>ï¼Œä»¥æ¶ˆç­å‰©ä½™çš„æ€§èƒ½ç“¶é¢ˆ. ç»è¿‡ä¿®å¤åï¼ŒV8å¯ä»¥æ­£ç¡®å¤„ç†è¿™ç§æƒ…å†µ:</p><p><img src="/images/react-cliff/22-fix.svg" alt></p><p>ä¸¤ä¸ªFiberNodeå®ä¾‹éƒ½æŒ‡å‘äº†â€™actualStartTimeâ€™ä¸º<code>Smi</code>çš„ä¸å¯æ‰©å±•<code>Shape</code>. å½“ç¬¬ä¸€æ¬¡ç»™<code>node1.actualStartTime</code>èµ‹å€¼æ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„è½¬æ¢é“¾ï¼Œå¹¶å°†ä¹‹å‰çš„é“¾æ ‡è®°ä¸ºåºŸå¼ƒã€‚</p><p><img src="/images/react-cliff/23-fix-fibernode-shape-1.svg" alt></p><p>æ³¨æ„, ç°åœ¨æ‰©å±•æ€§è½¬æ¢å¯ä»¥åœ¨æ–°é“¾ä¸­æ­£ç¡®é‡æ”¾ã€‚</p><p><img src="/images/react-cliff/24-fix-fibernode-shape-2.svg" alt></p><p>åœ¨èµ‹å€¼<code>node2.actualStartTime</code>ä¹‹åï¼Œä¸¤ä¸ªèŠ‚ç‚¹éƒ½å¼•ç”¨åˆ°äº†æ–°çš„Shapeï¼Œè½¬æ¢æ ‘ä¸­åºŸå¼ƒçš„éƒ¨åˆ†å°†è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p><p>åœ¨Bugæœªä¿®å¤ä¹‹å‰ï¼ŒReactå›¢é˜Ÿé€šè¿‡ç¡®ä¿FiberNodeä¸Šçš„æ‰€æœ‰æ—¶é—´å’Œæ—¶é—´æ®µå­—æ®µéƒ½åˆå§‹åŒ–ä¸ºDoubleè¡¨ç¤ºï¼Œæ¥ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FiberNode</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// åœ¨ä¸€å¼€å§‹å¼ºåˆ¶ä¸ºDoubleè¡¨ç¤º.</span></span><br><span class="line">    <span class="keyword">this</span>.actualStartTime = <span class="built_in">Number</span>.NaN;</span><br><span class="line">    <span class="comment">// åé¢ä¾æ—§å¯ä»¥æŒ‰ç…§ä¹‹å‰çš„æ–¹å¼åˆå§‹åŒ–å€¼</span></span><br><span class="line">    <span class="keyword">this</span>.actualStartTime = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Object</span>.preventExtensions(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> node1 = <span class="keyword">new</span> FiberNode();</span><br><span class="line"><span class="keyword">const</span> node2 = <span class="keyword">new</span> FiberNode();</span><br></pre></td></tr></table></figure><p>é™¤äº†<code>Number.NaN</code>, ä»»ä½•æµ®ç‚¹æ•°å€¼éƒ½ä¸åœ¨<code>Smi</code>çš„èŒƒå›´å†…, å¯ä»¥ç”¨äºå¼ºåˆ¶<code>Double</code>è¡¨ç¤ºã€‚ä¾‹å¦‚<code>0.000001</code>, <code>Number.MIN_VALUE</code>, <code>-0</code>å’Œ<code>Infinity</code></p><p>å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™ä¸ªå…·ä½“çš„React bugæ˜¯V8ç‰¹æœ‰çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¼€å‘äººå‘˜ä¸åº”è¯¥é’ˆå¯¹ç‰¹å®šç‰ˆæœ¬çš„JavaScriptå¼•æ“è¿›è¡Œä¼˜åŒ–ã€‚ä¸è¿‡ï¼Œå½“äº‹æƒ…ä¸èµ·ä½œç”¨çš„æ—¶å€™æœ‰ä¸ªæŠŠæŸ„æ€»æ¯”æ²¡æœ‰å¥½ã€‚</p><p>è®°ä½è¿™äº›Javascriptå¼•æ“èƒŒåæ‰§è¡Œçš„ä¸€äº›é­”æ³•ï¼Œ<strong>å¦‚æœå¯èƒ½ï¼Œå°½é‡ä¸è¦æ··åˆç±»å‹ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸è¦å°†ä½ çš„æ•°å­—å­—æ®µåˆå§‹åŒ–ä¸ºnullï¼Œå› ä¸ºè¿™æ ·ä¼šä¸§å¤±è·Ÿè¸ªå­—æ®µè¡¨ç¤ºçš„æ‰€æœ‰å¥½å¤„</strong>ã€‚ä¸æ··åˆç±»å‹ä¹Ÿå¯ä»¥è®©ä½ çš„ä»£ç æ›´å…·å¯è¯»æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Donâ€™t do this!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  x = <span class="literal">null</span>;</span><br><span class="line">  y = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> Point();</span><br><span class="line">p.x = <span class="number">0.1</span>;</span><br><span class="line">p.y = <span class="number">402</span>;</span><br></pre></td></tr></table></figure><blockquote><p>è¯‘æ³¨ï¼šå¦‚æœä½ ä½¿ç”¨Typescriptï¼Œåº”è¯¥å¼€å¯strictNullæ¨¡å¼</p></blockquote><p>æ¢å¥è¯è¯´ï¼Œç¼–å†™é«˜å¯è¯»çš„ä»£ç ï¼Œæ˜¯å¯ä»¥æé«˜æ€§èƒ½çš„ï¼</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬æ·±å…¥è®¨è®ºäº†ä¸‹åˆ—å†…å®¹ï¼š</p><ul><li>JavaScript åŒºåˆ†äº†â€˜åŸå§‹ç±»å‹â€™å’Œâ€˜å¯¹è±¡ç±»å‹â€™ï¼Œtypeofæ˜¯ä¸€ä¸ªéª—å­</li><li>å³ä½¿æ˜¯ç›¸åŒJavascriptç±»å‹çš„å€¼ï¼Œåº•å±‚å¯èƒ½æœ‰ä¸åŒçš„è¡¨ç¤º</li><li>V8å°è¯•ç»™ä½ çš„Javascriptç¨‹åºçš„æ¯ä¸ªå±æ€§æ‰¾å‡ºä¸€ä¸ªæœ€ä¼˜çš„è¡¨ç¤º</li><li>æˆ‘ä»¬è¿˜è®¨è®ºäº†V8æ˜¯å¦‚ä½•å¤„ç†ShapeåºŸå¼ƒå’Œè¿ç§»çš„ï¼Œå¦å¤–è¿˜åŒ…æ‹¬æ‰©å±•æ€§è½¬æ¢</li></ul><p>åŸºäºè¿™äº›çŸ¥è¯†ï¼Œæˆ‘ä»¬æ€»ç»“å‡ºäº†ä¸€äº›å¯ä»¥å¸®åŠ©æå‡æ€§èƒ½çš„JavaScriptç¼–ç¨‹æŠ€å·§ï¼š</p><ul><li>å§‹ç»ˆæŒ‰ç…§ä¸€è‡´çš„æ–¹å¼åˆå§‹åŒ–ä½ çš„å¯¹è±¡ï¼Œè¿™æ ·Shapeä¼šæ›´æœ‰æ•ˆ</li><li>ä¸ºå­—æ®µé€‰æ‹©åˆç†çš„åˆå§‹å€¼ï¼Œä»¥å¸®åŠ©JavaScriptå¼•æ“é€‰æ‹©æœ€ä½³çš„è¡¨ç¤ºã€‚</li></ul><p><br><br><br></p><p><img src="/images/sponsor.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è¯‘æ³¨: åŸæ–‡ä½œè€…æ˜¯&lt;a href=&quot;https://twitter.com/mathias&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Mathias Bynens&lt;/a&gt;, ä»–æ˜¯V8å¼€å‘è€…ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨&lt;a href=&quot;h
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>if æˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿ Leaderï¼Œæ€ä¹ˆåšå¥½æ¦‚è¦è®¾è®¡</title>
    <link href="https://bobi.ink/2019/09/06/fe-design/"/>
    <id>https://bobi.ink/2019/09/06/fe-design/</id>
    <published>2019-09-05T16:00:00.000Z</published>
    <updated>2019-09-07T02:57:07.855Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5d3a7134f265da1b5d57f1ed" target="_blank" rel="noopener">if æˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿ Leaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ?</a>åœ¨æ˜é‡‘ç›®å‰å·²ç»çªç ´740ä¸ªğŸ‘äº†, è°¢è°¢å¤§å®¶çš„æ”¯æŒï¼Œè¿™ç¯‡æ–‡ç« æ˜¯å‰è€…å»¶å±•ã€‚ç»§ç»­ä»‹ç»æˆ‘åœ¨å‰ç«¯å›¢é˜Ÿç®¡ç†æ–¹é¢çš„æ€è€ƒå’Œæ¢ç´¢ã€‚</p><p>è½¯ä»¶å·¥ç¨‹ä¸­æœ‰ä¸€ä¸ªè½¯ä»¶è®¾è®¡é˜¶æ®µï¼Œé€šä¿—çš„è®²å°±æ˜¯åœ¨å¼€å·¥ä¹‹å‰å°†èƒ½ç¡®å®šçš„ç¡®å®šä¸‹æ¥ï¼ŒæŠŠè¯¥è€ƒè™‘çš„è€ƒè™‘äº†ã€‚è¿™ç›¸æ¯”åœ¨å¼€å‘é˜¶æ®µå‘ç°é—®é¢˜ï¼Œè§£å†³çš„æˆæœ¬è¦ä½å¾ˆå¤šã€‚</p><p>å¦‚æœæŒ‰ç…§æ•™ç§‘ä¹¦ä¸Šçš„å®šä¹‰ï¼Œè½¯ä»¶è®¾è®¡å°±æ˜¯<strong>æ˜¯ä¸€ä¸ªå°†éœ€æ±‚è½¬å˜ä¸ºè½¯ä»¶é™ˆè¿°ï¼ˆè¡¨è¾¾ï¼‰çš„è¿‡ç¨‹</strong>ã€‚ä¸€èˆ¬æœ‰<strong>æ¦‚è¦è®¾è®¡(æˆ–è€…åˆæ­¥è®¾è®¡ï¼Œ Preliminary design)</strong>å’Œ<strong>è¯¦ç»†è®¾è®¡(Detail design)</strong>. æ¦‚è¦è®¾è®¡å°†éœ€æ±‚è½¬æ¢æˆæ•°æ®å’Œè½¯ä»¶æ¡†æ¶ï¼Œè€Œè¯¦ç»†è®¾è®¡å°†æ¡†æ¶é€æ­¥æ±‚ç²¾ç»†åŒ–ä¸ºå…·ä½“çš„æ•°æ®ç»“æ„å’Œè½¯ä»¶çš„ç®—æ³•è¡¨è¾¾ã€‚æœ¬æ–‡è®²è¿°çš„æ˜¯å‰ç«¯é¡¹ç›®çš„æ¦‚è¦è®¾è®¡ã€‚</p><p>ç›¸æ¯”åç«¯å¼€å‘, å¯¹äºå‰ç«¯ï¼Œâ€™è½¯ä»¶è®¾è®¡â€˜å¾ˆå°‘è¢«æåŠï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€ç›´ä»¥æ¥å‰ç«¯çš„å·¥ä½œéƒ½æ¯”è¾ƒâ€™ç®€å•â€™ï¼Œæ‰€ä»¥æ¯”è¾ƒç²—æ”¾ã€‚ä¸€èˆ¬ç»™äº†åŸå‹å’Œæ¥å£æ–‡æ¡£å°±ç›´æ¥å¼€å¹²äº†ã€‚ä½†æ˜¯éšç€å‰ç«¯å¼€å‘è€…çš„å·¥ä½œè¶Šæ¥è¶Šå¤æ‚ï¼Œæˆ–è€…é¡¹ç›®/å›¢é˜Ÿçš„è§„æ¨¡å˜å¤§ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šéœ€è¦åœ¨ç¼–ç ä¹‹å‰è¿›è¡Œåˆç†çš„è®¾è®¡ã€‚</p><p>ä½œä¸º<strong>å‰ç«¯å…¥é—¨Leader</strong>, æœ€è¿‘é¢ä¸´äº†ä¸€äº›é—®é¢˜: æ¯”å¦‚é¡¹ç›®åˆ†å·¥é—®é¢˜ã€é¡¹ç›®ç»´æŠ¤ç¼ºä¹æ–‡æ¡£é—®é¢˜, è®©æˆ‘å¼€å§‹é‡è§†è½¯ä»¶è®¾è®¡é˜¶æ®µ. å°±ç›®å‰çœ‹æ¥ï¼Œåšå¥½å‰ç«¯<strong>æ¦‚è¦è®¾è®¡</strong>ï¼Œè‡³å°‘æœ‰ä»¥ä¸‹å¥½å¤„:</p><ul><li><strong>äº‹å‰</strong>. è®¾è®¡æ–‡æ¡£æ˜¯å¼€å‘çš„è“å›¾ï¼Œåç»­å¼€å‘å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ–‡æ¡£é€æ­¥å±•å¼€ã€‚è‰¯å¥½çš„è®¾è®¡å¯ä»¥ä¿è¯å¼€å‘æ²¿ç€æ­£å¸¸è½¨é“è¿ˆè¿›ã€‚<ul><li>æˆ‘ä»¬åœ¨è®¾è®¡é˜¶æ®µä¼šè¿›ä¸€æ­¥æ¢³ç†ä¸šåŠ¡æµç¨‹ï¼ŒåŠ æ·±å¯¹ä¸šåŠ¡æµç¨‹çš„ç†è§£ï¼Œç”šè‡³å¯ä»¥æ‰¾å‡ºä¸šåŠ¡æµç¨‹ä¸­çš„ä¸åˆç†çš„ä¸œè¥¿ã€‚</li><li>æ¨¡å—æ‹†åˆ†ã€‚è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬ä¼šè¯†åˆ«å„ä¸ªæ¨¡å—ä¹‹é—´è¾¹ç•Œå’Œé‡å ï¼Œå°†é‡å çš„(å…±äº«çš„)éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥ã€‚å¦å¤–æ¨¡å—æ˜¯åŸºæœ¬çš„å¼€å‘å·¥ä½œå•å…ƒï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å›¢é˜Ÿåˆ†å·¥å’Œæ—¶é—´è¯„ä¼°çš„åŸºç¡€ã€‚</li><li>è€ƒå¯Ÿå…³é”®çš„æŠ€æœ¯ç‚¹ã€‚æå‡ºå¤šç§å¤‡é€‰æ–¹æ¡ˆï¼Œå……åˆ†è€ƒè™‘å„ç§é£é™©, é€‰æ‹©ç¬¦åˆå®é™…éœ€æ±‚çš„æ–¹æ¡ˆ</li></ul></li><li><strong>äº‹å</strong>. è®¾è®¡æ–‡æ¡£å¯¹äº‹åçš„è½¯ä»¶ç»´æŠ¤ã€åŠŸèƒ½æ–°å¢ï¼Œæœ‰å¾ˆå¤§çš„å¸®åŠ©</li></ul><p><br></p><p>ä¸‹é¢å¼€å§‹ä»‹ç»ï¼Œå‰ç«¯åœ¨<strong>è½¯ä»¶è®¾è®¡é˜¶æ®µ</strong>åº”è¯¥è€ƒè™‘ä¸œè¥¿ï¼Œæˆ–è€…è¯´å‰ç«¯çš„<code>æ¦‚è¦è®¾è®¡æ–‡æ¡£</code>é‡Œé¢åº”è¯¥åŒ…å«å“ªäº›ä¸œè¥¿. å½“ç„¶è¿™äº›åªæ˜¯ä¸€äº›åˆæ­¥çš„æƒ³æ³•ï¼Œéšç€åé¢æ·±å…¥å®è·µåï¼Œæœ¬æ–‡ä¼šæŒç»­æ›´æ–°è¿­ä»£.</p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#å…³é”®ä¸šåŠ¡æµç¨‹çš„æ¢³ç†">å…³é”®ä¸šåŠ¡æµç¨‹çš„æ¢³ç†</a></li><li><a href="#å…³é”®æŠ€æœ¯ç‚¹">å…³é”®æŠ€æœ¯ç‚¹</a></li><li><a href="#æ¨¡å—è®¾è®¡">æ¨¡å—è®¾è®¡</a><ul><li><a href="#å…¥å£å±‚">å…¥å£å±‚</a></li><li><a href="#é¡µé¢å±‚">é¡µé¢å±‚</a></li><li><a href="#ç»„ä»¶å±‚">ç»„ä»¶å±‚</a></li><li><a href="#åˆ†å·¥">åˆ†å·¥</a></li></ul></li><li><a href="#çŠ¶æ€è®¾è®¡">çŠ¶æ€è®¾è®¡</a></li><li><a href="#æ¥å£è®¾è®¡">æ¥å£è®¾è®¡</a></li><li><a href="#ç‰ˆæœ¬è§„åˆ’">ç‰ˆæœ¬è§„åˆ’</a></li><li><a href="#éªŒè¯">éªŒè¯</a></li><li><a href="#é¡¹ç›®è¦æ±‚å’Œç›®æ ‡">é¡¹ç›®è¦æ±‚å’Œç›®æ ‡</a></li><li><a href="#æ–‡æ¡£ç´¢å¼•">æ–‡æ¡£ç´¢å¼•</a></li><li><a href="#æ„å»ºè¯´æ˜">æ„å»ºè¯´æ˜</a></li><li><a href="#æŒç»­è¿­ä»£">æŒç»­è¿­ä»£</a></li><li><a href="#æ¨¡æ¿">æ¨¡æ¿</a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li><li><a href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><p><br></p><blockquote><p>è¿™æ–¹é¢æˆ‘çš„ç»éªŒå®è·µæ¯”è¾ƒå°‘, ä¹Ÿæ²¡æœ‰åœ¨å¤§å‚å¾…è¿‡ï¼Œæ‰€ä»¥æœ¬æ–‡åªæ˜¯æˆ‘çš„ä¸€äº›æ€è€ƒå’Œå°è¯•, å¯èƒ½ä¸å¤ªç°å®ã€‚å¦‚æœä½ æˆ–ä½ çš„å›¢é˜Ÿæœ‰è¿™æ–¹é¢çš„æ›´å¥½çš„å®è·µï¼Œæ¬¢è¿åˆ†äº«ç»™æˆ‘ã€‚æ„Ÿæ¿€ğŸ™</p></blockquote><p><br><br><br></p><h2 id="å…³é”®ä¸šåŠ¡æµç¨‹çš„æ¢³ç†"><a href="#å…³é”®ä¸šåŠ¡æµç¨‹çš„æ¢³ç†" class="headerlink" title="å…³é”®ä¸šåŠ¡æµç¨‹çš„æ¢³ç†"></a>å…³é”®ä¸šåŠ¡æµç¨‹çš„æ¢³ç†</h2><p>å¼€å‘ä»»ä½•ä¸€ä¸ªäº§å“ä¹‹å‰ï¼Œé¦–å…ˆè¦ç¡®ä¿çš„æ˜¯å¯¹ä¸šåŠ¡æµç¨‹çš„ç†è§£ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å—è¾•åŒ—è¾™çš„æƒ…å†µã€‚</p><p>åœ¨ç°å®é¡¹ç›®ä¸­å‘ç”Ÿè¿‡å¤šæ¬¡è¿™ç±»æƒ…å†µï¼š<em>é¡¹ç›®åˆ°è¾¾æµ‹è¯•é˜¶æ®µï¼Œæµ‹è¯•äººå‘˜æ‰å‘ç°åº”ç”¨çš„ä¸šåŠ¡å®ç°å’Œäº§å“å®šä¹‰ä¸ä¸€æ ·ï¼Œæˆ–è€…ä¸šåŠ¡æµç¨‹ä¸åˆç†</em>ã€‚<br>è¿™å…¶å®æ˜¯ä¸€ç§å¾ˆä½çº§çš„å¤±è¯¯ï¼Œæ”¹åŠ¨çš„æˆæœ¬å¯èƒ½å¾ˆé«˜ï¼Œç”šè‡³ä¼šè®©ä½ çš„æ‰€æœ‰å·¥ä½œç™½å¹²ã€‚</p><p>ç®¡ç†æ¯”è¾ƒæˆç†Ÿçš„å…¬å¸ä¼šæœ‰å¾ˆå¤šæ‰‹æ®µæ¥è§„é¿è¿™ç§å¤±è¯¯ã€‚</p><p>æ¯”å¦‚å®šä¹‰æ˜ç¡®éœ€æ±‚æ–‡æ¡£ï¼Œè¿™æ–¹é¢å¯ä»¥æ¨¡ä»¿ä¸€äº›æ ‡å‡†/è§„èŒƒ(Spec)çš„å†™ä½œæ–¹æ³•ï¼Œä¸¥æ ¼å®šä¹‰ä¸€äº›å…³é”®å­—ï¼Œé¿å…æ¨¡æ£±ä¸¤å¯çš„æè¿°;</p><p>å¦å¤–å¯ä»¥é€šè¿‡å„ç§å®£è´¯ä¼šè®®ï¼Œå°†ç›¸å…³äººå‘˜èšé›†åœ¨ä¸€èµ·ï¼Œç»Ÿä¸€å¯¼å…¥éœ€æ±‚ã€‚åœ¨è¿™äº›ä¼šè®®ä¸­å¯ä»¥è¿›è¡Œå¤´è„‘é£æš´ï¼Œä¼˜åŒ–æˆ–ç»†åŒ–éœ€æ±‚çš„å®šä¹‰ã€å‘ç°ç¼ºé™·å’Œé£é™©ï¼Œåˆ†æå¯è¡Œæ€§ç­‰ç­‰ã€‚é€šè¿‡ä¸æ–­æ²Ÿé€šï¼Œæˆå‘˜ä¹‹é—´å¯ä»¥åˆ†äº«äº¤å‰çŸ¥è¯†ï¼Œç¡®ä¿å¯¹ä¸šåŠ¡ä¸€è‡´ç†è§£.</p><p><img src="/images/fe-design/doc.png" alt></p><p><br></p><p>å› æ­¤ï¼Œæˆ‘è§‰å¾—<strong>å‰ç«¯åœ¨è®¾è®¡é˜¶æ®µä¹Ÿåº”è¯¥åƒåç«¯ä¸€æ ·ï¼Œç”¨æµç¨‹å›¾æˆ–è€…æ—¶åºå›¾è¿™ç±»å·¥å…·ï¼Œå°†å…³é”®ä¸šåŠ¡æµç¨‹æè¿°æ¸…æ¥š. å°¤å…¶æ˜¯æ¶‰åŠåˆ°å‰åç«¯, è·¨ç³»ç»Ÿ/è·¨é¡µé¢/è·¨ç»ˆç«¯ä¹‹é—´çš„ä¸šåŠ¡äº¤äº’çš„åœºæ™¯</strong>.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨åšä¸€ä¸ªâ€™æ‰«ç ç™»å½•â€˜åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥å°†è·¨ç»ˆç«¯çš„ä¸šåŠ¡æ¢³ç†å‡ºæ¥ï¼š</p><p><img src="/images/fe-design/scan-login.png" alt></p><p><br></p><p>ä»ä¸Šé¢çš„ä¸šåŠ¡æ¢³ç†ä¸­æˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºä¸šåŠ¡å¯¹è±¡çš„åŸºæœ¬è¡Œä¸ºå’ŒçŠ¶æ€. ä¾‹å¦‚äºŒç»´ç çš„çŠ¶æ€è½¬æ¢å›¾:</p><p><img src="/images/fe-design/scan-login-state.png" alt></p><p><br></p><p>å½“ç„¶, ç®€å•çš„å¢åˆ æŸ¥æ”¹èŠ±ç¯‡å¹…å»é˜è¿°æ²¡æœ‰æ„ä¹‰ã€‚<strong>æˆ‘ä»¬åªå…³æ³¨åº”ç”¨å…³é”®çš„ä¸šåŠ¡æµç¨‹</strong>.</p><p>æ€»ä¹‹ï¼Œä¸šåŠ¡æµç¨‹çš„æ¢³ç†ï¼Œå¯ä»¥åŠ æ·±æˆ‘ä»¬å¯¹ä¸šåŠ¡çš„ç†è§£ï¼Œæ˜¯åç»­è®¾è®¡æ­¥éª¤å’Œå¼€å‘çš„åŸºç¡€.</p><p><br><br><br></p><h2 id="å…³é”®æŠ€æœ¯ç‚¹"><a href="#å…³é”®æŠ€æœ¯ç‚¹" class="headerlink" title="å…³é”®æŠ€æœ¯ç‚¹"></a>å…³é”®æŠ€æœ¯ç‚¹</h2><p>æè¿°åº”ç”¨é‡‡ç”¨çš„æˆ–è€…æ¶‰åŠåˆ°å…³é”®æŠ€æœ¯/ç®—æ³•, ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯<strong>æŠ€æœ¯é€‰å‹</strong>.</p><p>æ¯”å¦‚å…¸å‹çš„æœ‰è§†é¢‘ç›´æ’­åº”ç”¨ï¼Œæ¶‰åŠåˆ°çš„å„ç§ç›´æ’­æ–¹æ¡ˆ:</p><ul><li>RTMP åè®®</li><li>RTPåè®®</li><li>HLS åè®®</li><li>flv.js</li><li>WebRTCåè®®</li><li>ç­‰ç­‰</li></ul><p><strong>åœ¨å¼€å¯ä¸€ä¸ªé¡¹ç›®ä¹‹å‰, æˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®æ¶‰åŠåˆ°çš„å…³é”®æŠ€æœ¯ç‚¹è¿›è¡Œè°ƒç ”å’Œæµ‹è¯•ï¼Œæœ€å¥½å¤šæ‰¾å‡ ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œæ¨ªå‘åœ°æ¯”è¾ƒå®ƒä»¬çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿</strong>ã€‚é€‰æ‹©ç¬¦åˆé¡¹ç›®æˆ–å›¢é˜Ÿè‡ªå·±æƒ…å†µçš„æ–¹æ¡ˆ. å¦‚æœæ—¶é—´å……è¶³, å¯ä»¥å†™ä¸€äº›Demoï¼Œå®åœ°è¸©ä¸€ä¸‹å‘.</p><p>å¦‚æœæœ‰å¤šä¸ªå¤‡é€‰æ–¹æ¡ˆï¼Œæœ€åè¦ç”„é€‰å‡ºæ¨èæ–¹æ¡ˆï¼Œå¹¶è¯´æ˜é€‰æ‹©çš„åŸå› å’Œè€ƒè™‘ã€‚</p><p><strong>æå‰åšå¥½æŠ€æœ¯çš„è°ƒç ”å’Œé€‰å‹ï¼Œç¡®å®šå¯è¡Œæ€§ï¼Œä¸è‡³äºå¼€å‘å¤„äºè¢«åŠ¨çš„å¢ƒåœ°</strong>.</p><p>å…³äºå¦‚ä½•è¿›è¡ŒæŠ€æœ¯é€‰å‹ï¼Œæˆ‘åœ¨<a href="https://juejin.im/post/5d3a7134f265da1b5d57f1ed#heading-10" target="_blank" rel="noopener">if æˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿ Leaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ?</a>è¿›è¡Œäº†ç®€å•çš„è®¨è®ºï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹.</p><p><br><br><br></p><h2 id="æ¨¡å—è®¾è®¡"><a href="#æ¨¡å—è®¾è®¡" class="headerlink" title="æ¨¡å—è®¾è®¡"></a>æ¨¡å—è®¾è®¡</h2><p>ç°ä»£å‰ç«¯ä¸€èˆ¬éƒ½ä½¿ç”¨<strong>ç»„ä»¶åŒ–æ€ç»´</strong>è¿›è¡Œå¼€å‘ï¼Œ<strong>è¿™æ—¶å€™æˆ‘ä»¬çš„åº”ç”¨å…¶å®å°±æ˜¯ä¸€é¢—ç”±ä¸åŒç²’åº¦çš„ç»„ä»¶å¤åˆèµ·æ¥çš„ç»„ä»¶æ ‘</strong>ï¼Œè¿™é¢—ç»„ä»¶æ ‘æœ€ç»ˆä¼šä½“ç°åˆ°é¡¹ç›®çš„ç›®å½•ç»“æ„ä¸Šã€‚ <strong>åœ¨è®¾è®¡é˜¶æ®µæˆ‘ä»¬å¯ä»¥æ ¹æ®äº§å“åŸå‹æˆ–UIè®¾è®¡ç¨¿ï¼Œè¯†åˆ«å‡ºå„ç§é¡µé¢å’Œç»„ä»¶</strong>ã€‚</p><p><img src="/images/fe-design/module-tree-map.png" alt></p><p>æ­£å¸¸çš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸‰ä¸ªå±‚çº§è¿›è¡Œæ‹†åˆ†:</p><p><img src="/images/fe-design/module.png" alt></p><h3 id="å…¥å£å±‚"><a href="#å…¥å£å±‚" class="headerlink" title="å…¥å£å±‚"></a>å…¥å£å±‚</h3><p>ç¨å¾®å¤æ‚ä¸€ç‚¹çš„åº”ç”¨å¯èƒ½æœ‰å¤šä¸ªå…¥å£ï¼Œè¿™äº›å…¥å£å‘ˆç°çš„é¡µé¢å¯èƒ½å·®å¼‚å¾ˆå¤§. ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¸è§çš„åˆ’åˆ†æ–¹æ³•:</p><ul><li>æŒ‰å­ç³»ç»Ÿåˆ’åˆ†: æ¯”å¦‚å‰å°å’Œåå°ã€‚</li><li>æŒ‰è§’è‰²åˆ’åˆ†ï¼šæ¯”å¦‚ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·</li><li>æŒ‰å…¥å£åˆ’åˆ†ï¼šæ¯”å¦‚ç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯ç­‰ç­‰</li></ul><p><br></p><h3 id="é¡µé¢å±‚"><a href="#é¡µé¢å±‚" class="headerlink" title="é¡µé¢å±‚"></a>é¡µé¢å±‚</h3><p>ä¸‹ä¸€æ­¥å°±æ˜¯è¯†åˆ«å„ç§é¡µé¢ï¼Œè¿™äº›é¡µé¢å³å¯¹åº”åˆ°æˆ‘ä»¬çš„å‰ç«¯è·¯ç”±é…ç½®è§„åˆ™. ä»¥ä¸‹é¢ç®€å•çš„åº”ç”¨ä¸ºä¾‹:</p><p><img src="/images/fe-design/sample-pages.png" alt></p><p>å…³äºæ¨¡å—çš„åˆ’åˆ†ï¼Œæˆ‘å»ºè®®ä½¿ç”¨<strong>æ€ç»´å¯¼å›¾</strong>è¿›è¡Œç»„ç»‡ã€‚<strong>æ¨¡å—åˆ’åˆ†è¿™ä¸ªç¯èŠ‚ï¼Œä½ å¯ä»¥å¬é›†å›¢é˜Ÿçš„å…¶ä»–æˆå‘˜å¼€ä¸ªä¼šè®®ï¼Œä¸€èµ·è¿›è¡Œå¤´è„‘é£æš´ã€‚å¤§å®¶å‚ç…§ç€äº§å“åŸå‹ï¼Œè¯†åˆ«å‡ºå„ç§æ¨¡å—æˆ–ç»„ä»¶çš„è¾¹ç•Œå’Œäº¤é›†, è®¨è®ºæ€ä¹ˆè®¾è®¡é¡µé¢çš„æ•°æ®æµã€ç»„ä»¶çš„æ¥å£ç­‰ç­‰</strong>, è¿™æ ·å¯ä»¥åˆ©ç”¨é›†ä½“æ™ºæ…§ï¼Œè®©æ¨¡å—æ‹†åˆ†æ›´åŠ åˆç†ï¼Œå¦å¤–å¯ä»¥ä¿ƒè¿›å›¢é˜Ÿæˆå‘˜æå‰ç†Ÿæ‚‰é¡¹ç›®çš„ç»“æ„ã€‚</p><p>æ‰€ä»¥è¯´<strong>è½¯ä»¶è®¾è®¡ä¸æ˜¯æ¶æ„å¸ˆæˆ–è®¾è®¡äººå‘˜ä¸€ä¸ªäººçš„äº‹ï¼Œåº”è¯¥é¼“åŠ±å¤§å®¶ä¸€èµ·å‚ä¸ï¼Œè®¾è®¡æ–‡æ¡£æ˜¯æ•´ä¸ªè½¯ä»¶å›¢é˜Ÿçš„äº§å‡º, æ˜¯å›¢é˜Ÿçš„çŸ¥è¯†æ²‰æ·€</strong>ã€‚</p><p>ä¸Šé¢çš„åº”ç”¨é€šè¿‡é¡µé¢å±‚åˆ’åˆ†åï¼Œç»“æœå¤§æ¦‚å¦‚ä¸‹ï¼š</p><p><img src="/images/fe-design/pages.png" alt></p><p>åœ¨è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬ä¼šç¡®å®šä»¥ä¸‹å†…å®¹:</p><ul><li><strong>é¡µé¢ä»¥åŠè·¯ç”±è®¾è®¡, ç¡®å®šé¡µé¢ä¹‹é—´çš„å±‚çº§å…³ç³»</strong></li><li><strong>é¡µé¢ä¹‹é—´äº¤äº’æµç¨‹ã€æ•°æ®ä¼ é€’</strong></li></ul><p><strong>å…³äºè·¯ç”±è®¾è®¡ï¼Œå¯ä»¥éµå¾ªä¸€äº›è§„èŒƒï¼Œç¬”è€…æ¯”è¾ƒæ¨è<a href="http://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html" target="_blank" rel="noopener">Restful URLè§„èŒƒ</a></strong>, è¿™ç¯‡<a href="https://novoland.github.io/è®¾è®¡/2015/08/17/Restful%20API%20çš„è®¾è®¡è§„èŒƒ.html" target="_blank" rel="noopener">æ–‡ç« </a>å†™å¾—ä¹Ÿä¸é”™.</p><p>è·¯ç”±ä¹‹é—´çš„æ•°æ®ä¼ é€’ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼:</p><ul><li>å°‘é‡æ•°æ®ï¼šå¯ä»¥é€šè¿‡è·¯ç”±å˜é‡(ä¾‹å¦‚<code>/posts/:id</code>)æˆ–è€…æŸ¥è¯¢å­—ç¬¦ä¸²å½¢å¼ä¼ é€’. è¿˜æœ‰å¦‚æœä½ ä½¿ç”¨çš„æ˜¯<a href="https://react-router.docschina.org/web/api/BrowserRouter" target="_blank" rel="noopener">åŸºäºHistory APIçš„å‰ç«¯è·¯ç”±æ¨¡å¼</a>ï¼Œå¯ä»¥ä½¿ç”¨Historyçš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">state</a>å¯¹è±¡æ¥å­˜å‚¨ä¸€äº›çŠ¶æ€(æœ€å¤§640k)</li><li>å¤§é‡æ•°æ®ï¼šå¯ä»¥é€šè¿‡å…¨å±€å˜é‡ï¼Œæˆ–è€…çŠ¶æ€ç®¡ç†å™¨çš„æœºåˆ¶è¿›è¡Œå­˜å‚¨, ä¸ç®¡è¿™ç§å­˜å‚¨åœ¨å†…å­˜çš„æ–¹å¼ï¼Œä¸€æ—¦é¡µé¢åˆ·æ–°å°±ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥è€ƒè™‘å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­, ä¾‹å¦‚LocalStorage</li></ul><p><br></p><h3 id="ç»„ä»¶å±‚"><a href="#ç»„ä»¶å±‚" class="headerlink" title="ç»„ä»¶å±‚"></a>ç»„ä»¶å±‚</h3><p>Okï¼Œå†å¾€ä¸‹æ‹†åˆ†ï¼Œä¸è¿‡è¦é‡åŠ›è€Œè¡Œã€‚å¯¹äºä¸€ä¸ªéå¸¸å¤æ‚çš„é¡¹ç›®æ¥è¯´ï¼Œå¯èƒ½æœ‰æˆåƒä¸Šç™¾ä¸ªç»„ä»¶ï¼Œè€Œä¸”è¿™äº›ç»„ä»¶åœ¨æœªæ¥å¯èƒ½ä¼šä¸æ–­å˜åŒ–ï¼Œåœ¨è®¾è®¡é˜¶æ®µè€ƒè™‘è¿™äº›æ‹†åˆ†å¯èƒ½éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œè€Œä¸”æ”¶ç›Šå¹¶ä¸æ˜æ˜¾ã€‚</p><p>é‚£ä¹ˆéœ€è¦æ€ä¹ˆæŠŠæ¡ç²’åº¦å‘¢ï¼Ÿå…¶å®ç»„ä»¶å±‚è®¾è®¡é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯<strong>æ‰¾å‡ºé‡å¤çš„ã€æˆ–è€…ç»“æ„ç±»ä¼¼çš„ç»„ä»¶ï¼Œå°†å®ƒä»¬æŠ½å–å‡ºæ¥ç»Ÿä¸€çš„è®¾è®¡ï¼Œåœ¨å¤šä¸ªé¡µé¢è¿›è¡Œå¤ç”¨. å¹¶ä¸æ˜¯æŠŠæ‰€æœ‰çš„ç»„ä»¶éƒ½åˆ—ä¸¾å‡ºæ¥</strong>ã€‚</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cd8fb916fb9a03218556fc1" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“02 - ç»„ä»¶çš„ç»„ç»‡</a>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¸“é—¨ä»‹ç»Reactç»„ä»¶å¦‚ä½•è¿›è¡Œç»„ç»‡å’Œæ‹†åˆ†ã€‚å…¶ä¸­æå‡ºäº†ä»¥ä¸‹é›†ä¸­æ¨¡å¼:</p><ul><li>å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»ã€‚æˆ–è€…è¯´åˆ†ç¦»è§†å›¾å’Œé€»è¾‘, ä¸šåŠ¡ç»„ä»¶å’Œå‚»ç“œç»„ä»¶. çº¯é€»è¾‘çš„ä¸œè¥¿æ”¾åœ¨Hooksä¸­ï¼Œä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿</li><li>çº¯ç»„ä»¶å’Œéçº¯ç»„ä»¶. å¯ä»¥è®¤ä¸ºçº¯ç»„ä»¶å®Œå…¨ä¾èµ–å¤–éƒ¨è¾“å…¥</li><li>æœ‰çŠ¶æ€ç»„ä»¶å’Œæ— çŠ¶æ€ç»„ä»¶</li><li>å¸ƒå±€ç»„ä»¶å’Œå†…å®¹ç»„ä»¶</li><li>ç»Ÿä¸€è®¾è®¡åŒä¸€ç±»å‹ç»„ä»¶çš„æ¥å£. æ¯”å¦‚è¡¨å•ç»„ä»¶åº”è¯¥ä¿æŒæ¥å£ç»Ÿä¸€</li></ul><p><img src="/images/fe-design/sample-pages2.png" alt></p><p>è¿˜æ˜¯ä¸Šé¢çš„ç¤ºä¾‹åº”ç”¨ï¼Œç”³æŠ¥é¡µé¢æœ‰éå¸¸å¤šçš„è¡¨å•é¡¹ï¼Œè€Œä¸”ç»å¸¸å˜åŠ¨ï¼Œå¦å¤–ä½ ä¼šå‘ç°å®ƒå’Œé¢„è§ˆé¡µé¢çš„ç»“æ„æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œä¸”åé¢å¯èƒ½ä¼šæœ‰æ¡Œé¢ç«¯é¡µé¢ã€‚</p><p>ç»è¿‡è®¨è®ºï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥åŠ¨æ€æ¸²æŸ“è¡¨å•é¡µå’Œé¢„è§ˆé¡µã€‚å®ç°ä¸€å¥—é…ç½®æ§åˆ¶ç§»åŠ¨ç«¯ç”³è¯·è¡¨å•ã€æ¡Œé¢ç«¯ç”³è¯·è¡¨å•ã€ç§»åŠ¨ç«¯é¢„è§ˆã€æ¡Œé¢ç«¯é¢„è§ˆé¡µé¢ã€‚</p><p>ç±»ä¼¼ä¸Šé¢è¿™ç§åº”ç”¨åœºæ™¯ï¼Œå‰æœŸçš„ç»„ä»¶å±‚è®¾è®¡å°±å¾ˆæœ‰å¿…è¦äº†ã€‚</p><p><br></p><p><img src="/images/fe-design/components.png" alt></p><p><br></p><h3 id="åˆ†å·¥"><a href="#åˆ†å·¥" class="headerlink" title="åˆ†å·¥"></a>åˆ†å·¥</h3><p>å°†æ¨¡å—æ‹†åˆ†æ¸…æ¥šåï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹è¿™äº›æ¨¡å—è¿›è¡Œåˆç†çš„åˆ†å·¥å’Œæ—¶é—´è¯„ä¼°ã€‚åŸºæœ¬ä¸Šæœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><p><img src="/images/fe-design/module-plan.png" alt></p><p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬è¯†åˆ«å‡ºæ¥äº†å„ç§æ¨¡å—ï¼Œæ¥ç€æˆ‘ä»¬è¦ç¡®å®šä¸‹æ¥è¿™äº›æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿™äº›ä¾èµ–å…³ç³»å½±å“å®ƒä»¬æ˜¯å¦è¦ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œå®ç°ã€‚æœ€åå†æ ¹æ®ä¸šåŠ¡çš„ä¼˜å…ˆçº§æˆ–ä¾èµ–å…³ç³»å†³å®šè¿™äº›<strong>æ¨¡å—ç°‡</strong>çš„å®ç°ä¼˜å…ˆçº§ã€‚</p><p>Ok, ç°åœ¨å¯ä»¥å°†è¿™äº›æ¨¡å—ç°‡æŒ‰ç…§ä¼˜å…ˆçº§æ’åº, åŠ ä¸Šè¯„ä¼°æ—¶é—´(äººå¤©)ï¼Œæ•´ç†æˆä¸€ä¸ªæ¸…å•ã€‚ å¦‚æœä½ ä»¬ä½¿ç”¨çœ‹æ¿æ¥è¿›è¡Œé¡¹ç›®ç®¡ç†, å¯ä»¥å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªä»»åŠ¡å•å…ƒï¼Œè´´åˆ°çœ‹æ¿ä¸­.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1. Foo åŠŸèƒ½</span><br><span class="line">  - c 2d</span><br><span class="line">  - d 1d</span><br><span class="line">  - f 3d</span><br><span class="line">2. Bar åŠŸèƒ½</span><br><span class="line">  - e 1d</span><br><span class="line">  - h 0.5d</span><br><span class="line">3. Baz åŠŸèƒ½</span><br><span class="line">  - g 1d</span><br><span class="line">4. Fu åŠŸèƒ½</span><br><span class="line">  - a 4d</span><br><span class="line">  - b 1d</span><br><span class="line"></span><br><span class="line">æ€»è®¡äººå¤©: 13.5</span><br></pre></td></tr></table></figure><p><br></p><p>ä»»åŠ¡çš„åˆ†å·¥æœ‰å¾ˆå¤šç­–ç•¥, ä¾‹å¦‚ï¼š</p><ul><li>æ¨ªå‘åˆ’åˆ†<ul><li>å…¬å…±ç»„ä»¶ vs ä¸šåŠ¡ç»„ä»¶(å¯¹æ¥ä¸šåŠ¡)</li><li>è‡ªä¸Šè€Œä¸‹ vs è‡ªä¸‹è€Œä¸Š(æŒ‡çš„æ˜¯ç»„ä»¶æ ‘)</li></ul></li><li>å‚ç›´åˆ’åˆ†: æŒ‰ç…§ç‹¬ç«‹çš„å‚ç›´æ¨¡å—åˆ†å·¥</li></ul><p><img src="/images/fe-design/module-tree.png" alt></p><p><br><br><br></p><h2 id="çŠ¶æ€è®¾è®¡"><a href="#çŠ¶æ€è®¾è®¡" class="headerlink" title="çŠ¶æ€è®¾è®¡"></a>çŠ¶æ€è®¾è®¡</h2><p><img src="/images/fe-design/redux.png" alt></p><p>å‰ç«¯ç»„ä»¶åŒ–ä¼´éšè€Œæ¥çš„æ˜¯å„ç§<code>æ•°æ®é©±åŠ¨</code>æˆ–<code>æ•°æ®æµé©±åŠ¨</code>çš„å¼€å‘æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œå‰ç«¯åº”ç”¨å¯ä»¥æ€»ç»“ä¸ºè¿™æ ·ä¸€ä¸ªç­‰å¼:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view = f(state)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´<strong>è§†å›¾æ˜¯æ•°æ®æˆ–è€…æ•°æ®æµçš„æ˜ å°„</strong>. å¯è§çŠ¶æ€ç®¡ç†å¯¹ç°ä»£å‰ç«¯å¼€å‘çš„é‡è¦æ€§ã€‚</p><p>çŠ¶æ€çš„è®¾è®¡å’Œåç«¯å¯¹è±¡æ¨¡å‹è®¾è®¡å·®ä¸å¤šã€‚<strong>ä½ éœ€è¦æ ¹æ®ä¸šåŠ¡å’Œé¡µé¢æ¸²æŸ“è¦æ±‚æŠ½è±¡å‡ºå„ç§å¯¹è±¡æ¨¡å‹ï¼Œä»¥åŠç¼•æ¸…å¯¹è±¡æ¨¡å‹ä¹‹é—´çš„å…³ç³»</strong>ã€‚è¿™ä¸ªé˜¶æ®µå¯èƒ½éœ€è¦å’Œåç«¯ç´§å¯†ç»“åˆï¼Œæ‰èƒ½ç¡®å®šå‡ºåˆç†çš„å¯¹è±¡ç»“æ„ã€‚</p><p>å½“ç„¶çŠ¶æ€çš„è®¾è®¡è¿˜è·Ÿä½ é€‰æ‹©çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆä¹Ÿæœ‰å…³ç³», ä¸åŒçŠ¶æ€ç®¡ç†å™¨æ–¹æ¡ˆä½“ç°çš„æ€æƒ³å·®å¼‚è¾ƒå¤§ï¼š<em>å¦‚æœä½ é€‰æ‹©Reduxï¼Œé‚£ä¹ˆåº”ç”¨çš„çŠ¶æ€å°±æ˜¯ä¸€é¢—å¯¹è±¡æ ‘ï¼›å¦‚æœä½ é€‰æ‹©Mobxï¼Œåº”ç”¨çš„çŠ¶æ€å¯èƒ½ç”±å¤šä¸ªæ¨¡å‹å¯¹è±¡ç»„æˆï¼Œæ›´æ¥è¿‘ä¼ ç»Ÿçš„OOPæ¨¡å¼</em>ã€‚</p><p>å¦‚æœé‡‡ç”¨OOPè®¾è®¡æ–¹æ³•ï¼Œå¯ä»¥ç»˜åˆ¶<code>UML</code>å›¾ï¼Œå¯è§†åŒ–è¡¨ç°å¯¹è±¡çš„ç»“æ„å’Œå…³ç³»:</p><p><img src="/images/fe-design/uml-sample.png" alt><br><i>(å›¾ç‰‡æ¥æº: <a href="https://zongren.me/2016/12/30/uml-diagram-sample/" target="_blank" rel="noopener">https://zongren.me/2016/12/30/uml-diagram-sample/</a>)</i></p><p><br></p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5ce3ee436fb9a07f070e0220" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“05 - çŠ¶æ€ç®¡ç†</a>è¿™ç¯‡æ–‡ç« èŠ±äº†å¾ˆå¤šç¯‡å¹…æ¥ä»‹ç»å„ç§çŠ¶æ€ç®¡ç†å™¨çš„æ€æƒ³å’Œå¼€å‘æ¨¡å¼, æ‰€ä»¥è¿™é‡Œå°±ä¸å±•å¼€äº†:</p><p><strong>Redux çŠ¶æ€è®¾è®¡</strong>:</p><p><img src="/images/fe-design/redux-design.png" alt></p><p><strong>Mobx çŠ¶æ€è®¾è®¡</strong>:</p><p><img src="/images/fe-design/mobx-design.png" alt></p><p><br><br><br></p><h2 id="æ¥å£è®¾è®¡"><a href="#æ¥å£è®¾è®¡" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h2><p>å¦‚æœå‰ç«¯å›¢é˜Ÿåœ¨æ¥å£è®¾è®¡æ–¹é¢æœ‰ä¸»å¯¼æƒ, æˆ–è€…ä½¿ç”¨<a href="https://www.phodal.com/blog/architecture-101-bff-for-legacy-system-migrate/" target="_blank" rel="noopener">BFFæ¶æ„(æœåŠ¡äºå‰ç«¯çš„åç«¯)</a>ï¼Œåœ¨è®¾è®¡é˜¶æ®µæˆ‘ä»¬éœ€è¦å¯¹å„ç±»æ¥å£è¿›è¡Œè®¾è®¡ã€‚</p><p>ä¸è¿‡ä¸€èˆ¬ä¸»å¯¼æƒéƒ½æŒæ¡åœ¨åç«¯æ‰‹é‡Œï¼Œå› ä¸ºå‰ç«¯å¯¹ä¸šåŠ¡çš„å…³å¿ƒç¨‹åº¦è¾ƒä½ï¼Œåç«¯ä¸€èˆ¬ä¼šç»¼åˆè€ƒè™‘å„ç«¯çš„æ¥å£éœ€æ±‚ã€æ•°æ®åº“å­˜å‚¨æ•ˆç‡ã€å¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªæ–¹é¢æ¥è®¾è®¡æ¥å£, è¿™æ—¶å€™å‰ç«¯å°±æ˜¯æ¥å£çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬æœ‰è´£ä»»æ¥éªŒè¯åç«¯æ¥å£æ˜¯å¦ç¬¦åˆéœ€æ±‚.</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5d3a7134f265da1b5d57f1ed#heading-45" target="_blank" rel="noopener">if æˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿ Leaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ?</a>å·²ç»æåŠäº†å„ç§æ¥å£è§„èŒƒ. è¿™é‡Œä¸äºˆèµ˜è¿°ã€‚</p><p><br><br><br></p><h2 id="ç‰ˆæœ¬è§„åˆ’"><a href="#ç‰ˆæœ¬è§„åˆ’" class="headerlink" title="ç‰ˆæœ¬è§„åˆ’"></a>ç‰ˆæœ¬è§„åˆ’</h2><p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬åŸºæœ¬å·²ç»äº†è§£æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆã€éœ€è¦èŠ±å¤šä¹…ã€‚æ¥ä¸‹æ¥ï¼Œ</p><p>åº”è¯¥åˆ¶å®šä¸€ä¸ªç‰ˆæœ¬è®¡åˆ’ï¼Œå¯¹äºä¸€ä¸ªå¤§é¡¹ç›®å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ª<strong>é‡Œç¨‹ç¢‘</strong>, ä¼°è®¡ç‰ˆæœ¬å‘å¸ƒçš„æ—¶é—´. åŠ ä¸åŠ ç­å°±çœ‹ä½ äº†ï¼Œä½œä¸ºLeaderè¦ç»¼åˆè€ƒè™‘å„ç§å½±å“å› ç´ ï¼Œå®äº‹æ±‚æ˜¯åˆç†åœ°å®‰æ’ç‰ˆæœ¬å‘å¸ƒè®¡åˆ’ã€‚</p><p>è¿™ä¸ªå‘å¸ƒè®¡åˆ’å¯èƒ½è¿˜éœ€è¦ç»è¿‡PMå’Œé¡¹ç›®ç»ç†å®¡æ ¸, ä½œä¸ºå‰ç«¯é¡¹ç›®ï¼Œå¼€å‘è®¡åˆ’é€šå¸¸è¿˜ä¾èµ–äºåç«¯å›¢é˜Ÿ.</p><p><img src="/images/fe-design/roadmap.png" alt></p><p><br></p><p>è¿™ä¸ªç‰ˆæœ¬è®¡åˆ’ä¸­ä¼šåŒ…å«è¿™äº›å†…å®¹:</p><ul><li>ç‰ˆæœ¬å·</li><li>å‘å¸ƒæ—¶é—´</li><li>åŒ…å«çš„ä¸»è¦æ¨¡å—</li></ul><p><br><br><br></p><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>éªŒè¯ï¼Œæˆ–è€…ç§°ä¸ºâ€™æµ‹è¯•æŒ‡å¯¼â€˜ã€‚ é™¤äº†æµ‹è¯•å›¢é˜Ÿæä¾›çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä»å¼€å‘(ç™½ç›’)çš„è§’åº¦è¿˜éœ€è¦æ³¨æ„å“ªäº›ä¸œè¥¿?</p><p>äº§å“æˆ–è€…æµ‹è¯•å¯èƒ½åªä¼šä»ä¸šåŠ¡çš„å±‚æ¬¡è€ƒè™‘åº”ç”¨çš„è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦ä»ç ”å‘çš„è§’åº¦ï¼Œå……åˆ†è€ƒè™‘å„ç§<strong>å¼‚å¸¸æƒ…å†µ</strong>ã€<strong>æ€§èƒ½ç“¶é¢ˆ</strong>ã€è¿›è¡Œ<strong>é£é™©è¯„ä¼°</strong>. é˜æ˜é£é™©çš„åº”å¯¹æ–¹æ¡ˆç­‰å¾….</p><p>è¿™äº›æƒ…å†µä¹Ÿå¯ä»¥åé¦ˆç»™æµ‹è¯•å›¢é˜Ÿï¼Œä»¥å®Œå–„æµ‹è¯•çš„ç”¨ä¾‹.</p><p><br></p><h2 id="é¡¹ç›®è¦æ±‚å’Œç›®æ ‡"><a href="#é¡¹ç›®è¦æ±‚å’Œç›®æ ‡" class="headerlink" title="é¡¹ç›®è¦æ±‚å’Œç›®æ ‡"></a>é¡¹ç›®è¦æ±‚å’Œç›®æ ‡</h2><p>ä¸€äº›éœ€æ±‚æ˜¯è¦æå‰ç¡®å®šä¸‹æ¥çš„ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ï¼Œæ¯”è¾ƒå…¸å‹çš„å°±æ˜¯æµè§ˆå™¨å…¼å®¹æ€§è¦æ±‚ã€‚ä½ å¯ä¸è¦ç­‰åˆ°é¡¹ç›®ä¸Šçº¿åï¼Œæ‰è·Ÿæˆ‘æç”¨æˆ·è¦æ±‚å…¼å®¹IE6!</p><p>è¿™äº›é¡¹ç›®è¦æ±‚å¯èƒ½ä¼šå½±å“æˆ‘ä»¬çš„å¼€å‘æˆæœ¬ã€é€‰å‹ã€æµ‹è¯•å’Œå…¶ä»–å› ç´ çš„è¯„ä¼°ã€‚åŸºæœ¬ä¸Šï¼Œå¯¹äºä¸€ä¸ªå‰ç«¯é¡¹ç›®æ¥è¯´ï¼Œè¿™äº›è¦æ±‚æ˜¯è¦æå‰é—®æ¸…æ¥šçš„:</p><ul><li>æµè§ˆå™¨å…¼å®¹æ€§</li><li>è¿è¡Œç¯å¢ƒ. ä¾‹å¦‚æ“ä½œç³»ç»Ÿã€å°ç¨‹åºç­‰ç­‰</li><li>æ—¶é—´ç‚¹</li><li>æ€§èƒ½æŒ‡æ ‡è¦æ±‚. ä¾‹å¦‚é¦–å±æŒ‡æ ‡ã€æ•°æ®é‡æŒ‡æ ‡</li></ul><p><br><br><br></p><h2 id="æ–‡æ¡£ç´¢å¼•"><a href="#æ–‡æ¡£ç´¢å¼•" class="headerlink" title="æ–‡æ¡£ç´¢å¼•"></a>æ–‡æ¡£ç´¢å¼•</h2><p>å‰ç«¯é¡¹ç›®å¼€å‘å¯èƒ½ä¼šå…³è”å¾ˆå¤šæ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£æ˜¯åˆ†æ•£çš„ï¼Œåœ¨è®¾è®¡æ–‡æ¡£ä¸­æœ€å¥½æŠŠå®ƒä»¬èšåˆèµ·æ¥ï¼Œæ–¹ä¾¿æŸ¥é˜…å’Œå¼•ç”¨. ä¾‹å¦‚:</p><ul><li>éœ€æ±‚æ–‡æ¡£</li><li>DEMO, UIè®¾è®¡ç¨¿</li><li>æµ‹è¯•ç”¨ä¾‹</li><li>æ¥å£æ–‡æ¡£</li><li>UIè®¾è®¡è§„èŒƒæ–‡æ¡£</li><li>å‰ç«¯è§„èŒƒæ–‡æ¡£</li><li>â€¦</li></ul><p><br><br><br></p><h2 id="æ„å»ºè¯´æ˜"><a href="#æ„å»ºè¯´æ˜" class="headerlink" title="æ„å»ºè¯´æ˜"></a>æ„å»ºè¯´æ˜</h2><p>å¦‚æœä½ çš„é¡¹ç›®éœ€è¦è®¾è®¡æ„å»ºæµç¨‹ï¼Œä¹Ÿå¯ä»¥åœ¨è®¾è®¡æ–‡æ¡£ä¸­ç®€å•æåŠã€‚</p><p>ä¾‹å¦‚<strong>å¦‚ä½•ç¼–è¯‘å’Œè¿è¡Œ</strong>? <strong>å¦‚ä½•æµ‹è¯•å’Œè°ƒè¯•</strong>? <strong>å¦‚ä½•éƒ¨ç½²æˆ–å‘å¸ƒ</strong>ï¼Ÿ <strong>ä»£ç å¦‚ä½•ç»„ç»‡</strong>ï¼Ÿ<strong>å¼€å‘å·¥ä½œæµ</strong>ã€<strong>ç¼–ç çº¦å®š</strong>ç­‰ç­‰</p><p>æ–°æˆå‘˜é€šè¿‡è¿™äº›è¯´æ˜å¯ä»¥å¿«é€Ÿä¸Šæ‰‹å¼€å‘.</p><p><br></p><h2 id="æŒç»­è¿­ä»£"><a href="#æŒç»­è¿­ä»£" class="headerlink" title="æŒç»­è¿­ä»£"></a>æŒç»­è¿­ä»£</h2><p>è®¾è®¡æ–‡æ¡£ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒåº”è¯¥è·Ÿéšé¡¹ç›®ä¸æ–­çš„è¿­ä»£ï¼Œä¸ç„¶å°±å¤±å»äº†æ–‡æ¡£çš„æ„ä¹‰ã€‚</p><p><br><br><br></p><h2 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h2><p>æœ€åï¼Œè§„èŒƒä¸€äº›è®¾è®¡æ–‡æ¡£çš„æ ¼å¼å’Œå†…å®¹</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># XXX æ¦‚è¦è®¾è®¡æ–‡æ¡£</span></span><br><span class="line"></span><br><span class="line"><span class="section">## èƒŒæ™¯</span></span><br><span class="line"></span><br><span class="line">å¡«å†™é¡¹ç›®çš„èƒŒæ™¯, æˆ–è€…å¼€å‘æˆ–é‡æ„çš„ç›®çš„/å‡ºå‘ç‚¹.</span><br><span class="line"></span><br><span class="line"><span class="section">## å…³é”®ä¸šåŠ¡æµç¨‹</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥æ”¾ç½®å…³é”®çš„ä¸šåŠ¡æµç¨‹å›¾ã€çŠ¶æ€å›¾ã€å¯¹è±¡å›¾ç­‰ç­‰. æ¢³ç†å…³é”®çš„ä¸šåŠ¡æµç¨‹</span><br><span class="line"></span><br><span class="line"><span class="section">## å…³é”®æŠ€æœ¯æè¿°</span></span><br><span class="line"></span><br><span class="line">å¯é€‰, æè¿°é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„å…³é”®æŠ€æœ¯ã€ç®—æ³•ã€é€‰å‹ç»“è®ºç­‰ç­‰</span><br><span class="line"></span><br><span class="line"><span class="section">## æ¨¡å—æ‹†åˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>å…¥å£</span><br><span class="line"><span class="bullet">- </span>é¡µé¢è·¯ç”±</span><br><span class="line"><span class="bullet">- </span>ç»„ä»¶è®¾è®¡</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä½¿ç”¨æ€ç»´å¯¼å›¾æè¿°</span><br><span class="line"></span><br><span class="line"><span class="section">## çŠ¶æ€è®¾è®¡</span></span><br><span class="line"></span><br><span class="line">æè¿°åº”ç”¨æ¶‰åŠçš„å…³é”®é¢†åŸŸå¯¹è±¡, æ¯”å¦‚å¤–å½¢ã€è¡Œä¸ºå’Œå…³ç³». å¦‚æœæ˜¯OOPæ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨UMLæè¿°</span><br><span class="line"></span><br><span class="line"><span class="section">## æ¥å£è®¾è®¡</span></span><br><span class="line"></span><br><span class="line">å¯é€‰ï¼Œå¦‚é¢˜</span><br><span class="line"></span><br><span class="line"><span class="section">## é¡¹ç›®è¦æ±‚å’Œç›®æ ‡</span></span><br><span class="line"></span><br><span class="line">é¡¹ç›®ç›®æ ‡ã€è¿è¡Œç¯å¢ƒã€å…¼å®¹æ€§è¦æ±‚ã€æ€§èƒ½æŒ‡æ ‡ç­‰ç­‰</span><br><span class="line"></span><br><span class="line"><span class="section">## éªŒè¯</span></span><br><span class="line"></span><br><span class="line">å¯é€‰, é£é™©è¯„ä¼°ã€å¼‚å¸¸æƒ…å†µè€ƒè™‘ã€ç‰¹æ®Šæµ‹è¯•è§„åˆ™ã€æµ‹è¯•æŒ‡å¯¼ç­‰ç­‰</span><br><span class="line"></span><br><span class="line"><span class="section">## åˆ†å·¥å’Œç‰ˆæœ¬è®¡åˆ’</span></span><br><span class="line"></span><br><span class="line">å¯é€‰, å¯ä»¥åœ¨å•ç‹¬æ–‡æ¡£æˆ–è€…çœ‹æ¿ä¸­ç»´æŠ¤</span><br><span class="line"></span><br><span class="line"><span class="section">## æ„å»ºè¯´æ˜</span></span><br><span class="line"></span><br><span class="line">å¯é€‰, é¡¹ç›®ç»„ç»‡ã€æ„å»ºã€æµ‹è¯•è¯´æ˜</span><br><span class="line"></span><br><span class="line"><span class="section">## æ–‡æ¡£ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">ç›¸å…³æ–‡æ¡£çš„ç´¢å¼•å’Œé“¾æ¥</span><br><span class="line"></span><br><span class="line"><span class="section">## å‚è€ƒèµ„æ–™</span></span><br><span class="line"></span><br><span class="line">æ–‡æ¡£ä¸­ç´¢å¼•é¡µçš„å¤–éƒ¨å‚è€ƒèµ„æ–™</span><br><span class="line"></span><br><span class="line"><span class="section">## CHANGELOG</span></span><br><span class="line"></span><br><span class="line">åˆ—å‡ºæœ¬æ–‡æ¡£ä¿®æ”¹çš„å†å²çºªå½•ã€‚å¿…é¡»æŒ‡æ˜ä¿®æ”¹çš„å†…å®¹ã€æ—¥æœŸä»¥åŠä¿®æ”¹äºº</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šå¼€å‘äººå‘˜éƒ½ä¸å–œæ¬¢å†™æ–‡æ¡£ï¼ŒåŒ…æ‹¬æˆ‘ä»¥å‰ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚æˆ‘ä»¬ä¼šæ‰¾å„ç§å€Ÿå£ï¼šâ€™æ—¶é—´ç´§å¼ ï¼Œæ²¡æ—¶é—´åšè®¾è®¡â€˜ã€â€™ç”¨æ¥å†™è®¾è®¡æ–‡æ¡£çš„æ—¶é—´ï¼Œæˆ‘çš„å¼€å‘æ—©å°±åšå®Œäº†â€˜ã€‚</p><p>è¿™äº›æƒ³æ³•æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ï¼Œç»™æˆ‘çš„å¯ç¤ºæ˜¯<strong>æˆ‘ä»¬è¦æ ¹æ®å›¢é˜Ÿæƒ…å†µè€Œå®šï¼Œä¸è¦æ±‚è®¾è®¡æ–‡æ¡£æœ‰å¤šä¹ˆè¯¦å°½ï¼Œåœ¨æ—¶é—´ç´§å¼ çš„æ—¶å€™å¯ä»¥ç²—ç•¥ä¸€ç‚¹ã€‚ç­‰æ—¶é—´å……è£•å†å›é¡¾è¡¥å……ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„; æˆ–è€…å¦‚æœé¡¹ç›®åˆ’åˆ†ä¸ºå¤šä¸ªå‘¨æœŸè¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªå‘¨æœŸå¼€å§‹æ—¶è¿›è¡Œè¯¦ç»†çš„è®¾è®¡</strong>ã€‚</p><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ–‡ç« å·®ä¸å¤šå†™å®Œäº†ï¼Œçœ‹åˆ°äº†çŸ¥ä¹<a href="https://www.zhihu.com/people/zhang-ming-yun-88/activities" target="_blank" rel="noopener">@å¼ æ˜äº‘</a><a href="https://www.zhihu.com/question/300407894" target="_blank" rel="noopener">ç°ä»£è½¯ä»¶å¼€å‘ä¸­ï¼Œè¯¦ç»†è®¾è®¡è¿™ä¸€æ­¥è¦å¦‚ä½•æ¥åšï¼Ÿ</a>ä¸‹é¢çš„ä¸€ä¸ªå›ç­”:</p><p><br></p><p><img src="/images/fe-design/zhihu.png" alt></p><p><br></p><p>å’Œæˆ‘ä¸Šæ–‡æ‰€ä»‹ç»åŸºæœ¬å»åˆã€‚ä¸€ä¸ªè½¯ä»¶â€™æ¦‚è¦â€˜è®¾è®¡æ–‡æ¡£åŸºæœ¬å°±åŒ…å«è¿™å‡ å¤§å—ã€‚</p><p>æœ¬æ–‡å®Œã€‚</p><p><br></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.infoq.cn/article/how-to-write-a-good-software-design-document" target="_blank" rel="noopener">å¦‚ä½•æ‰èƒ½å†™å‡ºå¥½çš„è½¯ä»¶è®¾è®¡æ–‡æ¡£ï¼Ÿ</a></li><li><a href="https://blog.csdn.net/lori2004/article/details/80011806" target="_blank" rel="noopener">è½¯ä»¶è®¾è®¡æ–‡æ¡£ç¼–å†™æ¦‚è¿°</a></li><li><a href="https://www.zhihu.com/question/300407894" target="_blank" rel="noopener">ç°ä»£è½¯ä»¶å¼€å‘ä¸­ï¼Œè¯¦ç»†è®¾è®¡è¿™ä¸€æ­¥è¦å¦‚ä½•æ¥åšï¼Ÿ</a></li></ul><p><br></p><p><img src="/images/sponsor.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://juejin.im/post/5d3a7134f265da1b5d57f1ed&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;if æˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿ Leaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ?&lt;/a&gt;åœ¨æ˜é‡‘ç›®å‰å·²ç»çªç ´740ä¸ªğŸ‘äº†
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨å’ŒNodeä¸­çš„JavaScriptæ˜¯å¦‚ä½•å·¥ä½œçš„? å¯è§†åŒ–è§£é‡Š</title>
    <link href="https://bobi.ink/2019/08/29/js-bs/"/>
    <id>https://bobi.ink/2019/08/29/js-bs/</id>
    <published>2019-08-28T16:00:00.000Z</published>
    <updated>2019-08-30T15:12:30.729Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€: <a href="https://itnext.io/how-javascript-works-in-browser-and-node-ab7d0d09ac2f" target="_blank" rel="noopener">How JavaScript works in browser and node?</a></p><p>æœ‰éå¸¸å¤šæ»¡æ€€æ¿€æƒ…çš„å¼€å‘è€…ï¼Œä»–ä»¬æå‰ç«¯æˆ–è€…æåç«¯ï¼Œä¸ºJavaScriptå¥‰çŒ®è‡ªå·±é’æ˜¥å’Œè¡€æ±—ã€‚JavaScriptæ˜¯ä¸€ç§éå¸¸å®¹æ˜“ç†è§£è¯­è¨€ï¼Œæ¯«æ— ç–‘é—®å®ƒæ˜¯å‰ç«¯å¼€å‘ä¸­ä¸€ä¸ªéå¸¸å…³é”®çš„éƒ¨åˆ†ã€‚ä½†æ˜¯å’Œå…¶ä»–è¯­è¨€ä¸åŒçš„æ˜¯ï¼Œ å®ƒæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™å°±æ„å‘³ç€ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»£ç ç‰‡æ®µåœ¨æ‰§è¡Œã€‚å› ä¸ºä»£ç æ‰§è¡Œæ˜¯çº¿æ€§çš„ï¼Œå¦‚æœå½“ä¸­æœ‰ä»»ä½•ä»£ç æ‰§è¡Œå¾ˆé•¿æ—¶é—´ï¼Œå°†ä¼šé˜»å¡åé¢éœ€è¦è¢«æ‰§è¡Œçš„ä»£ç ã€‚å› æ­¤æœ‰æ—¶å€™ä½ ä¼šåœ¨Google Chromeä¸­çœ‹åˆ°è¿™æ ·çš„ç•Œé¢:</p><p><br></p><p><img src="/images/js-bs/crashed.png" alt></p><p><br></p><p>å½“ä½ åœ¨æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå®ƒä¼šä½¿ç”¨ä¸€ä¸ªJavaScriptæ‰§è¡Œçº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹è´Ÿè´£å“åº”ä¸€åˆ‡æ“ä½œï¼Œæ¯”å¦‚é¡µé¢æ»šåŠ¨ã€é¡µé¢æ¸²æŸ“ã€ç›‘å¬DOMäº‹ä»¶(æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®)ç­‰ç­‰ã€‚ä½†æ˜¯å¦‚æœJavaScriptæ‰§è¡Œè¢«é˜»å¡äº†ï¼Œé‚£æµè§ˆå™¨å°±ä»€ä¹ˆäº‹æƒ…ä¹Ÿåšä¸äº†ï¼Œå³æ„å‘³ç€æµè§ˆå™¨ä¼šå‘ˆç°ä¸ºå¡æ­»ï¼Œæ— æ³•å“åº”çš„ç°è±¡ã€‚</p><p>ä¸ä¿¡ä½ å°±åœ¨æ§åˆ¶å°è¾“å…¥è¯•è¯•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)&#123;&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä½ ä¼šä¸Šé¢è¯­å¥ä¹‹åçš„ä»»ä½•ä»£ç éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¸ªâ€˜æ­»å¾ªç¯â€™ä¼šéœ¸å ç€ç³»ç»Ÿèµ„æº, è®©æµè§ˆå™¨æ— æ³•å“åº”ç”¨æˆ·æ“ä½œ. æ— é™é€’å½’è°ƒç”¨ä¹Ÿä¼šå‡ºç°è¿™ç§æƒ…å†µ, ä¸è¿‡ä¸‹æ–‡ä¼šä»‹ç»ï¼ŒJavascriptå¼•æ“å¯¹è°ƒç”¨æ ˆé•¿åº¦è¿›è¡Œé™åˆ¶ï¼Œæ— é™é€’å½’ä¼šæŠ›å‡ºRangeErrorå¼‚å¸¸, è€Œä¸ä¼šæ— ä¼‘æ­¢åœ°è¿è¡Œã€‚</p><p><br></p><p><img src="/images/js-bs/crashed2.png" alt></p><p><br></p><p>æ„Ÿè°¢ç°ä»£æµè§ˆå™¨ï¼Œç°åœ¨ä¸æ˜¯æ‰€æœ‰æ‰“å¼€çš„æ ‡ç­¾é¡µéƒ½ä¾èµ–äºä¸€ä¸ªJavaScriptçº¿ç¨‹ã€‚è€Œæ˜¯æ¯ä¸ªæ ‡ç­¾é¡µæˆ–è€…åŸŸåéƒ½ä¼šæœ‰ç‹¬ç«‹çš„JavaScriptçº¿ç¨‹ã€‚è¿™æ ·æ¯ä¸ªæ ‡ç­¾é¡µä¹‹é—´ä¸ä¼šäº’ç›¸é˜»å¡ã€‚æ¯”å¦‚ä½ å¯ä»¥åœ¨Chromeä¸­æ‰“å¼€å¤šä¸ªæ ‡ç­¾é¡µï¼Œåœ¨æŸä¸ªæ ‡ç­¾é¡µä¸‹æ‰§è¡Œä¸Šé¢çš„æ­»å¾ªç¯ï¼Œä½ ä¼šå‘ç°åªæœ‰æ‰§è¡Œäº†ä¸Šé¢è¯­å¥çš„æ ‡ç­¾å¡æ­»ï¼Œå…¶ä»–ä¸å—å½±å“ã€‚</p><p><br><br><br></p><h2 id="è°ƒç”¨æ ˆ-call-stack"><a href="#è°ƒç”¨æ ˆ-call-stack" class="headerlink" title="è°ƒç”¨æ ˆ(Call Stack)"></a>è°ƒç”¨æ ˆ(Call Stack)</h2><p>ä¸ºäº†å¯è§†åŒ–JavaScript å¦‚ä½•æ‰§è¡Œç¨‹åºï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç†è§£JavaScriptè¿è¡Œæ—¶ã€‚</p><p><img src="/images/js-bs/vis1.png" alt></p><p><br></p><p>å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒJavaScriptè¿è¡Œæ—¶æœ‰ä¸€ä¸ªæ ˆ(Stack)å’Œä¸€ä¸ªå †(Heap)å­˜å‚¨å™¨ã€‚</p><p><img src="/images/js-bs/stack-vs-heap.jpg" alt></p><p>ä¸Šå›¾æ¥æºäº<a href="Confused about Stack and Heap?">Fhinkel</a>æ–‡ç« ï¼Œå…³äºæ ˆå’Œå †ä¹‹é—´çš„å·®å¼‚è®²å¾—æ¯”è¾ƒæ¸…æ™°. ä¸¾ä¸ªä¾‹å­:</p><p><em>åœ¨Javaæˆ–è€…C#ä¸­ï¼Œ å€¼ç±»å‹(primitivesåŸå§‹ç±»å‹)å­˜å‚¨åœ¨æ ˆä¸­ï¼Œè€Œå¼•ç”¨ç±»å‹(reference)åˆ™å­˜å‚¨åœ¨å †ä¸­ã€‚C++è§„èŒƒæ²¡æœ‰è§„å®šæ ˆå’Œå †çš„å†…å­˜åˆ†é…ï¼Œè€Œæ˜¯ä½¿ç”¨<code>è‡ªåŠ¨å­˜å‚¨(automatic)æœŸ</code>å’Œ<code>åŠ¨æ€å­˜å‚¨(dynamic)æœŸ</code>æ¥ä½œåŒºåˆ†ï¼Œå±€éƒ¨å˜é‡æ˜¯è‡ªåŠ¨å­˜å‚¨æœŸï¼Œç¼–è¯‘å™¨ä¼šå°†å®ƒä»¬å­˜å‚¨åœ¨æ ˆä¸­ã€‚è€ŒåŠ¨æ€åˆ†é…çš„å¯¹è±¡åˆ™é€šå¸¸ä¿å­˜åœ¨å †ä¸­ã€‚æ”¾åœ¨æ ˆä¸­çš„æ•°æ®ä¼šåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨å›æ”¶ï¼Œè€Œæ”¾åœ¨å †ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾å°±ä¼šé€ æˆ<strong>å†…å­˜æ³„éœ²</strong></em></p><p><br></p><p>æœ¬æ–‡ä¸ä¼šæ·±å…¥è§£é‡ŠHeapï¼Œä½ å¯ä»¥çœ‹<a href="https://hashnode.com/post/does-javascript-use-stack-or-heap-for-memory-allocation-or-both-cj5jl90xl01nh1twuv8ug0bjk" target="_blank" rel="noopener">è¿™é‡Œ</a>. åœ¨æœ¬æ–‡æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯æ ˆï¼Œ<strong>æ ˆæ˜¯ä¸€ä¸ªLIFO(åè¿›å…ˆå‡º)çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥ä¿å­˜ç¨‹åºå½“å‰çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡, æ¢å¥è¯è¯´ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯å½“å‰ç¨‹åºæ‰§è¡Œçš„ä½ç½®. æ¯æ¬¡å¼€å§‹æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šå°†è¯¥å‡½æ•°æ¨å…¥æ ˆä¸­ï¼Œå½“å‡½æ•°è¿”å›æ—¶ä»æ ˆä¸­å¼¹å‡ºã€‚ å½“æ ˆä¸ºç©ºæ—¶è¡¨ç¤ºæ²¡æœ‰ç¨‹åºæ­£åœ¨æ‰§è¡Œã€‚æ‰€ä»¥æ ˆå¸¸å¸¸ä¹Ÿç§°ä¸ºâ€˜è°ƒç”¨æ ˆâ€™</strong>ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'Hello from baz'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   baz();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   bar();</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><p>å› æ­¤, å½“ä¸Šé¢çš„ç¨‹åºåŠ è½½è¿›å†…å­˜æ—¶ï¼Œä¼šå¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå³<code>foo</code>ã€‚ å› æ­¤ç¬¬ä¸€ä¸ªæ ˆå…ƒç´ å°±æ˜¯<code>foo()</code>, å› ä¸º<code>foo</code>å‡½æ•°ä¼šè°ƒç”¨<code>bar</code>å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ ˆå…ƒç´ å°±æ˜¯<code>bar()</code>; åŒç†<code>bar</code>å‡½æ•°ä¼šè°ƒç”¨<code>baz</code>ï¼Œç¬¬ä¸‰ä¸ªæ ˆå…ƒç´ å°±æ˜¯<code>baz()</code>. æœ€åï¼Œ<code>baz</code>è°ƒç”¨<code>console.log</code>ï¼Œæœ€åä¸€ä¸ªæ ˆå…ƒç´ å°±æ˜¯<code>console.log(&#39;Hello from baz&#39;)</code></p><p>æ ˆä¼šåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶(åˆ°è¾¾å‡½æ•°åº•éƒ¨æˆ–è€…è°ƒç”¨return)å¼¹å‡ºã€‚ç„¶åç»§ç»­æ‰§è¡Œå‡½æ•°è°ƒç”¨åç»­çš„è¯­å¥:</p><p><img src="/images/js-bs/vis1.gif" alt></p><p><br></p><p>æ¯ä¸ªæ ˆå…ƒç´ ä¸­ï¼Œå…ƒç´ çš„çŠ¶æ€ä¹Ÿè¢«ç§°ä¸ºæ ˆå¸§(Stack Frame). å¦‚æœåœ¨å‡½æ•°è°ƒç”¨æŠ›å‡ºé”™è¯¯ï¼ŒJavaScriptä¼šè¾“å‡ºæ ˆè·Ÿè¸ªè®°å½•(Stack trace)ï¼Œè¡¨ç¤ºä»£ç æ‰§è¡Œæ—¶çš„æ ˆå¸§çš„å¿«ç…§ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Something went wrong.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   baz();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   bar();</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¨‹åºï¼Œæˆ‘ä»¬åœ¨<code>baz</code>ä¸­æŠ›å‡ºé”™è¯¯ï¼ŒJavaScriptä¼šæ‰“å°å‡ºæ ˆè·Ÿä¸­è®°å½•ï¼ŒæŒ‡å‡ºé”™è¯¯å‘ç”Ÿçš„åœ°æ–¹å’Œé”™è¯¯ä¿¡æ¯ã€‚</p><p><img src="/images/js-bs/err-msg.png" alt></p><p><br></p><p><strong>æ ˆçš„å¤§å°ä¸æ˜¯æ— é™çš„ã€‚ä¾‹å¦‚Chromeå°±ä¼šé™å®šæ ˆçš„æœ€å¤§ä¸º16,000å¸§ã€‚æ‰€ä»¥æ— é™é€’å½’ä¼šå¯¼è‡´ChromeæŠ›å‡º<code>Maximum Call Stack size exceeded</code></strong>:</p><p><img src="/images/js-bs/overstack.png" alt></p><p><br><br><br></p><h2 id="äº‹ä»¶å¾ªç¯ä¸web-api"><a href="#äº‹ä»¶å¾ªç¯ä¸web-api" class="headerlink" title="äº‹ä»¶å¾ªç¯ä¸Web API"></a>äº‹ä»¶å¾ªç¯ä¸Web API</h2><p><strong>å› ä¸ºJavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å®ƒåªæœ‰ä¸€ä¸ªæ ˆå’Œå †</strong>ã€‚å› æ­¤ï¼Œå¦‚æœå…¶ä»–ç¨‹åºæƒ³è¦æ‰§è¡Œä¸€äº›ä¸œè¥¿ï¼Œéœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªç¨‹åºæ‰§è¡Œå®Œæ¯•</p><p>å¯¹æ¯”å…¶ä»–è¯­è¨€ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªç³Ÿç³•çš„è®¾è®¡ï¼Œä½†æ˜¯JavaScriptçš„å®šä½å°±æ˜¯é€šç”¨ç¼–ç¨‹è¯­è¨€ï¼Œè€Œä¸æ˜¯ç”¨äºéå¸¸å¤æ‚çš„åœºæ™¯</p><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ã€‚å‡è®¾æµè§ˆå™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒåŠ è½½å›¾ç‰‡å¹¶å±•ç¤ºåˆ°é¡µé¢ã€‚æµè§ˆå™¨ä¼šå¡æ­»ç­‰å¾…è¯·æ±‚å®Œæˆå—ï¼Ÿæ˜¾ç„¶ä¸ä¼šï¼Œè¿™æ ·ç”¨æˆ·ä½“éªŒå¤ªå·®äº†</p><p>æµè§ˆå™¨é€šè¿‡JavaScriptå¼•æ“æ¥æä¾›JavaScriptè¿è¡Œç¯å¢ƒã€‚æ¯”å¦‚Chromeä½¿ç”¨V8 å¼•æ“ã€‚ä½†æ˜¯æµè§ˆå™¨å†…éƒ¨å¯ä¸åªæœ‰JavaScriptå¼•æ“ã€‚ä¸‹é¢æ˜¯æµè§ˆå™¨çš„åº•å±‚ç»“æ„ï¼š</p><p><br></p><p><img src="/images/js-bs/underhood.png" alt></p><p><br></p><p>çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯å®ƒä¹Ÿå¾ˆå¥½ç†è§£ã€‚JavaScriptå¼•æ“éœ€è¦å’Œå…¶ä»–2ä¸ªç»„ä»¶åä½œï¼Œå³<strong>äº‹ä»¶å¾ªç¯(EventLoop)</strong>å’Œ<strong>å›è°ƒé˜Ÿåˆ—(CallbackQueue)</strong>ï¼Œå›è°ƒé˜Ÿåˆ—ä¹Ÿè¢«ç§°ä¸ºæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»»åŠ¡é˜Ÿåˆ—ã€‚</p><p>é™¤äº†JavaScriptå¼•æ“ï¼Œæµè§ˆå™¨è¿˜åŒ…å«äº†è®¸å¤šä¸åŒçš„åº”ç”¨æ¥åšå„ç§å„æ ·çš„äº‹æƒ…ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ã€DOMäº‹ä»¶ç›‘å¬ã€é€šè¿‡setTimeoutã€setIntervalå»¶è¿Ÿæ‰§è¡Œã€ç¼“å­˜ã€æ•°æ®å­˜å‚¨ç­‰ç­‰ã€‚è¿™äº›ç‰¹æ€§å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸°å¯Œçš„Webåº”ç”¨ã€‚</p><p>æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæµè§ˆå™¨åªä½¿ç”¨åŒä¸€ä¸ªJavaScriptçº¿ç¨‹æ¥å¤„ç†ä¸Šé¢è¿™äº›ç‰¹æ€§ï¼Œç”¨æˆ·ä½“éªŒä¼šæœ‰å¤šç³Ÿç³•ã€‚å› ä¸ºç”¨æˆ·å³ä½¿åªæ˜¯ç®€å•çš„æ»šåŠ¨é¡µé¢ï¼ŒèƒŒåæ˜¯éœ€è¦å¤„ç†å¾ˆå¤šäº‹æƒ…çš„, å•ä¸ªJavascriptçº¿ç¨‹å‹æ ¹å¿™ä¸è¿‡æ¥ã€‚å› æ­¤æµè§ˆå™¨ä¼šä½¿ç”¨ä½çº§çš„è¯­è¨€ï¼Œæ¯”å¦‚C++ï¼Œæ¥æ‰§è¡Œè¿™äº›æ“ä½œï¼Œå¹¶æš´éœ²ç®€æ´çš„JavaScript APIç»™å¼€å‘è€…ã€‚è¿™äº›APIç»Ÿç§°ä¸º<strong>Web API</strong>ã€‚</p><p><strong>è¿™äº›Web APIé€šå¸¸æ˜¯å¼‚æ­¥çš„</strong>ã€‚è¿™æ„å‘³ç€ï¼Œä½ å¯ä»¥å‘½ä»¤è¿™äº›APIåœ¨â€™åå°â€™(ç‹¬ç«‹çº¿ç¨‹)å»åšä¸€äº›äº‹æƒ…ï¼Œå®Œæˆä»»åŠ¡ä¹‹åå†é€šçŸ¥Javascriptè¿è¡Œæ—¶. åœ¨æ­¤åŒæ—¶ï¼ŒJavascriptå¼•æ“ä¼šç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„JavaScriptä»£ç . åœ¨å‘½ä»¤è¿™äº›APIåœ¨åå°åšäº‹æƒ…æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ç»™å®ƒä»¬æä¾›ä¸€ä¸ªå›è°ƒã€‚è¿™ä¸ªå›è°ƒçš„èŒè´£å°±æ˜¯åœ¨Web APIå®Œæˆä»»åŠ¡åæ‰§è¡ŒJavaScriptä»£ç ã€‚è®©æˆ‘ä»¬å°†ä¸Šè¿°çš„æ‰€æœ‰ä¸œè¥¿æ•´åˆèµ·æ¥ç†è§£ä¸€ä¸‹:</p><p><img src="/images/js-bs/webapi-call.png" alt></p><p>å½“ä½ è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒä¼šè¢«æ¨è¿›æ ˆä¸­ã€‚å¦‚æœè¿™ä¸ªå‡½æ•°ä¸­åŒ…å«äº†Web APIè°ƒç”¨ï¼ŒJavaScriptä¼šä»£ç†Web APIçš„è°ƒç”¨, é€šçŸ¥Web APIæ‰§è¡Œä»»åŠ¡ï¼Œæ¥ç€ç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ç›´åˆ°å‡½æ•°è¿”å›ã€‚ä¸€æ—¦å‡½æ•°åˆ°è¾¾returnè¯­å¥æˆ–è€…å‡½æ•°åº•éƒ¨ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šä»è°ƒç”¨æ ˆä¸­å¼¹å‡ºæ¥ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œå¦‚æœWeb APIåœ¨åå°å®Œæˆäº†å®ƒçš„å·¥ä½œï¼Œä¸”æœ‰ä¸€ä¸ªå›è°ƒå’Œè¿™ä¸ªå·¥ä½œç»‘å®šï¼ŒWeb APIä¼šå°†æ¶ˆæ¯ç»“æœå’Œå›è°ƒè¿›è¡Œç»‘å®šï¼Œå¹¶æ¨å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­(æˆ–è€…ç§°ä¸ºå›è°ƒé˜Ÿåˆ—).</p><p><strong>äº‹ä»¶å¾ªç¯, å°±åƒä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå®ƒçš„å”¯ä¸€å·¥ä½œæ˜¯æ£€æŸ¥å›è°ƒé˜Ÿåˆ—ï¼Œä¸€æ—¦å›è°ƒé˜Ÿåˆ—ä¸­æœ‰å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œå°±å°†è¯¥å›è°ƒæ¨é€åˆ°è°ƒç”¨æ ˆ</strong>ã€‚ä¸è¿‡å› ä¸ºJavascriptæ˜¯å•çº¿ç¨‹çš„, äº‹ä»¶å¾ªç¯ä¸€æ¬¡åªèƒ½æ¨é€ä¸€ä¸ªå›è°ƒåˆ°è°ƒç”¨æ ˆï¼Œæ ˆå°†ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œ<strong>ä¸€æ—¦è°ƒç”¨æ ˆä¸ºç©ºï¼Œäº‹ä»¶å¾ªç¯æ‰ä¼šå°†ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°æ¨é€åˆ°è°ƒç”¨å †</strong>ã€‚</p><p>äº‹ä»¶å¾ªç¯çš„ä¼ªä»£ç å¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">   <span class="keyword">let</span> task</span><br><span class="line">   <span class="keyword">while</span>(task = popCallbackQueue()) &#123;<span class="comment">// å¼¹å‡ºå›è°ƒé˜Ÿåˆ—ä»»åŠ¡</span></span><br><span class="line">      executeTask(task) <span class="comment">// æ‰§è¡Œä»»åŠ¡, è¿™é‡Œé¢å¯èƒ½ä¼šè§¦å‘æ–°çš„Web APIè°ƒç”¨</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (hasAnyPendingTask()) &#123;</span><br><span class="line">      sleep() <span class="comment">// ç¡ä¸€è§‰ï¼Œæœ‰æ–°ä»»åŠ¡æ¨é€åˆ°å›è°ƒé˜Ÿåˆ—æ—¶æ—¶å†å”¤é†’æˆ‘å“¦</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">break</span> <span class="comment">// ç»ˆæ­¢ç¨‹åº, æ²¡ä»€ä¹ˆå¥½å¹²çš„æ‹œæ‹œäº†</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æˆ‘ä»¬é€šè¿‡setTimeout Web APIè¿™ä¸ªä¾‹å­ä¸€æ­¥ä¸€æ­¥çœ‹çœ‹ä¸Šè¿°çš„ä¸€åˆ‡æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚setTimeout Web APIä¸»è¦ç”¨äºå»¶æ—¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä½†æ˜¯å›è°ƒçœŸæ­£è¢«æ‰§è¡Œ, éœ€è¦ç­‰å¾…å½“å‰ç¨‹åºæ‰§è¡Œå®Œæ¯•(å³æ ˆä¸ºç©º), ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>setTimeoutå‡½æ•°å›è°ƒæ‰§è¡Œæ—¶é—´æœªå¿…ç­‰äºä½ æŒ‡å®šçš„å»¶æ—¶æ—¶é—´</strong>ã€‚setTimeoutçš„è¯­æ³•å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setTimeout(callbackFunction, timeInMilliseconds);</span><br></pre></td></tr></table></figure><p>callbackFunctionæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒå°†ä¼šåœ¨timeInMillisecondsä¹‹åæ‰§è¡Œ. æˆ‘ä»¬ä¿®æ”¹ä¸Šé¢çš„ä»£ç æ¥è°ƒç”¨setTimeout:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello from baz'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setTimeout(printHello, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    baz();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å»¶æ—¶è°ƒç”¨äº†console.log. æ ˆè¿˜æ˜¯ä¼šåƒä¹‹å‰ä¸€æ ·ï¼Œå¦‚<code>foo() =&gt; bar() =&gt; baz()</code>, å½“bazå¼€å§‹æ‰§è¡Œå¹¶åˆ°è¾¾setTimeoutæ—¶ï¼ŒJavascriptä¼šå°†å›è°ƒå‡½æ•°ä¼ é€’ç»™Web APIï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡Œã€‚ å› ä¸ºè¿™é‡Œæ²¡æœ‰ä¸‹ä¸€è¡Œäº†ï¼Œæ ˆä¼šå¼¹å‡ºbazï¼Œæ¥ç€å¼¹å‡ºbarå’Œfooã€‚</p><p>åœ¨è¿™æœŸé—´ï¼ŒWeb APIæ­£åœ¨è¿›è¡Œ3sç­‰å¾…ï¼Œå½“æ—¶é—´åˆ°è¾¾æ—¶ï¼Œå®ƒä¼šå°†å›è°ƒæ¨è¿›å›è°ƒé˜Ÿåˆ—ä¸­ã€‚ å› ä¸ºè¿™æ—¶å€™è°ƒç”¨æ ˆä¸ºç©ºï¼Œäº‹ä»¶å¾ªç¯ä¼šå°†è¿™ä¸ªå›è°ƒæ¨è¿›æ ˆä¸­ï¼Œå¹¶æ‰§è¡Œè¿™ä¸ªå›è°ƒã€‚</p><p><br></p><p><strong>ğŸ‰ğŸ‰<a href="http://latentflip.com/" target="_blank" rel="noopener">Philip Robers</a>åˆ›å»ºäº†ä¸€ä¸ªç¥å¥‡çš„åœ¨çº¿å·¥å…·<a href="http://latentflip.com/loupe/" target="_blank" rel="noopener">Loupe</a>ï¼Œæ¥å¯è§†åŒ–Javascriptçš„åº•å±‚è¿è¡Œã€‚ä¸Šé¢çš„å®ä¾‹å¯ä»¥æŸ¥çœ‹è¿™ä¸ª<a href="http://latentflip.com/loupe/?code=ZnVuY3Rpb24gcHJpbnRIZWxsbygpIHsNCiAgICBjb25zb2xlLmxvZygnSGVsbG8gZnJvbSBiYXonKTsNCn0NCg0KZnVuY3Rpb24gYmF6KCkgew0KICAgIHNldFRpbWVvdXQocHJpbnRIZWxsbywgMzAwMCk7DQp9DQoNCmZ1bmN0aW9uIGJhcigpIHsNCiAgICBiYXooKTsNCn0NCg0KZnVuY3Rpb24gZm9vKCkgew0KICAgIGJhcigpOw0KfQ0KDQpmb28oKTs%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D" target="_blank" rel="noopener">é“¾æ¥</a>ğŸ‰ğŸ‰</strong></p><p><img src="/images/js-bs/vis2.gif" alt></p><p><strong>æ‰€ä»¥è¯´æˆ‘ä»¬Javascriptæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯å¾ˆå¤šWeb APIçš„æ‰§è¡Œæ˜¯å¤šçº¿ç¨‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´Javascriptçš„å•çº¿ç¨‹æŒ‡çš„æ˜¯â€˜Javascriptä»£ç â€™çš„æ‰§è¡Œæ˜¯å•çº¿ç¨‹</strong>.</p><p><br></p><h2 id="node-js"><a href="#node-js" class="headerlink" title="Node.js"></a>Node.js</h2><p>é€šè¿‡Node.jsæˆ‘ä»¬å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…, è€Œä¸ä»…é™äºæµè§ˆå™¨çš„ç«¯ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆè¿ä½œçš„ï¼Ÿ</p><p>Node.js å’ŒChromeä¸€æ ·ï¼ŒåŒæ ·ä½¿ç”¨Googleçš„V8å¼•æ“æ¥æä¾›Javascriptè¿è¡Œæ—¶. å®ƒä½¿ç”¨<a href="https://github.com/libuv/libuv" target="_blank" rel="noopener">libuv</a>(C++ç¼–å†™)æ¥å’ŒV8çš„äº‹ä»¶å¾ªç¯é…åˆï¼Œæ‰©å±•æ›´å¤šå¯ä»¥åœ¨åå°æ‰§è¡Œçš„ä¸œè¥¿, æ¯”å¦‚æ–‡ä»¶ç³»ç»ŸI/O, ç½‘ç»œI/Oã€‚Nodeçš„æ ‡å‡†åº“APIéµå¾ªäº†æµè§ˆå™¨Web APIçš„ç±»ä¼¼å›è°ƒé£æ ¼ã€‚</p><p><img src="/images/js-bs/node.jpg" alt></p><p>å¦‚æœä½ æ¯”è¾ƒäº†æµè§ˆå™¨å’Œnodeçš„ç»“æ„å›¾ï¼Œä½ ä¼šå‘ç°ä¸¤è€…éå¸¸ç›¸ä¼¼ã€‚å³ä¾§çš„éƒ¨åˆ†ç±»ä¼¼äºWeb APIï¼ŒåŒæ ·åŒ…å«äº‹ä»¶é˜Ÿåˆ—(æˆ–è€…ç§°ä¸ºå›è°ƒé˜Ÿåˆ—/æ¶ˆæ¯é˜Ÿåˆ—)å’Œäº‹ä»¶å¾ªç¯ã€‚</p><p>V8ã€äº‹ä»¶å¾ªç¯ã€äº‹ä»¶é˜Ÿåˆ—éƒ½åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œæœ€å³ä¾§è¿˜æœ‰å·¥ä½œçº¿ç¨‹(Worker Thread)è´Ÿè´£æä¾›å¼‚æ­¥çš„I/Oæ“ä½œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´Node.jsæ‹¥æœ‰éé˜»å¡çš„ã€äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥I/Oæ¶æ„ã€‚</p><p>ä¸Šé¢çš„å†…å®¹éƒ½æ¥æºäº<a href="http://latentflip.com/" target="_blank" rel="noopener">Philip Roberts</a>30minçš„é«˜å…‰<a href="https://youtu.be/8aGhZQkoFbQ" target="_blank" rel="noopener">æ¼”è®²</a>(äº”å¹´å‰)</p><p>æœ¬æ–‡å®Œ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡åœ°å€: &lt;a href=&quot;https://itnext.io/how-javascript-works-in-browser-and-node-ab7d0d09ac2f&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;How JavaScript wor
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Typescriptç‰ˆå›¾è§£Functor , Applicative å’Œ Monad</title>
    <link href="https://bobi.ink/2019/08/22/ts-fam/"/>
    <id>https://bobi.ink/2019/08/22/ts-fam/</id>
    <published>2019-08-21T16:00:00.000Z</published>
    <updated>2019-08-24T14:25:35.093Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯ç»å…¸çš„<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" target="_blank" rel="noopener">Functors, Applicatives, And Monads In Pictures</a>çš„Typescriptç¿»è¯‘ç‰ˆæœ¬ã€‚</p><p>Functor/Applicative/Monadæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€äº›æ¯”è¾ƒâ€˜åŸºç¡€â€™çš„æ¦‚å¿µï¼Œåæ­£æˆ‘æ˜¯ä¸è®¤åŒâ€˜åŸºç¡€â€™è¿™ä¸ªè¯´æ³•çš„ï¼Œç¬”è€…ä¹Ÿé˜…è¯»è¿‡å¾ˆå¤šç±»ä¼¼ä»‹ç»Monadçš„æ–‡ç« ï¼Œæœ€åéƒ½ä¸äº†äº†ä¹‹ï¼Œè¿™äº›æ¦‚å¿µæ˜¯æ¯”è¾ƒéš¾ä»¥ç†è§£çš„ï¼Œè€Œä¸”å¹³æ—¶ç¼–ç¨‹å®è·µä¸­ä¹Ÿå¾ˆéš¾ä¼šæ¥è§¦åˆ°è¿™äº›ä¸œè¥¿ã€‚</p><p>åæ¥æ‹œè¯»äº†<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" target="_blank" rel="noopener">Functors, Applicatives, And Monads In Pictures</a>, ä¸é”™ï¼Œå¥½åƒæ‡‚äº†ã€‚äºæ˜¯è‡ªå·±æƒ³é€šè¿‡ç¿»è¯‘ï¼Œå†æ·±å…¥æ¶ˆåŒ–æ¶ˆåŒ–è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä½¿ç”¨<code>Typescript</code>ä½œä¸ºæè¿°è¯­è¨€ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ä¼šæ›´å¥½ç†è§£ã€‚</p><p>æœ‰ç†è§£ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ•¬è¯·æŒ‡æ­£. å¼€å§‹å§ï¼</p><p><br></p><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å€¼:</p><p><img src="/images/ts-fam/value.png" alt></p><p>ä¾‹å¦‚è¿™äº›</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>        <span class="comment">// number</span></span><br><span class="line"><span class="string">'string'</span> <span class="comment">// string</span></span><br></pre></td></tr></table></figure><p>å¤§å®¶éƒ½çŸ¥é“æ€ä¹ˆå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°è¿™ä¸ªå€¼ä¸Šé¢:</p><p><img src="/images/ts-fam/value_apply.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// So easy</span></span><br><span class="line"><span class="keyword">const</span> add3 = <span class="function">(<span class="params">val: <span class="built_in">number</span></span>) =&gt;</span> val + <span class="number">3</span></span><br><span class="line"><span class="built_in">console</span>.log(add3(<span class="number">2</span>)) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•äº†. æˆ‘ä»¬æ¥æ‰©å±•ä¸€ä¸‹, è®©ä»»æ„çš„å€¼æ˜¯å¯ä»¥åŒ…è£…åœ¨ä¸€ä¸ª<strong>ä¸Šä¸‹æ–‡(context)</strong>å½“ä¸­. ç°åœ¨çš„æƒ…å†µä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªå¯ä»¥æŠŠå€¼æ”¾è¿›å»çš„ç›’å­:</p><p><img src="/images/ts-fam/value_and_context.png" alt></p><p>ç°åœ¨ä½ <strong>æŠŠä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°è¿™ä¸ªåŒ…è£…å€¼çš„æ—¶å€™, æ ¹æ®å…¶ä¸Šä¸‹æ–‡ç±»å‹ä½ ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ</strong>. è¿™å°±æ˜¯ <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, <code>Arrow</code> ä¹‹ç±»æ¦‚å¿µçš„åŸºç¡€. </p><p><code>Maybe</code> å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ•°æ®ç±»å‹, å®ƒå®šä¹‰äº†ä¸¤ç§ç›¸å…³çš„â€˜<strong>ä¸Šä¸‹æ–‡</strong>â€™, Maybeæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªâ€˜ä¸Šä¸‹æ–‡â€™(é™¤äº†å€¼ï¼Œå…¶ä»–ç±»å‹éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Ÿ):</p><p><img src="/images/ts-fam/context.png" alt></p><p>åŸæ–‡åŸºäºHaskellï¼Œå®ƒçš„Maybeç±»å‹æœ‰ä¸¤ä¸ªä¸Šä¸‹æ–‡Just(è“è‰²ç›’å­)å’ŒNone(çº¢è‰²ç©ºç›’å­)ã€‚ä»¿é€ Haskellåœ¨Typescriptä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>å¯é€‰ç±»å‹(Maybe)</code>æ¥è¡¨ç¤º:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Maybe&lt;T&gt; = Just&lt;T&gt; | Nothing <span class="comment">// Just è¡¨ç¤ºå€¼â€˜å­˜åœ¨â€™ï¼ŒNothingè¡¨ç¤ºç©ºå€¼ï¼Œç±»ä¼¼äºnullã€undefinedçš„æ¦‚å¿µ</span></span><br></pre></td></tr></table></figure><p>Justå’ŒNothingçš„åŸºæœ¬ç»“æ„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬åªç”¨Noneæ¥å–ä»£null, è¿™é‡Œæˆ‘ä»¬å°†Noneä½œä¸ºä¸€ä¸ªå€¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> None &#123;&#125;</span><br><span class="line"><span class="comment">// å¯¹åº”Noneçš„ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Nothing = <span class="keyword">typeof</span> None</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯Nothingï¼Œè¿™é‡Œä½¿ç”¨Typescriptçš„ `Type Guards`</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isNothing = (val: <span class="built_in">any</span>): val is Nothing =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> val === None</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Justç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">static</span> of&lt;T&gt;(val: T) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Just(val)</span><br><span class="line">  &#125;</span><br><span class="line">  value: T</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">value: T</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a: Maybe&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">a = None;</span><br><span class="line">a = Just.of(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><blockquote><p>è¯´å®åœ¨è¿™ä¸ªå®ç°æœ‰ç‚¹æŒ«, ä½†æ˜¯ä¸ºäº†æ›´åŠ è´´è¿‘åŸæ–‡æè¿°ï¼Œæš‚ä¸”ä½¿ç”¨è¿™ä¸ªå®ç°ã€‚ä¹‹å‰è€ƒè™‘è¿‡çš„ä¸€ä¸ªç‰ˆæœ¬æ˜¯ä¸‹é¢è¿™æ ·çš„, å› ä¸ºæ— æ³•ç»™å®ƒä»¬æ‰©å±•æ–¹æ³•ï¼Œå°±æ”¾å¼ƒäº†è¿™ä¸ªæ–¹æ¡ˆ:<br>  <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Optional&lt;T&gt; = NonNullable&lt;T&gt; | nul</span><br><span class="line"><span class="keyword">let</span> a: Optional&lt;<span class="built_in">number</span>&gt; = <span class="number">1</span>;</span><br><span class="line">a = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p></blockquote><p><br></p><p>å¾ˆå¿«æˆ‘ä»¬ä¼šçœ‹åˆ°å¯¹ä¸€ä¸ª <code>Just&lt;a&gt;</code> å’Œä¸€ä¸ª Nothing æ¥è¯´, å‡½æ•°åº”ç”¨æœ‰ä½•ä¸åŒ. é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ Functor!</p><p><br><br><br></p><h2 id="functors"><a href="#functors" class="headerlink" title="Functors"></a>Functors</h2><p>å½“ä¸€ä¸ªå€¼è¢«åŒ…è£…åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­æ—¶, ä½ å°±ä¸èƒ½æ‹¿æ™®é€šå‡½æ•°æ¥åº”ç”¨äº†:</p><p><img src="/images/ts-fam/no_fmap_ouch.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">let</span> a: Just&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add3 = <span class="function">(<span class="params">v: <span class="built_in">number</span></span>) =&gt;</span> v + <span class="number">3</span></span><br><span class="line">add3(a) <span class="comment">// âŒ ç±»å‹â€œJust&lt;number&gt;â€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œnumberâ€çš„å‚</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™, è¯¥ <code>fmap</code> å‡ºåœºäº†. fmap ç¿©ç¿©è€Œæ¥ï¼Œä»å®¹åº”å¯¹ä¸Šä¸‹æ–‡(fmap is from the street, fmap is hip to contexts). è¿˜æœ‰è°? fmap çŸ¥é“æ€æ ·å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å€¼ä¸Š. <strong>ä½ å¯ä»¥å¯¹ä»»ä½•ä¸€ä¸ªç±»å‹ä¸º Functor çš„ç±»å‹ä½¿ç”¨ fmap</strong>ï¼Œ æ¢å¥è¯è¯´ï¼ŒFunctoréƒ½å®šä¹‰äº†fmap.</p><p>æ¯”å¦‚è¯´, æƒ³ä¸€ä¸‹ä½ æƒ³æŠŠ add3 åº”ç”¨åˆ° Just 2. ç”¨ fmap:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">2</span>).fmap(add3) <span class="comment">// Just 5</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/fmap_apply.png" alt></p><p><strong>ğŸ’¥å˜­ï¼</strong> fmap å‘æˆ‘ä»¬å±•ç¤ºäº†å®ƒçš„æˆæœã€‚ ä½†æ˜¯ fmap æ€ä¹ˆçŸ¥é“å¦‚ä½•åº”ç”¨è¯¥å‡½æ•°çš„å‘¢ï¼Ÿ</p><p><br></p><h2 id="ç©¶ç«Ÿä»€ä¹ˆæ˜¯-functor-å‘¢ï¼Ÿ"><a href="#ç©¶ç«Ÿä»€ä¹ˆæ˜¯-functor-å‘¢ï¼Ÿ" class="headerlink" title="ç©¶ç«Ÿä»€ä¹ˆæ˜¯ Functor å‘¢ï¼Ÿ"></a>ç©¶ç«Ÿä»€ä¹ˆæ˜¯ Functor å‘¢ï¼Ÿ</h2><p>åœ¨ Haskell ä¸­ <code>Functor</code> æ˜¯ä¸€ä¸ª<a href="http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101" target="_blank" rel="noopener">ç±»å‹ç±»(typeclass)</a>ã€‚ å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><p><img src="/images/ts-fam/functor_def.png" alt></p><p>åœ¨Typescriptä¸­ï¼Œ ä¸€ä¸ªFunctorè®¤ä¸ºæ˜¯<strong>å®šä¹‰äº†fmapçš„ä»»æ„ç±»å‹</strong>. çœ‹çœ‹<code>fmap</code>æ˜¯å¦‚ä½•å·¥ä½œçš„:</p><p><img src="/images/ts-fam/fmap_def.png" alt></p><ol><li>ä¸€ä¸ªFunctorç±»å‹çš„ fa, ä¾‹å¦‚Just 2</li><li>fa å®šä¹‰äº†ä¸€ä¸ªfmap, fmap æ¥å—ä¸€ä¸ªå‡½æ•°fnï¼Œä¾‹å¦‚add3</li><li>fmap ç›´åˆ°å¦‚ä½•å°†faåº”ç”¨åˆ°fnä¸­ï¼Œ è¿”å›ä¸€ä¸ªFunctorç±»å‹çš„ fb. <strong>faå’Œfbçš„åŒ…è£…ä¸Šä¸‹æ–‡ç±»å‹ä¸€æ ·</strong>, ä¾‹å¦‚faæ˜¯Just, é‚£ä¹ˆfbä¹Ÿæ˜¯Just; åä¹‹faæ˜¯Nothingï¼Œfbä¹Ÿæ˜¯Nothing;</li></ol><p>ç”¨Typescriptçš„å‡½æ•°ç­¾åæè¿°ä¸€ä¸‹ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">&lt;Functor T&gt;.fmap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">val: T</span>) =&gt; U</span>): &lt;<span class="params">Functor</span> <span class="params">U</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">2</span>).fmap(add3) <span class="comment">// Just 5</span></span><br></pre></td></tr></table></figure><p>è€Œ fmap ç¥å¥‡åœ°åº”ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸º Maybe æ˜¯ä¸€ä¸ª Functor, å®ƒæŒ‡å®šäº† fmap å¦‚ä½•åº”ç”¨åˆ° Just ä¸Šä¸ Nothing ä¸Š:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// å®ç°fmap</span></span><br><span class="line">  fmap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">val: T</span>) =&gt; U</span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">Just</span>.<span class="params">of</span>(<span class="params">fn(<span class="params"><span class="keyword">this</span>.value</span>)</span>)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="params">class</span> <span class="params">None</span> &#123;</span></span><br><span class="line"><span class="function">  // <span class="params">None</span> æ¥å—ä»»ä½•å‡½æ•°éƒ½è¿”å›<span class="params">None</span></span></span><br><span class="line"><span class="function">  <span class="params">static</span> <span class="params">fmap</span>(<span class="params">fn: <span class="built_in">any</span></span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">None</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>å½“æˆ‘ä»¬å†™ <code>Just.of(2).fmap(add3)</code> æ—¶ï¼Œè¿™æ˜¯å¹•åå‘ç”Ÿçš„äº‹æƒ…ï¼š</p><p><img src="/images/ts-fam/fmap_just.png" alt></p><p>é‚£ä¹ˆç„¶åï¼Œå°±åƒè¿™æ ·ï¼Œfmapï¼Œè¯·å°† add3 åº”ç”¨åˆ° Nothing ä¸Šå¦‚ä½•ï¼Ÿ</p><p><img src="/images/ts-fam/fmap_nothing.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">None.fmap(add3) <span class="comment">// Nothing</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/bill.png" alt></p><p>å°±åƒã€Šé»‘å®¢å¸å›½ã€‹ä¸­çš„ Morpheusï¼Œfmap çŸ¥é“éƒ½è¦åšä»€ä¹ˆï¼›å¦‚æœä½ ä» Nothing å¼€å§‹ï¼Œé‚£ä¹ˆä½ ä¼šä»¥ Nothing ç»“æŸï¼ fmap æ˜¯ç¦…ã€‚</p><p>ç°åœ¨å®ƒå‘Šè¯‰æˆ‘ä»¬äº† Maybe æ•°æ®ç±»å‹å­˜åœ¨çš„æ„ä¹‰ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯åœ¨ä¸€ä¸ªæ²¡æœ‰ Maybe çš„è¯­è¨€ä¸­å¤„ç†ä¸€ä¸ªæ•°æ®åº“è®°å½•çš„æ–¹å¼, æ¯”å¦‚Javascript:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> post = Post.findByID(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> (post != <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> post.title</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†fmapå:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾findPostè¿”å›Maybe&lt;Article&gt;</span></span><br><span class="line">findPost(<span class="number">1</span>).fmap(getPostTitle)</span><br></pre></td></tr></table></figure><p>å¦‚æœ findPost è¿”å›ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±ä¼šé€šè¿‡ getPostTitle è·å–å…¶æ ‡é¢˜ã€‚ å¦‚æœå®ƒè¿”å› Nothingï¼Œæˆ‘ä»¬å°±ä¹Ÿè¿”å› Nothingï¼ è¾ƒä¹‹å‰ç®€æ´äº†å¾ˆå¤šå¯¹å§?</p><blockquote><p>Typescriptæœ‰äº†Optional Chainingåï¼Œå¤„ç†nullä¹Ÿå¯ä»¥å¾ˆç®€æ´:<br> <figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">findPost(<span class="number">1</span>)?.title <span class="comment">// å¼‚æ›²åŒå·¥</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>åŸæ–‡è¿˜æœ‰å®šä¹‰äº†ä¸€ä¸ªfmapçš„é‡è½½æ“ä½œç¬¦ç‰ˆæœ¬ï¼Œå› ä¸ºJavaScriptä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œæ‰€ä»¥è¿™é‡Œç®€å•å¸¦è¿‡<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getPostTitle &lt;$&gt; findPost(1) // ä½¿ç”¨æ“ä½œç¬¦é‡è½½&lt;$&gt; æ¥ç®€åŒ–fmap. ç­‰ä»·äºä¸Šé¢çš„ä»£ç </span><br></pre></td></tr></table></figure></p></blockquote><p><br></p><p>å†çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼šå¦‚æœå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°ä¸€ä¸ª Arrayï¼ˆHaksell ä¸­æ˜¯ Listï¼‰ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><img src="/images/ts-fam/fmap_list.png" alt></p><p>Array ä¹Ÿæ˜¯ functorï¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(add3) <span class="comment">// [4, 5, 6]. faæ˜¯Arrayï¼Œè¾“å‡ºfbä¹Ÿæ˜¯Arrayï¼Œç¬¦åˆFunctorçš„å®šä¹‰å§ï¼Œæ‰€ä»¥Javascriptçš„mapå°±æ˜¯fmapï¼ŒArrayå°±æ˜¯Functor</span></span><br></pre></td></tr></table></figure><p><br></p><p>å¥½äº†ï¼Œå¥½äº†ï¼Œæœ€åä¸€ä¸ªç¤ºä¾‹ï¼šå¦‚æœå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> multiply3 = <span class="function">(<span class="params">v: <span class="built_in">number</span></span>) =&gt;</span> v * <span class="number">3</span></span><br><span class="line"><span class="keyword">const</span> add3 = <span class="function">(<span class="params">v: <span class="built_in">number</span></span>) =&gt;</span> v + <span class="number">3</span></span><br><span class="line"></span><br><span class="line">add3.fmap(multiply3) <span class="comment">// â“</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š</p><p><img src="/images/ts-fam/function_with_value.png" alt></p><p>è¿™æ˜¯ä¸€ä¸ªåº”ç”¨åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸Šçš„å‡½æ•°ï¼š</p><p><img src="/images/ts-fam/fmap_function.png" alt></p><p>å…¶ç»“æœæ˜¯åˆä¸€ä¸ªå‡½æ•°ï¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…ä½œç¤ºä¾‹ï¼Œä¸è¦æ¨¡ä»¿</span></span><br><span class="line"><span class="keyword">interface</span> Function &#123;</span><br><span class="line">  fmap&lt;V, T, U&gt;<span class="function">(<span class="params"><span class="keyword">this</span>: (<span class="params">val: V</span>) =&gt; T, fn: (<span class="params">val: T</span>) =&gt; U</span>): (<span class="params">val: V</span>) =&gt;</span> U</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Function</span>.prototype.fmap = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">v</span> =&gt;</span> fn(<span class="keyword">this</span>(v))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å‡½æ•°ä¹Ÿæ˜¯ Functorï¼ å¯¹ä¸€ä¸ªå‡½æ•°ä½¿ç”¨ fmapï¼Œå…¶å®å°±æ˜¯å‡½æ•°ç»„åˆ(compose)ï¼ ä¹Ÿå°±æ˜¯è¯´: <code>f.fmap(g)</code> ç­‰ä»·äº <code>compose(f, g)</code></p><p><br></p><h3 id="functoræ€»ç»“"><a href="#functoræ€»ç»“" class="headerlink" title="Functoræ€»ç»“"></a>Functoræ€»ç»“</h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çŸ¥é“Functorå…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆéš¾ä»¥ç†è§£, ä¸€ä¸ªFunctorå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Functor T&gt;.fmap(fn: (v: T) =&gt; U): &lt;Functor U&gt;</span><br></pre></td></tr></table></figure><p>Functorä¼šå®šä¹‰ä¸€ä¸ªâ€˜fmapâ€™æ“ä½œï¼Œè¿™ä¸ªfmapæ¥å—ä¸€ä¸ªå‡½æ•°fnï¼Œfnæ¥æ”¶çš„æ˜¯å…·ä½“çš„å€¼ï¼Œè¿”å›å¦ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œä¾‹å¦‚ä¸Šé¢çš„add3. <strong>fmapå†³å®šå¦‚ä½•æ¥åº”ç”¨fnåˆ°æºFunctor(a)</strong>ï¼Œ è¿”å›ä¸€ä¸ªæ–°çš„Functor(b)ã€‚ ä¹Ÿå°±æ˜¯fmapçš„æºå’Œè¾“å‡ºçš„å€¼â€˜ä¸Šä¸‹æ–‡â€™ç±»å‹æ˜¯ä¸€æ ·çš„ã€‚æ¯”å¦‚</p><ul><li><code>Just -&gt; fmap -&gt; Just</code></li><li><code>Nothing -&gt; fmap -&gt; Nothing</code></li><li><code>Maybe -&gt; fmap -&gt; Maybe</code></li><li><code>Array -&gt; fmap -&gt; Array</code></li></ul><p><br><br><br></p><h2 id="applicative"><a href="#applicative" class="headerlink" title="Applicative"></a>Applicative</h2><p>ç°åœ¨ç»ƒåˆ°äºŒé‡å¤©äº†ã€‚ Applicative åˆæå‡äº†ä¸€ä¸ªå±‚æ¬¡ã€‚</p><p>å¯¹äº Applicativeï¼Œæˆ‘ä»¬çš„å€¼ä¾ç„¶å’Œ Functor ä¸€æ ·åŒ…è£…åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­</p><p><img src="/images/ts-fam/value_and_context.png" alt></p><p>ä¸ä¸€æ ·çš„æ˜¯ï¼Œæˆ‘ä»¬<strong>å°†Functorä¸­çš„å‡½æ•°(ä¾‹å¦‚add3)ä¹ŸåŒ…è£…åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­</strong>ï¼</p><p><img src="/images/ts-fam/function_and_context.png" alt></p><p>å—¯ã€‚ æˆ‘ä»¬ç»§ç»­æ·±å…¥ã€‚ Applicative å¹¶æ²¡æœ‰å¼€ç©ç¬‘ã€‚ä¸åƒHaskellï¼ŒTypescriptå¹¶æ²¡æœ‰å†…ç½®æ–¹å¼æ¥å¤„ç†Applicativeã€‚æˆ‘ä»¬å¯ä»¥ç»™éœ€è¦æ”¯æŒApplicativeçš„ç±»å‹å®šä¹‰ä¸€ä¸ªapplyå‡½æ•°ã€‚<strong>applyå‡½æ•°çŸ¥é“æ€ä¹ˆå°†<code>åŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>åŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å€¼</code></strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> None &#123;</span><br><span class="line">  <span class="keyword">static</span> apply(fn: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> None;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨æ–¹æ³•é‡è½½ï¼Œè®©Typescriptæ›´å¥½æ¨æ–­</span></span><br><span class="line">  <span class="comment">// å¦‚æœå€¼å’Œå‡½æ•°éƒ½æ˜¯Justç±»å‹ï¼Œç»“æœä¹Ÿæ˜¯Justç±»å‹</span></span><br><span class="line">  apply&lt;U&gt;<span class="function">(<span class="params">fn: Just&lt;(<span class="params">a: T</span>) =&gt; U&gt;</span>): <span class="params">Just</span>&lt;<span class="params">U</span>&gt;;</span></span><br><span class="line"><span class="function">  // å¦‚æœå‡½æ•°æ˜¯<span class="params">Nothing</span>ç±»å‹ï¼Œç»“æœæ˜¯<span class="params">Nothing</span>.</span></span><br><span class="line"><span class="function">  // ä¸¥æ ¼ä¸Š<span class="params">apply</span>åªåº”è¯¥æ¥æ”¶åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç±»å‹çš„å‡½æ•°ï¼Œå³<span class="params">Just</span>,</span></span><br><span class="line"><span class="function">  // å› ä¸º<span class="params">Maybe</span>æ˜¯<span class="params">Typescript</span>çš„<span class="params">Union</span>ç±»å‹ï¼Œæ²¡åŠæ³•ç»™å®ƒæ‰©å±•æ–¹æ³•ï¼Œè¿™é‡Œå°†<span class="params">Maybe</span>å’Œ<span class="params">Just</span>æ··åœ¨ä¸€èµ·äº†</span></span><br><span class="line"><span class="function">  <span class="params">apply</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: Nothing</span>): <span class="params">Nothing</span>;</span></span><br><span class="line"><span class="function">  // å¦‚æœå€¼å’Œå‡½æ•°éƒ½æ˜¯<span class="params">Maybe</span>ç±»å‹, è¿”å›ä¸€ä¸ª<span class="params">Maybe</span>ç±»å‹</span></span><br><span class="line"><span class="function">  <span class="params">apply</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: Maybe&lt;(<span class="params">a: T</span>) =&gt; U&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">U</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params">!isNothing(<span class="params">fn</span>)</span>) &#123;</span></span><br><span class="line"><span class="function">      <span class="params">return</span> <span class="params">Just</span>.<span class="params">of</span>(<span class="params">fn.value(<span class="params"><span class="keyword">this</span>.value</span>)</span>);</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">None</span>.<span class="params">apply</span>(<span class="params">fn</span>);</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>å†æ¥çœ‹çœ‹æ•°ç»„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…ä½œç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">interface</span> Array&lt;T&gt; &#123;</span><br><span class="line">  apply&lt;U&gt;<span class="function">(<span class="params">fns: <span class="built_in">Array</span>&lt;(<span class="params">e: T</span>) =&gt; U&gt;</span>): <span class="params">U</span>[]</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// æ¥æ”¶ä¸€ä¸ªå‡½æ•°â€˜æ•°ç»„(<span class="params">ä¸Šä¸‹æ–‡</span>)â€™ï¼Œè¿”å›ä¸€ä¸ªåº”ç”¨äº†â€˜å‡½æ•°â€™çš„æ–°çš„æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="params">Array</span>.<span class="params">prototype</span>.<span class="params">apply</span> = <span class="params">function</span>&lt;<span class="params">T</span>, <span class="params">U</span>&gt;(<span class="params">fns: <span class="built_in">Array</span>&lt;(<span class="params">e: T</span>) =&gt; U&gt;</span>) &#123;</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">res</span>: <span class="params">U</span>[] = []</span></span><br><span class="line"><span class="function">  <span class="params">for</span> (<span class="params"><span class="keyword">const</span> fn of fns</span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">this</span>.<span class="params">forEach</span>(<span class="params">el =&gt; res.push(<span class="params">fn(<span class="params">el</span>)</span>)</span>)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">  <span class="params">return</span> <span class="params">res</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>åœ¨Haskellä¸­ï¼Œä½¿ç”¨<code>&lt;*&gt;</code>æ¥è¡¨ç¤ºapplyæ“ä½œ: <code>Just (+3) &lt;*&gt; Just 2 == Just 5</code>. Typescriptä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œæ‰€ä»¥å¿½ç•¥.</p><p>Justç±»å‹çš„Applicativeåº”ç”¨å›¾è§£ï¼š</p><p><img src="/images/ts-fam/applicative_just.png" alt></p><p>æ•°ç»„ç±»å‹çš„Applicativeåº”ç”¨å›¾è§£ï¼š</p><p><img src="/images/ts-fam/applicative_list.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">console</span>.log(num.apply([multiply2, add3]))</span><br><span class="line"><span class="comment">// [2, 4, 6, 4, 5, 6]</span></span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œæœ‰ Applicative èƒ½åšåˆ°è€Œ Functor ä¸èƒ½åšåˆ°çš„äº‹æƒ…</strong>ã€‚ å¦‚ä½•å°†ä¸€ä¸ªæ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°åº”ç”¨åˆ°ä¸¤ä¸ªå·²åŒ…è£…çš„å€¼ä¸Šï¼Ÿ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªå‚æ•°çš„Curryå‹åŠ æ³•å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> curriedAddition = <span class="function">(<span class="params">a: <span class="built_in">number</span></span>) =&gt;</span> (b: <span class="built_in">number</span>) =&gt; a + b</span><br><span class="line"></span><br><span class="line">Just.of(<span class="number">5</span>).fmap(curriedAddition) <span class="comment">// è¿”å› `Just.of((b: number) =&gt; 5 + b)`</span></span><br><span class="line"><span class="comment">// Ok ç»§ç»­</span></span><br><span class="line">Just.of(<span class="number">4</span>).fmap(Just.of(<span class="function">(<span class="params">b: <span class="built_in">number</span></span>) =&gt;</span> <span class="number">5</span> + b))  <span class="comment">// âŒä¸è¡Œäº†ï¼ŒæŠ¥é”™äº†ï¼ŒFunctoræ²¡åŠæ³•å¤„ç†åŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„fn</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯Applicativeå¯ä»¥ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">5</span>).fmap(curriedAddition) <span class="comment">// è¿”å› `Just.of((b: number) =&gt; 5 + b)`</span></span><br><span class="line"><span class="comment">// âœ…å½“å½“å½“</span></span><br><span class="line">Just.of(<span class="number">3</span>).apply(Just.of(<span class="function">(<span class="params">b: <span class="built_in">number</span></span>) =&gt;</span> <span class="number">5</span> + b)) <span class="comment">// Just.of(8)</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™Applicative æŠŠ Functor æ¨åˆ°ä¸€è¾¹ã€‚ â€œå¤§äººç‰©å¯ä»¥ä½¿ç”¨å…·æœ‰ä»»æ„æ•°é‡å‚æ•°çš„å‡½æ•°ï¼Œâ€å®ƒè¯´ã€‚ â€œè£…å¤‡äº† &lt;$&gt;(fmap) ä¸ &lt;*&gt;(apply) ä¹‹åï¼Œæˆ‘å¯ä»¥æ¥å—å…·æœ‰ä»»æ„ä¸ªæ•°æœªåŒ…è£…å€¼å‚æ•°çš„ä»»æ„å‡½æ•°ã€‚ ç„¶åæˆ‘ä¼ ç»™å®ƒæ‰€æœ‰å·²åŒ…è£…çš„å€¼ï¼Œè€Œæˆ‘ä¼šå¾—åˆ°ä¸€ä¸ªå·²åŒ…è£…çš„å€¼å‡ºæ¥ï¼ å•Šå•Šå•Šå•Šå•Šï¼â€</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">3</span>).apply(Just.of(<span class="number">5</span>).fmap(curriedAddition)) <span class="comment">// è¿”å› `Just.of(8)`</span></span><br></pre></td></tr></table></figure><p><br></p><h3 id="applicativeæ€»ç»“"><a href="#applicativeæ€»ç»“" class="headerlink" title="Applicativeæ€»ç»“"></a>Applicativeæ€»ç»“</h3><p>æˆ‘ä»¬é‡ç”³ä¸€ä¸ªApplicativeçš„å®šä¹‰, <strong>å¦‚æœFunctorè¦æ±‚å®ç°fmapçš„è¯ï¼ŒApplicativeå°±æ˜¯è¦æ±‚å®ç°apply</strong>ï¼Œapplyç¬¦åˆä»¥ä¸‹å®šä¹‰:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// è¿™æ˜¯Functorçš„fmapå®šä¹‰</span><br><span class="line">&lt;Functor T&gt;.fmap(fn: (v: T) =&gt; U): &lt;Functor U&gt;</span><br><span class="line"></span><br><span class="line">// è¿™æ˜¯Applicativeçš„applyå®šä¹‰ï¼Œå’Œä¸Šé¢å¯¹æ¯”ï¼Œfnå˜æˆäº†ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å‡½æ•°</span><br><span class="line">&lt;Applicative T&gt;.apply(fn: &lt;Applicative (v: T) =&gt; U&gt;): &lt;Applicative U&gt;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="monad"><a href="#monad" class="headerlink" title="Monad"></a>Monad</h2><p>ç»ˆäºç»ƒåˆ°ä¸‰é‡å¤©äº†ï¼ç»§ç»­â›½åŠ æ²¹ï¸</p><p>å¦‚ä½•å­¦ä¹  Monad å‘¢ï¼š</p><ol><li>ä½ è¦å–å¾—è®¡ç®—æœºç§‘å­¦åšå£«å­¦ä½ã€‚</li><li>ç„¶åæŠŠå®ƒæ‰”æ‰ï¼Œå› ä¸ºåœ¨æœ¬æ–‡ä½ å¹¶ä¸éœ€è¦å®ƒï¼</li></ol><p>Monad å¢åŠ äº†ä¸€ä¸ªæ–°çš„è½¬å˜ã€‚</p><p><code>Functor</code> å°†ä¸€ä¸ª<code>å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šï¼š</p><p><img src="/images/ts-fam/fmap.png" alt></p><p><code>Applicative</code> å°†ä¸€ä¸ª<code>å·²åŒ…è£…çš„å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šï¼š</p><p><img src="/images/ts-fam/applicative.png" alt></p><p>Monad å°†ä¸€ä¸ª<code>è¿”å›å·²åŒ…è£…å€¼çš„å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚ Monad å®šä¹‰ä¸€ä¸ªå‡½æ•°<code>flatMap</code>ï¼ˆåœ¨ Haskell ä¸­æ˜¯ä½¿ç”¨æ“ä½œç¬¦ <code>&gt;&gt;=</code> æ¥åº”ç”¨Monadï¼Œè¯»ä½œâ€œbindâ€ï¼‰æ¥åšè¿™ä¸ªã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸ªç¤ºä¾‹ã€‚ è€æ­æ¡£ Maybe æ˜¯ä¸€ä¸ª Monadï¼š</p><p><img src="/images/ts-fam/context.png" alt></p><p>å‡è®¾ <code>half</code> æ˜¯ä¸€ä¸ªåªé€‚ç”¨äºå¶æ•°çš„å‡½æ•°ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„: "è¿”å›å·²åŒ…è£…å€¼"çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">half</span>(<span class="params">value: <span class="built_in">number</span></span>): <span class="title">Maybe</span>&lt;<span class="title">number</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value % <span class="number">2</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Just.of(value / <span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> None</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/half.png" alt></p><p>å¦‚æœæˆ‘ä»¬å–‚ç»™å®ƒä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¼šæ€æ ·ï¼Ÿ</p><p><img src="/images/ts-fam/half_ouch.png" alt></p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨flatMap(Haskell ä¸­çš„&gt;&gt;=)æ¥å°†æˆ‘ä»¬å·²åŒ…è£…çš„å€¼å¡è¿›è¯¥å‡½æ•°ã€‚ è¿™æ˜¯ &gt;&gt;= çš„ç…§ç‰‡ï¼š</p><p><img src="/images/ts-fam/plunger.jpg" alt></p><p>ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œæ–¹å¼ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">3</span>).flatMap(half) <span class="comment">// =&gt; Nothing, Haskellä¸­ä½¿ç”¨æ“ä½œç¬¦è¿™æ ·æ“ä½œ: Just 3 &gt;&gt;= half</span></span><br><span class="line">Just.of(<span class="number">4</span>).flatMap(half) <span class="comment">// =&gt; Just 2</span></span><br><span class="line">None.flatMap(half)       <span class="comment">// =&gt; Nothing</span></span><br></pre></td></tr></table></figure><p>å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å†çœ‹çœ‹flatMapçš„æ–¹æ³•ç­¾å:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Maybe</span></span><br><span class="line">Maybe&lt;T&gt;.flatMap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">val: T</span>) =&gt; Maybe&lt;U&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">U</span>&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="params">Array</span></span></span><br><span class="line"><span class="function"><span class="params">Array</span>&lt;<span class="params">T</span>&gt;.<span class="params">flatMap</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: (<span class="params">val: T</span>) =&gt; U[]</span>): <span class="params">U</span>[]</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/bind_def.png" alt></p><p><strong>Arrayæ˜¯ä¸€ä¸ªMonad</strong>, Javascriptçš„Arrayçš„flatMapå·²ç»æ­£å¼æˆä¸ºæ ‡å‡†ï¼Œ çœ‹çœ‹å®ƒçš„ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">arr1.map(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]); </span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br><span class="line"></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]);</span><br><span class="line"><span class="comment">// [2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// only one level is flattened</span></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [[x * <span class="number">2</span>]]);</span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br></pre></td></tr></table></figure><p><br></p><p>Maybe ä¹Ÿæ˜¯ä¸€ä¸ª Monadï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> None &#123;</span><br><span class="line">  <span class="keyword">static</span> flatMap(fn: <span class="built_in">any</span>): Nothing &#123;</span><br><span class="line">    <span class="keyword">return</span> None;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Just&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// å’Œä¸Šé¢çš„applyå·®ä¸å¤š</span></span><br><span class="line">  <span class="comment">// ä½¿ç”¨æ–¹æ³•é‡è½½ï¼Œè®©Typescriptæ›´å¥½æ¨æ–­</span></span><br><span class="line">  <span class="comment">// å¦‚æœå‡½æ•°è¿”å›Justç±»å‹ï¼Œç»“æœä¹Ÿæ˜¯Justç±»å‹</span></span><br><span class="line">  flatMap&lt;U&gt;<span class="function">(<span class="params">fn: (<span class="params">a: T</span>) =&gt; Just&lt;U&gt;</span>): <span class="params">Just</span>&lt;<span class="params">U</span>&gt;;</span></span><br><span class="line"><span class="function">  // å¦‚æœå‡½æ•°è¿”å›å€¼æ˜¯<span class="params">Nothing</span>ç±»å‹ï¼Œç»“æœæ˜¯<span class="params">Nothing</span>.</span></span><br><span class="line"><span class="function">  <span class="params">flatMap</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: (<span class="params">a: T</span>) =&gt; Nothing</span>): <span class="params">Nothing</span>;</span></span><br><span class="line"><span class="function">  // å¦‚æœå‡½æ•°è¿”å›å€¼æ˜¯<span class="params">Maybe</span>ç±»å‹, è¿”å›ä¸€ä¸ª<span class="params">Maybe</span>ç±»å‹</span></span><br><span class="line"><span class="function">  <span class="params">flatMap</span>&lt;<span class="params">U</span>&gt;(<span class="params">fn: (<span class="params">a: T</span>) =&gt; Maybe&lt;U&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">U</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">fn</span>(<span class="params"><span class="keyword">this</span>.value</span>)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="params">Just</span>.<span class="params">of</span>(<span class="params">3</span>).<span class="params">flatMap</span>(<span class="params">half</span>) // <span class="params">Nothing</span></span></span><br><span class="line"><span class="function"><span class="params">Just</span>.<span class="params">of</span>(<span class="params">4</span>).<span class="params">flatMap</span>(<span class="params">half</span>) // <span class="params">Just</span>.<span class="params">of</span>(<span class="params">4</span>)</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ Just 3 è¿ä½œçš„æƒ…å†µï¼</p><p><img src="/images/ts-fam/monad_just.png" alt></p><p>å¦‚æœä¼ å…¥ä¸€ä¸ª Nothing å°±æ›´ç®€å•äº†ï¼š</p><p><img src="/images/ts-fam/monad_nothing.png" alt></p><p>ä½ è¿˜å¯ä»¥å°†è¿™äº›è°ƒç”¨ä¸²è”èµ·æ¥ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Just.of(<span class="number">20</span>).flatMap(half).flatMap(half).flatMap(falf) <span class="comment">// =&gt; Nothing</span></span><br></pre></td></tr></table></figure><p><img src="/images/ts-fam/monad_chain.png" alt><br><img src="/images/ts-fam/whoa.png" alt></p><p><br></p><p>å¾ˆç‚«é…·å“ˆï¼æ‰€ä»¥æˆ‘ä»¬ç°åœ¨çŸ¥é“Maybeæ—¢æ˜¯ä¸€ä¸ªFunctorã€Applicativeï¼Œè¿˜æ˜¯ä¸€ä¸ªMonadã€‚</p><p>åŸæ–‡è¿˜ç¤ºèŒƒäº†å¦ä¸€ä¸ªä¾‹å­: <code>IO</code> Monad, æˆ‘ä»¬è¿™é‡Œå°±ç®€å•äº†è§£ä¸€ä¸‹</p><p><img src="/images/ts-fam/io.png" alt></p><p>IOçš„ç­¾åå¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> IO&lt;T&gt; &#123;</span><br><span class="line">  val: T</span><br><span class="line">  <span class="comment">// å…·ä½“å®ç°æˆ‘ä»¬æš‚ä¸å…³å¿ƒ</span></span><br><span class="line">  flatMap(fn: <span class="function">(<span class="params">val: T</span>) =&gt;</span> IO&lt;U&gt;): IO&lt;U&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ¥çœ‹ä¸‰ä¸ªå‡½æ•°ã€‚ getLine æ²¡æœ‰å‚æ•°, ç”¨æ¥è·å–ç”¨æˆ·è¾“å…¥ï¼š</p><p><img src="/images/ts-fam/getLine.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLine</span>(<span class="params"></span>): <span class="title">IO</span>&lt;<span class="title">string</span>&gt;</span></span><br></pre></td></tr></table></figure><p>readFile æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ–‡ä»¶åï¼‰å¹¶è¿”å›è¯¥æ–‡ä»¶çš„å†…å®¹ï¼š</p><p><img src="/images/ts-fam/readFile.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">filename: <span class="built_in">string</span></span>): <span class="title">IO</span>&lt;<span class="title">string</span>&gt;</span></span><br></pre></td></tr></table></figure><p>putStrLn è¾“å‡ºå­—ç¬¦ä¸²åˆ°æ§åˆ¶å°ï¼š</p><p><img src="/images/ts-fam/putStrLn.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">putStrLn</span>(<span class="params">str: <span class="built_in">string</span></span>): <span class="title">IO</span>&lt;<span class="title">void</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰è¿™ä¸‰ä¸ªå‡½æ•°éƒ½æ¥å—æ™®é€šå€¼ï¼ˆæˆ–æ— å€¼ï¼‰å¹¶è¿”å›ä¸€ä¸ªå·²åŒ…è£…çš„å€¼ï¼Œå³IOã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ flatMap å°†å®ƒä»¬ä¸²è”èµ·æ¥ï¼</p><p><img src="/images/ts-fam/monad_io.png" alt></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">getLine().flatMap(readFile).flatMap(putStrLn)</span><br></pre></td></tr></table></figure><p>å¤ªæ£’äº†ï¼ å‰æ’å åº§æ¥çœ‹ monad å±•ç¤ºï¼æˆ‘ä»¬ä¸éœ€è¦åœ¨å–æ¶ˆåŒ…è£…å’Œé‡æ–°åŒ…è£… IO monad çš„å€¼ä¸Šæµªè´¹æ—¶é—´. flatMap ä¸ºæˆ‘ä»¬åšäº†é‚£äº›å·¥ä½œ!</p><p>Haskell è¿˜ä¸º monad æä¾›äº†è¯­æ³•ç³–, å«åš do è¡¨è¾¾å¼:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">foo</span> = <span class="keyword">do</span></span><br><span class="line">    filename &lt;- getLine</span><br><span class="line">    contents &lt;- readFile filename</span><br><span class="line">    putStrLn contents</span><br></pre></td></tr></table></figure><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>functor æ˜¯å®ç°äº† <code>fmap</code> çš„æ•°æ®ç±»å‹ã€‚</li><li>applicative æ˜¯å®ç°äº† <code>apply</code> çš„æ•°æ®ç±»å‹ã€‚</li><li>monad æ˜¯å®ç°äº† <code>flatMap</code> çš„æ•°æ®ç±»å‹ã€‚</li><li>Maybe å®ç°äº†è¿™ä¸‰è€…ï¼Œæ‰€ä»¥å®ƒæ˜¯ functorã€ applicativeã€ ä»¥åŠ monadã€‚</li></ol><p>è¿™ä¸‰è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p><img src="/images/ts-fam/recap.png" alt></p><ol><li><strong>functor</strong>: å¯é€šè¿‡ fmap å°†ä¸€ä¸ª<code>å‡½æ•°</code>åº”ç”¨åˆ°ä¸€ä¸ª<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚</li><li><strong>applicative</strong>: å¯é€šè¿‡ apply å°†ä¸€ä¸ª<code>å·²åŒ…è£…çš„å‡½æ•°</code>åº”ç”¨åˆ°<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚</li><li><strong>monad</strong>: å¯é€šè¿‡ flatMap å°†ä¸€ä¸ª<code>è¿”å›å·²åŒ…è£…å€¼çš„å‡½æ•°</code>åº”ç”¨åˆ°<code>å·²åŒ…è£…çš„å€¼</code>ä¸Šã€‚</li></ol><p>ç»¼åˆèµ·æ¥çœ‹çœ‹å®ƒä»¬çš„ç­¾åï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// è¿™æ˜¯Functorçš„fmapå®šä¹‰</span><br><span class="line">&lt;Functor T&gt;.fmap(fn: (v: T) =&gt; U): &lt;Functor U&gt;</span><br><span class="line"></span><br><span class="line">// è¿™æ˜¯Applicativeçš„applyå®šä¹‰ï¼Œå’Œä¸Šé¢å¯¹æ¯”ï¼Œfnå˜æˆäº†ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å‡½æ•°</span><br><span class="line">&lt;Applicative T&gt;.apply(fn: &lt;Applicative (v: T) =&gt; U&gt;): &lt;Applicative U&gt;</span><br><span class="line"></span><br><span class="line">// Monadçš„å®šä¹‰, è€Œæ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œ è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…è£…åœ¨ä¸Šä¸‹æ–‡çš„å€¼</span><br><span class="line">&lt;Monad T&gt;.flatmap(fn: (v: T) =&gt; &lt;Monad U&gt;): &lt;Monad U&gt;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œäº²çˆ±çš„æœ‹å‹ï¼ˆæˆ‘è§‰å¾—æˆ‘ä»¬ç°åœ¨æ˜¯æœ‹å‹äº†ï¼‰ï¼Œæˆ‘æƒ³æˆ‘ä»¬éƒ½åŒæ„ monad æ˜¯ä¸€ä¸ªç®€å•ä¸”é«˜æ˜çš„ä¸»æ„ï¼ˆSMART IDEA(tm)ï¼‰ã€‚ ç°åœ¨ä½ å·²ç»é€šè¿‡è¿™ç¯‡æŒ‡å—æ¶¦æ¹¿äº†ä½ çš„å£å“¨ï¼Œä¸ºä»€ä¹ˆä¸æ‹‰ä¸Š Mel Gibson å¹¶æŠ“ä½æ•´ä¸ªç“¶å­å‘¢ã€‚ å‚é˜…ã€ŠHaskell è¶£å­¦æŒ‡å—ã€‹çš„ã€Šæ¥çœ‹çœ‹å‡ ç§ Monadã€‹ã€‚ å¾ˆå¤šä¸œè¥¿æˆ‘å…¶å®æ©é¥°äº†å› ä¸º Miran æ·±å…¥è¿™æ–¹é¢åšå¾—å¾ˆæ£’.</p><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>æœ¬æ–‡åœ¨<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" target="_blank" rel="noopener">åŸæ–‡</a>çš„åŸºç¡€ä¸Š, å‚è€ƒäº†ä¸‹åˆ—è¿™äº›ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†æ¬¡æ„Ÿè°¢è¿™äº›ä½œè€…:</p><ul><li><a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html#translations" target="_blank" rel="noopener">Functors, Applicatives, And Monads In Pictures</a> - åŸæ–‡</li><li><a href="http://www.mokacoding.com/blog/functor-applicative-monads-in-pictures/" target="_blank" rel="noopener">Swift Functors, Applicatives, and Monads in Pictures</a> - Swiftç‰ˆæœ¬, æœ¬æ–‡ä¸»è¦å‚è€ƒè¿™ç¯‡æ–‡ç« </li><li><a href="https://hltj.me/kotlin/2017/08/25/kotlin-functor-applicative-monad-cn.html" target="_blank" rel="noopener">Kotlin ç‰ˆå›¾è§£ Functorã€Applicative ä¸ Monad</a> - Kotlinç‰ˆæœ¬ï¼Œç¿»è¯‘éå¸¸æ£’</li><li><a href="http://jiyinyiyong.github.io/monads-in-pictures/" target="_blank" rel="noopener">Functor, Applicative, ä»¥åŠ Monad çš„å›¾ç‰‡é˜é‡Š</a> - ä¸­æ–‡ç‰ˆæœ¬ï¼Œ<strong>é¢˜å¶</strong>ç¿»è¯‘</li><li><a href="https://medium.com/@lettier/your-easy-guide-to-monads-applicatives-functors-862048d61610" target="_blank" rel="noopener">Your easy guide to Monads, Applicatives, &amp; Functors</a> - Mediumä¸Šä¸€ç¯‡åŠ¨å›¾å›¾è§£Monadçš„æ–‡ç« ï¼Œå†™å¾—ä¹Ÿä¸é”™. è¯»å®Œæœ¬æ–‡å¯ä»¥å†è¯»è¿™ç¯‡æ–‡ç« </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡æ˜¯ç»å…¸çš„&lt;a href=&quot;http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Functo
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>2019å¹´äº†ï¼Œæ•´ç†äº†Nä¸ªå®ç”¨æ¡ˆä¾‹å¸®ä½ å¿«é€Ÿè¿ç§»åˆ°React Hooks(æ”¶è—æ…¢æ…¢çœ‹ç³»åˆ—)</title>
    <link href="https://bobi.ink/2019/08/10/react-hooks/"/>
    <id>https://bobi.ink/2019/08/10/react-hooks/</id>
    <published>2019-08-09T16:00:00.000Z</published>
    <updated>2019-08-18T06:14:32.162Z</updated>
    
    <content type="html"><![CDATA[<p><br></p><p><img src="/images/react-hooks/cover.png" alt></p><p><br></p><p>åœ¨<a href="https://www.youtube.com/channel/UCz5vTaEhvh7dOHEyd1efcaQ" target="_blank" rel="noopener">React Conf 2018</a>å®£å¸ƒReact Hooksåï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´å¼€å§‹å°è¯•ä½¿ç”¨React Hooksï¼Œç°åœ¨æ–°é¡¹ç›®åŸºæœ¬ä¸å†™Classç»„ä»¶äº†ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒç¡®å®è®©æˆ‘çš„å¼€å‘æ•ˆç‡æé«˜äº†å¾ˆå¤šï¼Œæ”¹å˜äº†å·²æœ‰çš„ç»„ä»¶å¼€å‘æ€ç»´å’Œæ¨¡å¼.</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-3" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a>ä¸­å·²ç»æ€»ç»“è¿‡<strong>React Hooksçš„æ„ä¹‰ï¼Œä»¥åŠä¸€äº›åº”ç”¨åœºæ™¯</strong>ã€‚</p><p>é‚£è¿™ç¯‡æ–‡ç« å°±å®Œå…¨æ˜¯ä»‹ç»<strong>React Hooksçš„åº”ç”¨å®ä¾‹</strong>ï¼Œåˆ—ä¸¾äº†æˆ‘ä½¿ç”¨React Hooksçš„ä¸€äº›å®è·µã€‚ å¸Œæœ›é€šè¿‡è¿™äº›æ¡ˆä¾‹ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿç†Ÿç»ƒï¼Œå¹¶è¿ç§»åˆ°React Hookså¼€å‘æ¨¡å¼. </p><blockquote><p><strong>æ–‡ç« ç¯‡å¹…å¾ˆé•¿ï¼Œå»ºè®®æ”¶è—ä¸çœ‹, è‡³å°‘çœ‹çœ‹ç›®å½•å§</strong></p></blockquote><p><br></p><p>æŠŠä¹‹å‰æ–‡ç« æ•´ç†çš„<code>React Hooksåº”ç”¨åœºæ™¯</code>æ€»ç»“æ‹¿è¿‡æ¥, æœ¬æ–‡åŸºæœ¬æŒ‰ç…§<strong>è¿™ä¸ªèŒƒå›´è¿›è¡Œç»„ç»‡</strong>:</p><p><img src="/images/react-hooks/apply.png" alt></p><p><br></p><p><strong>å¦‚æœä½ æƒ³è¦äº†è§£React Hooksçš„åŸç†å¯ä»¥é˜…è¯»è¿™äº›æ–‡ç« </strong>:</p><ul><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fmedium.com%2F%40ryardley%2Freact-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a></li><li><a href="https://juejin.im/post/5cfa29e151882539c33e4f5e#heading-8" target="_blank" rel="noopener">ä»Preactä¸­äº†è§£ç»„ä»¶å’ŒhooksåŸºæœ¬åŸç†</a></li></ul><p><br></p><p><strong>ç›®å½•ç´¢å¼•</strong></p><!-- TOC --><ul><li><a href="#1-ç»„ä»¶çŠ¶æ€"><strong>1. ç»„ä»¶çŠ¶æ€</strong></a><ul><li><a href="#1-1-usesetstate-æ¨¡æ‹Ÿä¼ ç»Ÿçš„setstate">1-1 useSetState æ¨¡æ‹Ÿä¼ ç»Ÿçš„setState</a></li><li><a href="#1-2-usereducer-reduxé£æ ¼çŠ¶æ€ç®¡ç†">1-2 useReducer Reduxé£æ ¼çŠ¶æ€ç®¡ç†</a></li><li><a href="#1-3-useforceupdate-å¼ºåˆ¶é‡æ–°æ¸²æŸ“">1-3 useForceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“</a></li><li><a href="#1-4-usestorage-ç®€åŒ–localstorageå­˜å–">1-4 useStorage ç®€åŒ–localStorageå­˜å–</a></li><li><a href="#1-5-userefstate-å¼•ç”¨stateçš„æœ€æ–°å€¼">1-5 useRefState å¼•ç”¨stateçš„æœ€æ–°å€¼</a><ul><li><a href="#1-5-1-æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—">1-5-1 æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—?</a></li></ul></li><li><a href="#1-6-userefprops-å¼•ç”¨æœ€æ–°çš„props">1-6 useRefProps å¼•ç”¨æœ€æ–°çš„Props</a></li><li><a href="#1-7-useinstance-å®ä¾‹å˜é‡å­˜å–">1-7 useInstance â€˜å®ä¾‹â€™å˜é‡å­˜å–</a></li><li><a href="#1-9-useprevious-è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼">1-9 usePrevious è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼</a></li><li><a href="#1-10-useimmer-ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ">1-10 useImmer ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ</a></li><li><a href="#1-11-å°è£…å·¥å…·hooksç®€åŒ–stateçš„æ“ä½œ">1-11 å°è£…â€™å·¥å…·Hooksâ€™ç®€åŒ–Stateçš„æ“ä½œ</a><ul><li><a href="#1-11-1-usetoggle-å¼€å…³">1-11-1 useToggle å¼€å…³</a></li><li><a href="#1-11-2-usearray-ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ">1-11-2 useArray ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ</a></li></ul></li></ul></li><li><a href="#2-æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°"><strong>2. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong></a><ul><li><a href="#2-1-useonmount-æ¨¡æ‹Ÿcomponentdidmount">2-1 useOnMount æ¨¡æ‹ŸcomponentDidMount</a></li><li><a href="#2-2-useonunmount-æ¨¡æ‹Ÿcomponentwillunmount">2-2 useOnUnmount æ¨¡æ‹ŸcomponentWillUnmount</a></li><li><a href="#2-3-useonupdate-æ¨¡æ‹Ÿcomponentdidupdate">2-3 useOnUpdate æ¨¡æ‹ŸcomponentDidUpdate</a></li></ul></li><li><a href="#3-äº‹ä»¶å¤„ç†"><strong>3. äº‹ä»¶å¤„ç†</strong></a><ul><li><a href="#3-1-usechange-ç®€åŒ–onchangeè¡¨å•åŒå‘ç»‘å®š">3-1 useChange ç®€åŒ–onChangeè¡¨å•åŒå‘ç»‘å®š</a></li><li><a href="#3-2-usebind-ç»‘å®šå›è°ƒå‚æ•°">3-2 useBind ç»‘å®šå›è°ƒå‚æ•°</a></li><li><a href="#3-3-è‡ªå®šä¹‰äº‹ä»¶å°è£…">3-3 è‡ªå®šä¹‰äº‹ä»¶å°è£…</a><ul><li><a href="#3-3-1-useactive">3-3-1 useActive</a></li><li><a href="#3-3-2-usetouch-æ‰‹åŠ¿äº‹ä»¶å°è£…">3-3-2 useTouch æ‰‹åŠ¿äº‹ä»¶å°è£…</a></li><li><a href="#3-3-3-usedraggable-æ‹–æ‹½äº‹ä»¶å°è£…">3-3-3 useDraggable æ‹–æ‹½äº‹ä»¶å°è£…</a></li><li><a href="#3-3-4-react-events-é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…">3-3-4 react-events é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…</a></li></ul></li><li><a href="#3-4-usesubscription-é€šç”¨äº‹ä»¶æºè®¢é˜…">3-4 useSubscription é€šç”¨äº‹ä»¶æºè®¢é˜…</a></li><li><a href="#3-5-useobservable-hookså’Œrxjsä¼˜é›…çš„ç»“åˆrxjs-hooks">3-5 useObservable Hookså’ŒRxJSä¼˜é›…çš„ç»“åˆ(rxjs-hooks)</a></li><li><a href="#3-6-useeventemitter-å¯¹æ¥eventemitter">3-6 useEventEmitter å¯¹æ¥eventEmitter</a></li></ul></li><li><a href="#4-contextçš„å¦™ç”¨"><strong>4. Contextçš„å¦™ç”¨</strong></a><ul><li><a href="#4-1-usetheme-ä¸»é¢˜é…ç½®">4-1 useTheme ä¸»é¢˜é…ç½®</a></li><li><a href="#4-2-unstated-ç®€å•çŠ¶æ€ç®¡ç†å™¨">4-2 unstated ç®€å•çŠ¶æ€ç®¡ç†å™¨</a></li><li><a href="#4-3-usei18n-å›½é™…åŒ–">4-3 useI18n å›½é™…åŒ–</a></li><li><a href="#4-4-userouter-ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®">4-4 useRouter ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®</a></li><li><a href="#4-5-react-hook-form-hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±">4-5 react-hook-form Hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±?</a></li></ul></li><li><a href="#5-å‰¯ä½œç”¨å°è£…"><strong>5. å‰¯ä½œç”¨å°è£…</strong></a><ul><li><a href="#5-1-usetimeout-è¶…æ—¶ä¿®æ”¹çŠ¶æ€">5-1 useTimeout è¶…æ—¶ä¿®æ”¹çŠ¶æ€</a></li><li><a href="#5-2-useonlinestatus-ç›‘å¬åœ¨çº¿çŠ¶æ€">5-2 useOnlineStatus ç›‘å¬åœ¨çº¿çŠ¶æ€</a></li></ul></li><li><a href="#6-å‰¯ä½œç”¨è¡ç”Ÿ"><strong>6. å‰¯ä½œç”¨è¡ç”Ÿ</strong></a><ul><li><a href="#6-1-usetitle-è®¾ç½®æ–‡æ¡£title">6-1 useTitle è®¾ç½®æ–‡æ¡£title</a></li><li><a href="#6-2-usedebounce">6-2 useDebounce</a></li><li><a href="#6-3-usethrottle">6-3 useThrottle</a></li></ul></li><li><a href="#7-ç®€åŒ–ä¸šåŠ¡é€»è¾‘"><strong>7. ç®€åŒ–ä¸šåŠ¡é€»è¾‘</strong></a><ul><li><a href="#7-1-usepromise-å°è£…å¼‚æ­¥è¯·æ±‚">7-1 usePromise å°è£…å¼‚æ­¥è¯·æ±‚</a></li><li><a href="#7-2-usepromiseeffect-è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚">7-2 usePromiseEffect è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚</a></li><li><a href="#7-3-useinfinitelist-å®ç°æ— é™åŠ è½½åˆ—è¡¨">7-3 useInfiniteList å®ç°æ— é™åŠ è½½åˆ—è¡¨</a></li><li><a href="#7-4-usepoll-ç”¨hookå®ç°è½®è¯¢">7-4 usePoll ç”¨hookå®ç°è½®è¯¢</a></li><li><a href="#7-5-ä¸šåŠ¡é€»è¾‘æŠ½ç¦»">7-5 ä¸šåŠ¡é€»è¾‘æŠ½ç¦»</a></li></ul></li><li><a href="#8-å¼€è„‘æ´"><strong>8. å¼€è„‘æ´</strong></a><ul><li><a href="#8-1-usescript-hooks--suspend--â¤ï¸">8-1 useScript: Hooks + Suspend = â¤ï¸</a></li><li><a href="#8-2-usemodal-æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†">8-2 useModal æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†</a></li></ul></li><li><a href="#react-hooks-æŠ€æœ¯åœ°å›¾"><strong>React Hooks æŠ€æœ¯åœ°å›¾</strong></a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li></ul><!-- /TOC --><p><br></p><h2 id="1-ç»„ä»¶çŠ¶æ€"><a href="#1-ç»„ä»¶çŠ¶æ€" class="headerlink" title="1. ç»„ä»¶çŠ¶æ€"></a><strong>1. ç»„ä»¶çŠ¶æ€</strong></h2><p>Reactæä¾›äº†ä¸€ä¸ªå¾ˆåŸºæœ¬çš„ç»„ä»¶çŠ¶æ€è®¾ç½®Hook:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = useState(initialState);</span><br></pre></td></tr></table></figure><p><a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usestate" target="_blank" rel="noopener">useState</a>è¿”å›<strong>ä¸€ä¸ªstateï¼Œä»¥åŠæ›´æ–°stateçš„å‡½æ•°</strong>. setStateå¯ä»¥æ¥å—ä¸€ä¸ªæ–°çš„å€¼ï¼Œä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“.</p><blockquote><p><strong>Reactä¼šç¡®ä¿setStateå‡½æ•°æ˜¯ç¨³å®šçš„ï¼Œä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜</strong>ã€‚ä¸‹é¢çš„useReducerçš„dispatchå‡½æ•°ã€useRefçš„currentå±æ€§ä¹Ÿä¸€æ ·ã€‚<br><strong>è¿™å°±æ„å‘³ç€setStateã€dispatchã€ref.current, å¯ä»¥å®‰å…¨åœ°åœ¨useEffectã€useMemoã€ useCallbackä¸­å¼•ç”¨</strong></p></blockquote><p><br></p><h3 id="1-1-usesetstate-æ¨¡æ‹Ÿä¼ ç»Ÿçš„setstate"><a href="#1-1-usesetstate-æ¨¡æ‹Ÿä¼ ç»Ÿçš„setstate" class="headerlink" title="1-1 useSetState æ¨¡æ‹Ÿä¼ ç»Ÿçš„setState"></a>1-1 useSetState æ¨¡æ‹Ÿä¼ ç»Ÿçš„setState</h3><p>useStateå’ŒClassç»„ä»¶çš„setStateä¸å¤ªä¸€æ ·.</p><p>Classç»„ä»¶çš„stateå±æ€§ä¸€èˆ¬æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨setStateæ—¶ï¼Œä¼šæµ…æ‹·è´åˆ°stateå±æ€§, å¹¶è§¦å‘æ›´æ–°, æ¯”å¦‚:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    name: <span class="string">'_sx_'</span>,</span><br><span class="line">    age: <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleIncrementAge = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åªæ›´æ–°age</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;<span class="attr">age</span>: <span class="keyword">this</span>.state.age + <span class="number">1</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è€Œ<strong>useStateä¼šç›´æ¥è¦†ç›–stateå€¼</strong>ã€‚ä¸ºäº†å®ç°å’ŒsetStateä¸€æ ·çš„æ•ˆæœ, å¯ä»¥è¿™æ ·å­åš:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;name: <span class="string">'sx'</span>, age: <span class="number">10</span>&#125;</span><br><span class="line"><span class="keyword">const</span> MyComp: FC = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(initialState)</span><br><span class="line">  <span class="keyword">const</span> handleIncrementAge = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// setStateæ–¹æ³•æ”¯æŒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–æœ€æ–°çš„stateå€¼</span></span><br><span class="line">    <span class="comment">// ç„¶åä½¿ç”¨...æ“ä½œç¬¦å®ç°å¯¹è±¡æµ…æ‹·è´</span></span><br><span class="line">    setState(<span class="function">(<span class="params">prevState</span>) =&gt;</span> (&#123;...preState, age: prevState.age + <span class="number">1</span>&#125;) )</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Okï¼Œç°åœ¨æŠŠå®ƒå°è£…æˆé€šç”¨çš„hooksï¼Œåœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨ã€‚è¿™æ—¶å€™å°±ä½“ç°å‡ºæ¥Hookså¼ºå¤§çš„é€»è¾‘æŠ½è±¡èƒ½åŠ›ï¼š<strong>Hooks æ—¨åœ¨è®©ç»„ä»¶çš„å†…éƒ¨é€»è¾‘ç»„ç»‡æˆå¯å¤ç”¨çš„æ›´å°å•å…ƒï¼Œè¿™äº›å•å…ƒå„è‡ªç»´æŠ¤ä¸€éƒ¨åˆ†ç»„ä»¶â€˜çŠ¶æ€å’Œé€»è¾‘â€™</strong></p><p>çœ‹çœ‹æˆ‘ä»¬çš„<code>useSetState</code>, æˆ‘ä¼šä½¿ç”¨Typescriptè¿›è¡Œä»£ç ç¼–å†™:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useSetState</span>&lt;<span class="title">S</span> <span class="title">extends</span> <span class="title">object</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  initalState: S | ((</span>) =&gt; <span class="title">S</span>),</span></span><br><span class="line">): [S, (state: Partial&lt;S&gt; | ((state: S) =&gt; Partial&lt;S&gt;)) =&gt; void] &#123;</span><br><span class="line">  <span class="keyword">const</span> [_state, _setState] = useState&lt;S&gt;(initalState)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setState = useCallback(<span class="function">(<span class="params">state: Partial&lt;S&gt; | ((state: S</span>) =&gt;</span> Partial&lt;S&gt;)) =&gt; &#123;</span><br><span class="line">    _setState(<span class="function">(<span class="params">prev: S</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> nextState = state</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> state === <span class="string">'function'</span>) &#123;</span><br><span class="line">        nextState = state(prev)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123; ...prev, ...nextState &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [_state, setState]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ------</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UseSetState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useSetState&lt;&#123; <span class="attr">name</span>: string; age: number &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">'sx'</span>, <span class="attr">age</span>: <span class="number">1</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> incrementAge = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setState(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123; <span class="attr">age</span>: prev.age + <span class="number">1</span> &#125;))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div onClick=&#123;incrementAge&#125;&gt;</span><br><span class="line">      &#123;state.name&#125;: &#123;state.age&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>hookså‘½åä»¥<code>use</code>ä¸ºå‰ç¼€</p></blockquote><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-2-usereducer-reduxé£æ ¼çŠ¶æ€ç®¡ç†"><a href="#1-2-usereducer-reduxé£æ ¼çŠ¶æ€ç®¡ç†" class="headerlink" title="1-2 useReducer Reduxé£æ ¼çŠ¶æ€ç®¡ç†"></a>1-2 useReducer Reduxé£æ ¼çŠ¶æ€ç®¡ç†</h3><p>å¦‚æœç»„ä»¶çŠ¶æ€æ¯”è¾ƒå¤æ‚ï¼Œæ¨èä½¿ç”¨useReduceræ¥ç®¡ç†çŠ¶æ€ã€‚å¦‚æœä½ ç†Ÿæ‚‰Reduxï¼Œä¼šå¾ˆä¹ æƒ¯è¿™ç§æ–¹å¼ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰åˆå§‹çŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰Reducer</span></span><br><span class="line"><span class="comment">// ruduceræ¥å—å½“å‰stateï¼Œä»¥åŠä¸€ä¸ªç”¨æˆ·æ“ä½œï¼Œè¿”å›ä¸€ä¸ª'æ–°'çš„state</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'increment'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.count + <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'decrement'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.count - <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å›stateï¼Œä»¥åŠdispatchå‡½æ•°</span></span><br><span class="line">  <span class="comment">// dispatchå‡½æ•°å¯ä»¥è§¦å‘reduceræ‰§è¡Œï¼Œç»™reducerä¼ é€’æŒ‡ä»¤å’Œè½½è·</span></span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;state.count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; dispatch(&#123;<span class="attr">type</span>: <span class="string">'increment'</span>&#125;)&#125;&gt;+<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">      &lt;button onClick=&#123;() =&gt; dispatch(&#123;<span class="attr">type</span>: <span class="string">'decrement'</span>&#125;)&#125;&gt;-<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>äº†è§£æ›´å¤šreducerçš„æ€æƒ³å¯ä»¥å‚è€ƒ<a href="https://redux.js.org/basics/reducers" target="_blank" rel="noopener">Reduxæ–‡æ¡£</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-3-useforceupdate-å¼ºåˆ¶é‡æ–°æ¸²æŸ“"><a href="#1-3-useforceupdate-å¼ºåˆ¶é‡æ–°æ¸²æŸ“" class="headerlink" title="1-3 useForceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“"></a>1-3 useForceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“</h3><p>Classç»„ä»¶å¯ä»¥é€šè¿‡<code>forceUpdate</code>å®ä¾‹æ–¹æ³•æ¥è§¦å‘å¼ºåˆ¶é‡æ–°æ¸²æŸ“ã€‚ä½¿ç”¨useStateä¹Ÿå¯ä»¥æ¨¡æ‹Ÿç›¸åŒçš„æ•ˆæœï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useForceUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [, setValue] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é€’å¢stateå€¼ï¼Œå¼ºåˆ¶Reactè¿›è¡Œé‡æ–°æ¸²æŸ“</span></span><br><span class="line">    setValue(<span class="function"><span class="params">val</span> =&gt;</span> (val + <span class="number">1</span>) % (<span class="built_in">Number</span>.MAX_SAFE_INTEGER - <span class="number">1</span>))</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ForceUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> forceUpdate = useForceUpdate()</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    somethingChange(forceUpdate)</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-4-usestorage-ç®€åŒ–localstorageå­˜å–"><a href="#1-4-usestorage-ç®€åŒ–localstorageå­˜å–" class="headerlink" title="1-4 useStorage ç®€åŒ–localStorageå­˜å–"></a>1-4 useStorage ç®€åŒ–localStorageå­˜å–</h3><p>é€šè¿‡è‡ªå®šä¹‰Hooksï¼Œå¯ä»¥å°†çŠ¶æ€ä»£ç†åˆ°å…¶ä»–æ•°æ®æºï¼Œæ¯”å¦‚localStorageã€‚ ä¸‹é¢æ¡ˆä¾‹å±•ç¤ºå¦‚æœä½¿ç”¨Hookså°è£…å’Œç®€åŒ–localStorageçš„å­˜å–:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useCallback, Dispatch, SetStateAction &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useStorage</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  key: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// é»˜è®¤å€¼</span></span></span></span><br><span class="line"><span class="function"><span class="params">  defaultValue?: T | (() =&gt; T),</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// æ˜¯å¦åœ¨çª—å£å…³é—­åä¿æŒæ•°æ®</span></span></span></span><br><span class="line"><span class="function"><span class="params">  keepOnWindowClosed: <span class="built_in">boolean</span> = <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): [<span class="title">T</span> | <span class="title">undefined</span>, <span class="title">Dispatch</span>&lt;<span class="title">SetStateAction</span>&lt;<span class="title">T</span>&gt;&gt;, (<span class="params"></span>) =&gt; <span class="title">void</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> storage = keepOnWindowClosed ? localStorage : sessionStorage</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è¯•ä»Storageæ¢å¤å€¼</span></span><br><span class="line">  <span class="keyword">const</span> getStorageValue = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> storageValue = storage.getItem(key)</span><br><span class="line">      <span class="keyword">if</span> (storageValue != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(storageValue)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (defaultValue) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">        <span class="keyword">const</span> value = <span class="keyword">typeof</span> defaultValue === <span class="string">'function'</span> ? <span class="function">(<span class="params">defaultValue <span class="keyword">as</span> (<span class="params"></span>) =&gt; T</span>)<span class="params">()</span> : <span class="params">defaultValue</span></span></span><br><span class="line"><span class="function">        <span class="params">storage</span>.<span class="params">setItem</span>(<span class="params">key, <span class="built_in">JSON</span>.stringify(<span class="params">value</span>)</span>)</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">value</span></span></span><br><span class="line"><span class="function">      &#125;</span></span><br><span class="line"><span class="function">    &#125; <span class="params">catch</span> (<span class="params">err</span>) &#123;</span></span><br><span class="line"><span class="function">      <span class="params">console</span>.<span class="params">warn</span>(<span class="params">`useStorage æ— æ³•è·å–$&#123;key&#125;: `, err</span>)</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">undefined</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">const</span> [<span class="params">value</span>, <span class="params">setValue</span>] = <span class="params">useState</span>&lt;<span class="params">T</span> | <span class="params">undefined</span>&gt;(<span class="params">getStorageValue</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // æ›´æ–°ç»„ä»¶çŠ¶æ€å¹¶ä¿å­˜åˆ°<span class="params">Storage</span></span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">save</span> = <span class="params">useCallback</span>&lt;<span class="params">Dispatch</span>&lt;<span class="params">SetStateAction</span>&lt;<span class="params">T</span>&gt;&gt;&gt;(<span class="params">value =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    setValue(<span class="params">prev =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">const</span> finalValue = <span class="keyword">typeof</span> value === '<span class="keyword">function</span>' ? (<span class="params">value <span class="keyword">as</span> (<span class="params">prev: T | <span class="literal">undefined</span></span>) =&gt; T</span>)(<span class="params">prev</span>) : value</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      storage.setItem(<span class="params">key, <span class="built_in">JSON</span>.stringify(<span class="params">finalValue</span>)</span>)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="keyword">return</span> finalValue</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // ç§»é™¤çŠ¶æ€</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">clear</span> = <span class="params">useCallback</span>(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    storage.removeItem(<span class="params">key</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    setValue(<span class="params"><span class="literal">undefined</span></span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> [<span class="params">value</span>, <span class="params">save</span>, <span class="params">clear</span>]</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// --------</span></span><br><span class="line"><span class="function">// <span class="params">EXAMPLE</span></span></span><br><span class="line"><span class="function">// --------</span></span><br><span class="line"><span class="function"><span class="params">function</span> <span class="params">Demo</span><span class="params">()</span> &#123;</span></span><br><span class="line"><span class="function">  // ä¿å­˜ç™»å½•çŠ¶æ€</span></span><br><span class="line"><span class="function">  <span class="params">const</span> [<span class="params">use</span>, <span class="params">setUser</span>, <span class="params">clearUser</span>] = <span class="params">useStorage</span>(<span class="params">'user'</span>)</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">handleLogin</span> = (<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">    setUser(user)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleLogout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearUser()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-5-userefstate-å¼•ç”¨stateçš„æœ€æ–°å€¼"><a href="#1-5-userefstate-å¼•ç”¨stateçš„æœ€æ–°å€¼" class="headerlink" title="1-5 useRefState å¼•ç”¨stateçš„æœ€æ–°å€¼"></a>1-5 useRefState å¼•ç”¨stateçš„æœ€æ–°å€¼</h3><p><br></p><p><img src="/images/react-hooks/vue-api.png" alt></p><p><br></p><p>ä¸Šå›¾æ˜¯ä»Šå¹´å…­æœˆä»½<a href="https://vue.w3ctech.com" target="_blank" rel="noopener">VueConf</a>ï¼Œå°¤é›¨æºªçš„Slideæˆªå›¾ï¼Œä»–å¯¹æ¯”äº†Vueæœ€æ–°çš„<a href="https://zhuanlan.zhihu.com/p/68477600" target="_blank" rel="noopener">FunctionBase API</a>å’ŒReact Hook. å®ƒ<strong>æŒ‡å‡ºReact Hooksæœ‰å¾ˆå¤šé—®é¢˜</strong>:</p><ul><li>æ¯ä¸ªHooksåœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æ¸²æŸ“éƒ½è¦é‡æ–°åˆ›å»ºé—­åŒ…å’Œå¯¹è±¡</li><li>éœ€è¦ç†è§£é—­åŒ…å˜é‡</li><li>å†…å®¹å›è°ƒ/å¯¹è±¡ä¼šå¯¼è‡´çº¯ç»„ä»¶propsæ¯”å¯¹å¤±æ•ˆ, å¯¼è‡´ç»„ä»¶æ°¸è¿œæ›´æ–°</li></ul><p><br></p><p>é—­åŒ…å˜é‡é—®é¢˜æ˜¯ä½ æŒæ¡React Hooksè¿‡ç¨‹ä¸­çš„é‡è¦ä¸€å…³ã€‚é—­åŒ…é—®é¢˜æ˜¯æŒ‡ä»€ä¹ˆå‘¢ï¼Ÿä¸¾ä¸ªç®€å•çš„ä¾‹å­, Counter:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;: <span class="tag">&lt;<span class="name">ComplexButton</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncr&#125;</span>&gt;</span>increment<span class="tag">&lt;/<span class="name">ComplexButton</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾ComplexButtonæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç»„ä»¶ï¼Œæ¯ä¸€æ¬¡ç‚¹å‡»å®ƒï¼Œæˆ‘ä»¬ä¼šé€’å¢countï¼Œä»è€Œè§¦å‘ç»„å°†é‡æ–°æ¸²æŸ“ã€‚<strong>å› ä¸ºCounteræ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°ç”ŸæˆhandleIncrï¼Œæ‰€ä»¥ä¹Ÿä¼šå¯¼è‡´ComplexButtoné‡æ–°æ¸²æŸ“ï¼Œä¸ç®¡ComplexButtonä½¿ç”¨äº†<code>PureComponent</code>è¿˜æ˜¯ä½¿ç”¨<code>React.memo</code>åŒ…è£…</strong>ã€‚</p><p><br></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>Reactä¹Ÿæä¾›äº†ä¸€ä¸ª<code>useCallback</code> Hook, ç”¨æ¥â€˜ç¼“å­˜â€™å‡½æ•°, ä¿æŒå›è°ƒçš„ä¸å˜æ€§</strong>. æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;: <span class="tag">&lt;<span class="name">ComplexButton</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncr&#125;</span>&gt;</span>increment<span class="tag">&lt;/<span class="name">ComplexButton</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯æœ‰bugçš„ï¼Œä¸è¿‡æ€ä¹ˆç‚¹å‡»ï¼Œcountä¼šä¸€ç›´æ˜¾ç¤ºä¸º1ï¼</p><p>å†ä»”ç»†é˜…è¯»useCallbackçš„æ–‡æ¡£ï¼ŒuseCallbackæ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œå½“è¿™äº›å€¼å˜åŠ¨æ—¶æ›´æ–°ç¼“å­˜çš„å‡½æ•°, <strong>useCallbackçš„å†…éƒ¨é€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> memoFn, memoArgs</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useCallback</span>(<span class="params">fn, args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå˜åŠ¨åˆ™æ›´æ–°ç¼“å­˜å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (!isEqual(memoArgs, args)) &#123;</span><br><span class="line">    memoArgs = args</span><br><span class="line">    <span class="keyword">return</span> (memoFn = fn)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> memoFn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ok, ç°åœ¨ç†è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šä¸€ç›´æ˜¾ç¤º1ï¼Ÿ</p><p><img src="/images/react-hooks/usecallback.png" alt></p><p>é¦–æ¬¡æ¸²æŸ“æ—¶ç¼“å­˜äº†é—­åŒ…ï¼Œè¿™æ—¶å€™é—­åŒ…æ•è·çš„countå€¼æ˜¯0ã€‚åœ¨åç»­çš„é‡æ–°æ¸²æŸ“ä¸­ï¼Œå› ä¸ºuseCallbackç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„å€¼æ²¡æœ‰å˜åŠ¨ï¼ŒhandleIncré—­åŒ…ä¼šæ°¸è¿œè¢«ç¼“å­˜ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ¯æ¬¡ç‚¹å‡»ï¼Œcountåªèƒ½ä¸º1.</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œè®©æˆ‘ä»¬åœ¨countå˜åŠ¨æ—¶ï¼Œè®©useCallbackæ›´æ–°ç¼“å­˜å‡½æ•°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>)</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;&#123;count&#125;: &lt;ComplexButton onClick=&#123;handleIncr&#125;&gt;increment&lt;<span class="regexp">/ComplexButton&gt;&lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚æœuseCallbackä¾èµ–å¾ˆå¤šå€¼ï¼Œä½ çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š<code>useCallback(fn, [a, b, c, d, e])</code>. åæ­£æˆ‘æ˜¯æ— æ³•æ¥å—è¿™ç§ä»£ç çš„ï¼Œå¾ˆå®¹æ˜“é—æ¼, è€Œä¸”å¯ç»´æŠ¤æ€§å¾ˆå·®ï¼Œå°½ç®¡é€šè¿‡<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener">ESLintæ’ä»¶</a>å¯ä»¥æ£€æŸ¥è¿™äº›é—®é¢˜**ã€‚</p><p><br></p><p>å…¶å®é€šè¿‡<a href="https://reactjs.org/docs/hooks-reference.html#useref" target="_blank" rel="noopener"><code>useRef</code></a> Hookï¼Œå¯ä»¥è®©æˆ‘ä»¬åƒClassç»„ä»¶ä¸€æ ·ä¿å­˜ä¸€äº›â€˜å®ä¾‹å˜é‡â€™, Reactä¼šä¿è¯useRefè¿”å›å€¼çš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä»»ä½•åœ°æ–¹å®‰å…¨åœ°å¼•ç”¨refã€‚</p><p>åŸºäºè¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬å°è¯•å°è£…ä¸€ä¸ª<code>useRefState</code>, å®ƒåœ¨useStateçš„åŸºç¡€ä¸Šæ‰©å±•äº†ä¸€ä¸ªè¿”å›å€¼ï¼Œç”¨äºè·å–stateçš„æœ€æ–°å€¼:</p><p><br></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useCallback, Dispatch, SetStateAction, MutableRefObject &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRefState</span>(<span class="params">initialState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ins = useRef()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">typeof</span> initialState === <span class="string">'function'</span> ? initialState() : initialState</span><br><span class="line">    ins.current = value</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setValue = useCallback(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'function'</span>) &#123;</span><br><span class="line">      setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> finalValue = value(prevState)</span><br><span class="line">        ins.current = finalValue</span><br><span class="line">        <span class="keyword">return</span> finalValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ins.current = value</span><br><span class="line">      setState(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, setValue, ins]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount, countRef] = useRefState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> handleIncr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(countRef.current + <span class="number">1</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨ç»„ä»¶å¸è½½æ—¶ä¿å­˜å½“å‰çš„count</span></span><br><span class="line">      saveCount(countRef.current)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;&#123;count&#125;: &lt;ComplexButton onClick=&#123;handleIncr&#125;&gt;increment&lt;<span class="regexp">/ComplexButton&gt;&lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://reactjs.org/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener"><code>useEffect</code></a>ã€<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo</code></a>å’Œ<code>useCallback</code>ä¸€æ ·å­˜åœ¨é—­åŒ…å˜é‡é—®é¢˜ï¼Œå®ƒä»¬å’ŒuseCallbackä¸€ä¸ªæ”¯æŒæŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œå½“è¿™ä¸ªå‚æ•°å˜åŒ–æ—¶æ‰§è¡Œå‰¯ä½œç”¨ã€‚</p></blockquote><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-5-1-æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—"><a href="#1-5-1-æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—" class="headerlink" title="1-5-1 æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—?"></a>1-5-1 æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½åˆ›å»ºé—­åŒ…ä¼šå½±å“æ•ˆç‡å—?</h4><p>å‡½æ•°ç»„ä»¶å’ŒClassç»„ä»¶ä¸ä¸€æ ·çš„æ˜¯ï¼Œå‡½æ•°ç»„ä»¶å°†æ‰€æœ‰çŠ¶æ€å’Œé€»è¾‘éƒ½æ”¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸­, æ¯ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¼šé‡å¤åˆ›å»ºå¤§é‡çš„é—­åŒ…ã€å¯¹è±¡ã€‚è€Œä¼ ç»Ÿçš„Classç»„ä»¶çš„renderå‡½æ•°åˆ™è¦ç®€æ´å¾ˆå¤šï¼Œä¸€èˆ¬åªæ”¾ç½®JSXæ¸²æŸ“é€»è¾‘ã€‚ç›¸æ¯”å¤§å®¶éƒ½è·Ÿæˆ‘ä¸€æ ·ï¼Œä¼šæ€€ç–‘å‡½æ•°ç»„ä»¶çš„æ€§èƒ½é—®é¢˜</p><p>æˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ˜¯æ€ä¹ˆå›åº”çš„ï¼š</p><p><img src="/images/react-hooks/fn-perf.png" alt></p><p><br></p><p>æˆ‘åœ¨SegmentFaultçš„<a href="https://segmentfault.com/q/1010000019644156/a-1020000019706666" target="_blank" rel="noopener"><strong>react functionç»„ä»¶ä¸classç»„ä»¶æ€§èƒ½é—®é¢˜</strong></a>ä¹Ÿè¿›è¡Œäº†è¯¦ç»†çš„å›ç­”, ç»“è®ºæ˜¯:</p><blockquote><p>ç›®å‰è€Œè¨€ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„æ•ˆç‡æ˜¯ä¸ç›¸ä¸Šä¸‹çš„ã€‚ä½†æ˜¯å‡½æ•°ç»„ä»¶æ˜¯æœªæ¥ï¼Œè€Œä¸”è¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼ŒReactå›¢é˜Ÿä¼šç»§ç»­ä¼˜åŒ–å®ƒã€‚è€Œç±»ç»„ä»¶ä¼šé€æ¸é€€å‡ºå†å²</p></blockquote><p>ä¸ºäº†æé«˜å‡½æ•°ç»„ä»¶çš„æ€§èƒ½ï¼Œå¯ä»¥åœ¨è¿™äº›åœ°æ–¹åšä¸€äº›<strong>ä¼˜åŒ–</strong>:</p><ul><li><p>èƒ½å¦å°†å‡½æ•°æå–ä¸ºé™æ€çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1ï¸âƒ£ä¾‹å¦‚å°†ä¸ä¾èµ–äºç»„ä»¶çŠ¶æ€çš„å›è°ƒæŠ½å–ä¸ºé™æ€æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> goback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  history.go(<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//const goback = () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//  history.go(-1)</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;goback&#125;</span>&gt;</span>back<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ï¸âƒ£ æŠ½ç¦»useStateçš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> returnEmptyObject = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> returnEmptyArray = <span class="function"><span class="params">()</span> =&gt;</span> []</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(returnEmptyObject)</span><br><span class="line">  <span class="keyword">const</span> [arr, setArr] = useState(returnEmptyArray)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç®€åŒ–ç»„ä»¶çš„å¤æ‚åº¦ï¼ŒåŠ¨é™åˆ†ç¦»</p></li><li>å†æ‹†åˆ†æ›´ç»†ç²’åº¦çš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä½¿ç”¨React.memoç¼“å­˜</li></ul><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-6-userefprops-å¼•ç”¨æœ€æ–°çš„props"><a href="#1-6-userefprops-å¼•ç”¨æœ€æ–°çš„props" class="headerlink" title="1-6 useRefProps å¼•ç”¨æœ€æ–°çš„Props"></a>1-6 useRefProps å¼•ç”¨æœ€æ–°çš„Props</h3><p>ç°å®é¡¹ç›®ä¸­ä¹Ÿæœ‰å¾ˆå¤šè¿™ç§åœºæ™¯: æˆ‘ä»¬æƒ³<strong>åœ¨ç»„ä»¶çš„ä»»ä½•åœ°æ–¹è·å–æœ€æ–°çš„propså€¼</strong>ï¼Œè¿™ä¸ªåŒæ ·å¯ä»¥é€šè¿‡useRefæ¥å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useRefProps</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: T</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;T&gt;(props)</span><br><span class="line">  <span class="comment">// æ¯æ¬¡é‡æ–°æ¸²æŸ“è®¾ç½®å€¼</span></span><br><span class="line">  ref.current = props</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ref</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyButton</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> propsRef = useRefProps(props)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ°¸ä¹…ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; onClick &#125; = propsRef.current</span><br><span class="line">    <span class="keyword">if</span> (onClick) &#123;</span><br><span class="line">      onClick()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ComplexButton</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">ComplexButton</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-7-useinstance-â€˜å®ä¾‹â€™å˜é‡å­˜å–"><a href="#1-7-useinstance-â€˜å®ä¾‹â€™å˜é‡å­˜å–" class="headerlink" title="1-7 useInstance â€˜å®ä¾‹â€™å˜é‡å­˜å–"></a>1-7 useInstance â€˜å®ä¾‹â€™å˜é‡å­˜å–</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>&lt;<span class="title">T</span>&gt;(<span class="params">initial?: T | (() =&gt; T)</span>): <span class="title">initial</span> <span class="title">is</span> (<span class="params"></span>) =&gt; <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> initial === <span class="string">'function'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useInstance</span>&lt;<span class="title">T</span> <span class="title">extends</span> </span>&#123;&#125;&gt;<span class="function">(<span class="params">initial?: T | (<span class="params">(<span class="params"></span>) =&gt; T</span>)</span>) &#123;</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">instance</span> = <span class="params">useRef</span>&lt;<span class="params">T</span>&gt;<span class="params">()</span></span></span><br><span class="line"><span class="function">  // åˆå§‹åŒ–</span></span><br><span class="line"><span class="function">  <span class="params">if</span> (<span class="params">instance.current == <span class="literal">null</span></span>) &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params">initial</span>) &#123;</span></span><br><span class="line"><span class="function">      <span class="params">instance</span>.<span class="params">current</span> = <span class="params">isFunction</span>(<span class="params">initial</span>) ? <span class="params">initial</span><span class="params">()</span> : <span class="params">initial</span></span></span><br><span class="line"><span class="function">    &#125; <span class="params">else</span> &#123;</span></span><br><span class="line"><span class="function">      <span class="params">instance</span>.<span class="params">current</span> = &#123;&#125; <span class="params">as</span> <span class="params">T</span></span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> <span class="params">instance</span>.<span class="params">current</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// ---------</span></span><br><span class="line"><span class="function">// <span class="params">EXAMPLE</span></span></span><br><span class="line"><span class="function">// ---------</span></span><br><span class="line"><span class="function"><span class="params">function</span> <span class="params">Demo</span><span class="params">()</span> &#123;</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">inst</span> = <span class="params">useInstance</span>(<span class="params">&#123; count: 1 &#125;</span>)</span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">update</span> = <span class="params">useForceUpdate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="params">useEffect</span>(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> timer = setInterval(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// åƒç±»ç»„ä»¶ä¸€æ ·ï¼Œè¿›è¡Œâ€˜å®ä¾‹å˜é‡â€™å­˜å‚¨</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// åœ¨å‡½æ•°ç»„ä»¶çš„ä»»æ„åœ°æ–¹å¼•ç”¨</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// åªä¸è¿‡æ›´æ–°è¿™äº›æ•°æ®ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      inst.count++</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;, 1000</span>)</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> (<span class="params"></span>) =&gt; clearInterval(<span class="params">timer</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      count: &#123;inst.count&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;button onClick=&#123;update&#125;&gt;åˆ·æ–°&lt;/button&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ä¸è¦æ»¥ç”¨</p></blockquote><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-9-useprevious-è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼"><a href="#1-9-useprevious-è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼" class="headerlink" title="1-9 usePrevious è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼"></a>1-9 usePrevious è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼</h3><p>åœ¨Classç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨<code>shouldComponentUpdate</code>æˆ–<code>componentDidUpdate</code>è¿™ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å¯¹propsæˆ–stateè¿›è¡Œæ¯”å¯¹ï¼Œæ¥å†³å®šåšæŸäº›äº‹æƒ…ï¼Œä¾‹å¦‚é‡æ–°å‘èµ·è¯·æ±‚ã€ç›‘å¬äº‹ä»¶ç­‰ç­‰.</p><p>Hooksä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨useEffectæˆ–useMemoæ¥å“åº”çŠ¶æ€å˜åŒ–ï¼Œè¿›è¡ŒçŠ¶æ€æˆ–å‰¯ä½œç”¨è¡ç”Ÿ. æ‰€ä»¥ä¸Šè¿°æ¯”å¯¹çš„åœºæ™¯åœ¨Hooksä¸­å¾ˆå°‘è§ã€‚ä½†ä¹Ÿä¸æ˜¯ä¸å¯èƒ½ï¼ŒReactå®˜æ–¹æ¡ˆä¾‹ä¸­å°±æœ‰ä¸€ä¸ª<code>usePrevious</code>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePrevious</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef();</span><br><span class="line">  <span class="comment">// useEffectä¼šåœ¨å®Œæˆè¿™æ¬¡'æ¸²æŸ“'ä¹‹åæ‰§è¡Œ</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ref.current = value;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> ref.current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="keyword">const</span> calculation = count * <span class="number">100</span>;</span><br><span class="line"><span class="keyword">const</span> prevCalculation = usePrevious(calculation);</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-10-useimmer-ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ"><a href="#1-10-useimmer-ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ" class="headerlink" title="1-10 useImmer ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ"></a>1-10 useImmer ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ</h3><p>è¿™ä¸ªæ¡ˆä¾‹æ¥æºäº<a href="https://github.com/immerjs/use-immer" target="_blank" rel="noopener">use-immer</a>, ç»“åˆ<a href="https://github.com/mweststrate/immer" target="_blank" rel="noopener">immer.js</a>å’ŒHooksæ¥ç®€åŒ–ä¸å¯å˜æ•°æ®æ“ä½œ, çœ‹çœ‹ä»£ç ç¤ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [person, updatePerson] = useImmer(&#123;</span><br><span class="line">  name: <span class="string">"Michel"</span>,</span><br><span class="line">  age: <span class="number">33</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  updatePerson(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">    draft.name = name;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">becomeOlder</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  updatePerson(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">    draft.age++;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¹Ÿéå¸¸ç®€å•:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useImmer</span>(<span class="params">initialValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [val, updateValue] = useState(initialValue);</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    val,</span><br><span class="line">    useCallback(<span class="function"><span class="params">updater</span> =&gt;</span> &#123;</span><br><span class="line">      updateValue(produce(updater));</span><br><span class="line">    &#125;, [])</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç®€æ´çš„Hooksé…åˆç®€æ´çš„Immerï¼Œç®€ç›´å®Œç¾</strong></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-11-å°è£…â€™å·¥å…·hooksâ€™ç®€åŒ–stateçš„æ“ä½œ"><a href="#1-11-å°è£…â€™å·¥å…·hooksâ€™ç®€åŒ–stateçš„æ“ä½œ" class="headerlink" title="1-11 å°è£…â€™å·¥å…·Hooksâ€™ç®€åŒ–Stateçš„æ“ä½œ"></a>1-11 å°è£…â€™å·¥å…·Hooksâ€™ç®€åŒ–Stateçš„æ“ä½œ</h3><p>Hooksåªæ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥çµæ´»åœ°è‡ªå®šä¹‰ã€‚ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­ï¼Œåˆ©ç”¨è‡ªå®šä¹‰Hooksæ¥ç®€åŒ–å¸¸è§çš„æ•°æ®æ“ä½œåœºæ™¯</p><p><br></p><h4 id="1-11-1-usetoggle-å¼€å…³"><a href="#1-11-1-usetoggle-å¼€å…³" class="headerlink" title="1-11-1 useToggle å¼€å…³"></a>1-11-1 useToggle å¼€å…³</h4><p>å®ç°booleanå€¼åˆ‡æ¢</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useToggle</span>(<span class="params">initialValue?: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(!!initialValue)</span><br><span class="line">  <span class="keyword">const</span> toggler = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setValue(<span class="function"><span class="params">value</span> =&gt;</span> !value), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [value, toggler]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [enable, toggleEnable] = useToggle()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;Switch value=&#123;enable&#125; onClick=&#123;toggleEnable&#125;&gt;&lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-11-2-usearray-ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ"><a href="#1-11-2-usearray-ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ" class="headerlink" title="1-11-2 useArray ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ"></a>1-11-2 useArray ç®€åŒ–æ•°ç»„çŠ¶æ€æ“ä½œ</h4><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useArray</span>&lt;<span class="title">T</span>&gt;(<span class="params">initial?: T[] | (() =&gt; T[]), idKey: <span class="built_in">string</span> = 'id'</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(initial || [])</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value,</span><br><span class="line">    setValue,</span><br><span class="line">    push: useCallback(<span class="function"><span class="params">a</span> =&gt;</span> setValue(<span class="function"><span class="params">v</span> =&gt;</span> [...v, a]), []),</span><br><span class="line">    clear: useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setValue(<span class="function"><span class="params">()</span> =&gt;</span> []), []),</span><br><span class="line">    removeById: useCallback(<span class="function"><span class="params">id</span> =&gt;</span> setValue(<span class="function"><span class="params">arr</span> =&gt;</span> arr.filter(<span class="function"><span class="params">v</span> =&gt;</span> v &amp;&amp; v[idKey] !== id)), []),</span><br><span class="line">    removeIndex: useCallback(</span><br><span class="line">      index =&gt;</span><br><span class="line">        setValue(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">          v.splice(index, <span class="number">1</span>)</span><br><span class="line">          <span class="keyword">return</span> v</span><br><span class="line">        &#125;),</span><br><span class="line">      [],</span><br><span class="line">    ),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;value, push, removeById&#125; = useArray&lt;&#123;id: <span class="built_in">number</span>, name: <span class="built_in">string</span>&#125;&gt;()</span><br><span class="line">  <span class="keyword">const</span> handleAdd = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    push(&#123;id: <span class="built_in">Math</span>.random(), name: getName()&#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;div&gt;&#123;value.map(<span class="function"><span class="params">i</span> =&gt;</span> &lt;span key=&#123;i.id&#125; onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> removeById(i.id)&#125;&gt;&#123;i.name&#125;&lt;<span class="regexp">/span&gt;)&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;button onClick=&#123;handleAdd&#125;&gt;add&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™äºç¯‡å¹…ï¼Œå…¶ä»–æ•°æ®ç»“æ„, ä¾‹å¦‚Setã€Map, å°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å‘æŒ¥æƒ³è±¡åŠ›.</p><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="2-æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°"><a href="#2-æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°" class="headerlink" title="2. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°"></a><strong>2. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong></h2><p>ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ“ä½œä¾èµ–äº<code>useEffect</code> Hook. <strong>Reactåœ¨å‡½æ•°ç»„ä»¶ä¸­åˆ»æ„æ·¡åŒ–äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œè€Œæ›´å…³æ³¨â€˜æ•°æ®çš„å“åº”â€™</strong>.</p><p><code>useEffect</code>åç§°æ„å›¾éå¸¸æ˜æ˜¾ï¼Œå°±æ˜¯<strong>ä¸“é—¨ç”¨æ¥ç®¡ç†ç»„ä»¶çš„å‰¯ä½œç”¨</strong>ã€‚å’ŒuseCallbackä¸€æ ·ï¼ŒuseEffectæ”¯æŒä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‘ŠçŸ¥Reactåœ¨è¿™äº›å€¼å‘ç”Ÿå˜åŠ¨æ—¶æ‰æ‰§è¡Œçˆ¶ä½œç”¨. åŸç†å¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> memoCallback = &#123;<span class="attr">fn</span>: <span class="literal">undefined</span>, <span class="attr">disposer</span>: <span class="literal">undefined</span>&#125;</span><br><span class="line"><span class="keyword">let</span> memoArgs</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">fn, args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå˜åŠ¨åˆ™æ‰§è¡Œå‰¯ä½œç”¨</span></span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span> || !isEqual(memoArgs, args)) &#123;</span><br><span class="line">    memoArgs = args</span><br><span class="line">    memoCallback.fn = fn</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¾è¿›é˜Ÿåˆ—ç­‰å¾…è°ƒåº¦æ‰§è¡Œ</span></span><br><span class="line">    pushIntoEffectQueue(memoCallback)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰¯ä½œç”¨æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªä¼šåœ¨ç»„ä»¶å®Œæˆæ¸²æŸ“ï¼Œåœ¨å¸ƒå±€(layout)å’Œç»˜åˆ¶(paint)ä¹‹åè¢«æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯useLayoutEffect, æ‰§è¡Œçš„æ—¶æœºä¼šæ›´æ—©ä¸€äº›</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queueExecute</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…ˆæ‰§è¡Œæ¸…ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (callback.disposer) &#123;</span><br><span class="line">    callback.disposer()</span><br><span class="line">  &#125;</span><br><span class="line">  callback.disposer = callback.fn()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å…³äºuseEffectå®˜ç½‘æœ‰è¯¦å°½çš„<a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener">æè¿°</a>; Dan Abramovä¹Ÿå†™äº†ä¸€ç¯‡<a href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">useEffect å®Œæ•´æŒ‡å—</a>, æ¨èğŸ‘ã€‚</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-1-useonmount-æ¨¡æ‹Ÿcomponentdidmount"><a href="#2-1-useonmount-æ¨¡æ‹Ÿcomponentdidmount" class="headerlink" title="2-1 useOnMount æ¨¡æ‹ŸcomponentDidMount"></a>2-1 useOnMount æ¨¡æ‹ŸcomponentDidMount</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useOnMount</span>(<span class="params">fn: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fn()</span><br><span class="line">  &#125;, []) <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º[], è¡¨ç¤ºä¸å¿…å¯¹ä»»ä½•æ•°æ®ï¼Œ æ‰€ä»¥åªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  useOnMount(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> loadList()</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="comment">// log</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>å¦‚æœéœ€è¦åœ¨æŒ‚è½½/çŠ¶æ€æ›´æ–°æ—¶è¯·æ±‚ä¸€äº›èµ„æºã€å¹¶ä¸”éœ€è¦åœ¨å¸è½½æ—¶é‡Šæ”¾è¿™äº›èµ„æºï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨useEffectï¼Œå› ä¸ºè¿™äº›é€»è¾‘æœ€å¥½æ”¾åœ¨ä¸€èµ·, æ–¹ä¾¿ç»´æŠ¤å’Œç†è§£</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½†æ˜¯useEffectä¼ å…¥çš„å‡½æ•°ä¸æ”¯æŒasync/await(è¿”å›Promise)</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¯·æ±‚èµ„æº</span></span><br><span class="line">  <span class="keyword">const</span> subscription = props.source.subscribe();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscription.unsubscribe();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-2-useonunmount-æ¨¡æ‹Ÿcomponentwillunmount"><a href="#2-2-useonunmount-æ¨¡æ‹Ÿcomponentwillunmount" class="headerlink" title="2-2 useOnUnmount æ¨¡æ‹ŸcomponentWillUnmount"></a>2-2 useOnUnmount æ¨¡æ‹ŸcomponentWillUnmount</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useOnUnmount</span>(<span class="params">fn: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        fn()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-3-useonupdate-æ¨¡æ‹Ÿcomponentdidupdate"><a href="#2-3-useonupdate-æ¨¡æ‹Ÿcomponentdidupdate" class="headerlink" title="2-3 useOnUpdate æ¨¡æ‹ŸcomponentDidUpdate"></a>2-3 useOnUpdate æ¨¡æ‹ŸcomponentDidUpdate</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useOnUpdate</span>(<span class="params">fn: () =&gt; <span class="built_in">void</span>, dep?: <span class="built_in">any</span>[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef(&#123; fn, mounted: <span class="literal">false</span> &#125;)</span><br><span class="line">  ref.current.fn = fn</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é¦–æ¬¡æ¸²æŸ“ä¸æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (!ref.current.mounted) &#123;</span><br><span class="line">      ref.current.mounted = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ref.current.fn()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  useOnUpdate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dosomethingwith(props.a)</span><br><span class="line">  &#125;, [props.a])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;...&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>å…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„æ¨¡æ‹Ÿ:</p><ul><li><code>shouldComponentUpdate</code> - React.memoåŒ…è£¹ç»„ä»¶</li><li><code>componentDidCatch</code> - æš‚ä¸æ”¯æŒ</li></ul><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="3-äº‹ä»¶å¤„ç†"><a href="#3-äº‹ä»¶å¤„ç†" class="headerlink" title="3. äº‹ä»¶å¤„ç†"></a><strong>3. äº‹ä»¶å¤„ç†</strong></h2><h3 id="3-1-usechange-ç®€åŒ–onchangeè¡¨å•åŒå‘ç»‘å®š"><a href="#3-1-usechange-ç®€åŒ–onchangeè¡¨å•åŒå‘ç»‘å®š" class="headerlink" title="3-1 useChange ç®€åŒ–onChangeè¡¨å•åŒå‘ç»‘å®š"></a>3-1 useChange ç®€åŒ–onChangeè¡¨å•åŒå‘ç»‘å®š</h3><p>è¡¨å•å€¼çš„åŒå‘ç»‘å®šåœ¨é¡¹ç›®ä¸­éå¸¸å¸¸è§ï¼Œé€šå¸¸æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = useCallback&lt;React.ChangeEventHandler&lt;HTMLInputElement&gt;&gt;(<span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    setValue(evt.target.value)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;input value=&#123;value&#125; onChange=&#123;handleChange&#125; /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ç»´æŠ¤å¤šä¸ªè¡¨å•ï¼Œè¿™ç§ä»£ç å°±ä¼šå˜å¾—éš¾ä»¥æ¥å—ã€‚å¹¸å¥½æœ‰Hooksï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–è¿™äº›ä»£ç :</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useChange</span>&lt;<span class="title">S</span>&gt;(<span class="params">initial?: S | (() =&gt; S)</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;S | <span class="literal">undefined</span>&gt;(initial)</span><br><span class="line">  <span class="keyword">const</span> onChange = useCallback(<span class="function"><span class="params">e</span> =&gt;</span> setValue(e.target.value), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value,</span><br><span class="line">    setValue,</span><br><span class="line">    onChange,</span><br><span class="line">    <span class="comment">// ç»‘å®šåˆ°åŸç”Ÿäº‹ä»¶</span></span><br><span class="line">    bindEvent: &#123;</span><br><span class="line">      onChange,</span><br><span class="line">      value,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç»‘å®šåˆ°è‡ªå®šä¹‰ç»„ä»¶</span></span><br><span class="line">    bind: &#123;</span><br><span class="line">      onChange: setValue,</span><br><span class="line">      value,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> userName = useChange(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">const</span> password = useChange(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input &#123;...userName.bindEvent&#125; /&gt;</span><br><span class="line">      &lt;input <span class="keyword">type</span>=<span class="string">"password"</span> &#123;...password.bindEvent&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-2-usebind-ç»‘å®šå›è°ƒå‚æ•°"><a href="#3-2-usebind-ç»‘å®šå›è°ƒå‚æ•°" class="headerlink" title="3-2 useBind ç»‘å®šå›è°ƒå‚æ•°"></a>3-2 useBind ç»‘å®šå›è°ƒå‚æ•°</h3><p>ç»‘å®šä¸€äº›å›è°ƒå‚æ•°ï¼Œå¹¶åˆ©ç”¨useMemoç»™ä¸‹çº§ä¼ é€’ä¸€ä¸ªç¼“å­˜çš„å›è°ƒ, é¿å…é‡æ–°æ¸²æŸ“:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useBind</span>(<span class="params">fn?: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>, ...args: <span class="built_in">any</span>[]</span>): (<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt; <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;fn &amp;&amp; fn.bind(<span class="literal">null</span>, ...args)&#125;, args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;id, onClick&#125; = props</span><br><span class="line">  <span class="keyword">const</span> handleClick = useBind(onClick, id)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;ComplexComponent onClick=&#123;handleClick&#125;&gt;&lt;<span class="regexp">/ComplexComponent&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ç­‰ä»·äº</span></span><br><span class="line"><span class="regexp">function Demo(props) &#123;</span></span><br><span class="line"><span class="regexp">  const &#123;id, onClick&#125; = props</span></span><br><span class="line"><span class="regexp">  const handleClick = useCallback(() =&gt; onClick(id), [id])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return &lt;ComplexComponent onClick=&#123;handleClick&#125;&gt;&lt;/</span>ComplexComponent&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-3-è‡ªå®šä¹‰äº‹ä»¶å°è£…"><a href="#3-3-è‡ªå®šä¹‰äº‹ä»¶å°è£…" class="headerlink" title="3-3 è‡ªå®šä¹‰äº‹ä»¶å°è£…"></a>3-3 è‡ªå®šä¹‰äº‹ä»¶å°è£…</h3><p>Hooksä¹Ÿå¯ä»¥ç”¨äºå°è£…ä¸€äº›é«˜çº§äº‹ä»¶æˆ–è€…ç®€åŒ–äº‹ä»¶çš„å¤„ç†ï¼Œæ¯”å¦‚æ‹–æ‹½ã€æ‰‹åŠ¿ã€é¼ æ ‡Active/Hoverç­‰ç­‰ï¼›</p><p><br></p><h4 id="3-3-1-useactive"><a href="#3-3-1-useactive" class="headerlink" title="3-3-1 useActive"></a>3-3-1 useActive</h4><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­, useActive, åœ¨é¼ æ ‡æŒ‰ä¸‹æ—¶è®¾ç½®çŠ¶æ€ä¸ºtrueï¼Œé¼ æ ‡é‡Šæ”¾æ—¶æ¢å¤ä¸ºfalse:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useActive</span>(<span class="params">refEl: React.RefObject&lt;HTMLElement&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="literal">false</span>)</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleMouseDown = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setValue(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handleMouseUp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setValue(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DOM äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (refEl &amp;&amp; refEl.current) &#123;</span><br><span class="line">      refEl.current.addEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line">      refEl.current.addEventListener(<span class="string">'mouseup'</span>, handleMouseUp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (refEl &amp;&amp; refEl.current) &#123;</span><br><span class="line">        refEl.current.removeEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line">        refEl.current.removeEventListener(<span class="string">'mouseup'</span>, handleMouseUp)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> elRef = useRef(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> active = useActive(inputRef)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div ref=&#123;elRef&#125;&gt;&#123;active ? <span class="string">"Active"</span> : <span class="string">"Nop"</span>&#125;&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="3-3-2-usetouch-æ‰‹åŠ¿äº‹ä»¶å°è£…"><a href="#3-3-2-usetouch-æ‰‹åŠ¿äº‹ä»¶å°è£…" class="headerlink" title="3-3-2 useTouch æ‰‹åŠ¿äº‹ä»¶å°è£…"></a>3-3-2 useTouch æ‰‹åŠ¿äº‹ä»¶å°è£…</h4><p>æ›´å¤æ‚çš„è‡ªå®šä¹‰äº‹ä»¶, ä¾‹å¦‚æ‰‹åŠ¿ã€‚é™äºç¯‡å¹…å°±ä¸åˆ—ä¸¾å®ƒä»¬çš„å®ç°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å®ƒä»¬çš„Demo:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;ref&#125; = useTouch(&#123;</span><br><span class="line">    onTap: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">/* ç‚¹å‡» */</span> &#125;,</span><br><span class="line">    onLongTap: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">/* é•¿æŒ‰ */</span> &#125;,</span><br><span class="line">    onRotate: <span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">/* æ—‹è½¬ */</span>&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div className=<span class="string">"box"</span> ref=&#123;ref&#125;&gt;&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>useTouchçš„å®ç°å¯ä»¥å‚è€ƒ<a href="https://github.com/GDJiaMi/hooks/blob/master/src/useTouch.ts" target="_blank" rel="noopener">useTouch.ts</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="3-3-3-usedraggable-æ‹–æ‹½äº‹ä»¶å°è£…"><a href="#3-3-3-usedraggable-æ‹–æ‹½äº‹ä»¶å°è£…" class="headerlink" title="3-3-3 useDraggable æ‹–æ‹½äº‹ä»¶å°è£…"></a>3-3-3 useDraggable æ‹–æ‹½äº‹ä»¶å°è£…</h4><p>æ‹–æ‹½ä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„è‡ªå®šä¹‰äº‹ä»¶, ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥æºäº<a href="https://stackblitz.com/edit/usedraggable" target="_blank" rel="noopener">è¿™é‡Œ</a></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useDraggable</span>(<span class="params">ref: React.RefObject&lt;HTMLElement&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [&#123; dx, dy &#125;, setOffset] = useState(&#123; dx: <span class="number">0</span>, dy: <span class="number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ref.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`[useDraggable] refæœªæ³¨å†Œåˆ°ç»„ä»¶ä¸­`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> el = ref.current</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleMouseDown = <span class="function">(<span class="params">event: MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> startX = event.pageX - dx</span><br><span class="line">      <span class="keyword">const</span> startY = event.pageY - dy</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> handleMouseMove = <span class="function">(<span class="params">event: MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> newDx = event.pageX - startX</span><br><span class="line">        <span class="keyword">const</span> newDy = event.pageY - startY</span><br><span class="line">        setOffset(&#123; dx: newDx, dy: newDy &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">document</span>.addEventListener(<span class="string">'mousemove'</span>, handleMouseMove)</span><br><span class="line">      <span class="built_in">document</span>.addEventListener(</span><br><span class="line">        <span class="string">'mouseup'</span>,</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">          <span class="built_in">document</span>.removeEventListener(<span class="string">'mousemove'</span>, handleMouseMove)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; once: <span class="literal">true</span> &#125;,</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    el.addEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      el.removeEventListener(<span class="string">'mousedown'</span>, handleMouseDown)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [dx, dy])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ref.current) &#123;</span><br><span class="line">      ref.current.style.transform = <span class="string">`translate3d(<span class="subst">$&#123;dx&#125;</span>px, <span class="subst">$&#123;dy&#125;</span>px, 0)`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [dx, dy])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el = useRef();</span><br><span class="line">  useDraggable(el);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;div className=<span class="string">"box"</span> ref=&#123;el&#125; /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è¿è¡Œ<a href="https://stackblitz.com/edit/usedraggable" target="_blank" rel="noopener">ä¾‹å­</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="3-3-4-react-events-é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…"><a href="#3-3-4-react-events-é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…" class="headerlink" title="3-3-4 react-events é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…"></a>3-3-4 react-events é¢å‘æœªæ¥çš„é«˜çº§äº‹ä»¶å°è£…</h4><p>æˆ‘åœ¨<a href="https://juejin.im/post/5d44e3745188255d5861d654" target="_blank" rel="noopener">&lt;è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)&gt;</a>ä»‹ç»äº†<code>React-Events</code>è¿™ä¸ª<strong>å®éªŒæ€§</strong>çš„APIã€‚å½“è¿™ä¸ªAPIæˆç†Ÿåï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºå®ƒæ¥å®ç°æ›´ä¼˜é›…çš„é«˜çº§äº‹ä»¶çš„å°è£…ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PressResponder, usePressListener &#125; <span class="keyword">from</span> <span class="string">'react-events/press'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  <span class="keyword">const</span> listener = usePressListener(&#123;  <span class="comment">// âš›ï¸ é€šè¿‡hooksåˆ›å»ºResponder</span></span><br><span class="line">    onPressStart,</span><br><span class="line">    onPress,</span><br><span class="line">    onPressEnd,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div listeners=&#123;listener&#125;&gt;</span><br><span class="line">      &#123;subtrees&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-4-usesubscription-é€šç”¨äº‹ä»¶æºè®¢é˜…"><a href="#3-4-usesubscription-é€šç”¨äº‹ä»¶æºè®¢é˜…" class="headerlink" title="3-4 useSubscription é€šç”¨äº‹ä»¶æºè®¢é˜…"></a>3-4 useSubscription é€šç”¨äº‹ä»¶æºè®¢é˜…</h3><p>Reactå®˜æ–¹ç»´æŠ¤äº†ä¸€ä¸ª<a href="https://github.com/facebook/react/tree/master/packages/use-subscription" target="_blank" rel="noopener">use-subscription</a>åŒ…ï¼Œæ”¯æŒä½¿ç”¨Hooksçš„å½¢å¼æ¥ç›‘å¬äº‹ä»¶æº. äº‹ä»¶æºå¯ä»¥æ˜¯DOMäº‹ä»¶ã€RxJSçš„Observableç­‰ç­‰.</p><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›‘å¬rxjs behaviorSubject</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> subscription = useMemo(</span><br><span class="line">    () =&gt; (&#123;</span><br><span class="line">      getCurrentValue: <span class="function"><span class="params">()</span> =&gt;</span> behaviorSubject.getValue(),</span><br><span class="line">      subscribe: <span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å½“äº‹ä»¶è§¦å‘æ—¶è°ƒç”¨callback</span></span><br><span class="line">        <span class="keyword">const</span> subscription = behaviorSubject.subscribe(callback);</span><br><span class="line">        <span class="comment">// å’ŒuseEffectä¸€æ ·ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°æ¥å–æ¶ˆè®¢é˜…</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> subscription.unsubscribe();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// åœ¨behaviorSubjectå˜åŒ–åé‡æ–°è®¢é˜…</span></span><br><span class="line">    [behaviorSubject]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = useSubscription(subscription);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¥çœ‹çœ‹å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useSubscription</span>&lt;<span class="title">T</span>&gt;(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  getCurrentValue,</span></span></span><br><span class="line"><span class="function"><span class="params">  subscribe,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// è·å–å½“å‰å€¼</span></span></span></span><br><span class="line"><span class="function"><span class="params">  getCurrentValue?: () =&gt; T</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// ç”¨äºè®¢é˜…äº‹ä»¶æº</span></span></span></span><br><span class="line"><span class="function"><span class="params">  subscribe: (callback: <span class="built_in">Function</span>) =&gt; () =&gt; <span class="built_in">void</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(<span class="function"><span class="params">()</span> =&gt;</span> (&#123; getCurrentValue, subscribe, value: getCurrentValue() &#125;))</span><br><span class="line">  <span class="keyword">let</span> valueToReturn = state.value</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–°getCurrentValueå’Œsubscribe</span></span><br><span class="line">  <span class="keyword">if</span> (state.getCurrentValue !== getCurrentValue || state.subscribe !== subscribe) &#123;</span><br><span class="line">    valueToReturn = getCurrentValue()</span><br><span class="line">    setState(&#123; getCurrentValue, subscribe, value: valueToReturn &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> didUnsubscribe = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> checkForUpdates = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (didUnsubscribe) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥getCurrentValueå’Œsubscribeæ˜¯å¦å˜åŠ¨</span></span><br><span class="line">        <span class="comment">// setStateæ—¶å¦‚æœè¿”å›å€¼æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“</span></span><br><span class="line">        <span class="keyword">if</span> (prevState.getCurrentValue !== getCurrentValue || prevState.subscribe !== subscribe) &#123;</span><br><span class="line">          <span class="keyword">return</span> prevState</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å€¼æ²¡å˜åŠ¨</span></span><br><span class="line">        <span class="keyword">const</span> value = getCurrentValue()</span><br><span class="line">        <span class="keyword">if</span> (prevState.value === value) &#123;</span><br><span class="line">          <span class="keyword">return</span> prevState</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123; ...prevState, value &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> unsubscribe = subscribe(checkForUpdates)</span><br><span class="line">    checkForUpdates()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      didUnsubscribe = <span class="literal">true</span></span><br><span class="line">      unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [getCurrentValue, subscribe])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> valueToReturn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¹Ÿä¸å¤æ‚ï¼Œç”šè‡³å¯ä»¥è¯´æœ‰ç‚¹å•°å—¦.</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-5-useobservable-hookså’Œrxjsä¼˜é›…çš„ç»“åˆ-rxjs-hooks"><a href="#3-5-useobservable-hookså’Œrxjsä¼˜é›…çš„ç»“åˆ-rxjs-hooks" class="headerlink" title="3-5 useObservable Hookså’ŒRxJSä¼˜é›…çš„ç»“åˆ(rxjs-hooks)"></a>3-5 useObservable Hookså’ŒRxJSä¼˜é›…çš„ç»“åˆ(rxjs-hooks)</h3><p>å¦‚æœè¦é…åˆRxJSä½¿ç”¨ï¼ŒLeetCodeå›¢é˜Ÿå°è£…äº†ä¸€ä¸ª<a href="https://github.com/LeetCode-OpenSource/rxjs-hooks/blob/master/README.md" target="_blank" rel="noopener">rxjs-hooks</a>åº“ï¼Œç”¨èµ·æ¥åˆ™è¦ä¼˜é›…å¾ˆå¤š, éå¸¸æ¨è:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> value = useObservable(<span class="function"><span class="params">()</span> =&gt;</span> interval(<span class="number">500</span>).pipe(map(<span class="function">(<span class="params">val</span>) =&gt;</span> val * <span class="number">3</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Incremental <span class="built_in">number</span>: &#123;value&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-6-useeventemitter-å¯¹æ¥eventemitter"><a href="#3-6-useeventemitter-å¯¹æ¥eventemitter" class="headerlink" title="3-6 useEventEmitter å¯¹æ¥eventEmitter"></a>3-6 useEventEmitter å¯¹æ¥eventEmitter</h3><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-3" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a>è¿™ç¯‡æ–‡ç« é‡Œé¢æè¿‡ï¼š<strong>è‡ªå®šä¹‰ hook å’Œå‡½æ•°ç»„ä»¶çš„ä»£ç ç»“æ„åŸºæœ¬ä¸€è‡´, æ‰€ä»¥æœ‰æ—¶å€™hooks å†™ç€å†™ç€åŸæ¥è¶Šåƒç»„ä»¶, ç»„ä»¶å†™ç€å†™ç€è¶Šåƒ hooks. æˆ‘è§‰å¾—å¯ä»¥è®¤ä¸ºç»„ä»¶å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ hook, åªä¸è¿‡å®ƒè¾“å‡º Virtual DOM</strong></p><p>Hooksè·Ÿç»„ä»¶ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘å’ŒçŠ¶æ€çš„èšåˆå•å…ƒã€‚å¯ä»¥ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ã€æœ‰è‡ªå·±çš„â€™ç”Ÿå‘½å‘¨æœŸâ€™.</p><p><code>useEventEmitter</code>å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå¯ä»¥ç‹¬ç«‹åœ°ç»´æŠ¤å’Œé‡Šæ”¾è‡ªå·±çš„èµ„æº:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="function"><span class="keyword">function</span><span class="title">ReturnObject</span> = (<span class="params"></span>) =&gt; (<span class="params">&#123;&#125;</span>)</span></span><br><span class="line"><span class="function"><span class="title">const</span> <span class="function"><span class="keyword">function</span><span class="title">ReturnArray</span> = (<span class="params"></span>) =&gt; []</span></span></span><br><span class="line"><span class="function"><span class="function"></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="title">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useEventEmitter</span>(<span class="params">emmiter: EventEmitter</span>) </span>&#123;</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">disposers</span> = <span class="title">useRef</span>&lt;<span class="title">Function</span>[]&gt;(<span class="params">[]</span>)</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">listeners</span> = <span class="title">useRef</span>&lt;</span>&#123; [<span class="title">name</span>: <span class="title">string</span>]: <span class="title">Function</span> &#125;&gt;(<span class="params">&#123;&#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">const</span> <span class="title">on</span> = <span class="title">useCallback</span>(<span class="params">&lt;P&gt;(name: <span class="built_in">string</span>, cb: (data: P) =&gt; <span class="built_in">void</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">if</span> (!(name <span class="keyword">in</span> listeners.current)) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">const</span> call = (...args: <span class="built_in">any</span>[]) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> fn = listeners.current[name]</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">if</span> (fn) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">          fn(...args)</span></span></span><br><span class="line"><span class="function"><span class="params">        &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="comment">// ç›‘å¬eventEmitter</span></span></span></span><br><span class="line"><span class="function"><span class="params">      emmiter.on(name, call)</span></span></span><br><span class="line"><span class="function"><span class="params">      disposers.current.push(() =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        emmiter.off(name, call)</span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;)</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    listeners.current[name] = cb</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">useEffect</span>(<span class="params">() =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// èµ„æºé‡Šæ”¾</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> () =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      disposers.current.forEach(i =&gt; i())</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">return</span> </span>&#123;</span><br><span class="line">    on,</span><br><span class="line">    emit: emmiter.emit,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; on, emit &#125; = useEventEmitter(eventBus)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº‹ä»¶ç›‘å¬</span></span><br><span class="line">  on(<span class="string">'someEvent'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// äº‹ä»¶è§¦å‘</span></span><br><span class="line">    emit(<span class="string">'anotherEvent'</span>, someData)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div onClick=&#123;handleClick&#125;&gt;...&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><p>æ›´å¤šè„‘æ´ï¼š</p><ul><li><a href="https://github.com/mfrachet/use-socketio" target="_blank" rel="noopener">use-socketio</a></li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="4-contextçš„å¦™ç”¨"><a href="#4-contextçš„å¦™ç”¨" class="headerlink" title="4. Contextçš„å¦™ç”¨"></a><strong>4. Contextçš„å¦™ç”¨</strong></h2><p>é€šè¿‡<a href="https://reactjs.org/docs/hooks-reference.html#usecontext" target="_blank" rel="noopener"><code>useContext</code></a>å¯ä»¥æ–¹ä¾¿åœ°å¼•ç”¨Contextã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¸Šçº§<code>Context.Provider</code>çš„valueå˜åŒ–ï¼Œä½¿ç”¨useContextçš„ç»„ä»¶å°±ä¼šè¢«å¼ºåˆ¶é‡æ–°æ¸²æŸ“ã€‚</p><h3 id="4-1-usetheme-ä¸»é¢˜é…ç½®"><a href="#4-1-usetheme-ä¸»é¢˜é…ç½®" class="headerlink" title="4-1 useTheme ä¸»é¢˜é…ç½®"></a>4-1 useTheme ä¸»é¢˜é…ç½®</h3><p>åŸæœ¬éœ€è¦ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ³¨å…¥æˆ–Context.Consumerè·å–çš„Contextå€¼ï¼Œç°åœ¨å˜å¾—éå¸¸ç®€æ´ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼ ç»Ÿæ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// é€šè¿‡é«˜é˜¶ç»„ä»¶æ³¨å…¥</span></span><br><span class="line">withTheme(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–åˆ©ç”¨Context.Consumer</span></span><br><span class="line"><span class="keyword">const</span> MyComponentWithTheme = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;ThemeContext.Consumer&gt;</span><br><span class="line">    &#123;<span class="function"><span class="params">value</span> =&gt;</span> &lt;MyComponent theme=&#123;value&#125; &#123;...props&#125;&gt;&lt;<span class="regexp">/MyComponent&gt;&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>ThemeContext.Consumer&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hooksæ–¹å¼</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useContext, FC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext&lt;object&gt;(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeProvider: FC&lt;&#123; theme: object &#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;ThemeContext.Provider value=&#123;props.theme&#125;&gt;&#123;props.children&#125;&lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export function useTheme&lt;T extends object&gt;(): T &#123;</span></span><br><span class="line"><span class="regexp">  return useContext(ThemeContext)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ---------</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ EXAMPLE</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ---------</span></span><br><span class="line"><span class="regexp">const theme = &#123;</span></span><br><span class="line"><span class="regexp">  primary: '#000',</span></span><br><span class="line"><span class="regexp">  secondary: '#444',</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ThemeProvider theme=&#123;theme&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;...&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/ThemeProvider&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Button: FC = props =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const t = useTheme&lt;typeof theme&gt;()</span></span><br><span class="line"><span class="regexp">  const style = &#123;</span></span><br><span class="line"><span class="regexp">    color: t.primary,</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  return &lt;button style=&#123;style&#125;&gt;&#123;props.children&#125;&lt;/</span>button&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-2-unstated-ç®€å•çŠ¶æ€ç®¡ç†å™¨"><a href="#4-2-unstated-ç®€å•çŠ¶æ€ç®¡ç†å™¨" class="headerlink" title="4-2 unstated ç®€å•çŠ¶æ€ç®¡ç†å™¨"></a>4-2 unstated ç®€å•çŠ¶æ€ç®¡ç†å™¨</h3><p>Hooks + Context ä¹Ÿå¯ä»¥ç”¨äºå®ç°ç®€å•çš„çŠ¶æ€ç®¡ç†ã€‚</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5ce3ee436fb9a07f070e0220#heading-2" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“05 - çŠ¶æ€ç®¡ç†</a>å°±æåˆ°è¿‡<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fjamiebuilds%2Funstated-next" target="_blank" rel="noopener">unstated-next</a>ï¼Œ è¿™ä¸ªåº“åªæœ‰ä¸»ä½“ä»£ç åå‡ è¡Œï¼Œ<strong>åˆ©ç”¨äº†Reactæœ¬èº«çš„æœºåˆ¶æ¥å®ç°çŠ¶æ€ç®¡ç†</strong>.</p><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> &#123; createContainer &#125; <span class="keyword">from</span> <span class="string">"unstated-next"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useCounter</span>(<span class="params">initialState = 0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = useState(initialState)</span><br><span class="line">  <span class="keyword">let</span> decrement = <span class="function"><span class="params">()</span> =&gt;</span> setCount(count - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> increment = <span class="function"><span class="params">()</span> =&gt;</span> setCount(count + <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123; count, decrement, increment &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Counter = createContainer(useCounter)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CounterDisplay</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> counter = Counter.useContainer()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;counter.decrement&#125;&gt;-&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;&#123;counter.count&#125;&lt;/</span>span&gt;</span><br><span class="line">      &lt;button onClick=&#123;counter.increment&#125;&gt;+&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹å®ƒçš„æºç :</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createContainer</span>(<span class="params">useHook</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åªæ˜¯åˆ›å»ºä¸€ä¸ªContext</span></span><br><span class="line"><span class="keyword">let</span> Context = React.createContext(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> value = useHook(props.initialState)</span><br><span class="line"><span class="keyword">return</span> &lt;Context.Provider value=&#123;value&#125;&gt;&#123;props.children&#125;&lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function useContainer() &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ åªæ˜¯ä½¿ç”¨useContext</span></span><br><span class="line"><span class="regexp">let value = React.useContext(Context)</span></span><br><span class="line"><span class="regexp">if (value === null) &#123;</span></span><br><span class="line"><span class="regexp">throw new Error("Component must be wrapped with &lt;Container.Provider&gt;")</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">return value</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">return &#123; Provider, useContainer &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export function useContainer(container) &#123;</span></span><br><span class="line"><span class="regexp">return container.useContainer()</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œä½ ä¼šè¯´ï¼Œæˆ‘é ï¼Œå°±è¿™æ ·? è¿™ä¸ªåº“æ„Ÿè§‰å•¥äº‹æƒ…éƒ½æ²¡å¹²å•Š?</p><p>éœ€è¦æ³¨æ„çš„æ˜¯, <strong>Contextä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œå®ƒä½œä¸ºçŠ¶æ€ç®¡ç†æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„ç¼ºé™·</strong>ï¼Œæˆ‘åœ¨<a href="https://juejin.im/post/5d045350f265da1b695d5bf2#heading-14" target="_blank" rel="noopener">æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a>æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹:<br><strong>å®ƒæ˜¯å¯ä»¥ç©¿é€React.memoæˆ–è€…shouldComponentUpdateçš„æ¯”å¯¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdate</strong></p><p>æ‰€ä»¥å¦‚æœä½ æ‰“ç®—ä½¿ç”¨Contextä½œä¸ºçŠ¶æ€ç®¡ç†ï¼Œä¸€å®šè¦æ³¨æ„è§„é¿è¿™ä¸€ç‚¹. å®ƒå¯èƒ½ä¼šå¯¼è‡´ç»„ä»¶é¢‘ç¹é‡æ–°æ¸²æŸ“.</p><p><br></p><p>å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ:</p><ul><li><a href="https://github.com/ctrlplusb/easy-peasy" target="_blank" rel="noopener">easy-peasy</a></li><li><a href="https://github.com/dai-shi/react-hooks-global-state" target="_blank" rel="noopener">react-hooks-global-state</a></li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-3-usei18n-å›½é™…åŒ–"><a href="#4-3-usei18n-å›½é™…åŒ–" class="headerlink" title="4-3 useI18n å›½é™…åŒ–"></a>4-3 useI18n å›½é™…åŒ–</h3><p>I18næ˜¯å¦ä¸€ä¸ªContextçš„å…¸å‹ä½¿ç”¨åœºæ™¯ã€‚<a href="https://github.com/formatjs/react-intl/blob/master/docs/API.md#useintl-hook-currently-available-in-300-beta" target="_blank" rel="noopener">react-intl</a>å’Œ<a href="https://react.i18next.com/latest/usetranslation-hook" target="_blank" rel="noopener">react-i18next</a>éƒ½ä¸æ—¶ä¿±è¿›ï¼Œæ¨å‡ºäº†è‡ªå·±çš„Hook API, <strong>åŸºæœ¬ä¸ŠåŸæœ¬ä½¿ç”¨é«˜é˜¶ç»„ä»¶(HOC)å®ç°çš„åŠŸèƒ½éƒ½å¯ä»¥ç”¨Hooksä»£æ›¿ï¼Œè®©ä»£ç å˜å¾—æ›´åŠ ç®€æ´</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useTranslation &#125; <span class="keyword">from</span> <span class="string">'react-i18next'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; t, i18n &#125; = useTranslation();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;t('my translated text')&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-4-userouter-ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®"><a href="#4-4-userouter-ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®" class="headerlink" title="4-4 useRouter ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®"></a>4-4 useRouter ç®€åŒ–è·¯ç”±çŠ¶æ€çš„è®¿é—®</h3><p>React Hooks æ¨å‡ºå·²ç»æ¥è¿‘ä¸€å¹´ï¼ŒReactRouterç«Ÿç„¶è¿˜æ²¡æœ‰æ­£å¼æ¨å‡ºHook APIã€‚ä¸è¿‡å®ƒä»¬ä¹Ÿæä¸Šäº†è®¡åˆ’ â€”â€” <a href="https://reacttraining.com/blog/reach-react-router-future/" target="_blank" rel="noopener">The Future of React Router and @reach/router</a>ï¼Œ5.Xç‰ˆæœ¬ä¼šæ¨å‡ºHook API. æˆ‘ä»¬æš‚æ—¶å…ˆçœ‹çœ‹ä¸€äº›ä»£ç ç¤ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¿é—®è·¯ç”±å˜é‡</span></span><br><span class="line">  <span class="keyword">const</span> &#123; userId &#125; = useParams()</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePageViews</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¿é—®locationå¯¹è±¡</span></span><br><span class="line">  <span class="comment">// åŸæœ¬å¯¹äºéè·¯ç”±ç»„ä»¶ï¼Œéœ€è¦è®¿é—®è·¯ç”±ä¿¡æ¯éœ€è¦é€šè¿‡withRouteré«˜é˜¶ç»„ä»¶æ³¨å…¥</span></span><br><span class="line">  <span class="keyword">const</span> &#123; location &#125; = useLocation()</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>, location.pathname)</span><br><span class="line">  &#125;, [location])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ç­‰ç­‰å§!</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-5-react-hook-form-hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±"><a href="#4-5-react-hook-form-hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±" class="headerlink" title="4-5 react-hook-form Hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±?"></a>4-5 react-hook-form Hookså’Œè¡¨å•èƒ½æ“¦å‡ºä»€ä¹ˆç«èŠ±?</h3><p><a href="https://github.com/react-hook-form/react-hook-form" target="_blank" rel="noopener">react-hook-form</a>æ˜¯Hooks+Formçš„å…¸å‹æ¡ˆä¾‹ï¼Œæ¯”è¾ƒç¬¦åˆæˆ‘ç†æƒ³ä¸­çš„è¡¨å•ç®¡ç†æ–¹å¼:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useForm <span class="keyword">from</span> <span class="string">'react-hook-form'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; register, handleSubmit, errors &#125; = useForm(); <span class="comment">// initialise the hook</span></span><br><span class="line">  <span class="keyword">const</span> onSubmit = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;; <span class="comment">// callback when validation pass</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;handleSubmit(onSubmit)&#125;&gt;</span><br><span class="line">      &lt;input name=<span class="string">"firstname"</span> ref=&#123;register&#125; /&gt; &#123;<span class="comment">/* register an input */</span>&#125;</span><br><span class="line">      </span><br><span class="line">      &lt;input name=<span class="string">"lastname"</span> ref=&#123;register(&#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;)&#125; /&gt;</span><br><span class="line">      &#123;errors.lastname &amp;&amp; <span class="string">'Last name is required.'</span>&#125;</span><br><span class="line">      </span><br><span class="line">      &lt;input name=<span class="string">"age"</span> ref=&#123;register(&#123; <span class="attr">pattern</span>: <span class="regexp">/\d+/</span> &#125;)&#125; /&gt;</span><br><span class="line">      &#123;errors.age &amp;&amp; <span class="string">'Please enter number for age.'</span>&#125;</span><br><span class="line">      </span><br><span class="line">      &lt;input type=<span class="string">"submit"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="5-å‰¯ä½œç”¨å°è£…"><a href="#5-å‰¯ä½œç”¨å°è£…" class="headerlink" title="5. å‰¯ä½œç”¨å°è£…"></a><strong>5. å‰¯ä½œç”¨å°è£…</strong></h2><p>æˆ‘ä»¬å¯ä»¥<strong>åˆ©ç”¨Hooksæ¥å°è£…æˆ–ç›‘å¬ç»„ä»¶å¤–éƒ¨çš„å‰¯ä½œç”¨ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºç»„ä»¶çš„çŠ¶æ€</strong>ã€‚</p><p><br></p><h3 id="5-1-usetimeout-è¶…æ—¶ä¿®æ”¹çŠ¶æ€"><a href="#5-1-usetimeout-è¶…æ—¶ä¿®æ”¹çŠ¶æ€" class="headerlink" title="5-1 useTimeout è¶…æ—¶ä¿®æ”¹çŠ¶æ€"></a>5-1 useTimeout è¶…æ—¶ä¿®æ”¹çŠ¶æ€</h3><p>useTimeoutç”±ç”¨æˆ·è§¦å‘ï¼Œåœ¨æŒ‡å®šæ—¶é—´åæ¢å¤çŠ¶æ€. æ¯”å¦‚å¯ä»¥ç”¨äºâ€™çŸ­æœŸç¦ç”¨â€™æŒ‰é’®, é¿å…é‡å¤ç‚¹å‡»:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [disabled, start] = useTimeout(<span class="number">5000</span>)</span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    start()</span><br><span class="line">    dosomething()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;Button onClick=&#123;handleClick&#125; disabled=&#123;disabled&#125;&gt;ç‚¹æˆ‘&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å®ç°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTimeout</span>(<span class="params">ms: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [ready, setReady] = useState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> timerRef = useRef&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> start = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearTimeout(timerRef.current)</span><br><span class="line">    setReady(<span class="literal">true</span>)</span><br><span class="line">    timerRef.current = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setReady(<span class="literal">false</span>)</span><br><span class="line">    &#125;, ms)</span><br><span class="line">  &#125;, [ms])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stop = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearTimeout(timeRef.current)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useOnUnmount(stop)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [ready, start, stop]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-2-useonlinestatus-ç›‘å¬åœ¨çº¿çŠ¶æ€"><a href="#5-2-useonlinestatus-ç›‘å¬åœ¨çº¿çŠ¶æ€" class="headerlink" title="5-2 useOnlineStatus ç›‘å¬åœ¨çº¿çŠ¶æ€"></a>5-2 useOnlineStatus ç›‘å¬åœ¨çº¿çŠ¶æ€</h3><p>å‰¯ä½œç”¨å°è£…ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„æ¡ˆä¾‹å°±æ˜¯ç›‘å¬ä¸»æœºçš„åœ¨çº¿çŠ¶æ€ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOnlineStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> navigator.onLine === <span class="string">'boolean'</span> ? navigator.onLine : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useOnlineStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [onlineStatus, setOnlineStatus] = useState(getOnlineStatus())</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> online = <span class="function"><span class="params">()</span> =&gt;</span> setOnlineStatus(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> offline = <span class="function"><span class="params">()</span> =&gt;</span> setOnlineStatus(<span class="literal">false</span>)</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'online'</span>, online)</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'offline'</span>, offline)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">'online'</span>, online)</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">'offline'</span>, offline)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> onlineStatus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> onlineStatus = useOnlineStatus();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;ç½‘ç»œçŠ¶æ€: &#123;onlineStatus ? <span class="string">"åœ¨çº¿"</span> : <span class="string">"ç¦»çº¿"</span>&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿˜æœ‰å¾ˆå¤šæ¡ˆä¾‹, è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•å»å®ç°ï¼Œæ¯”å¦‚:</p><ul><li>useDeviceOrientation ç›‘å¬è®¾å¤‡æ–¹å‘</li><li>useGeolocation ç›‘å¬GPSåæ ‡å˜åŒ–</li><li>useScrollPosition ç›‘å¬æ»šåŠ¨ä½ç½®</li><li>useMotion ç›‘å¬è®¾å¤‡è¿åŠ¨</li><li>useMediaDevice ç›‘å¬åª’ä½“è®¾å¤‡</li><li>useDarkMode å¤œé—´æ¨¡å¼ç›‘å¬</li><li>useKeyBindings ç›‘å¬å¿«æ·é”®</li><li>â€¦.</li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="6-å‰¯ä½œç”¨è¡ç”Ÿ"><a href="#6-å‰¯ä½œç”¨è¡ç”Ÿ" class="headerlink" title="6. å‰¯ä½œç”¨è¡ç”Ÿ"></a><strong>6. å‰¯ä½œç”¨è¡ç”Ÿ</strong></h2><p><strong>å’Œ<code>å‰¯ä½œç”¨å°è£…</code>ç›¸åï¼Œå‰¯ä½œç”¨è¡ç”Ÿæ˜¯æŒ‡å½“ç»„ä»¶çŠ¶æ€å˜åŒ–æ—¶ï¼Œè¡ç”Ÿå‡ºå…¶ä»–å‰¯ä½œç”¨. ä¸¤è€…çš„æ–¹å‘æ˜¯ç›¸åçš„</strong>.</p><p>å‰¯ä½œç”¨è¡ç”Ÿä¸»è¦ä¼šç”¨åˆ°useEffectï¼Œä½¿ç”¨useEffectæ¥å“åº”çŠ¶æ€çš„å˜åŒ–.</p><h3 id="6-1-usetitle-è®¾ç½®æ–‡æ¡£title"><a href="#6-1-usetitle-è®¾ç½®æ–‡æ¡£title" class="headerlink" title="6-1 useTitle è®¾ç½®æ–‡æ¡£title"></a>6-1 useTitle è®¾ç½®æ–‡æ¡£title</h3><p>useTitleæ˜¯æœ€ç®€å•çš„ï¼Œå½“ç»™å®šçš„å€¼å˜åŒ–æ—¶ï¼Œæ›´æ–°<code>document.title</code></p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTitle</span>(<span class="params">t: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = t</span><br><span class="line">  &#125;, [t])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  useTitle(props.isEdit ? <span class="string">'ç¼–è¾‘'</span> : <span class="string">'æ–°å¢'</span>)</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-2-usedebounce"><a href="#6-2-usedebounce" class="headerlink" title="6-2 useDebounce"></a>6-2 useDebounce</h3><p>å†æ¥ä¸ªå¤æ‚ä¸€ç‚¹çš„ï¼ŒuseDebounceï¼šå½“æŸäº›çŠ¶æ€å˜åŒ–æ—¶ï¼Œå®ƒä¼šå»¶è¿Ÿæ‰§è¡ŒæŸäº›æ“ä½œï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useDebounce</span>(<span class="params">fn: () =&gt; <span class="built_in">void</span>, args?: <span class="built_in">any</span>[], ms: <span class="built_in">number</span> = 100, skipMount?: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> mounted = useRef(<span class="literal">false</span>)</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è·³è¿‡æŒ‚è½½æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (skipMount &amp;&amp; !mounted.current) &#123;</span><br><span class="line">      mounted.current = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> timer = setTimeout(fn, ms)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœargså˜åŒ–ï¼Œå…ˆæ¸…é™¤è®¡æ—¶å™¨</span></span><br><span class="line">      clearTimeout(timer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="keyword">const</span> returnEmptyArray = <span class="function"><span class="params">()</span> =&gt;</span> []</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = useState(<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState(returnEmptyArray)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æœç´¢</span></span><br><span class="line">  <span class="keyword">const</span> handleSearch = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    setList(<span class="keyword">await</span> fetchList(query))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“queryå˜åŒ–æ—¶æ‰§è¡Œæœç´¢</span></span><br><span class="line">  useDebounce(handleSearch, [query], <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;SearchBar value=&#123;query&#125; onChange=&#123;setQuery&#125; /&gt;</span><br><span class="line">    &lt;Result list=&#123;list&#125;&gt;&lt;<span class="regexp">/Result&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-3-usethrottle"><a href="#6-3-usethrottle" class="headerlink" title="6-3 useThrottle"></a>6-3 useThrottle</h3><p>åŒç†å¯ä»¥å®ç°useThrottle, ä¸‹é¢çš„ä¾‹å­æ¥æºäº<a href="https://github.com/streamich/react-use/blob/master/src/useThrottleFn.ts" target="_blank" rel="noopener">react-use</a>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useThrottleFn = &lt;T&gt;<span class="function">(<span class="params">fn: (<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt; T, ms: <span class="built_in">number</span> = 200, args: <span class="built_in">any</span>[]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState&lt;T&gt;(<span class="literal">null</span> <span class="keyword">as</span> <span class="built_in">any</span>);</span><br><span class="line">  <span class="keyword">const</span> timeout = useRef&lt;<span class="built_in">any</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> nextArgs = useRef(<span class="literal">null</span>) <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">  <span class="keyword">const</span> hasNextArgs = useRef(<span class="literal">false</span>) <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!timeout.current) &#123;</span><br><span class="line">      setState(fn(...args));</span><br><span class="line">      <span class="keyword">const</span> timeoutCallback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasNextArgs.current) &#123;</span><br><span class="line">          hasNextArgs.current = <span class="literal">false</span>;</span><br><span class="line">          setState(fn(...nextArgs.current));</span><br><span class="line">          timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          timeout.current = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      nextArgs.current = args;</span><br><span class="line">      hasNextArgs.current = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, args);</span><br><span class="line"></span><br><span class="line">  useOnUnmount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearTimeout(timeout.current);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="7-ç®€åŒ–ä¸šåŠ¡é€»è¾‘"><a href="#7-ç®€åŒ–ä¸šåŠ¡é€»è¾‘" class="headerlink" title="7. ç®€åŒ–ä¸šåŠ¡é€»è¾‘"></a><strong>7. ç®€åŒ–ä¸šåŠ¡é€»è¾‘</strong></h2><p><strong>80%çš„ç¨‹åºå‘˜80%çš„æ—¶é—´åœ¨å†™ä¸šåŠ¡ä»£ç </strong>. æœ‰äº†Hooksï¼ŒReactå¼€å‘è€…å¦‚è·è‡³å®. ç»„ä»¶çš„ä»£ç å¯ä»¥å˜å¾—å¾ˆç²¾ç®€ï¼Œä¸”è¿™äº›Hookså¯ä»¥æ–¹ä¾¿åœ°åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨:</p><p><img src="/images/react-hooks/hooks-transform.png" alt></p><p><br></p><p>ä¸‹é¢ä»‹ç»ï¼Œå¦‚ä½•åˆ©ç”¨Hooksæ¥ç®€åŒ–ä¸šåŠ¡ä»£ç </p><h3 id="7-1-usepromise-å°è£…å¼‚æ­¥è¯·æ±‚"><a href="#7-1-usepromise-å°è£…å¼‚æ­¥è¯·æ±‚" class="headerlink" title="7-1 usePromise å°è£…å¼‚æ­¥è¯·æ±‚"></a>7-1 usePromise å°è£…å¼‚æ­¥è¯·æ±‚</h3><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œè¯•è¯•å°è£…ä¸€ä¸‹promiseï¼Œç®€åŒ–ç®€å•é¡µé¢å¼‚æ­¥è¯·æ±‚çš„æµç¨‹. å…ˆæ¥çœ‹çœ‹usePromiseçš„ä½¿ç”¨ç¤ºä¾‹ï¼Œæˆ‘ç†æƒ³ä¸­çš„usePromiseåº”è¯¥é•¿è¿™æ ·:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Demo() &#123;</span><br><span class="line">  const list = usePromise(async (id: string) =&gt; &#123;</span><br><span class="line">    return fetchList(id)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return (&lt;div&gt;</span><br><span class="line">    &#123;/* è§¦å‘è¯·æ±‚ */&#125;</span><br><span class="line">    &lt;button onClick=&#123;() =&gt; list.callIgnoreError(&apos;myId&apos;)&#125;&gt;Get List&lt;/button&gt;</span><br><span class="line">    &#123;/* é”™è¯¯ä¿¡æ¯å±•ç¤ºå’Œé‡è¯• */&#125;</span><br><span class="line">    &#123;!!list.error &amp;&amp; &lt;ErrorMessage error=&#123;list.error&#125; retry=&#123;list.retry&#125;&gt;åŠ è½½å¤±è´¥:&lt;/ErrorMessage&gt;&#125;</span><br><span class="line">    &#123;/* åŠ è½½çŠ¶æ€ */&#125;</span><br><span class="line">    &lt;Loader loading=&#123;list.loading&#125;&gt;</span><br><span class="line">      &#123;/* è¯·æ±‚ç»“æœ */&#125;</span><br><span class="line">      &lt;Result value=&#123;list.value&#125;&gt;&lt;/Result&gt;</span><br><span class="line">    &lt;/Loader&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>usePromiseæ˜¯æˆ‘ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¸€ä¸ªHooksï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒå®Œæ•´çš„ä»£ç ï¼ŒåŒ…æ‹¬Typescriptæ³¨è§£éƒ½è´´å‡ºæ¥ï¼Œä¾›å¤§å®¶å‚è€ƒå‚è€ƒ:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰usePromiseçš„è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Res&lt;T, S&gt; &#123;</span><br><span class="line">  loading: <span class="built_in">boolean</span></span><br><span class="line">  error?: <span class="built_in">Error</span></span><br><span class="line">  value?: S</span><br><span class="line">  setValue: <span class="function">(<span class="params">v: S</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  call: T</span><br><span class="line">  callIgnoreError: T</span><br><span class="line">  reset: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  retry: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰usePromise å‚æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UsePromiseOptions &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœpromiseæ­£åœ¨åŠ è½½ä¸­åˆ™è·³è¿‡ï¼Œé»˜è®¤ä¸ºtrue</span></span><br><span class="line">  skipOnLoading?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‡ ä¸‹é¢æ˜¯ä¸€å †Typescriptå‡½æ•°é‡è½½å£°æ˜ï¼Œä¸ºäº†æ–¹ä¾¿Typescriptæ¨æ–­æ³›å‹å˜é‡. å°ç™½å¯ä»¥è·³è¿‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>&gt;(<span class="params">action: () =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params"></span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>&gt;(<span class="params">action: (arg0: A) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">B</span>&gt;(<span class="params">action: (arg0: A, arg1: B) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A, arg1: B</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>&gt;(<span class="params"> action: (arg0: A, arg1: B, arg2: C) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A, arg1: B, arg2: C</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>&gt;(<span class="params">action: (arg0: A, arg1: B, arg2: C, arg3: D) =&gt; <span class="built_in">Promise</span>&lt;T&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">arg0: A, arg1: B, arg2: C, arg3: D</span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>(<span class="params">action: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;, option?: UsePromiseOptions</span>): <span class="title">Res</span>&lt;(<span class="params">...args: <span class="built_in">any</span></span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">any</span>&gt;, <span class="title">any</span>&gt;</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">// ğŸ‘† ä¸Šé¢æ˜¯ä¸€å †<span class="title">Typescript</span>å‡½æ•°é‡è½½å£°æ˜ï¼Œå¯ä»¥è·³è¿‡</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">/**</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"> * æ¥å—ä¸€ä¸ª<span class="title">action</span>ï¼Œç”¨äºæ‰§è¡Œå¼‚æ­¥æ“ä½œ</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"> */</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="keyword">function</span> <span class="title">usePromise</span>(<span class="params"></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  action: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;,</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  option: UsePromiseOptions = &#123; skipOnLoading: <span class="literal">true</span> &#125;,</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span>): <span class="title">Res</span>&lt;(<span class="params">...args: <span class="built_in">any</span></span>) =&gt; <span class="title">Promise</span>&lt;<span class="title">any</span>&gt;, <span class="title">any</span>&gt; </span>&#123;</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">actionRef</span> = <span class="title">useRefProps</span>(<span class="params">action</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">optionRef</span> = <span class="title">useRefProps</span>(<span class="params">option</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> [<span class="title">loading</span>, <span class="title">setLoading</span>, <span class="title">loadingRef</span>] = <span class="title">useRefState</span>(<span class="params"><span class="literal">false</span></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">taskIdRef</span> = <span class="title">useRef</span>&lt;<span class="title">number</span>&gt;(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">argsRef</span> = <span class="title">useRef</span>&lt;<span class="title">any</span>[]&gt;(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> [<span class="title">value</span>, <span class="title">setValue</span>] = <span class="title">useState</span>(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> [<span class="title">error</span>, <span class="title">setError</span>, <span class="title">errorRef</span>] = <span class="title">useRefState</span>&lt;<span class="title">Error</span> | <span class="title">undefined</span>&gt;(<span class="params"></span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">caller</span> = <span class="title">useCallback</span>(<span class="params"><span class="keyword">async</span> (...args: <span class="built_in">any</span>[]) =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    argsRef.current = args</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">if</span> (loadingRef.current &amp;&amp; optionRef.current.skipOnLoading) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">const</span> taskId = getUid()</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    taskIdRef.current = taskId</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="comment">// å·²ç»æœ‰æ–°çš„ä»»åŠ¡åœ¨æ‰§è¡Œäº†ï¼Œä»€ä¹ˆéƒ½ä¸åš</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">const</span> shouldContinue = () =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (taskId !== taskIdRef.current) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        <span class="keyword">return</span> <span class="literal">false</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span> <span class="literal">true</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">try</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      setLoading(<span class="literal">true</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      setError(<span class="literal">undefined</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">const</span> res = <span class="keyword">await</span> actionRef.current(...args)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (!shouldContinue()) <span class="keyword">return</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      setValue(res)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span> res</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125; <span class="keyword">catch</span> (err) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (shouldContinue()) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        setError(err)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">throw</span> err</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125; <span class="keyword">finally</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">if</span> (shouldContinue()) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        setLoading(<span class="literal">false</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  &#125;, []</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  // ä¸æŠ›å‡ºå¼‚å¸¸</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">callIgnoreError</span> = <span class="title">useCallback</span>(<span class="params"></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">async</span> (...args: <span class="built_in">any</span>[]) =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">try</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        <span class="keyword">return</span> <span class="keyword">await</span> caller(...args)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125; <span class="keyword">catch</span> &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">        <span class="comment">// ignore</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;,</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    [caller],</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  </span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">reset</span> = <span class="title">useCallback</span>(<span class="params">() =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    setLoading(<span class="literal">false</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    setValue(<span class="literal">undefined</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    setError(<span class="literal">undefined</span>)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  &#125;, []</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  // å¤±è´¥åé‡è¯•</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">const</span> <span class="title">retry</span> = <span class="title">useCallback</span>(<span class="params">() =&gt; &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">if</span> (argsRef.current &amp;&amp; errorRef.current) &#123;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">      <span class="keyword">return</span> callIgnoreError(...argsRef.current)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    &#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(`not call yet`)</span></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="params">  &#125;, []</span>)</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"></span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  <span class="title">return</span> </span>&#123;</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">loading</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">error</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">call</span>: <span class="title">caller</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">callIgnoreError</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">value</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">setValue</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">reset</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">    <span class="title">retry</span>,</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">  &#125;</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="function"><span class="function">&#125;</span></span></span></span></span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-2-usepromiseeffect-è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚"><a href="#7-2-usepromiseeffect-è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚" class="headerlink" title="7-2 usePromiseEffect è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚"></a>7-2 usePromiseEffect è‡ªåŠ¨è¿›è¡Œå¼‚æ­¥è¯·æ±‚</h3><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯åœ¨ç»„ä»¶ä¸€æŒ‚è½½æˆ–è€…æŸäº›çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨è¿›è¡Œä¸€æ­¥è¯·æ±‚çš„ï¼Œæˆ‘ä»¬åœ¨usePromiseçš„åŸºç¡€ä¸Šï¼Œç»“åˆuseEffectæ¥å®ç°è‡ªåŠ¨è°ƒç”¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸ºäº†ç¼©çŸ­ç¯‡å¹…ï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘è·ŸusePromiseä¸€æ ·çš„å‡½æ•°é‡è½½äº†</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">usePromiseEffect</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  action: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">Promise</span>&lt;T&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  args?: <span class="built_in">any</span>[],</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prom = usePromise(action)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨useEffectç›‘å¬å‚æ•°å˜åŠ¨å¹¶æ‰§è¡Œ</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    prom.callIgnoreError.apply(<span class="literal">null</span>, args)</span><br><span class="line">  &#125;, args)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> prom</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="comment">// EXAMPLE</span></span><br><span class="line"><span class="comment">// ---------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åœ¨æŒ‚è½½æˆ–è€…idå˜åŒ–æ—¶è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">const</span> list = usePromiseEffect(<span class="function">(<span class="params">id</span>) =&gt;</span> fetchById(id), [id])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒusePromise</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œåº”è¯¥æƒŠå¹Hooksçš„æŠ½è±¡èƒ½åŠ›äº†å§ï¼ğŸ˜¸</p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-3-useinfinitelist-å®ç°æ— é™åŠ è½½åˆ—è¡¨"><a href="#7-3-useinfinitelist-å®ç°æ— é™åŠ è½½åˆ—è¡¨" class="headerlink" title="7-3 useInfiniteList å®ç°æ— é™åŠ è½½åˆ—è¡¨"></a>7-3 useInfiniteList å®ç°æ— é™åŠ è½½åˆ—è¡¨</h3><p>è¿™é‡Œä¾‹å­åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹ŸæåŠè¿‡</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useInfiniteList</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  fn: (params: &#123; offset: <span class="built_in">number</span>; pageSize: <span class="built_in">number</span>; list: T[] &#125;) =&gt; <span class="built_in">Promise</span>&lt;T[]&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pageSize: <span class="built_in">number</span> = 20,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;T[]&gt;(returnEmptyArray)</span><br><span class="line">  <span class="comment">// åˆ—è¡¨æ˜¯å¦å…¨éƒ¨åŠ è½½å®Œæ¯•</span></span><br><span class="line">  <span class="keyword">const</span> [hasMore, setHasMore, hasMoreRef] = useRefState(<span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// åˆ—è¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">  <span class="keyword">const</span> [empty, setEmpty] = useState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> promise = usePromise(<span class="function"><span class="params">()</span> =&gt;</span> fn(&#123; list, offset: list.length, pageSize &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> load = useCallback(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!hasMoreRef.current) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> promise.call()</span><br><span class="line">    <span class="keyword">if</span> (res.length &lt; pageSize) &#123;</span><br><span class="line">      setHasMore(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setList(<span class="function"><span class="params">l</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.length === <span class="number">0</span> &amp;&amp; l.length === <span class="number">0</span>) &#123;</span><br><span class="line">        setEmpty(<span class="literal">true</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> [...l, ...res]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºåˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> clean = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setList([])</span><br><span class="line">    setHasMore(<span class="literal">true</span>)</span><br><span class="line">    setEmpty(<span class="literal">false</span>)</span><br><span class="line">    promise.reset()</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ·æ–°åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> refresh = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clean()</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      load()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    list,</span><br><span class="line">    hasMore,</span><br><span class="line">    empty,</span><br><span class="line">    loading: promise.loading,</span><br><span class="line">    error: promise.error,</span><br><span class="line">    load,</span><br><span class="line">    refresh,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Item &#123;</span><br><span class="line">  id: <span class="built_in">number</span></span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; load, list, hasMore, refresh &#125; = useInfiniteList&lt;Item&gt;<span class="function">(<span class="params"><span class="keyword">async</span> (<span class="params">&#123; offset, pageSize &#125;</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> list = []</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">for</span> (<span class="params"><span class="keyword">let</span> i = offset; i &lt; offset + pageSize; i++</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">if</span> (<span class="params">i === 200</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">break</span></span></span></span><br><span class="line"><span class="function"><span class="params">      &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      list.push(<span class="params">&#123; id: i, name: `$&#123;i&#125;-----` &#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> list</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">useEffect</span>(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    load(<span class="params"></span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;div className="App"&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;button onClick=&#123;refresh&#125;&gt;Refresh&lt;/button&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#123;list.map(<span class="params">i =&gt; (<span class="params"></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">        &lt;div key=&#123;i.id&#125;&gt;&#123;i.name&#125;&lt;/div&gt;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">      </span>)</span>)&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#123;hasMore ? &lt;button onClick=&#123;load&#125;&gt;Load more&lt;/button&gt; : &lt;div&gt;No more&lt;/div&gt;&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-4-usepoll-ç”¨hookå®ç°è½®è¯¢"><a href="#7-4-usepoll-ç”¨hookå®ç°è½®è¯¢" class="headerlink" title="7-4 usePoll ç”¨hookå®ç°è½®è¯¢"></a>7-4 usePoll ç”¨hookå®ç°è½®è¯¢</h3><p>ä¸‹é¢ä½¿ç”¨Hookså®ç°ä¸€ä¸ªå®šæ—¶è½®è¯¢å™¨</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UsePollOptions&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å†³å®šæ˜¯å¦è¦ç»§ç»­è½®è¯¢</span></span><br><span class="line"><span class="comment">   * @param arg ä¸Šä¸€æ¬¡è½®è¯¢è¿”å›çš„å€¼</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  condition: <span class="function">(<span class="params">arg?: T, error?: <span class="built_in">Error</span></span>) =&gt;</span> <span class="built_in">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è½®è¯¢æ“ä½œ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  poller: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Promise</span>&lt;T&gt;</span><br><span class="line">  onError?: <span class="function">(<span class="params">err: <span class="built_in">Error</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è½®è¯¢é—´éš”. é»˜è®¤ 5000</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  duration?: <span class="built_in">number</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç›‘å¬çš„å‚æ•°ï¼Œå½“è¿™äº›å‚æ•°å˜åŒ–æ—¶ï¼Œé‡æ–°æ£€æŸ¥è½®è¯¢æ¡ä»¶ï¼Œå†³å®šæ˜¯å¦ç»§ç»­è½®è¯¢</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  args?: <span class="built_in">any</span>[]</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ˜¯å¦ç«‹å³è½®è¯¢</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  immediately?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ç°é¡µé¢è½®è¯¢æœºåˆ¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">usePoll</span>&lt;<span class="title">T</span> = <span class="title">any</span>&gt;(<span class="params">options: UsePollOptions&lt;T&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [polling, setPolling, pollingRef] = useRefState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState&lt;<span class="built_in">Error</span>&gt;()</span><br><span class="line">  <span class="keyword">const</span> state = useInstance&lt;&#123; timer?: <span class="built_in">number</span>; unmounted?: <span class="built_in">boolean</span> &#125;&gt;(&#123;&#125;)</span><br><span class="line">  <span class="keyword">const</span> optionsRef = useRefProps(options)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> poll = useCallback(<span class="keyword">async</span> (immediate?: <span class="built_in">boolean</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å·²ç»å¸è½½ï¼Œæˆ–å…¶ä»–è½®è¯¢å™¨æ­£åœ¨è½®è¯¢</span></span><br><span class="line">    <span class="keyword">if</span> (state.unmounted || pollingRef.current) <span class="keyword">return</span></span><br><span class="line">    setPolling(<span class="literal">true</span>)</span><br><span class="line">    state.timer = <span class="built_in">window</span>.setTimeout(</span><br><span class="line">      <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (state.unmounted) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> res: T | <span class="literal">undefined</span></span><br><span class="line">          <span class="keyword">let</span> error: <span class="built_in">Error</span> | <span class="literal">undefined</span></span><br><span class="line">          setError(<span class="literal">undefined</span>)</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            res = <span class="keyword">await</span> optionsRef.current.poller()</span><br><span class="line">          &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            error = err</span><br><span class="line">            setError(err)</span><br><span class="line">            <span class="keyword">if</span> (optionsRef.current.onError) &#123;</span><br><span class="line">              optionsRef.current.onError(err)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å‡†å¤‡ä¸‹ä¸€æ¬¡è½®è¯¢</span></span><br><span class="line">          <span class="keyword">if</span> (!state.unmounted &amp;&amp; (<span class="keyword">await</span> optionsRef.current.condition(res, error))) &#123;</span><br><span class="line">            setTimeout(poll)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          !state.unmounted &amp;&amp; setPolling(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      immediate ? <span class="number">0</span> : optionsRef.current.duration || <span class="number">5000</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useOnUpdate(</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> optionsRef.current.condition()) poll(options.immediately)</span><br><span class="line">    &#125;,</span><br><span class="line">    options.args || [],</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  useOnUnmount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    state.unmounted = <span class="literal">true</span></span><br><span class="line">    clearTimeout(state.timer)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; polling, error &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = useState(<span class="string">')</span></span><br><span class="line"><span class="string">  const [result, setResult] = useState&lt;Result&gt;()</span></span><br><span class="line"><span class="string">  usePoll(&#123;</span></span><br><span class="line"><span class="string">    poller: await() =&gt; &#123;</span></span><br><span class="line"><span class="string">      const res =await fetch(query)</span></span><br><span class="line"><span class="string">      setResult(res)</span></span><br><span class="line"><span class="string">      return res</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    condition: async () =&gt; &#123;</span></span><br><span class="line"><span class="string">      return query !== '</span><span class="string">'</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    args: [query],</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // ...</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="7-5-ä¸šåŠ¡é€»è¾‘æŠ½ç¦»"><a href="#7-5-ä¸šåŠ¡é€»è¾‘æŠ½ç¦»" class="headerlink" title="7-5 ä¸šåŠ¡é€»è¾‘æŠ½ç¦»"></a>7-5 ä¸šåŠ¡é€»è¾‘æŠ½ç¦»</h3><p>é€šè¿‡ä¸Šé¢çš„æ¡ˆä¾‹å¯ä»¥çœ‹åˆ°, Hookséå¸¸é€‚åˆç”¨äºæŠ½ç¦»é‡å¤çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>åœ¨<a href="https://juejin.im/post/5cd8fb916fb9a03218556fc1#heading-6" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“02 - ç»„ä»¶çš„ç»„ç»‡</a>ä»‹ç»äº†å®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶åˆ†ç¦»ï¼ŒHooksæ—¶ä»£ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥è‡ªç„¶åœ°å°†é€»è¾‘éƒ½æ”¾ç½®åˆ°Hooksä¸­ï¼Œå®ç°é€»è¾‘å’Œè§†å›¾çš„åˆ†ç¦»</strong>ã€‚</p><p>æŠ½ç¦»çš„åä¸šåŠ¡é€»è¾‘å¯ä»¥å¤ç”¨äºä¸åŒçš„â€™å±•ç¤ºå¹³å°â€™, ä¾‹å¦‚ web ç‰ˆå’Œ native ç‰ˆ:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Login/</span><br><span class="line">  useLogin.ts   // å°†æ‰€æœ‰é€»è¾‘éƒ½æŠ½å–åˆ°Hooksä¸­</span><br><span class="line">  index.web.tsx // åªä¿ç•™è§†å›¾</span><br><span class="line">  index.tsx</span><br></pre></td></tr></table></figure><p><br><br><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="8-å¼€è„‘æ´"><a href="#8-å¼€è„‘æ´" class="headerlink" title="8. å¼€è„‘æ´"></a><strong>8. å¼€è„‘æ´</strong></h2><p>ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ï¼Œä¸çŸ¥é“æ€ä¹ˆåˆ†ç±»ã€‚ä½œè€…æƒ³è±¡åŠ›éå¸¸ä¸°å¯Œ!</p><h3 id="8-1-usescript-hooks-suspend-â¤ï¸"><a href="#8-1-usescript-hooks-suspend-â¤ï¸" class="headerlink" title="8-1 useScript: Hooks + Suspend = â¤ï¸"></a>8-1 useScript: Hooks + Suspend = â¤ï¸</h3><p>è¿™ä¸ªæ¡ˆä¾‹æ¥æºäº<a href="https://github.com/palmerhq/the-platform#usescript" target="_blank" rel="noopener">the-platform</a>, ä½¿ç”¨scriptæ ‡ç­¾æ¥åŠ è½½å¤–éƒ¨è„šæœ¬:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„: è¿™è¿˜æ˜¯å®éªŒæ€§ç‰¹æ€§</span></span><br><span class="line"><span class="keyword">import</span> &#123;createResource&#125; <span class="keyword">from</span> <span class="string">'react-cache'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ScriptResource = createResource(<span class="function">(<span class="params">src: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    script.src = src;</span><br><span class="line">    script.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(script);</span><br><span class="line">    script.onerror = reject;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useScript</span>(<span class="params">options: &#123; src: <span class="built_in">string</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ScriptResource.read(src);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useScript &#125; <span class="keyword">from</span> <span class="string">'the-platform'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Example = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   useScript(&#123; src: <span class="string">'bundle.js'</span> &#125;);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Suspend</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;Suspense fallback=&#123;<span class="string">'loading...'</span>&#125;&gt;&lt;Example&gt;&lt;<span class="regexp">/Example&gt;&lt;/</span>Suspense&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†è¿˜å¯ä»¥å®ç°</p><ul><li><a href="https://github.com/palmerhq/the-platform/blob/master/src/Stylesheet.tsx" target="_blank" rel="noopener">useStylesheet</a> ç”¨äºåŠ è½½æ ·å¼è¡¨</li><li><a href="https://github.com/CharlesStover/fetch-suspense" target="_blank" rel="noopener">fetch-suspense</a></li></ul><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="8-2-usemodal-æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†"><a href="#8-2-usemodal-æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†" class="headerlink" title="8-2 useModal æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†"></a>8-2 useModal æ¨¡æ€æ¡†æ•°æ®æµç®¡ç†</h3><p>æˆ‘åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-6" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a>ä¹Ÿä¸¾åˆ°ä¸€ä¸ªä½¿ç”¨<code>Hooks + Context</code>æ¥å·§å¦™å®ç°æ¨¡æ€æ¡†ç®¡ç†çš„ä¾‹å­ã€‚</p><p>å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Contextæ¥æ¸²æŸ“æ¨¡æ€æ¡†, å¾ˆç®€å•, ModalContext.Providerç»™ä¸‹çº§ç»„ä»¶æš´éœ²ä¸€ä¸ªrenderæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥ä¼ é€’éœ€è¦æ¸²æŸ“çš„æ¨¡æ€æ¡†ç»„ä»¶å’Œprops:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ€æ¡†ç»„ä»¶è¦å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> BaseModalProps &#123;</span><br><span class="line">  visible: <span class="built_in">boolean</span></span><br><span class="line">  onHide: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> ModalContextValue &#123;</span><br><span class="line">  render(Component: React.ComponentType&lt;<span class="built_in">any</span>&gt;, props: <span class="built_in">any</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Context = React.createContext&lt;ModalContextValue&gt;(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"useModal å¿…é¡»åœ¨ModalRenderer ä¸‹çº§"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ€æ¡†æ¸²æŸ“å™¨</span></span><br><span class="line"><span class="keyword">const</span> ModalRenderer: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [modal, setModal] = useState&lt;</span><br><span class="line">    | &#123; Comp: React.ComponentType&lt;<span class="built_in">any</span>&gt;; props: <span class="built_in">any</span>; visible?: <span class="built_in">boolean</span> &#125;</span><br><span class="line">    | <span class="literal">undefined</span></span><br><span class="line">  &gt;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> hide = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setModal(<span class="function"><span class="params">prev</span> =&gt;</span> prev &amp;&amp; &#123; ...prev, visible: <span class="literal">false</span> &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”±ä¸‹çº§ç»„ä»¶è°ƒç”¨ï¼Œä¼ é€’éœ€è¦æ¸²æŸ“çš„ç»„ä»¶å’Œprops</span></span><br><span class="line">  <span class="keyword">const</span> render = useCallback&lt;ModalContextValue[<span class="string">"render"</span>]&gt;<span class="function">(<span class="params">(<span class="params">Comp, props</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    setModal(<span class="params">&#123; Comp, props, visible: <span class="literal">true</span> &#125;</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;, []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">value</span> = <span class="params">useMemo</span>(<span class="params">(<span class="params"></span>) =&gt; (<span class="params">&#123;render&#125;</span>), []</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;Context.Provider value=&#123;value&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      &#123;props.children&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;div className="modal-container"&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">        &#123;<span class="comment">/*æ¨¡æ€æ¡†æ¸²æŸ“ */</span>&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">        &#123;!!modal &amp;&amp;</span></span></span><br><span class="line"><span class="function"><span class="params">          React.createElement(<span class="params">modal.Comp, &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            ...modal.props,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            visible: modal.visible,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            onHide: hide,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          &#125;</span>)&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">      &lt;/div&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/Context.Provider&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹Hooksçš„å®ç°, ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨useContextæ¥è®¿é—®ModalContextï¼Œ å¹¶è°ƒç”¨renderæ–¹æ³•:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useModal</span>&lt;<span class="title">P</span> <span class="title">extends</span> <span class="title">BaseModalProps</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  Modal: React.ComponentType&lt;P&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> renderer = useContext(Context)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> useCallback(</span><br><span class="line">    (props: Omit&lt;P, keyof BaseModalProps&gt;) =&gt; &#123;</span><br><span class="line">      renderer.render(Modal, props || &#123;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    [Modal],</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨ç¤ºä¾‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyModal: FC&lt;BaseModalProps &amp; &#123; a: <span class="built_in">number</span> &#125;&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Modal visible=&#123;props.visible&#125; onOk=&#123;props.onHide&#125; onCancel=&#123;props.onHide&#125;&gt;</span><br><span class="line">      &#123;props.a&#125;</span><br><span class="line">    &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Home: FC&lt;&#123;&#125;&gt; = props =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const showMyModal = useModal(MyModal)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const handleShow = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ æ˜¾ç¤ºæ¨¡æ€æ¡†</span></span><br><span class="line"><span class="regexp">    showMyModal(&#123;</span></span><br><span class="line"><span class="regexp">      a: 123,</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      showMyModal: &lt;button onClick=&#123;handleShow&#125;&gt;show&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯è¿è¡Œçš„å®Œæ•´ç¤ºä¾‹å¯ä»¥çœ‹<a href="https://codesandbox.io/s/lryom9617l?fontsize=14" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p><br></p><p><a href="#">â¤´ï¸å›åˆ°é¡¶éƒ¨</a></p><h2 id="react-hooks-æŠ€æœ¯åœ°å›¾"><a href="#react-hooks-æŠ€æœ¯åœ°å›¾" class="headerlink" title="React Hooks æŠ€æœ¯åœ°å›¾"></a><strong>React Hooks æŠ€æœ¯åœ°å›¾</strong></h2><p><strong>å…¨å®¶æ¡¶å’ŒHooksçš„ç»“åˆ</strong>:</p><ul><li><a href="https://react-redux.js.org/api/hooks" target="_blank" rel="noopener">Redux + Hooks</a></li><li><a href="https://github.com/mobxjs/mobx-react-lite" target="_blank" rel="noopener">Mobx + Hooks</a></li><li><a href="https://www.react-spring.io/docs/hooks/basics" target="_blank" rel="noopener">ReactSpring + Hooks</a></li><li><a href="https://www.apollographql.com/docs/react/api/react-hooks/" target="_blank" rel="noopener">Appoll</a></li><li><a href="https://react.i18next.com/latest/usetranslation-hook" target="_blank" rel="noopener">react-i18next</a></li><li><a href="https://reacttraining.com/blog/reach-react-router-future/" target="_blank" rel="noopener">react-router</a> Come in soon</li></ul><p><br></p><p><strong>ä¸€äº›æœ‰è¶£çš„Hooksé›†åˆ</strong>:</p><ul><li><a href="https://github.com/palmerhq/the-platform#usescript" target="_blank" rel="noopener">the-platform</a></li><li><a href="https://github.com/streamich/react-use" target="_blank" rel="noopener">react-use</a></li><li><a href="https://github.com/rehooks/ideas/issues" target="_blank" rel="noopener">rehooks/ideas</a> ä¸€èµ·å¼€è„‘æ´</li><li><a href="https://github.com/kitze/react-hanger" target="_blank" rel="noopener">react-hanger</a></li></ul><p><br></p><p><strong>Awesome</strong></p><ul><li><a href="https://github.com/rehooks/awesome-react-hooks" target="_blank" rel="noopener">Awesome React Hooks</a></li><li><a href="https://www.hooks.guide/rehooks/useComponentSize" target="_blank" rel="noopener">Hooks.Guide</a></li><li><a href="https://usehooks.com/" target="_blank" rel="noopener">useHooks</a></li></ul><p><br></p><p><strong>FAQ</strong></p><ul><li><a href="https://zh-hans.reactjs.org/docs/hooks-faq.html" target="_blank" rel="noopener">å®˜æ–¹Hooks FAQ</a> å¯ä»¥è§£ç­”å¤§éƒ¨åˆ†çš„ç–‘é—®</li></ul><p><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ç¯‡å¹…å¾ˆé•¿ã€ä»£ç å¾ˆå¤šã€‚èƒ½æ»‘åˆ°è¿™é‡Œç›¸å½“ä¸å®¹æ˜“, ç»™ä½ ç‚¹ä¸ªèµã€‚</p><p>ä½ ç”¨React Hooké‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¼€è¿‡ä»€ä¹ˆè„‘æ´ï¼Œä¸‹æ–¹è¯„è®ºå‘Šè¯‰æˆ‘.</p><p>æ¬¢è¿å…³æ³¨æˆ‘, å’Œæˆ‘äº¤æµ. æˆ‘æœ‰ç¤¾æ, ä½†æƒ³å¤šäº¤äº›åœˆå†…æœ‹å‹(<code>atob(&#39;YmxhbmstY2FybmV5&#39;)</code>, å¤‡æ³¨æ˜é‡‘ï¼Œæˆ‘ä¸å–èŒ¶ï¼Œè¿‘æœŸä¹Ÿä¸æ¢å·¥ä½œ)</p><p>æœ¬æ–‡å®Œ!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/react-hooks/cover.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;https://www.youtube.com/channel/UCz5vTaEhvh7dOHEyd
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>100æ¥è¡Œä»£ç , è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªæ¨¡æ¿å¼•æ“</title>
    <link href="https://bobi.ink/2019/08/09/ejs/"/>
    <id>https://bobi.ink/2019/08/09/ejs/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-14T01:29:53.703Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€å¼ å›¾è¯´æ˜Ejsæ¨¡æ¿å¼•æ“çš„åŸç†</p><p><img src="/images/ejs/ejs.png" alt></p><p><br></p><p>ä¸Šé¢ä¸€å¼ å›¾ï¼Œå·²ç»å¤§æ¦‚æŠŠä¸€ä¸ªç®€å•æ¨¡æ¿å¼•æ“(è¿™é‡Œä»¥<a href="https://ejs.co/" target="_blank" rel="noopener">EJS</a>ä¸ºä¾‹)çš„åŸç†è§£é‡Šå¾—ä¸ƒä¸ƒå…«å…«äº†ã€‚æœ¬æ–‡å°†æè¿°ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“æ˜¯æ€ä¹ˆè¿ä½œçš„ï¼ŸåŒ…å«å®ç°çš„å…³é”®æ­¥éª¤ã€ä»¥åŠå…¶èƒŒåçš„æ€æƒ³ã€‚</p><p>åŸºæœ¬ä¸Šæ¨¡æ¿å¼•æ“çš„å¥—è·¯ä¹Ÿå°±è¿™æ ·äº†ï¼Œä½†è¿™äº›æ€æƒ³æ˜¯é€šç”¨çš„ï¼Œæ¯”å¦‚ä½ åœ¨çœ‹vueçš„æ¨¡æ¿ç¼–è¯‘å™¨æºç ã€ä¹Ÿå¯ä»¥å¥—ç”¨è¿™äº›æ€æƒ³å’Œæ–¹æ³•.</p><p><br></p><h2 id="åŸºæœ¬apiè®¾è®¡"><a href="#åŸºæœ¬apiè®¾è®¡" class="headerlink" title="åŸºæœ¬APIè®¾è®¡"></a>åŸºæœ¬APIè®¾è®¡</h2><p>æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„EJS, è¿™ä¸ªæ¨¡æ¿å¼•æ“æ”¯æŒè¿™äº›æ ‡ç­¾:</p><ul><li><p><code>&lt;% script %&gt;</code> - è„šæœ¬æ‰§è¡Œ. ä¸€èˆ¬ç”¨äºæ§åˆ¶è¯­å¥ï¼Œä¸ä¼šè¾“å‡ºå€¼ ä¾‹å¦‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">user</span>) &#123; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>some thing<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>&lt;%= expression %&gt;</code> - è¾“å‡ºè¡¨è¾¾å¼çš„å€¼ï¼Œä½†æ˜¯ä¼šè½¬ä¹‰HTML:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;%= title %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>&lt;%- expression %&gt;</code> -  å’Œ<code>&lt;%= expr %&gt;</code>ä¸€æ ·ï¼Œåªä¸è¿‡ä¸ä¼šå¯¹HTMLè¿›è¡Œè½¬ä¹‰</p></li><li><code>&lt;%%</code> å’Œ<code>%%&gt;</code> - è¡¨ç¤ºæ ‡ç­¾è½¬ä¹‰, æ¯”å¦‚<code>&lt;%%</code>ä¼šè¾“å‡ºä¸º<code>&lt;%</code></li><li><code>&lt;%# æ³¨é‡Š %&gt;</code> - ä¸ä¼šæœ‰å†…å®¹è¾“å‡º</li></ul><p><br></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¨¡æ¿ç¤ºä¾‹ï¼Œä¸‹æ–‡ä¼šåŸºäºè¿™ä¸ªæ¨¡æ¿è¿›è¡Œè®²è§£:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">title</span> %&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%%</span> è½¬ä¹‰ %%&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%#</span> è¿™é‡Œæ˜¯æ³¨é‡Š %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%-</span> <span class="attr">before</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">show</span>) &#123; %&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>root<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p><strong>åŸºæœ¬APIè®¾è®¡</strong></p><p>æˆ‘ä»¬å°†æ¨¡æ¿è§£æå’Œæ¸²æŸ“ç›¸å…³çš„é€»è¾‘æ”¾åˆ°ä¸€ä¸ªTemplateç±»ä¸­ï¼Œå®ƒçš„åŸºæœ¬æ¥å£å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Template &#123;</span><br><span class="line">  <span class="keyword">public</span> template: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">private</span> tokens: <span class="built_in">string</span>[] = [];</span><br><span class="line">  <span class="keyword">private</span> source: <span class="built_in">string</span> = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">private</span> state?: State;</span><br><span class="line">  <span class="keyword">private</span> fn?: <span class="built_in">Function</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">template: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.template = template;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¨¡æ¿ç¼–è¯‘</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> compile() &#123;</span><br><span class="line">    <span class="keyword">this</span>.parseTemplateText();</span><br><span class="line">    <span class="keyword">this</span>.transformTokens();</span><br><span class="line">    <span class="keyword">this</span>.wrapit();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¸²æŸ“æ–¹æ³•ï¼Œç”±ç”¨æˆ·æŒ‡å®šä¸€ä¸ªå¯¹è±¡æ¥æ¸²æŸ“å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> render(local: object) &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * tokenè§£æ</span></span><br><span class="line"><span class="comment">   * å°†&lt;% if (codintion) &#123; %&gt;</span></span><br><span class="line"><span class="comment">   * è§£æä¸ºtokenæ•°ç»„ï¼Œä¾‹å¦‚['&lt;%', ' if (condition) &#123; ', '%&gt;']</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> parseTemplateText() &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†Tokenè½¬æ¢ä¸ºJavascriptè¯­å¥</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> transformTokens() &#123;&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†ä¸Šä¸€ä¸ªæ­¥éª¤è½¬æ¢å‡ºæ¥çš„Javascriptè¯­å¥ï¼Œå°è£…æˆä¸€ä¸ªæ¸²æŸ“æ–¹æ³•</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> wrapit() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="tokenè§£æ"><a href="#tokenè§£æ" class="headerlink" title="tokenè§£æ"></a>tokenè§£æ</h2><p>ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰çš„å¼€å§‹æ ‡ç­¾(start tag)å’Œç»“æŸæ ‡ç­¾(end tag)éƒ½è§£æå‡ºæ¥ï¼Œæˆ‘ä»¬æœŸæœ›çš„è§£æç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">"\n&lt;html&gt;\n  &lt;head&gt;"</span>,</span><br><span class="line">  <span class="string">"&lt;%="</span>,</span><br><span class="line">  <span class="string">" title "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"&lt;/head&gt;\n  &lt;body&gt;\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%%"</span>,</span><br><span class="line">  <span class="string">" è½¬ä¹‰ "</span>,</span><br><span class="line">  <span class="string">"%%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%#"</span>,</span><br><span class="line">  <span class="string">" è¿™é‡Œæ˜¯æ³¨é‡Š "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%-"</span>,</span><br><span class="line">  <span class="string">" before "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%"</span>,</span><br><span class="line">  <span class="string">" if (show) &#123; "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n      &lt;div&gt;root&lt;/div&gt;\n    "</span>,</span><br><span class="line">  <span class="string">"&lt;%"</span>,</span><br><span class="line">  <span class="string">" &#125; "</span>,</span><br><span class="line">  <span class="string">"%&gt;"</span>,</span><br><span class="line">  <span class="string">"\n  &lt;/body&gt;\n&lt;/html&gt;\n"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬çš„æ¨¡æ¿å¼•æ“è¯­æ³•éå¸¸ç®€å•, å‹æ ¹å°±ä¸éœ€è¦è§£ææˆä»€ä¹ˆæŠ½è±¡è¯­æ³•æ ‘(AST)(å³çœå»äº†è¯­æ³•è§£æ, åªè¿›è¡Œè¯æ³•è§£æ). ç›´æ¥é€šè¿‡<code>æ­£åˆ™è¡¨è¾¾å¼</code>å°±å¯ä»¥å®ç°å°†æ ‡ç­¾æŠ½å–å‡ºæ¥ã€‚</p><p>å…ˆå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼, ç”¨æ¥åŒ¹é…æˆ‘ä»¬æ‰€æœ‰æ”¯æŒçš„æ ‡ç­¾ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &lt;%% %%&gt; ç”¨äºè½¬ä¹‰</span></span><br><span class="line"><span class="comment">// &lt;% è„šæœ¬</span></span><br><span class="line"><span class="comment">// &lt;%= è¾“å‡ºè„šæœ¬å€¼</span></span><br><span class="line"><span class="comment">// &lt;%- è¾“å‡ºè„šæœ¬å€¼ï¼Œunescape</span></span><br><span class="line"><span class="comment">// &lt;%# æ³¨é‡Š</span></span><br><span class="line"><span class="comment">// %&gt; ç»“æŸæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> REGEXP = <span class="regexp">/(&lt;%%|%%&gt;|&lt;%=|&lt;%-|&lt;%#|&lt;%|%&gt;)/</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é€ä¸ªè¿›è¡ŒåŒ¹é…ï¼Œå°†å­—ç¬¦ä¸²æ‹†åˆ†å‡ºæ¥. ä»£ç ä¹Ÿå¾ˆç®€å•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">parseTemplateText() &#123;</span><br><span class="line">  <span class="keyword">let</span> str = <span class="keyword">this</span>.template;</span><br><span class="line">  <span class="keyword">const</span> arr = <span class="keyword">this</span>.tokens;</span><br><span class="line">  <span class="comment">// é€šè¿‡execæ–¹æ³•å¯ä»¥è·å–åŒ¹é…çš„ä½ç½®, å¦‚æœåŒ¹é…å¤±è´¥åˆ™è¿”å›null</span></span><br><span class="line">  <span class="keyword">let</span> res = REGEXP.exec(str);</span><br><span class="line">  <span class="keyword">let</span> index;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (res) &#123;</span><br><span class="line">    index = res.index;</span><br><span class="line">    <span class="comment">// å‰ç½®å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> (index !== <span class="number">0</span>) &#123;</span><br><span class="line">      arr.push(str.substring(<span class="number">0</span>, index));</span><br><span class="line">      str = str.slice(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    arr.push(res[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// æˆªæ–­å­—ç¬¦ä¸²ï¼Œç»§ç»­åŒ¹é…</span></span><br><span class="line">    str = str.slice(res[<span class="number">0</span>].length);</span><br><span class="line">    res = REGEXP.exec(str);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (str) &#123;</span><br><span class="line">    arr.push(str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="ç®€å•çš„è¯­æ³•æ£€æŸ¥"><a href="#ç®€å•çš„è¯­æ³•æ£€æŸ¥" class="headerlink" title="ç®€å•çš„è¯­æ³•æ£€æŸ¥"></a>ç®€å•çš„è¯­æ³•æ£€æŸ¥</h2><p>Okï¼Œå°†æ ‡ç­¾è§£æå‡ºæ¥åï¼Œå°±å¯ä»¥å¼€å§‹å‡†å¤‡å°†å®ƒä»¬è½¬æ¢ç§°ä¸ºâ€˜æ¸²æŸ“â€™å‡½æ•°äº†.</p><p>é¦–å…ˆè¿›è¡Œä¸€ä¸‹<strong>ç®€å•çš„è¯­æ³•æ£€æŸ¥</strong>ï¼Œæ£€æŸ¥æ ‡ç­¾æ˜¯å¦<strong>é—­åˆ</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> start = <span class="string">"&lt;%"</span>;           <span class="comment">// å¼€å§‹æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> end = <span class="string">"%&gt;"</span>;             <span class="comment">// ç»“æŸæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> escpStart = <span class="string">"&lt;%%"</span>;      <span class="comment">// å¼€å§‹æ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line"><span class="keyword">const</span> escpEnd = <span class="string">"%%&gt;"</span>;        <span class="comment">// ç»“æŸæ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line"><span class="keyword">const</span> escpoutStart = <span class="string">"&lt;%="</span>;   <span class="comment">// è½¬ä¹‰çš„è¡¨è¾¾å¼è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> unescpoutStart = <span class="string">"&lt;%-"</span>; <span class="comment">// ä¸è½¬ä¹‰çš„è¡¨è¾¾å¼è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> comtStart = <span class="string">"&lt;%#"</span>;      <span class="comment">// æ³¨é‡Š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (tok.includes(start) &amp;&amp; !tok.includes(escpStart)) &#123;</span><br><span class="line">  closing = <span class="keyword">this</span>.tokens[idx + <span class="number">2</span>];</span><br><span class="line">  <span class="keyword">if</span> (closing == <span class="literal">null</span> || !closing.includes(end)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`<span class="subst">$&#123;tok&#125;</span> æœªæ‰¾åˆ°å¯¹åº”çš„é—­åˆæ ‡ç­¾`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h2><p>ç°åœ¨å¼€å§‹éå†tokenã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœ‰é™çš„çŠ¶æ€æœº(Finite-state machine, FSM)æ¥æè¿°è½¬æ¢çš„é€»è¾‘.</p><p><code>çŠ¶æ€æœº</code>æ˜¯è¡¨ç¤º<strong>æœ‰é™ä¸ªçŠ¶æ€ä»¥åŠåœ¨è¿™äº›çŠ¶æ€ä¹‹é—´çš„è½¬ç§»å’ŒåŠ¨ä½œç­‰è¡Œä¸ºçš„æ•°å­¦æ¨¡å‹</strong>ã€‚ç®€å•è€Œè¨€ï¼Œæœ‰é™çŠ¶æ€æœºç”±ä¸€ç»„çŠ¶æ€ã€ä¸€ä¸ªåˆå§‹çŠ¶æ€ã€è¾“å…¥å’Œæ ¹æ®è¾“å…¥åŠç°æœ‰çŠ¶æ€è½¬æ¢ä¸ºä¸‹ä¸€ä¸ªçŠ¶æ€çš„è½¬æ¢å‡½æ•°ç»„æˆã€‚å®ƒæœ‰ä¸‰ä¸ªç‰¹å¾:</p><ul><li>çŠ¶æ€æ€»æ•°æ˜¯æœ‰é™çš„ã€‚</li><li>ä»»ä¸€æ—¶åˆ»ï¼Œåªå¤„åœ¨ä¸€ç§çŠ¶æ€ä¹‹ä¸­ã€‚</li><li>æŸç§æ¡ä»¶ä¸‹ï¼Œä¼šä»ä¸€ç§çŠ¶æ€è½¬å˜åˆ°å¦ä¸€ç§çŠ¶æ€</li></ul><p><br></p><p>ç¨å¾®åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬æ¨¡æ¿å¼•æ“çš„çŠ¶æ€è½¬æ¢å›¾å¦‚ä¸‹:</p><p><img src="/images/ejs/state.png" alt></p><p><br></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥æŠ½å–å‡ºä»¥ä¸‹çŠ¶æ€:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">enum State &#123;</span><br><span class="line">  EVAL,    <span class="comment">// è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line">  ESCAPED, <span class="comment">// è¡¨è¾¾å¼è¾“å‡º</span></span><br><span class="line">  RAW,     <span class="comment">// è¡¨è¾¾å¼è¾“å‡ºä¸è½¬ä¹‰</span></span><br><span class="line">  COMMENT, <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">  LITERAL  <span class="comment">// å­—é¢é‡ï¼Œç›´æ¥è¾“å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Ok, ç°åœ¨å¼€å§‹éå†token:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.tokens.forEach(<span class="function">(<span class="params">tok, idx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">switch</span> (tok) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ‡ç­¾è¯†åˆ«</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> start:</span><br><span class="line">      <span class="comment">// è„šæœ¬å¼€å§‹</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.EVAL;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> escpoutStart:</span><br><span class="line">      <span class="comment">// è½¬ä¹‰è¾“å‡º</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.ESCAPED;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> unescpoutStart:</span><br><span class="line">      <span class="comment">// éè½¬ä¹‰è¾“å‡º</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.RAW;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> comtStart:</span><br><span class="line">      <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.COMMENT;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> escpStart:</span><br><span class="line">      <span class="comment">// æ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line">      <span class="keyword">this</span>.state = State.LITERAL;</span><br><span class="line">      <span class="keyword">this</span>.source += <span class="string">`;__append('&lt;%');\n`</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> escpEnd:</span><br><span class="line">      <span class="keyword">this</span>.state = State.LITERAL;</span><br><span class="line">      <span class="keyword">this</span>.source += <span class="string">`;__append('%&gt;');\n`</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> end:</span><br><span class="line">      <span class="comment">// æ¢å¤åˆå§‹çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">this</span>.state = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * è½¬æ¢è¾“å‡º</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">this</span>.state) &#123;</span><br><span class="line">          <span class="keyword">case</span> State.EVAL:</span><br><span class="line">            <span class="comment">// ä»£ç </span></span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;<span class="subst">$&#123;tok&#125;</span>\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.ESCAPED:</span><br><span class="line">            <span class="comment">// stripSemi å°†å¤šä½™çš„åˆ†å·ç§»é™¤</span></span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;__append(escapeFn(<span class="subst">$&#123;stripSemi(tok)&#125;</span>));\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.RAW:</span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;__append(<span class="subst">$&#123;stripSemi(tok)&#125;</span>);\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.LITERAL:</span><br><span class="line">            <span class="comment">// å› ä¸ºæˆ‘ä»¬æŠŠå­—ç¬¦ä¸²æ”¾åˆ°å•å¼•å·ä¸­ï¼Œæ‰€ä»¥transformStringå°†tokä¸­çš„å•å¼•å·ã€æ¢è¡Œç¬¦ã€è½¬ä¹‰ç¬¦è¿›è¡Œè½¬ç§»</span></span><br><span class="line">            <span class="keyword">this</span>.source += <span class="string">`;__append('<span class="subst">$&#123;transformString(tok)&#125;</span>');\n`</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> State.COMMENT:</span><br><span class="line">            <span class="comment">// ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å­—é¢é‡</span></span><br><span class="line">        <span class="keyword">this</span>.source += <span class="string">`;__append('<span class="subst">$&#123;transformString(tok)&#125;</span>');\n`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·çš„ç»“æœ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">;__append(<span class="string">'\n&lt;html&gt;\n  &lt;head&gt;'</span>);</span><br><span class="line">;__append(escapeFn( title ));</span><br><span class="line">;__append(<span class="string">'&lt;/head&gt;\n  &lt;body&gt;\n    '</span>);</span><br><span class="line">;__append(<span class="string">'&lt;%'</span>);</span><br><span class="line">;__append(<span class="string">' è½¬ä¹‰ '</span>);</span><br><span class="line">;__append(<span class="string">'%&gt;'</span>);</span><br><span class="line">;__append(<span class="string">'\n    '</span>);</span><br><span class="line">;__append(<span class="string">'\n    '</span>);</span><br><span class="line">;__append( before );</span><br><span class="line">;__append(<span class="string">'\n    '</span>);</span><br><span class="line">; <span class="keyword">if</span> (show) &#123;</span><br><span class="line">;__append(<span class="string">'\n      &lt;div&gt;root&lt;/div&gt;\n    '</span>);</span><br><span class="line">; &#125;</span><br><span class="line">;__append(<span class="string">'\n  &lt;/body&gt;\n&lt;/html&gt;\n'</span>);</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°"><a href="#æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°" class="headerlink" title="æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°"></a>æœ€åä¸€æ­¥ï¼Œç”Ÿæˆå‡½æ•°</h2><p>ç°åœ¨æˆ‘ä»¬æŠŠè½¬æ¢ç»“æœåŒ…è£¹æˆå‡½æ•°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wrapit() &#123;</span><br><span class="line">    <span class="keyword">this</span>.source = <span class="string">`\</span></span><br><span class="line"><span class="string">const __out = [];</span></span><br><span class="line"><span class="string">const __append = __out.push.bind(__out);</span></span><br><span class="line"><span class="string">with(local||&#123;&#125;) &#123;</span></span><br><span class="line"><span class="string"><span class="subst">$&#123;<span class="keyword">this</span>.source&#125;</span></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">return __out.join('');\</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">    <span class="keyword">this</span>.fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"local"</span>, <span class="string">"escapeFn"</span>, <span class="keyword">this</span>.source);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨åˆ°äº†<code>with</code>è¯­å¥ï¼Œæ¥åŒ…è£¹ä¸Šé¢è½¬æ¢çš„ä»£ç ï¼Œè¿™æ ·å¯ä»¥å…å»localå¯¹è±¡è®¿é—®é™å®šå‰ç¼€ã€‚</p><p>æ¸²æŸ“æ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥è°ƒç”¨ä¸Šé¢åŒ…è£¹çš„å‡½æ•°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render(local: object) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.fn.call(<span class="literal">null</span>, local, <span class="built_in">escape</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="è·‘èµ·æ¥"><a href="#è·‘èµ·æ¥" class="headerlink" title="è·‘èµ·æ¥"></a>è·‘èµ·æ¥</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> temp = <span class="keyword">new</span> Template(<span class="string">`</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">  &lt;head&gt;&lt;%= title %&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;%% è½¬ä¹‰ %%&gt;</span></span><br><span class="line"><span class="string">    &lt;%# è¿™é‡Œæ˜¯æ³¨é‡Š %&gt;</span></span><br><span class="line"><span class="string">    &lt;%- before %&gt;</span></span><br><span class="line"><span class="string">    &lt;% if (show) &#123; %&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;root&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;% &#125; %&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line">temp.compile();</span><br><span class="line">temp.render(&#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">"hello"</span>, <span class="attr">before</span>: <span class="string">"&lt;div&gt;xx&lt;/div&gt;"</span> &#125;)</span><br><span class="line"><span class="comment">// &lt;html&gt;</span></span><br><span class="line"><span class="comment">//   &lt;head&gt;hello&lt;/head&gt;</span></span><br><span class="line"><span class="comment">//   &lt;body&gt;</span></span><br><span class="line"><span class="comment">//     &lt;% è½¬ä¹‰ %&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     &lt;div&gt;xx&lt;/div&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//       &lt;div&gt;root&lt;/div&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   &lt;/body&gt;</span></span><br><span class="line"><span class="comment">// &lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨CodeSandboxè¿è¡Œå®Œæ•´çš„ä»£ç :</p><p><a href="https://codesandbox.io/s/ejs-wp11m?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit ejs"></a></p><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡å…¶å®å—åˆ°äº†<a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">the-super-tiny-compiler</a>å¯å‘ï¼Œå®ç°äº†ä¸€ä¸ªæç®€çš„æ¨¡æ¿å¼•æ“ï¼Œå…¶å®æ¨¡æ¿å¼•æ“æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªCompilerï¼Œé€šè¿‡ä¸Šæ–‡å¯ä»¥äº†è§£åˆ°ä¸€ä¸ªæ¨¡æ¿å¼•æ“ç¼–è¯‘æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li><p><strong>è§£æ</strong> å°†æ¨¡æ¿ä»£ç è§£ææˆæŠ½è±¡çš„è¡¨ç¤ºå½¢å¼ã€‚å¤æ‚çš„ç¼–è¯‘å™¨ä¼šæœ‰<code>è¯æ³•è§£æ(Lexical Analysis)</code>å’Œ<code>è¯­æ³•è§£æ(Syntactic Analysis)</code></p><p> <strong>è¯æ³•è§£æ</strong>, ä¸Šæ–‡æˆ‘ä»¬å°†æ¨¡æ¿å†…å®¹è§£ææˆtokençš„è¿‡ç¨‹å°±å¯ä»¥è®¤ä¸ºæ˜¯â€˜è¯æ³•è§£æâ€™ï¼Œå®ƒä¼šå°†æºä»£ç æ‹†åˆ†ç§°ä¸ºtokenæ•°ç»„ï¼Œtokenæ˜¯ä¸€ä¸ªå°å•å…ƒï¼Œè¡¨ç¤ºç‹¬ç«‹çš„â€˜è¯­æ³•ç‰‡æ®µâ€™ã€‚</p><p> <strong>è¯­æ³•è§£æ</strong>ï¼Œè¯­æ³•è§£æå™¨æ¥æ”¶tokenæ•°ç»„ï¼Œå°†å®ƒä»¬é‡æ–°æ ¼å¼åŒ–ç§°ä¸ºæŠ½è±¡è¯­æ³•æ ‘(Abstract Syntax Tree, AST), æŠ½è±¡è¯­æ³•æ ‘å¯ä»¥ç”¨äºæè¿°è¯­æ³•å•å…ƒ, ä»¥åŠå•å…ƒä¹‹é—´çš„å…³ç³»ã€‚ è¯­æ³•è§£æé˜¶æ®µå¯ä»¥å‘ç°è¯­æ³•é—®é¢˜ã€‚</p><p> <img src="/images/ejs/ast.png" alt></p><p> (å›¾ç‰‡æ¥æº: <a href="https://ruslanspivak.com/lsbasi-part7" target="_blank" rel="noopener">https://ruslanspivak.com/lsbasi-part7</a>)</p><p> æœ¬æ–‡ä»‹ç»çš„æ¨¡æ¿å¼•æ“ï¼Œå› ä¸ºè¯­æ³•å¤ªç®€å•äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦ASTè¿™ä¸ªä¸­é—´è¡¨ç¤ºå½¢å¼ã€‚ç›´æ¥åœ¨tokensä¸Šè¿›è¡Œè½¬æ¢</p></li><li><p><strong>è½¬æ¢</strong> å°†ä¸Šä¸ªæ­¥éª¤æŠ½è±¡çš„è¡¨ç¤ºå½¢å¼ï¼Œè½¬æ¢æˆä¸ºç¼–è¯‘å™¨æƒ³è¦çš„ã€‚æ¯”å¦‚ä¸Šæ–‡æ¨¡æ¿å¼•æ“ä¼šè½¬æ¢ä¸ºå¯¹åº”è¯­è¨€çš„è¯­å¥ã€‚å¤æ‚çš„ç¼–è¯‘å™¨ä¼šåŸºäºASTè¿›è¡Œâ€˜è½¬æ¢â€™ï¼Œä¹Ÿå°±æ˜¯å¯¹ASTè¿›è¡Œâ€˜å¢åˆ æŸ¥æ”¹â€™. é€šå¸¸ä¼šé…åˆVisitorsæ¨¡å¼æ¥éå†/è®¿é—®ASTçš„èŠ‚ç‚¹</p></li><li><strong>ä»£ç ç”Ÿæˆ</strong> å°†è½¬æ¢åçš„æŠ½è±¡è¡¨ç¤ºè½¬æ¢ä¸ºæ–°çš„ä»£ç ã€‚ æ¯”å¦‚æ¨¡æ¿å¼•æ“æœ€åä¸€æ­¥ä¼šå°è£…æˆä¸ºä¸€ä¸ªæ¸²æŸ“å‡½æ•°. å¤æ‚çš„ç¼–è¯‘å™¨ä¼šå°†ASTè½¬æ¢ä¸ºç›®æ ‡ä»£ç </li></ol><p>ç¼–è¯‘å™¨ç›¸å…³çš„ä¸œè¥¿ç¡®å®å¾ˆæœ‰è¶£ï¼Œåç»­æœ‰æœºä¼šå¯ä»¥è®²è®²æ€ä¹ˆç¼–å†™babelæ’ä»¶ã€‚</p><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://github.com/mde/ejs/tree/master/lib" target="_blank" rel="noopener">Ejsæºä»£ç </a></li><li><a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">the-super-tiny-compiler</a></li><li><a href="https://ruslanspivak.com/lsbasi-part7/" target="_blank" rel="noopener">Letâ€™s Build A Simple Interpreter. Part 7: Abstract Syntax Trees</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€å¼ å›¾è¯´æ˜Ejsæ¨¡æ¿å¼•æ“çš„åŸç†&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/ejs/ejs.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢ä¸€å¼ å›¾ï¼Œå·²ç»å¤§æ¦‚æŠŠä¸€ä¸ªç®€å•æ¨¡æ¿å¼•æ“(è¿™é‡Œä»¥&lt;a href=&quot;https://ejs.co/&quot; target=&quot;_b
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>æ­å¼€Electronçš„remoteæ¨¡å—çš„é¢çº±</title>
    <link href="https://bobi.ink/2019/08/04/electron-remote/"/>
    <id>https://bobi.ink/2019/08/04/electron-remote/</id>
    <published>2019-08-03T16:00:00.000Z</published>
    <updated>2019-08-09T13:28:24.883Z</updated>
    
    <content type="html"><![CDATA[<p>Electronçš„remoteæ¨¡å—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡çš„ä¸œè¥¿ï¼Œä¸º<code>æ¸²æŸ“è¿›ç¨‹</code>å’Œ<code>ä¸»è¿›ç¨‹</code>é€šä¿¡å°è£…äº†ä¸€ç§ç®€å•æ–¹æ³•ï¼Œé€šè¿‡remoteä½ å¯ä»¥â€™ç›´æ¥â€™è·å–ä¸»è¿›ç¨‹å¯¹è±¡æˆ–è€…è°ƒç”¨ä¸»è¿›ç¨‹å‡½æ•°æˆ–å¯¹è±¡çš„æ–¹æ³•, è€Œä¸å¿…æ˜¾å¼å‘é€è¿›ç¨‹é—´æ¶ˆæ¯, ç±»ä¼¼äº Java çš„ RMI. ä¾‹å¦‚:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; remote &#125; = <span class="built_in">require</span>(<span class="string">'electron'</span>)</span><br><span class="line"><span class="keyword">const</span> myModal = remote.require(<span class="string">'myModal'</span>) <span class="comment">// è®©ä¸»è¿›ç¨‹requireæŒ‡å®šæ¨¡å—ï¼Œå¹¶è¿”å›åˆ°æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">myModal.dosomething()                     <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p><br></p><p><strong>æœ¬è´¨ä¸Šï¼Œremoteæ¨¡å—æ˜¯åŸºäºElectronçš„IPCæœºåˆ¶çš„ï¼Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡çš„æ•°æ®å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ¯”å¦‚JSONåºåˆ—åŒ–</strong>ã€‚æ‰€ä»¥æœ¬æ–‡çš„ç›®çš„æ˜¯ä»‹ç»Electronæ˜¯å¦‚ä½•è®¾è®¡remoteæ¨¡å—çš„ï¼Œä»¥åŠé‡Œé¢æœ‰ä»€ä¹ˆå‘ã€‚</p><p><br></p><p><img src="/images/electron-remote/ipc.png" alt></p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><ul><li><a href="#%e9%80%9a%e4%bf%a1%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%ae%9a%e4%b9%89">é€šä¿¡åè®®çš„å®šä¹‰</a></li><li><a href="#%e5%af%b9%e8%b1%a1%e7%9a%84%e5%ba%8f%e5%88%97%e5%8c%96">å¯¹è±¡çš„åºåˆ—åŒ–</a></li><li><a href="#%e5%bd%b1%e5%ad%90%e5%af%b9%e8%b1%a1">å½±å­å¯¹è±¡</a></li><li><a href="#%e5%af%b9%e8%b1%a1%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f">å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="#%e6%b8%b2%e6%9f%93%e8%bf%9b%e7%a8%8b%e6%80%8e%e4%b9%88%e7%bb%99%e4%b8%bb%e8%bf%9b%e7%a8%8b%e4%bc%a0%e9%80%92%e5%9b%9e%e8%b0%83">æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ</a></li><li><a href="#%e4%b8%80%e4%ba%9b%e7%bc%ba%e9%99%b7">ä¸€äº›ç¼ºé™·</a></li><li><a href="#remote%e6%a8%a1%e5%9d%97%e5%ae%9e%e8%b7%b5%e5%92%8c%e4%bc%98%e5%8c%96">remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–</a></li><li><a href="#%e6%80%bb%e7%bb%93">æ€»ç»“</a></li><li><a href="#%e6%89%a9%e5%b1%95">æ‰©å±•</a></li></ul><p><br></p><h2 id="é€šä¿¡åè®®çš„å®šä¹‰"><a href="#é€šä¿¡åè®®çš„å®šä¹‰" class="headerlink" title="é€šä¿¡åè®®çš„å®šä¹‰"></a>é€šä¿¡åè®®çš„å®šä¹‰</h2><p>ä¸Šæ–‡è¯´åˆ°ï¼Œremoteæœ¬è´¨ä¸ŠåŸºäºåºåˆ—åŒ–çš„IPCé€šä¿¡çš„ï¼Œæ‰€ä»¥é¦–å…ˆå…³é”®éœ€è¦<strong>å®šä¹‰ä¸€ä¸ªåè®®æ¥æè¿°ä¸€ä¸ªæ¨¡å—/å¯¹è±¡çš„å¤–å½¢</strong>ï¼Œå…¶ä¸­åŒ…å«ä¸‹åˆ—ç±»å‹:</p><ul><li>åŸå§‹å€¼ã€‚ä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼</li><li>æ•°ç»„ã€‚</li><li>å¯¹è±¡ã€‚å¯¹è±¡å±æ€§ã€å¯¹è±¡çš„æ–¹æ³•ã€ä»¥åŠå¯¹è±¡çš„åŸå‹</li><li>å‡½æ•°ã€‚æ™®é€šå‡½æ•°å’Œæ„é€ æ–¹æ³•ã€å¼‚å¸¸å¤„ç†</li><li>ç‰¹æ®Šå¯¹è±¡ã€‚Dateã€Bufferã€Promiseã€å¼‚å¸¸å¯¹è±¡ç­‰ç­‰</li></ul><p><br></p><p>Electronä½¿ç”¨MetaData(å…ƒæ•°æ®)æ¥æè¿°è¿™äº›å¯¹è±¡å¤–å½¢çš„åè®®. ä¸‹é¢æ˜¯ä¸€äº›è½¬æ¢çš„ç¤ºä¾‹:</p><ul><li><p><strong>åŸºæœ¬å¯¹è±¡</strong>: åŸºæœ¬å¯¹è±¡å¾ˆå®¹æ˜“å¤„ç†ï¼Œç›´æ¥å€¼æ‹·è´ä¼ é€’å³å¯</p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">Buffer.from(<span class="string">'hello world'</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'message'</span>);</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">type</span>: <span class="string">"value"</span>, <span class="attr">value</span>: <span class="number">1</span>&#125;;</span><br><span class="line">&#123;<span class="attr">type</span>: <span class="string">"date"</span>, <span class="attr">value</span>: <span class="number">1565002306662</span>&#125;;  <span class="comment">// åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³</span></span><br><span class="line">&#123;<span class="attr">type</span>:Â <span class="string">"buffer"</span>, <span class="attr">value</span>:Â &#123;<span class="attr">data</span>:Â <span class="built_in">Uint8Array</span>(<span class="number">11</span>),Â <span class="attr">length</span>:Â <span class="number">11</span>,Â <span class="attr">type</span>:Â <span class="string">"Buffer"</span>&#125;&#125;; <span class="comment">// åºåˆ—åŒ–ä¸ºæ•°ç»„</span></span><br><span class="line">&#123;</span><br><span class="line">  members: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"stack"</span>,</span><br><span class="line">      value: <span class="string">"Error: message\n    at Object.&lt;anonymous&gt; (çœç•¥è°ƒç”¨æ ˆ)"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"message"</span>, <span class="attr">value</span>: <span class="string">"message"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"name"</span>, <span class="attr">value</span>: <span class="string">"Error"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  type: <span class="string">"error"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>æ•°ç»„</strong>: æ•°ç»„ä¹Ÿæ˜¯å€¼æ‹·è´</p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><p>æ•°ç»„ä¼šé€’å½’å¯¹æˆå‘˜è¿›è¡Œè½¬æ¢. æ³¨æ„æ•°ç»„å’ŒåŸºæœ¬ç±»å‹æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå®ƒä¹Ÿæ˜¯å€¼æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ä¿®æ”¹æ•°ç»„ä¸ä¼šå½±å“åˆ°å¯¹ç«¯è¿›ç¨‹çš„æ•°ç»„å€¼ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"members"</span>: [</span><br><span class="line">    &#123;<span class="string">"type"</span>:<span class="string">"value"</span>,<span class="string">"value"</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"type"</span>:<span class="string">"value"</span>,<span class="string">"value"</span>:<span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"type"</span>:<span class="string">"value"</span>,<span class="string">"value"</span>:<span class="number">3</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"type"</span>:<span class="string">"array"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><br></p><ul><li><p><strong>çº¯å¯¹è±¡</strong>: </p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.a;</span><br><span class="line">  &#125;,</span><br><span class="line">  c: &#123;</span><br><span class="line">    d: <span class="string">'d'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæœ‰ä¸€ä¸ªidï¼Œç”¨äºæ ‡è¯†ä¸»è¿›ç¨‹çš„ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">// å¯¹è±¡æˆå‘˜</span></span><br><span class="line">  members: [</span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"a"</span>, <span class="attr">type</span>: <span class="string">"get"</span>, <span class="attr">writable</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"b"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    <span class="comment">// electronåªä¼šè½¬æ¢ä¸€å±‚ï¼Œä¸ä¼šé€’å½’è½¬æ¢å†…åµŒå¯¹è±¡</span></span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"c"</span>, <span class="attr">type</span>: <span class="string">"get"</span>, <span class="attr">writable</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  name: <span class="string">"Object"</span>,</span><br><span class="line">  <span class="comment">// å¯¹è±¡çš„ä¸Šçº§åŸå‹çš„MetaData</span></span><br><span class="line">  proto: <span class="literal">null</span>,</span><br><span class="line">  type: <span class="string">"object"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>å‡½æ•°</strong>:</p><ul><li><p>è¾“å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'hello world'</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>è¾“å‡º</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// å‡½æ•°ä¹Ÿæœ‰ä¸€ä¸ªå”¯ä¸€idæ ‡è¯†ï¼Œå› ä¸ºå®ƒä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¸»è¿›ç¨‹éœ€è¦ä¿æŒè¯¥å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">  id: <span class="number">2</span>,</span><br><span class="line">  <span class="comment">// å‡½æ•°å±æ€§æˆå‘˜</span></span><br><span class="line">  members: [],</span><br><span class="line">  name: <span class="string">"Function"</span>,</span><br><span class="line">  type: <span class="string">"function"</span></span><br><span class="line">  <span class="comment">// Electronè§£æå¯¹è±¡çš„åŸå‹é“¾</span></span><br><span class="line">  proto: &#123;</span><br><span class="line">    members: [</span><br><span class="line">      <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">      &#123;</span><br><span class="line">        enumerable: <span class="literal">false</span>,</span><br><span class="line">        name: <span class="string">"constructor"</span>,</span><br><span class="line">        type: <span class="string">"method"</span>,</span><br><span class="line">        writable: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"apply"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"bind"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"call"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"toString"</span>, <span class="attr">type</span>: <span class="string">"method"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    proto: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li></ul></li><li><p><strong>Promise</strong>ï¼šPromiseåªéœ€æè¿°thenå‡½æ•°</p><ul><li><p>è¾“å…¥:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve();</span><br></pre></td></tr></table></figure></li><li><p>è¾“å…¥:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Promiseè¿™é‡Œå…³é”®åœ¨äºthenï¼Œè¯¦è§ä¸Šé¢çš„å‡½æ•°å…ƒæ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line">  type: <span class="string">"promise"</span></span><br><span class="line">  then: &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    members: [],</span><br><span class="line">    name: <span class="string">"Function"</span>,</span><br><span class="line">    proto: &#123;<span class="comment">/*è§ä¸Šé¢*/</span>&#125;,</span><br><span class="line">    type: <span class="string">"function"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><br></p><p>äº†è§£remoteçš„æ•°æ®ä¼ è¾“åè®®åï¼Œæœ‰ç»éªŒçš„å¼€å‘è€…åº”è¯¥å¿ƒé‡Œæœ‰åº•äº†ï¼Œå®ƒçš„åŸç†å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/images/electron-remote/meta-transform.png" alt></p><p>ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´éœ€è¦å°†å¯¹è±¡åºåˆ—åŒ–æˆMetaDataæè¿°ï¼Œè½¬æ¢çš„è§„åˆ™ä¸Šé¢å·²ç»è§£é‡Šçš„æ¯”è¾ƒæ¸…æ¥šäº†ã€‚è¿™é‡Œé¢éœ€è¦ç‰¹æ®Šå¤„ç†æ˜¯å¯¹è±¡å’Œå‡½æ•°ï¼Œæ¸²æŸ“è¿›ç¨‹æ‹¿åˆ°MetaDataåéœ€è¦å°è£…æˆä¸€ä¸ªå½±å­å¯¹è±¡/å‡½æ•°ï¼Œæ¥ä¾›æ¸²æŸ“è¿›ç¨‹åº”ç”¨è°ƒç”¨ã€‚</p><p>å…¶ä¸­æ¯”è¾ƒå¤æ‚çš„æ˜¯å¯¹è±¡å’Œå‡½æ•°çš„å¤„ç†ï¼ŒElectronä¸ºäº†é˜²æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œéœ€è¦å°†è¿™äº›å¯¹è±¡æ”¾è¿›ä¸€ä¸ªæ³¨å†Œè¡¨ä¸­ï¼Œåœ¨è¿™ä¸ªè¡¨ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„idæ¥æ ‡è¯†ã€‚è¿™ä¸ªidæœ‰ç‚¹ç±»ä¼¼äºâ€˜æŒ‡é’ˆâ€™ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šæ‹¿ç€è¿™ä¸ªidå‘ä¸»è¿›ç¨‹è¯·æ±‚è®¿é—®å¯¹è±¡ã€‚</p><p>é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦é‡Šæ”¾è¿™äº›å¯¹è±¡å‘¢ï¼Ÿä¸‹æ–‡ä¼šè®²å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªä¸Šå›¾æ²¡æœ‰å±•ç¤ºå‡ºæ¥çš„ç»†èŠ‚æ˜¯ï¼ŒElectronä¸ä¼šé€’å½’å»è½¬æ¢å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªä¼šè½¬æ¢ä¸€å±‚ã€‚è¿™æ ·å¯ä»¥å®‰å…¨åœ°å¼•ç”¨å­˜åœ¨å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ã€å¦å¤–æ‰€æœ‰å±æ€§å€¼åº”è¯¥ä»è¿œç¨‹è·å–æœ€æ–°çš„å€¼ï¼Œä¸èƒ½å‡è®¾å®ƒçš„ç»“æ„ä¸å¯å˜ã€‚</p><p><br><br><br></p><h2 id="å¯¹è±¡çš„åºåˆ—åŒ–"><a href="#å¯¹è±¡çš„åºåˆ—åŒ–" class="headerlink" title="å¯¹è±¡çš„åºåˆ—åŒ–"></a>å¯¹è±¡çš„åºåˆ—åŒ–</h2><p>å…ˆæ¥çœ‹çœ‹ä¸»è¿›ç¨‹çš„å®ç°ï¼Œå®ƒçš„ä»£ç ä½äº<a href="https://github.com/electron/electron/blob/master/lib/browser/rpc-server.js" target="_blank" rel="noopener">/lib/browser/rpc-server.js</a>ï¼Œä»£ç å¾ˆå°‘è€Œä¸”å¾ˆå¥½ç†è§£ï¼Œè¯»è€…å¯ä»¥è‡ªå·±è¯»ä¸€ä¸‹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸å…³æ³¨å¯¹è±¡åºåˆ—åŒ–çš„ç»†èŠ‚ï¼Œé‡ç‚¹å…³æ³¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œè°ƒç”¨çš„æµç¨‹. </p><p><br></p><p>ä»¥<code>remote.require</code>ä¸ºä¾‹, è¿™ä¸ªæ–¹æ³•ç”¨äºè®©ä¸»è¿›ç¨‹å»requireæŒ‡å®šæ¨¡å—ï¼Œç„¶åè¿”å›æ¨¡å—å†…å®¹ç»™æ¸²æŸ“è¿›ç¨‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleRemoteCommand(<span class="string">'ELECTRON_BROWSER_REQUIRE'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, contextId, moduleName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨require</span></span><br><span class="line">  <span class="keyword">const</span> returnValue = process.mainModule.require(moduleName)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†returnValueåºåˆ—åŒ–ä¸ºMetaData</span></span><br><span class="line">  <span class="keyword">return</span> valueToMeta(event.sender, contextId, returnValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>handleRemoteCommand</code> ä½¿ç”¨<a href="https://electronjs.org/docs/api/ipc-main" target="_blank" rel="noopener">ipcMain</a>ç›‘å¬rendererå‘é€çš„è¯·æ±‚ï¼Œ<code>contextId</code>ç”¨äºæ ‡è¯†ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚</p><p><br></p><p><code>valueToMeta</code>æ–¹æ³•å°†å€¼åºåˆ—åŒ–ä¸ºMetaData:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> valueToMeta = <span class="function"><span class="keyword">function</span> (<span class="params">sender, contextId, value, optimizeSimpleObject = false</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Determine the type of value.</span></span><br><span class="line">  <span class="keyword">const</span> meta = &#123; <span class="attr">type</span>: <span class="keyword">typeof</span> value &#125;</span><br><span class="line">  <span class="keyword">if</span> (meta.type === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="comment">// Recognize certain types of objects.</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">null</span>) &#123;</span><br><span class="line">      meta.type = <span class="string">'value'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bufferUtils.isBuffer(value)) &#123;</span><br><span class="line">      <span class="comment">// ... ğŸ”´ åŸºæœ¬ç±»å‹</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (meta.type === <span class="string">'array'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ æ•°ç»„è½¬æ¢</span></span><br><span class="line">    meta.members = value.map(<span class="function">(<span class="params">el</span>) =&gt;</span> valueToMeta(sender, contextId, el, optimizeSimpleObject))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'object'</span> || meta.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">    meta.name = value.constructor ? value.constructor.name : <span class="string">''</span></span><br><span class="line">    <span class="comment">// ğŸ”´ å°†å¯¹è±¡ä¿å­˜åˆ°æ³¨å†Œè¡¨ä¸­ï¼Œå¹¶è¿”å›å”¯ä¸€çš„å¯¹è±¡id.</span></span><br><span class="line">    <span class="comment">// Electronä¼šå‡è®¾æ¸²æŸ“è¿›ç¨‹ä¼šä¸€ç›´å¼•ç”¨è¿™ä¸ªå¯¹è±¡, ç›´åˆ°æ¸²æŸ“è¿›ç¨‹é€€å‡º</span></span><br><span class="line">    meta.id = objectsRegistry.add(sender, contextId, value)</span><br><span class="line">    meta.members = getObjectMembers(value)</span><br><span class="line">    meta.proto = getObjectPrototype(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'buffer'</span>) &#123;</span><br><span class="line">    meta.value = bufferUtils.bufferToMeta(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'promise'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´promise</span></span><br><span class="line">    value.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;)</span><br><span class="line">    meta.then = valueToMeta(sender, contextId, <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">      value.then(onFulfilled, onRejected)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'error'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´é”™è¯¯å¯¹è±¡</span></span><br><span class="line">    meta.members = plainObjectToMeta(value)</span><br><span class="line">    meta.members.push(&#123;</span><br><span class="line">      name: <span class="string">'name'</span>,</span><br><span class="line">      value: value.name</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (meta.type === <span class="string">'date'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´æ—¥æœŸ</span></span><br><span class="line">    meta.value = value.getTime()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–</span></span><br><span class="line">    meta.type = <span class="string">'value'</span></span><br><span class="line">    meta.value = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> meta</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="å½±å­å¯¹è±¡"><a href="#å½±å­å¯¹è±¡" class="headerlink" title="å½±å­å¯¹è±¡"></a>å½±å­å¯¹è±¡</h2><p><img src="/images/electron-remote/naruto.jpeg" alt></p><p>æ¸²æŸ“è¿›ç¨‹ä¼šä»MetaDataä¸­ååºåˆ—åŒ–çš„å¯¹è±¡æˆ–å‡½æ•°, ä¸è¿‡è¿™åªæ˜¯ä¸€ä¸ªâ€˜å½±å­â€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒä»¬ç§°ä¸º<strong>å½±å­å¯¹è±¡</strong>æˆ–è€…<strong>ä»£ç†å¯¹è±¡</strong>ã€<strong>æ›¿èº«</strong>. ç±»ä¼¼äºç«å½±å¿è€…ä¸­çš„å½±åˆ†èº«ä¹‹æœ¯ï¼Œä¸»ä½“å­˜å‚¨åœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œå½±å­å¯¹è±¡ä¸åŒ…å«ä»»ä½•å®ä½“æ•°æ®ï¼Œå½“è®¿é—®è¿™äº›å¯¹è±¡æˆ–è°ƒç”¨å‡½æ•°/æ–¹æ³•æ—¶ï¼Œå½±å­å¯¹è±¡ç›´æ¥è¿œç¨‹è¯·æ±‚ã€‚</p><blockquote><p>æ¸²æŸ“è¿›ç¨‹çš„ä»£ç å¯ä»¥çœ‹<a href="https://github.com/electron/electron/blob/master/lib/renderer/api/remote.js" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><p>æ¥çœ‹çœ‹æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆåˆ›å»ºâ€˜å½±å­å¯¹è±¡â€™:</p><p><strong>å‡½æ•°çš„å¤„ç†</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (meta.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´åˆ›å»ºä¸€ä¸ª'å½±å­'å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> remoteFunction = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> command</span><br><span class="line">    <span class="comment">// é€šè¿‡new Objå½¢å¼è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>.constructor === remoteFunction) &#123;</span><br><span class="line">      command = <span class="string">'ELECTRON_BROWSER_CONSTRUCTOR'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      command = <span class="string">'ELECTRON_BROWSER_FUNCTION_CALL'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ğŸ”´åŒæ­¥IPCè¿œç¨‹</span></span><br><span class="line">    <span class="comment">// wrapArgså°†å‡½æ•°å‚æ•°åºåˆ—åŒ–ä¸ºMetaData</span></span><br><span class="line">    <span class="keyword">const</span> obj = ipcRendererInternal.sendSync(command, contextId, meta.id, wrapArgs(args))</span><br><span class="line">    <span class="comment">// ğŸ”´ååºåˆ—åŒ–è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> metaToValue(obj)</span><br><span class="line">  &#125;</span><br><span class="line">  ret = remoteFunction</span><br></pre></td></tr></table></figure><p><br></p><p><strong>å¯¹è±¡æˆå‘˜çš„å¤„ç†</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setObjectMembers</span> (<span class="params">ref, object, metaId, members</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> member <span class="keyword">of</span> members) &#123;</span><br><span class="line">    <span class="keyword">if</span> (object.hasOwnProperty(member.name)) <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> descriptor = &#123; <span class="attr">enumerable</span>: member.enumerable &#125;</span><br><span class="line">    <span class="keyword">if</span> (member.type === <span class="string">'method'</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´åˆ›å»ºâ€˜å½±å­â€™æ–¹æ³•. å’Œä¸Šé¢çš„å‡½æ•°è°ƒç”¨å·®ä¸å¤š</span></span><br><span class="line">      <span class="keyword">const</span> remoteMemberFunction = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> command</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>.constructor === remoteMemberFunction) &#123;</span><br><span class="line">          command = <span class="string">'ELECTRON_BROWSER_MEMBER_CONSTRUCTOR'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          command = <span class="string">'ELECTRON_BROWSER_MEMBER_CALL'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> ret = ipcRendererInternal.sendSync(command, contextId, metaId, member.name, wrapArgs(args))</span><br><span class="line">        <span class="keyword">return</span> metaToValue(ret)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (member.type === <span class="string">'get'</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´å±æ€§çš„è·å–</span></span><br><span class="line">      descriptor.get = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> command = <span class="string">'ELECTRON_BROWSER_MEMBER_GET'</span></span><br><span class="line">        <span class="keyword">const</span> meta = ipcRendererInternal.sendSync(command, contextId, metaId, member.name)</span><br><span class="line">        <span class="keyword">return</span> metaToValue(meta)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ğŸ”´å±æ€§çš„è®¾ç½®</span></span><br><span class="line">      <span class="keyword">if</span> (member.writable) &#123;</span><br><span class="line">        descriptor.set = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> args = wrapArgs([value])</span><br><span class="line">          <span class="keyword">const</span> command = <span class="string">'ELECTRON_BROWSER_MEMBER_SET'</span></span><br><span class="line">          <span class="keyword">const</span> meta = ipcRendererInternal.sendSync(command, contextId, metaId, member.name, args)</span><br><span class="line">          <span class="keyword">if</span> (meta != <span class="literal">null</span>) metaToValue(meta)</span><br><span class="line">          <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(object, member.name, descriptor)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><strong>ä¸»è¿›ç¨‹çš„<code>valueToMeta</code>ä¼šå°†æ¯ä¸€ä¸ªå¯¹è±¡å’Œå‡½æ•°éƒ½æ”¾å…¥æ³¨å†Œè¡¨ä¸­ï¼ŒåŒ…æ‹¬æ¯æ¬¡å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼</strong>ã€‚</p><p>è¿™æ˜¯å¦æ„å‘³ç€ï¼Œå¦‚æœé¢‘ç¹è°ƒç”¨å‡½æ•°ï¼Œä¼šå¯¼è‡´æ³¨å†Œè¡¨æš´æ¶¨å ç”¨å¤ªå¤šå†…å­˜å‘¢ï¼Ÿè¿™äº›å¯¹è±¡ä»€ä¹ˆæ—¶å€™é‡Šæ”¾?</p><p><br></p><p>é¦–å…ˆ<strong>å½“æ¸²æŸ“è¿›ç¨‹é”€æ¯æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šé›†ä¸­é”€æ¯æ‰è¯¥è¿›ç¨‹çš„æ‰€æœ‰å¯¹è±¡å¼•ç”¨</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸²æŸ“è¿›ç¨‹é€€å‡ºæ—¶ä¼šé€šè¿‡è¿™ä¸ªäº‹ä»¶å‘Šè¯‰ä¸»è¿›ç¨‹ï¼Œä½†æ˜¯è¿™ä¸ªå¹¶ä¸èƒ½ä¿è¯æ”¶åˆ°</span></span><br><span class="line">handleRemoteCommand(<span class="string">'ELECTRON_BROWSER_CONTEXT_RELEASE'</span>, (event, contextId) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ¸…ç©ºå¯¹è±¡æ³¨å†Œè¡¨</span></span><br><span class="line">  objectsRegistry.clear(event.sender, contextId)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>ELECTRON_BROWSER_CONTEXT_RELEASE</code>ä¸èƒ½ä¿è¯èƒ½å¤Ÿæ”¶åˆ°ï¼Œæ‰€ä»¥<code>objectsRegistry</code>è¿˜ä¼šç›‘å¬å¯¹åº”æ¸²æŸ“è¿›ç¨‹çš„é”€æ¯äº‹ä»¶:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectsRegistry</span> </span>&#123;</span><br><span class="line">    registerDeleteListener (webContents, contextId) &#123;</span><br><span class="line">    <span class="comment">// contextId =&gt; $&#123;processHostId&#125;-$&#123;contextCount&#125;</span></span><br><span class="line">    <span class="keyword">const</span> processHostId = contextId.split(<span class="string">'-'</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> listener = <span class="function">(<span class="params">event, deletedProcessHostId</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (deletedProcessHostId &amp;&amp;</span><br><span class="line">          deletedProcessHostId.toString() === processHostId) &#123;</span><br><span class="line">        webContents.removeListener(<span class="string">'render-view-deleted'</span>, listener)</span><br><span class="line">        <span class="keyword">this</span>.clear(webContents, contextId)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ğŸ”´ ç›‘å¬æ¸²æŸ“è¿›ç¨‹é”€æ¯äº‹ä»¶, ç¡®ä¿ä¸‡æ— ä¸€å¤±</span></span><br><span class="line">    webContents.on(<span class="string">'render-view-deleted'</span>, listener)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç­‰<strong>åˆ°æ¸²æŸ“è¿›ç¨‹é”€æ¯å†å»é‡Šæ”¾è¿™äº›å¯¹è±¡æ˜¾ç„¶æ˜¯æ— æ³•æ¥å—çš„</strong>ï¼Œå’Œç½‘é¡µä¸ä¸€æ ·ï¼Œæ¡Œé¢ç«¯åº”ç”¨å¯èƒ½ä¼š7*24ä¸é—´æ–­è¿è¡Œï¼Œå¦‚æœè¦ç­‰åˆ°æ¸²æŸ“è¿›ç¨‹é€€å‡ºæ‰å»å›æ”¶å¯¹è±¡, æœ€ç»ˆä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºè¢«æ¶ˆè€—æ®†å°½ã€‚</p><p>æ‰€ä»¥<strong>Electronä¼šåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ç›‘å¬å¯¹è±¡çš„åƒåœ¾å›æ”¶äº‹ä»¶ï¼Œå†é€šè¿‡IPCé€šçŸ¥ä¸»è¿›ç¨‹æ¥é€’å‡å¯¹åº”å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</strong>ï¼Œ çœ‹çœ‹æ¸²æŸ“è¿›ç¨‹æ˜¯æ€ä¹ˆåšçš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¸²æŸ“è¿›ç¨‹ï¼Œååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">metaToValue</span> (<span class="params">meta</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹è±¡ç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="keyword">let</span> ret</span><br><span class="line">    <span class="keyword">if</span> (remoteObjectCache.has(meta.id)) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´ å¯¹è±¡å†ä¸€æ¬¡è¢«è®¿é—®ï¼Œé€’å¢å¯¹è±¡å¼•ç”¨è®¡æ•°. </span></span><br><span class="line">      <span class="comment">// v8Utilæ˜¯electronåŸç”Ÿæ¨¡å—</span></span><br><span class="line">      v8Util.addRemoteObjectRef(contextId, meta.id)</span><br><span class="line">      <span class="keyword">return</span> remoteObjectCache.get(meta.id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå½±å­ç±»è¡¨ç¤ºè¿œç¨‹å‡½æ•°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (meta.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> remoteFunction = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">      ret = remoteFunction</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ret = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setObjectMembers(ret, ret, meta.id, meta.members)</span><br><span class="line">    setObjectPrototype(ret, ret, meta.id, meta.proto)</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(ret.constructor, <span class="string">'name'</span>, &#123; <span class="attr">value</span>: meta.name &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”´ ç›‘å¬å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œé€šçŸ¥åˆ°ä¸»è¿›ç¨‹</span></span><br><span class="line">    v8Util.setRemoteObjectFreer(ret, contextId, meta.id)</span><br><span class="line">    v8Util.setHiddenValue(ret, <span class="string">'atomId'</span>, meta.id)</span><br><span class="line">    <span class="comment">// ğŸ”´ æ·»åŠ å¯¹è±¡å¼•ç”¨è®¡æ•°</span></span><br><span class="line">    v8Util.addRemoteObjectRef(contextId, meta.id)</span><br><span class="line">    remoteObjectCache.set(meta.id, ret)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç®€å•äº†è§£ä¸€ä¸‹ObjectFreerä»£ç :</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// atom/common/api/remote_object_freer.cc</span></span><br><span class="line"><span class="comment">// æ·»åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line"><span class="keyword">void</span> RemoteObjectFreer::AddRef(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; context_id, <span class="keyword">int</span> object_id) &#123;</span><br><span class="line">  ref_mapper_[context_id][object_id]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡é‡Šæ”¾äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line"><span class="keyword">void</span> RemoteObjectFreer::RunDestructor() &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">auto</span>* channel = <span class="string">"ELECTRON_BROWSER_DEREFERENCE"</span>;</span><br><span class="line">  base::ListValue args;</span><br><span class="line">  args.AppendString(context_id_);</span><br><span class="line">  args.AppendInteger(object_id_);</span><br><span class="line">  args.AppendInteger(ref_mapper_[context_id_][object_id_]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ æ¸…ç©ºå¼•ç”¨è¡¨</span></span><br><span class="line">  ref_mapper_[context_id_].erase(object_id_);</span><br><span class="line">  <span class="keyword">if</span> (ref_mapper_[context_id_].empty())</span><br><span class="line">    ref_mapper_.erase(context_id_);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ ipcé€šçŸ¥ä¸»è¿›ç¨‹</span></span><br><span class="line">  electron_ptr-&gt;Message(<span class="literal">true</span>, channel, args.Clone());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å†å›åˆ°ä¸»è¿›ç¨‹, ä¸»è¿›ç¨‹ç›‘å¬<code>ELECTRON_BROWSER_DEREFERENCE</code>äº‹ä»¶ï¼Œå¹¶é€’å‡æŒ‡å®šå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleRemoteCommand(<span class="string">'ELECTRON_BROWSER_DEREFERENCE'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, contextId, id, rendererSideRefCount</span>) </span>&#123;</span><br><span class="line">  objectsRegistry.remove(event.sender, contextId, id, rendererSideRefCount)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚æœè¢«ä¸Šé¢çš„ä»£ç ç»•å¾—ä¼˜ç‚¹æ™•ï¼Œé‚£å°±çœ‹çœ‹ä¸‹é¢çš„æµç¨‹å›¾, æ¶ˆåŒ–æ¶ˆåŒ–ï¼š</p><p><img src="/images/electron-remote/lifetime.png" alt></p><p><br><br><br></p><h2 id="æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ"><a href="#æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ"></a>æ¸²æŸ“è¿›ç¨‹æ€ä¹ˆç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒ</h2><p>åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œé€šè¿‡remoteè¿˜å¯ä»¥ç»™ä¸»è¿›ç¨‹çš„å‡½æ•°ä¼ é€’å›è°ƒã€‚å…¶å®è·Ÿä¸»è¿›ç¨‹æš´éœ²å‡½æ•°/å¯¹è±¡ç»™æ¸²æŸ“è¿›ç¨‹çš„åŸç†ä¸€æ ·ï¼Œæ¸²æŸ“è¿›ç¨‹åœ¨å°†å›è°ƒä¼ é€’ç»™ä¸»è¿›ç¨‹ä¹‹å‰ä¼šæ”¾ç½®åˆ°<strong>å›è°ƒæ³¨å†Œè¡¨</strong>ä¸­ï¼Œç„¶åç»™ä¸»è¿›ç¨‹æš´éœ²ä¸€ä¸ªcallbackIDã€‚</p><p>æ¸²æŸ“è¿›ç¨‹ä¼šè°ƒç”¨<code>wrapArgs</code>å°†å‡½æ•°è°ƒç”¨å‚æ•°åºåˆ—åŒ–ä¸ºMetaData:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapArgs</span> (<span class="params">args, visited = new Set(</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> valueToMeta = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ é˜²æ­¢å¾ªç¯å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (visited.has(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        type: <span class="string">'value'</span>,</span><br><span class="line">        value: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–ç±»å‹çš„å¤„ç†ï¼Œè¿™äº›ç±»å‹åŸºæœ¬éƒ½æ˜¯å€¼æ‹·è´</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        type: <span class="string">'function'</span>,</span><br><span class="line">        <span class="comment">// ğŸ”´ ç»™ä¸»è¿›ç¨‹ä¼ é€’callbackIdï¼Œå¹¶æ·»åŠ åˆ°å›è°ƒæ³¨å†Œè¡¨ä¸­</span></span><br><span class="line">        id: callbacksRegistry.add(value),</span><br><span class="line">        location: v8Util.getHiddenValue(value, <span class="string">'location'</span>),</span><br><span class="line">        length: value.length</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å›åˆ°ä¸»è¿›ç¨‹ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„<code>unwrapArgs</code>å‡½æ•°æ¥ååºåˆ—åŒ–å‡½æ•°å‚æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> unwrapArgs = <span class="function"><span class="keyword">function</span> (<span class="params">sender, frameId, contextId, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> metaToValue = <span class="function"><span class="keyword">function</span> (<span class="params">meta</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (meta.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'value'</span>:</span><br><span class="line">        <span class="keyword">return</span> meta.value</span><br><span class="line">      <span class="comment">// ... çœç•¥</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'function'</span>: &#123;</span><br><span class="line">        <span class="keyword">const</span> objectId = [contextId, meta.id]</span><br><span class="line">        <span class="comment">// å›è°ƒç¼“å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (rendererFunctions.has(objectId)) &#123;</span><br><span class="line">          <span class="keyword">return</span> rendererFunctions.get(objectId)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ”´ å°è£…å½±å­å‡½æ•°</span></span><br><span class="line">        <span class="keyword">const</span> callIntoRenderer = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">let</span> succeed = <span class="literal">false</span></span><br><span class="line">          <span class="keyword">if</span> (!sender.isDestroyed()) &#123;</span><br><span class="line">            <span class="comment">// ğŸ”´ è°ƒç”¨æ—¶ï¼Œé€šè¿‡IPCé€šçŸ¥æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">            <span class="comment">// å¿½ç•¥å›è°ƒè¿”å›å€¼</span></span><br><span class="line">            succeed = sender._sendToFrameInternal(frameId, <span class="string">'ELECTRON_RENDERER_CALLBACK'</span>, contextId, meta.id, valueToMeta(sender, contextId, args))</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!succeed) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰å‘é€æˆåŠŸåˆ™è¡¨æ˜æ¸²æŸ“è¿›ç¨‹çš„å›è°ƒå¯èƒ½è¢«é‡Šæ”¾äº†ï¼Œè¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">            <span class="comment">// è¿™ç§æƒ…å†µæ¯”è¾ƒå¸¸è§ï¼Œæ¯”å¦‚è¢«æ¸²æŸ“è¿›ç¨‹åˆ·æ–°äº†</span></span><br><span class="line">            removeRemoteListenersAndLogWarning(<span class="keyword">this</span>, callIntoRenderer)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v8Util.setHiddenValue(callIntoRenderer, <span class="string">'location'</span>, meta.location)</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(callIntoRenderer, <span class="string">'length'</span>, &#123; <span class="attr">value</span>: meta.length &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ”´ ç›‘å¬å›è°ƒå‡½æ•°åƒåœ¾å›æ”¶äº‹ä»¶</span></span><br><span class="line">        v8Util.setRemoteCallbackFreer(callIntoRenderer, contextId, meta.id, sender)</span><br><span class="line">        rendererFunctions.set(objectId, callIntoRenderer)</span><br><span class="line">        <span class="keyword">return</span> callIntoRenderer</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`Unknown type: <span class="subst">$&#123;meta.type&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> args.map(metaToValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“è¿›ç¨‹å“åº”å°±æ¯”è¾ƒç®€å•äº†ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">handleMessage(<span class="string">'ELECTRON_RENDERER_CALLBACK'</span>, (id, args) =&gt; &#123;</span><br><span class="line">  callbacksRegistry.apply(id, metaToValue(args))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>é‚£å›è°ƒä»€ä¹ˆæ—¶å€™é‡Šæ”¾å‘¢ï¼Ÿè¿™ä¸ªç›¸æ¯”æ¸²æŸ“è¿›ç¨‹çš„å¯¹è±¡å¼•ç”¨è¦ç®€å•å¾ˆå¤šï¼Œå› ä¸ºä¸»è¿›ç¨‹åªæœ‰ä¸€ä¸ªã€‚é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“, <code>setRemoteCallbackFreer</code>ä¼šç›‘å¬å½±å­å›è°ƒæ˜¯å¦è¢«åƒåœ¾å›æ”¶ï¼Œä¸€æ—¦è¢«åƒåœ¾å›æ”¶äº†åˆ™é€šçŸ¥æ¸²æŸ“è¿›ç¨‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">handleMessage(<span class="string">'ELECTRON_RENDERER_RELEASE_CALLBACK'</span>, (id) =&gt; &#123;</span><br><span class="line">  callbacksRegistry.remove(id)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ¥ä¸ªæµç¨‹å›¾:</p><p><img src="/images/electron-remote/callback.png" alt></p><p><br><br><br></p><h2 id="ä¸€äº›ç¼ºé™·"><a href="#ä¸€äº›ç¼ºé™·" class="headerlink" title="ä¸€äº›ç¼ºé™·"></a>ä¸€äº›ç¼ºé™·</h2><p>remoteæœºåˆ¶åªæ˜¯å¯¹è¿œç¨‹å¯¹è±¡çš„ä¸€ä¸ªâ€˜å½±åˆ†èº«â€™ï¼Œæ— æ³•ç™¾åˆ†ç™¾å’Œè¿œç¨‹å¯¹è±¡çš„è¡Œä¸ºä¿æŒä¸€è‡´ï¼Œä¸‹é¢æ˜¯ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç¼ºé™·:</p><ul><li>å½“æ¸²æŸ“è¿›ç¨‹è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•/å‡½æ•°æ—¶ï¼Œæ˜¯è¿›è¡ŒåŒæ­¥IPCé€šä¿¡çš„ã€‚æ¢è¨€ä¹‹ï¼ŒåŒæ­¥IPCè°ƒç”¨ä¼šé˜»å¡ç”¨æˆ·ä»£ç çš„æ‰§è¡Œï¼Œè€Œä¸”è·¨ç«¯çš„é€šä¿¡æ•ˆç‡æ— æ³•å’ŒåŸç”Ÿå‡½æ•°è°ƒç”¨ç›¸æ¯”ï¼Œæ‰€ä»¥é¢‘ç¹çš„IPCè°ƒç”¨ä¼šå½±å“ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ€§èƒ½.</li><li>ä¸»è¿›ç¨‹ä¼šä¿æŒå¼•ç”¨æ¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹è®¿é—®çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬å‡½æ•°çš„è¿”å›å€¼ã€‚åŒç†ï¼Œé¢‘ç¹çš„è¿œç¨‹å¯¹è±¡è¯·æ±‚ï¼Œå¯¹å†…å­˜çš„å ç”¨å’Œåƒåœ¾å›æ”¶é€ æˆä¸å°çš„å‹åŠ›</li><li>æ— æ³•å®Œå…¨æ¨¡æ‹ŸJavaScriptå¯¹è±¡çš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨remoteæ¨¡å—ä¸­å­˜åœ¨è¿™äº›é—®é¢˜:<ul><li>æ•°ç»„å±äºâ€™åŸºæœ¬å¯¹è±¡â€™ï¼Œå®ƒæ˜¯é€šè¿‡å€¼æ‹·è´ä¼ é€’ç»™å¯¹ç«¯çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä¸æ˜¯ä¸€ä¸ªâ€˜å¼•ç”¨å¯¹è±¡â€™ï¼Œåœ¨å¯¹ç«¯ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œæ— æ³•ååº”åˆ°åŸå§‹çš„æ•°ç»„.</li><li>å¯¹è±¡åœ¨ç¬¬ä¸€æ¬¡å¼•ç”¨æ—¶ï¼Œåªæœ‰å¯æšä¸¾çš„å±æ€§å¯ä»¥è¿œç¨‹è®¿é—®ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸€å¼€å§‹å¯¹è±¡çš„å¤–å½¢å°±ç¡®å®šä¸‹æ¥äº†ï¼Œå¦‚æœè¿œç¨‹å¯¹è±¡åŠ¨æ€æ‰©å±•äº†å±æ€§ï¼Œæ˜¯æ— æ³•è¢«è¿œç¨‹è®¿é—®åˆ°çš„</li><li>æ¸²æŸ“è¿›ç¨‹ä¼ é€’çš„å›è°ƒä¼šè¢«å¼‚æ­¥è°ƒç”¨ï¼Œè€Œä¸”ä¸»è¿›ç¨‹ä¼šå¿½ç•¥å®ƒçš„è¿”å›å€¼ã€‚å¼‚æ­¥è°ƒç”¨æ˜¯ä¸ºäº†é¿å…äº§ç”Ÿæ­»é”</li></ul></li><li>å¯¹è±¡æ³„éœ²ã€‚<ul><li>å¦‚æœè¿œç¨‹å¯¹è±¡åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ³„éœ²ï¼ˆä¾‹å¦‚å­˜å‚¨åœ¨æ˜ å°„ä¸­ï¼Œä½†ä»æœªé‡Šæ”¾ï¼‰ï¼Œåˆ™ä¸»è¿›ç¨‹ä¸­çš„ç›¸åº”å¯¹è±¡ä¹Ÿå°†è¢«æ³„æ¼ï¼Œæ‰€ä»¥æ‚¨åº”è¯¥éå¸¸å°å¿ƒï¼Œä¸è¦æ³„æ¼è¿œç¨‹å¯¹è±¡ã€‚</li><li>åœ¨ç»™ä¸»è¿›ç¨‹ä¼ é€’å›è°ƒæ—¶ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒï¼Œä¸»è¿›ç¨‹ä¼šä¿æŒå›è°ƒçš„å¼•ç”¨ï¼Œç›´åˆ°å®ƒè¢«é‡Šæ”¾ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨remoteæ¨¡å—è¿›è¡Œä¸€äº›â€˜äº‹ä»¶è®¢é˜…â€™æ—¶ï¼Œåˆ‡è®°è¦è§£é™¤äº‹ä»¶è®¢é˜….</li><li>è¿˜æœ‰ä¸€ç§åœºæ™¯ï¼Œä¸‹æ–‡ä¼šæåˆ°</li></ul></li></ul><p><br><br><br></p><h2 id="remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–"><a href="#remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–" class="headerlink" title="remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–"></a>remoteæ¨¡å—å®è·µå’Œä¼˜åŒ–</h2><p><img src="/images/electron-remote/gzb.png" alt></p><p>ä¸Šé¢æ˜¯æˆ‘å‚ä¸è¿‡çš„æŸä¸ªé¡¹ç›®çš„è½¯ä»¶æ¶æ„å›¾ï¼Œ<code>Hybrid</code>å±‚ä½¿ç”¨C/C++ç¼–å†™ï¼Œå°è£…äº†è·¨å¹³å°çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æ­¤ä¹‹ä¸Šæ¥æ„å»ºå„ä¸ªå¹³å°çš„è§†å›¾ã€‚å…¶ä¸­æ¡Œé¢ç«¯æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ElectronæŠ€æœ¯ã€‚</p><p>å¦‚ä¸Šå›¾ï¼ŒBridgeè¿›æ˜¯å¯¹Hybridçš„ä¸€å±‚Nodeæ¡¥æ¥å°è£…ã€‚ä¸€ä¸ªåº”ç”¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªBridgeå®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬çš„åšæ³•æ˜¯ä½¿ç”¨Electronçš„remoteæ¨¡å—ï¼Œè®©æ¸²æŸ“è¿›ç¨‹é€šè¿‡ä¸»è¿›ç¨‹é—´æ¥åœ°è®¿é—®Bridge.</p><p><br></p><p>é¡µé¢éœ€è¦ç›‘å¬Bridgeçš„ä¸€äº›äº‹ä»¶ï¼Œæœ€åˆæˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bridge.ts</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨remoteçš„ä¸€ä¸ªå¥½å¤„æ—¶ï¼Œå¯ä»¥é…åˆTypescriptå®ç°è¾ƒå¥½çš„ç±»å‹æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">const</span> bridge = electron.remote.require(<span class="string">'bridge'</span>) <span class="keyword">as</span> <span class="keyword">typeof</span> <span class="keyword">import</span>(<span class="string">'bridge'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> bridge</span><br></pre></td></tr></table></figure><p>ç›‘å¬Bridgeäº‹ä»¶:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> bridge <span class="keyword">from</span> <span class="string">'~/bridge'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Store <span class="keyword">extends</span> MobxStore &#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  pageReady() &#123;</span><br><span class="line">    <span class="keyword">this</span>.someEventDispose = bridge.addListener(<span class="string">'someEvent'</span>, <span class="keyword">this</span>.handleSomeEvent)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¡µé¢å…³é—­</span></span><br><span class="line">  pageWillClose() &#123;</span><br><span class="line">    <span class="keyword">this</span>.someEventDispose()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾å¦‚ä¸‹:</p><p><img src="/images/electron-remote/addListener.png" alt></p><p>è¿™ç§æ–¹å¼å­˜åœ¨å¾ˆå¤šé—®é¢˜:</p><ul><li><p>ä¸»è¿›ç¨‹éœ€è¦ä¸ºæ¯ä¸€ä¸ªaddListenerå›è°ƒéƒ½ç»´æŒä¸€ä¸ªå¼•ç”¨ã€‚ä¸Šé¢çš„ä»£ç ä¼šåœ¨é¡µé¢å…³é—­æ—¶é‡Šæ”¾è®¢é˜…ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è€ƒè™‘ç”¨æˆ·åˆ·æ–°é¡µé¢æˆ–è€…é¡µé¢å´©æºƒçš„åœºæ™¯ã€‚è¿™ä¼šå¯¼è‡´å›è°ƒåœ¨ä¸»è¿›ç¨‹æ³„éœ²ã€‚</p><p>ç„¶è€Œå°±ç®—Electronå¯ä»¥åœ¨è°ƒç”¨å›è°ƒæ—¶å‘ç°å›è°ƒåœ¨æ¸²æŸ“è¿›ç¨‹å·²ç»è¢«é‡Šæ”¾æ‰äº†ï¼Œä½†æ˜¯å¼€å‘è€…å´è·å–ä¸åˆ°è¿™äº›ä¿¡æ¯ï¼Œ Bridgeä¼šå§‹ç»ˆä¿æŒå¯¹å½±å­å›è°ƒçš„å¼•ç”¨.</p></li><li><p>å¦å¤–ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„æ˜¯è°ƒç”¨æ•ˆç‡çš„é—®é¢˜ã€‚å‡è®¾é¡µé¢ç›‘å¬äº†Næ¬¡Aäº‹ä»¶ï¼Œå½“Aäº‹ä»¶è§¦å‘æ—¶ï¼Œä¸»è¿›ç¨‹éœ€è¦ç»™è¿™ä¸ªé¡µé¢å‘é€Nä¸ªé€šçŸ¥ã€‚</p></li></ul><p><br></p><p>åæ¥æˆ‘ä»¬æŠ›å¼ƒäº†ä½¿ç”¨remoteè¿›è¡Œäº‹ä»¶è®¢é˜…è¿™ç§æ–¹å¼ï¼Œè®©ä¸»è¿›ç¨‹æ¥ç»´æŠ¤è¿™ç§è®¢é˜…å…³ç³», å¦‚ä¸‹å›¾:</p><p><img src="/images/electron-remote/addListener2.png" alt></p><p>æˆ‘ä»¬æ”¹è¿›äº†å¾ˆå¤šä¸œè¥¿ï¼š</p><p><strong>ä¸»è¿›ç¨‹ç°åœ¨åªç»´æŠ¤â€˜å“ªä¸ªé¡µé¢â€™è®¢é˜…äº†å“ªä¸ªäº‹ä»¶ï¼Œä»â€˜ç»‘å®šå›è°ƒâ€™è¿›åŒ–æˆä¸ºâ€˜ç»‘å®šé¡µé¢â€™</strong>ã€‚è¿™æ ·å¯ä»¥è§£å†³ä¸Šé¢è°ƒç”¨æ•ˆç‡å’Œå›è°ƒæ³„éœ²é—®é¢˜ã€æ¯”å¦‚ä¸ä¼šå› ä¸ºé¡µé¢åˆ·æ–°å¯¼è‡´å›è°ƒæ³„éœ², å¹¶ä¸”å½“äº‹ä»¶è§¦å‘æ—¶åªä¼šé€šçŸ¥ä¸€æ¬¡é¡µé¢ã€‚</p><p>å¦å¤–è¿™é‡Œå‚è€ƒäº†remoteæœ¬èº«çš„å®ç°ï¼Œåœ¨é¡µé¢é”€æ¯æ—¶ç§»é™¤è¯¥é¡µé¢çš„æ‰€æœ‰è®¢é˜…ã€‚ç›¸æ¯”æ¯”remoteé»‘ç›’ï¼Œæˆ‘ä»¬è‡ªå·±æ¥å®ç°è¿™ç§äº‹ä»¶è®¢é˜…å…³ç³»æ¯”ä¹‹å‰è¦æ›´å¥½è°ƒè¯•ã€‚</p><p><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>remoteæ¨¡å—å¯¹äºElectronå¼€å‘æœ‰å¾ˆé‡è¦çš„æ„ä¹‰ï¼Œæ¯•ç«Ÿå¾ˆå¤šæ¨¡å—åªæœ‰åœ¨ä¸»è¿›ç¨‹æ‰èƒ½è®¿é—®ï¼Œæ¯”å¦‚BrowserWindowã€dialog. </p><p>ç›¸æ¯”ipcé€šä¿¡ï¼Œremoteå®åœ¨æ–¹é¢å¾ˆå¤šã€‚é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬ä¹Ÿäº†è§£äº†å®ƒçš„åŸºæœ¬åŸç†å’Œç¼ºé™·ï¼Œæ‰€ä»¥remoteè™½å¥½ï¼Œåˆ‡å¿Œä¸è¦æ»¥ç”¨ã€‚</p><p>remoteçš„æºç ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå€¼å¾—å­¦ä¹ . æ¯•ç«Ÿå‰ç«¯ç›®å‰è·¨ç«¯é€šä¿¡éå¸¸å¸¸è§ï¼Œä¾‹å¦‚WebViewBridgeã€Worker. </p><p>remoteå¯ä»¥ç»™ä½ ä¸€äº›çµæ„Ÿï¼Œä½†æ˜¯è¦å®Œå…¨ç…§æ¬å®ƒæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ¯”å¦‚å®ƒä¾èµ–ä¸€äº›v8 â€˜Hackâ€™æ¥ç›‘å¬å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œæ™®é€šå¼€å‘åœºæ™¯æ˜¯åšä¸åˆ°çš„ã€‚</p><p>æœ¬æ–‡å®Œ.</p><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://electronjs.org/docs/api/remote" target="_blank" rel="noopener">Electron remote æ–‡æ¡£</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Electronçš„remoteæ¨¡å—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡çš„ä¸œè¥¿ï¼Œä¸º&lt;code&gt;æ¸²æŸ“è¿›ç¨‹&lt;/code&gt;å’Œ&lt;code&gt;ä¸»è¿›ç¨‹&lt;/code&gt;é€šä¿¡å°è£…äº†ä¸€ç§ç®€å•æ–¹æ³•ï¼Œé€šè¿‡remoteä½ å¯ä»¥â€™ç›´æ¥â€™è·å–ä¸»è¿›ç¨‹å¯¹è±¡æˆ–è€…è°ƒç”¨ä¸»è¿›ç¨‹å‡½æ•°æˆ–å¯¹è±¡çš„æ–¹æ³•, è€Œä¸å¿…æ˜¾å¼å‘é€è¿›ç¨‹é—´æ¶ˆæ¯, ç±»ä¼¼äº Java 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)</title>
    <link href="https://bobi.ink/2019/07/29/react-event/"/>
    <id>https://bobi.ink/2019/07/29/react-event/</id>
    <published>2019-07-28T16:00:00.000Z</published>
    <updated>2019-08-04T08:19:59.764Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/react-event/sample.png" alt></p><p>å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘. </p><p>å…·ä½“æ¥è®²ï¼ŒReactåˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶åœ¨Documentä¸Šç»Ÿä¸€ç›‘å¬DOMäº‹ä»¶ï¼Œå†æ ¹æ®è§¦å‘çš„targetå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹ã€‚å¦å¤–ä¸Šé¢eæ˜¯ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡(SyntheticEvent), è€Œä¸æ˜¯åŸå§‹çš„DOMäº‹ä»¶å¯¹è±¡.</p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ">é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</a></li><li><a href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a><ul><li><a href="#æ•´ä½“çš„æ¶æ„">æ•´ä½“çš„æ¶æ„</a></li><li><a href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§">äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</a></li></ul></li><li><a href="#å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</a><ul><li><a href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„">äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</a></li><li><a href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„">äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</a><ul><li><a href="#äº‹ä»¶è§¦å‘è°ƒåº¦">äº‹ä»¶è§¦å‘è°ƒåº¦</a></li><li><a href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶">æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</a></li><li><a href="#æ‰¹é‡æ‰§è¡Œ">æ‰¹é‡æ‰§è¡Œ</a></li></ul></li></ul></li><li><a href="#æœªæ¥">æœªæ¥</a><ul><li><a href="#åˆæ¢responderçš„åˆ›å»º">åˆæ¢Responderçš„åˆ›å»º</a></li><li><a href="#react-eventsæ„ä¹‰ä½•åœ¨">react-eventsæ„ä¹‰ä½•åœ¨?</a></li></ul></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><blockquote><p>æˆªæ­¢æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReactç‰ˆæœ¬æ˜¯16.8.6</p></blockquote><p><br></p><h2 id="é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ"><a href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ" class="headerlink" title="é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?"></a>é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</h2><p>å¦‚æœäº†è§£è¿‡Preact(ç¬”è€…ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« <a href="https://juejin.im/post/5cfa29e151882539c33e4f5e" target="_blank" rel="noopener">è§£æPreactçš„æºç </a>)ï¼ŒPreactè£å‰ªäº†å¾ˆå¤šReactçš„ä¸œè¥¿ï¼Œå…¶ä¸­åŒ…æ‹¬äº‹ä»¶æœºåˆ¶ï¼ŒPreactæ˜¯ç›´æ¥åœ¨DOMå…ƒç´ ä¸Šè¿›è¡Œäº‹ä»¶ç»‘å®šçš„ã€‚</p><p>åœ¨ç ”ç©¶ä¸€ä¸ªäº‹ç‰©ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆè¦é—®ä¸ºä»€ä¹ˆï¼Ÿäº†è§£å®ƒçš„åŠ¨æœºï¼Œæ‰æœ‰åˆ©äºä½ å¯¹å®ƒæœ‰æœ¬è´¨çš„è®¤è¯†ã€‚</p><p>Reactè‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿçš„åŠ¨æœºæœ‰ä»¥ä¸‹å‡ ä¸ª:</p><ul><li><p><strong>1. æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å…¼å®¹æ€§å·®å¼‚</strong>ã€‚ è¿™æ˜¯ä¼°è®¡æœ€åŸå§‹çš„åŠ¨æœºï¼ŒReactæ ¹æ®<a href="https://www.w3.org/TR/DOM-Level-3-Events/" target="_blank" rel="noopener">W3C è§„èŒƒ</a>æ¥å®šä¹‰è¿™äº›åˆæˆäº‹ä»¶(SyntheticEvent), æ„åœ¨æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>å¦å¤–Reactè¿˜ä¼šè¯•å›¾é€šè¿‡å…¶ä»–ç›¸å…³äº‹ä»¶æ¥æ¨¡æ‹Ÿä¸€äº›ä½ç‰ˆæœ¬ä¸å…¼å®¹çš„äº‹ä»¶, è¿™æ‰æ˜¯â€˜åˆæˆâ€™çš„æœ¬æ¥æ„æ€å§ï¼Ÿã€‚</p></li><li><p><strong>2. äº‹ä»¶â€˜åˆæˆâ€™, å³äº‹ä»¶è‡ªå®šä¹‰</strong>ã€‚äº‹ä»¶åˆæˆé™¤äº†å¤„ç†å…¼å®¹æ€§é—®é¢˜ï¼Œè¿˜å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰é«˜çº§äº‹ä»¶ï¼Œæ¯”è¾ƒå…¸å‹çš„æ˜¯Reactçš„onChangeäº‹ä»¶ï¼Œå®ƒä¸ºè¡¨å•å…ƒç´ å®šä¹‰äº†ç»Ÿä¸€çš„å€¼å˜åŠ¨äº‹ä»¶ã€‚å¦å¤–ç¬¬ä¸‰æ–¹ä¹Ÿå¯ä»¥é€šè¿‡Reactçš„äº‹ä»¶æ’ä»¶æœºåˆ¶æ¥åˆæˆè‡ªå®šä¹‰äº‹ä»¶ï¼Œå°½ç®¡å¾ˆå°‘äººè¿™ä¹ˆåšã€‚</p></li><li><p><strong>3. æŠ½è±¡è·¨å¹³å°äº‹ä»¶æœºåˆ¶</strong>ã€‚ å’ŒVirtualDOMçš„æ„ä¹‰å·®ä¸å¤šï¼ŒVirtualDOMæŠ½è±¡äº†è·¨å¹³å°çš„æ¸²æŸ“æ–¹å¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„SyntheticEventç›®çš„ä¹Ÿæ˜¯æƒ³æä¾›ä¸€ä¸ªæŠ½è±¡çš„è·¨å¹³å°äº‹ä»¶æœºåˆ¶ã€‚</p></li><li><p><strong>4. Reactæ‰“ç®—åšæ›´å¤šä¼˜åŒ–</strong>ã€‚æ¯”å¦‚åˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶ï¼Œå¤§éƒ¨åˆ†äº‹ä»¶æœ€ç»ˆç»‘å®šåˆ°äº†Documentï¼Œè€Œä¸æ˜¯DOMèŠ‚ç‚¹æœ¬èº«. è¿™æ ·ç®€åŒ–äº†DOMäº‹ä»¶å¤„ç†é€»è¾‘ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€. ä½†è¿™ä¹Ÿæ„å‘³ç€ï¼Œ<strong>Reactéœ€è¦è‡ªå·±æ¨¡æ‹Ÿä¸€å¥—äº‹ä»¶å†’æ³¡çš„æœºåˆ¶</strong>ã€‚</p></li><li><p><strong>5. Reactæ‰“ç®—å¹²é¢„äº‹ä»¶çš„åˆ†å‘</strong>ã€‚v16å¼•å…¥Fiberæ¶æ„ï¼ŒReactä¸ºäº†ä¼˜åŒ–ç”¨æˆ·çš„äº¤äº’ä½“éªŒï¼Œä¼šå¹²é¢„äº‹ä»¶çš„åˆ†å‘ã€‚ä¸åŒç±»å‹çš„äº‹ä»¶æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚é«˜ä¼˜å…ˆçº§çš„äº‹ä»¶å¯ä»¥ä¸­æ–­æ¸²æŸ“ï¼Œè®©ç”¨æˆ·ä»£ç å¯ä»¥åŠæ—¶å“åº”ç”¨æˆ·äº¤äº’ã€‚</p></li></ul><p><br></p><p>Ok, åé¢æˆ‘ä»¬ä¼šæ·±å…¥äº†è§£Reactçš„äº‹ä»¶å®ç°ï¼Œæˆ‘ä¼šå°½é‡ä¸è´´ä»£ç ï¼Œç”¨æµç¨‹å›¾è¯´è¯ã€‚</p><p><br></p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ•´ä½“çš„æ¶æ„"><a href="#æ•´ä½“çš„æ¶æ„" class="headerlink" title="æ•´ä½“çš„æ¶æ„"></a>æ•´ä½“çš„æ¶æ„</h3><p><img src="/images/react-event/st.png" alt></p><ul><li><strong>ReactEventListener</strong> - äº‹ä»¶å¤„ç†å™¨. åœ¨è¿™é‡Œè¿›è¡Œäº‹ä»¶å¤„ç†å™¨çš„ç»‘å®šã€‚å½“DOMè§¦å‘äº‹ä»¶æ—¶ï¼Œä¼šä»è¿™é‡Œå¼€å§‹è°ƒåº¦åˆ†å‘åˆ°Reactç»„ä»¶æ ‘</li><li><strong>ReactEventEmitter</strong> - æš´éœ²æ¥å£ç»™Reactç»„ä»¶å±‚ç”¨äºæ·»åŠ äº‹ä»¶è®¢é˜…</li><li><strong>EventPluginHub</strong> - å¦‚å…¶åï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜æ’ä»¶æ’æ§½â€™ï¼Œè´Ÿè´£ç®¡ç†å’Œæ³¨å†Œå„ç§æ’ä»¶ã€‚åœ¨äº‹ä»¶åˆ†å‘æ—¶ï¼Œè°ƒç”¨æ’ä»¶æ¥ç”Ÿæˆåˆæˆäº‹ä»¶</li><li><p><strong>Plugin</strong> - Reactäº‹ä»¶ç³»ç»Ÿä½¿ç”¨äº†æ’ä»¶æœºåˆ¶æ¥ç®¡ç†ä¸åŒè¡Œä¸ºçš„äº‹ä»¶ã€‚è¿™äº›æ’ä»¶ä¼šå¤„ç†è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ç”Ÿæˆåˆæˆäº‹ä»¶å¯¹è±¡ã€‚ç›®å‰ReactDOMæœ‰ä»¥ä¸‹å‡ ç§æ’ä»¶ç±»å‹:</p><ul><li><strong>SimpleEventPlugin</strong> - ç®€å•äº‹ä»¶, å¤„ç†ä¸€äº›æ¯”è¾ƒé€šç”¨çš„äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚clickã€inputã€keyDownã€mouseOverã€mouseOutã€pointerOverã€pointerOut</li><li><p><strong>EnterLeaveEventPlugin</strong> - mouseEnter/mouseLeaveå’ŒpointerEnter/pointerLeaveè¿™ä¸¤ç±»äº‹ä»¶æ¯”è¾ƒç‰¹æ®Š, å’Œ<code>*over/*leave</code>äº‹ä»¶ç›¸æ¯”, å®ƒä»¬ä¸æ”¯æŒäº‹ä»¶å†’æ³¡, <code>*enter</code>ä¼šç»™æ‰€æœ‰è¿›å…¥çš„å…ƒç´ å‘é€äº‹ä»¶, è¡Œä¸ºæœ‰ç‚¹ç±»ä¼¼äº<code>:hover</code>; è€Œ<code>*over</code>åœ¨è¿›å…¥å…ƒç´ åï¼Œè¿˜ä¼šå†’æ³¡é€šçŸ¥å…¶ä¸Šçº§. å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://codesandbox.io/s/enter-and-over-608cl" target="_blank" rel="noopener">å®ä¾‹</a>è§‚å¯Ÿenterå’Œoverçš„åŒºåˆ«.</p><p>å¦‚æœæ ‘å±‚æ¬¡æ¯”è¾ƒæ·±ï¼Œå¤§é‡çš„mouseenterè§¦å‘å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å¦å¤–å…¶ä¸æ”¯æŒå†’æ³¡ï¼Œæ— æ³•åœ¨Documentå®Œç¾çš„ç›‘å¬å’Œåˆ†å‘, æ‰€ä»¥ReactDOMä½¿ç”¨<code>*over/*out</code>äº‹ä»¶æ¥æ¨¡æ‹Ÿè¿™äº›<code>*enter/*leave</code>ã€‚</p></li><li><p><strong>ChangeEventPlugin</strong> - changeäº‹ä»¶æ˜¯Reactçš„ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ—¨åœ¨è§„èŒƒåŒ–è¡¨å•å…ƒç´ çš„å˜åŠ¨äº‹ä»¶ã€‚</p><p>å®ƒæ”¯æŒè¿™äº›è¡¨å•å…ƒç´ : input, textarea, select </p></li><li><p><strong>SelectEventPlugin</strong> - å’Œchangeäº‹ä»¶ä¸€æ ·ï¼ŒReactä¸ºè¡¨å•å…ƒç´ è§„èŒƒåŒ–äº†select(é€‰æ‹©èŒƒå›´å˜åŠ¨)äº‹ä»¶ï¼Œé€‚ç”¨äºinputã€textareaã€contentEditableå…ƒç´ .</p></li><li><strong>BeforeInputEventPlugin</strong> - beforeinputäº‹ä»¶ä»¥åŠ<a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/compositionstart" target="_blank" rel="noopener">composition</a>äº‹ä»¶å¤„ç†ã€‚</li></ul><p>æœ¬æ–‡ä¸»è¦ä¼šå…³æ³¨<code>SimpleEventPlugin</code>çš„å®ç°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±é˜…è¯»Reactçš„æºä»£ç .</p></li><li><p><strong>EventPropagators</strong> æŒ‰ç…§DOMäº‹ä»¶ä¼ æ’­çš„ä¸¤ä¸ªé˜¶æ®µï¼Œéå†Reactç»„ä»¶æ ‘ï¼Œå¹¶æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„äº‹ä»¶å¤„ç†å™¨.</p></li><li><strong>EventBatching</strong> è´Ÿè´£æ‰¹é‡æ‰§è¡Œäº‹ä»¶é˜Ÿåˆ—å’Œäº‹ä»¶å¤„ç†å™¨ï¼Œå¤„ç†äº‹ä»¶å†’æ³¡ã€‚</li><li><p><strong>SyntheticEvent</strong> è¿™æ˜¯â€˜åˆæˆâ€™äº‹ä»¶çš„åŸºç±»ï¼Œå¯ä»¥å¯¹åº”DOMçš„Eventå¯¹è±¡ã€‚åªä¸è¿‡Reactä¸ºäº†å‡ä½å†…å­˜æŸè€—å’Œåƒåœ¾å›æ”¶ï¼Œä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ± æ¥æ„å»ºå’Œé‡Šæ”¾äº‹ä»¶å¯¹è±¡ï¼Œ ä¹Ÿå°±æ˜¯è¯´SyntheticEventä¸èƒ½ç”¨äºå¼‚æ­¥å¼•ç”¨ï¼Œå®ƒåœ¨åŒæ­¥æ‰§è¡Œå®Œäº‹ä»¶å¤„ç†å™¨åå°±ä¼šè¢«é‡Šæ”¾ã€‚</p><p>SyntheticEventä¹Ÿæœ‰å­ç±»ï¼Œå’ŒDOMå…·ä½“äº‹ä»¶ç±»å‹ä¸€ä¸€åŒ¹é…:</p><ul><li>SyntheticAnimationEvent</li><li>SyntheticClipboardEvent</li><li>SyntheticCompositionEvent</li><li>SyntheticDragEvent</li><li>SyntheticFocusEvent</li><li>SyntheticInputEvent</li><li>SyntheticKeyboardEvent</li><li>SyntheticMouseEvent</li><li>SyntheticPointerEvent</li><li>SyntheticTouchEvent</li><li>â€¦.</li></ul></li></ul><p><br></p><h3 id="äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"><a href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§" class="headerlink" title="äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"></a>äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</h3><p>SimpleEventPluginå°†äº‹ä»¶ç±»å‹åˆ’åˆ†æˆäº†ä¸‰ç±», å¯¹åº”ä¸åŒçš„ä¼˜å…ˆçº§(<strong>ä¼˜å…ˆçº§ç”±ä½åˆ°é«˜</strong>):</p><ul><li><strong>DiscreteEvent</strong> ç¦»æ•£äº‹ä»¶. ä¾‹å¦‚blurã€focusã€ clickã€ submitã€ touchStart. è¿™äº›äº‹ä»¶éƒ½æ˜¯ç¦»æ•£è§¦å‘çš„</li><li><strong>UserBlockingEvent</strong> ç”¨æˆ·é˜»å¡äº‹ä»¶. ä¾‹å¦‚touchMoveã€mouseMoveã€scrollã€dragã€dragOverç­‰ç­‰ã€‚è¿™äº›äº‹ä»¶ä¼šâ€™é˜»å¡â€™ç”¨æˆ·çš„äº¤äº’ã€‚</li><li><strong>ContinuousEvent</strong> å¯è¿ç»­äº‹ä»¶ã€‚ä¾‹å¦‚loadã€errorã€loadStartã€abortã€animationEnd. è¿™ä¸ªä¼˜å…ˆçº§æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åº”è¯¥æ˜¯ç«‹å³åŒæ­¥æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯Continuousçš„æ„ä¹‰ï¼Œå³å¯è¿ç»­çš„æ‰§è¡Œï¼Œä¸è¢«æ‰“æ–­.</li></ul><p>å¯èƒ½è¦å…ˆäº†è§£ä¸€ä¸‹Reactè°ƒåº¦(Schedule)çš„ä¼˜å…ˆçº§ï¼Œæ‰èƒ½ç†è§£è¿™ä¸‰ç§äº‹ä»¶ç±»å‹çš„åŒºåˆ«ã€‚æˆªæ­¢åˆ°æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReactæœ‰5ä¸ªä¼˜å…ˆçº§çº§åˆ«:</p><ul><li><code>Immediate</code> - è¿™ä¸ªä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šåŒæ­¥æ‰§è¡Œ, æˆ–è€…è¯´è¦é©¬ä¸Šæ‰§è¡Œä¸”ä¸èƒ½ä¸­æ–­</li><li><code>UserBlocking</code>(250ms timeout) è¿™äº›ä»»åŠ¡ä¸€èˆ¬æ˜¯ç”¨æˆ·äº¤äº’çš„ç»“æœ, éœ€è¦å³æ—¶å¾—åˆ°åé¦ˆ .</li><li><code>Normal</code> (5s timeout) åº”å¯¹å“ªäº›ä¸éœ€è¦ç«‹å³æ„Ÿå—åˆ°çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚</li><li><code>Low</code> (10s timeout) è¿™äº›ä»»åŠ¡å¯ä»¥æ”¾åï¼Œä½†æ˜¯æœ€ç»ˆåº”è¯¥å¾—åˆ°æ‰§è¡Œ. ä¾‹å¦‚åˆ†æé€šçŸ¥</li><li><code>Idle</code> (no timeout) ä¸€äº›æ²¡æœ‰å¿…è¦åšçš„ä»»åŠ¡ (e.g. æ¯”å¦‚éšè—çš„å†…å®¹).</li></ul><p>ç›®å‰ContinuousEventå¯¹åº”çš„æ˜¯Immediateä¼˜å…ˆçº§; UserBlockingEventå¯¹åº”çš„æ˜¯UserBlocking(éœ€è¦æ‰‹åŠ¨å¼€å¯); è€ŒDiscreteEventå¯¹åº”çš„ä¹Ÿæ˜¯UserBlocking, åªä¸è¿‡å®ƒåœ¨æ‰§è¡Œä¹‹å‰ï¼Œå…ˆä¼šæ‰§è¡Œå®Œå…¶ä»–Discreteä»»åŠ¡ã€‚</p><p>æœ¬æ–‡ä¸ä¼šæ·±å…¥React Fiberæ¶æ„çš„ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»æ–‡æœ«çš„æ‰©å±•é˜…è¯»åˆ—è¡¨.</p><p><br><br><br></p><h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><p>ç°åœ¨å¼€å§‹è¿›å…¥æ–‡ç« æ­£é¢˜ï¼ŒReactæ˜¯æ€ä¹ˆå®ç°äº‹ä»¶æœºåˆ¶ï¼Ÿä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†: <strong>ç»‘å®š</strong>å’Œ<strong>åˆ†å‘</strong>.</p><h3 id="äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"><a href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ" class="headerlink" title="äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"></a>äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</h3><p>ä¸ºäº†é¿å…åé¢ç»•æ™•äº†ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹Reactäº‹ä»¶æœºåˆ¶ä¸­çš„æ’ä»¶åè®®ã€‚ æ¯ä¸ªæ’ä»¶çš„ç»“æ„å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> EventTypes = &#123;[key: <span class="built_in">string</span>]: DispatchConfig&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> PluginModule&lt;NativeEvent&gt; = &#123;</span><br><span class="line">  eventTypes: EventTypes,          <span class="comment">// å£°æ˜æ’ä»¶æ”¯æŒçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line">  extractEvents: (                 <span class="comment">// å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›åˆæˆäº‹ä»¶å¯¹è±¡</span></span><br><span class="line">    topLevelType: TopLevelType,</span><br><span class="line">    targetInst: <span class="literal">null</span> | Fiber,</span><br><span class="line">    nativeEvent: NativeEvent,</span><br><span class="line">    nativeEventTarget: EventTarget,</span><br><span class="line">  ) =&gt; ?ReactSyntheticEvent,</span><br><span class="line">  tapMoveThreshold?: <span class="built_in">number</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>eventTypes</strong>å£°æ˜è¯¥æ’ä»¶è´Ÿè´£çš„äº‹ä»¶ç±»å‹, å®ƒé€šè¿‡<code>DispatchConfig</code>æ¥æè¿°:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> DispatchConfig = &#123;</span><br><span class="line">  dependencies: <span class="built_in">Array</span>&lt;TopLevelType&gt;, <span class="comment">// ä¾èµ–çš„åŸç”Ÿäº‹ä»¶ï¼Œè¡¨ç¤ºå…³è”è¿™äº›äº‹ä»¶çš„è§¦å‘. â€˜ç®€å•äº‹ä»¶â€™ä¸€èˆ¬åªæœ‰ä¸€ä¸ªï¼Œå¤æ‚äº‹ä»¶å¦‚onChangeä¼šç›‘å¬å¤šä¸ª, å¦‚ä¸‹å›¾ğŸ‘‡</span></span><br><span class="line">  phasedRegistrationNames?: &#123;    <span class="comment">// ä¸¤é˜¶æ®µpropsäº‹ä»¶æ³¨å†Œåç§°, Reactä¼šæ ¹æ®è¿™äº›åç§°åœ¨ç»„ä»¶å®ä¾‹ä¸­æŸ¥æ‰¾å¯¹åº”çš„propsäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    bubbled: <span class="built_in">string</span>,             <span class="comment">// å†’æ³¡é˜¶æ®µ, å¦‚onClick</span></span><br><span class="line">    captured: <span class="built_in">string</span>,            <span class="comment">// æ•è·é˜¶æ®µï¼Œå¦‚onClickCapture</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registrationName?: <span class="built_in">string</span>      <span class="comment">// propsäº‹ä»¶æ³¨å†Œåç§°, æ¯”å¦‚onMouseEnterè¿™äº›ä¸æ”¯æŒå†’æ³¡çš„äº‹ä»¶ç±»å‹ï¼Œåªä¼šå®šä¹‰  registrationNameï¼Œä¸ä¼šå®šä¹‰phasedRegistrationNames</span></span><br><span class="line">  eventPriority: EventPriority,  <span class="comment">// äº‹ä»¶çš„ä¼˜å…ˆçº§ï¼Œä¸Šæ–‡å·²ç»ä»‹ç»è¿‡äº†</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹ä¸€ä¸‹å®ä¾‹:</p><p><img src="/images/react-event/dispatch-config.png" alt></p><p>ä¸Šé¢åˆ—ä¸¾äº†ä¸‰ä¸ªå…¸å‹çš„EventPluginï¼š</p><ul><li><p><strong>SimpleEventPlugin</strong> - ç®€å•äº‹ä»¶æœ€å¥½ç†è§£ï¼Œå®ƒä»¬çš„è¡Œä¸ºéƒ½æ¯”è¾ƒé€šç”¨ï¼Œæ²¡æœ‰ä»€ä¹ˆTrick, ä¾‹å¦‚ä¸æ”¯æŒäº‹ä»¶å†’æ³¡ã€ä¸æ”¯æŒåœ¨Documentä¸Šç»‘å®šç­‰ç­‰. å’ŒåŸç”ŸDOMäº‹ä»¶æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ¯”è¾ƒå¥½å¤„ç†.</p></li><li><p><strong>EnterLeaveEventPlugin</strong> - ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>mouseEnter</code>å’Œ<code>mouseLeave</code>ä¾èµ–çš„æ˜¯<code>mouseout</code>å’Œ<code>mouseover</code>äº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´<code>*Enter/*Leave</code>äº‹ä»¶åœ¨Reactä¸­æ˜¯é€šè¿‡<code>*Over/*Out</code>äº‹ä»¶æ¥æ¨¡æ‹Ÿçš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨documentä¸Šé¢è¿›è¡Œå§”æ‰˜ç›‘å¬ï¼Œè¿˜æœ‰é¿å…<code>*Enter/*Leave</code>ä¸€äº›å¥‡æ€ªè€Œä¸å®ç”¨çš„è¡Œä¸ºã€‚</p></li><li><p><strong>ChangeEventPlugin</strong> - onChangeæ˜¯Reactçš„ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¯ä»¥çœ‹å‡ºå®ƒä¾èµ–äº†å¤šç§åŸç”ŸDOMäº‹ä»¶ç±»å‹æ¥æ¨¡æ‹ŸonChangeäº‹ä»¶.</p></li></ul><p><br></p><p>å¦å¤–æ¯ä¸ªæ’ä»¶è¿˜ä¼šå®šä¹‰<code>extractEvents</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—äº‹ä»¶åç§°ã€åŸç”ŸDOMäº‹ä»¶å¯¹è±¡ã€äº‹ä»¶è§¦å‘çš„DOMå…ƒç´ ä»¥åŠReactç»„ä»¶å®ä¾‹, è¿”å›ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œå¦‚æœè¿”å›ç©ºåˆ™è¡¨ç¤ºä¸ä½œå¤„ç†. å…³äºextractEventsçš„ç»†èŠ‚ä¼šåœ¨ä¸‹ä¸€èŠ‚é˜è¿°.</p><p><br></p><p>åœ¨ReactDOMå¯åŠ¨æ—¶å°±ä¼šå‘<code>EventPluginHub</code>æ³¨å†Œè¿™äº›æ’ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">EventPluginHubInjection.injectEventPluginsByName(&#123;</span><br><span class="line">  SimpleEventPlugin: SimpleEventPlugin,</span><br><span class="line">  EnterLeaveEventPlugin: EnterLeaveEventPlugin,</span><br><span class="line">  ChangeEventPlugin: ChangeEventPlugin,</span><br><span class="line">  SelectEventPlugin: SelectEventPlugin,</span><br><span class="line">  BeforeInputEventPlugin: BeforeInputEventPlugin,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>Ok, å›åˆ°æ­£é¢˜ï¼Œäº‹ä»¶æ˜¯æ€ä¹ˆç»‘å®šçš„å‘¢ï¼Ÿ æ‰“ä¸ªæ–­ç‚¹çœ‹ä¸€ä¸‹è°ƒç”¨æ ˆ:</p><p><img src="/images/react-event/listento.png" alt></p><p>å‰é¢è°ƒç”¨æ ˆå…³äºReactæ ‘å¦‚ä½•æ›´æ–°å’Œæ¸²æŸ“å°±ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…äº†ï¼Œé€šè¿‡è°ƒç”¨æ ˆå¯ä»¥çœ‹å‡ºReactåœ¨propsåˆå§‹åŒ–å’Œæ›´æ–°æ—¶ä¼šè¿›è¡Œäº‹ä»¶ç»‘å®šã€‚è¿™é‡Œå…ˆçœ‹ä¸€ä¸‹æµç¨‹å›¾ï¼Œå¿½ç•¥æ‚ä¹±çš„è·³è½¬ï¼š</p><p><img src="/images/react-event/binding.png" alt></p><ul><li><strong>1. åœ¨propsåˆå§‹åŒ–å’Œæ›´æ–°æ—¶ä¼šè¿›è¡Œäº‹ä»¶ç»‘å®š</strong>ã€‚é¦–å…ˆReactä¼šåˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯<code>åª’ä½“ç±»å‹</code>ï¼Œ<strong>åª’ä½“ç±»å‹çš„äº‹ä»¶æ˜¯æ— æ³•åœ¨Documentç›‘å¬çš„ï¼Œæ‰€ä»¥ä¼šç›´æ¥åœ¨å…ƒç´ ä¸Šè¿›è¡Œç»‘å®š</strong></li><li><strong>2. åä¹‹å°±åœ¨Documentä¸Šç»‘å®š</strong>. è¿™é‡Œé¢éœ€è¦ä¸¤ä¸ªä¿¡æ¯ï¼Œä¸€ä¸ªå°±æ˜¯ä¸Šæ–‡æåˆ°çš„â€™äº‹ä»¶ä¾èµ–åˆ—è¡¨â€™, æ¯”å¦‚<code>onMouseEnter</code>ä¾èµ–<code>mouseover/mouseout</code>; ç¬¬äºŒä¸ªæ˜¯ReactBrowserEventEmitterç»´æŠ¤çš„â€™å·²è®¢é˜…äº‹ä»¶è¡¨â€™ã€‚<strong>äº‹ä»¶å¤„ç†å™¨åªéœ€åœ¨Documentè®¢é˜…ä¸€æ¬¡ï¼Œæ‰€ä»¥ç›¸æ¯”åœ¨æ¯ä¸ªå…ƒç´ ä¸Šè®¢é˜…äº‹ä»¶ä¼šèŠ‚çœå¾ˆå¤šèµ„æº</strong>.</li></ul><p>ä»£ç å¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">listenTo</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  registrationName: <span class="built_in">string</span>,           <span class="comment">// æ³¨å†Œåç§°ï¼Œå¦‚onClick</span></span></span></span><br><span class="line"><span class="function"><span class="params">  mountAt: Document | Element | Node, <span class="comment">// ç»„ä»¶æ ‘å®¹å™¨ï¼Œä¸€èˆ¬æ˜¯Document</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> listeningSet = getListeningSetForElement(mountAt);             <span class="comment">// å·²è®¢é˜…äº‹ä»¶è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> dependencies = registrationNameDependencies[registrationName]; <span class="comment">// äº‹ä»¶ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dependencies.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> dependency = dependencies[i];</span><br><span class="line">    <span class="keyword">if</span> (!listeningSet.has(dependency)) &#123;                               <span class="comment">// æœªè®¢é˜…</span></span><br><span class="line">      <span class="keyword">switch</span> (dependency) &#123;</span><br><span class="line">        <span class="comment">// ... ç‰¹æ®Šçš„äº‹ä»¶ç›‘å¬å¤„ç†</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">const</span> isMediaEvent = mediaEventTypes.indexOf(dependency) !== <span class="number">-1</span>;</span><br><span class="line">          <span class="keyword">if</span> (!isMediaEvent) &#123;</span><br><span class="line">            trapBubbledEvent(dependency, mountAt);                     <span class="comment">// è®¾ç½®äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      listeningSet.add(dependency);                                    <span class="comment">// æ›´æ–°å·²è®¢é˜…è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®äº‹ä»¶çš„â€™ä¼˜å…ˆçº§â€™å’Œâ€™æ•è·é˜¶æ®µâ€™(æ˜¯å¦æ˜¯capture)æ¥è®¾ç½®äº‹ä»¶å¤„ç†å™¨</strong>:</li></ul><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trapEventForPluginEventSystem</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  element: Document | Element | Node,   <span class="comment">// ç»‘å®šåˆ°å…ƒç´ ï¼Œä¸€èˆ¬æ˜¯Document</span></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType: DOMTopLevelEventType,   <span class="comment">// äº‹ä»¶åç§°</span></span></span></span><br><span class="line"><span class="function"><span class="params">  capture: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> listener;</span><br><span class="line">  <span class="keyword">switch</span> (getEventPriority(topLevelType)) &#123;</span><br><span class="line">    <span class="comment">// ä¸åŒä¼˜å…ˆçº§çš„äº‹ä»¶ç±»å‹ï¼Œæœ‰ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œåˆ†å‘, ä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»</span></span><br><span class="line">    <span class="keyword">case</span> DiscreteEvent:                      <span class="comment">// âš›ï¸ç¦»æ•£äº‹ä»¶</span></span><br><span class="line">      listener = dispatchDiscreteEvent.bind(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        topLevelType,</span><br><span class="line">        PLUGIN_EVENT_SYSTEM,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> UserBlockingEvent:                 <span class="comment">// âš›ï¸ç”¨æˆ·é˜»å¡äº‹ä»¶</span></span><br><span class="line">      listener = dispatchUserBlockingUpdate.bind(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        topLevelType,</span><br><span class="line">        PLUGIN_EVENT_SYSTEM,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ContinuousEvent:                   <span class="comment">// âš›ï¸å¯è¿ç»­äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      listener = dispatchEvent.bind(<span class="literal">null</span>, topLevelType, PLUGIN_EVENT_SYSTEM);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> rawEventName = getRawEventName(topLevelType);</span><br><span class="line">  <span class="keyword">if</span> (capture) &#123;                            <span class="comment">// ç»‘å®šäº‹ä»¶å¤„ç†å™¨åˆ°å…ƒç´ </span></span><br><span class="line">    addEventCaptureListener(element, rawEventName, listener);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    addEventBubbleListener(element, rawEventName, listener);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹ä»¶ç»‘å®šçš„è¿‡ç¨‹è¿˜æ¯”è¾ƒç®€å•, æ¥ä¸‹æ¥çœ‹çœ‹äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ã€‚</p><p><br></p><h3 id="äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"><a href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ" class="headerlink" title="äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"></a>äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</h3><p>æŒ‰æƒ¯ä¾‹è¿˜æ˜¯å…ˆä¸Šæµç¨‹å›¾:</p><p><img src="/images/react-event/binding.png" alt></p><h4 id="äº‹ä»¶è§¦å‘è°ƒåº¦"><a href="#äº‹ä»¶è§¦å‘è°ƒåº¦" class="headerlink" title="äº‹ä»¶è§¦å‘è°ƒåº¦"></a>äº‹ä»¶è§¦å‘è°ƒåº¦</h4><p>é€šè¿‡ä¸Šé¢çš„<code>trapEventForPluginEventSystem</code>å‡½æ•°å¯ä»¥çŸ¥é“ï¼Œä¸åŒçš„äº‹ä»¶ç±»å‹æœ‰ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨, å®ƒä»¬çš„åŒºåˆ«æ˜¯è°ƒåº¦çš„ä¼˜å…ˆçº§ä¸ä¸€æ ·:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¦»æ•£äº‹ä»¶</span></span><br><span class="line"><span class="comment">// discrentUpdates åœ¨UserBlockingä¼˜å…ˆçº§ä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchDiscreteEvent</span>(<span class="params">topLevelType, eventSystemFlags, nativeEvent</span>) </span>&#123;</span><br><span class="line">  flushDiscreteUpdatesIfNeeded(nativeEvent.timeStamp);</span><br><span class="line">  discreteUpdates(dispatchEvent, topLevelType, eventSystemFlags, nativeEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜»å¡äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchUserBlockingUpdate</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">  eventSystemFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEvent,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå¼€å¯äº†enableUserBlockingEvents, åˆ™åœ¨UserBlockingä¼˜å…ˆçº§ä¸­è°ƒåº¦ï¼Œ</span></span><br><span class="line">  <span class="comment">// å¼€å¯enableUserBlockingEventså¯ä»¥é˜²æ­¢é¥¥é¥¿é—®é¢˜ï¼Œå› ä¸ºé˜»å¡äº‹ä»¶ä¸­æœ‰scrollã€mouseMoveè¿™ç±»é¢‘ç¹è§¦å‘çš„äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// å¦åˆ™åŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (enableUserBlockingEvents) &#123;</span><br><span class="line">    runWithPriority(</span><br><span class="line">      UserBlockingPriority,</span><br><span class="line">      dispatchEvent.bind(<span class="literal">null</span>, topLevelType, eventSystemFlags, nativeEvent),</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    dispatchEvent(topLevelType, eventSystemFlags, nativeEvent);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯è¿ç»­äº‹ä»¶åˆ™ç›´æ¥åŒæ­¥è°ƒç”¨dispatchEvent</span></span><br></pre></td></tr></table></figure><p><br></p><p>æœ€ç»ˆä¸åŒçš„äº‹ä»¶ç±»å‹éƒ½ä¼šè°ƒç”¨<code>dispatchEvent</code>å‡½æ•°. <code>dispatchEvent</code>ä¸­ä¼šä»DOMåŸç”Ÿäº‹ä»¶å¯¹è±¡è·å–äº‹ä»¶è§¦å‘çš„targetï¼Œå†æ ¹æ®è¿™ä¸ªtargetè·å–å…³è”çš„ReactèŠ‚ç‚¹å®ä¾‹.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">dispatchEvent</span>(<span class="params">topLevelType: DOMTopLevelEventType, eventSystemFlags: EventSystemFlags, nativeEvent: AnyNativeEvent</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–äº‹ä»¶è§¦å‘çš„ç›®æ ‡DOM</span></span><br><span class="line">  <span class="keyword">const</span> nativeEventTarget = getEventTarget(nativeEvent);</span><br><span class="line">  <span class="comment">// è·å–ç¦»è¯¥DOMæœ€è¿‘çš„ç»„ä»¶å®ä¾‹(åªèƒ½æ˜¯DOMå…ƒç´ ç»„ä»¶)</span></span><br><span class="line">  <span class="keyword">let</span> targetInst = getClosestInstanceFromNode(nativeEventTarget);</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  dispatchEventForPluginEventSystem(topLevelType, eventSystemFlags, nativeEvent, targetInst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æ¥ç€(ä¸­é—´è¿˜æœ‰ä¸€äº›æ­¥éª¤ï¼Œè¿™é‡Œå¿½ç•¥)ä¼šè°ƒç”¨<code>EventPluginHub</code>çš„<code>runExtractedPluginEventsInBatch</code>ï¼Œè¿™ä¸ªæ–¹æ³•éå†æ’ä»¶åˆ—è¡¨æ¥å¤„ç†äº‹ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªSyntheticEventåˆ—è¡¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runExtractedPluginEventsInBatch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType: TopLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">  targetInst: <span class="literal">null</span> | Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEvent: AnyNativeEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEventTarget: EventTarget,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// éå†æ’ä»¶åˆ—è¡¨, è°ƒç”¨æ’ä»¶çš„extractEventsï¼Œç”ŸæˆSyntheticEventåˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> events = extractPluginEvents(</span><br><span class="line">    topLevelType,</span><br><span class="line">    targetInst,</span><br><span class="line">    nativeEvent,</span><br><span class="line">    nativeEventTarget,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œ, è§åæ–‡æ‰¹é‡æ‰§è¡Œ</span></span><br><span class="line">  runEventsInBatch(events);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h4 id="æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶"><a href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶" class="headerlink" title="æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?"></a>æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</h4><p>ç°åœ¨æ¥çœ‹çœ‹æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶çš„ï¼Œæˆ‘ä»¬ä»¥<code>SimpleEventPlugin</code>ä¸ºä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SimpleEventPlugin: PluginModule&lt;MouseEvent&gt; &amp; &#123;</span><br><span class="line">  getEventPriority: <span class="function">(<span class="params">topLevelType: TopLevelType</span>) =&gt;</span> EventPriority,</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  eventTypes: eventTypes,</span><br><span class="line">  <span class="comment">// æŠ½å–äº‹ä»¶å¯¹è±¡</span></span><br><span class="line">  extractEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    topLevelType: TopLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">    targetInst: null | Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">    nativeEvent: MouseEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">    nativeEventTarget: EventTarget,</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">null</span> | <span class="title">ReactSyntheticEvent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// äº‹ä»¶é…ç½®</span></span><br><span class="line">    <span class="keyword">const</span> dispatchConfig = topLevelEventsToDispatchConfig[topLevelType];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1ï¸âƒ£ æ ¹æ®äº‹ä»¶ç±»å‹è·å–SyntheticEventå­ç±»äº‹ä»¶æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">let</span> EventConstructor;</span><br><span class="line">    <span class="keyword">switch</span> (topLevelType) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_KEY_DOWN:</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_KEY_UP:</span><br><span class="line">        EventConstructor = SyntheticKeyboardEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_BLUR:</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_FOCUS:</span><br><span class="line">        EventConstructor = SyntheticFocusEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// ... çœç•¥</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_GOT_POINTER_CAPTURE:</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_POINTER_UP:</span><br><span class="line">        EventConstructor = SyntheticPointerEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        EventConstructor = SyntheticEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ï¸âƒ£ æ„é€ äº‹ä»¶å¯¹è±¡, ä»å¯¹è±¡æ± ä¸­è·å–</span></span><br><span class="line">    <span class="keyword">const</span> event = EventConstructor.getPooled(</span><br><span class="line">      dispatchConfig,</span><br><span class="line">      targetInst,</span><br><span class="line">      nativeEvent,</span><br><span class="line">      nativeEventTarget,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3ï¸âƒ£ æ ¹æ®DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºè·å–ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    accumulateTwoPhaseDispatches(event);</span><br><span class="line">    <span class="keyword">return</span> event;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>SimpleEventPlugin</code>çš„<code>extractEvents</code>ä¸»è¦åšä»¥ä¸‹ä¸‰ä¸ªäº‹æƒ…:</p><ul><li>1ï¸âƒ£ æ ¹æ®äº‹ä»¶çš„ç±»å‹ç¡®å®šSyntheticEventæ„é€ å™¨</li><li>2ï¸âƒ£ æ„é€ SyntheticEventå¯¹è±¡ã€‚</li><li>3ï¸âƒ£ æ ¹æ®DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºè·å–ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨åˆ—è¡¨</li></ul><p><br></p><p><strong>ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºå’Œé‡Šæ”¾äº‹ä»¶å¯¹è±¡å¯¼è‡´æ€§èƒ½æŸè€—(å¯¹è±¡åˆ›å»ºå’Œåƒåœ¾å›æ”¶)ï¼ŒReactä½¿ç”¨ä¸€ä¸ªäº‹ä»¶æ± æ¥è´Ÿè´£ç®¡ç†äº‹ä»¶å¯¹è±¡ï¼Œä½¿ç”¨å®Œçš„äº‹ä»¶å¯¹è±¡ä¼šæ”¾å›æ± ä¸­ï¼Œä»¥å¤‡åç»­çš„å¤ç”¨</strong>ã€‚</p><p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œ<strong>åœ¨äº‹ä»¶å¤„ç†å™¨åŒæ­¥æ‰§è¡Œå®Œåï¼ŒSyntheticEventå¯¹è±¡å°±ä¼šé©¬ä¸Šè¢«å›æ”¶</strong>ï¼Œæ‰€æœ‰å±æ€§éƒ½ä¼šæ— æ•ˆã€‚æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šåœ¨å¼‚æ­¥æ“ä½œä¸­è®¿é—®SyntheticEventäº‹ä»¶å¯¹è±¡ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥ä¿æŒäº‹ä»¶å¯¹è±¡çš„å¼•ç”¨ï¼š</p><ul><li>è°ƒç”¨<code>SyntheticEvent#persist()</code>æ–¹æ³•ï¼Œå‘Šè¯‰Reactä¸è¦å›æ”¶åˆ°å¯¹è±¡æ± </li><li>ç›´æ¥å¼•ç”¨<code>SyntheticEvent#nativeEvent</code>, nativeEventæ˜¯å¯ä»¥æŒä¹…å¼•ç”¨çš„ï¼Œä¸è¿‡ä¸ºäº†ä¸æ‰“ç ´æŠ½è±¡ï¼Œå»ºè®®ä¸è¦ç›´æ¥å¼•ç”¨nativeEvent</li></ul><p><br></p><p>æ„å»ºå®ŒSyntheticEventå¯¹è±¡åï¼Œå°±éœ€è¦<strong>éå†ç»„ä»¶æ ‘æ¥è·å–è®¢é˜…è¯¥äº‹ä»¶çš„ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</strong>äº†:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accumulateTwoPhaseDispatchesSingle</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä»¥_targetInstä¸ºåŸºç‚¹, æŒ‰ç…§DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºéå†ç»„ä»¶æ ‘</span></span><br><span class="line">  traverseTwoPhase(event._targetInst, accumulateDirectionalDispatches, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå†æ–¹æ³•å…¶å®å¾ˆç®€å•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">traverseTwoPhase</span>(<span class="params">inst, fn, arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> path = [];</span><br><span class="line">  <span class="keyword">while</span> (inst) &#123;           <span class="comment">// ä»instå¼€å§‹ï¼Œå‘ä¸Šçº§å›æº¯</span></span><br><span class="line">    path.push(inst);</span><br><span class="line">    inst = getParent(inst);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> i;</span><br><span class="line">  <span class="comment">// æ•è·é˜¶æ®µï¼Œå…ˆä»æœ€é¡¶å±‚çš„çˆ¶ç»„ä»¶å¼€å§‹, å‘ä¸‹çº§ä¼ æ’­</span></span><br><span class="line">  <span class="keyword">for</span> (i = path.length; i-- &gt; <span class="number">0</span>; ) &#123;</span><br><span class="line">    fn(path[i], <span class="string">'captured'</span>, arg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†’æ³¡é˜¶æ®µï¼Œä»instï¼Œå³äº‹ä»¶è§¦å‘ç‚¹å¼€å§‹, å‘ä¸Šçº§ä¼ æ’­</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; path.length; i++) &#123;</span><br><span class="line">    fn(path[i], <span class="string">'bubbled'</span>, arg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>accumulateDirectionalDispatches</code>å‡½æ•°åˆ™æ˜¯ç®€å•æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accumulateDirectionalDispatches</span>(<span class="params">inst, phase, event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">  <span class="keyword">const</span> listener = listenerAtPhase(inst, event, phase);</span><br><span class="line">  <span class="comment">// æ‰€æœ‰å¤„ç†å™¨éƒ½æ”¾å…¥åˆ°_dispatchListenersé˜Ÿåˆ—ä¸­ï¼Œåç»­æ‰¹é‡æ‰§è¡Œè¿™ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">  <span class="keyword">if</span> (listener) &#123;</span><br><span class="line">    event._dispatchListeners = accumulateInto(</span><br><span class="line">      event._dispatchListeners,</span><br><span class="line">      listener,</span><br><span class="line">    );</span><br><span class="line">    event._dispatchInstances = accumulateInto(event._dispatchInstances, inst);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä¾‹å¦‚ä¸‹é¢çš„ç»„ä»¶æ ‘, éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/images/react-event/event-delivery.png" alt></p><p>æœ€ç»ˆè®¡ç®—å‡ºæ¥çš„<code>_dispatchListeners</code>é˜Ÿåˆ—æ˜¯è¿™æ ·çš„ï¼š<code>[handleB, handleC, handleA]</code></p><p><br></p><h4 id="æ‰¹é‡æ‰§è¡Œ"><a href="#æ‰¹é‡æ‰§è¡Œ" class="headerlink" title="æ‰¹é‡æ‰§è¡Œ"></a>æ‰¹é‡æ‰§è¡Œ</h4><p>éå†æ‰§è¡Œæ’ä»¶åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªSyntheticEventåˆ—è¡¨ï¼Œ<code>runEventsInBatch</code>å°±æ˜¯æ‰¹é‡æ‰§è¡Œè¿™äº›äº‹ä»¶ä¸­çš„<code>_dispatchListeners</code>äº‹ä»¶é˜Ÿåˆ—</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runEventsInBatch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  events: Array&lt;ReactSyntheticEvent&gt; | ReactSyntheticEvent | null,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  forEachAccumulated(processingEventQueue, executeDispatchesAndRelease);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> executeDispatchesAndRelease = <span class="function"><span class="keyword">function</span>(<span class="params">event: ReactSyntheticEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event) &#123;</span><br><span class="line">    <span class="comment">// æŒ‰é¡ºåºæ‰§è¡Œ_dispatchListeners</span></span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    executeDispatchesInOrder(event);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è°ƒç”¨persist()æ–¹æ³•åˆ™ç›´æ¥å›æ”¶</span></span><br><span class="line">    <span class="keyword">if</span> (!event.isPersistent()) &#123;</span><br><span class="line">      event.constructor.release(event);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">executeDispatchesInOrder</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// éå†dispatchListeners</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dispatchListeners.length; i++) &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡è°ƒç”¨ stopPropagation æ–¹æ³•å¯ä»¥ç¦æ­¢æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (event.isPropagationStopped()) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    executeDispatch(event, dispatchListeners[i], dispatchInstances[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/react-event/dispatch.png" alt></p><p>OK, åˆ°è¿™é‡ŒReactçš„äº‹ä»¶æœºåˆ¶å°±åŸºæœ¬ä»‹ç»å®Œäº†ï¼Œè¿™é‡Œåªæ˜¯ç®€å•äº†ä»‹ç»äº†ä¸€ä¸‹<code>SimpleEventPlugin</code>, å®é™…ä»£ç ä¸­è¿˜æœ‰å¾ˆå¤šäº‹ä»¶å¤„ç†çš„ç»†èŠ‚ï¼Œé™äºç¯‡å¹…ï¼Œæœ¬æ–‡å°±ä¸å±•å¼€å»è®²äº†ã€‚æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥äº²è‡ªå»è§‚æ‘©Reactçš„æºä»£ç .</p><p><br><br><br></p><h2 id="æœªæ¥"><a href="#æœªæ¥" class="headerlink" title="æœªæ¥"></a>æœªæ¥</h2><p>Reactå†…éƒ¨æœ‰ä¸€ä¸ªå®éªŒæ€§çš„äº‹ä»¶APIï¼ŒReactå†…éƒ¨ç§°ä¸º<code>React Flare</code>ã€æ­£å¼åç§°æ˜¯<a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener"><code>react-events</code></a>, <strong>é€šè¿‡è¿™ä¸ªAPIå¯ä»¥å®ç°è·¨å¹³å°ã€è·¨è®¾å¤‡çš„é«˜çº§äº‹ä»¶å°è£…</strong>.</p><p>react-eventså®šä¹‰äº†ä¸€ä¸ª<strong>äº‹ä»¶å“åº”å™¨(Event Responders)</strong>çš„æ¦‚å¿µï¼Œè¿™ä¸ªäº‹ä»¶å“åº”å™¨å¯ä»¥æ•è·å­ç»„ä»¶æ ‘æˆ–åº”ç”¨æ ¹èŠ‚ç‚¹çš„äº‹ä»¶ï¼Œç„¶åè½¬æ¢ä¸ºè‡ªå®šä¹‰äº‹ä»¶.</p><p>æ¯”è¾ƒå…¸å‹çš„é«˜çº§äº‹ä»¶æ˜¯pressã€longPressã€swipeè¿™äº›æ‰‹åŠ¿ã€‚é€šå¸¸æˆ‘ä»¬éœ€è¦è‡ªå·±æˆ–è€…åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å®ç°è¿™ä¸€å¥—æ‰‹åŠ¿è¯†åˆ«, ä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Gesture <span class="keyword">from</span> <span class="string">'rc-gesture'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Gesture</span><br><span class="line">    onTap=&#123;handleTap&#125;</span><br><span class="line">    onSwipe=&#123;onSwipe&#125;</span><br><span class="line">    onPinch=&#123;handlePinch&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;container&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Gesture&gt;,</span><br><span class="line">container);</span><br></pre></td></tr></table></figure><p><br></p><p>é‚£ä¹ˆreact-eventsçš„ç›®çš„å°±æ˜¯<strong>æä¾›ä¸€å¥—é€šç”¨çš„äº‹ä»¶æœºåˆ¶ç»™å¼€å‘è€…æ¥å®ç°â€™é«˜çº§äº‹ä»¶â€™çš„å°è£…, ç”šè‡³å®ç°äº‹ä»¶çš„è·¨å¹³å°ã€è·¨è®¾å¤‡</strong>, ç°åœ¨ä½ å¯ä»¥é€šè¿‡react-eventsæ¥å°è£…è¿™äº›æ‰‹åŠ¿äº‹ä»¶.</p><p>react-eventsé™¤äº†æ ¸å¿ƒçš„<code>Responder</code>æ¥å£ï¼Œè¿˜å°è£…äº†ä¸€äº›å†…ç½®æ¨¡å—, å®ç°è·¨å¹³å°çš„ã€å¸¸ç”¨çš„é«˜çº§äº‹ä»¶å°è£…ï¼š</p><ul><li>Focus module</li><li>Hover module</li><li>Press module</li><li>FocusScope module</li><li>Input module</li><li>KeyBoard module</li><li>Drag module</li><li>Pan module</li><li>Scroll module</li><li>Swipe module</li></ul><p>ä¸¾<code>Press</code>æ¨¡å—ä½œä¸ºä¾‹å­, <a href="https://github.com/facebook/react/blob/master/packages/react-events/docs/Press.md" target="_blank" rel="noopener">Pressæ¨¡å—</a>ä¼šå“åº”å®ƒåŒ…è£¹çš„å…ƒç´ çš„pressäº‹ä»¶ã€‚pressäº‹ä»¶åŒ…æ‹¬onContextMenuã€onLongPressã€onPressã€onPressEndã€onPressMoveã€onPressStartç­‰ç­‰. å…¶åº•å±‚é€šè¿‡mouseã€penã€touchã€trackpadç­‰äº‹ä»¶æ¥è½¬æ¢.</p><p>çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PressResponder, usePressListener &#125; <span class="keyword">from</span> <span class="string">'react-events/press'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  <span class="keyword">const</span> listener = usePressListener(&#123;  <span class="comment">// âš›ï¸é€šè¿‡hooksåˆ›å»ºResponder</span></span><br><span class="line">    onPressStart,</span><br><span class="line">    onPress,</span><br><span class="line">    onPressEnd,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div listeners=&#123;listener&#125;&gt;</span><br><span class="line">      &#123;subtrees&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br></p><p>react-eventsçš„è¿ä½œæµç¨‹å›¾å¦‚ä¸‹, <strong>äº‹ä»¶å“åº”å™¨(Event Responders)ä¼šæŒ‚è½½åˆ°hostèŠ‚ç‚¹ï¼Œå®ƒä¼šåœ¨hostèŠ‚ç‚¹ç›‘å¬hostæˆ–å­èŠ‚ç‚¹åˆ†å‘çš„åŸç”Ÿäº‹ä»¶(DOMæˆ–React Native), å¹¶å°†å®ƒä»¬è½¬æ¢/åˆå¹¶æˆé«˜çº§çš„äº‹ä»¶</strong>:</p><p><img src="/images/react-event/responder.png" alt></p><p><br></p><blockquote><p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªCodesanboxç©ä¸€ä¸‹<code>react-events</code>: <a href="https://codesandbox.io/s/github/ivan-94/react-events-playground" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit react-events-playground"></a></p></blockquote><p><br></p><h3 id="åˆæ¢responderçš„åˆ›å»º"><a href="#åˆæ¢responderçš„åˆ›å»º" class="headerlink" title="åˆæ¢Responderçš„åˆ›å»º"></a>åˆæ¢Responderçš„åˆ›å»º</h3><p>æˆ‘ä»¬æŒ‘ä¸€ä¸ªç®€å•çš„æ¨¡å—æ¥äº†è§£ä¸€äº›react-eventsçš„æ ¸å¿ƒAPI, ç›®å‰æœ€ç®€å•çš„æ˜¯Keyboardæ¨¡å—. Keyboardæ¨¡å—çš„ç›®çš„å°±æ˜¯è§„èŒƒåŒ–keydownå’Œkeyupäº‹ä»¶å¯¹è±¡çš„keyå±æ€§(éƒ¨åˆ†æµè§ˆå™¨keyå±æ€§çš„è¡Œä¸ºä¸ä¸€æ ·)ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰Responderçš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> keyboardResponderImpl = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1ï¸âƒ£å®šä¹‰Responderéœ€è¦ç›‘å¬çš„å­æ ‘çš„DOMäº‹ä»¶ï¼Œå¯¹äºKeyboardæ¥è¯´æ˜¯['keydown', 'keyup';]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  targetEventTypes,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 2ï¸âƒ£ç›‘å¬å­æ ‘è§¦å‘çš„äº‹ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onEvent(</span><br><span class="line">    event: ReactDOMResponderEvent,     <span class="comment">// åŒ…å«äº†å½“å‰è§¦å‘äº‹ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚åŸç”Ÿäº‹ä»¶å¯¹è±¡ï¼Œäº‹ä»¶è§¦å‘çš„èŠ‚ç‚¹ï¼Œäº‹ä»¶ç±»å‹ç­‰ç­‰</span></span><br><span class="line">    context: ReactDOMResponderContext, <span class="comment">// Responderçš„ä¸Šä¸‹æ–‡ï¼Œç»™Responderæä¾›äº†ä¸€äº›æ–¹æ³•æ¥é©±åŠ¨äº‹ä»¶åˆ†å‘</span></span><br><span class="line">    props: KeyboardResponderProps,     <span class="comment">// ä¼ é€’ç»™Responderçš„props</span></span><br><span class="line">  ): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;responderTarget, type&#125; = event;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.disabled) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">'keydown'</span>) &#123;</span><br><span class="line">      dispatchKeyboardEvent(</span><br><span class="line">        <span class="string">'onKeyDown'</span>,</span><br><span class="line">        event,</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">'keydown'</span>,</span><br><span class="line">        ((responderTarget: any): Element | Document),</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'keyup'</span>) &#123;</span><br><span class="line">      dispatchKeyboardEvent(</span><br><span class="line">        <span class="string">'onKeyUp'</span>,</span><br><span class="line">        event,</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">'keyup'</span>,</span><br><span class="line">        ((responderTarget: any): Element | Document),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹dispatchKeyboardEvent:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchKeyboardEvent</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  eventPropName: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  event: ReactDOMResponderEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">  context: ReactDOMResponderContext,</span></span></span><br><span class="line"><span class="function"><span class="params">  type: KeyboardEventType,</span></span></span><br><span class="line"><span class="function"><span class="params">  target: Element | Document,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šè§„èŒƒåŒ–äº‹ä»¶çš„keyå±æ€§</span></span><br><span class="line">  <span class="keyword">const</span> syntheticEvent = createKeyboardEvent(event, context, type, target);</span><br><span class="line">  <span class="comment">// âš›ï¸é€šè¿‡Responderä¸Šä¸‹æ–‡åˆ†å‘äº‹ä»¶</span></span><br><span class="line">  context.dispatchEvent(eventPropName, syntheticEvent, DiscreteEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºResponder:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸createResponderæŠŠkeyboardResponderImplè½¬æ¢ä¸ºç»„ä»¶å½¢å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> KeyboardResponder = React.unstable_createResponder(</span><br><span class="line">  <span class="string">'Keyboard'</span>,</span><br><span class="line">  keyboardResponderImpl,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸åˆ›å»ºhookså½¢å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useKeyboardListener</span>(<span class="params">props: KeyboardListenerProps</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  React.unstable_useListener(KeyboardResponder, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç°åœ¨è¯»è€…åº”è¯¥å¯¹<strong>Responderçš„èŒè´£</strong>æœ‰äº†ä¸€äº›åŸºæœ¬çš„äº†è§£ï¼Œå®ƒä¸»è¦åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…:</p><ul><li>å£°æ˜è¦ç›‘å¬çš„åŸç”Ÿäº‹ä»¶(å¦‚DOM), å¦‚ä¸Šé¢çš„<code>targetEventTypes</code></li><li>å¤„ç†å’Œè½¬æ¢åˆæˆäº‹ä»¶ï¼Œå¦‚ä¸Šé¢çš„<code>onEvent</code></li><li>åˆ›å»ºå¹¶åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚å¦‚ä¸Šé¢çš„<code>context.dispatchEvent</code></li></ul><p><br></p><p>å’Œä¸Šé¢çš„Keyboardæ¨¡å—ç›¸æ¯”ï¼Œç°å®ä¸­çš„å¾ˆå¤šé«˜çº§äº‹ä»¶ï¼Œå¦‚longPress, å®ƒä»¬çš„å®ç°åˆ™è¦å¤æ‚å¾—å¤š. å®ƒä»¬å¯èƒ½è¦ç»´æŒä¸€å®šçš„<strong>çŠ¶æ€</strong>ã€ä¹Ÿå¯èƒ½è¦ç‹¬å å“åº”çš„<strong>æ‰€æœ‰æƒ</strong>(å³åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªResponderå¯ä»¥å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†, è¿™ä¸ªå¸¸ç”¨äºç§»åŠ¨ç«¯è§¦æ‘¸æ‰‹åŠ¿ï¼Œä¾‹å¦‚React Nativeçš„<a href="https://reactnative.cn/docs/gesture-responder-system/" target="_blank" rel="noopener">GestureResponderSystem</a>)ã€‚</p><p>react-eventsç›®å‰éƒ½è€ƒè™‘äº†è¿™äº›åœºæ™¯, çœ‹ä¸€ä¸‹APIæ¦‚è§ˆ:</p><p><img src="/images/react-event/react-events.png" alt></p><p><br></p><p>è¯¦ç»†å¯ä»¥çœ‹react-events<a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener">å®˜æ–¹ä»“åº“</a></p><p><br></p><h3 id="react-eventsæ„ä¹‰ä½•åœ¨"><a href="#react-eventsæ„ä¹‰ä½•åœ¨" class="headerlink" title="react-eventsæ„ä¹‰ä½•åœ¨?"></a>react-eventsæ„ä¹‰ä½•åœ¨?</h3><p>ä¸Šæ–‡æåˆ°äº†Reactäº‹ä»¶å†…éƒ¨é‡‡ç”¨äº†æ’ä»¶æœºåˆ¶ï¼Œæ¥å®ç°äº‹ä»¶å¤„ç†å’Œåˆæˆï¼Œæ¯”è¾ƒå…¸å‹çš„å°±æ˜¯onChangeäº‹ä»¶ã€‚onChangeäº‹ä»¶å…¶å®å°±æ˜¯æ‰€è°“çš„â€˜é«˜çº§äº‹ä»¶â€™ï¼Œå®ƒæ˜¯é€šè¿‡è¡¨å•ç»„ä»¶çš„å„ç§åŸç”Ÿäº‹ä»¶æ¥æ¨¡æ‹Ÿçš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒReacté€šè¿‡æ’ä»¶æœºåˆ¶æœ¬è´¨ä¸Šæ˜¯å¯ä»¥å®ç°é«˜çº§äº‹ä»¶çš„å°è£…çš„ã€‚ä½†æ˜¯å¦‚æœè¯»è€…çœ‹è¿‡æºä»£ç ï¼Œå°±ä¼šè§‰å¾—é‡Œé¢é€»è¾‘æ¯”è¾ƒç»•ï¼Œè€Œä¸”ä¾èµ–Reactçš„å¾ˆå¤šå†…éƒ¨å®ç°ã€‚<strong>æ‰€ä»¥è¿™ç§å†…éƒ¨çš„æ’ä»¶æœºåˆ¶å¹¶ä¸æ˜¯é¢å‘æ™®é€šå¼€å‘è€…çš„</strong>ã€‚</p><p><code>react-events</code>æ¥å£å°±ç®€å•å¾ˆå¤šäº†ï¼Œå®ƒå±è”½äº†å¾ˆå¤šå†…éƒ¨ç»†èŠ‚ï¼Œé¢å‘æ™®é€šå¼€å‘è€…ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é«˜æ€§èƒ½çš„è‡ªå®šä¹‰äº‹ä»¶åˆ†å‘ï¼Œæ›´å¤§çš„æ„ä¹‰æ˜¯é€šè¿‡å®ƒå¯ä»¥å®ç°è·¨å¹³å°/è®¾å¤‡çš„äº‹ä»¶å¤„ç†æ–¹å¼.</p><p>ç›®å‰react-eventsè¿˜æ˜¯å®éªŒé˜¶æ®µï¼Œç‰¹æ€§æ˜¯é»˜è®¤å…³é—­ï¼ŒAPIå¯èƒ½ä¼šå‡ºç°å˜æ›´, æ‰€ä»¥ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://github.com/facebook/react/issues/15257" target="_blank" rel="noopener">Issue</a>æ¥å…³æ³¨å®ƒçš„è¿›å±•ã€‚</p><p><br></p><p>æœ€åèµå¹ä¸€ä¸‹Reactå›¢é˜Ÿçš„åˆ›æ–°èƒ½åŠ›ï¼</p><p><br></p><p>å®Œï¼</p><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://segmentfault.com/a/1190000013094932" target="_blank" rel="noopener">inputäº‹ä»¶ä¸­æ–‡è§¦å‘å¤šæ¬¡é—®é¢˜ç ”ç©¶</a></li><li><a href="http://www.ayqy.net/blog/dive-into-react-fiber/" target="_blank" rel="noopener">å®Œå…¨ç†è§£React Fiber</a></li><li><a href="https://www.youtube.com/watch?v=ZCuYPiUIONs" target="_blank" rel="noopener">Lin Clark â€“ A Cartoon Intro to Fiber â€“ React Conf 2017</a></li><li><a href="https://philippspiess.com/scheduling-in-react/" target="_blank" rel="noopener">Scheduling in React</a></li><li><a href="https://github.com/facebook/react/issues/15257" target="_blank" rel="noopener">[Umbrella] React Flare</a></li><li><a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener">react-events</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/react-event/sample.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘. &lt;/p
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>if æˆ‘æ˜¯å‰ç«¯å›¢é˜ŸLeaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ?</title>
    <link href="https://bobi.ink/2019/07/19/frontend-standard/"/>
    <id>https://bobi.ink/2019/07/19/frontend-standard/</id>
    <published>2019-07-18T16:00:00.000Z</published>
    <updated>2019-09-07T02:57:17.101Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸‡å­—é•¿æ–‡ï¼Œç»§ç»­åˆ·æ–°æˆ‘çš„æ–‡ç« é•¿åº¦è®°å½•ï¼Œæ¶‰åŠå‰ç«¯å¼€å‘çš„æ–¹æ–¹é¢é¢ã€‚æœ¬æ–‡å°†æŒç»­æ›´æ–°å’Œå®Œå–„, æ–‡ç« éƒ¨åˆ†è§‚ç‚¹å¯èƒ½æ¯”è¾ƒæ­¦æ–­æˆ–ä¸å®Œæ•´ï¼Œæ¬¢è¿è¯„è®ºå’Œè¡¥å……ï¼Œä¸€èµ·å®Œå–„è¯¥æ–‡ç« . è°¢è°¢</p></blockquote><p><br></p><p>ç¬”è€…é•¿æœŸå•æªåŒ¹é©¬åœ¨å‰ç«¯é¢†åŸŸå®æ€(è¨€å¤–ä¹‹æ„å°±æ˜¯å›¢é˜Ÿå°±ä¸€ä¸ªäºº)ï¼Œè‡ªå·±å°±æ˜¯è§„èŒƒã€‚éšç€å…¬å¸ä¸šåŠ¡çš„æ‰©å±•ï¼Œæ‰©å……äº†ä¸€äº›äººå‘˜ï¼Œè¿™æ—¶å€™å°±è¦å¼€å§‹è€ƒè™‘åä½œå’Œç¼–ç è§„èŒƒé—®é¢˜äº†ã€‚æœ¬æ–‡è®°å½•äº†ç¬”è€…åœ¨åˆ¶å®š<code>å‰ç«¯åä½œè§„èŒƒ</code>æ—¶çš„ä¸€äº›æ€è€ƒï¼Œå¸Œæœ›èƒ½ç»™ä½ ä»¬ä¹Ÿå¸¦æ¥ä¸€äº›å¸®åŠ©.</p><p><strong>ä¸€ä¸ªäººèµ°çš„æ›´å¿«ï¼Œä¸€ç¾¤äººå¯ä»¥èµ°å¾—æ›´è¿œï¼Œå‰ææ˜¯ç»Ÿä¸€çš„ç­–ç•¥ï¼Œè¿˜è¦ä¸æ–­åœ°åçœå’Œä¼˜åŒ–</strong>ã€‚</p><p><br></p><p><strong>ä»¥ä¸‹æ˜¯ç›®å½•æ¦‚è§ˆ, çœ‹å‡ºè¿™æ˜¯ä¸€ç¯‡æµ©æµ©è¡è¡çš„é•¿æ–‡</strong></p><!-- TOC --><ul><li><a href="#1-å·¥ä½œæµè§„èŒƒ">1 å·¥ä½œæµè§„èŒƒ</a><ul><li><a href="#11-å¼€å‘">1.1 å¼€å‘</a><ul><li><a href="#111-ç‰ˆæœ¬è§„èŒƒ">1.1.1 ç‰ˆæœ¬è§„èŒƒ</a></li><li><a href="#112-ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ">1.1.2 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ</a></li><li><a href="#113-æäº¤ä¿¡æ¯è§„èŒƒ">1.1.3 æäº¤ä¿¡æ¯è§„èŒƒ</a></li></ul></li><li><a href="#12-æ„å»ºè§„èŒƒ">1.2 æ„å»ºè§„èŒƒ</a></li><li><a href="#13-å‘å¸ƒå·¥ä½œæµè§„èŒƒ">1.3 å‘å¸ƒå·¥ä½œæµè§„èŒƒ</a></li><li><a href="#14-æŒç»­é›†æˆ">1.4 æŒç»­é›†æˆ</a></li><li><a href="#15-ä»»åŠ¡ç®¡ç†">1.5 ä»»åŠ¡ç®¡ç†</a></li></ul></li><li><a href="#2-æŠ€æœ¯æ ˆè§„èŒƒ">2 æŠ€æœ¯æ ˆè§„èŒƒ</a><ul><li><a href="#21-æŠ€æœ¯é€‰å‹">2.1 æŠ€æœ¯é€‰å‹</a></li><li><a href="#22-è¿æ¥æ–°æŠ€æœ¯">2.2 è¿æ¥æ–°æŠ€æœ¯</a></li></ul></li><li><a href="#3-æµè§ˆå™¨å…¼å®¹è§„èŒƒ">3 æµè§ˆå™¨å…¼å®¹è§„èŒƒ</a><ul><li><a href="#31-ç¡®å®šå…¼å®¹ç­–ç•¥">3.1 ç¡®å®šå…¼å®¹ç­–ç•¥</a></li><li><a href="#32-ç¡®å®šæµè§ˆå™¨åˆ†çº§">3.2 ç¡®å®šæµè§ˆå™¨åˆ†çº§</a></li><li><a href="#33-è·å–ç»Ÿè®¡æ•°æ®">3.3 è·å–ç»Ÿè®¡æ•°æ®</a></li></ul></li><li><a href="#4-é¡¹ç›®ç»„ç»‡è§„èŒƒ">4 é¡¹ç›®ç»„ç»‡è§„èŒƒ</a><ul><li><a href="#41-é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ">4.1 é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ</a></li><li><a href="#42-ç›®å½•ç»„ç»‡çš„é£æ ¼">4.2 ç›®å½•ç»„ç»‡çš„é£æ ¼</a></li><li><a href="#43-è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿">4.3 è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿</a></li></ul></li><li><a href="#5-ç¼–ç è§„èŒƒ">5 ç¼–ç è§„èŒƒ</a><ul><li><a href="#51-javascript">5.1 Javascript</a></li><li><a href="#52-html">5.2 HTML</a></li><li><a href="#53-css">5.3 CSS</a></li><li><a href="#54-ä»£ç æ ¼å¼åŒ–">5.4 ä»£ç æ ¼å¼åŒ–</a></li><li><a href="#55-é›†å¤§æˆçš„">5.5 é›†å¤§æˆçš„</a></li><li><a href="#56-ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—">5.6 ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—</a></li><li><a href="#57-code-review">5.7 Code Review</a></li></ul></li><li><a href="#6-æ–‡æ¡£è§„èŒƒ">6 æ–‡æ¡£è§„èŒƒ</a><ul><li><a href="#61-å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ">6.1 å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ</a></li><li><a href="#62-æ–‡æ¡£æ ¼å¼">6.2 æ–‡æ¡£æ ¼å¼</a></li><li><a href="#63-å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿">6.3 å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿</a></li><li><a href="#64-è®¨è®ºå³æ–‡æ¡£">6.4 è®¨è®ºå³æ–‡æ¡£</a></li><li><a href="#65-æ³¨é‡Šå³æ–‡æ¡£">6.5 æ³¨é‡Šå³æ–‡æ¡£</a></li><li><a href="#66-ä»£ç å³æ–‡æ¡£">6.6 ä»£ç å³æ–‡æ¡£</a></li></ul></li><li><a href="#7-uiè®¾è®¡è§„èŒƒ">7 UIè®¾è®¡è§„èŒƒ</a></li><li><a href="#8-æµ‹è¯•è§„èŒƒ">8 æµ‹è¯•è§„èŒƒ</a><ul><li><a href="#81-æµ‹è¯•çš„æµç¨‹">8.1 æµ‹è¯•çš„æµç¨‹</a></li><li><a href="#82-å•å…ƒæµ‹è¯•">8.2 å•å…ƒæµ‹è¯•</a></li></ul></li><li><a href="#9-å¼‚å¸¸å¤„ç†ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ">9 å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ</a><ul><li><a href="#91-å¼‚å¸¸å¤„ç†">9.1 å¼‚å¸¸å¤„ç†</a></li><li><a href="#92-æ—¥å¿—">9.2 æ—¥å¿—</a></li><li><a href="#93-å¼‚å¸¸ç›‘æ§">9.3 å¼‚å¸¸ç›‘æ§</a></li></ul></li><li><a href="#10-å‰åç«¯åä½œè§„èŒƒ">10 å‰åç«¯åä½œè§„èŒƒ</a><ul><li><a href="#101-åä½œæµç¨‹è§„èŒƒ">10.1 åä½œæµç¨‹è§„èŒƒ</a></li><li><a href="#102-æ¥å£è§„èŒƒ">10.2 æ¥å£è§„èŒƒ</a></li><li><a href="#103-æ¥å£æ–‡æ¡£è§„èŒƒ">10.3 æ¥å£æ–‡æ¡£è§„èŒƒ</a></li><li><a href="#104-æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ">10.4 æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ</a></li></ul></li><li><a href="#11-åŸ¹è®­çŸ¥è¯†ç®¡ç†æŠ€æœ¯æ²‰æ·€">11 åŸ¹è®­/çŸ¥è¯†ç®¡ç†/æŠ€æœ¯æ²‰æ·€</a><ul><li><a href="#111-æ–°äººåŸ¹è®­">11.1 æ–°äººåŸ¹è®­</a></li><li><a href="#112-è¥é€ æŠ€æœ¯æ°›å›´">11.2 è¥é€ æŠ€æœ¯æ°›å›´</a></li></ul></li><li><a href="#12-åé¦ˆ">12 åé¦ˆ</a></li></ul><!-- /TOC --><p><br></p><p><strong>CHANGELOG</strong></p><ul><li>2019.7.28<br>æ–°å¢<a href="#tech-select">æŠ€æœ¯é€‰å‹</a></li><li>2019.7.29<br>æ–°å¢<a href="#brw-anly">æµè§ˆå™¨ç»Ÿè®¡æ•°æ®è·å–</a></li><li>2019.9.6<br>å»ºç«‹æŠ€æœ¯æ°›å›´ä¸€èŠ‚ æ–°å¢é¢è¯•é¢˜åº“</li></ul><p><br></p><p><strong>ä»€ä¹ˆæ˜¯è§„èŒƒ?</strong></p><p>è§„èŒƒï¼Œåè¯æ„ä¹‰ä¸Šï¼šå³æ˜æ–‡è§„å®šæˆ–çº¦å®šä¿—æˆçš„æ ‡å‡†ï¼Œå¦‚ï¼šé“å¾·è§„èŒƒã€æŠ€æœ¯è§„èŒƒç­‰ã€‚ åŠ¨è¯æ„ä¹‰ä¸Šï¼šæ˜¯æŒ‡æŒ‰ç…§æ—¢å®šæ ‡å‡†ã€è§„èŒƒçš„è¦æ±‚è¿›è¡Œæ“ä½œï¼Œä½¿æŸä¸€è¡Œä¸ºæˆ–æ´»åŠ¨è¾¾åˆ°æˆ–è¶…è¶Šè§„å®šçš„æ ‡å‡†ï¼Œå¦‚ï¼šè§„èŒƒç®¡ç†ã€è§„èŒƒæ“ä½œ.</p><p><br></p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦è§„èŒƒ?</strong></p><ul><li>é™ä½æ–°æˆå‘˜èå…¥å›¢é˜Ÿçš„æˆæœ¬, åŒæ—¶ä¹Ÿä¸€å®šç¨‹åº¦é¿å…æŒ–å‘</li><li>æé«˜å¼€å‘æ•ˆç‡ã€å›¢é˜Ÿåä½œæ•ˆç‡, é™ä½æ²Ÿé€šæˆæœ¬</li><li>å®ç°é«˜åº¦ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼Œæ–¹ä¾¿review, å¦å¤–ä¸€æ–¹é¢å¯ä»¥æé«˜é¡¹ç›®çš„å¯ç»´æŠ¤æ€§</li><li>è§„èŒƒæ˜¯å®ç°è‡ªåŠ¨åŒ–çš„åŸºç¡€</li><li>è§„èŒƒæ˜¯ä¸€ä¸ªå›¢é˜ŸçŸ¥è¯†æ²‰æ·€çš„ç›´æ¥è¾“å‡º</li></ul><p><br></p><p><strong>è§„èŒƒåŒ…å«å“ªäº›å†…å®¹?</strong></p><p>å¦‚æ–‡ç« æ ‡é¢˜ï¼Œ<strong>å‰ç«¯åä½œè§„èŒƒå¹¶ä¸å•å•æŒ‡â€˜ç¼–ç è§„èŒƒâ€™ï¼Œè¿™ä¸ªè§„èŒƒæ¶‰åŠåˆ°å‰ç«¯å¼€å‘æ´»åŠ¨çš„æ–¹æ–¹é¢é¢</strong>ï¼Œä¾‹å¦‚ä»£ç åº“çš„ç®¡ç†ã€å‰åç«¯åä½œã€ä»£ç è§„èŒƒã€å…¼å®¹æ€§è§„èŒƒï¼›</p><p>ä¸ä»…ä»…æ˜¯å‰ç«¯å›¢é˜Ÿå†…éƒ¨éœ€è¦åä½œï¼Œä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæˆ‘ä»¬éœ€è¦å’Œäº§å“/è®¾è®¡ã€åç«¯(æˆ–è€…åŸç”Ÿå®¢æˆ·ç«¯å›¢é˜Ÿ)ã€æµ‹è¯•è¿›è¡Œåä½œ, æˆ‘ä»¬éœ€è¦è¦†ç›–è¿™äº›å†…å®¹.</p><p><br></p><p>ä¸‹é¢å°±å¼€å§‹ä»‹ç»ï¼Œ<strong>å¦‚æœæˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿçš„Leaderï¼Œæˆ‘ä¼šæ€ä¹ˆåˆ¶å®šå‰ç«¯è§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒéœ€è¦åŒ…å«å“ªäº›å†…å®¹</strong>?</p><p><br></p><h2 id="1-å·¥ä½œæµè§„èŒƒ"><a href="#1-å·¥ä½œæµè§„èŒƒ" class="headerlink" title="1 å·¥ä½œæµè§„èŒƒ"></a>1 å·¥ä½œæµè§„èŒƒ</h2><h3 id="1-1-å¼€å‘"><a href="#1-1-å¼€å‘" class="headerlink" title="1.1 å¼€å‘"></a>1.1 å¼€å‘</h3><h4 id="1-1-1-ç‰ˆæœ¬è§„èŒƒ"><a href="#1-1-1-ç‰ˆæœ¬è§„èŒƒ" class="headerlink" title="1.1.1 ç‰ˆæœ¬è§„èŒƒ"></a>1.1.1 ç‰ˆæœ¬è§„èŒƒ</h4><p>é¡¹ç›®çš„ç‰ˆæœ¬å·åº”è¯¥æ ¹æ®æŸäº›è§„åˆ™è¿›è¡Œè¿­ä»£, è¿™é‡Œæ¨èä½¿ç”¨<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">è¯­ä¹‰åŒ–ç‰ˆæœ¬</a>è§„èŒƒ, <strong>é€šè¿‡è¿™ä¸ªè§„èŒƒï¼Œç”¨æˆ·å¯ä»¥äº†è§£ç‰ˆæœ¬å˜æ›´çš„å½±å“èŒƒå›´</strong>ã€‚ è§„åˆ™å¦‚ä¸‹:</p><ul><li>ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ</li><li>æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ</li><li>ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-1-2-ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ"><a href="#1-1-2-ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ" class="headerlink" title="1.1.2 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ"></a>1.1.2 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè§„èŒƒ</h4><p>å¤§éƒ¨åˆ†å›¢é˜Ÿéƒ½ä½¿ç”¨gitä½œä¸ºç‰ˆæœ¬åº“ï¼Œç®¡ç†å¥½ä»£ç ä¹Ÿæ˜¯ä¸€ç§å­¦é—®ã€‚å°¤å…¶æ˜¯æ¶‰åŠå¤šäººå¹¶å‘åä½œã€éœ€è¦ç®¡ç†å¤šä¸ªè½¯ä»¶ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå®šä¹‰è‰¯å¥½çš„ç‰ˆæœ¬åº“ç®¡ç†è§„èŒƒï¼Œå¯ä»¥è®©å¤§å‹é¡¹ç›®æ›´æœ‰ç»„ç»‡æ€§ï¼Œä¹Ÿå¯ä»¥æé«˜æˆå‘˜åä½œæ•ˆç‡.</p><p>æ¯”è¾ƒæµè¡Œçš„gitåˆ†æ”¯æ¨¡å‹/å·¥ä½œæµæ˜¯<a href="https://www.git-tower.com/learn/git/ebook/cn/command-line/advanced-topics/git-flow" target="_blank" rel="noopener">git-flow</a>, ä½†æ˜¯å¤§éƒ¨åˆ†å›¢é˜Ÿä¼šæ ¹æ®è‡ªå·±çš„æƒ…å†µåˆ¶å®šè‡ªå·±çš„gitå·¥ä½œæµè§„èŒƒ, ä¾‹å¦‚æˆ‘ä»¬å›¢é˜Ÿçš„<a href="https://github.com/GDJiaMi/frontend-standards/blob/master/development.md#git-%E5%88%86%E6%94%AF%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">åˆ†æ”¯è§„èŒƒ</a></p><p><strong>Git æœ‰å¾ˆå¤šå·¥ä½œæµæ–¹æ³•è®ºï¼Œè¿™äº›å·¥ä½œæµçš„é€‰æ‹©å¯èƒ½ä¾èµ–äºé¡¹ç›®çš„è§„æ¨¡ã€é¡¹ç›®çš„ç±»å‹ä»¥åŠå›¢é˜Ÿæˆå‘˜çš„ç»“æ„</strong>.</p><p>æ¯”å¦‚ä¸€ä¸ªç®€å•çš„ä¸ªäººé¡¹ç›®å¯èƒ½ä¸éœ€è¦å¤æ‚çš„åˆ†æ”¯åˆ’åˆ†ï¼Œæˆ‘ä»¬çš„å˜æ›´éƒ½æ˜¯ç›´æ¥æäº¤åˆ° master åˆ†æ”¯;</p><p>å†æ¯”å¦‚å¼€æºé¡¹ç›®ï¼Œé™¤äº†æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ï¼Œå…¶ä»–è´¡çŒ®è€…æ˜¯æ²¡æœ‰æäº¤çš„æƒé™çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€å®šçš„æ‰‹æ®µæ¥éªŒè¯å’Œè®¨è®ºè´¡çŒ®çš„ä»£ç æ˜¯å¦åˆç†ã€‚ æ‰€ä»¥å¯¹äºå¼€æºé¡¹ç›® fork å·¥ä½œæµæ›´ä¸ºé€‚åˆ.</p><p>äº†è§£å¸¸è§çš„å·¥ä½œæµæœ‰åˆ©äºç»„ç»‡æˆ–åˆ›å»ºé€‚åˆè‡ªå·±å›¢é˜Ÿçš„å·¥ä½œæµ, æäº¤å›¢é˜Ÿåä½œçš„æ•ˆç‡:</p><p><img src="/images/frontend-standard/branch.png" alt></p><ul><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/centralized.md" target="_blank" rel="noopener">ç®€å•çš„é›†ä¸­å¼</a></li><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/feature.md" target="_blank" rel="noopener">åŸºäºåŠŸèƒ½åˆ†æ”¯çš„å·¥ä½œæµ</a></li><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/gitflow.md" target="_blank" rel="noopener">Git Flow</a> ğŸ”¥</li><li><a href="https://github.com/ivan-94/git-guide/blob/master/branch/fork.md" target="_blank" rel="noopener">Fork/Pull Request å·¥ä½œæµ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h4 id="1-1-3-æäº¤ä¿¡æ¯è§„èŒƒ"><a href="#1-1-3-æäº¤ä¿¡æ¯è§„èŒƒ" class="headerlink" title="1.1.3 æäº¤ä¿¡æ¯è§„èŒƒ"></a>1.1.3 æäº¤ä¿¡æ¯è§„èŒƒ</h4><p><img src="/images/frontend-standard/commit.png" alt></p><p>ç»„ç»‡å¥½çš„æäº¤ä¿¡æ¯, å¯ä»¥æé«˜é¡¹ç›®çš„æ•´ä½“è´¨é‡. è‡³å°‘å…·æœ‰ä¸‹é¢è¿™äº›ä¼˜ç‚¹:</p><ul><li><strong>æ ¼å¼ç»Ÿä¸€çš„æäº¤ä¿¡æ¯æœ‰åŠ©äºè‡ªåŠ¨åŒ–ç”ŸæˆCHANGELOG</strong></li><li><strong>ç‰ˆæœ¬åº“ä¸åªæ˜¯å­˜æ”¾ä»£ç çš„ä»“åº“, å®ƒè®°å½•é¡¹ç›®çš„å¼€å‘æ—¥å¿—, å®ƒåº”è¯¥è¦æ¸…æ™°è¡¨è¾¾è¿™æ¬¡æäº¤çš„åšäº†ä»€ä¹ˆ</strong>. è¿™äº›è®°å½•åº”è¯¥å¯ä»¥å¸®åŠ©åæ¥è€…å¿«é€Ÿåœ°å­¦ä¹ å’Œå›é¡¾ä»£ç , ä¹Ÿåº”è¯¥æ–¹ä¾¿å…¶ä»–åä½œè€…reviewä½ çš„ä»£ç </li><li><strong>è§„èŒƒåŒ–æäº¤ä¿¡æ¯å¯ä»¥ä¿ƒè¿›æäº¤è€…æäº¤æœ‰æ„ä¹‰çš„ã€ç²’åº¦åˆé€‚çš„â€™æäº¤â€™</strong>. æäº¤è€…è¦æƒ³å¥½è¦æ€ä¹ˆæè¿°è¿™ä¸ªæäº¤ï¼Œè¿™æ ·è¢«åŠ¨ä¿ƒè¿›äº†ä»–ä»¬å»æŠŠæ§<strong>æäº¤çš„ç²’åº¦</strong></li></ul><p><br></p><p>ç¤¾åŒºä¸Šæ¯”è¾ƒæµè¡Œçš„æäº¤ä¿¡æ¯è§„èŒƒæ˜¯<a href="https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit" target="_blank" rel="noopener">Angularçš„æäº¤ä¿¡æ¯è§„èŒƒ</a>, é™¤æ­¤ä¹‹å¤–ï¼Œè¿™äº›ä¹Ÿå¾ˆä¸é”™:</p><ul><li><a href="https://github.com/atom/atom/blob/master/CONTRIBUTING.md#git-commit-messages" target="_blank" rel="noopener">Atom</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-ember" target="_blank" rel="noopener">Ember</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-eslint" target="_blank" rel="noopener">Eslint</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-jquery" target="_blank" rel="noopener">JQuery</a></li></ul><p><br></p><p>å¦å¤–è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ æ£€éªŒæäº¤ä¿¡æ¯, ä»¥åŠç”ŸæˆCHANGELOG:</p><ul><li><a href="https://github.com/conventional-changelog/conventional-changelog" target="_blank" rel="noopener">conventional-changelog</a> - ä»é¡¹ç›®çš„æäº¤ä¿¡æ¯ä¸­ç”ŸæˆCHANGELOGå’Œå‘å¸ƒä¿¡æ¯</li><li><a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener">commitlint</a> - æ£€éªŒæäº¤ä¿¡æ¯</li><li><a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener">commitizen</a> - ğŸ”¥ç®€å•çš„æäº¤è§„èŒƒå’Œæäº¤å¸®åŠ©å·¥å…·ï¼Œæ¨è</li><li><a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener">standard-changelog</a> - angularé£æ ¼çš„æäº¤å‘½ä»¤è¡Œå·¥å…· </li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-2-æ„å»ºè§„èŒƒ"><a href="#1-2-æ„å»ºè§„èŒƒ" class="headerlink" title="1.2 æ„å»ºè§„èŒƒ"></a>1.2 æ„å»ºè§„èŒƒ</h3><p>å¯¹äºå›¢é˜Ÿã€æˆ–è€…éœ€è¦ç»´æŠ¤å¤šä¸ªé¡¹ç›®åœºæ™¯ï¼Œç»Ÿä¸€çš„æ„å»ºå·¥å…·é“¾å¾ˆé‡è¦, <strong>è¿™å¥—å·¥å…·åº”è¯¥å¼ºè°ƒâ€çº¦å®šå¤§äºé…ç½®â€ï¼Œè®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡çš„å¼€å‘</strong>ã€‚ç¬”è€…åœ¨<a href="https://juejin.im/post/5d2fcaacf265da1b95708f63" target="_blank" rel="noopener">&lt;ä¸ºä»€ä¹ˆè¦ç”¨vue-cli3?&gt;</a>æ–‡ç« ä¸­æå‡ºäº†<code>vue-cli3</code>æ›´æ–°æœ‰å¾ˆå¤šäº®ç‚¹ï¼Œéå¸¸é€‚åˆä½œä¸ºå›¢é˜Ÿæ„å»ºå·¥å…·é“¾çš„åŸºç¡€:</p><ul><li><strong>é¦–å…ˆè¿™ç±»å·¥å…·æ˜¯æ¨å´‡â€™çº¦å®šå¤§äºé…ç½®â€™</strong>ã€‚å³æŒ‰ç…§ä»–ä»¬çš„è§„èŒƒï¼Œå¯ä»¥å®ç°å¼€ç®±å³ç”¨ï¼Œå¿«é€Ÿå¼€å‘ä¸šåŠ¡. åœ¨å›¢é˜Ÿåä½œä¸­è¿™ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘ä»¬ä¸æ¨èå›¢é˜Ÿæˆå‘˜å»å…³å¿ƒåˆè‡­åˆé•¿çš„webpackæ„å»ºé…ç½®</li><li><strong><code>vue-cli3</code>æŠ½ç¦»äº†<code>cli serviceå±‚</code>ï¼Œå¯ä»¥ç‹¬ç«‹æ›´æ–°å·¥å…·é“¾</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´é¡¹ç›®çš„æ„å»ºè„šæœ¬å’Œé…ç½®åœ¨ä¸€ä¸ªç‹¬ç«‹çš„serviceé¡¹ç›®ä¸­ç»´æŠ¤ï¼Œè€Œä¸æ˜¯åƒä»¥å‰ä¸€æ ·åœ¨æ¯ä¸ªé¡¹ç›®ç›®å½•ä¸‹éƒ½æœ‰webpacké…ç½®å’Œä¾èµ–. è¿™æ ·åšçš„å¥½å¤„æ˜¯ç‹¬ç«‹åœ°ã€ç®€å•åœ°å‡çº§æ•´ä¸ªæ„å»ºé“¾</li><li><strong>çµæ´»çš„æ’ä»¶æœºåˆ¶</strong>ã€‚å¯¹äºå›¢é˜Ÿçš„å®šåˆ¶åŒ–æ„å»ºåº”è¯¥å°è£…åˆ°æ’ä»¶ä¸­ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å®ç°ç‹¬ç«‹çš„æ›´æ–°ã€‚</li></ul><p><strong>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç¬¬ä¸‰æ–¹CLI, å½“ç„¶ä¹Ÿå®šåˆ¶è‡ªå·±çš„æ„å»ºé“¾ï¼ŒæŒ‰ç…§ä¸Šé¢è¯´çš„è¿™ä¸ªæ„å»ºé“¾åº”è¯¥æœ‰ä»¥ä¸‹ç‰¹ç‚¹</strong>:</p><ul><li><strong>å¼ºçº¦å®šï¼Œä½“ç°å›¢é˜Ÿçš„è§„èŒƒ</strong>ã€‚é¦–å…ˆå®ƒåº”è¯¥é¿å…å›¢é˜Ÿæˆå‘˜å»å…³å¿ƒæˆ–æ›´æ”¹æ„å»ºçš„é…ç½®ç»†èŠ‚ï¼Œæš´éœ²æœ€å°åŒ–çš„é…ç½®æ¥å£ã€‚ <em>å¦å¤–æ„å»ºå·¥å…·ä¸ä»…ä»…æ˜¯æ„å»ºï¼Œé€šå¸¸å®ƒè¿˜ä¼šé›†æˆä»£ç æ£€æŸ¥ã€æµ‹è¯•ç­‰åŠŸèƒ½</em>ã€‚</li><li><strong>æ–¹ä¾¿å‡çº§</strong>ã€‚å°¤å…¶æ˜¯å›¢é˜Ÿéœ€è¦ç»´æŠ¤å¤šä¸ªé¡¹ç›®åœºæ™¯, è¿™ä¸€ç‚¹å¾ˆæœ‰æ„ä¹‰</li></ul><p>ä¸‹é¢æ˜¯ç¤¾åŒºä¸Šæ¯”è¾ƒæµè¡Œçš„æ„å»ºå·¥å…·. å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„å›¢é˜Ÿæƒ…å†µå¼€å‘è‡ªå·±çš„CLI, ä½†æ˜¯ä¸‹é¢çš„å·¥å…·ä¾ç„¶å¾ˆæœ‰<em>å‚è€ƒä»·å€¼</em>ï¼š</p><ul><li><a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a> - ğŸ”¥é›¶é…ç½®å¼€å§‹Reactå¼€å‘</li><li><a href="https://cli.vuejs.org/" target="_blank" rel="noopener">vue-cli</a> - ğŸ”¥é›¶é…ç½®ã€æ¸è¿›å¢å¼ºçš„é¡¹ç›®æ„å»ºCLI</li><li><a href="https://parceljs.org/" target="_blank" rel="noopener">parcel</a> - é›¶é…ç½®çš„Webåº”ç”¨æ‰“åŒ…å·¥å…·</li><li><a href="https://github.com/fuse-box/fuse-box" target="_blank" rel="noopener">Fusebox</a> - é«˜é€Ÿæ˜“ç”¨çš„æ‰“åŒ…å·¥å…·</li><li><a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> - é›¶é…ç½®, åŸºäºRollupï¼Œé€‚åˆç”¨äºæ‰“åŒ…â€˜åº“â€™</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-3-å‘å¸ƒå·¥ä½œæµè§„èŒƒ"><a href="#1-3-å‘å¸ƒå·¥ä½œæµè§„èŒƒ" class="headerlink" title="1.3 å‘å¸ƒå·¥ä½œæµè§„èŒƒ"></a>1.3 å‘å¸ƒå·¥ä½œæµè§„èŒƒ</h3><p>å‘å¸ƒå·¥ä½œæµæŒ‡çš„æ˜¯å°†â€˜è½¯ä»¶æˆå“â€™å¯¹å¤–å‘å¸ƒ(å¦‚æµ‹è¯•æˆ–ç”Ÿäº§)çš„ä¸€å¥—æµç¨‹, å°†è¿™å¥—æµç¨‹è§„èŒƒåŒ–åï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–.</p><p>ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒå·¥ä½œæµå¦‚ä¸‹ï¼š</p><p><img src="/images/frontend-standard/pub.png" alt></p><ul><li>ä»£ç å˜æ›´</li><li>æäº¤ä»£ç å˜æ›´åˆ°è¿œç¨‹ç‰ˆæœ¬åº“</li><li>ç¨‹åºé€šè¿‡CIæµ‹è¯•(ä¾‹å¦‚Traviså˜ç»¿)</li><li>æå‡package.jsonä¸­çš„ç‰ˆæœ¬</li><li>ç”ŸæˆCHANGELOG</li><li>æäº¤package.jsonå’ŒCHANGELOG.mdæ–‡ä»¶</li><li>æ‰“ä¸ŠTag</li><li>æ¨é€</li></ul><p>å¦‚æœä½ éµå¾ªä¸Šé¢çš„è§„èŒƒï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨ç¤¾åŒºä¸Šç°æœ‰çš„å·¥å…·æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªæµç¨‹. è¿™äº›å·¥å…·æœ‰:</p><ul><li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli" target="_blank" rel="noopener">conventional-changelog-cli</a></li><li><a href="https://github.com/conventional-changelog/conventional-github-releaser" target="_blank" rel="noopener">conventional-github-releaser</a></li><li>å®é™…ä¸Šè‡ªå·±å¼€å‘ä¸€ä¸ªä¹Ÿä¸æ˜¯ç‰¹åˆ«éš¾çš„äº‹æƒ….</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-4-æŒç»­é›†æˆ"><a href="#1-4-æŒç»­é›†æˆ" class="headerlink" title="1.4 æŒç»­é›†æˆ"></a>1.4 æŒç»­é›†æˆ</h3><p>å°†æ•´å¥—å¼€å‘å·¥ä½œæµç¡®å®šä¸‹æ¥ä¹‹å, å°±å¯ä»¥ä½¿ç”¨<code>æŒç»­é›†æˆæœåŠ¡</code>æ¥è‡ªåŠ¨åŒ–æ‰§è¡Œæ•´ä¸ªæµç¨‹ã€‚æ¯”å¦‚ä¸€ä¸ªå…¸å‹çš„CIæµç¨‹:</p><p><img src="/images/frontend-standard/ci.png" alt></p><p><strong>æŒç»­é›†æˆæ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢</strong>?</p><p>æˆ‘ä»¬éœ€è¦<code>æŒç»­é›†æˆ</code>æ‹†æˆä¸¤ä¸ªè¯åˆ†åˆ«æ¥ç†è§£, ä»€ä¹ˆæ˜¯<code>æŒç»­</code>? ä»€ä¹ˆæ˜¯<code>é›†æˆ</code>?</p><p><strong>æŒç»­(Continuous), å¯ä»¥ç†è§£ä¸ºâ€™é¢‘ç¹â€™æˆ–è€…â€˜è¿ç»­æ€§â€™</strong>. ä¸ç®¡æ˜¯æŒç»­é›†æˆè¿˜æ˜¯æ•æ·å¼€å‘æ€ç»´ã€çœ‹æ¿ï¼Œéƒ½è®¤ä¸ºâ€˜æŒç»­â€™æ˜¯å®ƒä»¬çš„åŸºç¡€ã€‚</p><p>ä¸¾ä¸€ä¸ªé€šä¿—çš„ä¾‹å­ï¼Œ<strong>æ¯”å¦‚ä»£ç æ£€æŸ¥ï¼Œâ€˜æŒç»­çš„â€™çš„ä»£ç æ£€æŸ¥å°±æ˜¯ä»£ç ä¸€å˜åŠ¨(å¦‚ä¿å­˜ï¼Œæˆ–è€…IDEå®æ—¶æ£€æŸ¥ã€æˆ–è€…æäº¤åˆ°ç‰ˆæœ¬åº“æ—¶)å°±é©¬ä¸Šæ£€æŸ¥ä»£ç ï¼Œè€Œâ€˜éæŒç»­â€™çš„ä»£ç æ£€æŸ¥å°±æ˜¯åœ¨å®Œæˆæ‰€æœ‰ç¼–ç åï¼Œå†è¿›è¡Œæ£€æŸ¥</strong>ã€‚å¯¹æ¯”ä¸¤è€…å¯ä»¥å‘ç°ï¼ŒæŒç»­æ€§çš„ä»£ç æ£€æŸ¥å¯ä»¥å°½æ—©åœ°å‘ç°é”™è¯¯ï¼Œè€Œä¸”é”™è¯¯ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£å’Œå¤„ç†ï¼Œåä¹‹éæŒç»­æ€§çš„ä»£ç æ£€æŸ¥ï¼Œå¯èƒ½ä¼šå‘ç°ä¸€å †çš„é”™è¯¯ï¼Œå¤±ä¹‹æ¯«å˜è°¬ä»¥åƒé‡Œï¼Œé”™è¯¯ç›¸äº’ç‰µè¿ï¼Œæœ€ç»ˆä¼šå˜å¾—éš¾ä»¥æ”¶æ‹¾ã€‚</p><p><strong>â€˜æŒç»­â€™çš„æ¦‚å¿µï¼Œå¯ä»¥ç”¨äºè½¯ä»¶å¼€å‘çš„æ–¹æ–¹é¢é¢ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æŠŠä¼ ç»Ÿç€‘å¸ƒå¼çš„è½¯ä»¶å¼€å‘æµç¨‹æ‰“ç¢ï¼Œå½¢æˆä¸€ä¸ªä¸ªæ›´å°çš„å¼€å‘é—­ç¯ï¼ŒæŒç»­åœ°è¾“å‡ºäº§å“ï¼ŒåŒæ—¶äº§å“ä¹ŸæŒç»­åœ°ç»™ä¸Šæ¸¸åé¦ˆå’Œçº æ­£</strong>ã€‚</p><p><img src="/images/frontend-standard/continous.png" alt></p><p><strong>é‚£ä»€ä¹ˆæ˜¯â€˜é›†æˆâ€™å‘¢</strong>ï¼Ÿç‹­ä¹‰çš„é›†æˆå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯<a href="https://juejin.im/post/5d2c515d6fb9a07ead5a2bbe#heading-26" target="_blank" rel="noopener">â€˜é›†æˆæµ‹è¯•â€™</a>å§. é›†æˆæµ‹è¯•å¯ä»¥å¯¹ä»£ç é™æ€æµ‹è¯•ã€å•å…ƒæµ‹è¯•ã€é€šè¿‡å•å…ƒæµ‹è¯•åå¯ä»¥è¿›è¡Œé›†æˆæµ‹è¯•ï¼Œåœ¨åº”ç”¨ç»„æˆä¸€ä¸ªæ•´ä½“ååœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è·‘E2Eæµ‹è¯•ç­‰ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™é‡Œè¿›è¡Œä¸€ç³»åˆ—çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¥éªŒè¯è½¯ä»¶ç³»ç»Ÿã€‚</p><p>å¹¿ä¹‰çš„æŒç»­é›†æˆæœåŠ¡ï¼Œä¸ä»…ä»…æ˜¯æµ‹è¯•ï¼Œå®ƒè¿˜è¡ç”Ÿå‡ºå¾ˆå¤šæ¦‚å¿µï¼Œä¾‹å¦‚æŒç»­äº¤ä»˜ã€æŒç»­éƒ¨ç½²ï¼Œå¦‚ä¸‹å›¾</p><p><img src="/images/frontend-standard/devops.png" alt></p><p>OK, <strong>æ€»ç»“ä¸€ä¸‹ä¸ºä»€ä¹ˆæŒç»­é›†æˆçš„å¥½å¤„</strong>:</p><ul><li>å°½æ—©å‘ç°é”™è¯¯ï¼Œå¿«é€Ÿè¯•é”™ã€‚è¶Šæ—©å‘ç°é”™è¯¯ï¼Œå¤„ç†é”™è¯¯çš„æˆæœ¬è¶Šä½</li><li>è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚äººç±»æ¯”æœºå™¨å®¹æ˜“çŠ¯é”™, è€Œä¸”æœºå™¨æ“…é•¿åšé‡å¤çš„äº‹æƒ…</li></ul><p><br></p><p><strong>å¯¹äºæŒç»­é›†æˆè§„èŒƒä¸€èˆ¬ä¼šå®šä¹‰è¿™äº›å†…å®¹</strong>:</p><ul><li>æ‰§è¡Œçš„ç¯å¢ƒ. æ¯”å¦‚å®¹å™¨ã€Nodeç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç­‰ç­‰</li><li>è§¦å‘çš„æ¡ä»¶ã€‚æ¯”å¦‚å®šæ—¶è§¦å‘ã€åœ¨å“ªä¸ªåˆ†æ”¯è§¦å‘ã€ä¼šè§¦å‘ä»€ä¹ˆä»»åŠ¡ç­‰ç­‰</li><li>æ‰§è¡Œçš„ä»»åŠ¡</li><li>åˆ’åˆ†æŒç»­é›†æˆçš„é˜¶æ®µ. æ¯”å¦‚<ul><li>æ£€æŸ¥ï¼šåŒ…æ‹¬å•å…ƒæµ‹è¯•å’Œä»£ç lint. æ‰€æœ‰pushåˆ°ç‰ˆæœ¬åº“çš„ä»£ç éƒ½ä¼šè·‘è¿™ä¸ªé˜¶æ®µ. ä¸€èˆ¬å¯ä»¥åœ¨æäº¤titleä¸­åŒ…å«[ci skip]æ¥è·³è¿‡è¿™ä¸ªé˜¶æ®µ</li><li>æ„å»º: å¯¹å‰ç«¯é¡¹ç›®è¿›è¡Œæ„å»º. åªæœ‰æ‰“ä¸Šç‰ˆæœ¬tagçš„æäº¤æˆ–releaseåˆ†æ”¯ä¼šè·‘æ„å»ºä»»åŠ¡</li><li>å‘å¸ƒ: å°†å‰ç«¯çš„æ„å»ºç»“æœè¿›è¡Œäº¤ä»˜/å‘å¸ƒ.  åªæœ‰æ‰“ä¸Šç‰ˆæœ¬tagçš„æäº¤æˆ–è€…releaseåˆ†æ”¯åœ¨æ„å»ºæˆåŠŸåä¼šè·‘å‘å¸ƒä»»åŠ¡</li></ul></li><li>å®šä¹‰æŒç»­é›†æˆè„šæœ¬æ¨¡æ¿</li></ul><p><br></p><p>å¸¸ç”¨çš„CIæœåŠ¡:</p><ul><li>Github<ul><li><a href="https://github.com/marketplace/travis-ci" target="_blank" rel="noopener">Travis CI</a></li><li><a href="https://github.com/marketplace/circleci" target="_blank" rel="noopener">CircleCI</a></li><li><a href="https://github.com/marketplace/category/continuous-integration" target="_blank" rel="noopener">å®Œæ•´åˆ—è¡¨</a></li></ul></li><li>GitLab: <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener">Gitlab-CI</a></li><li>é€šç”¨<ul><li><a href="https://jenkins.io" target="_blank" rel="noopener">Jenkins</a></li></ul></li></ul><p><br></p><p>æ‰©å±•</p><ul><li><a href="https://juejin.im/post/58f9ee860ce46300611be392" target="_blank" rel="noopener">æŒç»­é›†æˆæ˜¯ä»€ä¹ˆ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="1-5-ä»»åŠ¡ç®¡ç†"><a href="#1-5-ä»»åŠ¡ç®¡ç†" class="headerlink" title="1.5 ä»»åŠ¡ç®¡ç†"></a>1.5 ä»»åŠ¡ç®¡ç†</h3><p><img src="/images/frontend-standard/kanban.png" alt></p><p>ä½œä¸ºå‰ç«¯Leaderå°‘ä¸äº†ä»»åŠ¡ç®¡ç†ã€‚<strong>çœ‹æ¿æ˜¯ç›®å‰æœ€ä¸ºæµè¡Œçš„ä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£é¡¹ç›®çš„è¿›åº¦ã€èµ„æºçš„åˆ†é…æƒ…å†µã€è¿˜åŸå¼€å‘ç°åœº</strong>.</p><p>ç¬”è€…æ¯•ä¸šç¬¬ä¸€å¹´åœ¨ä¸€å®¶å¾ˆå°çš„å¤–åŒ…å…¬å¸ä¸­å·¥ä½œï¼Œåˆç”Ÿç‰›çŠŠä¸æ€•è™ï¼Œæˆ‘ç«Ÿç„¶ç»™è€æ¿æ¨é”€èµ·äº†çœ‹æ¿å’Œæ•æ·é¡¹ç›®ç®¡ç†ï¼Œæƒ³è¦æ”¹å–„é¡¹ç›®ç®¡ç†è¿™å—æ•ˆç‡ä½ä¸‹é—®é¢˜ï¼Œè€æ¿è¡¨ç¤ºå¾ˆæ”¯æŒï¼Œä½†æ˜¯å…¶ä»–æˆå‘˜ç§¯ææ€§å¹¶ä¸é«˜, ç»“æœå½“ç„¶æ˜¯å¤±è´¥çš„ã€‚</p><p>å½“æ—¶è¿˜èµ·è‰äº†ä¸€ä»½<a href="https://github.com/ivan-94/kanban_enforcement/blob/master/README.md#%E4%BB%80%E4%B9%88%E6%98%AF%E7%9C%8B%E6%9D%BF" target="_blank" rel="noopener">â€˜çœ‹æ¿å®æ–½ç»†åˆ™â€™</a>, æ‰€ä»¥ä»»åŠ¡ç®¡ç†è¿™ä¸€å—ä¹Ÿç®—å°æœ‰å¿ƒå¾—å§.</p><p>è¯´è¯´ä¸€äº›æ¯”è¾ƒå¥½ç”¨çš„å·¥å…·å§ï¼š</p><ul><li><strong>åŸºäºissueçœ‹æ¿</strong> - å¯ä»¥åŸºäºGitlabæˆ–Githubçš„Issueæ¥åšä»»åŠ¡ç®¡ç†ï¼Œå®ƒä»¬éƒ½æ”¯æŒçœ‹æ¿ã€‚å¾ˆGeekï¼Œæ¨è</li><li><a href="https://tower.im/" target="_blank" rel="noopener"><strong>Tower</strong></a> - ä¸“é—¨åšçœ‹æ¿ä»»åŠ¡ç®¡ç†çš„ã€‚å°å›¢é˜ŸåŸºæœ¬å¤Ÿç”¨ã€‚æˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨è¿™æ¬¾äº§å“</li><li><a href="https://www.teambition.com/" target="_blank" rel="noopener"><strong>teambition</strong></a> - å’ŒTowerå·®ä¸å¤šï¼Œæ²¡æœ‰æ·±å…¥ä½¿ç”¨è¿‡</li><li><a href="https://trello.com/" target="_blank" rel="noopener"><strong>Trello</strong></a> - é¢œå€¼é«˜.</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="2-æŠ€æœ¯æ ˆè§„èŒƒ"><a href="#2-æŠ€æœ¯æ ˆè§„èŒƒ" class="headerlink" title="2 æŠ€æœ¯æ ˆè§„èŒƒ"></a>2 æŠ€æœ¯æ ˆè§„èŒƒ</h2><p>ç¬”è€…ç°åœ¨æ‰€åœ¨çš„å…¬å¸ä¹‹å‰å‰ç«¯æŠ€æœ¯æ ˆå°±éå¸¸æ··ä¹±ï¼ŒVueã€Reactå’ŒAngularJSä¸‰å¤§æ¡†æ¶éƒ½æœ‰, è€Œä¸”é£æ ¼ç›¸å·®ä¹Ÿå¾ˆå¤§. å½“æ—¶æˆ‘å°±æƒ³æ”¶åŒ…è£¹èµ°äºº. å…³äºæŠ€æœ¯æ ˆä¸è§„èŒƒçš„ä¸‹åœºå¯ä»¥å‚è€ƒå°åº¦çš„é£æœº: <a href="https://www.zhihu.com/question/26042167/answer/690035402" target="_blank" rel="noopener">&lt;ä¸ºä»€ä¹ˆå°åº¦çš„é£æœºé¢‘ç¹è¢«æ‘”ï¼Ÿ&gt;</a></p><p>å¾ˆå°‘æœ‰äººèƒ½ç²¾é€šè¿™ä¸‰ä¸ªæ¡†æ¶çš„ï¼Œæ›´åˆ«è¯´æ˜¯ä¸€ä¸ªå›¢é˜Ÿã€‚</p><p><strong>ä¸‰å¤§æ¡†æ¶è·Ÿç¼–ç¨‹è¯­è¨€ä¸€æ ·éƒ½æœ‰è‡ªå·±çš„è®¾è®¡å“²å­¦ï¼Œè¿™è·Ÿåº“æ˜¯ä¸ä¸€æ ·, ä¸€ä¸ªåº“çš„æ›¿æ¢æˆæœ¬å¾ˆä½ï¼›è€Œæ¡†æ¶çš„èƒŒåæ˜¯ä¸€ä¸ªæ¶æ„ã€ä¸€ä¸ªç”Ÿæ€ã€‚æ¯ä¸ªæ¡†æ¶èƒŒåç‰µæ¶‰ç€å¼€å‘æ€ç»´ã€ç”Ÿæ€ç³»ç»Ÿã€é…å¥—å·¥å…·ã€æœ€ä½³å®è·µã€æ€§èƒ½è°ƒä¼˜ã€‚è¦ç²¾é€šå’Œç†Ÿç»ƒä¸€ä¸ªæ¡†æ¶éœ€è¦ä»˜å‡ºçš„æˆæœ¬æ˜¯å¾ˆé«˜</strong>ã€‚</p><p><strong>æ‰€ä»¥è¯´å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡æ˜¯åŸºäºç¨³å®šä¸”ç†Ÿç»ƒçš„æŠ€æœ¯æ ˆçš„</strong>ã€‚ç¨³å®šçš„æŠ€æœ¯æ ˆè§„èŒƒæœ‰åˆ©äºå›¢é˜Ÿåä½œå’Œæ²Ÿé€š; å¦å¤–å¦‚æœå›¢é˜Ÿç²¾é€šè¿™ä¸ªæŠ€æœ¯æ ˆï¼Œå½“å‡ºç°é—®é¢˜æˆ–è€…éœ€è¦æ·±å…¥è°ƒä¼˜, ä¼šç›¸å¯¹è½»æ¾ã€‚</p><p>å‰ç«¯æŠ€æœ¯æ ˆè§„èŒƒä¸»è¦åŒ…å«ä¸‹é¢è¿™äº›ç±»å‹:</p><ul><li>ç¼–ç¨‹è¯­è¨€ - Typescriptæˆ–Javascript</li><li>UIæ¡†æ¶åŠå…¶é…å¥—ç”Ÿæ€, ä»¥åŠå¤‡é€‰æ–¹æ¡ˆã€‚å…¶èƒŒåçš„ç”Ÿæ€éå¸¸åºå¤§:<ul><li>UIæ¡†æ¶</li><li>è·¯ç”±</li><li>çŠ¶æ€ç®¡ç†</li><li>ç»„ä»¶åº“</li><li>å›½é™…åŒ–</li><li>åŠ¨ç”»</li><li>æœåŠ¡ç«¯æ¸²æŸ“</li><li>è„šæ‰‹æ¶ã€CLIå·¥å…·</li><li>ç»„ä»¶æµ‹è¯•</li></ul></li><li>æ ·å¼. åŒ…å«äº†å‘½åè§„èŒƒã€é¢„å¤„ç†å™¨ã€æ–¹æ³•è®ºç­‰ç­‰</li><li>åŠ¨ç”»å¼•æ“</li><li>QA. åŒ…å«äº†æµ‹è¯•ã€Lintã€æ ¼å¼åŒ–å·¥å…·ã€ç›‘æ§</li><li>é¡¹ç›®æ„å»ºå·¥å…·æµ. ä¾‹å¦‚webpackã€vue-cli</li><li>åŒ…ç®¡ç†å™¨ã€‚npmã€yarn</li><li>é¡¹ç›®ç®¡ç†å·¥å…·</li><li>æ—¶é—´å¤„ç†ã€‚ä¾‹å¦‚Moment.js</li><li>æ¨¡æ¿å¼•æ“</li><li>å¼€å‘å·¥å…·</li><li>åç«¯å¼€å‘æ¡†æ¶</li><li>å·¥å…·åº“</li><li>å¼€å‘/è°ƒè¯•å·¥å…·</li><li>ç­‰ç­‰</li></ul><p>å¯ä»¥å‚è€ƒä¸€ä¸‹æˆ‘ä»¬å›¢é˜Ÿçš„<a href="https://github.com/GDJiaMi/frontend-standards/blob/master/tech-stack.md" target="_blank" rel="noopener">æŠ€æœ¯æ ˆè§„èŒƒ</a></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-1-æŠ€æœ¯é€‰å‹"><a href="#2-1-æŠ€æœ¯é€‰å‹" class="headerlink" title="2.1 æŠ€æœ¯é€‰å‹"></a>2.1 æŠ€æœ¯é€‰å‹</h3><p><a id="tech-select"></a></p><p><strong>å¦‚ä½•ä»é›¶å¯¹å›¢é˜Ÿçš„æŠ€æœ¯æ ˆè¿›è¡Œè§„èŒƒ, æˆ–è€…è¯´æ€ä¹ˆè¿›è¡Œé€‰å‹å‘¢</strong>ï¼Ÿä¸¾ä¸ªä¾‹å­, å…ˆç¡®å®šå¤‡é€‰é¡¹, ä½ ç°åœ¨è¦é€‰Vueè¿˜æ˜¯é€‰React(ä¸€ä¸ªå¯èƒ½å¼•èµ·è®ºæˆ˜çš„ä¸»é¢˜)ï¼Ÿ</p><p>æ°å¥½å‰å‡ å¤©åœ¨SegmentFaultå›ç­”äº†ä¸€ä¸ªé—®é¢˜: <a href="https://segmentfault.com/q/1010000019762657/a-1020000019775888" target="_blank" rel="noopener">&lt;ä»€ä¹ˆæ—¶å€™ç”¨vueä»€ä¹ˆæ—¶å€™ç”¨reactï¼Ÿ&gt;</a>, æˆ‘è®²äº†ä¸€ä¸ªæˆ‘ä»¬<strong>å‡ å¹´å‰</strong>æ˜¯å¦‚ä½•å†³å®šè¦ä½¿ç”¨Reactè¿˜æ˜¯Vueçš„ä¾‹å­(æ³¨æ„ç»“æœä¸é‡è¦ï¼)ï¼š</p><p><img src="/images/frontend-standard/vue-vs-react.png" alt></p><p><br></p><p><a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">&lt;è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹&gt;</a>è¿™ç¯‡æ–‡ç« å†™å¾—éå¸¸å¥½ï¼Œç»™äº†æˆ‘ä¸€äº›å¯å‘ã€‚ç»“åˆä¸Šé¢çš„å›ç­”çš„ä¾‹å­, æ¥è®²ä¸€è®²åœ¨å¯¹ç›¸å…³æŠ€æœ¯è¿›è¡Œé€‰å‹çš„ä¸€äº›æ–¹æ³•(è¯„åˆ†é¡¹):</p><ul><li><p><strong>é€‰æ‹©ä½ æœ€ç†Ÿæ‚‰çš„æŠ€æœ¯</strong>ã€‚ä¸Šé¢è¯´åˆ°å›¢é˜Ÿå¦‚æœç†Ÿæ‚‰è¯¥æŠ€æœ¯ï¼Œåˆ™å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ä½¿ç”¨è¿‡ç¨‹ä¸­çš„é£é™©ï¼Œæ–¹ä¾¿å¯¹ç¨‹åºè¿›è¡Œè°ƒä¼˜ã€‚æ‰€ä»¥æˆå‘˜ç†Ÿæ‚‰ã€æˆ–è‡³å°‘Leaderç†Ÿæ‚‰ç¨‹åº¦ï¼Œæ˜¯æŠ€æœ¯é€‰å‹çš„ä¸€ä¸ªæ‰“åˆ†é¡¹ã€‚</p><p>æˆ‘ä»¬å›¢é˜Ÿæœ€ç»ˆé€‰æ‹©Reactçš„ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰å®ƒï¼Œå®ƒå·²ç»åœ¨ç°æœ‰çš„å‡ ä¸ªåº”ç”¨ä¸­è‰¯å¥½çš„è¿è¡Œäº†ï¼Œæ‰€ä»¥ React + 1</p></li><li><p><strong>é€‰æ‹©æ‹¥æœ‰å¼ºå¤§ç”Ÿæ€å’Œç¤¾åŒºæ”¯æ’‘çš„å¼€æºæŠ€æœ¯</strong>ã€‚æœ‰å¼ºå¤§çš„ç”Ÿæ€å’Œç¤¾åŒºæ„å‘³ç€ï¼Œå¾ˆå¤šä¸œè¥¿ä½ ä¸éœ€è¦é‡å¤å»é€ è½®å­ï¼Œæˆ–è€…é‡åˆ°é—®é¢˜å¯ä»¥å¾ˆå¿«è§£å†³ï¼Œæœ‰æ›´å¤šçš„é€‰æ‹©ã€‚ä»å…¬å¸å±‚é¢ã€ä½¿ç”¨æ´»è·ƒçš„æŠ€æœ¯ä¹Ÿæ¯”è¾ƒå¥½æ‹›äººã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¹Ÿæåˆ°äº†è¿™ç‚¹ï¼Œå‡ å¹´å‰Reactçš„ç”Ÿæ€æ˜¯å¼ºäºVueçš„ï¼Œæ‰€ä»¥ React + 1</p></li><li><p><strong>é€‰æ‹©æˆé•¿æœŸçš„æŠ€æœ¯</strong>ã€‚<a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">&lt;è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹&gt;</a>é‡Œé¢æœ‰ä¸€å¥è¯ï¼šâ€™é€‰æ‹©ä¸€ä¸ªæŠ€æœ¯çš„æœ€ä½æ ‡å‡†æ˜¯ï¼ŒæŠ€æœ¯çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»æ˜¾è‘—é•¿äºé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸâ€™</p><p> æˆ‘ä»¬é€‰æ‹©çš„æŠ€æœ¯åº”è¯¥æ˜¯å‘å‰å‘å±•çš„ã€é¢å‘æœªæ¥çš„, è¿™æ˜¯é€‰å‹çš„åŸºæœ¬åŸåˆ™ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šå»é€‰æ‹©é‚£äº›â€™è¿‡æ°”â€™çš„æŠ€æœ¯ï¼Œæ¯”å¦‚<code>AngularJS</code>(1.x)ã€<code>Backbone</code>. å› ä¸ºç°åœ¨æœ‰æ›´å¥½çš„é€‰æ‹©ï¼Œä¸å¿…è¿‡äºä¿å®ˆã€‚</p><p> â€˜å‘å‰â€™è¿˜æ„å‘³ç€Leaderè¦èƒ½å¤Ÿé¢„åˆ¤è¯¥æŠ€æœ¯æœªæ¥èµ°å‘ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‚è€ƒå› ç´ ï¼Œæ¯”å¦‚å¤§å‚çš„æ”¯æ’‘ã€ç›®å‰ç¤¾åŒºçš„æ´»è·ƒåº¦ã€å¼€å‘æ´»è·ƒåº¦ç­‰ç­‰</p><p> Reactã€Vueéƒ½éå¸¸æœ‰åŠ¨åŠ›ï¼Œæ¯”å¦‚Reactæœ€è¿‘çš„React Hookã€è¿˜æœ‰æœªæ¥çš„ConcurrentModeã€Async Renderingâ€¦ åœ¨è¿™ç‚¹ä¸ŠVueå’ŒReactæ‰“æˆå¹³æ‰‹å§</p></li><li><p><strong>APIçš„ç¨³å®šæ€§</strong>ã€‚æ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯Angularå’ŒPythonï¼ŒAPIä¸ç¨³å®šä¼šå¯¼è‡´ç¤¾åŒºçš„å‰²è£‚ï¼Œä¹Ÿä¼šå¯¼è‡´é¡¹ç›®å‡çº§æˆæœ¬å˜é«˜ã€æˆ–è€…æ— æ³•å‡çº§, æœ€ç»ˆæˆä¸ºæŠ€æœ¯å€ºã€‚</p><p>ä¸è¿‡å€¼å¾—åº†å¹¸çš„æ˜¯å› ä¸ºæœ‰è¿™ä¹ˆå¤šå†å²æ•™è®­ï¼Œç°åœ¨å¼€æºé¡¹ç›®åœ¨APIå˜æ›´ä¸Šé¢æ˜¯éå¸¸è°¨æ…çš„ï¼Œå‚è€ƒ<a href="https://juejin.im/post/5d0f64d4f265da1b67211893" target="_blank" rel="noopener">[è¯‘] Vue æœ€é»‘æš—çš„ä¸€å¤©</a>äº‹ä»¶. </p><p>è¿™ç‚¹ä¸ŠReactå’ŒVueä¾æ—§æ‰“å¹³</p></li><li><p><strong>åŸºç¡€è®¾æ–½é…åˆ</strong>ã€‚ä¸€ä¸ªæŠ€æœ¯å¾€å¾€ä¸æ˜¯å­¤ç«‹å­˜åœ¨çš„ï¼Œå®ƒéœ€è¦å’Œå…¶ä»–æŠ€æœ¯ç›¸äº’é…åˆï¼Œè¿™ç§æŠ€æœ¯ä¹‹é—´çš„èåˆåº¦ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ã€‚</p><p>è¿™ä¸ªæ ¹æ®å›¢é˜Ÿä½¿ç”¨æƒ…å†µæ¥å®šï¼Œæ¯”å¦‚æˆ‘ä»¬å›¢é˜Ÿç»Ÿä¸€ä½¿ç”¨Typescriptï¼ŒVueè·ŸTypescripté…åˆä½¿ç”¨å…¶å®ä¸ç†æƒ³ï¼Œæ‰€ä»¥ React + 1</p></li><li><p><strong>ä¸šåŠ¡è€ƒè™‘</strong> <a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">&lt;è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹&gt;</a> æåˆ°ä¸€ç‚¹å°±æ˜¯â€˜å­¦ä¼šä»ä¸šåŠ¡ç«¯å¼€å§‹æ€è€ƒâ€™. æ„æ€<strong>å°±æ˜¯é€‰å‹éœ€è¦å……åˆ†åœ°ç†è§£ä¸šåŠ¡ï¼Œç†è§£ç”¨æˆ·éœ€æ±‚ï¼Œå½“ä¸‹éœ€è¦è§£å†³çš„é¦–è¦é—®é¢˜ï¼Œä»¥åŠå¯èƒ½çš„é£é™©æœ‰å“ªäº›ï¼Œå†å°†ç›®æ ‡è¿›è¡Œåˆ†è§£ï¼Œè¿›è¡Œå…·ä½“çš„æŠ€æœ¯é€‰å‹ã€æ¨¡å‹è®¾è®¡ã€æ¶æ„è®¾è®¡</strong>.</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯10å¹´å‰ç«éä¸–ç•Œçš„<code>Rails</code>, åç«¯æ˜¯ä½¿ç”¨Railsè¿˜æ˜¯Java/C#/PHPè¿™äº›ä¼ ç»Ÿåç«¯æŠ€æœ¯? å¾ˆå¤šåˆåˆ›å…¬å¸(å¦‚Githubã€Gitlabã€Twitter)é€‰æ‹©äº†å‰è€…ï¼Œä»–ä»¬éœ€è¦å¿«é€Ÿå¼€å‘åŸå‹ã€å¿«é€Ÿå é¢†å¸‚åœº, Railså¼€å‘å¾ˆçˆ½å¾ˆå¿«å•Š, è¿™ç§é€‰å‹å°±æ˜¯ç¬¦åˆâ€˜ä¸šåŠ¡éœ€æ±‚çš„â€™ã€‚</p><p>é‚£ä¹ˆå‰ç«¯å¥½åƒè·Ÿä¸šåŠ¡ç¦»å¾—æœ‰ç‚¹è¿œ? éšç€â€˜å¤§å‰ç«¯â€™çš„å‘å±•ï¼Œæˆ‘ä»¬çš„å·¥ä½œå¯¹å…¬å¸ä¸šåŠ¡çš„å½±å“åªä¼šè¶Šæ¥è¶Šå¤§ã€‚</p><p>æ¯”å¦‚ä¸Šé¢æåˆ°çš„React Nativeï¼Œæˆ‘ä»¬å½“æ—¶æœ‰è€ƒè™‘åœ¨ç§»åŠ¨ç«¯åº”ç”¨React NativeæŠ€æœ¯ï¼Œå®ç°å®¢æˆ·ç«¯çš„è·¨å¹³å°ï¼Œè¿™å°±æ˜¯ä¸šåŠ¡å½±å“å•Šã€‚è¿™æ—¶å€™Reactæ˜¯ä¸æ˜¯åˆè¦ +1? åŒç†è¿˜æœ‰ä»€ä¹ˆæœåŠ¡ç«¯æ¸²æŸ“ã€Serverlessç­‰ç­‰ï¼ŒæœŸå¾…å‰ç«¯çš„åœ°ä½ä¼šè¶Šæ¥è¶Šé«˜</p></li></ul><p>ç»¼ä¸Šï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒReactæ˜¯èƒœå‡ºçš„ã€‚</p><p>æ‰©å±•:</p><ul><li><a href="https://www.infoq.cn/article/2017/02/Technology-selection" target="_blank" rel="noopener">è°ˆè°ˆæŠ€æœ¯é€‰å‹</a></li><li><a href="https://www.infoq.cn/article/points-for-attention-with-technology-choice" target="_blank" rel="noopener">è°ˆè°ˆæŠ€æœ¯é€‰å‹çš„æ³¨æ„äº‹é¡¹</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="2-2-è¿æ¥æ–°æŠ€æœ¯"><a href="#2-2-è¿æ¥æ–°æŠ€æœ¯" class="headerlink" title="2.2 è¿æ¥æ–°æŠ€æœ¯"></a>2.2 è¿æ¥æ–°æŠ€æœ¯</h3><p>å½“ç„¶ï¼Œå¯¹äºå›¢é˜Ÿè€Œè¨€ä¹Ÿè¦é¼“åŠ±å­¦ä¹ æ–°çš„æŠ€æœ¯ã€æ·˜æ±°æ—§çš„æŠ€æœ¯æ ˆã€‚å› ä¸ºä¸€èˆ¬è€Œè¨€æ–°çš„æŠ€æœ¯æˆ–è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸ºäº†æ›´é«˜çš„ç”Ÿäº§åŠ›è€Œè¯ç”Ÿçš„ã€‚<strong>å½“å›¢é˜Ÿå®¹çº³ä¸€ä¸ªæ–°çš„æŠ€æœ¯é€‰å‹éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹</strong>ï¼š</p><ul><li><strong>å­¦ä¹ æˆæœ¬</strong>ã€‚è€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„æ¥çº³èƒ½åŠ›ã€‚å¦‚æœæˆæœ¬å°äºæ”¶è·çš„åˆ©ç›Šï¼Œåœ¨å›¢é˜Ÿé‡Œé¢æ¨è¡Œä¼°è®¡é˜»åŠ›ä¼šæ¯”è¾ƒå¤§</li><li><strong>æ”¶ç›Š</strong>ã€‚æ˜¯å¦èƒ½å¤Ÿè§£å†³å½“å‰çš„æŸäº›ç—›ç‚¹</li><li><strong>è€ƒè™‘é£é™©</strong>ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¸èƒ½å°†ä¸€ä¸ªå®éªŒé˜¶æ®µçš„æŠ€æœ¯ä½¿ç”¨çš„ç”Ÿäº§ç¯å¢ƒä¸­</li></ul><p>å°±æˆ‘ä»¬å›¢é˜Ÿè€Œè¨€ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æœ‰è‡ªå·±æ„Ÿå…´è¶£çš„æ–¹å‘å’Œé¢†åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†å·¥åˆä½œï¼Œæ¢ç´¢å„è‡ªçš„é¢†åŸŸï¼Œå†å°†æˆæœåˆ†äº«å‡ºæ¥ï¼Œå¦‚æœé è°±çš„è¯åˆ™å¯ä»¥åœ¨å®éªŒé¡¹ç›®ä¸­å…ˆè¯•éªŒä¸€ä¸‹ï¼Œæœ€åæ‰æ¨å¹¿åˆ°å…¶ä»–é¡¹ç›®.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="3-æµè§ˆå™¨å…¼å®¹è§„èŒƒ"><a href="#3-æµè§ˆå™¨å…¼å®¹è§„èŒƒ" class="headerlink" title="3 æµè§ˆå™¨å…¼å®¹è§„èŒƒ"></a>3 æµè§ˆå™¨å…¼å®¹è§„èŒƒ</h2><p>å‰ç«¯å›¢é˜Ÿåº”è¯¥æ ¹æ®é’ˆå¯¹åº”ç”¨æ‰€é¢å¯¹çš„ç”¨æˆ·æƒ…å†µã€åº”ç”¨ç±»å‹ã€å¼€å‘æˆæœ¬ã€æµè§ˆå™¨å¸‚åœºç»Ÿè®¡æ•°æ®ç­‰å› ç´ ï¼Œæ¥åˆ¶å®šè‡ªå·±çš„æµè§ˆå™¨å…¼å®¹è§„èŒƒï¼Œå¹¶å†™å…¥åº”ç”¨ä½¿ç”¨æ‰‹å†Œä¸­.</p><p><strong>æœ‰äº†æµè§ˆå™¨å…¼å®¹è§„èŒƒï¼Œå‰ç«¯å¼€å‘å’Œå…¼å®¹æ€§æµ‹è¯•å°±æœ‰ç†æœ‰æ®ï¼Œé¿å…äº‰è®®; åŒæ—¶å®ƒä¹Ÿæ˜¯å‰ç«¯å›¢é˜Ÿçš„ä¸€ç§å¯¹å¤–å£°æ˜ï¼Œé™¤éç‰¹æ®Šè¦æ±‚ï¼Œä¸ç¬¦åˆæµè§ˆå™¨å…¼å®¹è§„èŒƒçš„æµè§ˆå™¨ï¼Œå‰ç«¯å¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©å¿½ç•¥</strong>ã€‚</p><p><br></p><h3 id="3-1-ç¡®å®šå…¼å®¹ç­–ç•¥"><a href="#3-1-ç¡®å®šå…¼å®¹ç­–ç•¥" class="headerlink" title="3.1 ç¡®å®šå…¼å®¹ç­–ç•¥"></a>3.1 ç¡®å®šå…¼å®¹ç­–ç•¥</h3><p><img src="/images/frontend-standard/g-p.jpg" alt></p><p><strong>æ¸è¿›å¢å¼º</strong>è¿˜æ˜¯<strong>ä¼˜é›…é™çº§</strong>. è¿™æ˜¯ä¸¤ä¸ªä¸åŒæ–¹å‘ç­–ç•¥ï¼Œ<strong>æ¸è¿›å¢å¼ºä¿è¯ä½ç‰ˆæœ¬æµè§ˆå™¨çš„ä½“éªŒï¼Œå¯¹äºæ”¯æŒæ–°ç‰¹æ€§çš„æ–°æµè§ˆå™¨æä¾›ç¨å¥½çš„ä½“éªŒ</strong>ï¼›<strong>ä¼˜é›…é™çº§åˆ™æ˜¯ç›¸åçš„ï¼Œä¸ºç°ä»£æµè§ˆå™¨æä¾›æœ€å¥½çš„ä½“éªŒï¼Œè€Œæ—§æµè§ˆå™¨åˆ™é€€è€Œæ±‚ä¹‹æ¬¡ï¼Œä¿è¯å¤§æ¦‚çš„åŠŸèƒ½</strong>.</p><p>é€‰æ‹©ä¸åŒçš„ç­–ç•¥å¯¹å‰ç«¯å¼€å‘çš„å½±å“æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä½†æ˜¯å¼€å‘è€…æ²¡æœ‰é€‰æ‹©æƒã€‚<strong>ç¡®å®šå“ªç§å…¼å®¹ç­–ç•¥ï¼Œåº”è¯¥å–å†³äºç”¨æˆ·æ¯”é‡ï¼Œå¦‚æœå¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨çš„æ˜¯ç°ä»£æµè§ˆå™¨ï¼Œå°±åº”è¯¥ä½¿ç”¨ä¼˜é›…é™çº§ï¼Œåä¹‹é€‰æ‹©æ¸è¿›å¢å¼º</strong>.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-2-ç¡®å®šæµè§ˆå™¨åˆ†çº§"><a href="#3-2-ç¡®å®šæµè§ˆå™¨åˆ†çº§" class="headerlink" title="3.2 ç¡®å®šæµè§ˆå™¨åˆ†çº§"></a>3.2 ç¡®å®šæµè§ˆå™¨åˆ†çº§</h3><p><img src="/images/frontend-standard/brw-levl.gif" alt></p><p>YUIå°±æ›¾æå‡ºæµè§ˆå™¨åˆ†çº§åŸåˆ™ï¼Œåˆ°ä»Šå¤©è¿™ä¸ªåŸåˆ™ä¾ç„¶é€‚ç”¨ã€‚ç®€å•è¯´å°±æ˜¯å°†æµè§ˆå™¨åˆ’åˆ†ä¸ºå¤šä¸ªç­‰çº§ï¼Œä¸åŒç­‰çº§è¡¨ç¤ºä¸åŒçš„æ”¯æŒç¨‹åº¦. æ¯”å¦‚æˆ‘ä»¬å›¢é˜Ÿå°±å°†æµè§ˆå™¨åˆ’åˆ†ä¸ºä»¥ä¸‹<a href="https://github.com/GDJiaMi/frontend-standards/blob/master/browser-compatibility.md" target="_blank" rel="noopener">ä¸‰ä¸ªç­‰çº§</a>:</p><ul><li><strong>å®Œå…¨å…¼å®¹</strong>: ä¿è¯ç™¾åˆ†ç™¾åŠŸèƒ½æ­£å¸¸</li><li><strong>éƒ¨åˆ†å…¼å®¹</strong>: åªèƒ½ä¿è¯åŠŸèƒ½ã€æ ·å¼ä¸éœ€æ±‚å¤§è‡´ä¸€è‡´ã€‚å¯¹äºä¸€äº›ä¸å½±å“ä¸»ä½“éœ€æ±‚å’ŒåŠŸèƒ½çš„bugï¼Œä¼šåšé™ä½ä¼˜å…ˆçº§å¤„ç†æˆ–è€…ä¸å¤„ç†ã€‚</li><li><strong>ä¸å…¼å®¹</strong>: ä¸è€ƒè™‘å…¼å®¹æ€§</li></ul><p>ä¸€èˆ¬è€Œè¨€, æ ¹æ®æµè§ˆå™¨å¸‚åœºåˆ†å¸ƒæƒ…å†µã€ç”¨æˆ·å æ¯”ã€å¼€å‘æˆæœ¬ç­‰å› ç´ åˆ’åˆ†ç­‰çº§.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å¯¹ç®¡ç†ç³»ç»Ÿçš„å…¼å®¹è§„èŒƒ:</p><p><img src="/images/frontend-standard/cpt.png" alt></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="3-3-è·å–ç»Ÿè®¡æ•°æ®"><a href="#3-3-è·å–ç»Ÿè®¡æ•°æ®" class="headerlink" title="3.3 è·å–ç»Ÿè®¡æ•°æ®"></a>3.3 è·å–ç»Ÿè®¡æ•°æ®</h3><p><a id="brw-anly"></a></p><p><img src="/images/frontend-standard/bdtj.png" alt></p><p><br></p><p><a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">ç™¾åº¦ç»Ÿè®¡</a>æ˜¯ä¸­æ–‡ç½‘ç«™ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ã€å…è´¹çš„æµé‡åˆ†æå¹³å°. å¦‚ä¸Šå›¾ï¼Œé€šè¿‡è¿™äº›ç»Ÿè®¡å¹³å°å¯ä»¥è·å–åˆ°ç»ˆç«¯çœŸå®çš„æµè§ˆå™¨ä½¿ç”¨æƒ…å†µ, ç‚¹å‡»<a href="https://tongji.baidu.com/web/demo/visit/client?siteId=5503017" target="_blank" rel="noopener">æŸ¥çœ‹ç¤ºä¾‹</a>ã€‚</p><p>å¦‚æœå…¬å¸æ²¡æœ‰å¼€å‘è‡ªå·±ç›‘æ§æœåŠ¡ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨è¿™äº›å…è´¹çš„ï¼Œæœ‰å¤§å‚æ”¯æŒçš„ç›‘æ§å·¥å…·:</p><ul><li><a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">ç™¾åº¦ç»Ÿè®¡</a></li><li><a href="https://web.umeng.com/main.php?spm=a211g2.211692.0.0.3a437d23sjzEPv&amp;c=user&amp;a=index" target="_blank" rel="noopener">å‹ç›Ÿ</a></li><li><a href="https://analytics.google.com/analytics/web/" target="_blank" rel="noopener">Google Analytics</a> éœ€è¦kxä¸Šç½‘</li></ul><p><br></p><p><strong>å¯ä»¥ä»è¿™äº›åœ°æ–¹è·å–é€šç”¨çš„æµè§ˆå™¨ç»Ÿè®¡æ•°æ®</strong>:</p><ul><li><a href="http://tongji.baidu.com/data/browser" target="_blank" rel="noopener">ç™¾åº¦æµé‡ç ”ç©¶é™¢</a>ï¼šä¸»è¦æä¾›å›½å†…æµè§ˆå™¨ç»Ÿè®¡</li><li><a href="http://gs.statcounter.com/" target="_blank" rel="noopener">statcounter</a>: å›½é™…æµè§ˆå™¨ç»Ÿè®¡</li><li><a href="https://en.wikipedia.org/wiki/Timeline_of_web_browsers" target="_blank" rel="noopener">æµè§ˆå™¨å‘å¸ƒå¹´ä»½ç»Ÿè®¡</a></li></ul><p><br></p><p><strong>ç¡®å®šæµè§ˆå™¨æ˜¯å¦æ”¯æŒæŸä¸ªç‰¹æ€§</strong>:</p><ul><li><a href="https://caniuse.com" target="_blank" rel="noopener">caniuse</a></li><li><a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener">MDN</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="4-é¡¹ç›®ç»„ç»‡è§„èŒƒ"><a href="#4-é¡¹ç›®ç»„ç»‡è§„èŒƒ" class="headerlink" title="4 é¡¹ç›®ç»„ç»‡è§„èŒƒ"></a>4 é¡¹ç›®ç»„ç»‡è§„èŒƒ</h2><p>é¡¹ç›®ç»„ç»‡è§„èŒƒå®šä¹‰äº†å¦‚ä½•ç»„ç»‡ä¸€ä¸ªå‰ç«¯é¡¹ç›®, ä¾‹å¦‚é¡¹ç›®çš„å‘½åã€é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ã€ç‰ˆæœ¬å·è§„èŒƒç­‰ç­‰ã€‚å°¤å…¶å¯¹äºå¼€æºé¡¹ç›®ï¼Œè§„èŒƒåŒ–çš„é¡¹ç›®ç»„ç»‡å°±æ›´é‡è¦äº†ã€‚</p><h3 id="4-1-é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ"><a href="#4-1-é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ" class="headerlink" title="4.1 é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ"></a>4.1 é€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒ</h3><p>ä¸€ä¸ªå…¸å‹çš„é¡¹ç›®ç»„ç»‡è§„èŒƒå¦‚ä¸‹:</p><ul><li><strong>README.md</strong>: é¡¹ç›®è¯´æ˜, è¿™ä¸ªæ˜¯æœ€é‡è¦ã€‚ä½ å¿…é¡»åœ¨è¿™é‡Œæä¾›å…³äºé¡¹ç›®çš„å…³é”®ä¿¡æ¯æˆ–è€…ç›¸å…³ä¿¡æ¯çš„å…¥å£. ä¸€èˆ¬åŒ…å«ä¸‹åˆ—ä¿¡æ¯:<ul><li>ç®€è¦æè¿°ã€é¡¹ç›®ä¸»è¦ç‰¹æ€§</li><li>è¿è¡Œç¯å¢ƒ/ä¾èµ–ã€å®‰è£…å’Œæ„å»ºã€æµ‹è¯•æŒ‡å—</li><li>ç®€å•ç¤ºä¾‹ä»£ç </li><li>æ–‡æ¡£æˆ–æ–‡æ¡£å…¥å£, å…¶ä»–ç‰ˆæœ¬æˆ–ç›¸å…³èµ„æºå…¥å£</li><li>è”ç³»æ–¹å¼ã€è®¨è®ºç¾¤</li><li>è®¸å¯ã€è´¡çŒ®/å¼€å‘æŒ‡å—</li></ul></li><li><strong>CHANGELOG.md</strong>: æ”¾ç½®æ¯ä¸ªç‰ˆæœ¬çš„å˜åŠ¨å†…å®¹, é€šå¸¸è¦æè¿°æ¯ä¸ªç‰ˆæœ¬å˜æ›´çš„å†…å®¹ã€‚æ–¹ä¾¿ä½¿ç”¨è€…ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬. å…³äºCHANGELOGçš„è§„èŒƒå¯ä»¥å‚è€ƒ<a href="https://keepachangelog.com/en/1.0.0/" target="_blank" rel="noopener">keep a changelog</a></li><li><strong>package.json</strong>: å‰ç«¯é¡¹ç›®å¿…é¡». æè¿°å½“å‰çš„ç‰ˆæœ¬ã€<strong>å¯ç”¨çš„å‘½ä»¤</strong>ã€åŒ…åã€ä¾èµ–ã€ç¯å¢ƒçº¦æŸã€é¡¹ç›®é…ç½®ç­‰ä¿¡æ¯.</li><li><strong>.gitignore</strong>: å¿½ç•¥ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œé¿å…å°†è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬åº“</li><li><strong>.gitattributes</strong>: gité…ç½®ï¼Œæœ‰ä¸€äº›è·¨å¹³å°å·®å¼‚çš„è¡Œä¸ºå¯èƒ½éœ€è¦åœ¨è¿™é‡Œé…ç½®ä¸€ä¸‹ï¼Œå¦‚æ¢è¡Œè§„åˆ™</li><li><strong>docs/</strong>: é¡¹ç›®çš„ç»†åŒ–æ–‡æ¡£, å¯é€‰.</li><li><strong>examples/</strong>: é¡¹ç›®çš„ç¤ºä¾‹ä»£ç ï¼Œå¯é€‰.</li><li><strong>build</strong>: é¡¹ç›®å·¥å…·ç±»è„šæœ¬æ”¾ç½®åœ¨è¿™é‡Œï¼Œéå¿…é¡»ã€‚å¦‚æœä½¿ç”¨ç»Ÿä¸€æ„å»ºå·¥å…·ï¼Œåˆ™æ²¡æœ‰è¿™ä¸ªç›®å½•</li><li><strong>dist/</strong>: é¡¹ç›®æ„å»ºç»“æœè¾“å‡ºç›®å½•</li><li><strong>src/</strong>: æºä»£ç ç›®å½•</li><li><p><strong><strong>tests</strong>/</strong>: å•å…ƒæµ‹è¯•ç›®å½•. æŒ‰ç…§<a href="http://jestjs.io" target="_blank" rel="noopener">Jest</a>è§„èŒƒ, <code>__tests__</code>ç›®å½•é€šå¸¸å’Œè¢«æµ‹è¯•çš„æ¨¡å—åœ¨åŒä¸€ä¸ªçˆ¶ç›®å½•ä¸‹, ä¾‹å¦‚:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/src</span><br><span class="line">  __tests__/</span><br><span class="line">    index.ts</span><br><span class="line">    a.ts</span><br><span class="line">  index.ts</span><br><span class="line">  a.ts</span><br></pre></td></tr></table></figure></li><li><p><strong>tests</strong>: å…¨å±€çš„æµ‹è¯•ç›®å½•ï¼Œé€šå¸¸æ”¾åº”ç”¨çš„é›†æˆæµ‹è¯•æˆ–E2Eæµ‹è¯•ç­‰ç”¨ä¾‹</p></li><li><p><strong>.env*</strong>: é¡¹ç›®ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨<code>ç¯å¢ƒå˜é‡</code>æ¥å½±å“åº”ç”¨åœ¨ä¸åŒè¿è¡Œç¯å¢ƒä¸‹çš„è¡Œä¸º. å¯ä»¥é€šè¿‡<a href="https://github.com/motdotla/dotenv" target="_blank" rel="noopener">dotEnv</a>æ¥ä»æ–‡ä»¶ä¸­è¯»å–ç¯å¢ƒå˜é‡. é€šå¸¸æœ‰ä¸‰ä¸ªæ–‡ä»¶:</p><ul><li><code>.env</code> é€šç”¨çš„ç¯å¢ƒå˜é‡</li><li><code>.env.development</code> å¼€å‘ç¯å¢ƒçš„ç¯å¢ƒå˜é‡</li><li><code>.env.production</code> ç”Ÿæˆç¯å¢ƒçš„ç¯å¢ƒå˜é‡</li></ul><p>åŸºæœ¬ä¸Šè¿™äº›æ–‡ä»¶çš„å˜åŠ¨çš„é¢‘ç‡å¾ˆå°‘ï¼Œå›¢é˜Ÿæˆå‘˜åº”è¯¥ä¸è¦éšæ„å˜åŠ¨ï¼Œä»¥å…å½±å“å…¶ä»–æˆå‘˜ã€‚æ‰€ä»¥é€šå¸¸ä¼šä½¿ç”¨<code>.env.*.local</code>æ–‡ä»¶æ¥è¦†ç›–ä¸Šè¿°çš„é…ç½®, å¦å¤–ä¼šè®¾ç½®ç‰ˆæœ¬åº“æ¥å¿½ç•¥<code>*.local</code>æ–‡ä»¶.</p></li></ul><p><br></p><p><strong>å¯¹äºå¼€æºé¡¹ç›®é€šå¸¸è¿˜åŒ…æ‹¬è¿™äº›ç›®å½•</strong>:</p><ul><li><strong>LICENSE</strong>: è¯´æ˜é¡¹ç›®è®¸å¯</li><li><strong>.github</strong>: å¼€æºè´¡çŒ®è§„èŒƒå’ŒæŒ‡å—<ul><li>CONTRIBUTING: è´¡çŒ®æŒ‡å—, è¿™é‡Œä¸€èˆ¬ä¼šè¯´æ˜è´¡çŒ®çš„è§„èŒƒã€ä»¥åŠé¡¹ç›®çš„åŸºæœ¬ç»„ç»‡ã€æ¶æ„ç­‰ä¿¡æ¯</li><li>CODE_OF_CONDUCT: è¡Œä¸ºå‡†åˆ™</li><li>COMMIT_CONVENTION: æäº¤ä¿¡æ¯è§„èŒƒï¼Œä¸Šæ–‡å·²ç»æåŠ</li><li>ISSUE_TEMPLATE: Issueçš„æ¨¡æ¿ï¼Œgithubå¯ä»¥è‡ªåŠ¨è¯†åˆ«è¿™ä¸ªæ¨¡æ¿</li><li>PULL_REQUEST_TEMPLATE: PRæ¨¡æ¿</li></ul></li></ul><p>ä»»æ„ä¸€ä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®éƒ½æ˜¯ä½ çš„è€å¸ˆï¼Œä¾‹å¦‚<a href="https://github.com/facebook/react" target="_blank" rel="noopener">React</a>ã€<a href="https://github.com/vuejs/vue" target="_blank" rel="noopener">Vue</a>â€¦</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-2-ç›®å½•ç»„ç»‡çš„é£æ ¼"><a href="#4-2-ç›®å½•ç»„ç»‡çš„é£æ ¼" class="headerlink" title="4.2 ç›®å½•ç»„ç»‡çš„é£æ ¼"></a>4.2 ç›®å½•ç»„ç»‡çš„é£æ ¼</h3><p>ä¸Šé¢åªæ˜¯ä¸€ä¸ªé€šç”¨çš„é¡¹ç›®ç»„ç»‡è§„èŒƒï¼Œå…·ä½“æºä»£ç å¦‚ä½•ç»„ç»‡è¿˜å–å†³äºä½ ä»¬ä½¿ç”¨çš„æŠ€æœ¯æ ˆå’Œå›¢é˜Ÿå–œå¥½ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œå…·ä½“å¯ä»¥æœç´¢<code>æ€ä¹ˆç»„ç»‡XXé¡¹ç›®</code>. æ€»ç»“ä¸€ä¸‹é¡¹ç›®ç»„ç»‡ä¸»è¦æœ‰ä¸‰ç§é£æ ¼:</p><ul><li><p><strong>Rails-style</strong>: æŒ‰ç…§æ–‡ä»¶çš„ç±»å‹åˆ’åˆ†ä¸ºä¸åŒçš„ç›®å½•ï¼Œä¾‹å¦‚<code>components</code>ã€<code>constants</code>ã€ <code>typings</code>ã€<code>views</code>. è¿™ä¸ªæ¥æºäºRuby-on-Railsæ¡†æ¶ï¼Œå®ƒæŒ‰ç…§MVCæ¶æ„æ¥åˆ’åˆ†ä¸åŒçš„ç›®å½•ç±»å‹ï¼Œå…¸å‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  models # æ¨¡å‹</span><br><span class="line">  views # è§†å›¾</span><br><span class="line">  controllers # æ§åˆ¶å™¨</span><br><span class="line">  helpers # å¸®åŠ©ç¨‹åº</span><br><span class="line">  assets  # é™æ€èµ„æº</span><br><span class="line">config     # é…ç½®</span><br><span class="line">  application.rb</span><br><span class="line">  database.yml</span><br><span class="line">  routes.rb      # è·¯ç”±æ§åˆ¶</span><br><span class="line">  locales        # å›½é™…åŒ–é…ç½®</span><br><span class="line">  environments/</span><br><span class="line">db        # æ•°æ®åº“ç›¸å…³</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>Domain-style</strong>:  æŒ‰ç…§ä¸€ä¸ªåŠŸèƒ½ç‰¹æ€§æˆ–ä¸šåŠ¡åˆ›å»ºå•ç‹¬çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•å°±è¿‘åŒ…å«å¤šç§ç±»å‹çš„æ–‡ä»¶æˆ–ç›®å½•. æ¯”å¦‚ä¸€ä¸ªå…¸å‹çš„Reduxé¡¹ç›®ï¼Œæ‰€æœ‰é¡¹ç›®çš„æ–‡ä»¶å°±è¿‘æ”¾ç½®åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Users/</span><br><span class="line">Home/</span><br><span class="line">  components/</span><br><span class="line">  actions.js</span><br><span class="line">  actionTypes.js</span><br><span class="line">  constants.js</span><br><span class="line">  index.js</span><br><span class="line">  model.js</span><br><span class="line">  reducer.js</span><br><span class="line">  selectors.js</span><br><span class="line">  style.css</span><br><span class="line">index.js</span><br><span class="line">rootReducer.js</span><br></pre></td></tr></table></figure></li><li><p><strong>Ducks-style</strong>: ä¼˜ç‚¹ç±»ä¼¼äºDomain-styleï¼Œä¸è¿‡æ›´å½»åº•, å®ƒé€šå¸¸å°†ç›¸å…³è”çš„å…ƒç´ å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸‹ã€‚Vueçš„å•æ–‡ä»¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œé™¤æ­¤ä¹‹å¤–Vuexä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§é£æ ¼:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;My Todo App!&lt;/h1&gt;</span><br><span class="line">    &lt;TodoList/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import TodoList from &apos;./components/TodoList.vue&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    TodoList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">@import &apos;./variables.scss&apos;;</span><br><span class="line">/* ... */</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li></ul><p><br></p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹, æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨æ··åˆä¸¤ç§æ–¹å¼çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">  components/      # ğŸ”´ é¡¹ç›®é€šç”¨çš„â€˜å±•ç¤ºç»„ä»¶â€™</span><br><span class="line">    Button/</span><br><span class="line">      index.tsx    # ç»„ä»¶çš„å…¥å£, å¯¼å‡ºç»„ä»¶</span><br><span class="line">      Groups.tsx   # å­ç»„ä»¶</span><br><span class="line">      loading.svg  # é™æ€èµ„æº</span><br><span class="line">      style.css    # ç»„ä»¶æ ·å¼</span><br><span class="line">    ...</span><br><span class="line">    index.ts       # åˆ°å¤„æ‰€æœ‰ç»„ä»¶</span><br><span class="line">  containers/      # ğŸ”´ åŒ…å«'å®¹å™¨ç»„ä»¶'å’Œ'é¡µé¢ç»„ä»¶'</span><br><span class="line">    LoginPage/     # é¡µé¢ç»„ä»¶, ä¾‹å¦‚ç™»å½•</span><br><span class="line">      components/  # é¡µé¢çº§åˆ«å±•ç¤ºç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¸èƒ½å¤ç”¨ä¸å…¶ä»–é¡µé¢ç»„ä»¶ã€‚</span><br><span class="line">        Button.tsx # ç»„ä»¶æœªå¿…æ˜¯ä¸€ä¸ªç›®å½•å½¢å¼ï¼Œå¯¹äºä¸€ä¸ªç®€å•ç»„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªå•æ–‡ä»¶å½¢å¼. ä½†è¿˜æ˜¯æ¨èä½¿ç”¨ç›®å½•ï¼Œæ–¹ä¾¿æ‰©å±•</span><br><span class="line">        Panel.tsx</span><br><span class="line">      reducer.ts   # redux reduces</span><br><span class="line">      useLogin.ts  # (å¯é€‰)æ”¾ç½®'é€»è¾‘', æŒ‰ç…§ğŸ‘†åˆ†ç¦»é€»è¾‘å’Œè§†å›¾çš„åŸåˆ™ï¼Œå°†é€»è¾‘ã€çŠ¶æ€å¤„ç†æŠ½å–åˆ°hookæ–‡ä»¶</span><br><span class="line">      types.ts     # typescript ç±»å‹å£°æ˜</span><br><span class="line">      style.css</span><br><span class="line">      logo.png</span><br><span class="line">      message.ts</span><br><span class="line">      constants.ts</span><br><span class="line">      index.tsx</span><br><span class="line">    HomePage/</span><br><span class="line">    ...</span><br><span class="line">    index.tsx      # ğŸ”´åº”ç”¨æ ¹ç»„ä»¶</span><br><span class="line">  hooks/           # ğŸ”´å¯å¤ç”¨çš„hook</span><br><span class="line">    useList.ts</span><br><span class="line">    usePromise.ts</span><br><span class="line">  ...</span><br><span class="line">  index.tsx        # åº”ç”¨å…¥å£, åœ¨è¿™é‡Œä½¿ç”¨ReactDOMå¯¹è·Ÿç»„ä»¶è¿›è¡Œæ¸²æŸ“</span><br><span class="line">  stores.ts        # redux stores</span><br><span class="line">  contants.ts      # å…¨å±€å¸¸é‡</span><br></pre></td></tr></table></figure><p><br></p><p>æ¡†æ¶å®˜æ–¹å¾ˆå°‘ä¼šå»å¹²é¢„é¡¹ç›®çš„ç»„ç»‡æ–¹å¼ï¼Œè¯»è€…å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº›èµ„æºæ¥å»ºç«‹è‡ªå·±é¡¹ç›®ç»„ç»‡è§„èŒƒ:</p><ul><li><a href="https://link.juejin.im/?target=http%3A%2F%2Fcn.redux.js.org%2Fdocs%2Ffaq%2FCodeStructure.html" target="_blank" rel="noopener">Redux å¸¸è§é—®é¢˜ï¼šä»£ç ç»“æ„</a></li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Freact-boilerplate%2Freact-boilerplate" target="_blank" rel="noopener">react-boilerplate</a></li><li><a href="https://vuex.vuejs.org/zh/guide/structure.html" target="_blank" rel="noopener">vuex é¡¹ç›®ç»“æ„</a></li><li><a href="https://juejin.im/post/5cd8fb916fb9a03218556fc1#heading-11" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“02 - ç»„ä»¶çš„ç»„ç»‡</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="4-3-è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿"><a href="#4-3-è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿" class="headerlink" title="4.3 è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿"></a>4.3 è„šæ‰‹æ¶å’Œé¡¹ç›®æ¨¡æ¿</h3><p>åœ¨å°†é¡¹ç›®ç»“æ„è§„èŒƒç¡®å®šä¸‹æ¥åï¼Œå¯ä»¥åˆ›å»ºè‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·æˆ–è€…é¡¹ç›®æ¨¡æ¿ï¼Œç”¨äºå¿«é€Ÿåˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®æˆ–ä»£ç æ¨¡æ¿ã€‚</p><p>ç›¸å…³èµ„æº:</p><ul><li><a href="https://yeoman.io" target="_blank" rel="noopener">yeoman</a> - è€ç‰Œçš„é¡¹ç›®è„šæ‰‹æ¶å·¥å…·</li><li><a href="https://github.com/amwmedia/plop" target="_blank" rel="noopener">plop</a> - ä»£ç ç”Ÿæˆè¾…åŠ©CLI</li><li><a href="https://github.com/jondot/hygen" target="_blank" rel="noopener">hygen</a> - ç±»ä¼¼äºplop</li><li><a href="https://github.com/diegohaz/generact" target="_blank" rel="noopener">generact</a> - ç”ŸæˆReactç»„ä»¶, å¤§éƒ¨åˆ†ç»„ä»¶çš„æ–‡ä»¶ç»“æ„å·®ä¸å¤š, è¿™ä¸ªå·¥å…·å°±æ˜¯å¸®åŠ©ä½ ç”Ÿæˆè¿™äº›é‡å¤çš„ä»£ç </li><li><a href="https://babeljs.io/docs/en/babel-generator" target="_blank" rel="noopener">babel-code-generator</a> - åˆ©ç”¨babelæ¥å®ç°æ›´é«˜çº§çš„ä»£ç ç¼–è¾‘å’Œè‡ªåŠ¨ç”Ÿæˆ</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="5-ç¼–ç è§„èŒƒ"><a href="#5-ç¼–ç è§„èŒƒ" class="headerlink" title="5 ç¼–ç è§„èŒƒ"></a>5 ç¼–ç è§„èŒƒ</h2><p>ç½‘ç»œä¸Šå¤§éƒ¨åˆ†â€˜å‰ç«¯è§„èŒƒâ€™æŒ‡çš„éƒ½æ˜¯ç¼–ç è§„èŒƒ, è¿™æ˜¯ä¸€ç§â€˜ç‹­ä¹‰â€™çš„å‰ç«¯è§„èŒƒ. </p><p><strong>ç»Ÿä¸€çš„ç¼–ç è§„èŒƒå¯¹å›¢é˜Ÿé¡¹ç›®çš„é•¿è¿œç»´æŠ¤ä¸æ— è£¨ç›Š. ä¸€è‡´æ€§çš„ä»£ç è§„èŒƒå¯ä»¥å¢å¼ºå›¢é˜Ÿå¼€å‘åä½œæ•ˆç‡ã€æé«˜ä»£ç è´¨é‡ã€å‡å°‘é—ç•™ç³»ç»Ÿç»´æŠ¤çš„è´Ÿæ‹…</strong>ã€‚</p><p>æœ€ç›´æ¥çš„å¥½å¤„å°±æ˜¯é¿å…å†™å‡ºç³Ÿç³•çš„ä»£ç , ç³Ÿç³•çš„ä»£ç ä¸æ–°æ‰‹å’Œè€æ‰‹å…³ç³»ä¸å¤§ï¼Œæˆ‘ä¹Ÿè§è¿‡å¥½å¤„å·¥ä½œå¾ˆå¤šå¹´çš„â€˜èµ„æ·±â€™å·¥ç¨‹å¸ˆå†™å‡ºæ¶å¿ƒçš„ä»£ç . è¿™æ ·çš„ä»£ç éšç€é¡¹ç›®çš„è¿­ä»£ä¼šå˜å¾—éš¾ä»¥æ§åˆ¶ã€‚</p><p><strong>ç°ä»£çš„Lintå·¥å…·å·²ç»éå¸¸å…ˆè¿›ï¼Œå‡ ä¹å¯ä»¥çº¦æŸå„ç§ç¼–ç è¡Œä¸º</strong>. æ¯”å¦‚çº¦æŸä¸€ä¸ªæ–‡ä»¶çš„é•¿åº¦ã€å‡½æ•°çš„å¤æ‚åº¦ã€å‘½åè§„èŒƒã€æ³¨é‡Šè§„èŒƒã€æ¥å£é»‘åå•ã€DeadCodeã€æ£€æŸ¥ç®€å•çš„é€»è¾‘é”™è¯¯â€¦</p><p>æ¯ä¸€ä¸ªç¨‹åºå‘˜å¿ƒç›®ä¸­å¯¹â€˜å¥½ä»£ç â€™éƒ½æœ‰è‡ªå·±çš„ä¸»è§ï¼Œç»Ÿä¸€çš„ç¼–ç è§„èŒƒå¯ä»¥åƒç§¦å§‹çš‡ç»Ÿä¸€æˆ˜å›½ä¸€æ ·ï¼Œé¿å…ä¸å¿…è¦çš„è®ºæˆ˜å’Œäº‰è®®ã€‚</p><p><br></p><p><strong>å…¶å®ä¸å…¶è‡ªå·±å»ºç«‹å‰ç«¯ç¼–ç è§„èŒƒï¼Œç¬”è€…æ¨èé€‰æ‹©ç¤¾åŒºæ²‰æ·€ä¸‹æ¥çš„è§„èŒƒ</strong>. è¿™æ–¹é¢çš„èµ„æºéå¸¸å¤šï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿä¸æ­¦æ–­åœ°æå‡ºè‡ªå·±çš„è§„èŒƒå»ºè®®. æ¨èä¸‹é¢è¿™äº›èµ„æº:</p><p><br></p><h3 id="5-1-javascript"><a href="#5-1-javascript" class="headerlink" title="5.1 Javascript"></a>5.1 Javascript</h3><ul><li>Lintå·¥å…·<ul><li><a href="https://cn.eslint.org" target="_blank" rel="noopener">ESLint</a> - ğŸ”¥ç›®å‰æ˜¯ç¤¾åŒºæœ€æµè¡Œçš„ã€é€šç”¨çš„Javascript Lintå·¥å…·ï¼ŒLintç•Œçš„Babelã€‚æ”¯æŒå®šåˆ¶æ’ä»¶ã€presetã€‚å¦‚æœä¸æƒ³æŠ˜è…¾å¯ä»¥é€‰æ‹©å®ƒçš„ä¸€äº›é¢„å®šä¹‰é…ç½®</li><li><a href="https://github.com/palantir/tslint" target="_blank" rel="noopener">TSLint</a> - Typescript Lintå·¥å…·ã€‚ä¸è¿‡å³å°†<a href="https://github.com/palantir/tslint/issues/4534" target="_blank" rel="noopener">åºŸå¼ƒ</a>äº†, æ¨èä½¿ç”¨ESLint</li></ul></li><li>è§„èŒƒ<ul><li><a href="https://standardjs.com/readme-zhcn.html#why-should-i-use-javascript-standard-style" target="_blank" rel="noopener">JavaScript Standard Style</a> - ğŸ”¥ é›¶é…ç½®çš„ã€â€˜æ ‡å‡†â€™çš„Javascriptç¼–ç è§„èŒƒ. åº•å±‚åŸºäºEslintã€‚ç›®å‰ä¸æ”¯æŒTypescript</li><li><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">Airbnb JavaScript Style Guide</a> - Airbnbçš„ç¼–ç è§„èŒƒï¼Œä¸šç•Œæ ‡æ†</li></ul></li><li>ç±»å‹æ£€æŸ¥. æš‚æ—¶å°†å®ƒä»¬å½’ç±»åˆ°è¿™é‡Œï¼Œå› ä¸ºå®ƒä»¬åŒå±äº<a href="https://juejin.im/post/5d2c515d6fb9a07ead5a2bbe#heading-39" target="_blank" rel="noopener">â€˜é™æ€æµ‹è¯•â€™</a><ul><li><a href="https://www.typescriptlang.org" target="_blank" rel="noopener">Typescript</a> - ğŸ”¥ Javascriptè¯­è¨€çš„è¶…é›†ï¼Œè¿™æ˜¯ä¸€é—¨â€˜æ–°â€™çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯ç®€å•çš„ç±»å‹æ£€æŸ¥å™¨. ä¸è¿‡<strong>å®ƒä¹Ÿæ”¯æŒ<a href="https://www.typescriptlang.org/docs/handbook/type-checking-javascript-files.html" target="_blank" rel="noopener">åŸç”ŸJavascriptçš„ç±»å‹æ£€æŸ¥</a></strong></li><li><a href="https://flow.org" target="_blank" rel="noopener">Flow</a> - Facebookå‡ºå“çš„ç±»å‹æ£€æŸ¥å™¨ï¼Œè¯­æ³•å’ŒTypescriptç±»ä¼¼. ä¸ªäººæ¨èä½¿ç”¨Typescript</li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-2-html"><a href="#5-2-html" class="headerlink" title="5.2 HTML"></a>5.2 HTML</h3><ul><li>Lintå·¥å…·<ul><li><a href="https://htmlhint.io" target="_blank" rel="noopener">HTMLHint</a></li><li><a href="https://github.com/twbs/bootlint" target="_blank" rel="noopener">bootlint</a></li></ul></li><li>è§„èŒƒ<ul><li><a href="https://codeguide.co" target="_blank" rel="noopener">Code Guide</a></li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-3-css"><a href="#5-3-css" class="headerlink" title="5.3 CSS"></a>5.3 CSS</h3><ul><li>Lintå·¥å…·<ul><li><a href="https://stylelint.docschina.org" target="_blank" rel="noopener">stylelint</a> - ğŸ”¥ é€šç”¨çš„CSSç¼–ç æ£€æŸ¥å·¥å…·ï¼Œæ”¯æŒæœ€æ–°çš„CSSè¯­æ³•ã€CSS-in-jsã€ä»¥åŠå…¶ä»–ç±»CSSè¯­æ³•(å¦‚SCSSã€Less). å®ƒä¹Ÿæœ‰é¢„å®šä¹‰é…ç½®ï¼Œæ¨èä½¿ç”¨</li></ul></li><li>è§„èŒƒ<ul><li><a href="https://github.com/airbnb/css" target="_blank" rel="noopener">Airbnb CSS / Sass Styleguide</a></li><li><a href="https://codeguide.co" target="_blank" rel="noopener">Code Guide</a></li><li><a href="https://css-tricks.com/css-style-guides/" target="_blank" rel="noopener">æ›´å¤š</a></li></ul></li><li>æ–¹æ³•è®º<ul><li><a href="https://css-tricks.com/bem-101/" target="_blank" rel="noopener">BEM</a> - ğŸ”¥ BEMå‘½åè§„èŒƒ</li><li><a href="https://github.com/stubbornella/oocss/wiki" target="_blank" rel="noopener">OOCSS</a></li><li><a href="http://smacss.com" target="_blank" rel="noopener">smacss</a></li></ul></li></ul><p><br></p><p>å…³äºCSSå¯ä»¥å­¦ä¹ <a href="http://twitter.github.com/bootstrap/" target="_blank" rel="noopener">Bootstrap</a>è¿™äº›ä¼ ç»ŸUIæ¡†æ¶ï¼Œä»–ä»¬çš„ä»£ç ç»„ç»‡æ€§éå¸¸å¥½, å€¼å¾—å­¦ä¹ </p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-4-ä»£ç æ ¼å¼åŒ–"><a href="#5-4-ä»£ç æ ¼å¼åŒ–" class="headerlink" title="5.4 ä»£ç æ ¼å¼åŒ–"></a>5.4 ä»£ç æ ¼å¼åŒ–</h3><p><img src="/images/frontend-standard/prt.png" alt></p><ul><li><a href="https://prettier.io" target="_blank" rel="noopener">Prettier</a> - ğŸ”¥ å…³äºä»£ç æ ¼å¼åŒ–çš„æ‰€æœ‰ä¸œè¥¿éƒ½äº¤ç»™å®ƒå§ï¼</li></ul><p>åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰ä»£ç æ ¼å¼ç›¸å…³çš„å·¥ä½œéƒ½å¯ä»¥äº¤ç»™Prettieræ¥åšï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šå†ä½¿ç”¨Eslintè¦†ç›–è¯­ä¹‰ç›¸å…³çš„æ£€æŸ¥</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-5-é›†å¤§æˆçš„"><a href="#5-5-é›†å¤§æˆçš„" class="headerlink" title="5.5 é›†å¤§æˆçš„"></a>5.5 é›†å¤§æˆçš„</h3><ul><li><a href="https://coderlmn.github.io/code-standards/#_code_reviews" target="_blank" rel="noopener">isobar å‰ç«¯ä»£ç è§„èŒƒåŠæœ€ä½³å®è·µ</a></li><li><a href="https://guide.aotu.io/index.html" target="_blank" rel="noopener">å‡¹å‡¸å®éªŒå®¤ä»£ç è§„èŒƒ</a></li><li><a href="https://github.com/fex-team/styleguide" target="_blank" rel="noopener">ç™¾åº¦FEXè§„èŒƒ</a></li><li><a href="http://nec.netease.com/standard" target="_blank" rel="noopener">è€ç‰Œçš„NECè§„èŒƒ</a> - æœ‰ç‚¹è€</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-6-ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—"><a href="#5-6-ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—" class="headerlink" title="5.6 ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—"></a>5.6 ç‰¹å®šæ¡†æ¶é£æ ¼æŒ‡å—</h3><ul><li><a href="https://vue.docschina.org/v2/style-guide/" target="_blank" rel="noopener">vue-style-guide</a></li><li><a href="https://github.com/airbnb/javascript/tree/master/react" target="_blank" rel="noopener">Airbnb React/JSX Style Guide</a></li><li><a href="https://juejin.im/post/5cd7f2c4e51d453a7d63b715" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“</a> - è‡ªèä¸€ä¸‹ç¬”è€…å†™çš„Reactç»„ä»¶è®¾è®¡ç›¸å…³å®è·µ</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="5-7-code-review"><a href="#5-7-code-review" class="headerlink" title="5.7 Code Review"></a>5.7 Code Review</h3><p><img src="/images/frontend-standard/code-review.png" alt></p><p>ä¸Šè¿°çš„Lintå·¥å…·å’Œç±»å‹æ£€æŸ¥å™¨, å¯ä»¥çº¦æŸä»£ç é£æ ¼ã€é¿å…ä½çº§çš„è¯­æ³•é”™è¯¯ã€‚ä½†æ˜¯å³ä½¿é€šè¿‡ä¸Šé¢çš„Lintå’Œç±»å‹æ£€æŸ¥ï¼Œä»£ç ä¹Ÿå¯èƒ½æœªå¿…æ˜¯â€˜å¥½ä»£ç â€™ã€‚</p><p><strong>å¾ˆå¤šä»£ç è®¾è®¡çš„â€˜æœ€ä½³å®è·µâ€™æ˜¯æ— æ³•é€šè¿‡å…·è±¡åŒ–çš„è‡ªåŠ¨åŒ–å·¥å…·æˆ–æ–‡æ¡£è¦†ç›–çš„, è¿™æ—¶å€™ï¼Œâ€™ç»éªŒâ€™æˆ–è€…â€™ç¾¤ä½“æ™ºæ…§â€™å°±æ´¾ä¸Šç”¨åœºäº†</strong>. æ¯”å¦‚Code Reviewé˜¶æ®µä¼šæ£€æŸ¥è¿™äº›ä¸œè¥¿:</p><ul><li>ç¼–ç¨‹åŸåˆ™ã€è®¾è®¡æ€æƒ³. ä¾‹å¦‚ç¬¦åˆSOLIDåŸåˆ™? æ˜¯å¦è¶³å¤ŸDRYï¼Ÿæ¥å£è®¾è®¡æ˜¯å¦ç®€æ´æ˜“æ‰©å±•ã€</li><li>æ¨¡å—è€¦åˆç¨‹åº¦ã€ä»£ç é‡å¤</li><li>ä»£ç å¥å£®æ€§ã€‚æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²ã€æ˜¯å¦çº¿ç¨‹å®‰å…¨ã€æ˜¯å¦æœ‰æ½œåœ¨æ€§èƒ½é—®é¢˜å’Œå¼‚å¸¸ã€é”™è¯¯æ˜¯å¦è¢«å¤„ç†</li><li>ä»£ç çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</li><li>æ˜¯å¦æœ‰æ²¡æœ‰è€ƒè™‘åˆ°çš„åœºæ™¯ï¼Ÿ</li></ul><p>å¦‚æœä½ ä»¬æ˜¯ç¬¬ä¸€æ¬¡æ¨è¡ŒCode Review, å¯ä»¥å»ºç«‹ä¸€ä¸ªæ£€æŸ¥åˆ—è¡¨ï¼Œå¯¹ç…§ç€è¿›è¡Œæ£€æŸ¥ã€‚ç†Ÿç»ƒåï¼Œå¿ƒä¸­è‡ªç„¶æ— ç ã€‚</p><p><br></p><p>Code Reviewæœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>Code Reviewå¯ä»¥è®©å…¶ä»–æˆå‘˜éƒ½ç†Ÿæ‚‰ä»£ç </strong>ã€‚è¿™æ ·ä¿è¯å…¶ä»–äººéƒ½å¯ä»¥è¾ƒå¿«åœ°æ¥æ‰‹ä½ çš„å·¥ä½œï¼Œæˆ–è€…å¸®ä½ è§£å†³æŸäº›é—®é¢˜</li><li><strong>æé«˜ä»£ç è´¨é‡</strong>ã€‚æ¯«æ— ç–‘é—®. ä¸€æ–¹é¢æ˜¯<em>ä¸»åŠ¨æ€§</em>çš„ä»£ç è´¨é‡æå‡ï¼Œæ¯”å¦‚ä½ çš„ä»£ç éœ€è¦è¢«äººReviewï¼Œä¼šè‡ªè§‰å°½é‡çš„æé«˜ä»£ç è´¨é‡ï¼›å¦ä¸€æ–¹é¢ï¼Œå…¶ä»–æˆå‘˜å¯ä»¥æ£€æŸ¥æäº¤æ–¹çš„ä»£ç è´¨é‡</li><li><strong>æ£€æŸ¥æˆ–æé«˜æ–°æˆå‘˜çš„ç¼–ç¨‹æ°´å¹³</strong>ã€‚åŸ¹å…»æ–°äººæ—¶ï¼Œç”±äºä¸ä¿¡ä»»å®ƒä»¬æäº¤çš„ä»£ç ï¼Œæˆ‘ä»¬ä¼šåšä¸€æ¬¡Reviewæ£€æŸ¥ä»£ç æ˜¯å¦è¿‡å…³ã€‚å¦ä¸€æ–¹é¢è¿™æ˜¯ä¸€æ¬¡çœŸå®çš„æ¡ˆä¾‹è®²è§£, å¯ä»¥è¾ƒå¿«æé«˜ä»–ä»¬çš„èƒ½åŠ›</li></ul><p><br></p><p><strong>Code Reviewæœ‰ä¸¤ç§æ–¹å¼: ä¸€ä¸ª<code>æäº¤æ—¶</code>ã€ä¸€ä¸ªæ˜¯<code>å®šæ—¶</code></strong>:</p><ul><li><code>æäº¤æ—¶</code>. å¤§éƒ¨åˆ†å¼€æºé¡¹ç›®é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚é€šä¿—è®²å°±æ˜¯Pull Requestã€‚åªæœ‰ä»£ç é€šè¿‡æµ‹è¯•ã€å’Œå…¶ä»–æˆå‘˜çš„Reviewæ‰å¯ä»¥åˆè¿›æ­£å¼ç‰ˆæœ¬åº“ã€‚è¿™ç§æ–¹å¼ä¹Ÿç§°ä¸ºâ€˜é˜»å¡å¼â€™ä»£ç æ£€æŸ¥ï¼Œä¸€èˆ¬é…åˆGitFlowä½¿ç”¨ã€‚</li><li><code>å®šæ—¶</code>. åœ¨é¡¹ç›®å®Œç»“åã€é¡¹ç›®çš„æŸä¸ªé‡Œç¨‹ç¢‘ã€æˆ–è€…å›ºå®šçš„æ—¶é—´(æ¯å¤©ã€æ¯ä¸ªæ˜ŸæœŸ..). å›¢é˜Ÿæˆå‘˜èšåœ¨ä¸€èµ·ï¼Œå›é¡¾è‡ªå·±å†™çš„ä»£ç , è®©å…¶ä»–æˆå‘˜è¿›è¡Œå®¡æŸ¥</li></ul><p>Code Reviewæ˜¯æ¯”è¾ƒéš¾ä»¥æ¨è¡Œçš„ï¼Œä¸è¿‡è¿™ä¸ªä¹Ÿè¦çœ‹ä½ ä»¬å›¢é˜Ÿçš„æƒ…å†µï¼Œå‘æˆ‘ä»¬é’±å°‘æ´»å¤šçš„å›¢é˜Ÿï¼Œå¾ˆå°‘çš„æ—¶é—´å»ç«‹é©¬å»å…¼é¡¾å…¶ä»–æˆå‘˜çš„ä»£ç . è¿™æ—¶å€™<code>å®šæ—¶Review</code>ä¼šæ›´æœ‰ç”¨ï¼Œå› ä¸ºçœ‹èµ·æ¥æ›´â€˜èŠ‚çœæ—¶é—´â€™.</p><p>è€Œ<code>æäº¤æ—¶Review</code>åˆ™å¯ä»¥é’ˆå¯¹æ–°äººï¼Œæ¯”å¦‚ä½ ä¸ä¿¡ä»»ä»–ä»¬çš„ä»£ç æˆ–è€…å¸Œæœ›å¸®åŠ©ä»–ä»¬æé«˜ç¼–ç èƒ½åŠ›ã€‚</p><p><br></p><p><strong>ç›¸å…³èµ„æº</strong>:</p><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTQwNTA3Nw==&amp;mid=400946871&amp;idx=1&amp;sn=5a125337833768d705f9d87ba8cd9fff&amp;scene=1&amp;srcid=0104FLyeXIS6N0EShgDseIfI&amp;key=41ecb04b051110031290b34976240e650f0169d239c89f125162a89c8d3412f2087198612e71fd7685cae9eebe08e295&amp;ascene=0&amp;uin=MTYyMDMzMTAwMA%3D%3D&amp;devicetype=iMac+MacBookPro11%2C5+OSX+OSX+10.10.5+build(14F1509" target="_blank" rel="noopener">Code Reviewæœ€ä½³å®è·µ</a>&amp;version=11020201&amp;pass_ticket=dc5bBckt1XSthRKTIsukYHIcAvKfv0jninbMlYQ5TWnE6XS%2FrRkdHKlJjNTI2Wsg)</li><li><a href="https://juejin.im/post/5c9740ba6fb9a071090d6a37" target="_blank" rel="noopener">æ˜¯å¦è¦åšCode Reviewï¼Ÿä¸BATèµ„æ·±æ¶æ„å¸ˆäº‰è®ºä¹‹åçš„æ€è€ƒ</a></li><li><a href="https://richardcao.me/2016/09/30/Talk-About-Codereview/" target="_blank" rel="noopener">ä¸€äº›Code Reviewå·¥å…·</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="6-æ–‡æ¡£è§„èŒƒ"><a href="#6-æ–‡æ¡£è§„èŒƒ" class="headerlink" title="6 æ–‡æ¡£è§„èŒƒ"></a>6 æ–‡æ¡£è§„èŒƒ</h2><p>æ–‡æ¡£å¯¹äºé¡¹ç›®å¼€å‘å’Œç»´æŠ¤ã€å­¦ä¹ ã€é‡æ„ã€ä»¥åŠçŸ¥è¯†ç®¡ç†éå¸¸é‡è¦ã€‚</p><p>å’Œå†™æµ‹è¯•ä¸€æ ·ã€å¤§éƒ¨åˆ†å¼€å‘äººå‘˜ä¼šè§‰å¾—å†™æ–‡æ¡£æ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹æƒ…ï¼Œä¸è¿‡åªæœ‰æ—¶é—´èƒ½å¤Ÿè¯æ˜å®ƒçš„ä»·å€¼ã€‚æ¯”å¦‚å¯¹äºäººå‘˜æµåŠ¨æ¯”è¾ƒå¤§çš„å…¬å¸ï¼Œå¦‚æœæœ‰è§„èŒƒçš„æ–‡æ¡£ä½“ç³»ï¼Œè½¬äº¤å·¥ä½œå°±ä¼šå˜åŠ¨éå¸¸è½»æ¾.</p><p><strong>å¹¿ä¹‰çš„æ–‡æ¡£ä¸å•æŒ‡â€˜è¯´æ˜æ–‡ä»¶â€™æœ¬èº«ï¼Œå®ƒæœ‰å¾ˆå¤šå½¢å¼ã€æ¥æºå’Œè½½ä½“ï¼Œå¯ä»¥æè¿°ä¸€ä¸ªçŸ¥è¯†ã€ä»¥åŠçŸ¥è¯†å½¢æˆå’Œè¿­ä»£çš„è¿‡ç¨‹</strong>ã€‚ä¾‹å¦‚ç‰ˆæœ¬åº“ä»£ç æäº¤è®°å½•ã€ä»£ç æ³¨é‡Šã€å†³ç­–å’Œè®¨è®ºè®°å½•ã€CHANGELOGã€ç¤ºä¾‹ä»£ç ã€è§„èŒƒã€ä¼ ç»Ÿæ–‡æ¡£ç­‰ç­‰</p><p><br></p><h3 id="6-1-å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ"><a href="#6-1-å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ" class="headerlink" title="6.1 å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ"></a>6.1 å»ºç«‹æ–‡æ¡£ä¸­å¿ƒ</h3><p>æˆ‘ä»¬å…¬å¸æ˜¯åšIMçš„ï¼Œæ‰€ä»¥ä¹‹å‰æˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨â€™è‡ªå·±çš„â€™é€šè®¯å·¥å…·æ¥åˆ†äº«æ–‡æ¡£ï¼Œè¿™ç§æ–¹å¼æœ‰å¾ˆå¤§é—®é¢˜:</p><ol><li>å¦‚æœæ²¡æœ‰å­˜æ¡£ä¹ æƒ¯(æ¯”å¦‚åç«¯çš„APIæ–‡æ¡£ï¼Œå› ä¸ºç”±åç«¯ç»´æŠ¤ï¼Œä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å»å­˜æ¡£), æ–‡æ¡£å°±å¯èƒ½ä¸¢å¤±ï¼Œè€Œä¸”é€šè®¯å·¥å…·æ˜¯ä¸ä¼šæ°¸ä¹…ä¿å­˜ä½ çš„æ–‡æ¡£çš„ã€‚å½“ä¸¢å¤±æ–‡ä»¶å°±éœ€è¦é‡æ–°å’Œæ–‡æ¡£ç»´æŠ¤è€…ç´¢è¦</li><li>ç³Ÿç³•çš„æ˜¯æ–‡æ¡£ç»´æŠ¤è€…ä¹Ÿæ˜¯è‡ªå·±æ‰‹åŠ¨åœ¨æœ¬åœ°å­˜æ¡£çš„ï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜æ˜¯: å¦‚æœå·¥ä½œè½¬äº¤ï¼Œå…¶ä»–å¼€å‘è€…éœ€è¦èŠ±è´¹ä¸€ç‚¹æ—¶é—´æ¥æŸ¥æ‰¾; ä¸¢å¤±äº†å°±çœŸçš„æ²¡äº†</li><li>æ¯ä¸€æ¬¡æ–‡æ¡£æ›´æ–°è¦é‡æ–°å‘ä¸€ä»½, è¿™å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å¯èƒ½å‡ºç°æ¼å‘çš„æƒ…å†µ, å¯¼è‡´å‰åä¸ä¸€è‡´.</li><li>å…³äºçŸ¥è¯†çš„å­¦ä¹ ã€ä»¥åŠæœ‰æ„ä¹‰çš„è®¨è®ºè®°å½•æ— æ³•å½’æ¡£ã€‚</li></ol><p>ä¸Šé¢ä»‹ç»çš„æ˜¯ä¸€ç§éå¸¸åŸå§‹çš„æ–‡æ¡£å…±äº«æ–¹å¼ï¼Œå¾ˆå¤šå°å›¢é˜Ÿå°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚</p><p><strong>å¯¹äºé¡¹ç›®æœ¬èº«çš„æ–‡æ¡£å»ºè®®æ”¾ç½®åœ¨å…³è”é¡¹ç›®ç‰ˆæœ¬åº“é‡Œé¢ï¼Œè·Ÿéšé¡¹ç›®ä»£ç è¿›è¡Œè¿­ä»£, å½“æˆ‘ä»¬åœ¨æ£€ç´¢æˆ–è·Ÿè¸ªæ–‡æ¡£çš„å†å²è®°å½•æ—¶ï¼Œè¿™ç§æ–¹å¼æ˜¯æœ€æ–¹ä¾¿çš„</strong>ã€‚</p><p>ç„¶è€Œå¾ˆå¤šåº”ç”¨æ˜¯è·¨è¶Šå¤šä¸ªå›¢é˜Ÿçš„ï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½ä¼šæœ‰è‡ªå·±çš„æ–‡æ¡£è¾“å‡º(æ¯”å¦‚éœ€æ±‚æ–‡æ¡£ã€ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ã€APIæ–‡æ¡£ã€é…ç½®æ–‡æ¡£ç­‰ç­‰)ï¼Œè€Œä¸”é€šå¸¸ä¹Ÿä¸ä¼šåœ¨ä¸€ä¸ªç‰ˆæœ¬åº“é‡Œã€‚è¿™æ—¶å€™æ–‡æ¡£å°±æ¯”è¾ƒåˆ†æ•£ã€‚æ‰€ä»¥ä¸€ä¸ªç»Ÿä¸€çš„æ–‡æ¡£ä¸­å¿ƒæ˜¯å¾ˆæœ‰å¿…è¦ã€‚</p><p>æˆ‘ä»¬å…¬å¸ç°åœ¨é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯<code>Git+Markdown</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æ–‡æ¡£éƒ½æ”¾ç½®åœ¨ä¸€ä¸ªgitç‰ˆæœ¬åº“ä¸‹ã€‚ä¹‹å‰ä¹Ÿè€ƒè™‘è¿‡å•†ä¸šçš„æ–¹æ¡ˆï¼Œè­¬å¦‚<a href="https://shimo.im/welcome" target="_blank" rel="noopener">çŸ³å¢¨æ–‡æ¡£</a>ã€<a href="https://docs.qq.com" target="_blank" rel="noopener">è…¾è®¯æ–‡æ¡£</a>, ä½†ç®¡ç†å±‚å¹¶ä¸ä¿¡ä»»è¿™äº›æœåŠ¡ã€‚</p><p>å¤§æ¦‚çš„gité¡¹ç›®ç»„ç»‡å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è§„èŒƒ/</span><br><span class="line">Aåº”ç”¨/</span><br><span class="line">  äº§å“/</span><br><span class="line">  è®¾è®¡/</span><br><span class="line">  APIæ–‡æ¡£/</span><br><span class="line">  æµ‹è¯•/</span><br><span class="line">  å…¶ä»–/</span><br><span class="line">Båº”ç”¨/</span><br></pre></td></tr></table></figure><p><strong>Gitç‰ˆæœ¬åº“(ä¾‹å¦‚Gitlab)æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œä¾‹å¦‚å†å²è®°å½•è·Ÿè¸ªã€ç‰ˆæœ¬åŒ–ã€é—®é¢˜è®¨è®º(å¯ä»¥å…³è”issueã€æˆ–è€…æäº¤)ã€å¤šäººåä½œã€æœç´¢ã€æƒé™ç®¡ç†(é’ˆå¯¹ä¸åŒçš„ç‰ˆæœ¬åº“æˆ–åˆ†ç»„ä¸ºä¸åŒäººå‘˜è®¾ç½®æƒé™)ç­‰ç­‰</strong>ã€‚</p><p><code>Git+Markdown</code>å¯ä»¥æ»¡è¶³å¼€å‘è€…çš„å¤§éƒ¨åˆ†éœ€æ±‚ã€‚ä½†æ˜¯<strong>Gitæœ€æ“…é•¿çš„æ˜¯å¤„ç†çº¯æ–‡æœ¬æ–‡ä»¶ã€å¯¹äºäºŒè¿›åˆ¶æ˜¯æ— èƒ½ä¸ºåŠ›çš„ï¼Œæ— æ³•é’ˆå¯¹è¿™äº›ç±»å‹çš„æ–‡æ¡£è¿›è¡Œåœ¨çº¿é¢„è§ˆå’Œç¼–è¾‘</strong>ã€‚</p><p>æ‰€ä»¥<code>Git+Markdown</code>å¹¶ä¸èƒ½æ»¡è¶³å¤šæ ·åŒ–çš„æ–‡æ¡£å¤„ç†éœ€æ±‚ï¼Œæ¯”å¦‚æ€ç»´å¯¼å›¾ã€å›¾è¡¨ã€è¡¨æ ¼ã€PPTã€ç™½æ¿ç­‰éœ€æ±‚. æ¯•ç«Ÿå®ƒä¸æ˜¯ä¸“ä¸šçš„æ–‡æ¡£å¤„ç†å·¥å…·ã€‚æ‰€ä»¥å¯¹äºäº§å“ã€è®¾è®¡äººå‘˜è¿™äº›å¯Œæ–‡æ¡£éœ€æ±‚åœºæ™¯ï¼Œé€šå¸¸ä¼šæŒ‰ç…§ä¼ ç»Ÿæ–¹å¼æˆ–è€…æ›´ä¸“ä¸šçš„å·¥å…·å¯¹æ–‡æ¡£è¿›è¡Œç®¡ç†.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-2-æ–‡æ¡£æ ¼å¼"><a href="#6-2-æ–‡æ¡£æ ¼å¼" class="headerlink" title="6.2 æ–‡æ¡£æ ¼å¼"></a>6.2 æ–‡æ¡£æ ¼å¼</h3><p>æ¯«æ— ç–‘é—®ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œ<a href="https://zh.wikipedia.org/wiki/Markdown" target="_blank" rel="noopener">Markdown</a>æ˜¯æœ€é€‚åˆçš„ã€æœ€é€šç”¨çš„æ–‡æ¡£æ ¼å¼ã€‚æ”¯æŒç‰ˆæœ¬åº“åœ¨çº¿é¢„è§ˆå’Œå˜æ›´å†å²è·Ÿè¸ªã€‚</p><p>ä¸‹é¢è¿™äº›å·¥å…·å¯ä»¥æé«˜Markdownçš„å¼€å‘æ•ˆç‡:</p><ul><li>å¯è§†åŒ–ç¼–è¾‘å™¨<ul><li><strong>Visual Code</strong>: å¤§éƒ¨åˆ†ä»£ç ç¼–è¾‘éƒ½æ”¯æŒMarkdownç¼–è¾‘å’Œé¢„è§ˆ</li><li><a href="https://link.jianshu.com/?t=http://mouapp.com/" target="_blank" rel="noopener"><strong>Mou</strong></a>: Macä¸‹çš„è€ç‰Œç¼–è¾‘å™¨</li><li><a href="https://typora.io" target="_blank" rel="noopener"><strong>typora</strong></a>: è·¨å¹³å°çš„Markdownç¼–è¾‘å™¨ï¼Œæ¨è</li></ul></li><li><strong>markdownlint</strong>: ç¼–ç æ£€æŸ¥å™¨</li><li>æ‰©å±•(Visual Studio Code):<ul><li><strong>Markdown All in One</strong>: All you need to write Markdown (keyboard shortcuts, table of contents, auto preview and more)</li><li><strong>Markdown TOC</strong>: markdown ç›®å½•ç”Ÿæˆï¼Œæˆ‘æœ€å¸¸ç”¨çš„markdownæ’ä»¶</li></ul></li><li>å›¾è¡¨ç»˜åˆ¶å·¥å…·:<ul><li><a href="https://www.draw.io" target="_blank" rel="noopener"><strong>drawio</strong></a> åŸºäºWebçš„å›¾è¡¨ç»˜åˆ¶å·¥å…·ã€ä¹Ÿæœ‰ç¦»çº¿å®¢æˆ·ç«¯</li><li><strong>KeyNote/PPT</strong> ä¸´æ—¶ç»˜å›¾ä¹Ÿä¸é”™</li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-3-å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿"><a href="#6-3-å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿" class="headerlink" title="6.3 å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿"></a>6.3 å®šä¹‰æ–‡æ¡£çš„æ¨¡æ¿</h3><p>å…³äºå¦‚ä½•å†™å¥½æ–‡æ¡£ï¼Œå¾ˆéš¾é€šè¿‡æ ‡å‡†æˆ–è§„èŒƒæ¥è¿›è¡Œçº¦æŸï¼Œå› ä¸ºå®ƒçš„ä¸»è§‚æ€§æ¯”è¾ƒå¼º, å¥½çš„æ–‡æ¡£å–å†³äºç¼–è¾‘è€…çš„é€»è¾‘æ€»ç»“èƒ½åŠ›ã€è¡¨è¾¾èƒ½åŠ›ã€ä»¥åŠæœ‰æ²¡æœ‰ç«™åœ¨è¯»è€…çš„è§’åº¦å»æ€è€ƒé—®é¢˜ã€‚</p><p>æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒç±»å‹çš„æ–‡æ¡£æä¾›ä¸€ä¸ªæ¨¡æ¿ï¼Œé€šè¿‡æ¨¡æ¿æ¥è¯´æ˜ä¸€ä¸ªæ–‡æ¡£éœ€è¦åŒ…å«å“ªäº›å†…å®¹, å¯¹æ–‡æ¡£çš„ç¼–å†™è€…è¿›è¡Œå¼•å¯¼.</p><p>ä¾‹å¦‚ä¸€ä¸ªAPIæ–‡æ¡£å¯èƒ½éœ€è¦è¿™äº›å†…å®¹:</p><ul><li>æ¥å£çš„ç´¢å¼•</li><li>æ¥å£çš„ç‰ˆæœ¬ã€å˜æ›´è®°å½•</li><li>ç”¨æ³•å’Œæ•´ä½“æè¿°, è®¤è¯é‰´æƒç­‰ç­‰</li><li>æè¿°å…·ä½“çš„æ¥å£<ul><li>åŠŸèƒ½è¯´æ˜</li><li>æ–¹æ³•åç§°æˆ–è€…URI</li><li>å‚æ•°å’Œè¿”å›å€¼å®šä¹‰</li><li>è°ƒç”¨ç¤ºä¾‹</li><li>æ³¨æ„äº‹é¡¹ç­‰ç­‰</li></ul></li></ul><p>å…·ä½“è§„èŒƒå†…å®¹å› å›¢é˜Ÿè€Œå¼‚ï¼Œè¿™é‡Œç‚¹åˆ°ä¸ºæ­¢.</p><p><br></p><p>æ‰©å±•:</p><ul><li><a href="https://github.com/ruanyf/document-style-guide/blob/master/docs/reference.md" target="_blank" rel="noopener">ä¸­æ–‡æŠ€æœ¯æ–‡æ¡£çš„å†™ä½œè§„èŒƒ</a></li><li><a href="https://github.com/reactjs/rfcs/blob/master/0000-template.md" target="_blank" rel="noopener">React RFCæ¨¡æ¿</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-4-è®¨è®ºå³æ–‡æ¡£"><a href="#6-4-è®¨è®ºå³æ–‡æ¡£" class="headerlink" title="6.4 è®¨è®ºå³æ–‡æ¡£"></a>6.4 è®¨è®ºå³æ–‡æ¡£</h3><p><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€ä¸ªå¼€æºé¡¹ç›®æ¥è¯´é™¤äº†å®˜æ–¹æ–‡æ¡£ï¼ŒIssuesä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯æ¥æºã€‚åœ¨Issueä¸­æˆ‘ä»¬å¯ä»¥è·å–å…¶ä»–å¼€å‘è€…é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€ç»™å®˜æ–¹åé¦ˆ/æŠ•ç¥¨ã€å…³æ³¨å®˜æ–¹çš„æœ€æ–°åŠ¨æ€ã€å’Œå…¶ä»–å¼€å‘è€…å¤´è„‘é£æš´å”‡æªèˆŒæˆ˜ç­‰ç­‰</strong>ã€‚</p><p>æ‰€ä»¥ç›¸å¯¹äºä½¿ç”¨IMï¼Œç¬”è€…æ›´æ¨èIssueè¿™ç§æ²Ÿé€šæ¨¡å¼ï¼Œå› ä¸º<strong>å®ƒæ–¹ä¾¿å½’æ¡£ç»„ç»‡ï¼Œç´¢å¼•å’ŒæŸ¥æ‰¾</strong>ã€‚è€ŒIMä¸Šçš„è®¨è®ºå°±åƒæµæ°´ä¸€æ ·ï¼Œä¸€å»ä¸å¤è¿”ã€‚</p><p>å½“ç„¶ä¸¤ç§å·¥å…·çš„é€‚ç”¨åœºæ™¯ä¸ä¸€æ ·ï¼Œä½ æ‹¿IMçš„ä½¿ç”¨æ–¹å¼æ¥ä½¿ç”¨Issueï¼ŒIssueå°±ä¼šå˜å¾—å¾ˆæ°´ã€‚<strong>Issueé€‚åˆåšæœ‰æ„ä¹‰çš„ã€ç›®çš„æ˜ç¡®çš„è®¨è®º</strong>ã€‚ æ‰€ä»¥è¦è°´è´£ä¸€ä¸‹åœ¨Github Issueä¸ŠçŒæ°´çš„å¼€å‘è€…ã€‚</p><p>å…³äºIssueæœ‰å¾ˆå¤šå¦™ç”¨ï¼Œæ¨èé˜…è¯»è¿™ç¯‡æ–‡ç« <a href="http://www.ruanyifeng.com/blog/2017/08/issue.html" target="_blank" rel="noopener">&lt;å¦‚ä½•ä½¿ç”¨ Issue ç®¡ç†è½¯ä»¶é¡¹ç›®ï¼Ÿ&gt;</a></p><p>ç°åœ¨å¾ˆå¤šå¼€æºé¡¹ç›®éƒ½å¼•å…¥äº†RFC(è¯·æ±‚æ„è§ç¨¿)æµç¨‹(å‚è€ƒ<a href="https://www.infoq.cn/article/2017/12/react-rfc-process" target="_blank" rel="noopener">Reacté‡‡ç”¨æ–°çš„RFCæµç¨‹</a>, ä»¥åŠ<a href="https://juejin.im/post/5d0f64d4f265da1b67211893" target="_blank" rel="noopener">Vue æœ€é»‘æš—çš„ä¸€å¤©</a>), è¿™è®©å¼€å‘è€…æœ‰â€˜ç¿»èº«å†œå¥´ã€å½“å®¶åšä¸»â€™çš„æ„Ÿè§‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‚ä¸åˆ°ä¸€ä¸ªå¼€æºé¡¹ç›®é‡å¤§äº‹ä»¶çš„å†³ç­–ä¹‹ä¸­ã€‚<strong>æ¯ä¸ªRFCä¼šè¯´æ˜å†³ç­–çš„åŠ¨æœºã€è¯¦ç»†è®¾è®¡ã€ä¼˜ç¼ºç‚¹ã€‚é™¤äº†å®˜æ–¹æ–‡æ¡£ä¹‹å¤–ï¼Œè¿™äº›RFCæ˜¯å¾ˆæœ‰ä»·å€¼çš„å­¦ä¹ èµ„æ–™</strong>ã€‚</p><p>æˆ‘è§‰å¾—å¦‚æœä¸æ¶‰åŠæœºå¯†ï¼Œå›¢é˜Ÿåº”è¯¥è¦è®©æ›´å¤šäººå‚ä¸åˆ°é¡¹ç›®çš„è®¾è®¡å’Œå†³ç­–ä¸­ï¼Œå¯¹äºæ–°æ‰‹å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œè€Œå¯¹äºå‘èµ·è€…ä¹Ÿå¯èƒ½æœ‰è€ƒè™‘ä¸å‘¨çš„æƒ…å†µã€‚</p><p>é‚£å¯¹äºä¼ä¸šåº”ç”¨å¼€å‘, Issueæœ‰ç”¨å—?</p><p>å½“ç„¶æœ‰ç”¨, æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å°†è¿™ç±»è¯é¢˜ä»IMè½¬ç§»åˆ°Issue:</p><ul><li>è®¾è®¡æ–¹æ¡ˆ</li><li>å†³ç­–/å»ºè®®<ul><li>æ–°åŠŸèƒ½ã€æ–°æŠ€æœ¯å¼•å…¥</li><li>é‡æ„</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>è§„èŒƒ</li></ul></li><li>é—®é¢˜è®¨è®º</li><li>é‡å¤§äº‹ä»¶</li><li>è®¡åˆ’æˆ–è¿›åº¦è·Ÿè¸ª</li><li>â€¦</li></ul><p><br></p><p>å¦å¤–Issueé€šå¸¸é€šè¿‡æ ‡ç­¾æ¥è¿›è¡Œåˆ†ç±»ï¼Œæ–¹ä¾¿ç»„ç»‡å’Œæ£€ç´¢:</p><p><img src="/images/frontend-standard/issue.png" alt></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-5-æ³¨é‡Šå³æ–‡æ¡£"><a href="#6-5-æ³¨é‡Šå³æ–‡æ¡£" class="headerlink" title="6.5 æ³¨é‡Šå³æ–‡æ¡£"></a>6.5 æ³¨é‡Šå³æ–‡æ¡£</h3><p><strong>å¿…è¦å’Œé€‚é‡çš„æ³¨é‡Šå¯¹é˜…è¯»æºä»£ç çš„äººæ¥è¯´å°±æ˜¯ä¸€ä¸ªè·¯ç‰Œ, å¯ä»¥å°‘èµ°å¾ˆå¤šå¼¯è·¯</strong>.</p><p>å…³äºæ³¨é‡Šçš„ä¸€äº›å‡†åˆ™ï¼Œ<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E7%BC%96%E7%A8%8B%E8%A7%84%E7%BA%A6/%E6%B3%A8%E9%87%8A%E8%A7%84%E7%BA%A6.md" target="_blank" rel="noopener">&lt;é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ&gt;</a>æ€»ç»“å¾—éå¸¸å¥½, æ¨èåŸºäºè¿™ä¸ªæ¥å»ºç«‹æ³¨é‡Šè§„èŒƒã€‚å¦å¤–é€šè¿‡ESlintæ˜¯å¯ä»¥å¯¹æ³¨é‡Šè¿›è¡Œä¸€å®šç¨‹åº¦çš„è§„èŒƒã€‚</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="6-6-ä»£ç å³æ–‡æ¡£"><a href="#6-6-ä»£ç å³æ–‡æ¡£" class="headerlink" title="6.6 ä»£ç å³æ–‡æ¡£"></a>6.6 ä»£ç å³æ–‡æ¡£</h3><p>ç°åœ¨æœ‰å¾ˆå¤šç§å·¥å…·æ”¯æŒä»ä»£ç ä¸­è§£æå’Œç”Ÿæˆæ–‡æ¡£, è¿™å¯ä»¥ç»™å¼€å‘è€…ç®€åŒ–å¾ˆå¤šæ–‡æ¡£ç»´æŠ¤çš„å·¥ä½œã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¿®æ”¹äº†ä»£ç ï¼Œä½†æ˜¯æ–‡æ¡£å¿˜è®°åŒæ­¥çš„æƒ…å†µã€‚é€šè¿‡â€˜ä»£ç å³æ–‡æ¡£â€™çš„æ–¹å¼è‡³å°‘å¯ä»¥<strong>ä¿æŒæ–‡æ¡£å’Œä»£ç åŒæ­¥æ›´æ–°</strong>ï¼›å¦å¤–<strong>å¾ˆå¤šå·¥å…·ä¼šåˆ†æä»£ç çš„æ•°æ®ç±»å‹</strong>ï¼Œè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆå‚æ•°å’Œè¿”å›å€¼å®šä¹‰ï¼Œè¿™ä¹Ÿå¯ä»¥å‡å°‘å¾ˆå¤šæ–‡æ¡£ç¼–å†™å·¥ä½œä»¥åŠå‡ºé”™ç‡ã€‚</p><p>æ¯”å¦‚å¯ä»¥é€šè¿‡ä¸‹é¢æ³¨é‡Šæ–¹å¼æ¥ç”Ÿæˆç»„ä»¶æ–‡æ¡£:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Propsæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> interface ColumnProps extends React.HTMLAttributes&lt;any&gt; &#123;</span><br><span class="line">  <span class="comment">/** prop1 description */</span></span><br><span class="line">  prop1?: string;</span><br><span class="line">  <span class="comment">/** prop2 description */</span></span><br><span class="line">  prop2: number;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * prop3 description</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  prop3: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">/** prop4 description */</span></span><br><span class="line">  prop4: <span class="string">'option1'</span> | <span class="string">'option2'</span> | <span class="string">'option3'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹ç»„ä»¶è¿›è¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Column</span> <span class="keyword">extends</span> <span class="title">Component</span>&lt;<span class="title">ColumnProps</span>, </span>&#123;&#125;&gt; &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Column<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç›¸å…³çš„å·¥å…·æœ‰:</p><ul><li>APIæ–‡æ¡£<ul><li>Typescript<ul><li><a href="https://github.com/microsoft/tsdoc" target="_blank" rel="noopener">tsdoc</a> Typescriptå®˜æ–¹çš„æ³¨é‡Šæ–‡æ¡£æ ‡å‡†</li><li><a href="https://github.com/TypeStrong/typedoc" target="_blank" rel="noopener">typedoc</a> åŸºäºtsdocæ ‡å‡†çš„æ–‡æ¡£ç”Ÿæˆå™¨</li></ul></li><li>Javascript<ul><li><a href="https://github.com/jsdoc/jsdoc" target="_blank" rel="noopener">jsdoc</a> Javascriptæ–‡æ¡£æ³¨é‡Šæ ‡å‡†å’Œç”Ÿæˆå™¨</li></ul></li></ul></li><li>åç«¯æ¥å£æ–‡æ¡£<ul><li><a href="https://swagger.io" target="_blank" rel="noopener">Swagger</a> Restfulæ¥å£æ–‡æ¡£è§„èŒƒ</li><li>GraphQL: è¿™ä¸ªæœ‰å¾ˆå¤šå·¥å…·ï¼Œä¾‹å¦‚<a href="https://github.com/graphql/graphiql" target="_blank" rel="noopener">graphiql</a>, é›†æˆäº†Playgroundå’Œæ–‡æ¡£ï¼Œå¾ˆå…ˆè¿›</li><li><a href="https://easy-mock.com/login" target="_blank" rel="noopener">Easy Mock</a> ä¸€ä¸ªå¯è§†åŒ–ï¼Œå¹¶ä¸”èƒ½å¿«é€Ÿç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®çš„æœåŠ¡</li></ul></li><li>ç»„ä»¶æ–‡æ¡£<ul><li><a href="https://storybook.js.org" target="_blank" rel="noopener">StoryBook</a> é€šç”¨çš„ç»„ä»¶å¼€å‘ã€æµ‹è¯•ã€æ–‡æ¡£å·¥å…·</li><li>React<ul><li><a href="http://docz.site" target="_blank" rel="noopener">Docz</a></li><li><a href="https://github.com/styleguidist/react-styleguidist" target="_blank" rel="noopener">Styleguidist</a></li></ul></li><li>Vue<ul><li><a href="https://github.com/vue-styleguidist/vue-styleguidist" target="_blank" rel="noopener">vue-styleguidist</a></li><li>æœ‰æ›´å¥½çš„å·¥å…·è¯·è¯„è®ºå‘Šè¯‰æˆ‘</li></ul></li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="7-uiè®¾è®¡è§„èŒƒ"><a href="#7-uiè®¾è®¡è§„èŒƒ" class="headerlink" title="7 UIè®¾è®¡è§„èŒƒ"></a>7 UIè®¾è®¡è§„èŒƒ</h2><p><img src="/images/frontend-standard/ui-design.png" alt></p><p>è¿™æ˜¯ä¸€ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„è§„èŒƒç±»å‹ã€‚ç¬”è€…å°±æ·±å—å…¶è‹¦ï¼Œæˆ‘ä»¬å…¬å¸åˆæœŸUIå¹¶ä¸ä¸“ä¸šï¼Œæ²¡æœ‰æ‰€è°“çš„è®¾è®¡è§„èŒƒï¼Œè¿™å°±å¯¼è‡´ä»–ä»¬è®¾è®¡å‡ºæ¥çš„äº§å“éƒ½æ˜¯ä¸œå€Ÿè¥¿å‡‘ï¼Œå‰åä¸ç»Ÿä¸€ï¼Œå¤šä¸ªåº”ç”¨ä¹‹é—´çš„ç»„ä»¶ä¸èƒ½å¤ç”¨ã€‚è¿™æå¾—æˆ‘ä»¬ä¸å¾—ä¸æµªè´¹æ—¶é—´ï¼Œå†™å¾ˆå¤šå®šåˆ¶åŒ–æ ·å¼å’Œç»„ä»¶ï¼Œä¸ºä»–ä»¬çš„ä¸ä¸“ä¸šä¹°å•.</p><p>å…³äºUIè®¾è®¡è§„èŒƒçš„é‡è¦æ€§æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5b766ac56fb9a009aa154c27" target="_blank" rel="noopener">&lt;å¼€å‘å’Œè®¾è®¡æ²Ÿé€šæœ‰å¤šéš¾ï¼Ÿ - ä½ åªå·®ä¸€ä¸ªè®¾è®¡è§„èŒƒ&gt;</a>. </p><p>ç®€å•æ€»ç»“ä¸€ä¸‹UIè®¾è®¡è§„èŒƒçš„æ„ä¹‰ï¼š</p><ul><li>æä¾›å›¢é˜Ÿåä½œæ•ˆç‡(äº§å“å’Œå¼€å‘)</li><li>æé«˜ç»„ä»¶çš„å¤ç”¨ç‡. ç»Ÿä¸€çš„ç»„ä»¶è§„èŒƒå¯ä»¥è®©ç»„ä»¶æ›´å¥½ç®¡ç†</li><li>ä¿æŒäº§å“è¿­ä»£è¿‡ç¨‹ä¸­å“ç‰Œä¸€è‡´æ€§</li></ul><p>å»ºç«‹ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„è®¾è®¡è§„èŒƒéœ€è¦<code>UIè®¾è®¡å’Œå¼€å‘</code>çš„ç´§å¯†é…åˆï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç”±æˆ‘ä»¬å‰ç«¯æ¥æ¨åŠ¨ã€‚</p><p>æ¯”å¦‚å¾ˆå¤šå¼€æºçš„UIæ¡†æ¶ï¼Œä¸€å¼€å§‹éƒ½æ˜¯å¼€å‘è€…YYå‡ºæ¥çš„ï¼Œå¹¶æ²¡æœ‰è®¾è®¡å‚ä¸ï¼Œåæ¥ç»„ä»¶åº“æ…¢æ…¢æ²‰æ·€æˆå‹ï¼ŒUIè®¾è®¡å¸ˆæ‰ä»‹å…¥è§„èŒƒä¸€ä¸‹ã€‚</p><p>å¦‚æœä½ ä»¬å›¢é˜Ÿä¸æ‰“ç®—åˆ¶å®šè‡ªå·±çš„UIè®¾è®¡è§„èŒƒï¼Œåˆ™æ¨èä½¿ç”¨ç°æˆçš„å¼€æºç»„ä»¶åº“ï¼š</p><ul><li><a href="https://ant.design/index-cn" target="_blank" rel="noopener">Ant Design</a></li><li><a href="https://material-ui.com" target="_blank" rel="noopener">Material-UI</a></li><li><a href="https://element.eleme.io" target="_blank" rel="noopener">Element UI</a></li><li><a href="https://weui.io" target="_blank" rel="noopener">WeUI</a></li><li><a href="https://developer.microsoft.com/en-us/fabric#/" target="_blank" rel="noopener">Microsoft Fabric</a></li></ul><p>è¿™äº›å¼€æºç»„ä»¶åº“éƒ½ç»è¿‡è‰¯å¥½çš„è®¾è®¡å’Œæ²‰æ·€, è€Œä¸”é…å¥—äº†å®Œå–„çš„è®¾è®¡åŸåˆ™ã€æœ€ä½³å®è·µå’Œè®¾è®¡èµ„æºæ–‡ä»¶ï¼ˆSketch å’Œ Axureï¼‰ï¼Œå¯ä»¥å¸®åŠ©ä¸šåŠ¡å¿«é€Ÿè®¾è®¡å‡ºé«˜è´¨é‡çš„äº§å“åŸå‹ã€‚</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="8-æµ‹è¯•è§„èŒƒ"><a href="#8-æµ‹è¯•è§„èŒƒ" class="headerlink" title="8 æµ‹è¯•è§„èŒƒ"></a>8 æµ‹è¯•è§„èŒƒ</h2><p>æµ‹è¯•æ˜¯ä¿éšœä»£ç è´¨é‡çš„é‡è¦æ‰‹æ®µï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººæ„¿æ„åœ¨è¿™é‡ŒèŠ±å¤ªå¤šæ—¶é—´ã€‚</p><p>æ¯”å¦‚ç¬”è€…ï¼Œæˆ‘å¾ˆå°‘ä¼šå»ç»™ä¸šåŠ¡ä»£ç å’Œç»„ä»¶å†™å•å…ƒæµ‹è¯•ï¼Œé™¤éè‡ªå·±å¯¹ä»£ç éå¸¸æ²¡æœ‰ä¿¡å¿ƒï¼ŒæŒ‰ç…§æˆ‘çš„ç†å¿µå†™æµ‹è¯•ä¸å¦‚å°†ä»£ç å†™å¾—æ›´ç®€å•ä¸€ç‚¹ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªå‡½æ•°æ‹†åˆ†ä¸ºæ›´å°çš„å‡½æ•°ï¼Œä¿æŒå•ä¸€èŒè´£ã€‚</p><p>ä½†æ˜¯<strong>å¯¹äºä¸€äº›åº•å±‚ã€å…±äº«çš„ä»£ç æ¨¡å—è¿˜æ˜¯æœ‰æµ‹è¯•çš„å¿…è¦çš„</strong>ã€‚</p><p>æˆ‘åœ¨<a href="https://juejin.im/post/5d2c515d6fb9a07ead5a2bbe" target="_blank" rel="noopener">ä¸çŸ¥é“æµ‹è¯•ä»€ä¹ˆï¼Ÿè¿™äº›æ˜¯ä½ éœ€è¦çŸ¥é“çš„è½¯ä»¶æµ‹è¯•ç±»å‹å’Œå¸¸è¯†</a>æ–‡ç« ä¸­ï¼Œåˆ—ä¸¾äº†ä¸€äº›å¼€å‘è€…éœ€è¦å…³æ³¨çš„æµ‹è¯•ç±»å‹å’Œå¸¸è¯†, å¦‚æœæŒ‰ç…§æµ‹è¯•çš„é˜¶æ®µè¿›è¡Œåˆ†ç±»ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å­çš„:</p><p><img src="/images/frontend-standard/testing.png" alt></p><p><br></p><p>å…¶ä¸­å‰ç«¯å¼€å‘è€…éœ€è¦å…³æ³¨çš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æµ‹è¯•ç±»å‹:</p><ul><li><strong>å•å…ƒæµ‹è¯•</strong>: å¯¹ç‹¬ç«‹çš„è½¯ä»¶æ¨¡å—è¿›è¡Œæµ‹è¯•<ul><li><strong>UIç»„ä»¶æµ‹è¯•</strong>: åŒ…æ‹¬äº†å¿«ç…§(Snapshot)æµ‹è¯•</li></ul></li><li><strong>é›†æˆæµ‹è¯•</strong>: åœ¨å•å…ƒæµ‹è¯•çš„åŸºç¡€ä¸Šï¼Œå°†æ¨¡å—ç»„åˆèµ·æ¥ï¼Œæµ‹è¯•å®ƒä»¬çš„ç»„åˆæ€§</li><li><strong>E2Eæµ‹è¯•</strong>: åœ¨å®Œæ•´ã€çœŸå®çš„è¿è¡Œç¯å¢ƒä¸‹æ¨¡æ‹ŸçœŸå®ç”¨æˆ·å¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ã€‚<strong>ä¸»è¦æµ‹è¯•å‰ç«¯å’Œåç«¯çš„åè°ƒæ€§</strong></li><li><strong>å…¼å®¹æ€§æµ‹è¯•</strong>: ä¸Šé¢æåˆ°äº†æµè§ˆå™¨å…¼å®¹è§„èŒƒï¼Œåœ¨å°†ç‰ˆæœ¬æäº¤ç»™æµ‹è¯•/å‘å¸ƒä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿èƒ½ç¬¦åˆå…¼å®¹æ€§è¦æ±‚</li><li><strong>æ€§èƒ½æµ‹è¯•</strong>: æµ‹è¯•å’Œåˆ†ææ˜¯å¦å­˜åœ¨æ€§èƒ½é—®é¢˜</li><li><strong>å…¶ä»–</strong>:<ul><li>å®‰å…¨æµ‹è¯•</li><li>SEOæµ‹è¯•</li></ul></li></ul><p>å› ä¸ºå¯¹äºå°å…¬å¸æ¥è¯´æ•´ä¸ªè½¯ä»¶å¼€å‘æµç¨‹å¯èƒ½æ²¡æœ‰é‚£ä¹ˆè§„èŒƒï¼Œæ¯”å¦‚å¾ˆéš¾æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç«¯å¯¹ç«¯æµ‹è¯•ç¯å¢ƒï¼Œè¿™äº›éƒ½ä¸æ˜¯å‰ç«¯å›¢é˜Ÿå¯ä»¥æ“ä½œçš„èŒƒå›´, æ‰€ä»¥è‡ªåŠ¨åŒ–æµ‹è¯•å¾ˆéš¾æ¨è¡Œã€‚ä½†æ˜¯å¯ä»¥æ ¹æ®å›¢é˜Ÿå’Œä¸šåŠ¡æƒ…å†µé€æ­¥è¿›è¡Œå¼€å±•ã€‚</p><p>å¯å®æ–½æ€§æ¯”è¾ƒé«˜çš„, ä¹Ÿæ¯”è¾ƒç®€å•æ˜¯å•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿé‡ç‚¹å…³æ³¨å•å…ƒæµ‹è¯•.</p><p><br></p><h3 id="8-1-æµ‹è¯•çš„æµç¨‹"><a href="#8-1-æµ‹è¯•çš„æµç¨‹" class="headerlink" title="8.1 æµ‹è¯•çš„æµç¨‹"></a>8.1 æµ‹è¯•çš„æµç¨‹</h3><p>é¦–å…ˆè¦å®šä¹‰ä¸€ä¸ªåˆé€‚çš„è½¯ä»¶æµ‹è¯•æµç¨‹, åˆé€‚çš„æµ‹è¯•æµç¨‹å¯ä»¥é™ä½å¼€å‘å’Œæµ‹è¯•å›¢é˜Ÿä¹‹é—´çš„æ²Ÿé€šåä½œæˆæœ¬ã€æé«˜æµ‹è¯•æ•ˆç‡ã€‚ä¾‹å¦‚æˆ‘ä»¬å›¢é˜Ÿç›®å‰çš„æµ‹è¯•æµç¨‹:</p><p><img src="/images/frontend-standard/test-proc.png" alt></p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="8-2-å•å…ƒæµ‹è¯•"><a href="#8-2-å•å…ƒæµ‹è¯•" class="headerlink" title="8.2 å•å…ƒæµ‹è¯•"></a>8.2 å•å…ƒæµ‹è¯•</h3><p>å•å…ƒæµ‹è¯•æœ‰å¾ˆå¤š<strong>å¥½å¤„</strong>, æ¯”å¦‚:</p><ul><li><strong>æé«˜ä¿¡å¿ƒï¼Œé€‚åº”å˜åŒ–å’Œè¿­ä»£</strong>. å¦‚æœç°æœ‰ä»£ç æœ‰è¾ƒä¸ºå®Œå–„çš„å•å…ƒæµ‹è¯•ï¼Œåœ¨ä»£ç é‡æ„æ—¶ï¼Œå¯ä»¥æ£€éªŒæ¨¡å—æ˜¯å¦ä¾ç„¶å¯ä»¥å·¥ä½œ, ä¸€æ—¦å˜æ›´å¯¼è‡´é”™è¯¯ï¼Œå•å…ƒæµ‹è¯•ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½å¹¶ä¿®å¤é”™è¯¯</li><li><strong>å•å…ƒæµ‹è¯•æ˜¯é›†æˆæµ‹è¯•çš„åŸºç¡€</strong></li><li><strong>æµ‹è¯•å³æ–‡æ¡£</strong>ã€‚å¦‚æœæ–‡æ¡£ä¸èƒ½è§£å†³ä½ çš„é—®é¢˜ï¼Œåœ¨ä½ æ‰“ç®—çœ‹æºç ä¹‹å‰ï¼Œå¯ä»¥æŸ¥çœ‹å•å…ƒæµ‹è¯•ã€‚é€šè¿‡è¿™äº›æµ‹è¯•ç”¨ä¾‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç›´è§‚åœ°ç†è§£ç¨‹åºå•å…ƒçš„åŸºç¡€API</li><li><strong>æå‡ä»£ç è´¨é‡ã€‚æ˜“äºæµ‹è¯•çš„ä»£ç ï¼Œä¸€èˆ¬éƒ½æ˜¯å¥½ä»£ç </strong></li></ul><p><br></p><p><strong>æµ‹ä»€ä¹ˆ?</strong></p><p>ä¸šåŠ¡ä»£ç æˆ–ä¸šåŠ¡ç»„ä»¶æ˜¯æ¯”è¾ƒéš¾ä»¥å®æ–½å•å…ƒæµ‹è¯•çš„ï¼Œä¸€æ–¹é¢å®ƒä»¬æ¯”è¾ƒå¤šå˜ã€å¦ä¸€æ–¹é¢å¾ˆå¤šå›¢é˜Ÿå¾ˆå°‘æœ‰ç²¾åŠ›ç»´æŠ¤è¿™éƒ¨åˆ†å•å…ƒæµ‹è¯•ã€‚æ‰€ä»¥<strong>é€šå¸¸åªè¦æ±‚å¯¹ä¸€äº›åŸºç¡€/åº•å±‚çš„ç»„ä»¶ã€æ¡†æ¶æˆ–è€…æœåŠ¡è¿›è¡Œæµ‹è¯•, è§†æƒ…å†µè€ƒè™‘æ˜¯å¦è¦æµ‹è¯•ä¸šåŠ¡ä»£ç </strong></p><p><br></p><p><strong>æµ‹è¯•çš„å‡†åˆ™</strong>:</p><ul><li>æ¨èPetrowareçš„<a href="https://petroware.no/unittesting.html" target="_blank" rel="noopener">Unit Testing Guidelines</a>, æ€»ç»“äº†27æ¡å•å…ƒæµ‹è¯•å‡†åˆ™ï¼Œéå¸¸å—ç”¨.</li><li>å¦å¤–&lt;é˜¿é‡Œå·´å·´çš„Javaå¼€å‘æ‰‹å†Œ&gt;ä¸­æ€»ç»“çš„<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.md" target="_blank" rel="noopener">å•å…ƒæµ‹è¯•å‡†åˆ™</a>, ä¹Ÿä¸é”™ï¼Œè™½ç„¶ä¹¦åæ˜¯Javaï¼Œå‡†åˆ™æ˜¯é€šç”¨çš„.</li></ul><p><br></p><p><strong>å•å…ƒæµ‹è¯•æŒ‡æ ‡</strong>:</p><p>ä¸€èˆ¬ä½¿ç”¨<a href="https://zh.wikipedia.org/wiki/ä»£ç¢¼è¦†è“‹ç‡" target="_blank" rel="noopener"><code>æµ‹è¯•è¦†ç›–ç‡</code></a>æ¥é‡åŒ–ï¼Œå°½ç®¡å¯¹äºè¦†ç›–ç‡èƒ½ä¸èƒ½è¡¡é‡å•å…ƒæµ‹è¯•çš„æœ‰æ•ˆæ€§å­˜åœ¨è¾ƒå¤šäº‰è®®ã€‚</p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿˜æ˜¯æ¨èå°½å¯èƒ½æé«˜è¦†ç›–ç‡, æ¯”å¦‚è¦æ±‚<code>è¯­å¥è¦†ç›–ç‡è¾¾åˆ°70%ï¼›æ ¸å¿ƒæ¨¡å—çš„è¯­å¥è¦†ç›–ç‡å’Œåˆ†æ”¯è¦†ç›–ç‡éƒ½è¦è¾¾åˆ°100%</code>. è§†å›¢é˜Ÿæƒ…å†µè€Œå®š</p><p>æ‰©å±•:</p><ul><li><a href="https://www.infoq.cn/article/test-coverage-rate-role" target="_blank" rel="noopener">æµ‹è¯•è¦†ç›–ï¼ˆç‡ï¼‰åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></li></ul><p><br></p><p><strong>ç›¸å…³å·¥å…·</strong></p><ul><li>Headless Browsers: æ— å¤´æµè§ˆå™¨æ˜¯ç½‘é¡µè‡ªåŠ¨åŒ–çš„é‡è¦è¿è¡Œç¯å¢ƒã€‚ å¸¸ç”¨äºåŠŸèƒ½æµ‹è¯•ã€å•å…ƒæµ‹è¯•ã€ç½‘ç»œçˆ¬è™«<ul><li><a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">puppeteer</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/lkgr/headless/README.md" target="_blank" rel="noopener">Headless Chromium</a></li></ul></li><li>æµ‹è¯•æ¡†æ¶<ul><li><a href="http://jest.io/" target="_blank" rel="noopener">Jest</a> ğŸ”¥Facebookçš„å•å…ƒæµ‹è¯•æ¡†æ¶. é›¶é…ç½®, æ”¯æŒç»„ä»¶å¿«ç…§æµ‹è¯•ã€æ¨¡å—Mockã€Spy. ä¸€èˆ¬åœºæ™¯, å•å…ƒæµ‹è¯•å­¦å®ƒä¸€ä¸ªå°±è¡Œäº†<ul><li>ç»„ä»¶æµ‹è¯•<ul><li><a href="https://github.com/testing-library" target="_blank" rel="noopener">testing-library</a> ğŸ”¥</li><li><a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener">Enzyme</a></li></ul></li></ul></li><li><a href="https://theintern.github.io/" target="_blank" rel="noopener">Intern</a></li></ul></li><li>å•å…ƒæµ‹è¯•<ul><li><a href="https://github.com/avajs/ava" target="_blank" rel="noopener">AVA</a></li><li><a href="http://jasmine.github.io/" target="_blank" rel="noopener">Jasmine</a></li><li><a href="http://mochajs.org/" target="_blank" rel="noopener">Mocha</a></li><li><a href="https://github.com/substack/tape" target="_blank" rel="noopener">Tape</a></li></ul></li><li>æ–­è¨€åº“<ul><li><a href="http://chaijs.com/" target="_blank" rel="noopener">Chai</a></li><li><a href="https://github.com/Automattic/expect.js" target="_blank" rel="noopener">expect.js</a></li><li><a href="http://shouldjs.github.io/" target="_blank" rel="noopener">should.js</a></li></ul></li><li>Mock/Stubs/Spies<ul><li><a href="http://sinonjs.org/" target="_blank" rel="noopener">sinon.js</a></li></ul></li><li>ä»£ç è¦†ç›–ç‡<ul><li><a href="https://github.com/gotwarlost/istanbul" target="_blank" rel="noopener">istanbul</a></li></ul></li><li>åŸºå‡†æµ‹è¯•<ul><li><a href="http://benchmarkjs.com/" target="_blank" rel="noopener">benchmark.js</a></li><li><a href="https://jsperf.com/" target="_blank" rel="noopener">jsperf.com</a></li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="9-å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ"><a href="#9-å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ" class="headerlink" title="9 å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ"></a>9 å¼‚å¸¸å¤„ç†ã€ç›‘æ§å’Œè°ƒè¯•è§„èŒƒ</h2><p>å¾ˆå¤šå¼€å‘è€…å¸¸å¸¸è¯¯ç”¨æˆ–è€…è½»è§†å¼‚å¸¸çš„å¤„ç†, åˆç†æœ‰æ•ˆçš„å¼‚å¸¸å¤„ç†å¯ä»¥æé«˜åº”ç”¨çš„å¥å£®æ€§å’Œå¯ç”¨æ€§ï¼Œå¦å¤–è¿˜å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å¼‚å¸¸.</p><h3 id="9-1-å¼‚å¸¸å¤„ç†"><a href="#9-1-å¼‚å¸¸å¤„ç†" class="headerlink" title="9.1 å¼‚å¸¸å¤„ç†"></a>9.1 å¼‚å¸¸å¤„ç†</h3><p>&lt;é˜¿é‡Œå·´å·´çš„Javaå¼€å‘æ‰‹å†Œ&gt;ä¸­æ€»ç»“çš„<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.md" target="_blank" rel="noopener">å¼‚å¸¸å¤„ç†è§„èŒƒ</a>å¯¹JavaScriptçš„å¼‚å¸¸å¤„ç†ä¹Ÿå¾ˆæœ‰å‚è€ƒæ„ä¹‰ï¼Œæ¯”å¦‚:</p><ul><li>å¼‚å¸¸ä¸è¦ç”¨æ¥åšæµç¨‹æ§åˆ¶ï¼Œæ¡ä»¶æ§åˆ¶ã€‚</li><li>æ•è·å¼‚å¸¸æ˜¯ä¸ºäº†å¤„ç†å®ƒï¼Œä¸è¦æ•è·äº†å´ä»€ä¹ˆéƒ½ä¸å¤„ç†è€ŒæŠ›å¼ƒä¹‹ï¼Œå¦‚æœä¸æƒ³å¤„ç†å®ƒï¼Œè¯·å°†è¯¥å¼‚å¸¸æŠ›ç»™å®ƒçš„è°ƒç”¨è€…ã€‚æœ€å¤–å±‚çš„ä¸šåŠ¡ä½¿ç”¨è€…ï¼Œå¿…é¡»å¤„ç†å¼‚å¸¸ï¼Œå°†å…¶è½¬åŒ–ä¸ºç”¨æˆ·å¯ä»¥ç†è§£çš„å†…å®¹ã€‚</li><li>catchæ—¶è¯·åˆ†æ¸…ç¨³å®šä»£ç å’Œéç¨³å®šä»£ç ï¼Œç¨³å®šä»£ç æŒ‡çš„æ˜¯æ— è®ºå¦‚ä½•ä¸ä¼šå‡ºé”™çš„ä»£ç ã€‚å¯¹äºéç¨³å®šä»£ç çš„catchå°½å¯èƒ½è¿›è¡ŒåŒºåˆ†å¼‚å¸¸ç±»å‹ï¼Œå†åšå¯¹åº”çš„å¼‚å¸¸å¤„ç†ã€‚ä¸è¦å¯¹å¤§æ®µä»£ç è¿›è¡Œtry-catch</li><li>â€¦</li></ul><p>ç„¶åå†æ ¹æ®JavaScriptæœ¬èº«çš„å¼‚å¸¸å¤„ç†ç‰¹ç‚¹æ€»ç»“ä¸€äº›è§„èŒƒè¡Œä¸º, ä¾‹å¦‚:</p><ul><li>ä¸è¦throwéErrorå¯¹è±¡</li><li>ä¸è¦å¿½ç•¥å¼‚æ­¥å¼‚å¸¸</li><li>å…¨å±€ç›‘æ§Javascriptå¼‚å¸¸</li><li>â€¦</li></ul><p><br></p><p>èµ„æº:</p><ul><li><a href="https://rollbar.com/blog/top-10-javascript-errors/" target="_blank" rel="noopener">ä»1000+ä¸ªé¡¹ç›®ä¸­æ€»ç»“å‡ºæ¥çš„å‰10ä¸ªJavaScripté”™è¯¯, ä»¥åŠå¦‚ä½•é¿å…å®ƒä»¬</a></li><li><a href="https://levelup.gitconnected.com/the-definite-guide-to-handling-errors-gracefully-in-javascript-58424d9c60e6" target="_blank" rel="noopener">Javascriptå¼‚å¸¸å¤„ç†â€˜æƒå¨â€™æŒ‡å—</a></li><li><a href="https://zhuanlan.zhihu.com/p/63698500" target="_blank" rel="noopener">å‰ç«¯å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="9-2-æ—¥å¿—"><a href="#9-2-æ—¥å¿—" class="headerlink" title="9.2 æ—¥å¿—"></a>9.2 æ—¥å¿—</h3><p>å¯¹äºå‰ç«¯æ¥è¯´ï¼Œæ—¥å¿—ä¹Ÿä¸æ˜¯æ¯«æ— æ„ä¹‰(å¾ˆå¤šæ¡†æ¶æ€§èƒ½ä¼˜åŒ–å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒç§»é™¤console)ã€‚å°¤å…¶æ˜¯åœ¨<strong>ç”Ÿäº§ç°åœº</strong>è°ƒè¯•ä»£ç æ—¶ï¼Œè¿™æ—¶å€™å¯è´µçš„æ§åˆ¶å°æ—¥å¿—å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°å¼‚å¸¸çš„çº¿ç´¢.</p><p>ä¸è¿‡é€šå¸¸æˆ‘ä»¬<strong>åªè¦ä¿ç•™å¿…è¦çš„ã€æœ‰æ„ä¹‰çš„æ—¥å¿—è¾“å‡º</strong>ï¼Œæ¯”å¦‚ä½ ä¸åº”è¯¥å°†console.logæ”¾åˆ°ä¸€ä¸ªReactæ¸²æŸ“å‡½æ•°ä¸­ã€æˆ–è€…æ”¾åˆ°ä¸€ä¸ªå¾ªç¯ä¸­, <strong>DDoså¼çš„æ—¥å¿—ä¿¡æ¯å¹¶ä¸èƒ½å¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜ï¼Œåè€Œä¼šå½±å“è¿è¡Œçš„æ€§èƒ½</strong>. æ‰€ä»¥éœ€è¦ä¸€ä¸ªè§„èŒƒæ¥çº¦æŸæ—¥å¿—è¾“å‡ºè¡Œä¸º, æ¯”å¦‚:</p><ul><li>é¿å…é‡å¤æ‰“å°æ—¥å¿—</li><li>è°¨æ…åœ°è®°å½•æ—¥å¿—, åˆ’åˆ†æ—¥å¿—çº§åˆ«ã€‚æ¯”å¦‚ç”Ÿäº§ç¯å¢ƒç¦æ­¢è¾“å‡ºdebugæ—¥å¿—ï¼›æœ‰é€‰æ‹©åœ°è¾“å‡ºinfoæ—¥å¿—ï¼›</li><li>ä½¿ç”¨å‰ç¼€å¯¹æ—¥å¿—è¿›è¡Œåˆ†ç±», ä¾‹å¦‚: <code>[User] xxxx</code></li><li>åªè®°å½•å…³é”®ä¿¡æ¯, è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©ä½ è¯Šæ–­é—®é¢˜</li><li>â€¦</li></ul><p>æ‰©å±•èµ„æº</p><ul><li><a href="https://github.com/visionmedia/debug" target="_blank" rel="noopener">debug</a> é€‚åˆNode.jså’Œæµè§ˆå™¨çš„debugæ—¥å¿—å·¥å…·, æ”¯æŒåŠ¨æ€å¼€å¯æ—¥å¿—æ‰“å°</li><li><a href="https://github.com/Tencent/vConsole" target="_blank" rel="noopener">vConsole</a> ç§»åŠ¨ç«¯è°ƒè¯•åˆ©å™¨</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="9-3-å¼‚å¸¸ç›‘æ§"><a href="#9-3-å¼‚å¸¸ç›‘æ§" class="headerlink" title="9.3 å¼‚å¸¸ç›‘æ§"></a>9.3 å¼‚å¸¸ç›‘æ§</h3><p>å› ä¸ºç¨‹åºè·‘åœ¨ä¸å—æ§çš„ç¯å¢ƒï¼Œæ‰€ä»¥å¯¹äºå®¢æˆ·ç«¯åº”ç”¨æ¥è¯´ï¼Œå¼‚å¸¸ç›‘æ§åœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥æ”¶é›†å„ç§æ„æ–™ä¹‹å¤–ç”Ÿäº§ç¯å¢ƒé—®é¢˜ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å¼‚å¸¸ã€‚</p><p><br></p><p>å¼‚å¸¸ç›‘æ§é€šå¸¸ä¼šé€šè¿‡ä¸‰ç§æ–¹å¼æ¥æ”¶é›†å¼‚å¸¸æ•°æ®:</p><ol><li>å…¨å±€æ•è·ã€‚ä¾‹å¦‚ä½¿ç”¨window.onerror, æˆ–è€…<code>unhandledrejection</code></li><li>ä¸»åŠ¨ä¸ŠæŠ¥ã€‚åœ¨try/catchä¸­ä¸»åŠ¨ä¸ŠæŠ¥. </li><li>ç”¨æˆ·åé¦ˆã€‚æ¯”å¦‚å¼¹çª—è®©ç”¨æˆ·å¡«å†™åé¦ˆä¿¡æ¯.</li></ol><p>å’Œæ—¥å¿—ä¸€æ ·ï¼Œ<strong>ä¸æ˜¯æ‰€æœ‰â€˜å¼‚å¸¸â€™éƒ½åº”è¯¥ä¸ŠæŠ¥ç»™å¼‚å¸¸ç›‘æ§ç³»ç»Ÿï¼Œè­¬å¦‚ä¸€äº›é¢„æ–™ä¹‹å†…çš„â€˜å¼‚å¸¸â€™</strong>ï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥é”™è¯¯ã€é‰´æƒå¤±è´¥ã€ç½‘ç»œé”™è¯¯ç­‰ç­‰. <strong>å¼‚å¸¸ç›‘æ§ä¸»è¦ç”¨æ¥ä¸ŠæŠ¥ä¸€äº›æ„æ–™ä¹‹å¤–çš„ã€æˆ–è€…è‡´å‘½æ€§çš„å¼‚å¸¸</strong>.</p><p><br></p><p>è¦åšå¥½å‰ç«¯çš„å¼‚å¸¸ç›‘æ§å…¶å®å¹¶ä¸å®¹æ˜“ï¼Œå®ƒéœ€è¦å¤„ç†è¿™äº›ä¸œè¥¿:</p><ul><li>æµè§ˆå™¨å…¼å®¹æ€§ã€‚</li><li>ç¢ç‰‡æ”¶é›†(breadcrumbs)ã€‚ æ”¶é›†â€˜ç¾éš¾â€™ç°åœºçš„ä¸€äº›çº¿ç´¢ï¼Œè¿™äº›çº¿ç´¢å¯¹é—®é¢˜è¯Šæ–­å¾ˆé‡è¦ã€‚ä¾‹å¦‚å½“å‰ç”¨æˆ·ä¿¡æ¯ã€ç‰ˆæœ¬ã€è¿è¡Œç¯å¢ƒã€æ‰“å°çš„æ—¥å¿—ã€å‡½æ•°è°ƒç”¨æ ˆç­‰ç­‰</li><li>è°ƒç”¨æ ˆçš„è½¬æ¢ã€‚é€šå¸¸åœ¨æµè§ˆå™¨è¿è¡Œçš„å‹ç¼©ä¼˜åŒ–è¿‡çš„ä»£ç ï¼Œè¿™ç§è°ƒç”¨æ ˆåŸºæœ¬æ²¡ä»€ä¹ˆå¯è¯»æ€§ï¼Œé€šå¸¸éœ€è¦é€šè¿‡SourceMapæ˜ å°„åˆ°åŸå§‹ä»£ç . å¯ä»¥ä½¿ç”¨è¿™ä¸ªåº“: <a href="https://github.com/mozilla/source-map#sourcemapconsumer" target="_blank" rel="noopener">source-map</a></li><li>æ•°æ®çš„èšåˆã€‚åç«¯ç›‘æ§ç³»ç»Ÿéœ€è¦å¯¹å‰ç«¯ä¸ŠæŠ¥çš„ä¿¡æ¯è¿›è¡Œåˆ†æå’Œèšåˆ</li></ul><p><br></p><p>å¯¹äºå°å›¢é˜Ÿæœªå¿…æœ‰èƒ½åŠ›å¼€å‘è¿™ä¸€å¥—ç³»ç»Ÿï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ä¾‹å¦‚</p><ul><li><a href="https://sentry.io/welcome/" target="_blank" rel="noopener">Sentry</a> ğŸ”¥å…è´¹åŸºæœ¬å¤Ÿç”¨</li><li><a href="https://www.fundebug.com/price" target="_blank" rel="noopener">FunDebug</a> ä»˜è´¹å¢å¼º</li></ul><p><strong>æ‰©å±•</strong>:</p><ul><li><a href="https://cdc.tencent.com/2018/09/13/frontend-exception-monitor-research/" target="_blank" rel="noopener">å‰ç«¯å¼‚å¸¸ç›‘æ§è§£å†³æ–¹æ¡ˆç ”ç©¶</a></li><li><a href="https://www.cnblogs.com/warm-stranger/p/9417084.html" target="_blank" rel="noopener">æ­å»ºå‰ç«¯ç›‘æ§ç³»ç»Ÿ</a></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="10-å‰åç«¯åä½œè§„èŒƒ"><a href="#10-å‰åç«¯åä½œè§„èŒƒ" class="headerlink" title="10 å‰åç«¯åä½œè§„èŒƒ"></a>10 å‰åç«¯åä½œè§„èŒƒ</h2><p>å‰ç«¯æ˜¯Webçš„ä¸€ä¸ªç»†åˆ†é¢†åŸŸï¼Œå¾€å¾€ä¸èƒ½è„±ç¦»åç«¯è€Œå­˜åœ¨ã€‚æ‰€ä»¥å’Œåç«¯åä½œçš„æ—¶é—´æ˜¯æœ€é•¿çš„.</p><h3 id="10-1-åä½œæµç¨‹è§„èŒƒ"><a href="#10-1-åä½œæµç¨‹è§„èŒƒ" class="headerlink" title="10.1 åä½œæµç¨‹è§„èŒƒ"></a>10.1 åä½œæµç¨‹è§„èŒƒ</h3><p>å‰åç«¯å›¢é˜Ÿç»è¿‡é•¿æœŸçš„åˆä½œï¼Œä¸€èˆ¬å¯ä»¥æ€»ç»“å‡ºä¸€æ¡å¯¹äºåŒæ–¹å¼€å‘æ•ˆç‡æœ€ä¼˜çš„åä½œæµç¨‹. å°†è¿™ä¸ªè½å®ä¸ºè§„èŒƒï¼Œåé¢çš„å›¢é˜Ÿæˆå‘˜éƒ½éµå¾ªè¿™ä¸ªæ­¥è°ƒè¿›è¡Œåä½œã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„å‰åç«¯åä½œæµç¨‹å¦‚ä¸‹:</p><p><img src="/images/frontend-standard/f-b.png" alt></p><ol><li>éœ€æ±‚åˆ†æã€‚å‚ä¸è€…ä¸€èˆ¬æœ‰å‰åç«¯ã€æµ‹è¯•ã€ä»¥åŠäº§å“. ç”±äº§å“ä¸»æŒï¼Œå¯¹éœ€æ±‚è¿›è¡Œå®£è´¯ï¼Œæ¥å—å¼€å‘å’Œæµ‹è¯•çš„åé¦ˆï¼Œç¡®ä¿å¤§å®¶å¯¹éœ€æ±‚æœ‰ä¸€è‡´çš„è®¤çŸ¥</li><li>å‰åç«¯å¼€å‘è®¨è®ºã€‚è®¨è®ºåº”ç”¨çš„ä¸€äº›å¼€å‘è®¾è®¡ï¼Œæ²Ÿé€šæŠ€æœ¯ç‚¹ã€éš¾ç‚¹ã€ä»¥åŠåˆ†å·¥é—®é¢˜.</li><li>è®¾è®¡æ¥å£æ–‡æ¡£ã€‚å¯ä»¥ç”±å‰åç«¯ä¸€èµ·è®¾è®¡ï¼›æˆ–è€…ç”±åç«¯è®¾è®¡ã€å‰ç«¯ç¡®è®¤æ˜¯å¦ç¬¦åˆè¦æ±‚</li><li>å¹¶è¡Œå¼€å‘ã€‚å‰åç«¯å¹¶è¡Œå¼€å‘ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå‰ç«¯å¯ä»¥å…ˆå®ç°é™æ€é¡µé¢; æˆ–è€…æ ¹æ®æ¥å£æ–‡æ¡£å¯¹æ¥å£è¿›è¡ŒMock, æ¥æ¨¡æ‹Ÿå¯¹æ¥åç«¯æ¥å£</li><li>åœ¨è”è°ƒä¹‹å‰ï¼Œè¦æ±‚åç«¯åšå¥½æ¥å£æµ‹è¯•</li><li>çœŸå®ç¯å¢ƒè”è°ƒã€‚å‰ç«¯å°†æ¥å£è¯·æ±‚ä»£ç†åˆ°åç«¯æœåŠ¡ï¼Œè¿›è¡ŒçœŸå®ç¯å¢ƒè”è°ƒã€‚</li></ol><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="10-2-æ¥å£è§„èŒƒ"><a href="#10-2-æ¥å£è§„èŒƒ" class="headerlink" title="10.2 æ¥å£è§„èŒƒ"></a>10.2 æ¥å£è§„èŒƒ</h3><p>é¦–å…ˆåº”è¯¥ç¡®å®šä¸‹æ¥çš„æ˜¯æ¥å£è§„èŒƒã€‚å…¶å®ä½¿ç”¨å“ªç§æ¥å£æ ‡å‡†æ˜¯å…¶æ¬¡ï¼Œé‡è¦çš„æ˜¯ç»Ÿä¸€ï¼Œä¸”è¦æ»¡è¶³å‰åç«¯çš„å¼€å‘æ•ˆç‡è¦æ±‚.</p><p>ç¬”è€…ä¸å»ºè®®åç«¯å»å®šä¹‰è‡ªå·±çš„æ¥å£æ ‡å‡†ï¼Œè€Œåº”è¯¥å»é€‰æ‹©ä¸€äº›é€šç”¨çš„ã€æœ‰æ ‡å‡†å®šä¹‰æ¥å£å½¢å¼, ä¾‹å¦‚:</p><ul><li><p><a href="https://zh.wikipedia.org/zh-hans/è¡¨ç°å±‚çŠ¶æ€è½¬æ¢" target="_blank" rel="noopener">RESTful</a>: RESTfulæ˜¯ç›®å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„APIè®¾è®¡è§„èŒƒ, åŸºäºHTTPæœ¬èº«çš„æœºåˆ¶æ¥å®ç°. </p><p>ç¬”è€…ä¸ªäººæ˜¯æ¯”è¾ƒå–œæ¬¢è¿™ä¸ªAPIè§„èŒƒï¼Œä½†æ˜¯æˆ‘å‘ç°å¾ˆå¤šå¼€å‘è€…å¹¶ä¸èƒ½çœŸæ­£(æˆ–è€…è¯´æ²¡å¿ƒæ€)ç†è§£å®ƒï¼Œè®¾è®¡å‡ºæ¥çš„æ¥å£ï¼Œè·Ÿæˆ‘æƒ³è±¡çš„ç›¸å·®ç”šè¿œã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºRESTfulï¼Œå¼€å‘è€…ä¹‹é—´å¾ˆéš¾è¾¾æˆä¸€è‡´çš„ç†è§£ï¼Œå®¹æ˜“äº§ç”Ÿåˆ†æ­§ã€‚</p><p>å› ä¸ºæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„APIå½¢å¼ï¼Œæ‰€ä»¥ç¤¾åŒºä¸Šæœ‰å¾ˆå¤šå·¥å…·æ¥å¯¹RESTfulæ¥å£è¿›è¡Œæ–‡æ¡£åŒ–ã€æµ‹è¯•å’Œæ¨¡æ‹Ÿ.</p></li><li><p><a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">JSONRPC</a> è¿™æ˜¯ä¸€ç§éå¸¸ç®€å•ã€å®¹æ˜“ç†è§£çš„æ¥å£è§„èŒƒã€‚ç›¸å¯¹äºRESTfulæˆ‘æ›´æ¨èè¿™ä¸ªï¼Œç®€å•åˆ™ä¸å®¹æ˜“äº§ç”Ÿåˆ†æ­§ï¼Œæ–°æ‰‹ä¹Ÿå¯ä»¥å¾ˆå¿«æ¥å—.</p></li><li><a href="https://graphql.org/learn/" target="_blank" rel="noopener">GraphQL</a> ğŸ”¥æ›´ä¸ºå…ˆè¿›ã€æ›´æœ‰å‰æ™¯çš„APIè§„èŒƒã€‚ä½†æ˜¯ä½ è¦è¯´æœåç«¯é…åˆä½ ä½¿ç”¨è¿™ç§æ ‡å‡†å¯èƒ½å¾ˆæœ‰éš¾åº¦</li></ul><p><br></p><p><strong>æ¥å£è®¾è®¡éœ€è¦æ³¨æ„çš„ç‚¹</strong>:</p><ul><li>æ˜ç¡®åŒºåˆ†æ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸, ä¸¥æ ¼éµå¾ªæ¥å£çš„å¼‚å¸¸åŸè¯­. ä¸Šè¿°æ¥å£å½¢å¼éƒ½æœ‰æ˜ç¡®çš„å¼‚å¸¸åŸè¯­ï¼Œæ¯”å¦‚JSONRPCï¼Œå½“å‡ºç°å¼‚å¸¸æ—¶åº”è¯¥è¿”å›<code>é”™è¯¯å¯¹è±¡</code>å“åº”ï¼Œè€Œä¸æ˜¯åœ¨æ­£å¸¸çš„å“åº”ä½“ä¸­è¿”å›é”™è¯¯ä»£ç . å¦å¤–è¦è§„èŒƒåŒ–çš„é”™è¯¯ç , HTTPå“åº”ç å°±æ˜¯ä¸€ä¸ªä¸é”™çš„å­¦ä¹ å¯¹è±¡</li><li>æ˜ç¡®æ•°æ®ç±»å‹ã€‚å¾ˆå¤šåç«¯å†™çš„æ¥å£éƒ½æ˜¯stringå’Œnumberä¸åˆ†çš„ï¼Œå¦‚æœå¦¥åçš„è¯ã€å‰ç«¯å°±éœ€è¦é’ˆå¯¹è¿™ä¸ªå±æ€§åšç‰¹æ®Šå¤„ç†ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯æ½œåœ¨çš„bug</li><li>æ˜ç¡®ç©ºå€¼çš„æ„ä¹‰ã€‚æ¯”å¦‚åœ¨åšæ›´æ–°æ“ä½œæ˜¯ï¼Œç©ºå€¼æ˜¯è¡¨ç¤ºé‡ç½®ï¼Œè¿˜æ˜¯å¿½ç•¥æ›´æ–°ï¼Ÿ</li><li>å“åº”é¿å…å†—ä½™çš„åµŒå¥—ã€‚</li><li>æ¥å£ç‰ˆæœ¬åŒ–ï¼Œä¿æŒå‘ä¸‹å…¼å®¹ã€‚å°±åƒæˆ‘ä»¬ä¸Šæ–‡çš„â€˜è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒâ€™è¯´çš„ï¼Œå¯¹äºåç«¯æ¥è¯´ï¼ŒAPIå°±æ˜¯å…¬å…±çš„æ¥å£. å…¬å…±æš´éœ²çš„æ¥å£åº”è¯¥æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¥è¯´æ˜å½“å‰æè¿°çš„æ¥å£åšäº†ä»€ä¹ˆå˜åŠ¨ï¼Œæ˜¯å¦å‘ä¸‹å…¼å®¹ã€‚<br>ç°åœ¨å‰ç«¯ä»£ç å¯èƒ½ä¼šåœ¨å®¢æˆ·ç«¯è¢«ç¼“å­˜ï¼Œä¾‹å¦‚å°ç¨‹åºã€‚å¦‚æœåç«¯åšäº†break changeï¼Œå°±ä¼šå½±å“è¿™éƒ¨åˆ†ç”¨æˆ·ã€‚</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="10-3-æ¥å£æ–‡æ¡£è§„èŒƒ"><a href="#10-3-æ¥å£æ–‡æ¡£è§„èŒƒ" class="headerlink" title="10.3 æ¥å£æ–‡æ¡£è§„èŒƒ"></a>10.3 æ¥å£æ–‡æ¡£è§„èŒƒ</h3><p>åç«¯é€šè¿‡æ¥å£æ–‡æ¡£å‘å‰ç«¯æš´éœ²æ¥å£ç›¸å…³çš„ä¿¡æ¯ã€‚é€šå¸¸éœ€è¦åŒ…å«è¿™äº›ä¿¡æ¯ï¼š</p><ul><li>ç‰ˆæœ¬å·</li><li>æ–‡æ¡£æè¿°</li><li>æœåŠ¡çš„å…¥å£. ä¾‹å¦‚åŸºæœ¬è·¯å¾„</li><li>æµ‹è¯•æœåŠ¡å™¨. å¯é€‰</li><li>ç®€å•ä½¿ç”¨ç¤ºä¾‹</li><li>å®‰å…¨å’Œè®¤è¯</li><li>å…·ä½“æ¥å£å®šä¹‰<ul><li>æ–¹æ³•åç§°æˆ–è€…URL</li><li>æ–¹æ³•æè¿°</li><li>è¯·æ±‚å‚æ•°åŠå…¶æè¿°ï¼Œå¿…é¡»è¯´æ˜ç±»å‹(æ•°æ®ç±»å‹ã€æ˜¯å¦å¯é€‰ç­‰)</li><li>å“åº”å‚æ•°åŠå…¶æè¿°, å¿…é¡»è¯´æ˜ç±»å‹(æ•°æ®ç±»å‹ã€æ˜¯å¦å¯é€‰ç­‰)</li><li>å¯èƒ½çš„å¼‚å¸¸æƒ…å†µã€é”™è¯¯ä»£ç ã€ä»¥åŠæè¿°</li><li>è¯·æ±‚ç¤ºä¾‹ï¼Œå¯é€‰</li></ul></li></ul><p><strong>äººå·¥ç»´æŠ¤å¯¼è‡´çš„é—®é¢˜</strong>:</p><p>ä¸Šæ–‡â€˜ä»£ç å³æ–‡æ¡£â€™å°±æåˆ°äº†äººå·¥ç»´æŠ¤æ¥å£æ–‡æ¡£å¯èƒ½å¯¼è‡´ä»£ç å’Œæ–‡æ¡£ä¸åŒæ­¥é—®é¢˜ã€‚</p><p>å¦‚æœå¯ä»¥ä»ä»£ç æˆ–è€…è§„èŒƒæ–‡æ¡£(ä¾‹å¦‚OpenAPIè¿™ç±»APIæè¿°è§„èŒƒ)ä¸­ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œå¯ä»¥è§£å†³å®ç°å’Œæ–‡æ¡£ä¸ä¸€è‡´é—®é¢˜, åŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘æ–‡æ¡£ç¼–å†™å’Œç»´æŠ¤çš„æŠ•å…¥.</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="10-4-æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ"><a href="#10-4-æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ" class="headerlink" title="10.4 æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ"></a>10.4 æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿ</h3><p>ä¸ºäº†åšåˆ°é«˜æ•ˆç‡çš„å‰åç«¯å¹¶è¡Œå¼€å‘ï¼Œæ¥å£çš„æµ‹è¯•ä¸æ¨¡æ‹Ÿæ˜¯å¿…è¦çš„ã€‚</p><ul><li>å‰ç«¯è¦æ±‚åç«¯åœ¨è”è°ƒä¹‹å‰ï¼Œéœ€è¦æµ‹è¯•éªŒè¯å¥½è‡ªå·±çš„æ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œã€‚è€Œä¸æ˜¯åœ¨è”è°ƒæœŸé—´ï¼ŒæŠŠå‰ç«¯å½“â€˜æ¥å£æµ‹è¯•å‘˜â€™ï¼Œé˜»å¡æ¥å£è”è°ƒè¿›åº¦</li><li>å¦å¤–å‰ç«¯éœ€è¦åœ¨åç«¯æ¥å£æœªå‡†å¤‡å¥½ä¹‹å‰ï¼Œé€šè¿‡æ¥å£æ¨¡æ‹Ÿçš„æ–¹å¼ï¼Œæ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚</li></ul><p>é’ˆå¯¹æ¥å£æµ‹è¯•ä¸æ¨¡æ‹Ÿï¼Œå­˜åœ¨ä¸‹å›¾è¿™æ ·ä¸€ä¸ªç†æƒ³çš„æ¨¡å‹:</p><p><img src="/images/frontend-standard/api-mock.png" alt></p><p>ä¸€åˆ‡ä»å®šä¹‰è‰¯å¥½çš„æ¥å£æ–‡æ¡£å‡ºå‘ï¼Œç”Ÿæˆ<code>Mock Server</code>å’Œ<code>Mock Client</code>, Mock Serverç»™å‰ç«¯æä¾›æ¨¡æ‹Ÿæ•°æ®ï¼Œè€ŒMock Clientåˆ™è¾…åŠ©åç«¯å¯¹å®ƒä»¬çš„æ¥å£è¿›è¡Œæµ‹è¯•.</p><p>èµ„æº:</p><ul><li>RESTful<ul><li><a href="https://swagger.io/" target="_blank" rel="noopener">Swagger</a> è¿™æ˜¯æœ€ä¸ºæ¥è¿‘ä¸Šé¢ç†æƒ³æ¨¡å‹çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</li><li><a href="https://github.com/nuysoft/Mock" target="_blank" rel="noopener">JSON Server</a> å¿«é€Ÿç”ŸæˆJSON mockæœåŠ¡å™¨</li><li><a href="https://easy-mock.com" target="_blank" rel="noopener">Easy Mock</a> å¯è§†åŒ–çš„ã€åœ¨çº¿çš„æ¥å£mockæœåŠ¡</li></ul></li><li>GraphQl<ul><li><a href="https://github.com/APIs-guru/graphql-faker" target="_blank" rel="noopener">GraphQL Faker</a></li><li><a href="https://www.apollographql.com/docs/graphql-tools/mocking/" target="_blank" rel="noopener">graphql-tools</a></li></ul></li><li>æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ<ul><li><a href="https://github.com/Marak/faker.js" target="_blank" rel="noopener">faker.js</a> ğŸ”¥å¼ºå¤§çš„æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒNodeå’Œæµè§ˆå™¨</li><li><a href="https://github.com/nuysoft/Mock" target="_blank" rel="noopener">Mock.js</a> æ•°æ®ç”Ÿæˆå’Œæ¨¡æ‹Ÿå·¥å…·</li></ul></li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="11-åŸ¹è®­-çŸ¥è¯†ç®¡ç†-æŠ€æœ¯æ²‰æ·€"><a href="#11-åŸ¹è®­-çŸ¥è¯†ç®¡ç†-æŠ€æœ¯æ²‰æ·€" class="headerlink" title="11 åŸ¹è®­/çŸ¥è¯†ç®¡ç†/æŠ€æœ¯æ²‰æ·€"></a>11 åŸ¹è®­/çŸ¥è¯†ç®¡ç†/æŠ€æœ¯æ²‰æ·€</h2><p>æˆ‘è§‰å¾—ä¸€ä¸ªå›¢é˜Ÿçš„çŸ¥è¯†ç®¡ç†æ˜¯éå¸¸é‡è¦çš„. ä½ è¦é—®ä¸€ä¸ªåˆšå…¥è¡Œçš„æ–°æ‰‹åŠ å…¥å›¢é˜Ÿå¸Œæœ›å¾—åˆ°ä»€ä¹ˆï¼Ÿå¾ˆå¤šäººçš„å›ç­”æ˜¯â€™å­¦ä¹ â€™,  å¸Œæœ›è‡ªå·±çš„æŠ€æœ¯å¯ä»¥æ›´åŠ ç²¾è¿›, é’±å€’è¿˜æ˜¯å…¶æ¬¡ã€‚</p><p>ç„¶è€Œç°å®æ˜¯ç›®å‰å¾ˆå¤šå…¬å¸çš„æ°›å›´å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œä¸€å¤©åˆ°æ™šå†™ä¸šåŠ¡ä»£ç ã€å·¥ä½œé‡å¤§ã€æ¯å¤©åšé‡å¤çš„äº‹æƒ…ï¼Œè€Œä¸”è¿˜åŠ ç­ï¼Œå·¥ä½œå¤šå¹´æŠ€æœ¯ä¹Ÿæ²¡æ„Ÿè§‰æœ‰å¤šå°‘è¿›æ­¥, ç¡®å®ä¼šè®©äººéå¸¸æ²®ä¸§ã€‚åŒ…æ‹¬ç¬”è€…ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚</p><p>æ‰€ä»¥ä¸ºäº†æ”¹å–„è¿™ç§æƒ…å†µï¼Œæˆ‘æ¥èŠèŠæœ€è¿‘åœ¨â€˜å°å›¢é˜Ÿâ€™åšçš„ä¸€äº›å°è¯•.</p><h3 id="11-1-æ–°äººåŸ¹è®­"><a href="#11-1-æ–°äººåŸ¹è®­" class="headerlink" title="11.1 æ–°äººåŸ¹è®­"></a>11.1 æ–°äººåŸ¹è®­</h3><p>å¦‚æœå›¢é˜Ÿæœ‰è§„èŒƒçš„æ–°æˆå‘˜åŸ¹è®­æ‰‹å†Œï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šåŸ¹è®­çš„æ—¶é—´ï¼Œé¿å…æ¯æ¬¡é‡å¤å£è¿°ä¸€æ ·çš„å†…å®¹ã€‚åŸ¹è®­æ‰‹å†ŒåŒ…å«ä»¥ä¸‹å†…å®¹:</p><ul><li><p><strong>äº§å“æ¶æ„ä¸ç»„ç»‡æ¶æ„</strong>. ä»‹ç»å…¬å¸èƒŒæ™¯å’Œäº§å“ï¼Œä¸€èˆ¬ç»„ç»‡çš„å›¢é˜Ÿç»“æ„å’Œäº§å“çš„æ¶æ„æ˜¯ç›¸å…³è”çš„. ä»¥ç¬”è€…æ‰€åœ¨å…¬å¸ä¸ºä¾‹, ä¸»è¦äº§å“æ˜¯å³æ—¶é€šä¿¡:</p><p><img src="/images/frontend-standard/org.png" alt></p></li><li><p><strong>äº§å“ç ”å‘æµç¨‹</strong>: ä»‹ç»äº§å“å¼€å‘å’Œè¿­ä»£ä¼šæ¶‰åŠåˆ°çš„æµç¨‹ã€ä»¥åŠå›¢é˜Ÿä¹‹é—´çš„åä½œè¡”æ¥ï¼Œä¾‹å¦‚:</p><p><img src="/images/frontend-standard/dev-proc.png" alt></p></li><li><p><strong>å·¥ä½œèŒƒå›´</strong>: å›¢é˜Ÿæˆå‘˜çš„èŒè´£èŒƒå›´</p></li><li><strong>å»ºç«‹èµ„æºç´¢å¼•</strong>: å¼€å‘éœ€è¦è®¾è®¡åˆ°çš„èµ„æºï¼Œæ¯”å¦‚å„ç§æ–‡æ¡£åœ°å€ã€ç ”å‘ç³»ç»Ÿå…¥å£(ä¾‹å¦‚gitlabã€bugè·Ÿè¸ªç³»ç»Ÿã€æ–‡ä»¶å…±äº«ã€å‘å¸ƒå¹³å°ã€å¼€å‘/æµ‹è¯•ç¯å¢ƒã€ç›‘æ§ç³»ç»Ÿ)ã€åä½œè§„èŒƒç­‰ç­‰ã€‚å°†è¿™äº›èµ„æºæ•´ç†å¥½å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ²Ÿé€šæˆæœ¬</li><li><strong>è§„èŒƒ</strong>: å³æœ¬æ–‡çš„ä¸»ä½“â€™å‰ç«¯åä½œè§„èŒƒâ€™ã€‚æœ‰è§„èŒƒå¯å¾ªï¼Œå¯ä»¥è®©æˆå‘˜ä»¥è¾ƒå¿«çš„é€Ÿåº¦å…¥æ‰‹å¼€å‘ã€åŒæ—¶ä¹Ÿå‡å°‘åŸ¹è®­æˆæœ¬æŠ•å…¥ã€‚</li></ul><p>åŸ¹è®­æ‰‹å†Œå°†å¯ä»¥æ–‡æ¡£å…·è±¡åŒ–çš„å†…å®¹æ•´ç†ä¸ºæ–‡æ¡£ï¼Œå’Œä¸Šæ–‡è¯´åˆ°çš„Code Reviewä¸€æ ·ï¼Œä¸€äº›ä¸œè¥¿æ— æ³•é€šè¿‡æ–‡æ¡£æ¥è¯´æ˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šæ­é…ä¸€ä¸ªâ€˜åŸ¹è®­å¯¼å¸ˆâ€™ï¼Œåœ¨è¯•ç”¨æœŸé—´ï¼Œä¸€å¯¹ä¸€è¾…å¯¼ã€‚</p><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><h3 id="11-2-è¥é€ æŠ€æœ¯æ°›å›´"><a href="#11-2-è¥é€ æŠ€æœ¯æ°›å›´" class="headerlink" title="11.2 è¥é€ æŠ€æœ¯æ°›å›´"></a>11.2 è¥é€ æŠ€æœ¯æ°›å›´</h3><ul><li><strong>é¼“åŠ±æˆå‘˜å†™æŠ€æœ¯åšå®¢ï¼Œæˆ–è€…å»ºç«‹è‡ªå·±çš„å›¢é˜Ÿä¸“æ </strong>. å†™ä¸€ç¯‡å¥½çš„æ–‡ç« ä¸å®¹æ˜“</li><li><strong>é¼“åŠ±å‚ä¸å¼€æºé¡¹ç›®</strong></li><li><strong>å»ºç«‹é¢è¯•é¢˜åº“</strong> ç»„ç»‡ä¸€èµ·è§£ä¸€äº›é¢è¯•é¢˜æˆ–ç®—æ³•é¢˜ï¼ŒåŠ æ·±å¯¹çŸ¥è¯†ç‚¹çš„ç†è§£</li><li><p><strong>å®šæœŸçš„ä¸“é¢˜åˆ†äº«</strong>. é¼“åŠ±å›¢é˜Ÿæˆå‘˜å®šæœŸè¿›è¡Œä¸“é¢˜å­¦ä¹ å’Œç ”ç©¶ï¼Œç¼–å†™æŠ€æœ¯åšå®¢ï¼Œå¹¶å°†å­¦ä¹ çš„æˆæœåˆ†äº«ç»™å…¶ä»–æˆå‘˜. è¿™æ˜¯ä¸€ç§æŠ±å›¢å–æš–çš„å­¦ä¹ æ–¹å¼ï¼Œæ—¨åœ¨å¸®åŠ©å›¢é˜Ÿæˆå‘˜ä¸€èµ·å­¦ä¹ å’Œæˆé•¿ã€‚</p><p>æ¯”å¦‚å¼€å‘è€æ‰‹å¯ä»¥åˆ†äº«è‡ªå·±çš„ç»éªŒï¼Œç ”ç©¶æ›´æ·±å±‚æ¬¡çš„æŠ€æœ¯ï¼›æ–°æ‰‹åˆ™å¯ä»¥ç ”ç©¶æŸäº›å¼€å‘æŠ€å·§ã€æ–°æŠ€æœ¯ï¼Œä¾‹å¦‚CSS Gridï¼ŒsvgåŠ¨ç”»ç­‰ç­‰ã€‚æ¨èå›¢é˜Ÿæˆå‘˜æœ‰ä¸ªæ˜ç¡®çš„ç ”ç©¶é¢†åŸŸï¼Œè¿™æ ·åˆ†å·¥åˆä½œå¯ä»¥å­¦ä¹ åˆ°æ›´å¤šä¸œè¥¿.</p><p><strong>ä¸“é¢˜æ€ä¹ˆæ¥?</strong></p><ul><li>ä¸“é¢˜è¯·æ±‚. å¯ä»¥è¯·æ±‚å…¶ä»–æˆå‘˜å®Œæˆä¸“é¢˜ï¼Œæ¯”å¦‚æ¯”è¾ƒæ·±çš„çŸ¥è¯†ï¼Œå¯ä»¥è¦æ±‚å›¢é˜Ÿæ¯”è¾ƒæœ‰ç»éªŒçš„è¿›è¡Œå­¦ä¹ åˆ†äº«</li><li>å­¦ä¹ æ€»ç»“.</li><li>é¡¹ç›®å›é¡¾</li><li>éš¾ç‚¹æ”»å…‹</li><li>é¡¹ç›®è§„èŒƒ</li><li>å·¥å…·ä½¿ç”¨</li></ul></li><li><p><strong>è½å®å’Œå®Œå–„å¼€å‘è§„èŒƒ</strong>. è§„èŒƒæœ¬èº«å°±æ˜¯å›¢é˜ŸçŸ¥è¯†æ²‰æ·€çš„ä¸€ç§ç›´æ¥è¾“å‡º</p></li><li><strong>å›¾ä¹¦åˆ†äº«</strong>. å’Œç¦»æ•£çš„æ–‡ç« æˆ–æ•™ç¨‹ç›¸æ¯”ï¼Œå›¾ä¹¦çš„çŸ¥è¯†ä¼šæ¯”è¾ƒç³»ç»Ÿï¼Œå¦å¤–å¾ˆå¤šç»å…¸çš„å›¾ä¹¦æ˜¯è¦é™ä¸‹æ¥å¥½å¥½æ¬£èµçš„ã€‚</li><li><strong>é¼“åŠ±é‡æ„å’ŒæŒç»­ä¼˜åŒ–ä»£ç </strong></li><li><strong>æŠ½è±¡ä¸€å¥—åŸºç¡€åº“æˆ–æ¡†æ¶ï¼Œå‡å°‘é‡å¤å·¥ä½œ, æé«˜å·¥ä½œæ•ˆç‡</strong>. ä¸åŠ ç­å…ˆä»æé«˜å·¥ä½œæ•ˆç‡å¼€å§‹</li></ul><p><br></p><p><a href="#">â¬†ï¸å›åˆ°é¡¶éƒ¨</a></p><p><br></p><h2 id="12-åé¦ˆ"><a href="#12-åé¦ˆ" class="headerlink" title="12 åé¦ˆ"></a>12 åé¦ˆ</h2><p>å¤§å®¶æœ‰ä»€ä¹ˆè¦è¡¥å……æˆ–æ„è§å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®º, ä¸€èµ·æ¥å®Œå–„è¿™ç¯‡æ–‡ç« , è°¢è°¢ï¼</p><p><img src="/images/sponsor.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä¸‡å­—é•¿æ–‡ï¼Œç»§ç»­åˆ·æ–°æˆ‘çš„æ–‡ç« é•¿åº¦è®°å½•ï¼Œæ¶‰åŠå‰ç«¯å¼€å‘çš„æ–¹æ–¹é¢é¢ã€‚æœ¬æ–‡å°†æŒç»­æ›´æ–°å’Œå®Œå–„, æ–‡ç« éƒ¨åˆ†è§‚ç‚¹å¯èƒ½æ¯”è¾ƒæ­¦æ–­æˆ–ä¸å®Œæ•´ï¼Œæ¬¢è¿è¯„è®ºå’Œè¡¥å……ï¼Œä¸€èµ·å®Œå–„è¯¥æ–‡ç« . è°¢è°¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;ç¬”è€…é•¿æœŸå•æªåŒ¹é©¬åœ¨å‰ç«¯é¢†
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[é—®ç­”] ä¸ºä»€ä¹ˆè¦ç”¨vue-cli3?</title>
    <link href="https://bobi.ink/2019/07/18/why-vue-cli3/"/>
    <id>https://bobi.ink/2019/07/18/why-vue-cli3/</id>
    <published>2019-07-17T16:00:00.000Z</published>
    <updated>2019-07-18T04:20:32.211Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><code>[é—®ç­”]</code>ç³»åˆ—ä¸»è¦æ•´ç†<a href="https://segmentfault.com/q/1010000019785471" target="_blank" rel="noopener">SegmentFault</a>ä¸Šé¢æ¯”è¾ƒæœ‰ä»·å€¼çš„é—®é¢˜ï¼Œä»¥åŠæˆ‘çš„å›ç­”</p></blockquote><h2 id="åŸé—®é¢˜"><a href="#åŸé—®é¢˜" class="headerlink" title="åŸé—®é¢˜"></a><a href="https://segmentfault.com/q/1010000019785471/a-1020000019793827" target="_blank" rel="noopener">åŸé—®é¢˜</a></h2><p>å…¶å®è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯æƒ³äº†è§£vue-cli3ä¸vue-cli2ç›¸æ¯”æ˜¯å¦å­˜åœ¨ä¸€äº›ä¸å¾—ä¸å‡çº§çš„å¥½å¤„å’Œä¼˜ç‚¹ï¼Ÿ</p><p>äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯åœ¨è¯•ç”¨å®Œvue-cli3ä¹‹åå¹¶æ²¡æœ‰è§‰å¾—å¥½ç”¨ï¼Œåè€Œè§‰å¾—æŸæ‰‹æŸè„šï¼Œæˆ‘cli2æ—¶ï¼Œwebpackæƒ³æ€ä¹ˆé…æ€ä¹ˆé…ä¸ºä»€ä¹ˆåˆ°äº†cli3æˆ‘è¦åœ¨vue.config.jsä¸­é…ç½®<br>ä¼—æ‰€å‘¨çŸ¥vue-cliçš„é€šç”¨é…ç½®å¹¶ä¸é€‚åˆæ¯ç§æƒ…å†µ, è€Œåœ¨vue.config.jsåªèƒ½åšå¢æ·»å’Œè¦†ç›–ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰ç”¨vue-cli3æ„å»ºé¡¹ç›®</p><p>æ‰€ä»¥æƒ³è¯·æ•™ä¸‹ è¿™ä¸ªç‰ˆæœ¬æœ‰æ²¡æœ‰å€¼å¾—å‡çº§çš„ä¼˜ç‚¹</p><p><br></p><h2 id="æˆ‘çš„å›ç­”"><a href="#æˆ‘çš„å›ç­”" class="headerlink" title="æˆ‘çš„å›ç­”"></a>æˆ‘çš„å›ç­”</h2><p>å¥½é—®é¢˜ï¼Œvue-cli3ç›¸å¯¹vue-cliæœ‰å¾ˆå¤šé‡è¦çš„æ›´æ–°ã€‚</p><p>é¦–å…ˆè¯´ä¸€äº›vue-cliè¿™äº›å·¥å…·çš„<strong>åˆè¡·</strong>å§: è¿™äº›å·¥å…·å°±æ˜¯ä¸ºäº†è®©å¼€å‘è€…èƒ½å¤Ÿ<strong>å¼€ç®±å³ç”¨</strong>å¿«é€Ÿåœ°è¿›è¡Œåº”ç”¨å¼€å‘è€Œå¼€å‘çš„ï¼Œ<strong>å®ƒä»¬ç§‰æ‰¿çš„æ˜¯â€œçº¦å®šå¤§äºé…ç½®â€æ€æƒ³ï¼Œç®€å•è¯´å°±æ˜¯â€èƒ½ä¸é…ç½®çš„å°±ä¸é…ç½®ï¼Œä½ å°±æŒ‰ç…§æˆ‘çš„æ–¹å¼æ¥ï¼Œä¹Ÿä¸è¦å»äº‰è®ºè¿™ä¸ªå¥½ä¸å¥½ï¼Œå¿«é€Ÿè¿›è¡Œä¸šåŠ¡å¼€å‘æ‰æ˜¯æ­£ç»äº‹â€. å®ƒä»¬ä¸å»ºè®®ä½ å»é…ç½®ï¼Œä½†ä¹Ÿä¸ä¼šæ‹¦ç€ä½ å»é…ç½®</strong>ã€‚</p><p>å¦å¤–Webpackå¯¹åˆå­¦è€…å¹¶ä¸æ˜¯ååˆ†å‹å¥½ï¼Œâ€˜åˆé•¿åˆè‡­â€™çš„é…ç½®ï¼Œæ™®é€šå¼€å‘è€…å¾ˆéš¾å†™å…¥å®šä¹‰è‰¯å¥½ï¼Œæ€§èƒ½ä¼˜åŒ–çš„é…ç½®ã€‚ä¸ç„¶å°±ä¸ä¼šå„ç§cliå·¥å…·å†’å‡ºæ¥äº†ï¼Œæ¯”å¦‚parcelï¼Œcreate-react-appã€‚è¿™äº›å·¥å…·éƒ½å®£ç§°é›¶é…ç½®ï¼Œç›®çš„å°±æ˜¯è®©å¼€å‘è€…èƒ½å¤Ÿæ„‰å¿«çš„è¿›è¡Œä»£ç å¼€å‘ã€‚</p><p><br></p><hr><p><br></p><p>ç°åœ¨æ¥çœ‹çœ‹Vue-cli v3çš„æ”¹è¿›ï¼Œä»¥åŠæ€è€ƒè¿™äº›æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p><p><br></p><p><strong>1. æŠ½ç¦»cli serviceå±‚</strong></p><p>Create-React-Appæ˜¯ç¬¬ä¸€ä¸ªåšè¿™ç§äº‹æƒ…çš„ã€‚vue-cli3åº“ç°åœ¨åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ¨¡å—ï¼š</p><ul><li><p>CLI: å³vueå…¨å±€å‘½ä»¤ï¼Œä¸»è¦ç”¨äºé¡¹ç›®åˆ›å»ºå’Œç®¡ç†ï¼ŒåŒ…å«äº†<code>vue create</code>ã€<code>vue ui</code>è¿™äº›å‘½ä»¤ã€‚CLIå‘½ä»¤çš„åšçš„äº‹æƒ…æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æ›´æ–°ä¸ä¼šå¤ªé¢‘ç¹(å¼€å‘è€…ä¹Ÿå¾ˆå°‘ä¼šå»æ›´æ–°è¿™äº›å‘½ä»¤)</p></li><li><p>Serviceå±‚: è´Ÿè´£é¡¹ç›®çš„å®é™…æ„å»ºï¼Œä¹Ÿå°±æ˜¯webpacké¡¹ç›®æ„å»ºã€‚è¿™ä¸€å—æ˜¯é¢‘ç¹æ›´æ–°çš„ï¼Œä¸€èˆ¬ä½œä¸ºé¡¹ç›®çš„å±€éƒ¨ä¾èµ–ã€‚</p></li></ul><p><br></p><p>OKï¼Œè¿™ä¹ˆåšæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿè€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¹Ÿæ˜¯ç­”ä¸»ä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªç—›ç‚¹ï¼š</p><p><strong>vue-cli3ä¹‹å‰ä¸ç®—æ˜¯ä¸€ä¸ªæ„å»ºCLI, å®ƒé¡¶å¤šå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ‹·è´å™¨, åšçš„äº‹æƒ…éå¸¸å°‘</strong>, æ‰€æœ‰webpacké…ç½®å’Œæ„å»ºå‘½ä»¤éƒ½æ˜¯è€¦åˆåœ¨å…·ä½“çš„é¡¹ç›®é‡Œé¢ï¼Œpackage.jsonä¼šåŒ…å«ä¸€å¤§å †å¼€å‘ä¾èµ–ã€‚</p><p>å¦‚æœå»è·Ÿè¿›webpackæˆ–ç›¸å…³å·¥å…·æ›´æ–°çš„æœ‹å‹ä¼šæœ‰è¿™ç§ä½“ä¼šï¼Œå‡çº§ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚æ¯”å¦‚ä½ å‡çº§äº†babel-loader, å¯èƒ½è¦è¿å¸¦webpackéƒ½å‡çº§ï¼Œwebpackå‡çº§åå¯èƒ½å…¶ä»–å·¥å…·åˆä¸å…¼å®¹äº†ã€‚</p><p>å‡çº§æ–¹é¢çš„ç—›ç‚¹æ˜¯å…¶ä¸€ã€‚å¦‚æœä½ çš„å›¢é˜Ÿéœ€è¦ç»´æŠ¤å¾ˆå¤šé¡¹ç›®ï¼Œä½ æ€ä¹ˆå¯¹è¿™äº›é¡¹ç›®è¿›è¡Œç»´æŠ¤å‡çº§ï¼Ÿæ¯ä¸ªé¡¹ç›®éƒ½æ‹·è´ä¸€ä¸‹ï¼Ÿå¦‚æœæŸä¸ªé¡¹ç›®åšäº†ç‰¹æ®Šé…ç½®å‘¢ï¼Ÿ</p><p><strong>å¯¹äºå›¢é˜Ÿè€Œè¨€ï¼Œé¡¹ç›®æ„å»ºè¿™ä¸€å—æ˜¯åº”è¯¥å°½é‡åšåˆ°çš„ç»Ÿä¸€å’Œå‚»ç“œåŒ–çš„ï¼Œæ²¡æœ‰å¿…è¦åœ¨è¿™æ–¹é¢æŠ•å…¥å¤ªå¤šçš„ç²¾åŠ›ï¼Œåº”è¯¥æŠŠäº‹æƒ…å¤–åŒ…ç»™æ“…é•¿è¿™ç§äº‹æƒ…çš„äººå»åš</strong>ã€‚</p><p><strong>å¦å¤–ä¸è¦æ’æ–¥æ›´æ–°ï¼Œæ›´æ–°å¯ä»¥è·å¾—æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œæ„å»ºé€Ÿåº¦ã€è¿è¡Œæ€§èƒ½, åˆ«äººåœ¨è¿™æ–¹é¢æ¯”ä½ äº†è§£çš„æ›´å¤š</strong>ã€‚</p><p><strong>åˆ†ç¦»äº†vue-cli-serviceä¹‹åï¼Œé¡¹ç›®æ„å»ºæ›´æ–°åªæ˜¯ä¸€ä¸ªå‘½ä»¤çš„äº‹æƒ…ï¼Œé™¤éåšäº†å¾ˆå¤šç‰¹æ®ŠåŒ–æ“ä½œ</strong>ã€‚<strong>ç‰¹æ®ŠåŒ–æ“ä½œåº”è¯¥å°è£…åˆ°vue-cliçš„æ’ä»¶ä¸­</strong>ã€‚è¿™å°±å¼•å‡ºäº†vue-cli3çš„å¦å¤–ä¸€ä¸ªç‰¹è‰²ï¼šæ’ä»¶</p><p><br></p><hr><p><br></p><p><strong>2. æ’ä»¶åŒ–</strong></p><p>ç›¸æ¯”create-react-app, vue-cliæ˜¯åœ¨å¤ªä»æ…ˆäº†ã€‚vue-cliçš„æ’ä»¶æœºåˆ¶å¾ˆçµæ´»ï¼Œé€šè¿‡<code>webpack-chain</code>å’Œ<code>webpack-merge</code>å¯ä»¥å®ç°webpackå®Œå…¨å®šåˆ¶åŒ–ã€‚</p><p>å¯ä»¥å¯¹æ¯”ä¸€ä¸‹å¸‚é¢ä¸Šæµè¡Œçš„cliå·¥å…·çš„å¯æ‰©å±•æ€§ï¼š</p><table><thead><tr><th></th><th>Vue CLI</th><th>create-react-app</th><th>parcel</th></tr></thead><tbody><tr><td>å¿«é€ŸåŸå‹å¼€å‘</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>å…¨å±€æ¨¡å¼</td><td>é›¶é…ç½®åŸå‹å¼€å‘å°±æ˜¯å…¨å±€çš„</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>æ’ä»¶</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒï¼Œæ‰©å±•æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶è¾“å‡º</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¼ºï¼Œé€šè¿‡æ’ä»¶æ‰©å±• wepack é…ç½®</td><td>å¼±, å¼ºçº¦å®š, æ— æ³•é…ç½® webpackï¼Œå¯ä»¥ eject, ç„¶åæ‰‹å·¥é…ç½®ï¼›æ”¯æŒ babel-macro;(ä¸¥æ ¼è¯´å¯ä»¥é€šè¿‡<a href="https://github.com/timarney/react-app-rewired" target="_blank" rel="noopener">react-app-rewired</a>è¿›è¡Œæ‰©å±•)</td><td>ä¸­(å¯ä»¥é…ç½® babelï¼Œpostcssï¼ŒTypescript); æä¾›äº† Node API; æ”¯æŒæ’ä»¶æ‰©å±•æ–‡ä»¶ç±»å‹</td></tr><tr><td>å¤šé¡µé¢</td><td>æ”¯æŒ</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>é€‚ç”¨èŒƒå›´</td><td>Vue ç»„ä»¶çš„ç¬¬ä¸€å…¬æ°‘ã€‚é€šè¿‡æ‰©å±•å¯ä»¥æ”¯æŒä»»æ„å‰ç«¯æ¡†æ¶</td><td>é’ˆå¯¹ React å¼€å‘ï¼Œä¸æ”¯æŒå…¶ä»–æ¡†æ¶</td><td>parcel æ˜¯ä¸€ä¸ªé€šç”¨çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„ç«äº‰å¯¹æ‰‹æ˜¯ webpack</td></tr><tr><td>ç¼–è¯‘é€Ÿåº¦</td><td>cache-loader,thread-loader æ¥åŠ é€Ÿ JS å’Œ TS ç¼–è¯‘</td><td>babel-loader å¼€å¯äº† cache</td><td>ç¼–è¯‘é€Ÿåº¦å·ç§°æ˜¯ webpack çš„ä¸¤å€</td></tr><tr><td>å¯å‡çº§æ€§</td><td>æ”¯æŒå‡çº§ cli-service, æ’ä»¶éœ€è¦å•ç‹¬å‡çº§, æ’ä»¶éœ€è¦éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬. å¤ªå¤šæ’ä»¶å­˜åœ¨å‡çº§é£é™©</td><td>æ”¯æŒå‡çº§ react-script, å®˜æ–¹ç»´æŠ¤ï¼Œä¸”å¼ºçº¦å®šåŸºæœ¬å¯ä»¥ä¿éšœå‘ä¸‹å…¼å®¹</td><td>æ”¯æŒå‡çº§ parcel-bundler</td></tr><tr><td>UI</td><td>å›¾å½¢åŒ–ç®¡ç†æ˜¯ CLI çš„ç‰¹è‰²ä¹‹ä¸€</td><td>-</td><td>-</td></tr></tbody></table><p><br></p><p>å¯¹äºvue-cliçš„æ’ä»¶å®ç°æœºåˆ¶å¯ä»¥çœ‹è¿™ç¯‡<a href="https://juejin.im/post/5cedb26451882566477b7235" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚</p><p>å› ä¸ºvue-cliçµæ´»çš„æ‰©å±•æ€§ï¼Œæ‰€ä»¥å®ƒä¸ä»…é™äºvueæœ¬èº«ï¼Œå¯ä»¥æ‰©å±•æ”¯æŒreactã€anythingâ€¦</p><p>æŒ‰ç…§ä¸Šæ–‡è¯´çš„ï¼Œ<strong>å¦‚æœä½ è¦åšæ·±åº¦çš„vue-cliå®šåˆ¶åŒ–ï¼Œä¸å»ºè®®ç›´æ¥å†™åœ¨vue.config.jsä¸­ï¼Œè€Œæ˜¯å°è£…åœ¨æ’ä»¶ä¸­ï¼Œç‹¬ç«‹çš„ç»´æŠ¤è¿™ä¸ªæ’ä»¶ï¼Œç„¶åé¡¹ç›®å†ä¾èµ–è¿™ä¸ªæ’ä»¶ã€‚è¿™æ ·å°±å¯ä»¥ç®€åŒ–å‡çº§çš„æˆæœ¬å’Œå¤æ‚åº¦</strong>ã€‚</p><p><br></p><hr><p><br></p><p><strong>3. GUIç•Œé¢</strong></p><p>è™½ç„¶å¤§éƒ¨åˆ†äººéƒ½è§‰å¾—ä½œç”¨ä¸å¤§ï¼Œå› ä¸ºç¡®å®å¯¹å¼€å‘æ•ˆç‡å¹¶å®é™…çš„æå‡æ•ˆæœã€‚å°±æ˜¯çœ‹ç€èˆ’æœç›´è§‚ï¼Œè¿™å°±å¤Ÿäº†ã€‚</p><p><br></p><hr><p><br></p><p><strong>4. å¿«é€ŸåŸå‹å¼€å‘</strong></p><p>vue-cli3ä¹Ÿæ”¯æŒç›´æ¥å°†ä¸€ä¸ªvueæ–‡ä»¶è·‘èµ·æ¥ï¼Œå¿«é€ŸåŸå‹å¼€å‘æˆ–éªŒè¯æŸäº›æƒ³æ³•æ—¶ï¼ŒæŒºä¸é”™ã€‚</p><p><br></p><hr><p><br></p><p><strong>5. <a href="https://cli.vuejs.org/guide/browser-compatibility.html#modern-mode" target="_blank" rel="noopener">ç°ä»£æ¨¡å¼</a></strong></p><p>ç»™å…ˆè¿›çš„æµè§ˆå™¨é…åˆå…ˆè¿›çš„ä»£ç (ES6ä¹‹å),åŒæ—¶å…¼å®¹æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œå…ˆè¿›çš„ä»£ç ä¸ç®¡ä»æ–‡ä»¶ä½“ç§¯è¿˜æ˜¯è„šæœ¬è§£ææ•ˆç‡ã€è¿è¡Œæ•ˆç‡éƒ½æœ‰è¾ƒé«˜çš„æå‡ã€‚</p><p>ä½“ç§¯å¯¹æ¯”:</p><table><thead><tr><th>Version</th><th>Size (minified)</th><th>Size (minified + gzipped)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>80K</td><td>21K</td></tr><tr><td>ES5 (main.es5.js)</td><td>175K</td><td>43K</td></tr></tbody></table><p><br></p><p>è§£ææ•ˆç‡:</p><table><thead><tr><th>Version</th><th>Parse/eval time (individual runs)</th><th>Parse/eval time (avg)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>184ms, 164ms, 166ms</td><td>172ms</td></tr><tr><td>ES5 (main.es5.js)</td><td>389ms, 351ms, 360ms</td><td>367ms</td></tr></tbody></table><p><br></p><hr><p><br></p><p><strong>6. Standard Tooling for Vue.js Development</strong></p><p>è¿™æ˜¯vue-cliçš„å®˜æ–¹ä»‹ç»ï¼Œvueæ ‡å‡†å¼€å‘å·¥å…·. è·Ÿè¿›vue-cliå°±æ˜¯è·Ÿè¿›å®˜æ–¹çš„æœ€ä½³å®è·µå’Œå‰æ²¿æŠ€æœ¯ï¼Œvueå›¢é˜Ÿå·²ç»ä¸ºä½ è€ƒè™‘å¾ˆå¤šåº”ç”¨åœºæ™¯, why not?</p><p><br></p><hr><p><br></p><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼š</p><ul><li><p>å¦‚æœæˆ‘ä»¬å–œæ¬¢æŠ˜è…¾ï¼Œè‚¯å®šä¼šè§‰å¾—vue-cli3æŸæ‰‹æŸè„šï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¸æ˜¯vue-cli3çš„ç›®æ ‡ç”¨æˆ·ï¼›</p><p>å°±æ¯”å¦‚æˆ‘ä»¬å›¢é˜Ÿå°±è‡ªå·±æäº†ä¸€ä¸€ä¸ªCLIæ„å»ºå·¥å…·: <a href="https://github.com/GDJiaMi/jm-cli" target="_blank" rel="noopener">jm-cli</a>, æ ¹æ®è‡ªå·±çš„å›¢é˜Ÿéœ€æ±‚è¿›è¡Œæ·±åº¦å®šåˆ¶ï¼Œä¸è¿‡æˆ‘ä»¬è¿™ä¸ªå·¥å…·æ˜¯å¼ºçº¦å®šçš„ï¼ŒåŒ…æ‹¬ç›®å½•ç»“æ„ã€ç¼–ç è§„èŒƒç­‰ç­‰. å› ä¸ºæˆ‘ä»¬ä¸æ¨èå›¢é˜Ÿæˆå‘˜å»æç‰¹æ®ŠåŒ–å®šåˆ¶ï¼Œè€Œä¸”ä¸ºäº†æ–¹ä¾¿è¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥å¹²è„†å°±ä¸è®©æ‰©å±•äº†ï¼Œ<strong>ç»Ÿä¸€å’Œè§„èŒƒå¯¹å›¢é˜Ÿæ¥è¯´æ‰æ˜¯æœ€é‡è¦çš„</strong>.</p><p><strong>å¦‚æœä½ æœ‰ç±»ä¼¼çš„å¼€å‘ç»éªŒï¼Œä½ ä¼šè§‰å¾—vue-cliå¯èƒ½æ˜¯æ‰€æœ‰æ„å»ºCLIçš„æœ€ç»ˆå½’å®¿æˆ–è€…å…¸èŒƒ</strong>ã€‚</p></li><li><p>å¦‚æœä¸æƒ³æŠ˜è…¾ï¼Œåªæƒ³å†™ä»£ç , è€Œä¸”æƒ³è·Ÿè¿›vueå®˜æ–¹æœ€æ–°å®è·µï¼Œé‚£å°±ç›´æ¥æ‹¿æ¥ç”¨å§ï¼›</p></li><li>å¦‚æœæƒ³æŠ˜è…¾ï¼Œåˆè¦è€ƒè™‘å›¢é˜Ÿåä½œå’Œæ„å»ºå·¥å…·é“¾çš„ç»´æŠ¤æˆæœ¬ï¼Œvue-cliæ˜¯å¾ˆé€‚åˆçš„ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€ è½®å­</li><li>å¦‚æœæƒ³å­¦webpackçš„æ„å»ºé¡¹ç›®ï¼Œä¹Ÿä¸æ¨èä½ ä½¿ç”¨vue-cli</li></ul><p><br></p><p>æœ€åç»™vueå›¢é˜Ÿç‚¹ä¸ªèµğŸ‘</p><p>æ¬¢è¿å…³æ³¨æˆ‘ï¼Œå’Œæˆ‘äº¤æµ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;[é—®ç­”]&lt;/code&gt;ç³»åˆ—ä¸»è¦æ•´ç†&lt;a href=&quot;https://segmentfault.com/q/1010000019785471&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SegmentFault&lt;/a&gt;
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ç°ä»£è„šæœ¬çš„åŠ è½½</title>
    <link href="https://bobi.ink/2019/07/17/modern-module/"/>
    <id>https://bobi.ink/2019/07/17/modern-module/</id>
    <published>2019-07-16T16:00:00.000Z</published>
    <updated>2019-07-18T23:21:49.165Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€: <a href="https://jasonformat.com/modern-script-loading/" target="_blank" rel="noopener">Modern Script Loading</a>, æ–‡ç« ä½œè€…æ˜¯Preactä½œè€…<a href="https://twitter.com/_developit" target="_blank" rel="noopener">Jason Miller</a></p><p><br></p><p><img src="/images/modern-module/modern-script-loading.jpg" alt></p><p><br></p><h2 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h2><p>å…ˆç®€å•ä»‹ç»ä¸€ä¸‹<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" target="_blank" rel="noopener"><code>æ¨¡å—script(Module script)</code></a>, å®ƒæŒ‡çš„æ˜¯<strong>ç°ä»£æµè§ˆå™¨æ”¯æŒé€šè¿‡<code>&lt;script type=module src=main.js&gt;&lt;/script&gt;</code>æ¥åŠ è½½ç°ä»£çš„ES6æ¨¡å—</strong>. ç°ä»£æµè§ˆå™¨å¯¹ES6ç°ä»£è¯­æ³•æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€<strong>æˆ‘ä»¬å¯ä»¥ç»™è¿™äº›ç°ä»£æµè§ˆå™¨æä¾›æ›´ç´§å‡‘çš„â€˜ç°ä»£ä»£ç â€™ï¼Œä¸€æ–¹é¢å¯ä»¥å‡å°æ‰“åŒ…çš„ä½“ç§¯ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“çš„å¸¦å®½ï¼Œå¦å¤–è¿˜å¯ä»¥æé«˜è„šæœ¬è§£æçš„æ•ˆç‡å’Œè¿è¡Œæ•ˆç‡</strong>.</p><p>ä¸‹å›¾æ¥æºäº<a href="https://philipwalton.com/articles/deploying-es2015-code-in-production-today/" target="_blank" rel="noopener"><code>module/nomodule pattern</code></a>, å¯¹æ¯”äº†<strong>æ¨¡å—script</strong>å’Œ<strong>ä¼ ç»Ÿ(legacy) script</strong>çš„æ€§èƒ½:</p><p>ä½“ç§¯å¯¹æ¯”:</p><table><thead><tr><th>Version</th><th>Size (minified)</th><th>Size (minified + gzipped)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>80K</td><td>21K</td></tr><tr><td>ES5 (main.es5.js)</td><td>175K</td><td>43K</td></tr></tbody></table><p><br></p><p>è§£ææ•ˆç‡:</p><table><thead><tr><th>Version</th><th>Parse/eval time (individual runs)</th><th>Parse/eval time (avg)</th></tr></thead><tbody><tr><td>ES2015+ (main.mjs)</td><td>184ms, 164ms, 166ms</td><td>172ms</td></tr><tr><td>ES5 (main.es5.js)</td><td>389ms, 351ms, 360ms</td><td>367ms</td></tr></tbody></table><p><br></p><p>Okï¼Œä¸ºäº†å…¼å®¹æ—§æµè§ˆå™¨, <a href="https://philipwalton.com/articles/deploying-es2015-code-in-production-today/" target="_blank" rel="noopener">module/nomodule pattern</a>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€ç§<strong>module/nomodule æ¨¡å¼</strong>, ç®€å•è¯´å°±æ˜¯<strong>åŒæ—¶æä¾›ä¸¤ä¸ªscript, ç”±æµè§ˆå™¨æ¥å†³å®šåŠ è½½å“ªä¸ªæ–‡ä»¶</strong>ï¼š</p><p><br></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ”¯æŒæ¨¡å—scriptçš„æµè§ˆå™¨ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"main.mjs"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ—§æµè§ˆå™¨ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å› ä¸ºåŠ äº†nomdule, æ‰€ä»¥ç°ä»£æµè§ˆå™¨ä¸ä¼šåŠ è½½è¯¥æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"main.es5.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹èµ·æ¥å¾ˆç¾å¥½æ˜¯å§? ç°å®æ˜¯ï¼š<strong>ä¸­é—´å­˜åœ¨ä¸€äº›æµè§ˆå™¨ï¼Œå®ƒä»¬å¯ä»¥è¯†åˆ«<code>æ¨¡å—script</code>ä½†æ˜¯ä¸è®¤è¯†<code>nomodule</code>å±æ€§, è¿™å°±å¯¼è‡´äº†è¿™äº›æµè§ˆå™¨ä¼šåŒæ—¶åŠ è½½è¿™ä¸¤ä¸ªæ–‡ä»¶(ä¸‹æ–‡ç»Ÿä¸€ç§°ä¸ºâ€˜åŒé‡åŠ è½½â€™(over-fetching))</strong>.</p><p><br><br><br></p><blockquote><p>OKï¼Œæ­£å¼è¿›å…¥æ­£æ–‡. ç»™æ­£ç¡®çš„æµè§ˆå™¨äº¤ä»˜æ­£ç¡®ä»£ç æ˜¯ä¸€ä»¶æ£˜æ‰‹çš„äº‹æƒ…ã€‚æœ¬æ–‡ä¼šä»‹ç»å‡ ç§æ–¹å¼, æ¥è§£å†³ä¸Šè¿°çš„é—®é¢˜:</p></blockquote><p>ç»™ç°ä»£æµè§ˆå™¨ä¼ºæœâ€™ç°ä»£çš„ä»£ç â€™å¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚æ‰€ä»¥ä½ åº”è¯¥é’ˆå¯¹ç°ä»£æµè§ˆå™¨æä¾›åŒ…å«æ›´ç´§å‡‘å’Œä¼˜åŒ–çš„ç°ä»£è¯­æ³•çš„JavascriptåŒ…ï¼ŒåŒæ—¶åˆå¯ä»¥ä¿æŒå¯¹æ—§æµè§ˆå™¨çš„æ”¯æŒ</p><p>ç°æœ‰çš„å·¥å…·é“¾çš„ç”Ÿæ€ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯åœ¨<code>module/nomoduleæ¨¡å¼</code>ä¸Šæ•´åˆçš„ï¼Œå®ƒå£°æ˜å¼åŠ è½½ç°ä»£å’Œä¼ ç»Ÿä»£ç (legacy code)ï¼Œå³ç»™æµè§ˆå™¨æä¾›ä¸¤ä¸ªæºä»£ç ï¼Œè®©å®ƒæ¥è‡ªå·±æ¥å†³å®šç”¨å“ªä¸ª:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"/modern.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"/legacy.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œç°å®æ€»æ˜¯ç»™ä½ å½“å¤´ä¸€æ£’ï¼Œå®ƒæ²¡æˆ‘ä»¬æœŸæœ›çš„é‚£ä¹ˆç®€å•ç›´æ¥ã€‚ä¸Šè¿°åŸºäºHTMLçš„åŠ è½½æ–¹å¼åœ¨<a href="https://gist.github.com/jakub-g/5fc11af85a061ca29cc84892f1059fec" target="_blank" rel="noopener"><strong>Edgeå’ŒSafariä¸­ä¼šè¢«åŒæ—¶åŠ è½½</strong></a>!</p><p><br></p><h2 id="æ€ä¹ˆåŠ"><a href="#æ€ä¹ˆåŠ" class="headerlink" title="æ€ä¹ˆåŠ?"></a>æ€ä¹ˆåŠ?</h2><p>æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬æƒ³ä¾èµ–æµè§ˆå™¨æ¥äº¤ä»˜ä¸åŒçš„ç¼–è¯‘ç›®æ ‡ï¼Œä½†æ˜¯ä¸€äº›æ—§æµè§ˆå™¨å¹¶ä¸èƒ½ä¼˜é›…åœ°æ”¯æŒè¿™ç§ç®€æ´çš„å†™æ³•ã€‚</p><p>é¦–å…ˆï¼ŒSafari åœ¨10.1å¼€å§‹æ”¯æŒJSæ¨¡å—, ä½†ä¸æ”¯æŒnomoduleå±æ€§ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒSamæ‰¾åˆ°äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡Safari 10å’Œ11ä¸­éæ ‡å‡†çš„beforeloadäº‹ä»¶æ¥æ¨¡æ‹Ÿ nomodule, ä¹Ÿå°±æ˜¯å¯ä»¥è®¤ä¸ºSafari 10.1å¼€å§‹æ˜¯å¯ä»¥æ”¯æŒ<code>module/nomoduleæ¨¡å¼</code></p><p><br></p><h2 id="é€‰é¡¹1-åŠ¨æ€åŠ è½½"><a href="#é€‰é¡¹1-åŠ¨æ€åŠ è½½" class="headerlink" title="é€‰é¡¹1: åŠ¨æ€åŠ è½½"></a>é€‰é¡¹1: åŠ¨æ€åŠ è½½</h2><p>æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªå°å‹scriptåŠ è½½å™¨æ¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œå·¥ä½œåŸç†ç±»ä¼¼äº<a href="https://github.com/filamentgroup/loadCSS" target="_blank" rel="noopener">LoadCSS</a>ã€‚åªä¸è¿‡è¿™é‡Œéœ€è¦ä¾é æµè§ˆå™¨çš„æ¥å®ç°ESæ¨¡å—å’Œnomoduleå±æ€§.</p><p>æˆ‘ä»¬é¦–å…ˆå°è¯•æ‰§è¡Œä¸€ä¸ªæ¨¡å—scriptè¿›è¡Œâ€™çŸ³è•Šè¯•éªŒâ€™(litmus test), ç„¶åç”±è¿™ä¸ªè¯•éªŒçš„ç»“æœæ¥å†³å®šåŠ è½½ç°ä»£ä»£ç è¿˜æ˜¯ä¼ ç»Ÿä»£ç :</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ä¸€ä¸ªæ¨¡å—scriptæ¥æ£€æµ‹æ˜¯å¦æ˜¯ç°ä»£æµè§ˆå™¨ --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  self.modern = <span class="literal">true</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç°åœ¨æ ¹æ®è¿™ä¸ªæ£€æµ‹ç»“æœæ¥å†³å®šåŠ è½½ç°ä»£ä»£ç è¿˜æ˜¯ä¼ ç»Ÿä»£ç : --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (self.modern) &#123;</span></span><br><span class="line"><span class="javascript">      s.src = <span class="string">'/modern.js'</span></span></span><br><span class="line"><span class="javascript">      s.type = <span class="string">'module'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">      s.src = <span class="string">'/legacy.js'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.head.appendChild(s)</span></span><br><span class="line"><span class="undefined">  &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆå¿…é¡»ç­‰å¾…è¿›è¡Œâ€˜çŸ³è•Šè¯•éªŒâ€™æ¨¡å—scriptæ‰§è¡Œå®Œæˆ, æ‰èƒ½å¼€å§‹æ³¨å…¥scriptã€‚è¿™æ˜¯å› ä¸º<code>&lt;script type=module&gt;</code>å§‹ç»ˆæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥åˆ«æ— å®ƒæ³•(å»¶è¿Ÿåˆ°loadäº‹ä»¶å)ã€‚</p><p>å¦ä¸€ç§å®ç°æ–¹å¼æ˜¯æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ<code>nomodule</code>, è¿™æ˜¯æ–¹å¼å¯ä»¥é¿å…ä¸Šè¿°çš„å»¶è¿ŸåŠ è½½é—®é¢˜, åªä¸è¿‡è¿™æ„å‘³ç€åƒSafari 10.1è¿™äº›æ”¯æŒæ¨¡å—, å´ä¸æ”¯æŒnomoduleçš„æµè§ˆå™¨ä¹Ÿä¼šè¢«å½“åšä¼ ç»Ÿæµè§ˆå™¨ï¼Œè¿™ä¹Ÿè®¸<a href="https://github.com/web-padawan/polymer3-webpack-starter/issues/33#issuecomment-474993984" target="_blank" rel="noopener">å¯èƒ½</a>æ˜¯<a href="https://jasonformat.com/modern-script-loading/" target="_blank" rel="noopener">å¥½äº‹</a>(ç›¸å¯¹äºä¸¤ä¸ªè„šæœ¬éƒ½åŠ è½½ä»¥åŠæœ‰ä¸€äº›bug)ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)  </span><br><span class="line"><span class="keyword">if</span> (<span class="string">'noModule'</span> <span class="keyword">in</span> s) &#123;  <span class="comment">// æ³¨æ„è¿™é‡Œçš„å¤§å°å†™</span></span><br><span class="line">  s.type = <span class="string">'module'</span></span><br><span class="line">  s.src = <span class="string">'/modern.js'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">  s.src = <span class="string">'/legacy.js'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.head.appendChild(s)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æŠŠå®ƒä»¬å°è£…æˆå‡½æ•°ï¼Œå¹¶ç¡®ä¿ä¸¤ç§æ–¹å¼éƒ½ç»Ÿä¸€ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼åŠ è½½(ä¸Šæ–‡æåˆ°æ¨¡å—scriptæ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¼ ç»Ÿscriptä¸æ˜¯):</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  $loadjs(<span class="string">"/modern.js"</span>,<span class="string">"/legacy.js"</span>)</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">$loadjs</span>(<span class="params">src,fallback,s</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="string">'noModule'</span> <span class="keyword">in</span> s) s.type = <span class="string">'module'</span>, s.src = src</span></span><br><span class="line"><span class="javascript">    <span class="keyword">else</span> s.async = <span class="literal">true</span>, s.src = fallback   <span class="comment">// ç»Ÿä¸€ä½¿ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.head.appendChild(s)</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹èµ·æ¥å·²ç»å¾ˆå®Œç¾äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ<strong>æˆ‘ä»¬è¿˜æ²¡è€ƒè™‘é¢„åŠ è½½(preloading)</strong></p><p>è¿™ä¸ªæœ‰ç‚¹è›‹ç–¼ï¼Œ å› ä¸ºä¸€èˆ¬æµè§ˆå™¨åªä¼šé™æ€åœ°æ‰«æHTMLï¼Œç„¶åæŸ¥æ‰¾å®ƒå¯ä»¥é¢„åŠ è½½çš„èµ„æºã€‚ æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„æ¨¡å—åŠ è½½å™¨æ˜¯å®Œå…¨åŠ¨æ€çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨æ²¡æœ‰è¿è¡Œæˆ‘ä»¬çš„ä»£ç ä¹‹å‰ï¼Œæ˜¯æ²¡åŠæ³•å‘ç°æˆ‘ä»¬è¦é¢„åŠ è½½ç°ä»£è¿˜æ˜¯ä¼ ç»Ÿçš„Javascriptèµ„æºçš„ã€‚</p><p>ä¸è¿‡æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œå°±æ˜¯ä¸å®Œç¾ï¼šå°±æ˜¯ä½¿ç”¨<code>&lt;link rel=modulepreload&gt;</code>æ¥é¢„åŠ è½½ç°ä»£ç‰ˆæœ¬çš„åŒ…, æ—§æµè§ˆå™¨ä¼šå¿½ç•¥è¿™æ¡è§„åˆ™ï¼Œç„¶è€Œç›®å‰<a href="https://developers.google.com/web/updates/2017/12/modulepreload" target="_blank" rel="noopener">åªæœ‰Chromeæ”¯æŒè¿™ä¹ˆåš</a>:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"modulepreload"</span> <span class="attr">href</span>=<span class="string">"/modern.js"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">self.modern=1</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- etc --&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å…¶å®é¢„åŠ è½½è¿™ç§æŠ€æœ¯æ˜¯å¦æœ‰æ•ˆï¼Œå–å†³äºåµŒå…¥ä½ çš„è„šæœ¬çš„HTMLæ–‡æ¡£çš„å¤§å°</strong>ã€‚</p><p>å¦‚æœä½ çš„HTMLè½½è·å¾ˆå°, æ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¯åŠ¨å±æˆ–è€…åªæ˜¯ç®€å•å¯åŠ¨å®¢æˆ·ç«¯åº”ç”¨ï¼Œé‚£ä¹ˆæ”¾å¼ƒé¢„åŠ è½½æ‰«æå¯¹ä½ çš„åº”ç”¨æ€§èƒ½å½±å“å¾ˆå°ã€‚<br>å¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“å¤§é‡æœ‰æ„ä¹‰çš„HTML, å¹¶ä»¥æµ(stream)çš„æ–¹å¼ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œé‚£ä¹ˆé¢„åŠ è½½æ‰«æå°±æ˜¯ä½ çš„æœ‹å‹ï¼Œä½†è¿™ä¹Ÿæœªå¿…æ˜¯æœ€ä½³æ–¹æ³•ã€‚</p><blockquote><p>è¯‘æ³¨: ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒåˆ†å—ç¼–ç ä¼ è¾“ï¼Œç­‰æœåŠ¡ç«¯å®Œå…¨è¾“å‡ºhtmlå¯èƒ½æœ‰ä¸€æ®µç©ºé—²æ—¶é—´ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡é¢„åŠ è½½æŠ€æœ¯ï¼Œè®©æµè§ˆå™¨é¢„å…ˆå»è¯·æ±‚èµ„æº</p></blockquote><p>å¤§æ¦‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"modulepreload"</span> <span class="attr">href</span>=<span class="string">"/modern.js"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">self.modern=1</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  $loadjs(<span class="string">"/modern.js"</span>,<span class="string">"/legacy.js"</span>)</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">$loadjs</span>(<span class="params">e,d,c</span>)</span>&#123;c=<span class="built_in">document</span>.createElement(<span class="string">"script"</span>),self.modern?(c.src=e,c.type=<span class="string">"module"</span>):c.src=d,<span class="built_in">document</span>.head.appendChild(c)&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæ”¯æŒ<a href="https://caniuse.com/#feat=es6-module" target="_blank" rel="noopener">JSæ¨¡å—çš„æµè§ˆå™¨</a>ä¸€èˆ¬ä¹Ÿ<a href="https://caniuse.com/#feat=link-rel-preload" target="_blank" rel="noopener">æ”¯æŒ</a><code>&lt;link rel = preload&gt;</code>ã€‚å¯¹äºæŸäº›ç½‘ç«™ï¼Œç›¸æ¯”ä¾é <code>modulepreload</code>, ä½¿ç”¨<code>&lt;link rel=preload as=script crossorigin&gt;</code>å¯èƒ½æ›´æœ‰æ„ä¹‰ã€‚ä¸è¿‡æ€§èƒ½ä¸Šé¢å¯èƒ½æ¬ ç‚¹ï¼Œå› ä¸ºä¼ ç»Ÿçš„è„šæœ¬é¢„åŠ è½½ä¸ä¼šåƒ<code>modulepreload</code>ä¸€æ ·éšç€æ—¶é—´çš„æ¨ç§»è€Œå»å±•å¼€è§£æå·¥ä½œ(<code>rel=preload</code>åªæ˜¯ä¸‹è½½ï¼Œä¸ä¼šå°è¯•å»è§£æè„šæœ¬)ã€‚</p><p><br></p><h2 id="é€‰é¡¹2-ç”¨æˆ·ä»£ç†å—…æ¢"><a href="#é€‰é¡¹2-ç”¨æˆ·ä»£ç†å—…æ¢" class="headerlink" title="é€‰é¡¹2: ç”¨æˆ·ä»£ç†å—…æ¢"></a>é€‰é¡¹2: ç”¨æˆ·ä»£ç†å—…æ¢</h2><p>æˆ‘åŠæ³•æ‹¿å‡ºä¸€ä¸ªç®€æ´çš„ä»£ç ç¤ºä¾‹ï¼Œå› ä¸ºç”¨æˆ·ä»£ç†æ£€æµ‹ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ï¼Œæ¨èé˜…è¯»è¿™ç¯‡<a href="https://www.smashingmagazine.com/2018/10/smart-bundling-legacy-code-browsers/" target="_blank" rel="noopener">Smashing Magazineæ–‡ç« </a></p><p>æœ¬è´¨ä¸Šï¼Œ<strong>è¿™ç§æŠ€æœ¯åœ¨æ¯ä¸ªæµè§ˆå™¨ä¸Šéƒ½ä½¿ç”¨<code>&lt;script src=bundle.js&gt;</code>æ¥åŠ è½½ä»£ç ï¼Œå½“<code>bundle.js</code>è¢«è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè§£ææµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†ï¼Œå¹¶é€‰æ‹©è¿”å›ç°ä»£ä»£ç è¿˜æ˜¯ä¼ ç»Ÿä»£ç ï¼Œå–å†³äºæµè§ˆå™¨æ˜¯å¦èƒ½è¢«è¯†åˆ«ä¸ºç°ä»£æµè§ˆå™¨</strong>.</p><p>å°½ç®¡è¿™ç§æ–¹æ³•æ¯”è¾ƒé€šç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ä¸¥é‡çš„ç¼ºç‚¹ï¼š</p><ul><li>å› ä¸ºä¾èµ–äºæœåŠ¡ç«¯å®ç°ï¼Œæ‰€ä»¥å‰ç«¯èµ„æºä¸èƒ½è¢«é™æ€éƒ¨ç½²(ä¾‹å¦‚é™æ€ç½‘ç«™ç”Ÿæˆå™¨(å¦‚github page)ï¼ŒNetlifyç­‰ç­‰)</li><li>å¾ˆéš¾è¿›è¡Œæœ‰æ•ˆçš„ç¼“å­˜. ç°åœ¨è¿™äº›JavaScript URLçš„ç¼“å­˜ä¼šå› ç”¨æˆ·ä»£ç†è€Œå¼‚ï¼Œè¿™æ˜¯éå¸¸ä¸ç¨³å®šçš„, è€Œå¾ˆå¤šç¼“å­˜æœºåˆ¶åªæ˜¯å°†URLä½œä¸ºç¼“å­˜é”®ï¼Œç°åœ¨è¿™äº›ç¼“å­˜ä¸­é—´ä»¶å¯èƒ½å°±æ²¡åŠæ³•å·¥ä½œäº†ã€‚</li><li>UAæ£€æµ‹å¾ˆéš¾ï¼Œå®¹æ˜“å‡ºç°è¯¯æŠ¥</li><li>ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²å®¹æ˜“è¢«ç¯¡æ”¹ï¼Œè€Œä¸”æ¯å¤©éƒ½æœ‰æ–°çš„UAå‡ºç°</li></ul><p>è§£å†³è¿™äº›é™åˆ¶çš„ä¸€ç§æ–¹æ³•å°±æ˜¯<strong>å°†<code>module/nomoduleæ¨¡å¼</code>ä¸â€™ç”¨æˆ·ä»£ç†åŒºåˆ†â€™ç»“åˆèµ·æ¥</strong>ï¼Œé¦–å…ˆè¿™å¯ä»¥é¿å…å•çº¯çš„<code>module/nomoduleæ¨¡å¼</code>éœ€è¦å‘é€å¤šä¸ªè½¯ä»¶åŒ…é—®é¢˜ï¼Œå°½ç®¡è¿™ç§æ–¹æ³•ä»ç„¶ä¼šé™ä½é¡µé¢(è¿™æ—¶å€™æŒ‡HTMLï¼Œè€Œä¸æ˜¯JavascriptåŒ…)çš„å¯ç¼“å­˜æ€§ï¼Œä½†æ˜¯å®ƒå¯ä»¥æœ‰æ•ˆåœ°è§¦å‘é¢„åŠ è½½ï¼Œå› ä¸ºç”ŸæˆHTMLçš„æœåŠ¡å™¨æ ¹æ®ç”¨æˆ·ä»£ç†çŸ¥é“åº”è¯¥ä½¿ç”¨<code>modulepreload</code>è¿˜æ˜¯<code>preload</code>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderPage</span>(<span class="params">request, response</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">let</span> html = <span class="string">`&lt;html&gt;&lt;head&gt;...`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> agent = request.headers.userAgent;</span><br><span class="line">  <span class="keyword">const</span> isModern = userAgent.isModern(agent);</span><br><span class="line">  <span class="keyword">if</span> (isModern) &#123;</span><br><span class="line">    html += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;link rel=modulepreload href=modern.mjs&gt;</span></span><br><span class="line"><span class="string">      &lt;script type=module src=modern.mjs&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    html += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;link rel=preload as=script href=legacy.js&gt;</span></span><br><span class="line"><span class="string">      &lt;script src=legacy.js&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  response.end(html);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºé‚£äº›å·²ç»åœ¨ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„ç½‘ç«™æ¥è¯´ï¼Œç”¨æˆ·ä»£ç†å—…æ¢æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ</p><p><br></p><h2 id="é€‰é¡¹-3-ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨"><a href="#é€‰é¡¹-3-ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨" class="headerlink" title="é€‰é¡¹ 3:ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨"></a>é€‰é¡¹ 3:ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨</h2><p><strong>æ³¨æ„è¿™é‡Œçš„â€˜æ—§ç‰ˆæœ¬æµè§ˆå™¨â€™ç‰¹æŒ‡é‚£äº›å‡ºç°åŒé‡åŠ è½½çš„æµè§ˆå™¨</strong>. å¯¹äº<code>module/nomoduleæ¨¡å¼</code>æ”¯æŒæ¯”è¾ƒå·®(å³åŒé‡åŠ è½½)çš„ä¸»è¦æ˜¯ä¸€äº›æ—§ç‰ˆæœ¬çš„Chromeã€Firefoxå’ŒSafari. å¹¸è¿çš„æ˜¯è¿™éƒ¨åˆ†æµè§ˆå™¨çš„å¸‚åœºèŒƒå›´é€šå¸¸æ˜¯æ¯”è¾ƒçª„ï¼Œå› ä¸ºç”¨æˆ·ä¼šè‡ªåŠ¨å‡çº§åˆ°æœ€æ–°çš„ç‰ˆæœ¬ã€‚Edge 16-18æ˜¯ä¾‹å¤–, ä½†è¿˜æœ‰å¸Œæœ›ï¼š æ–°ç‰ˆæœ¬çš„Edgeä¼šä½¿ç”¨åŸºäºChromiumçš„æ¸²æŸ“å™¨ï¼Œå¯ä»¥ä¸å—è¯¥é—®é¢˜çš„å½±å“.</p><p>å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ¥å—è¿™ä¸€ç‚¹å¦¥åæ˜¯å®Œå…¨åˆç†çš„ï¼šä½ å¯ä»¥ç»™90ï¼…çš„æµè§ˆå™¨ä¸­æä¾›ç°ä»£ä»£ç ï¼Œè®©ä»–ä»¬è·å¾—æ›´å¥½çš„ä½“éªŒï¼Œè€Œæå°‘æ•°æ—§æµè§ˆå™¨ä¸å¾—ä¸æŠ›å¼ƒå®ƒä»¬ï¼Œå®ƒä»¬åªæ˜¯ä»˜å‡ºçš„é¢å¤–å¸¦å®½(å³åŒé‡åŠ è½½)ï¼Œå¹¶ä¸å½±å“åŠŸèƒ½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå æ®ç§»åŠ¨ç«¯ä¸»è¦å¸‚åœºä»½é¢çš„ç”¨æˆ·ä»£ç†ä¸ä¼šæœ‰åŒé‡åŠ è½½é—®é¢˜ï¼Œæ‰€ä»¥è¿™äº›æµé‡ä¸å¤ªå¯èƒ½æ¥è‡ªäºä½é€Ÿæˆ–è€…é«˜æ˜‚æµé‡è´¹çš„æ‰‹æœºã€‚</p><p>å¦‚æœä½ çš„ç½‘ç«™ç”¨æˆ·ä¸»è¦ä½¿ç”¨ç§»åŠ¨è®¾å¤‡æˆ–è¾ƒæ–°ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„<code>module/nomodule</code>æ¨¡å¼å°†é€‚ç”¨äºä½ çš„ç»å¤§å¤šæ•°ç”¨æˆ·, å…¶ä»–ç”¨æˆ·å°±ä¸è€ƒè™‘äº†ï¼Œåæ­£ä¹Ÿæ˜¯å¯ä»¥è·‘èµ·æ¥çš„, ä¼˜å…ˆè€ƒè™‘å¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¿®å¤Safari 10.1 ä¸æ”¯æŒ `nomodule` é—®é¢˜: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">!<span class="function"><span class="keyword">function</span>(<span class="params">e,t,n</span>)</span>&#123;!(<span class="string">"noModule"</span><span class="keyword">in</span>(t=e.createElement(<span class="string">"script"</span>)))&amp;&amp;<span class="string">"onbeforeload"</span><span class="keyword">in</span> t&amp;&amp;(n=!<span class="number">1</span>,e.addEventListener(<span class="string">"beforeload"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">if</span>(e.target===t)n=!<span class="number">0</span>;<span class="keyword">else</span> <span class="keyword">if</span>(!e.target.hasAttribute(<span class="string">"nomodule"</span>)||!n)<span class="keyword">return</span>;e.preventDefault()&#125;,!<span class="number">0</span>),t.type=<span class="string">"module"</span>,t.src=<span class="string">"."</span>,e.head.appendChild(t),t.remove())&#125;(<span class="built_in">document</span>)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é€‚ç”¨äº90+% çš„æµè§ˆå™¨: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">modern.js</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- éƒ¨åˆ†æ”¯æŒmoduleä½†æ˜¯ä¸æ”¯æŒnomoduleçš„æµè§ˆå™¨ï¼Œä¹Ÿä¼šåŠ è½½ä¸‹é¢è„šæœ¬ï¼ŒèŒƒå›´å¯èƒ½å¾ˆå°ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¿½ç•¥å®ƒä»¬: --&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- IE, Edge &lt;16, Safari &lt;10.1, old desktop: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">legacy.js</span> <span class="attr">nomodule</span> <span class="attr">async</span> <span class="attr">defer</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="é€‰é¡¹-4-ä½¿ç”¨æ¡ä»¶åŒ…"><a href="#é€‰é¡¹-4-ä½¿ç”¨æ¡ä»¶åŒ…" class="headerlink" title="é€‰é¡¹ 4: ä½¿ç”¨æ¡ä»¶åŒ…"></a>é€‰é¡¹ 4: ä½¿ç”¨æ¡ä»¶åŒ…</h2><p><strong><code>nomodule</code>å¯ä»¥å·§å¦™åœ°ç”¨æ¥<em>æ¡ä»¶åŠ è½½</em>é‚£äº›ç°ä»£æµè§ˆå™¨ä¸éœ€è¦çš„ä»£ç </strong>ï¼Œ ä¾‹å¦‚polyfillsã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯polyfillå’Œbundleéƒ½ä¼šè¢«åŠ è½½(ä¾‹å¦‚Safari 10.1)ï¼Œä½†è¿™æ¯•ç«Ÿæ˜¯å°‘æ•°ã€‚é‰´äºç›®å‰é€šè¡Œçš„åšæ³•å°±æ˜¯åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­ä¸€è‡´åŒä»åœ°åŠ è½½polyfillsï¼Œç›¸æ¯”è€Œè¨€, <em>æ¡ä»¶polyfills</em>å¯ä»¥è®©å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨ç”¨æˆ·é¿å…åŠ è½½polyfillä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- newer browsers won't load this bundle: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"polyfills.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- all browsers load this one: --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Angular CLIæ”¯æŒé…ç½®è¿™ç§æ–¹å¼æ¥åŠ è½½polyfill, æŸ¥çœ‹<a href="https://blog.mgechev.com/2019/02/06/5-angular-cli-features/#conditional-polyfill-serving" target="_blank" rel="noopener">Minko Gechevçš„ä»£ç ç¤ºä¾‹</a>.<br>äº†è§£äº†è¿™ç§æ–¹å¼ä¹‹åï¼Œæˆ‘å†³å®šåœ¨preact-cliä¸­æ”¯æŒè‡ªåŠ¨polyfillæ³¨å…¥ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¿™ä¸ª<a href="https://github.com/preactjs/preact-cli/pull/833/files" target="_blank" rel="noopener">PR</a></p><p>å¦‚æœä½ ä½¿ç”¨Webpackï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªhtml-webpack-plugin<a href="https://github.com/swimmadude66/webpack-nomodule-plugin" target="_blank" rel="noopener">æ’ä»¶</a>å¯ä»¥æ–¹ä¾¿åœ°ä¸ºpolyfillåŒ…æ·»åŠ <code>nomodule</code>å±æ€§.</p><p><br></p><h2 id="ä½ åº”è¯¥æ€ä¹ˆåš"><a href="#ä½ åº”è¯¥æ€ä¹ˆåš" class="headerlink" title="ä½ åº”è¯¥æ€ä¹ˆåš?"></a>ä½ åº”è¯¥æ€ä¹ˆåš?</h2><p>ç­”æ¡ˆå–å†³äºä½ çš„ä½¿ç”¨åœºæ™¯, é€‰æ‹©å’Œä½ ä»¬çš„æ¶æ„åŒ¹é…çš„é€‰é¡¹:<br>å¦‚æœä½ çš„åº”ç”¨åªæ˜¯å®¢æˆ·ç«¯æ¸²æŸ“, è€Œä¸”ä½ çš„HTMLä¸è¶…è¿‡ä¸€ä¸ª<code>&lt;script&gt;</code>ï¼Œé€‰é¡¹1æ¯”è¾ƒåˆé€‚ï¼›<br>å¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè€Œä¸”å¯ä»¥æ¥å—ç¼“å­˜é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©é€‰é¡¹2ï¼›<br>å¦‚æœä½ å¼€å‘çš„æ˜¯<a href="https://developers.google.com/web/updates/2019/02/rendering-on-the-web#rehydration" target="_blank" rel="noopener">åŒæ„åº”ç”¨</a>ï¼Œé¢„åŠ è½½çš„åŠŸèƒ½å¯èƒ½å¯¹ä½ å¾ˆé‡è¦ï¼Œè¿™æ—¶ä½ å¯ä»¥è€ƒè™‘é€‰é¡¹3å’Œ4.</p><p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œç›¸æ¯”è€ƒè™‘æ¡Œé¢ç«¯æµè§ˆå™¨èµ„æºä¸‹è½½æˆæœ¬ï¼Œæˆ‘æ›´å€¾å‘äºä¼˜åŒ–ç§»åŠ¨è®¾å¤‡è§£ææ—¶é—´. ç§»åŠ¨ç”¨æˆ·ä½“éªŒä¼šå—åˆ°æ•°æ®è§£æã€æµé‡è´¹ç”¨ï¼Œç”µæ± æ¶ˆè€—ç­‰å› ç´ çš„å½±å“ï¼Œè€Œæ¡Œé¢ç”¨æˆ·å¾€å¾€ä¸éœ€è¦è€ƒè™‘è¿™äº›å› ç´ ã€‚<br>å¦å¤–è¿™äº›ä¼˜åŒ–é€‚ç”¨äº90%çš„ç”¨æˆ·ï¼Œæ¯”å¦‚æˆ‘å·¥ä½œé¢å¯¹çš„å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½æ˜¯ä½¿ç”¨ç°ä»£æˆ–ç§»åŠ¨æµè§ˆå™¨çš„ã€‚</p><p><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><p>æœ‰å…´è¶£ç»§ç»­æ·±å…¥ï¼Ÿå¯ä»¥ä»ä¸‹é¢çš„æ–‡ç« å¼€å§‹æŒ–æ˜ï¼š</p><ul><li>Philçš„<a href="https://github.com/philipwalton/webpack-esnext-boilerplate/issues/1" target="_blank" rel="noopener">webpack-esnext-boilerplate</a>çš„ä¸€äº›é™„åŠ çš„èƒŒæ™¯.</li><li>Ralph<a href="https://github.com/zeit/next.js/pull/7704" target="_blank" rel="noopener">åœ¨Next.jsä¸­å®ç°äº†module/nomodule</a>, å¹¶åŠªåŠ›è§£å†³äº†ä¸Šé¢çš„é—®é¢˜.</li></ul><p>æ„Ÿè°¢<a href="https://twitter.com/philwalton" target="_blank" rel="noopener">Phil</a>, <a href="https://twitter.com/shubhie" target="_blank" rel="noopener">Shubhie</a>, <a href="https://twitter.com/atcastle" target="_blank" rel="noopener">Alex</a>, <a href="https://twitter.com/hdjirdeh" target="_blank" rel="noopener">Houssein</a>, <a href="https://twitter.com/Janicklas" target="_blank" rel="noopener">Ralph</a> ä»¥åŠ <a href="https://twitter.com/addyosmani" target="_blank" rel="noopener">Addy</a> çš„åé¦ˆ.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡åœ°å€: &lt;a href=&quot;https://jasonformat.com/modern-script-loading/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Modern Script Loading&lt;/a&gt;, æ–‡ç« ä½œè€…æ˜¯Preactä½œè€…&lt;a 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Javascriptç«Ÿç„¶æ²¡æœ‰æ ‡å‡†åº“?</title>
    <link href="https://bobi.ink/2019/07/16/js-stdlib/"/>
    <id>https://bobi.ink/2019/07/16/js-stdlib/</id>
    <published>2019-07-15T16:00:00.000Z</published>
    <updated>2019-08-12T04:27:48.955Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨SegmentFaultçƒ­å¿ƒè§£é¢˜ï¼Œä¸€ä¸ªé—®é¢˜æ¯”è¾ƒè®©æˆ‘æ¯”è¾ƒå°è±¡æ·±åˆ»ï¼š<em>ä¸€ä¸ªåˆå­¦è€…è¯•å›¾åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥Node.jsçš„netæ¨¡å—ã€‚ç»“æœåœ¨æ§åˆ¶å°æ‰“å°åæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</em>ã€‚</p><p>å¯¹äºæœ‰ç‚¹Javascriptç»éªŒçš„äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜å¼±æ™ºâ€™é—®é¢˜ï¼Œæ€ä¹ˆå¯ä»¥åœ¨æµè§ˆå™¨ç«¯è¿è¡ŒNodeç¨‹åºå‘¢ï¼Ÿå› ä¸ºè¿™äº›Nodeæ¨¡å—ç»è¿‡<a href="http://webpack.docschina.org/configuration/node/#å…¶ä»–-node-js-æ ¸å¿ƒåº“-node-js-core-libraries-" target="_blank" rel="noopener">Webpackå¤„ç†</a>, æ‰€ä»¥å˜æˆäº†ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ›´å¥½çš„å¤„ç†æ–¹å¼åº”è¯¥æ˜¯æŠ›å‡ºå¼‚å¸¸.</p><p><strong>ä»”ç»†åæ€ä¸€ä¸‹ï¼Œå¯¹äºè¿™äº›åˆšå…¥é—¨Javascriptçš„æˆ–è€…ä»å…¶ä»–è¯­è¨€åˆ‡æ¢è¿‡æ¥çš„å¼€å‘è€…ï¼Œä»–ä»¬å‹æ ¹å°±æ²¡æœ‰æ¦‚å¿µï¼Œæ¯”å¦‚Pythonã€Rubyã€Javaè¿™äº›è¯­è¨€éƒ½æœ‰å¼ºå¤§çš„æ ‡å‡†åº“ï¼Œå¯ä»¥æ»¡è¶³80%çš„å¼€å‘éœ€æ±‚ï¼Œä¸ç®¡å®ƒåœ¨ä»€ä¹ˆç¯å¢ƒã€ä»€ä¹ˆå¹³å°è¿è¡Œï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥ç»Ÿä¸€ä½¿ç”¨è¿™å¥—æ ‡å‡†åº“ã€‚è€ŒJavascriptç›®å‰çš„ç°çŠ¶æ˜¯ï¼šä¸åŒçš„è¿è¡Œç¯å¢ƒï¼ŒAPIç»“æ„æ˜¯å‰²è£‚çš„</strong>ã€‚</p><p>Javascriptè¿™é—¨åå‡ å¤©å¼€å‘å‡ºæ¥çš„ã€ä¸“ä¾›æµè§ˆå™¨çš„è¯­è¨€ï¼Œå¯èƒ½å½“åˆè®¾è®¡æ˜¯æ ¹æœ¬å°±æ²¡æœ‰è€ƒè™‘æ ‡å‡†åº“è¿™äº›ç©æ„ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿï¼Œç½‘ç»œç­‰ç­‰ã€‚<strong>å› ä¸ºè¿™ä¸ªèƒŒæ™¯, Javascripté•¿æœŸä¸å…·å¤‡ç‹¬ç«‹æ€§ï¼Œå®ƒæ·±åº¦ä¾èµ–äºæµè§ˆå™¨è¿™ä¸ªè¿è¡Œç¯å¢ƒ, å¤„äºä¸€ç§ç»™æµè§ˆå™¨æ‰“è¾…åŠ©çš„è§’è‰²</strong>, æ‰€ä»¥Javascriptå¾ˆå¤šå¹´æ²¡æœ‰èµ°å‡ºæµè§ˆå™¨ç©å…·è¯­è¨€è¿™ä¸ªèŒƒå›´.</p><p>å½“ç„¶è¿™æ—¢æ˜¯åŠ£åŠ¿ï¼Œä¹Ÿæ˜¯ä¼˜åŠ¿, ç°åœ¨æ²¡ä»»ä½•è¯­è¨€èƒ½æ’¼åŠ¨Javascriptåœ¨æµè§ˆå™¨ä¸­çš„åœ°ä½ã€‚</p><p>æˆ‘æƒ³å¾ˆå¤šäººè·Ÿæˆ‘å½“åˆä¸€æ ·è®¤ä¸º<strong>æµè§ˆå™¨æä¾›çš„Web API === Javascriptçš„æ ‡å‡†åº“</strong>, æ¯”å¦‚<code>console.log</code>ã€<code>setTimeout</code>(ä¸‹æ–‡ä¼šä»‹ç»è¿™äº›åŠŸèƒ½éƒ½ä¸åœ¨Javascriptè§„èŒƒé‡Œé¢). æ­£å¦‚å½“å¹´é‚£äº›æŠŠJQueryå½“æˆâ€˜Javascriptâ€™çš„äºº.</p><p>ç›´åˆ°NodeJSçš„å‡ºç°ï¼ŒJavascriptæ‰æŒ£è„±æµè§ˆå™¨çº¦æŸï¼Œå»¶ä¼¸åˆ°æœåŠ¡å™¨é¢†åŸŸ, ä¸å†æ˜¯ä¸€ä¸ªâ€™æ²™ç›’è¯­è¨€â€™ã€‚NodeJSå®šä¹‰äº†å¾ˆå¤šæ¨¡å—æ¥æ”¯æ’‘æœåŠ¡ç«¯çš„å¼€å‘, å¦‚fsã€osã€Bufferã€netã€‚ä½†æ˜¯è¿™äº›APIä¸€æ ·ä¸æ˜¯Javascriptçš„æ ‡å‡†ã€ä¹Ÿå°±æ˜¯è¯´<strong>NodeJS !== Javascript</strong>.</p><p>å†åˆ°åæ¥ï¼Œå­¦ä¸åŠ¨äº†ï¼ŒNodeJSåŸä½œè€…åæ§½äº†ä¸€é€šNodeJSï¼Œåˆæå‡ºäº†ä¸€ä¸ª<a href="https://deno.land" target="_blank" rel="noopener">Deno</a>, å®ƒä¹Ÿä¼šæœ‰è‡ªå·±æ ‡å‡†åº“ï¼Œä¼šå®šä¹‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œAPIã€‚ä»åå­—ä¸Šå°±æš—ç¤ºç€è¿™äº›APIä¸å¯èƒ½å’ŒNodeJSå…¼å®¹ã€‚Okï¼Œç°åœ¨å›åˆ°æ–‡ç« å¼€å§‹é‚£ä¸ªé—®é¢˜ï¼Œ<strong>å¦‚æœdenoå‘å±•èµ·æ¥ï¼Œè¯´ä¸å®šå“ªå¤©åˆæœ‰äººå°è¯•åœ¨æµè§ˆå™¨å¼•ç”¨Denoçš„æ¨¡å—</strong>ï¼Ÿ</p><p><br><br><br></p><h2 id="ç°æœ‰çš„javascript-apiç»“æ„"><a href="#ç°æœ‰çš„javascript-apiç»“æ„" class="headerlink" title="ç°æœ‰çš„Javascript APIç»“æ„"></a>ç°æœ‰çš„Javascript APIç»“æ„</h2><p><img src="/images/js-stdlib/outline.png" alt></p><p>å¦‚ä¸Šå›¾, Javascriptå…¶å®æ˜¯æœ‰ä¸€å±‚æ¯”è¾ƒè–„å…¨å±€çš„ã€é€šç”¨çš„ã€<strong>æ ‡å‡†çš„</strong>ã€æ ¸å¿ƒçš„APIå±‚ï¼Œå³<code>æ ‡å‡†å†…ç½®å¯¹è±¡</code>ï¼Œè¿™æ˜¯ä¸€äº›è¯­è¨€æ ¸å¿ƒçš„å†…ç½®å¯¹è±¡ï¼Œå¯ä»¥å…¨å±€è®¿é—®ã€‚å…³é”®çš„æ˜¯è¿™äº›æ˜¯æ ‡å‡†çš„ï¼Œå®ƒä»¬åœ¨<a href="https://tc39.es/ecma262/#sec-global-object" target="_blank" rel="noopener">ECMAScriptè§„èŒƒ</a>ä¸­è¢«å®šä¹‰. åœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šï¼Œä¸åŒçš„è¿è¡Œç¯å¢ƒæ‹“å±•äº†è‡ªå·±çš„APIã€‚</p><p>ä»¥æµè§ˆå™¨ä¸ºä¾‹:</p><p><img src="/images/js-stdlib/brw.png" alt></p><p>æµè§ˆå™¨ç«¯çš„Web APIæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚APIé›†åˆï¼Œä¸Šå›¾æ€»ç»“äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬å°±åŒ…å«ä¸¤å—ä¸œè¥¿:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model" target="_blank" rel="noopener">Core DOM</a>. DOMæ˜¯ä¸€ä¸ªé€šç”¨çš„æŠ€æœ¯ï¼Œä¸ä»…ä»…å±€é™äºæµè§ˆå™¨ï¼Œè¿™ä¸ªè§„èŒƒå®šä¹‰äº†ç»“æ„åŒ–(structured document)æ–‡æ¡£çš„è§£æå’Œæ“ä½œè§„èŒƒã€‚å®šä¹‰äº†åŸºæœ¬çš„èŠ‚ç‚¹ç±»å‹å’Œæ“ä½œæ–¹æ³•ã€‚ä¸å±€é™äºHTMLçš„æ“ä½œ</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM" target="_blank" rel="noopener">HTML DOM</a>. å¯ä»¥è®¤ä¸ºæ˜¯Core DOMçš„æ‰©å±•ï¼Œè¿™é‡Œé¢å®šä¹‰äº†å„ç§HTMLå…ƒç´ å¯¹è±¡ç±»å‹ã€æ‰©å±•äº†å…ƒç´ çš„æ“ä½œæ–¹æ³•ï¼Œå¦å¤–è¿˜åŒ…å«äº†æµè§ˆå™¨ç›¸å…³çš„æ¥å£ï¼Œå¦‚XMLHttpRequestã€‚è¿™ä¸€å—é€šå¸¸ä¹Ÿè¢«ç»Ÿç§°ä¸ºBOM</li></ul><p>WebAPIåŸºæœ¬æ¦‚è§ˆ:</p><p><img src="/images/js-stdlib/webAPI.png" alt></p><p>å¦‚æœä½ æœ‰ç•™å¿ƒæŸ¥çœ‹MDNæ–‡æ¡£ä¸‹é¢çš„è§„èŒƒå¼•ç”¨ï¼Œä½ ä¼šå‘ç°æœ‰äº›è§„èŒƒå¼•ç”¨äº†<a href="https://www.w3.org/TR/" target="_blank" rel="noopener">W3C</a>, æœ‰äº›åˆ™å¼•ç”¨äº†<a href="https://html.spec.whatwg.org/multipage/" target="_blank" rel="noopener">WHATWG</a>. åˆ°åº•è°è¯´äº†ç®—?</p><p>å¦‚æœä½ æ€å¼€é”…ç›–ï¼Œå°±ä¼šå‘ç°è¿™æ˜¯ä¸€åœºé—¹å‰§. å¦‚æœå‰é˜µå­æœ‰å…³æ³¨æ–°é—»ï¼Œä¼šçœ‹åˆ°è¿™äº›æ ‡é¢˜â€˜<em>WHATWG å‡»è´¥ W3Cï¼Œèµ¢å¾— HTML å’Œ DOM çš„æ§åˆ¶æƒ</em>â€™ã€â€™<em>W3Cå°†ä¸WHATWGåˆä½œåˆ¶å®šæœ€æ–°HTMLå’ŒDOMè§„èŒƒæ ‡å‡†</em>â€˜. å¤§æ¦‚å¯ä»¥çŒœå‡ºè¿™ä¸¤ä¸ªç»„ç»‡ä¹‹é—´çš„å…³ç³». æœ¬æ–‡å°±ä¸æ‰¯è¿™äº›â€˜å…«å¦â€™äº†ï¼Œç›¸å…³èƒŒæ™¯å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.infoq.cn/article/bsvFxt96DOh-SBZphBwJ" target="_blank" rel="noopener">WHATWG å‡»è´¥ W3Cï¼Œèµ¢å¾— HTML å’Œ DOM çš„æ§åˆ¶æƒ</a></p><p>ç›¸å¯¹è€Œè¨€, è¯­è¨€å±‚åˆ™ç”±ECMAScriptè§„èŒƒå®šä¹‰çš„ï¼Œæ¯”è¾ƒç‹¬ç«‹, è¿‘äº›å¹´æˆæœä¹Ÿæ¯”è¾ƒæ˜¾è‘—.</p><p><br></p><h3 id="æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿"><a href="#æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿" class="headerlink" title="æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿"></a>æ ‡å‡†å†…ç½®å¯¹è±¡å±‚ä¸»è¦åŒ…å«è¿™äº›ä¸œè¥¿</h3><ul><li>ç‰¹æ®Šå€¼<ul><li>Infinity</li><li>NaN</li><li>undefined</li><li>null</li><li>globalThis</li></ul></li><li>å‡½æ•°<ul><li>eval()</li><li>uneval() </li><li>isFinite()</li><li>isNaN()</li><li>parseFloat()</li><li>parseInt()</li><li>decodeURI()</li><li>decodeURIComponent()</li><li>encodeURI()</li><li>encodeURIComponent()</li></ul></li><li>åŸºç¡€å¯¹è±¡<ul><li>Object</li><li>Function</li><li>Boolean</li><li>Symbol</li><li>Error</li><li>EvalError</li><li>InternalError </li><li>RangeError</li><li>ReferenceError</li><li>SyntaxError</li><li>TypeError</li><li>URIError</li></ul></li><li>æ•°å€¼å’Œæ—¶é—´<ul><li>Number</li><li>BigInt</li><li>Math</li><li>Date</li></ul></li><li>æ–‡æœ¬å¤„ç†<ul><li>String</li><li>RegExp</li></ul></li><li>ç´¢å¼•å®¹å™¨<ul><li>Array</li><li>â€˜TypedArrayâ€™</li></ul></li><li>é”®å€¼å®¹å™¨<ul><li>Map</li><li>Set</li><li>WeakMap</li><li>WeakSet</li></ul></li><li>ç»“æ„åŒ–æ•°æ®<ul><li>ArrayBuffer</li><li>SharedArrayBuffer </li><li>Atomics </li><li>DataView</li><li>JSON</li></ul></li><li>æ§åˆ¶æŠ½è±¡åŒ–å¯¹è±¡<ul><li>Promise</li><li>Generator</li><li>GeneratorFunction</li><li>AsyncFunction </li></ul></li><li>åå°„<ul><li>Reflect</li><li>Proxy</li></ul></li><li>å›½é™…åŒ–<ul><li>Intl</li></ul></li><li>WebAssembly</li><li>å…¶ä»–<ul><li>arguments</li></ul></li></ul><p><br></p><p>è¿™äº›å…¨å±€åŸºæœ¬å¯¹è±¡æ•°é‡å¾ˆå°‘, è¿™äº›å¯¹è±¡æ˜¯æ¯ä¸ªJavaScriptå¼€å‘è€…å¿…é¡»æŒæ¡çš„. </p><p>å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨çš„éå¸¸é¢‘ç¹çš„Timerå’ŒConsoleéƒ½ä¸å†æ­¤åˆ—.</p><p>è¿™äº›å¯¹è±¡åªèƒ½æ»¡è¶³å¾ˆåŸºæœ¬å¼€å‘éœ€æ±‚, æ ¹æœ¬ä¸èƒ½å’Œå…¶ä»–è¯­è¨€çš„æ ‡å‡†åº“ç›¸æ¯”. <strong>å½“ç„¶è¿™å’Œè¯­è¨€çš„å®šä½ä¹Ÿæœ‰ä¸€å®šå…³ç³»</strong></p><p><br><br><br></p><h2 id="ä»€ä¹ˆæ˜¯æ ‡å‡†åº“"><a href="#ä»€ä¹ˆæ˜¯æ ‡å‡†åº“" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ‡å‡†åº“?"></a>ä»€ä¹ˆæ˜¯æ ‡å‡†åº“?</h2><p>æ ‡å‡†åº“æ²¡æœ‰ä¸€ä¸ªä¸¥æ ¼çš„å®šä¹‰ï¼ŒæŒ‰ç…§Wikiçš„è¯´æ³•æ ‡å‡†åº“å°±æ˜¯<strong>è¯¥è¯­è¨€åœ¨ä¸åŒå®ç°ä¸­éƒ½æŒ‰ä¾‹æä¾›çš„åº“</strong>, æ¯”å¦‚Rubyå®˜æ–¹å®ç°cRubyå’ŒåŸºäºJVMçš„JRubyéƒ½æŒ‰ç…§å®˜æ–¹æ ‡å‡†åº“è§„èŒƒå®ç°äº†æ ‡å‡†åº“ã€‚ <strong>æ ‡å‡†åº“æ€ä¹ˆè®¾è®¡ï¼Œéœ€è¦åŒ…å«ä»€ä¹ˆå†…å®¹å–å†³äºè¯­è¨€å„è‡ªç§‰æŒçš„å“²å­¦å’Œå®šä½</strong>ã€‚ æˆ‘è®¤ä¸ºæ ‡å‡†åº“åº”è¯¥æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li>æ ‡å‡†åŒ–çš„. æœ‰è§„èŒƒæ˜ç¡®å®šä¹‰å®ƒçš„å†…å®¹å’Œè¡Œä¸º</li><li>å†…å®¹ç»è¿‡ä»”ç»†é›•ç¢å’ŒæŒ‘é€‰ï¼Œå¯ä»¥è¦†ç›–å¤§éƒ¨åˆ†ä½¿ç”¨åœºæ™¯æˆ–è€…ç¬¦åˆçš„è¯­è¨€å®šä½</li><li>å¯é€‰çš„ã€æŒ‰éœ€å¯¼å…¥. æ ‡å‡†åº“ä¸æ˜¯å…¨å±€çš„ï¼Œéœ€è¦é€šè¿‡æ¨¡å—å¯¼å…¥, éå¼ºåˆ¶æ€§ä½¿ç”¨</li></ul><p><br></p><p>è‡³äºæ ‡å‡†åº“éœ€è¦åŒ…å«ä»€ä¹ˆå†…å®¹ï¼Œå¯ä»¥å‚è€ƒå…¶ä»–è¯­è¨€çš„å®ç°ã€‚æ¯”å¦‚ï¼š</p><ul><li><a href="https://golang.org/pkg/" target="_blank" rel="noopener">go</a></li><li><a href="http://ruby-doc.org/stdlib-2.6.3/" target="_blank" rel="noopener">ruby</a></li><li><a href="https://docs.python.org/3/library/index.html" target="_blank" rel="noopener">python</a></li></ul><p><br></p><p>å¤§æ¦‚åˆ†æä¸€ä¸‹ï¼Œå®ƒä»¬æ ‡å‡†åº“å¤§è‡´éƒ½æœ‰è¿™äº›å†…å®¹ï¼š</p><ul><li>ç½‘ç»œåè®®</li><li>æ–‡ä»¶ç³»ç»Ÿ<ul><li>æ–‡ä»¶ç³»ç»Ÿ</li><li>æµ</li><li>æ ‡å‡†è¾“å…¥è¾“å‡º</li><li>äºŒè¿›åˆ¶å¤„ç†</li></ul></li><li>ç®—æ³•<ul><li>å¯†ç ç®—æ³•</li><li>ç¼–ç </li><li>å‹ç¼©ã€å½’æ¡£</li><li>æ’åº</li><li>æ•°å­¦</li><li>å­—ç¬¦ä¸²ã€æ–‡æœ¬</li></ul></li><li>æ•°æ®ç»“æ„, ä¾‹å¦‚æ ‘ã€å †ã€é˜Ÿåˆ—ç­‰ç­‰</li><li>æ•°æ®æŒä¹…åŒ–å’Œåºåˆ—åŒ–. æ¯”å¦‚JSONåºåˆ—åŒ–ï¼ŒäºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œæ•°æ®åº“æ“ä½œç­‰ç­‰</li><li>è°ƒè¯•/è¾…åŠ©</li><li>å•å…ƒæµ‹è¯•</li><li>æ–‡æ¡£å¤„ç†</li><li>è®¾è®¡æ¨¡å¼. æ ‡å‡†åº“ä¸­ç»å¸¸ä¼šæºå¸¦(æˆ–è¾…åŠ©è®¾è®¡)è¯¥è¯­è¨€çš„æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼, ä¾‹å¦‚goä¸­çš„context, Rubyä¸­çš„singleton</li><li>å›½é™…åŒ–</li><li>æ—¶é—´ã€æ—¥æœŸ</li><li>æ“ä½œç³»ç»Ÿ<ul><li>å‘½ä»¤è¡Œ</li><li>ç¯å¢ƒå˜é‡</li><li>ç³»ç»Ÿèµ„æº</li></ul></li><li>å¹¶å‘<ul><li>è¿›ç¨‹</li><li>çº¿ç¨‹</li><li>åç¨‹</li></ul></li><li>è¯­è¨€æˆ–è¿è¡Œæ—¶çš„åº•å±‚æ¥å£</li></ul><p>å¤§éƒ¨åˆ†è¯­è¨€çš„æ ¸å¿ƒéƒ½å¾ˆå°(C++é™¤å¤–)ï¼Œæˆ‘ä»¬å­¦ä¸€é—¨è¯­è¨€ï¼Œå¤§éƒ¨åˆ†æ—¶é—´æ˜¯èŠ±åœ¨æ ‡å‡†åº“ä¸Šå’Œè¯­è¨€çš„ç”Ÿæ€ä¸Šé¢ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°è¿™äº›æ ‡å‡†åº“ä¸€èˆ¬éƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰ç»éªŒçš„å¼€å‘è€…å¯ä»¥å¾ˆå¿«åœ°å…¥æ‰‹ä¸€é—¨è¯­è¨€.</p><p>æ˜¾ç„¶ä¸Šé¢è¿™äº›åŠŸèƒ½å¤§éƒ¨åˆ†åœ¨NodeJSä¸­å·²ç»å®ç°äº†ï¼Œ<strong>é‰´äºNodeJSè¿™ä¹ˆå¹¿æ³›çš„ä½¿ç”¨ç‡ï¼ŒNodeJSå¯ä»¥ç®—æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†äº†</strong></p><p><br></p><h2 id="æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“"><a href="#æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“" class="headerlink" title="æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“?"></a>æˆ‘ä»¬éœ€è¦æ ‡å‡†åº“?</h2><p><img src="/images/js-stdlib/dep.png" alt></p><p>æ˜¾ç„¶è¦ç»“åˆå½“å‰çš„èƒŒæ™¯æ¥è¾©è¯åœ°è€ƒè™‘ã€‚</p><p><strong>æœ‰æ ‡å‡†åº“æœ‰ä»€ä¹ˆå¥½å¤„?</strong></p><ul><li>æ ‡å‡†åº“æä¾›é€šç”¨ã€å®šä¹‰è‰¯å¥½ã€ä¼˜åŒ–çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼Œå‡å°‘ç¬¬ä¸‰æ–¹æ¨¡å—ä¾èµ–, è€Œä¸”ç¬¬ä¸‰æ–¹åº“å¾ˆéš¾ä¿è¯è´¨é‡</li><li>é¿å…ç¤¾åŒºå‰²è£‚, æŠšå¹³ä¸åŒè¿è¡Œç¯å¢ƒçš„å·®å¼‚. ç°åœ¨æœ‰NodeJSã€åé¢æœ‰Denoï¼Œå¯èƒ½è¿˜ä¼šæœ‰Aenoã€Beno, å°½ç®¡å–ä»£NodeJSçš„å¯èƒ½æ€§å¾ˆä½ï¼Œæœ‰è§„èŒƒåŒ–çš„æ ‡å‡†åº“å¯ä»¥é¿å…é‡å¤é€ è½®å­ï¼Œä¸ç„¶çœŸä¼šå­¦ä¸åŠ¨</li><li>å®‰å…¨æ€§. <a href="https://mp.weixin.qq.com/s/UEPZwFuousrRVj17zZU80w" target="_blank" rel="noopener">è¿‘æœŸnpmå®‰å…¨äº‹ä»¶é¢‘å‘</a>ï¼ŒæŠ•æ¯’ã€åˆ åº“(left-padäº‹ä»¶)ã€npmå•†ä¸šè¿ä½œ, ç»™ç¤¾åŒºå¸¦äº†ä¸å°‘éº»çƒ¦ã€‚è€Œæ ‡å‡†åº“ç”±è¿è¡Œç¯å¢ƒå†…ç½®ï¼Œå¯ä»¥é¿å…å¼•ç”¨ç¬¬ä¸‰æ–¹åº“å¯¼è‡´çš„å®‰å…¨é—®é¢˜</li><li>ä»Šå¤©çš„Javascriptåº”ç”¨ä¼šæœ‰å¾ˆå¤šä¾èµ–(node_modules hell)ï¼Œæ‰“åŒ…å‡ºæ¥çš„ä½“ç§¯å¾ˆå¤§ï¼Œç½‘ç»œåŠ è½½å’Œè„šæœ¬è§£æéœ€è¦è€—è´¹ä¸€å®šçš„èµ„æºï¼Œè€Œä¸”è¿™äº›èµ„æºä¸èƒ½åœ¨å¤šä¸ªåº”ç”¨ä¹‹é—´è¢«ç¼“å­˜. ä¸€ä¸ªå¾ˆå¤§çš„åŸå› æ˜¯npmçš„ä¾èµ–è¿‡äºé›¶ç¢(æ¯”å¦‚å‡ è¡Œä»£ç çš„åŒ…)å’Œé‡å¤(ä¾èµ–ä¸åŒçš„ç‰ˆæœ¬ã€Dead Code)ï¼Œä½¿ç”¨æ ‡å‡†åº“å¯ä»¥å‡å°‘è¿™éƒ¨åˆ†ä¾èµ–</li><li>é€‰æ‹©å›°éš¾ç—‡. æ²¡æœ‰æ ‡å‡†åº“ï¼Œå¯ä»¥é€‰æ‹©npmä¸Šçš„ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨npmä¸ŠæŒ‘é€‰é è°±ã€é«˜è´¨é‡çš„åº“æ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´æˆæœ¬çš„. æœ‰æ—¶å€™æˆ‘ä»¬å°±æ˜¯æ‡’å¾—å»æ¯”è¾ƒå’Œé€‰æ‹©</li><li>ä¼˜é›…çš„æ ‡å‡†åº“ï¼Œæ˜¯å­¦ä¹ çš„æ¦œæ ·. ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½æ˜¯é’»ç ”æ ‡å‡†åº“ç®—æ³•å’Œå®ç°çš„ï¼Œå¯¹è¯­è¨€çš„å¼€å‘è€…æ¥è¯´æ ‡å‡†åº“æ˜¯ä¸€å—å®è—</li><li>å­¦ä¹ æˆæœ¬ã€‚å…¶ä»–è¯­è¨€çš„å¼€å‘è€…ï¼Œå¯ä»¥è¾ƒå¿«å…¥æ‰‹</li></ul><p><br></p><p><strong>æ ‡å‡†åº“å¯èƒ½ä¼šæœ‰ä»€ä¹ˆé—®é¢˜?</strong></p><ul><li>æ ‡å‡†å¯èƒ½æ»åè·Ÿä¸ä¸Šç¤¾åŒºå‘å±•. Javascriptæ­£å¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼Œå¾ˆå¤šè§„èŒƒçš„å®šä¹‰æ˜¯ç”±ç¤¾åŒºé©±åŠ¨çš„ï¼Œæ¯”å¦‚Promiseã€async/await. è·Ÿä¸ä¸Šç¤¾åŒºçš„å‘å±•ç»“æœå¯èƒ½å°±æ˜¯æ²¡äººç”¨</li><li>æƒ³ä¸‹WebComponentç›®å‰çš„å¢ƒé‡</li><li>æ ‡å‡†åº“ä¸å¯èƒ½æ»¡è¶³æ‰€æœ‰äººçš„å£å‘³</li></ul><p><br></p><p><strong>å¦‚ä½•è®¾è®¡æ ‡å‡†åº“? æ ‡å‡†åº“æ¨è¿›è¿›ç¨‹å¯èƒ½ä¼šæœ‰ä»€ä¹ˆéšœç¢?</strong></p><ul><li>NodeJSå·²ç»æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†, æ€ä¹ˆå…¼å®¹ç°æœ‰çš„ç”Ÿæ€?</li><li>æ ‡å‡†åº“åº”è¯¥åŒ…å«ä»€ä¹ˆå†…å®¹ï¼Œå¦‚ä½•ä¿æŒå’Œç¤¾åŒºåŒæ­¥?</li><li><p>å¦‚ä½•æŠŠæ§æ ‡å‡†åº“å†…å®¹çš„å°ºåº¦? </p><p>æœ€å°åŒ–çš„æ ‡å‡†åº“å®¹æ˜“è¢«ç»´æŠ¤å’Œå‡çº§ï¼Œä½†å¯èƒ½å‡ºç°â€™æ²¡ä»€ä¹ˆåµç”¨â€™çš„æƒ…å†µï¼›</p><p>æœ€å¤§åŒ–çš„æ ‡å‡†åº“ï¼Œä¾‹å¦‚Javaçš„æ ‡å‡†åº“ï¼Œå‡ ä¹åŒ…å«äº†æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªä¸œè¥¿, ä½†æ˜¯è¿‡äº†å‡ å¹´å¾ˆå¤šAPIå°±ä¼šå˜å¾—è¿‡æ—¶ï¼Œä¸€èˆ¬ä¸ºäº†ä¿æŒå‘ä¸‹å…¼å®¹ï¼Œè¿™äº›APIä¼šä¸€ç›´åƒä¸€æ ¹åˆºä¸€æ ·å¡åœ¨é‚£é‡Œ.<br>å¦ä¸€ä¸ªéå¸¸å…¸å‹çš„åä¾‹å°±æ˜¯PHPçš„æ ‡å‡†åº“ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°å„ç§é£æ ¼çš„API.</p><p>æ ‡å‡†åº“æ˜¯è·Ÿéšè¯­è¨€å‘å¸ƒçš„ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†è¿‡æ—¶çš„APIï¼Œåˆæƒ³å‡çº§è¯­è¨€ç‰ˆæœ¬ï¼Œå°±éœ€è¦é‡æ„é¡¹ç›®ã€‚è€Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åˆ™å¯èƒ½å¯ä»¥ä¿æŒä¸åŠ¨ã€‚</p></li><li><p>Javascriptçš„ä¸»è¦æˆ˜åœºè¿˜æ˜¯æµè§ˆå™¨, æ ‡å‡†åº“æ˜¯å¦åº”è¯¥æœ‰ä¸€ä¸ªâ€™åŸºæœ¬ç‰ˆâ€™(ç”¨äºæµè§ˆå™¨æˆ–è€…ä¸€äº›æŠ½è±¡æ“ä½œç³»ç»Ÿçš„è¿è¡Œç¯å¢ƒ), è¿˜æœ‰ä¸ªâ€™æ——èˆ°ç‰ˆâ€™(æœåŠ¡ç«¯), æˆ–è€…åªæä¾›ä¸€ä¸ªè·¨è¶Šæ‰€æœ‰å¹³å°çš„æ ‡å‡†åº“?</p></li><li>å¦‚ä½•å¤„ç†å…¼å®¹æ€§é—®é¢˜? è€æ—§æµè§ˆå™¨å¦‚ä½•Polyfill?</li><li>å¦‚ä½•ä¸ç°æœ‰çš„å…¨å±€å¯¹è±¡æˆ–ç”¨æˆ·æ¨¡å—åˆ†ç¦»ï¼Ÿ</li></ul><p><br></p><h2 id="è¿‘æœŸçš„ä¸€äº›å°è¯•"><a href="#è¿‘æœŸçš„ä¸€äº›å°è¯•" class="headerlink" title="è¿‘æœŸçš„ä¸€äº›å°è¯•"></a>è¿‘æœŸçš„ä¸€äº›å°è¯•</h2><ul><li><a href="https://github.com/tc39/proposal-javascript-standard-library" target="_blank" rel="noopener">proposal-javascript-standard-library</a> è¿™æ˜¯ä¸€ä¸ªéå¸¸æ—©æœŸçš„è¯­è¨€æè®®ï¼Œå®šä¹‰äº†å¦‚ä½•å¼•ç”¨æ ‡å‡†åº“(built-in modules)ï¼Œä½†æ˜¯æ²¡æœ‰å®šä¹‰æ ‡å‡†åº“çš„å†…å®¹</li><li><p><a href="https://developers.google.com/web/updates/2019/03/kv-storage" target="_blank" rel="noopener">KV Storage: the Webâ€™s First Built-in Module</a> Chromeåœ¨å¹´åˆæ¨å‡ºçš„å®éªŒæ€§åŠŸèƒ½ï¼Œå°è¯•å®ç°proposal-javascript-standard-libraryæè®®. å®ƒé€šè¿‡ä¸‹é¢æ–¹å¼æ¥å¼•ç”¨â€˜æ ‡å‡†åº“â€™æ¨¡å—:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;storage, StorageArea&#125; <span class="keyword">from</span> <span class="string">'std:kv-storage'</span>; <span class="comment">// std: å‰ç¼€ï¼Œå’Œæ™®é€šæ¨¡å—åŒºåˆ†å¼€æ¥</span></span><br></pre></td></tr></table></figure></li></ul><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»ä¸€ä¸ªSegmentFaultä¸Šçš„ä¸€ä¸ªé—®é¢˜å¼€å§‹ï¼Œå¯¹æ¯”å…¶ä»–è¯­è¨€ï¼Œæ­éœ²Javascriptæ²¡æœ‰æ ‡å‡†åº“çš„çª˜å¢ƒ. æ¥ç€ä»‹ç»ç°æœ‰Javascriptçš„APIç»“æ„ï¼Œä»‹ç»ä»€ä¹ˆæ˜¯æ ‡å‡†åº“ï¼Œè¾©è¯è€ƒè™‘æ ‡å‡†åº“çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠæ¨è¡Œä¸Šé¢å¯èƒ½ä¼šé‡åˆ°çš„é˜»ç¢.</p><p><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://www.infoworld.com/article/3048833/brendan-eich-javascript-standard-library-will-stay-small.html" target="_blank" rel="noopener">Brendan Eich: JavaScript standard library will stay small</a></li><li><a href="https://medium.com/@thomasfuchs/what-if-we-had-a-great-standard-library-in-javascript-52692342ee3f" target="_blank" rel="noopener">What if we had a great standard library in JavaScript?</a></li><li><a href="https://www.i-programmer.info/news/167-javascript/12608-the-javascript-standard-library.html" target="_blank" rel="noopener">The JavaScript Standard Library</a></li><li><a href="https://www.w3.org/TR/" target="_blank" rel="noopener">W3C</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank" rel="noopener">Web API ç´¢å¼•</a></li><li><a href="https://dev.to/sloan/explain-like-im-five-whats-a-standard-library-4gi" target="_blank" rel="noopener">Explain Like Iâ€™m Five: Whatâ€™s a standard library?</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨SegmentFaultçƒ­å¿ƒè§£é¢˜ï¼Œä¸€ä¸ªé—®é¢˜æ¯”è¾ƒè®©æˆ‘æ¯”è¾ƒå°è±¡æ·±åˆ»ï¼š&lt;em&gt;ä¸€ä¸ªåˆå­¦è€…è¯•å›¾åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥Node.jsçš„netæ¨¡å—ã€‚ç»“æœåœ¨æ§åˆ¶å°æ‰“å°åæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæœ‰ç‚¹Javascriptç»éªŒçš„äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜å¼±æ™ºâ€™é—®é¢˜ï¼Œæ€ä¹ˆå¯ä»¥åœ¨æµè§ˆå™¨ç«¯
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½ éœ€è¦çŸ¥é“çš„è½¯ä»¶æµ‹è¯•ç±»å‹å’Œå¸¸è¯†</title>
    <link href="https://bobi.ink/2019/07/10/typeof-testing/"/>
    <id>https://bobi.ink/2019/07/10/typeof-testing/</id>
    <published>2019-07-09T16:00:00.000Z</published>
    <updated>2019-07-14T14:00:23.180Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡é“¾æ¥: <a href="https://www.softwaretestinghelp.com/types-of-software-testing/" target="_blank" rel="noopener">Types Of Software Testing: Different Testing Types With Details</a></p><blockquote><p>æ–‡ç« ä¸ºæ„è¯‘ï¼Œå¹¶ä¸”åœ¨åŸæ–‡çš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ¼”ç»å’Œæ‰©å±•</p></blockquote><blockquote><p>æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œé˜…è¯»å®Œå¤§æ¦‚20minï¼Œè¯»å®Œä¼šæœ‰æ”¶è·ã€‚æ¬¢è¿ç‚¹èµæ”¶è—å…³æ³¨</p></blockquote><p><br></p><p><img src="/images/typeof-testing/Types-of-Testing1.jpg" alt></p><p><br></p><p>æœ‰å¤šå°‘è½¯ä»¶æµ‹è¯•ç±»å‹å‘¢?</p><p>æˆ‘ä»¬ä½œä¸ºæµ‹è¯•äººå‘˜äº†è§£å¾ˆå¤šç§ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹ï¼Œä¾‹å¦‚åŠŸèƒ½æµ‹è¯•(Functional Test)ã€éåŠŸèƒ½æµ‹è¯•ã€è‡ªåŠ¨æµ‹è¯•ã€æ•æ·æµ‹è¯•ã€ä»¥åŠå®ƒä»¬çš„å„ç§å­ç±»å‹. å°½ç®¡åœ¨æˆ‘ä»¬çš„æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šæ¥è§¦å¾ˆå¤šç§æµ‹è¯•ç±»å‹, æˆ–è€…å¬è¯´è¿‡æŸäº›æµ‹è¯•ç±»å‹ï¼Œä½†æ˜¯å¾ˆå°‘äººæ•¢è¯´ç²¾é€šæ‰€æœ‰çš„æµ‹è¯•ç±»å‹.</p><p>æ¯ä¸ªæµ‹è¯•ç±»å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚æ‰€ä»¥æˆ‘å†™è¿™ç¯‡æ–‡ç« ï¼Œç§‘æ™®ä¸€ä¸‹æˆ‘ä»¬ä»Šå¤©æœ€å¸¸ç”¨çš„æµ‹è¯•ç±»å‹.</p><p><br></p><h2 id="ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹"><a href="#ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹" class="headerlink" title="ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹"></a>ä¸åŒçš„è½¯ä»¶æµ‹è¯•ç±»å‹</h2><p><img src="/images/typeof-testing/Types-of-Software-Testing.jpg" alt></p><p>ä¸‹é¢æ˜¯è½¯ä»¶æµ‹è¯•çš„é€šç”¨ç±»å‹åˆ—è¡¨</p><ul><li><p>åŠŸèƒ½æµ‹è¯•ç±»å‹:</p><ul><li>å•å…ƒæµ‹è¯•(Unit testing)</li><li>é›†æˆæµ‹è¯•(Integration testing)</li><li>ç³»ç»Ÿæµ‹è¯•(System testing)</li><li>å¥å…¨æ€§æµ‹è¯•(Sanity testing)</li><li>å†’çƒŸæµ‹è¯•(Smoke testing)</li><li>æ¥å£æµ‹è¯•(Interface testing)</li><li>å›å½’æµ‹è¯•(Regression testing)</li><li>Beta/éªŒæ”¶æµ‹è¯•(Beta/Acceptance testing)</li></ul></li><li><p>éåŠŸèƒ½æµ‹è¯•ç±»å‹:</p><ul><li>æ€§èƒ½æµ‹è¯•(Performance Testing)</li><li>è´Ÿè½½æµ‹è¯•(Load testing)</li><li>å‹åŠ›æµ‹è¯•(Stress testing)</li><li>å®¹é‡æµ‹è¯•(Volume testing)</li><li>å®‰å…¨æµ‹è¯•(Security testing)</li><li>å…¼å®¹æ€§æµ‹è¯•(Compatibility testing)</li><li>å®‰è£…æµ‹è¯•(Install testing)</li><li>æ¢å¤æµ‹è¯•(Recovery testing)</li><li>å¯é æ€§æµ‹è¯•(Reliability testing)</li><li>å¯ç”¨æ€§æµ‹è¯•(Usability testing)</li><li>ä¸€è‡´æ€§æµ‹è¯•(Compliance testing)</li><li>æœ¬åœ°åŒ–æµ‹è¯•(Localization testing)</li></ul></li></ul><p>æ¥çœ‹çœ‹è¿™äº›æµ‹è¯•ç±»å‹çš„ç»†èŠ‚</p><p><br></p><h2 id="0-a-bæµ‹è¯•-a-b-testing"><a href="#0-a-bæµ‹è¯•-a-b-testing" class="headerlink" title="0) A/Bæµ‹è¯•(A/B Testing)"></a>0) A/Bæµ‹è¯•(A/B Testing)</h2><p><img src="/images/typeof-testing/ab.png" alt></p><p>é¡¾åæ€ä¹‰ï¼Œ <a href="https://maxket.com/ab-test-best-practice/" target="_blank" rel="noopener">A/Bæµ‹è¯•</a>å°±æ˜¯å‡†å¤‡ä¸¤ä¸ª(A/B)æˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œè®©ä¸åŒçš„ç”¨æˆ·æ¥éšæœºè®¿é—®è¿™äº›ç‰ˆæœ¬ï¼Œæ”¶é›†å„ç¾¤ç»„çš„ç”¨æˆ·ä½“éªŒæ•°æ®å’Œä¸šåŠ¡æ•°æ®ï¼Œæœ€ååˆ†æã€è¯„ä¼°å‡ºæœ€å¥½ç‰ˆæœ¬ï¼Œæ­£å¼é‡‡ç”¨ã€‚å¦‚ä¸Šå›¾ï¼Œè°·æ­Œä½¿ç”¨A/Bæµ‹è¯•æ¥å†³å®šå¯¼èˆªåº”è¯¥æ˜¯çº¢è‰²è¿˜æ˜¯è“è‰²ã€‚</p><p><br></p><h2 id="1-alphaæµ‹è¯•-alpha-testing"><a href="#1-alphaæµ‹è¯•-alpha-testing" class="headerlink" title="1) Alphaæµ‹è¯•(Alpha Testing)"></a>1) Alphaæµ‹è¯•(Alpha Testing)</h2><p><strong><a href="https://www.softwaretestinghelp.com/what-is-alpha-testing-beta-testing/" target="_blank" rel="noopener">Alphaæµ‹è¯•</a>è¿™æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­å¾ˆå¸¸è§çš„æµ‹è¯•ç±»å‹ã€‚å®ƒçš„ç›®æ ‡å°±æ˜¯å°½å¯èƒ½åœ°åœ¨å‘å¸ƒåˆ°å¸‚åœºæˆ–äº¤ä»˜ç»™ç”¨æˆ·ä¹‹å‰æ‰¾å‡ºæ‰€æœ‰çš„é—®é¢˜å’Œç¼ºé™·</strong>ã€‚</p><p>Alphaæµ‹è¯•ä¸€èˆ¬åœ¨å¼€å‘çš„æœ«æ®µä¸”åœ¨Betaæµ‹è¯•ä¹‹å‰è¿›è¡Œã€‚åœ¨è¿™ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé©±åŠ¨å¼€å‘è€…è¿›è¡Œä¸€äº›å°(minor)çš„è®¾è®¡å˜åŠ¨. Alphaæµ‹è¯•ä¸€èˆ¬åœ¨å¼€å‘è€…ç½‘ç«™è¿›è¡Œï¼Œå³åªå¯¹å¼€å‘è€…æˆ–å†…éƒ¨ç”¨æˆ·å¼€æ”¾ï¼Œä¸€èˆ¬å¯ä»¥ä¸ºæ­¤ç±»æµ‹è¯•åˆ›å»ºå†…éƒ¨è™šæ‹Ÿçš„ç”¨æˆ·ç¯å¢ƒã€‚</p><p><br></p><p>ä¸€èˆ¬å¤§å‹çš„è½¯ä»¶é¡¹ç›®éƒ½æœ‰è§„èŒƒåŒ–çš„<strong>è½¯ä»¶ç‰ˆæœ¬å‘¨æœŸ</strong>:</p><p><img src="/images/typeof-testing/alpha-testing.png" alt></p><ul><li><strong>Pre-alpha</strong>: æœ‰æ—¶å€™è½¯ä»¶ä¼šåœ¨Alphaæˆ–Betaç‰ˆæœ¬å‰å…ˆå‘å¸ƒPre-alphaç‰ˆæœ¬, ç›¸æ¯”Alphaå’ŒBetaï¼Œè¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸å®Œæ•´çš„ç‰ˆæœ¬</li><li><strong>Alpha</strong>: Alphaç‰ˆæœ¬åŠŸèƒ½è¿˜æ²¡å®Œå–„ï¼Œéœ€è¦è¿›ä¸€æ­¥æµ‹è¯•ã€‚Alphaç‰ˆæœ¬é€šå¸¸ä¼šå‘é€åˆ°å¼€å‘è½¯ä»¶çš„ç»„ç»‡æˆ–æŸç¾¤ä½“ä¸­çš„è½¯ä»¶æµ‹è¯•è€…è¿›è¡Œå†…éƒ¨æµ‹è¯•ã€‚</li><li><strong>Beta</strong>: ä¸€èˆ¬Betaç‰ˆæœ¬ä¼šåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼Œä½†å¯èƒ½åˆæœ‰ä¸€äº›Bugï¼Œéœ€è¦è°ƒè¯•åé¦ˆã€‚ Betaç‰ˆæœ¬æ˜¯è½¯ä»¶æœ€æ—©å¯¹å¤–å…¬å¼€çš„è½¯ä»¶ç‰ˆæœ¬ï¼Œç”±å…¬ä¼—ï¼ˆé€šå¸¸ä¸ºå…¬å¸å¤–çš„ç¬¬ä¸‰æ–¹å¼€å‘è€…å’Œä¸šä½™ç©å®¶ï¼‰å‚ä¸æµ‹è¯•ã€‚</li><li><strong>Release Candidate(rc)</strong>: å‘å¸ƒå€™é€‰ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°é—®é¢˜åˆ™å¯å‘å¸ƒæˆä¸ºæ­£å¼çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬åŒ…å«å®Œæ•´ä¸”æ¯”è¾ƒç¨³å®šçš„åŠŸèƒ½</li></ul><p>ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­, æœ€è¿‘æŠŠæˆ‘<a href="https://juejin.im/pin/5d1ecb656fb9a00259a176a5" target="_blank" rel="noopener">å‘å¾—æœ‰ç‚¹æƒ¨</a>çš„iOS13çš„å‘å¸ƒè®¡åˆ’:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">June 3: iOS 13 beta 1 and first look at WWDC 2019                 # -&gt; WWDCåå°±å¯ä»¥è£…çš„ï¼Œç›¸å½“äºpre-alphaæˆ–Alphaé˜¶æ®µå§</span><br><span class="line">June 17: iOS 13 beta 2 launched for developers</span><br><span class="line">June 24: iOS 13 public beta release date for adventurous testers  # -&gt; å…¬å¼€Betaç‰ˆæœ¬ï¼Œç›¸å½“äºä¸Šé¢è¯´çš„Betaé˜¶æ®µ</span><br><span class="line">July 3: iOS 13 developer beta 3 launch with some new features     </span><br><span class="line">July 8: iOS 13 public beta 2 release date</span><br><span class="line">Early September 2019: iOS 13 Golden Master (final dev beta)       # -&gt; ä¹æœˆåˆï¼Œè¯¥å‘æœ€ç»ˆBetaç‰ˆæœ¬äº†ï¼Œç›¸å½“äºè¿›å…¥RCé˜¶æ®µäº†</span><br><span class="line">Mid-September 2019: iOS 13 likely to launch with new 2019 iPhones # -&gt; æ­£å¼ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><br></p><p>ç°åœ¨å¾ˆå¤šå¼€æºé¡¹ç›®ï¼Œå·²ç»æ·¡åŒ–äº†ç€‘å¸ƒå¼çš„è½¯ä»¶ç‰ˆæœ¬å‘¨æœŸï¼Œå˜æˆä¸€ç§æŒç»­(Continuous)çš„ã€å¸¸æ€åŒ–çš„è¡Œä¸º, ä¾‹å¦‚Firefox:</p><p><img src="/images/typeof-testing/firefox.png" alt></p><p><br></p><h2 id="2-éªŒæ”¶æµ‹è¯•-acceptance-testing"><a href="#2-éªŒæ”¶æµ‹è¯•-acceptance-testing" class="headerlink" title="2) éªŒæ”¶æµ‹è¯•(Acceptance Testing)"></a>2) éªŒæ”¶æµ‹è¯•(Acceptance Testing)</h2><p><strong><a href="https://www.softwaretestinghelp.com/what-is-acceptance-testing/" target="_blank" rel="noopener">éªŒæ”¶æµ‹è¯•</a>é€šå¸¸æ˜¯éƒ¨ç½²è½¯ä»¶ä¹‹å‰çš„æœ€åä¸€ä¸ªæµ‹è¯•æ“ä½œ, ä¹Ÿç§°ä¸ºäº¤ä»˜æµ‹è¯•, ç”±æœ€ç»ˆå®¢æˆ·æ‰§è¡Œï¼Œä»–ä»¬ä¼šéªŒè¯ç«¯åˆ°ç«¯(end to end)çš„ç³»ç»Ÿæµç¨‹æ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼Œä»¥åŠåŠŸèƒ½æ˜¯å¦æ˜¯æ»¡è¶³æœ€ç»ˆç”¨æˆ·çš„éœ€æ±‚</strong>ã€‚åªæœ‰å½“æ‰€æœ‰çš„ç‰¹æ€§å’ŒåŠŸèƒ½æŒ‰ç…§æœŸæœ›çš„è¿è¡Œï¼Œå®¢æˆ·æ‰ä¼šæ¥å—è½¯ä»¶</p><p>è¿™æ˜¯æµ‹è¯•çš„æœ€åé˜¶æ®µï¼Œåœ¨éªŒæ”¶æµ‹è¯•ä¹‹åï¼Œè½¯ä»¶å°†æŠ•å…¥ç”Ÿäº§ç¯å¢ƒ. æ‰€ä»¥å®ƒä¹Ÿå«ç”¨æˆ·éªŒæ”¶æµ‹è¯•(UAT)</p><p><img src="/images/typeof-testing/accept.png" alt></p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒéªŒæ”¶æµ‹è¯•å°±ç›¸å½“äºæ”¶å¿«é€’, åŒ…è£¹æ˜¯è½¯ä»¶ã€ä½ å°±æ˜¯å®¢æˆ·ï¼Œæ˜¯éªŒæ”¶æ–¹ï¼Œå¦‚æœè´§ç‰©ä¸ç¬¦åˆä½ çš„è¦æ±‚ï¼Œæ˜¯è¦é€€è´§çš„ã€‚</p><p><br></p><h2 id="3-ä¸´æ—¶æµ‹è¯•-ad-hoc-testing"><a href="#3-ä¸´æ—¶æµ‹è¯•-ad-hoc-testing" class="headerlink" title="3) ä¸´æ—¶æµ‹è¯•(Ad-hoc Testing)"></a>3) ä¸´æ—¶æµ‹è¯•(Ad-hoc Testing)</h2><p>Ad-hocä¸­æ–‡åº”è¯¥ç†è§£ä¸ºä¸´æ—¶çš„æ„æ€ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ç§æµ‹è¯•æ˜¯åœ¨ä¸´æ—¶åŸºç¡€ä¸Šè¿›è¡Œçš„, æœ‰æ—¶å€™ä¹Ÿç§°ä¸ºéšæœºæµ‹è¯•ã€‚å³æ²¡æœ‰å‚è€ƒæµ‹è¯•ç”¨ä¾‹ã€æ²¡æœ‰é’ˆå¯¹è¯¥æµ‹è¯•çš„ä»»ä½•è®¡åˆ’å’Œæ–‡æ¡£ã€‚Ad-hocæµ‹è¯•çš„ç›®çš„å°±æ˜¯<strong>é€šè¿‡æ‰§è¡Œéšæ„çš„æµç¨‹æˆ–ä»»æ„çš„åŠŸèƒ½æ¥æ‰¾å‡ºåº”ç”¨çš„ç¼ºé™·å’Œé—®é¢˜</strong></p><p>Ad-hocæµ‹è¯•ä¸€ç§éæ­£å¼çš„æ–¹æ³•ï¼Œå¯ä»¥ç”±é¡¹ç›®ä¸­çš„ä»»ä½•äººæ‰§è¡Œã€‚å°½ç®¡æ²¡æœ‰æµ‹è¯•ç”¨ä¾‹å¾ˆéš¾è¯†åˆ«ç¼ºé™·ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™åœ¨Ad-hocæµ‹è¯•æœŸé—´å‘ç°çš„ç¼ºé™·å¯èƒ½æ— æ³•ä½¿ç”¨ç°æœ‰çš„æµ‹è¯•ç”¨ä¾‹æ¥è¯†åˆ«, <strong>ä¹Ÿå°±æ˜¯è¯´å®ƒä¸€èˆ¬ç”¨æ¥å‘ç°â€˜æ„å¤–â€™çš„ç¼ºé™·</strong>.</p><p><br></p><h2 id="4-å¯è®¿é—®æ€§æµ‹è¯•-accessibility-testing"><a href="#4-å¯è®¿é—®æ€§æµ‹è¯•-accessibility-testing" class="headerlink" title="4) å¯è®¿é—®æ€§æµ‹è¯•(Accessibility Testing)"></a>4) å¯è®¿é—®æ€§æµ‹è¯•(Accessibility Testing)</h2><p><strong>å¯è®¿é—®æ€§æµ‹è¯•çš„ç›®çš„æ˜¯ç¡®å®šè½¯ä»¶æˆ–åº”ç”¨ç¨‹åºæ˜¯å¦å¯ä¾›æ®‹ç–¾äººä½¿ç”¨</strong>ã€‚æ®‹ç–¾æ˜¯æŒ‡è‹äººï¼Œè‰²ç›²ï¼Œæ™ºéšœäººå£«ï¼Œå¤±æ˜è€…ï¼Œè€å¹´äººå’Œå…¶ä»–æ®‹ç–¾äººç¾¤ä½“ã€‚è¿™é‡Œä¼šæ‰§è¡Œå„ç§æ£€æŸ¥ï¼Œä¾‹å¦‚é’ˆå¯¹è§†è§‰æ®‹ç–¾çš„å­—ä½“å¤§å°æµ‹è¯•ï¼Œé’ˆå¯¹è‰²ç›²çš„é¢œè‰²å’Œå¯¹æ¯”åº¦æµ‹è¯•ç­‰ç­‰ã€‚</p><p>ä¸åŒå¹³å°ã€ä¸åŒåº”ç”¨ç±»å‹å¯¹å¯è®¿é—®æ€§æ”¯æŒæƒ…å†µä¸å¤ªä¸€æ ·ï¼Œæ¯”å¦‚iOSç›¸æ¯”å…¶ä»–æ“ä½œç³»ç»Ÿåˆ™æ›´é‡è§†å¯è®¿é—®, è€Œå›½å¤–æ¯”å›½å†…æ›´é‡è§†å¯è®¿é—®æ€§ã€‚</p><p><img src="/images/typeof-testing/acs.png" alt></p><p><br></p><h2 id="5-betaæµ‹è¯•-beta-testing"><a href="#5-betaæµ‹è¯•-beta-testing" class="headerlink" title="5) Betaæµ‹è¯•(Beta Testing)"></a>5) Betaæµ‹è¯•(Beta Testing)</h2><p>ä¸Šæ–‡Alphaæµ‹è¯•å·²ç»æåŠBetaæµ‹è¯•, <strong>Betaæµ‹è¯•æ˜¯ä¸€ç§æ­£å¼çš„è½¯ä»¶æµ‹è¯•ç±»å‹ï¼Œåœ¨å°†äº§å“å‘å¸ƒåˆ°å¸‚åœºæˆ–è€…å®é™…æœ€ç»ˆç”¨æˆ·ä¹‹å‰ï¼Œç”±å®¢æˆ·åœ¨çœŸå®çš„åº”ç”¨ç¯å¢ƒä¸­æ‰§è¡Œ</strong>ã€‚</p><p>æ‰§è¡ŒBetaæµ‹è¯•ç›®çš„æ˜¯ç¡®ä¿è½¯ä»¶æˆ–äº§å“ä¸­æ²¡æœ‰é‡å¤§æ•…éšœï¼Œå¹¶ä¸”æ»¡è¶³æœ€ç»ˆç”¨æˆ·çš„ä¸šåŠ¡éœ€æ±‚ã€‚å½“å®¢æˆ·æ¥å—è½¯ä»¶æ—¶ï¼ŒBetaæµ‹è¯•æ‰ç®—é€šè¿‡ã€‚</p><p>é€šå¸¸ï¼Œæ­¤ç±»æµ‹è¯•ç”±æœ€ç»ˆç”¨æˆ·æˆ–å…¶ä»–äººå®Œæˆã€‚è¿™æ˜¯åœ¨å°†åº”ç”¨å‘å¸ƒä½œä¸ºå•†ä¸šç”¨é€”ä¹‹å‰å®Œæˆçš„æœ€ç»ˆæµ‹è¯•ã€‚é€šå¸¸ï¼Œå‘å¸ƒçš„è½¯ä»¶æˆ–äº§å“çš„Betaç‰ˆæœ¬ä»…é™äºç‰¹å®šåŒºåŸŸä¸­çš„ç‰¹å®šæ•°é‡çš„ç”¨æˆ·ã€‚<br>æ‰€ä»¥æœ€ç»ˆç”¨æˆ·å®é™…ä½¿ç”¨è½¯ä»¶åä¼šå°†ä¸€äº›é—®é¢˜åé¦ˆç»™å…¬å¸ã€‚å…¬å¸å¯ä»¥åœ¨å…¨é¢å‘å¸ƒä¹‹å‰é‡‡å–å¿…è¦çš„æªæ–½ã€‚</p><p>Betaæµ‹è¯•åœ¨æ­£å¼ç‰ˆæœ¬ä¹‹å‰ä¹Ÿå¯èƒ½ä¼šè¿­ä»£è¿›è¡Œå¤šæ¬¡.</p><p><br></p><h2 id="6-åç«¯æµ‹è¯•-back-end-testing"><a href="#6-åç«¯æµ‹è¯•-back-end-testing" class="headerlink" title="6) åç«¯æµ‹è¯•(Back-end Testing)"></a>6) åç«¯æµ‹è¯•(Back-end Testing)</h2><p>å‰ç«¯åº”ç”¨è¾“å…¥çš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå­˜å‚¨åœ¨æ•°æ®åº“ï¼Œæ‰€ä»¥é’ˆå¯¹æ•°æ®åº“çš„è¿™ç±»æµ‹è¯•ç§°ä¸º<strong>æ•°æ®åº“æµ‹è¯•æˆ–è€…åç«¯æµ‹è¯•</strong>. å¸‚é¢æœ‰ä¸åŒçš„æ•°æ®åº“ï¼Œå¦‚SQL Serverï¼ŒMySQLå’ŒOracleç­‰ã€‚æ•°æ®åº“æµ‹è¯•ä¼šæ¶‰åŠè¡¨ç»“æ„ï¼Œæ¨¡å¼ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œæ•°æ®ç»“æ„ç­‰ã€‚</p><p>åç«¯æµ‹è¯•ä¸€èˆ¬ä¸ä¼šæ¶‰åŠGUIï¼Œæµ‹è¯•äººå‘˜é€šè¿‡æŸäº›æ‰‹æ®µç›´æ¥è¿æ¥åˆ°æ•°æ®åº“ï¼Œä»è€Œå¯ä»¥å®¹æ˜“åœ°è¿è¡Œä¸€äº›æ•°æ®åº“è¯·æ±‚æ¥éªŒè¯æ•°æ®ã€‚<strong>é€šè¿‡åç«¯æµ‹è¯•å¯ä»¥å‘ç°ä¸€äº›æ•°æ®åº“é—®é¢˜ï¼Œæ¯”å¦‚æ•°æ®ä¸¢å¤±ã€æ­»é”ã€æ•°æ®æŸåã€‚è¿™äº›é—®é¢˜åœ¨ç³»ç»ŸæŠ•å…¥ç”Ÿäº§ç¯å¢ƒä¹‹å‰è¿›è¡Œä¿®å¤è‡³å…³é‡è¦</strong></p><p><br></p><h2 id="7-æµè§ˆå™¨å…¼å®¹æµ‹è¯•-browser-compatibility-testing"><a href="#7-æµè§ˆå™¨å…¼å®¹æµ‹è¯•-browser-compatibility-testing" class="headerlink" title="7) æµè§ˆå™¨å…¼å®¹æµ‹è¯•(Browser Compatibility Testing)"></a>7) æµè§ˆå™¨å…¼å®¹æµ‹è¯•(Browser Compatibility Testing)</h2><p><img src="/images/typeof-testing/brw.png" alt></p><p>è¿™æ˜¯å…¼å®¹æ€§æµ‹è¯•çš„å­ç±»å‹ï¼Œç”±æµ‹è¯•å›¢é˜Ÿæ‰§è¡Œ. <strong><a href="http://frontend.turing.io/lessons/module-2/cross-browser-compat.html" target="_blank" rel="noopener">æµè§ˆå™¨å…¼å®¹æµ‹è¯•</a>ä¸»è¦é’ˆå¯¹Webåº”ç”¨ï¼Œç”¨äºç¡®ä¿è½¯ä»¶å¯ä»¥åœ¨ä¸åŒæµè§ˆå™¨æˆ–æ“ä½œç³»ç»Ÿä¸­è¿è¡Œ; æˆ–è€…éªŒè¯Webåº”ç”¨ç¨‹åºæ˜¯å¦æ”¯æŒåœ¨æµè§ˆå™¨çš„æ‰€æœ‰ç‰ˆæœ¬ä¸Šè¿è¡Œ, ä»¥ç¡®å®šåº”ç”¨æœ€ç»ˆå…¼å®¹çš„èŒƒå›´</strong>.</p><p>æµè§ˆå™¨å…¼å®¹æµ‹è¯•æ˜¯å‰ç«¯å¼€å‘è€…ç»•ä¸å¼€çš„å‘ã€‚</p><p>æˆ‘ä»¬æœ‰å¾ˆå¤š<strong>ç­–ç•¥</strong>æ¥åº”å¯¹æµè§ˆå™¨å…¼å®¹æ€§ï¼Œæ¯”å¦‚æ¸è¿›å¢å¼ºæˆ–è€…ä¼˜é›…é™çº§, è¿˜æœ‰åˆ¶å®šæµè§ˆå™¨å…¼å®¹è§„èŒƒ; </p><p>ä¸ºäº†<strong>æŠšå¹³æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚</strong>ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å„ç§ç‰¹æ€§æ£€æµ‹å·¥å…·(Modernizr), è¿˜æœ‰å„ç§polyfill(CSS Normaliz, polyfill/shim, css-autoprefixer);</p><p>å½“ç„¶ä¸ºäº†<strong>æµ‹è¯•è·¨æµè§ˆå™¨å…¼å®¹æ€§</strong>ï¼Œè¿˜è¦ä¸€äº›è¾…åŠ©å·¥å…·ï¼Œä¾‹å¦‚<a href="https://www.browserstack.com/" target="_blank" rel="noopener">BrowserStack</a>, å¯¹äºæˆ‘ä»¬è¿™äº›å°å›¢é˜Ÿï¼Œåªèƒ½ä¸‹ä¸€å †Portable(<em>Portableæµè§ˆå™¨è¿è¡Œæ—¶ç›¸äº’éš”ç¦»çš„, æ‰€ä»¥ä¸ä¼šå­˜åœ¨é…ç½®æ–‡ä»¶ç­‰å†²çªé—®é¢˜</em>) æµè§ˆå™¨ï¼Œæ‰‹å·¥æµ‹è¯•äº†ã€‚</p><p><br></p><h2 id="8-åå‘å…¼å®¹æµ‹è¯•-backward-compatibility-testing"><a href="#8-åå‘å…¼å®¹æµ‹è¯•-backward-compatibility-testing" class="headerlink" title="8) åå‘å…¼å®¹æµ‹è¯•(Backward Compatibility Testing)"></a>8) åå‘å…¼å®¹æµ‹è¯•(Backward Compatibility Testing)</h2><p><strong>å‘åå…¼å®¹æµ‹è¯•, ç”¨äºéªŒè¯æ–°å¼€å‘æˆ–æ›´æ–°çš„è½¯ä»¶æ˜¯å¦èƒ½åœ¨æ—§ç‰ˆæœ¬çš„ç¯å¢ƒä¸­è¿è¡Œ</strong>ã€‚</p><p>æ¯”å¦‚å‘åå…¼å®¹æµ‹è¯•ä¼šæ£€æŸ¥æ–°ç‰ˆè½¯ä»¶æ˜¯å¦å¯ä»¥æ­£ç¡®åœ°å¤„ç†æ—§ç‰ˆæœ¬è½¯ä»¶åˆ›å»ºçš„æ–‡ä»¶æ ¼å¼ã€‚ä¾‹å¦‚æ–°ç‰ˆçš„Office 2016æ˜¯å¦å¯ä»¥æ‰“å¼€2012åˆ›å»ºçš„æ–‡ä»¶ã€‚</p><p>åŒç†ä¹Ÿå¯ä»¥æ£€æŸ¥æ–°ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å…¼å®¹æ—§ç‰ˆæœ¬è½¯ä»¶åˆ›å»ºçš„æ•°æ®è¡¨ã€æ•°æ®æ–‡ä»¶ã€æ•°æ®ç»“æ„ã€é…ç½®æ–‡ä»¶ã€‚ </p><p>ä»»ä½•è½¯ä»¶æ›´æ–°åº”è¯¥åœ¨å…ˆå‰ç‰ˆæœ¬çš„åŸºç¡€ä¹‹ä¸Šè‰¯å¥½åœ°è¿è¡Œ</p><p><br></p><h2 id="9-é»‘ç›’æµ‹è¯•-black-box-testing"><a href="#9-é»‘ç›’æµ‹è¯•-black-box-testing" class="headerlink" title="9) é»‘ç›’æµ‹è¯•(Black Box Testing)"></a>9) é»‘ç›’æµ‹è¯•(Black Box Testing)</h2><p><img src="/images/typeof-testing/black-box.png" alt></p><p>é»‘ç›’æµ‹è¯•ä¸è€ƒè™‘è½¯ä»¶çš„å†…éƒ¨ç³»ç»Ÿè®¾è®¡ï¼Œå®ƒåŸºäºéœ€æ±‚å’ŒåŠŸèƒ½è¿›è¡Œæµ‹è¯•, åªå…³å¿ƒç³»ç»Ÿçš„è¾“å…¥/è¾“å‡ºä»¥åŠåŠŸèƒ½æµç¨‹ã€‚ </p><p>æ¢å¥è¯è¯´<strong>é»‘ç›’æµ‹è¯•ä»ç”¨æˆ·çš„è§’åº¦å‡ºå‘é’ˆå¯¹è½¯ä»¶ç•Œé¢ã€åŠŸèƒ½åŠå¤–éƒ¨ç»“æ„è¿›è¡Œæµ‹è¯•ï¼Œè€Œä¸è€ƒè™‘ç¨‹åºå†…éƒ¨é€»è¾‘ç»“æ„</strong>.</p><p>é»‘ç›’æµ‹è¯•ä¸‹é¢æœ‰å¾ˆå¤šå­ç±»ï¼Œä¾‹å¦‚é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ã€å¤§éƒ¨åˆ†éåŠŸèƒ½æ€§æµ‹è¯•</p><p>å…³äºé»‘ç›’æµ‹è¯•çš„ä¼˜ç¼ºç‚¹ä»¥åŠæµ‹è¯•ç±»å‹å¯ä»¥çœ‹<a href="https://www.softwaretestinghelp.com/black-box-testing/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p><br></p><h2 id="10-è¾¹ç•Œå€¼æµ‹è¯•-boundary-value-testing"><a href="#10-è¾¹ç•Œå€¼æµ‹è¯•-boundary-value-testing" class="headerlink" title="10) è¾¹ç•Œå€¼æµ‹è¯•(Boundary Value Testing)"></a>10) è¾¹ç•Œå€¼æµ‹è¯•(Boundary Value Testing)</h2><p><strong>è¾¹ç•Œå€¼æµ‹è¯•, æµ‹è¯•åº”ç”¨å¤„äºè¾¹ç•Œæ¡ä»¶(boundary level)çš„è¡Œä¸º</strong>ã€‚å¾ˆå¤šè¾¹ç•Œæ¡ä»¶å¼€å‘è€…æ˜¯å¾ˆéš¾è€ƒè™‘å‘¨åˆ°çš„ï¼Œæ‰€ä»¥æ‰æœ‰ä¸€ä¸ªä¸“é—¨çš„æµ‹è¯•ç±»å‹æ¥éªŒè¯è¿™ç§æƒ…å†µ</p><p>è¾¹ç•Œå€¼æµ‹è¯•æ£€æŸ¥åº”ç”¨å¤„äºè¾¹ç•Œå€¼æ—¶æ˜¯å¦å­˜åœ¨ç¼ºé™·ã€‚è¾¹ç•Œå€¼æµ‹è¯•é€šå¸¸ç”¨äºæµ‹è¯•ä¸åŒèŒƒå›´çš„æ•°å­—, æ¯ä¸ªèŒƒå›´éƒ½æœ‰ä¸€ä¸ªä¸Šä¸‹è¾¹ç•Œï¼Œè¾¹ç•Œæµ‹è¯•åˆ™æ˜¯é’ˆå¯¹è¿™äº›è¾¹ç•Œå€¼è¿›è¡Œæµ‹è¯•ã€‚</p><p>æ¯”å¦‚æ•°å­—èŒƒå›´ä¸º1-500, é‚£ä¹ˆè¾¹ç•Œå€¼æµ‹è¯•ä¼šåœ¨è¿™äº›å€¼ä¸Šè¿›è¡ŒéªŒè¯: 0ã€1ã€2ã€499ã€500ã€501</p><p><br></p><h2 id="11-åˆ†æ”¯æµ‹è¯•-branch-testing"><a href="#11-åˆ†æ”¯æµ‹è¯•-branch-testing" class="headerlink" title="11) åˆ†æ”¯æµ‹è¯•(Branch Testing)"></a>11) åˆ†æ”¯æµ‹è¯•(Branch Testing)</h2><p>è¿™æ˜¯ç™½ç›’æµ‹è¯•çš„å­ç±»å‹ï¼Œåœ¨å•å…ƒæµ‹è¯•ä¸­å®æ–½. é¡¾åæ€ä¹‰ï¼Œ<strong>åˆ†æ”¯æµ‹è¯•è¡¨ç¤ºæµ‹è¯•è¦è¦†ç›–ç¨‹åºä»£ç çš„å„ç§æ¡ä»¶åˆ†æ”¯, é¿å…é—æ¼ç¼ºé™·</strong>ã€‚åˆ†æ”¯è¦†ç›–æ˜¯å•å…ƒæµ‹è¯•è¦†ç›–ç‡çš„ä¸€ä¸ªæŒ‡æ ‡ä¹‹ä¸€</p><p><br></p><h2 id="12-æ¯”è¾ƒæµ‹è¯•-comparison-testing"><a href="#12-æ¯”è¾ƒæµ‹è¯•-comparison-testing" class="headerlink" title="12) æ¯”è¾ƒæµ‹è¯•(Comparison Testing)"></a>12) æ¯”è¾ƒæµ‹è¯•(Comparison Testing)</h2><p><img src="/images/typeof-testing/wzr.png" alt></p><p><strong>æ¯”è¾ƒæµ‹è¯•ï¼Œå°†äº§å“çš„ä¼˜ç‚¹å’Œå¼±ç‚¹ä¸æ—§ç‰ˆæœ¬æˆ–è€…åŒç±»(ç«å“)äº§å“è¿›è¡Œæ¯”è¾ƒ.</strong></p><p>æ¯”å¦‚ç±»ä¼¼ç‹è‡ªå¦‚è¿™ç§æ•°ç æµ‹è¯„æ ç›®ï¼Œè¯„æµ‹ä¸€ä¸ªæ‰‹æœºæˆ–è€…å…¶ä»–æ•°ç äº§å“æ—¶ï¼Œä¸€èˆ¬ä¼šæ¨ªå‘å’Œå‹å•†äº§å“è¿›è¡Œæ¯”è¾ƒï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šçºµå‘å’Œä¸Šä¸€ä»£äº§å“æ¯”è¾ƒ.</p><p>è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯å’Œè¡Œä¸šçš„é¢†å¯¼è€…æ¯”è¾ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åšIMçš„ï¼Œä¼šç»å¸¸å’Œå¾®ä¿¡æ¯”è¾ƒ: â€˜ä½ è¿™ä¸ªåº”ç”¨çš„å¯åŠ¨é€Ÿåº¦æ€ä¹ˆæ¯”å¾®ä¿¡æ…¢è¿™ä¹ˆå¤š?â€™</p><p><br></p><h2 id="13-å…¼å®¹æ€§æµ‹è¯•-compatibility-testing"><a href="#13-å…¼å®¹æ€§æµ‹è¯•-compatibility-testing" class="headerlink" title="13) å…¼å®¹æ€§æµ‹è¯•(Compatibility Testing)"></a>13) å…¼å®¹æ€§æµ‹è¯•(Compatibility Testing)</h2><p>è¿™æ˜¯ä¸€ä¸ªå¤§ç±», <strong>å…¼å®¹æ€§æµ‹è¯•ç”¨äºéªŒè¯åº”ç”¨åœ¨ä¸åŒç¯å¢ƒã€webæœåŠ¡å™¨ã€ç¡¬ä»¶ã€ç½‘ç»œæ¡ä»¶ä¸‹çš„è¡Œä¸º</strong>ã€‚å…¼å®¹æ€§æµ‹è¯•ç¡®ä¿è½¯ä»¶å¯ä»¥åœ¨ä¸åŒçš„é…ç½®ã€ä¸åŒçš„æ•°æ®åº“ã€ä¸åŒçš„æµè§ˆå™¨ï¼Œä»¥åŠå®ƒä»¬ä¸åŒçš„ç‰ˆæœ¬ä¸‹è¿è¡Œã€‚å…¼å®¹æ€§æµ‹è¯•ç”±æµ‹è¯•å›¢é˜Ÿå®æ–½</p><p><br></p><h2 id="14-ç»„ä»¶æµ‹è¯•-component-testing"><a href="#14-ç»„ä»¶æµ‹è¯•-component-testing" class="headerlink" title="14) ç»„ä»¶æµ‹è¯•(Component Testing)"></a>14) ç»„ä»¶æµ‹è¯•(Component Testing)</h2><p><a href="https://www.guru99.com/component-testing.html" target="_blank" rel="noopener">ç»„ä»¶æµ‹è¯•</a>(æ­¤ç»„ä»¶éGUIç»„ä»¶, å–ç»„åˆæµ‹è¯•å¯èƒ½æ›´å¥½ç†è§£ä¸€ç‚¹)ï¼Œ<strong>ä¸€èˆ¬ä¹Ÿç§°ä¸ºæ¨¡å—æµ‹è¯•(Module Testing), ä¸€èˆ¬ç”±å¼€å‘è€…åœ¨å®Œæˆå•å…ƒæµ‹è¯•åæ‰§è¡Œã€‚ç»„ä»¶æµ‹è¯•å°†å¤šä¸ªåŠŸèƒ½ç»„åˆèµ·æ¥ä½œä¸ºå•ä¸€çš„æ•´ä½“è¿›è¡Œæµ‹è¯•ï¼Œç›®çš„æ˜¯å‘ç°å¤šä¸ªåŠŸèƒ½åœ¨ç›¸äº’è¿æ¥èµ·æ¥ä¹‹åçš„ç¼ºé™·</strong>ã€‚</p><p>ç»„ä»¶æµ‹è¯•å¯å¤§å¯å°ï¼Œå°åˆ°å‡½æ•°çº§åˆ«æˆ–è€…ç±»çº§åˆ«çš„ç»„åˆï¼Œå¤§å¯ä»¥å¤§åˆ°å‡ ä¸ªå•ç‹¬çš„é¡µé¢ã€æ¨¡å—ã€å­ç³»ç»Ÿçš„ç»„åˆã€‚ ä¸¾ä¸€ä¸ªå‰ç«¯ä¾‹å­ï¼Œå°†å¤šä¸ªé¡µé¢è·¯ç”±ç»„åˆèµ·æ¥ï¼Œæµ‹è¯•å®ƒä»¬çš„æµç¨‹è·³è½¬ï¼Œå°±å±äºç»„ä»¶æµ‹è¯•ã€‚</p><p><img src="/images/typeof-testing/comp.png" alt></p><p><br></p><h2 id="15-ç«¯åˆ°ç«¯æµ‹è¯•-end-to-end-testing"><a href="#15-ç«¯åˆ°ç«¯æµ‹è¯•-end-to-end-testing" class="headerlink" title="15) ç«¯åˆ°ç«¯æµ‹è¯•(End-to-End Testing)"></a>15) ç«¯åˆ°ç«¯æµ‹è¯•(End-to-End Testing)</h2><p>ç«¯åˆ°ç«¯æµ‹è¯•ä¹Ÿæ˜¯ä¸€ç§é»‘ç›’æµ‹è¯•ç±»å‹ï¼Œç±»ä¼¼äºç³»ç»Ÿæµ‹è¯•. <strong>ç«¯åˆ°ç«¯æµ‹è¯•åœ¨æ¨¡æ‹Ÿçš„ã€å®Œæ•´çš„ã€çœŸå®åº”ç”¨ç¯å¢ƒä¸‹æ¨¡æ‹ŸçœŸå®ç”¨æˆ·å¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚åº”ç”¨ä¼šå’Œæ•°æ®åº“äº¤äº’ã€ä¼šä½¿ç”¨ç½‘ç»œé€šä¿¡ã€æˆ–è€…åœ¨é€‚å½“çš„æƒ…å†µä¸‹å’Œå…¶ä»–ç¡¬ä»¶ã€åº”ç”¨ã€ç³»ç»Ÿè¿›è¡Œäº¤äº’</strong>. ç«¯åˆ°ç«¯æ˜¯æŒ‡ä»ä¸€ä¸ªç«¯ç‚¹åˆ°å¦ä¸€ä¸ªç«¯ç‚¹çš„æ„æ€ï¼Œæ‰€ä»¥ç«¯åˆ°ç«¯æµ‹è¯•é‡ç‚¹ç”¨äºæµ‹è¯•æ¨¡å—å’Œæ¨¡å—ä¹‹é—´çš„åè°ƒæ€§ã€‚</p><p>å½“åº”ç”¨æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–è€…éœ€è¦å’Œå…¶ä»–å¤–éƒ¨ç³»ç»ŸååŒæ—¶ï¼Œç«¯åˆ°ç«¯æµ‹è¯•æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰², å®ƒå¯ä»¥å…¨é¢æ£€æŸ¥ä»¥ç¡®ä¿è½¯ä»¶åœ¨ä¸åŒå¹³å°å’Œç¯å¢ƒäº§å“èƒ½å‡†ç¡®åœ°äº¤äº’ã€‚ç«¯åˆ°ç«¯æµ‹è¯•æœ‰ä»¥ä¸‹ç›®çš„:</p><ul><li>ç¡®ä¿åº”ç”¨å¯ä»¥å’Œå¤–éƒ¨ç³»ç»Ÿä¹‹é—´è‰¯å¥½çš„åè°ƒã€‚å¯¹äºå‰ç«¯æ¥è¯´ï¼Œæ˜¯ç¡®ä¿é¡µé¢å’Œåç«¯ä¹‹é—´è‰¯å¥½åè°ƒ</li><li>æ£€æŸ¥ä»æºç³»ç»Ÿåˆ°ç›®æ ‡ç³»ç»Ÿçš„æ‰€æœ‰ç³»ç»Ÿæµ</li><li>ä»æœ€ç»ˆç”¨æˆ·è§’åº¦éªŒè¯éœ€æ±‚</li><li>è¯†åˆ«å¼‚æ„ç¯å¢ƒä¸­çš„é—®é¢˜</li></ul><p>å‰ç«¯ä¹Ÿæœ‰å¾ˆå¤šè‡ªåŠ¨åŒ–çš„ç«¯åˆ°ç«¯æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚nightwatchï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å¯¹é¡µé¢è¿›è¡Œæ“ä½œï¼Œä»è€Œæ£€éªŒæ•´ä¸ªåº”ç”¨æµç¨‹æ˜¯å¦æ­£å¸¸å’Œç¬¦åˆéœ€æ±‚:</p><p><img src="/images/typeof-testing/nightwatch.png" alt></p><p>å› ä¸ºå’Œ<strong>ç³»ç»Ÿæµ‹è¯•</strong>å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿè¢«ç»å¸¸æ‹¿æ¥<a href="https://www.softwaretestinghelp.com/system-vs-end-to-end-testing/" target="_blank" rel="noopener">æ¯”è¾ƒ</a></p><p><br></p><h2 id="16-ç­‰ä»·åˆ’åˆ†-equivalence-partitioning"><a href="#16-ç­‰ä»·åˆ’åˆ†-equivalence-partitioning" class="headerlink" title="16) ç­‰ä»·åˆ’åˆ†(Equivalence Partitioning)"></a>16) ç­‰ä»·åˆ’åˆ†(Equivalence Partitioning)</h2><p>ç­‰ä»·åˆ’åˆ†, è¿™æ˜¯ä¸€ç§é»‘ç›’æµ‹è¯•çš„æµ‹è¯•æŠ€æœ¯. <strong>é€šè¿‡ç­‰ä»·åˆ’åˆ†ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„è¾“å…¥æ•°æ®åˆç†åœ°åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†ç»„ï¼Œæˆ‘ä»¬åªéœ€åœ¨æ¯ä¸ªåˆ†ç»„ä¸­å–ä¸€ä¸ªæ•°æ®ä½œä¸ºæµ‹è¯•çš„è¾“å…¥æ¡ä»¶, è¿™æ ·å¯ä»¥å®ç°ç”¨å°‘é‡ä»£è¡¨æ€§çš„æµ‹è¯•æ•°æ®å–å¾—è¾ƒå¥½çš„æµ‹è¯•ç»“æœ</strong>.</p><p>æ‰€ä»¥è¯´è¿™ä¸ªæµ‹è¯•çš„ç›®çš„: æ˜¯åœ¨ä¸å¯¼è‡´ç¼ºé™·çš„å‰æä¸‹ï¼Œç§»é™¤æŒ‡å®šåˆ†ç»„ä¸­çš„é‡å¤çš„ç”¨ä¾‹, ç®€åŒ–æµ‹è¯•çš„å·¥ä½œ</p><p><img src="/images/typeof-testing/part.png" alt></p><p>æ¯”å¦‚ä¸€ä¸ªç¨‹åºåº”ç”¨æ¥å—-10åˆ°+10ä¹‹é—´çš„å€¼ï¼Œä½¿ç”¨ç­‰ä»·åˆ†åŒºæ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªåˆ†ç»„: 0ã€è´Ÿå€¼ã€æ­£å€¼. æ¥ä¸‹æ¥çš„æµ‹è¯•åªéœ€ä»è¿™ä¸ªä¸‰ä¸ªåˆ†ç»„ä¸­å–ä¸€ä¸ªæˆå‘˜è¿›è¡Œæµ‹è¯•, è€Œä¸éœ€è¦-10åˆ°+10æ¯ä¸ªæˆå‘˜éƒ½æµ‹è¯•ä¸€é.</p><p><br></p><h2 id="17-å®ä¾‹æµ‹è¯•-example-testing"><a href="#17-å®ä¾‹æµ‹è¯•-example-testing" class="headerlink" title="17) å®ä¾‹æµ‹è¯•(Example Testing)"></a>17) å®ä¾‹æµ‹è¯•(Example Testing)</h2><p>It means real-time testing. Example testing includes the real-time scenario, it also involves the scenarios based on the experience of the testers.</p><p>å®ä¾‹æµ‹è¯•æ„å‘³ç€å®æ—¶æµ‹è¯•ã€‚å®ä¾‹æµ‹è¯•åŒ…å«äº†å®æ—¶åœºæ™¯ã€å¦å¤–è¿˜æ¶‰åŠåŸºäºæµ‹è¯•äººå‘˜ç»éªŒçš„åœºæ™¯ã€‚</p><blockquote><p>ğŸ¤” è¿™é‡Œä¸æ˜¯ç‰¹åˆ«èƒ½ç†è§£è¿™ä¸ªæµ‹è¯•ç±»å‹ï¼Œæ‰€ä»¥è´´ä¸ŠåŸæ–‡ã€‚çŸ¥é“çš„å‘Šè¯‰æˆ‘å‘€</p></blockquote><p><br></p><h2 id="18-æ¢ç´¢æµ‹è¯•-exploratory-testing"><a href="#18-æ¢ç´¢æµ‹è¯•-exploratory-testing" class="headerlink" title="18) æ¢ç´¢æµ‹è¯•(Exploratory Testing)"></a>18) æ¢ç´¢æµ‹è¯•(Exploratory Testing)</h2><p><img src="/images/typeof-testing/explorer.png" alt></p><p>æ¢ç´¢æ€§æµ‹è¯•æœ‰ç‚¹ç±»ä¼¼äºAd-Hocæµ‹è¯•. æ¢ç´¢æ€§æµ‹è¯•æ˜¯ç”±æµ‹è¯•å›¢é˜Ÿè¿›è¡Œçš„éæ­£å¼æµ‹è¯•ã€‚æ­¤æµ‹è¯•çš„ç›®çš„æ˜¯æ¢ç´¢åº”ç”¨å¹¶æŸ¥æ‰¾åº”ç”¨ä¸­å­˜åœ¨çš„ç¼ºé™·ã€‚åƒæ¢é™©ä¸€æ ·ï¼Œåœ¨æµ‹è¯•æœŸé—´æ˜¯æœ‰ä¸€å®šå‡ ç‡å‘ç°çš„é‡å¤§ã€ç”šè‡³å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ•…éšœçš„ç¼ºé™·.</p><p>åœ¨æ¢ç´¢æ€§æµ‹è¯•æœŸé—´ï¼Œå»ºè®®è·Ÿè¸ªè®°å½•å¥½æµ‹è¯•çš„æµç¨‹ã€ä»¥åŠå¼€å§‹è¯¥æµç¨‹ä¹‹å‰çš„æ´»åŠ¨è®°å½•, æ–¹ä¾¿å¤ç°bug.</p><p>æ¢ç´¢æµ‹è¯•ä¸éœ€è¦ä»»ä½•æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹.</p><p><br></p><h2 id="20-åŠŸèƒ½æµ‹è¯•-functional-testing"><a href="#20-åŠŸèƒ½æµ‹è¯•-functional-testing" class="headerlink" title="20) åŠŸèƒ½æµ‹è¯•(Functional Testing)"></a>20) åŠŸèƒ½æµ‹è¯•(Functional Testing)</h2><p>åŠŸèƒ½æµ‹è¯•æ˜¯ä¸€ä¸ªå¤§ç±», åˆç§°ä¸ºè¡Œä¸ºæµ‹è¯•ï¼Œ  <strong>åŠŸèƒ½æµ‹è¯•ä¼šå¿½ç•¥å†…éƒ¨å®ç°è€Œå…³æ³¨ç»„ä»¶çš„è¾“å‡ºï¼Œç›®çš„æ˜¯éªŒè¯æ˜¯å¦ç¬¦åˆéœ€æ±‚ï¼Œè¿™æ˜¯ä¸€ç§é¢å‘åŠŸèƒ½éœ€æ±‚çš„é»‘ç›’æµ‹è¯•ç±»å‹</strong>ã€‚å…³äºåŠŸèƒ½æµ‹è¯•çš„ç»†èŠ‚è¯·çœ‹<a href="https://www.softwaretestinghelp.com/guide-to-functional-testing/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>åŠŸèƒ½æµ‹è¯•æ˜¯ç›¸å¯¹éåŠŸèƒ½æµ‹è¯•è€Œè¨€çš„, åŠŸèƒ½æµ‹è¯•éœ€è¦å…³å¿ƒåŠŸèƒ½æˆ–è€…ä¸šåŠ¡ï¼Œéœ€è¦ä¸šåŠ¡è€¦åˆç¨‹åº¦é«˜ï¼›è€ŒéåŠŸèƒ½æµ‹è¯•åˆ™æ˜¯é€šç”¨çš„ï¼Œæ¯”å¦‚å‹åŠ›æµ‹è¯•ã€è´Ÿè½½æµ‹è¯•ï¼Œè¿™äº›æµ‹è¯•éƒ½æœ‰é€šç”¨çš„å·¥å…·æ¥æ”¯æŒï¼Œä¸éœ€è¦æˆ–å¾ˆå°‘å®šåˆ¶åŒ–æ“ä½œ.</p><p><br></p><h2 id="21-guiæµ‹è¯•-graphical-user-interface-gui-testing"><a href="#21-guiæµ‹è¯•-graphical-user-interface-gui-testing" class="headerlink" title="21) GUIæµ‹è¯•(Graphical User Interface (GUI) Testing)"></a>21) GUIæµ‹è¯•(Graphical User Interface (GUI) Testing)</h2><p>GUIæµ‹è¯•çš„ç›®çš„æ˜¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚éªŒè¯GUIã€‚åœ¨è¯¦ç»†è®¾è®¡æ–‡æ¡£å’ŒGUIæ¨¡å‹(UIè®¾è®¡æ–‡æ¡£)ä¸­ä¸€èˆ¬ä¼šæåˆ°åº”ç”¨æœŸæœ›çš„GUI.</p><p>å¸¸è§çš„GUIæµ‹è¯•åŒ…æ‹¬æµ‹è¯•å±å¹•ä¸Šæ˜¾ç¤ºçš„æŒ‰é’®å’Œè¾“å…¥å­—æ®µçš„å¤§å°ã€è¡¨æ ¼ä¸­æ‰€æœ‰æ–‡æœ¬ã€è¡¨æ ¼æˆ–å†…å®¹çš„å¯¹é½è§„åˆ™ç­‰ç­‰. å¦‚æœå›¢é˜Ÿæœ‰UIè®¾è®¡è§„èŒƒï¼Œè¿˜ä¼šéªŒè¯æ˜¯å¦ç¬¦åˆè®¾è®¡è§„èŒƒ</p><p><br></p><h2 id="22-å¤§çŒ©çŒ©æµ‹è¯•-gorilla-testing"><a href="#22-å¤§çŒ©çŒ©æµ‹è¯•-gorilla-testing" class="headerlink" title="22) å¤§çŒ©çŒ©æµ‹è¯•(Gorilla Testing)"></a>22) å¤§çŒ©çŒ©æµ‹è¯•(Gorilla Testing)</h2><p><img src="/images/typeof-testing/gr.jpg" alt></p><p>å¤§çŒ©çŒ©æµ‹è¯•æ˜¯ç”±æµ‹è¯•äººå‘˜æ‰§è¡Œçš„æµ‹è¯•ç±»å‹ï¼Œæœ‰æ—¶ä¹Ÿç”±å¼€å‘äººå‘˜æ‰§è¡Œã€‚åœ¨å¤§çŒ©çŒ©æµ‹è¯•ä¸­ï¼Œå¯¹æ¨¡å—ä¸­çš„ä¸€ä¸ªæ¨¡å—æˆ–åŠŸèƒ½è¿›è¡Œäº†å½»åº•å’Œä¸¥æ ¼çš„æµ‹è¯•ã€‚åŸæ–‡æ²¡æœ‰è¯´å‡ºå¤§çŒ©çŒ©æµ‹è¯•çš„ç²¾é«“ï¼Œå¤§çŒ©çŒ©æµ‹è¯•ä¼šå¯¹ä¸€ä¸ªåŠŸèƒ½æˆ–æ¨¡å—è¿›è¡Œé‡å¤â€˜ä¸Šç™¾æ¬¡â€™çš„æµ‹è¯•, äººç±»æ ¹æœ¬å—ä¸äº†è¿™æ ·å­çš„æµ‹è¯•æ–¹å¼ï¼Œæ‰€ä»¥å¤§çŒ©çŒ©æµ‹è¯•çš„å¦ä¸€ä¸ªåˆ«åæ˜¯â€˜ä»¤äººæ²®ä¸§çš„æµ‹è¯•(Frustrating Testing)â€™</p><p>è¿™ç§æµ‹è¯•çš„ç›®çš„æ˜¯æ£€æŸ¥åº”ç”¨ç¨‹åºçš„ç¨³å¥æ€§(robustness)</p><p><br></p><h2 id="23-ä¹è§‚è·¯çº¿æµ‹è¯•-happy-path-testing"><a href="#23-ä¹è§‚è·¯çº¿æµ‹è¯•-happy-path-testing" class="headerlink" title="23) ä¹è§‚è·¯çº¿æµ‹è¯•(Happy Path Testing)"></a>23) ä¹è§‚è·¯çº¿æµ‹è¯•(Happy Path Testing)</h2><p><strong>ä¹è§‚è·¯çº¿æµ‹è¯•</strong>çš„ç›®æ ‡æ˜¯åœ¨æ­£å¸¸æµç¨‹ä¸ŠæˆåŠŸæµ‹è¯•åº”ç”¨ã€‚å®ƒä¸ä¼šè€ƒè™‘å„ç§è´Ÿé¢æˆ–å¼‚å¸¸æƒ…å†µã€‚é‡ç‚¹åªå…³æ³¨äºéªŒè¯åº”ç”¨åœ¨æœ‰æ•ˆå’Œåˆæ³•è¾“å…¥çš„æ¡ä»¶ä¸‹ç”ŸæˆæœŸæœ›çš„è¾“å‡º. æ¯”å¦‚é“¶è¡Œä»˜æ¬¾ï¼Œåªè€ƒè™‘è´¦æˆ·æœ‰é’±çš„æ­£å¸¸çŠ¶æ€ğŸ˜‚</p><p><br></p><h2 id="24-å¢é‡é›†æˆæµ‹è¯•-incremental-integration-testing"><a href="#24-å¢é‡é›†æˆæµ‹è¯•-incremental-integration-testing" class="headerlink" title="24) å¢é‡é›†æˆæµ‹è¯•(Incremental Integration Testing)"></a>24) å¢é‡é›†æˆæµ‹è¯•(Incremental Integration Testing)</h2><p>å¢é‡é›†æˆæµ‹è¯•æ˜¯ä¸€ç§è‡ªä¸‹è€Œä¸Šçš„æµ‹è¯•æ–¹æ³•ï¼Œå³åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶ç«‹å³é›†æˆåº”ç”¨ç¨‹åºè¿›è¡Œè¿ç»­æµ‹è¯•ã€‚åº”ç”¨ç¨‹åºåŠŸèƒ½å’Œæ¨¡å—åº”è¯¥è¶³å¤Ÿç‹¬ç«‹ï¼Œä»¥ä¾¿å•ç‹¬æµ‹è¯•ã€‚è¿™é€šå¸¸ç”±ç¨‹åºå‘˜æˆ–æµ‹è¯•äººå‘˜å®Œæˆã€‚</p><p><br></p><h2 id="25-å®‰è£…å¸è½½æµ‹è¯•-install-uninstall-testing"><a href="#25-å®‰è£…å¸è½½æµ‹è¯•-install-uninstall-testing" class="headerlink" title="25) å®‰è£…å¸è½½æµ‹è¯•(Install/Uninstall Testing)"></a>25) å®‰è£…å¸è½½æµ‹è¯•(Install/Uninstall Testing)</h2><p><img src="/images/typeof-testing/blue-screen.jpg" alt></p><p>å®‰è£…å’Œå¸è½½æµ‹è¯•æ˜¯åœ¨ä¸åŒç¡¬ä»¶æˆ–è½¯ä»¶ç¯å¢ƒä¸‹çš„ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„è¿›è¡Œå®Œæ•´/éƒ¨åˆ†çš„å®‰è£…ã€å‡çº§ã€å¸è½½ã€å›æ»šç­‰æµ‹è¯•. å¸¸ç”¨äºæ¡Œé¢ç«¯åº”ç”¨</p><p><br></p><h2 id="26-é›†æˆæµ‹è¯•-integration-testing"><a href="#26-é›†æˆæµ‹è¯•-integration-testing" class="headerlink" title="26) é›†æˆæµ‹è¯•(Integration Testing)"></a>26) é›†æˆæµ‹è¯•(Integration Testing)</h2><p>é›†æˆæµ‹è¯•æ˜¯æŒ‡å°†æ‰€æœ‰æ¨¡å—é›†æˆä¹‹åï¼ŒéªŒè¯åˆå¹¶åçš„åŠŸèƒ½. æ¨¡å—é€šå¸¸æ˜¯ä»£ç æ¨¡å—ã€å•ä¸ªåº”ç”¨ã€ç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç­‰ç­‰ã€‚</p><p><img src="/images/typeof-testing/ingr.png" alt></p><p>é›†æˆæµ‹è¯•ä¸€èˆ¬åœ¨å•å…ƒæµ‹è¯•ä¹‹åï¼Œæ‰€ä»¥å•å…ƒæµ‹è¯•æ˜¯é›†æˆæµ‹è¯•çš„åŸºç¡€ï¼Œæ²¡æœ‰è¿›è¡Œå•å…ƒæµ‹è¯•çš„é›†æˆæµ‹è¯•æ˜¯ä¸é è°±çš„ã€‚æ‰€ä»¥æœ€ç®€å•çš„å½¢å¼æ˜¯ï¼šâ€™æŠŠä¸¤ä¸ªå·²ç»æµ‹è¯•è¿‡çš„å•å…ƒç»„åˆæˆä¸€ä¸ªç»„ä»¶ï¼Œæµ‹è¯•å®ƒä»¬ä¹‹é—´çš„æ¥å£â€™ã€‚ä¹Ÿå°±æ˜¯è¯´<strong>é›†æˆæµ‹è¯•åœ¨å•å…ƒæµ‹è¯•çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°†å•å…ƒæµ‹è¯•ä¸­ç‹¬ç«‹çš„å•å…ƒåˆå¹¶èµ·æ¥ï¼ŒéªŒè¯å®ƒä»¬çš„åè°ƒæ€§, åˆå¹¶åçš„ç»„ä»¶åˆæ˜¯ä¸€ä¸ªæ–°çš„â€˜å•å…ƒâ€™ï¼Œè¿™æ ·é€æ­¥åˆå¹¶æµ‹è¯•ï¼Œæœ€ç»ˆå½¢æˆå®Œæ•´çš„åº”ç”¨ç¨‹åº</strong>ã€‚</p><p>è¿™ç§ç±»å‹çš„æµ‹è¯•å¸¸ç”¨äºB/Sè½¯ä»¶å’Œåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p><p><br></p><h2 id="27-è´Ÿè½½æµ‹è¯•-load-testing"><a href="#27-è´Ÿè½½æµ‹è¯•-load-testing" class="headerlink" title="27) è´Ÿè½½æµ‹è¯•(Load Testing)"></a>27) è´Ÿè½½æµ‹è¯•(Load Testing)</h2><p>å®ƒæ˜¯ä¸€ç§éåŠŸèƒ½æ€§æµ‹è¯•ï¼Œè´Ÿè½½æµ‹è¯•çš„ç›®çš„æ˜¯æ£€æŸ¥ç³»ç»Ÿå¯ä»¥æ‰¿å—å¤šå°‘è´Ÿè½½è€Œä¸ä¼šé™ä½æ€§èƒ½, æˆ–è€…è¯´ç¡®å®šæœ€å¤§å·¥ä½œè´Ÿè½½æ˜¯å¤šå°‘ã€‚</p><p>è´Ÿè½½æµ‹è¯•æœ‰åŠ©äºæŸ¥æ‰¾ç‰¹å®šè´Ÿè½½ä¸‹ç³»ç»Ÿçš„æœ€å¤§å®¹é‡ä»¥åŠå¯¼è‡´è½¯ä»¶æ€§èƒ½ä¸‹é™çš„ä»»ä½•åŸå› ã€‚å¯ä»¥ä½¿ç”¨JMeterï¼ŒLoadRunnerï¼ŒWebLoadï¼ŒSilkæ‰§è¡Œç¨‹åºç­‰å·¥å…·æ‰§è¡Œè´Ÿè½½æµ‹è¯•ã€‚</p><p><img src="/images/typeof-testing/perf.png" alt></p><p>è´Ÿè½½æµ‹è¯•ç»å¸¸å’Œæ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€ç¨³å®šæ€§æµ‹è¯•ç­‰è”ç³»åœ¨ä¸€èµ·ã€‚å¦‚ä¸Šå›¾(æ¥æºäºæ·˜å®æ€§èƒ½ç™½çš®ä¹¦). å…¶ä¸­TPS(Transation Per Second)æŒ‡çš„æ˜¯æ¯ç§’é’Ÿç³»ç»Ÿå¯ä»¥å¤„ç†çš„äº¤æ˜“æˆ–äº‹åŠ¡çš„æ•°é‡; Server ResourceæŒ‡çš„æ˜¯ç³»ç»Ÿèµ„æºå æœ‰.</p><ul><li><strong>æ€§èƒ½æµ‹è¯•</strong>. ä¸»è¦ä½äºa-bä¹‹é—´. åœ¨ç³»ç»Ÿè®¾è®¡åˆæœŸå°±ä¼šè§„åˆ’ä¸€ä¸ªé¢„æœŸç›®æ ‡, æ¯”å¦‚ç»™å®šèµ„æºAxï¼Œaç‚¹å°±æ˜¯æ€§èƒ½æœŸæœ›å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ç»™å®šå›ºå®šèµ„æºAxçš„æƒ…å†µä¸‹ï¼Œå¦‚æœTPSå¯ä»¥è¾¾åˆ°aç‚¹ç”šè‡³æ›´é«˜ï¼Œå°±è¯´æ˜ç³»ç»Ÿæ€§èƒ½è¾¾åˆ°æˆ–è€…å¥½äºé¢„æœŸ. <strong>é€šè¿‡æ€§èƒ½æµ‹è¯•å¯ä»¥éªŒè¯ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æœ‰æ²¡æœ‰è¾¾åˆ°é¢„æœŸ</strong></li><li><strong>è´Ÿè½½æµ‹è¯•</strong>. ä½äºb-cä¹‹é—´ã€‚å¯¹ç³»ç»Ÿä¸æ–­å¢åŠ å¹¶å‘è¯·æ±‚ï¼Œç›´åˆ°ç³»ç»Ÿçš„æŸé¡¹æˆ–è€…å¤šé¡¹æŒ‡æ ‡è¾¾åˆ°å®‰å…¨çš„ä¸´ç•Œå€¼ï¼Œå¦‚ä¸Šå›¾ä¸­çš„cï¼Œè¿™ä¸ªcå°±æ˜¯æ‰€è°“çš„æœ€å¤§è´Ÿè½½é‡ã€‚åé¢å†å¢åŠ è¯·æ±‚å‹åŠ›ï¼Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ä¸ä½†ä¸èƒ½æé«˜ï¼Œè¿”å›ä¼šä¸‹é™. <strong>é€šè¿‡å‹åŠ›æµ‹è¯•å¯ä»¥å¾—å‡ºç³»ç»Ÿæœ€å¤§çš„å®‰å…¨è´Ÿè½½å€¼</strong></li><li><strong>å‹åŠ›æµ‹è¯•</strong>. ä½äºc-dä¹‹é—´ã€‚åœ¨è¶…è¿‡å®‰å…¨è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œç»§ç»­å¯¹ç³»ç»Ÿå¢åŠ å‹åŠ›ï¼Œç›´åˆ°è¾¾åˆ°å´©æºƒç‚¹, å³ä¸Šå›¾çš„d. <strong>é€šè¿‡å‹åŠ›æµ‹è¯•å¯ä»¥å¾—å‡ºç³»ç»Ÿçš„æœ€å¤§æ‰¿å—èƒ½åŠ›</strong></li><li><strong>ç¨³å®šæ€§æµ‹è¯•</strong>. ä½äºa-dä¹‹é—´ã€‚åœ¨aã€bã€cã€dä¸åŒçš„ç‚¹(ä»£è¡¨ç‰¹å®šçš„ç¡¬ä»¶ã€è½¯ä»¶å’Œç½‘ç»œç¯å¢ƒ)ï¼Œè®©ç³»ç»Ÿè¿è¡Œä¸€æ®µè¾ƒé•¿çš„æ—¶é—´ï¼Œ<strong>æ£€æµ‹ç³»ç»Ÿåœ¨ä¸åŒæ¡ä»¶ä¸‹çš„ç³»ç»Ÿè¿è¡Œçš„ç¨³å®šæ€§</strong>ã€‚</li></ul><p>å¦å¤–ä¹Ÿæ¨èé˜…è¯»&lt;&lt;å¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„&gt;&gt;è¿™æœ¬ä¹¦</p><p><br></p><h2 id="28-çŒ´å­æµ‹è¯•-monkey-testing"><a href="#28-çŒ´å­æµ‹è¯•-monkey-testing" class="headerlink" title="28) çŒ´å­æµ‹è¯•(Monkey Testing)"></a>28) çŒ´å­æµ‹è¯•(Monkey Testing)</h2><p><img src="/images/typeof-testing/monkey-testing.jpg" alt></p><p>çŒ´å­æµ‹è¯•æ˜¯ç”±æµ‹è¯•äººå‘˜è¿›è¡Œçš„ï¼Œå³æŠŠè‡ªå·±å½“æˆçŒ´å­ï¼Œåœ¨æ²¡æœ‰ä»»ä½•çŸ¥è¯†èƒŒæ™¯æˆ–è€…ç†è§£åº”ç”¨å‰æä¸‹ï¼Œéšæ„è¾“å…¥å’Œæ“ä½œã€‚</p><p>çŒ´å­æµ‹è¯•çš„ç›®æ ‡æ˜¯é€šè¿‡æä¾›éšæœºè¾“å…¥å€¼/æ•°æ®æ¥æ£€æŸ¥åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿæ˜¯å¦å´©æºƒã€‚ çŒ´å­æ˜¯éšæœºæ‰§è¡Œçš„ï¼Œæ²¡æœ‰æµ‹è¯•ç”¨ä¾‹, ä¹Ÿæ²¡æœ‰å¿…è¦äº†è§£ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½</p><p><br></p><h2 id="29-å˜å¼‚æµ‹è¯•-mutation-testing"><a href="#29-å˜å¼‚æµ‹è¯•-mutation-testing" class="headerlink" title="29) å˜å¼‚æµ‹è¯•(Mutation Testing)"></a>29) å˜å¼‚æµ‹è¯•(Mutation Testing)</h2><p>å˜å¼‚æµ‹è¯•(æˆ–è€…è¯´å¯å˜æ€§æµ‹è¯•)æ˜¯ä¸€ç§ç™½ç›’æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ç§å’Œå•å…ƒæµ‹è¯•åç€æ¥çš„æµ‹è¯•ç±»å‹ã€‚</p><p><img src="/images/typeof-testing/mut.png" alt></p><p><strong>é€šå¸¸å•å…ƒæµ‹è¯•çš„æ€è·¯æ˜¯é€šè¿‡æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯ä»£ç æ˜¯å¦æœ‰æ•ˆå¯é ï¼Œè€Œå˜å¼‚æµ‹è¯•æ˜¯åè¿‡æ¥. å®ƒé¦–å…ˆæ›´æ”¹å…¶ä¸­ä¸€ä¸ªç¨‹åºçš„æºä»£ç ï¼Œå†è·‘å•å…ƒæµ‹è¯•ï¼Œå¦‚æœå•å…ƒæµ‹è¯•é€šè¿‡åˆ™å¯èƒ½è¯´æ˜æµ‹è¯•ç”¨ä¾‹æ²¡æœ‰æ•ˆæœï¼Œæˆ–è€…æµ‹è¯•ç”¨ä¾‹æ²¡æœ‰è¦†ç›–åˆ°è¿™å¤„ä»£ç å˜å¼‚</strong>. </p><p>æ‰€ä»¥è¯´å˜å¼‚æµ‹è¯•å¯ä»¥åè¿‡æ¥éªŒè¯ä½ çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¦æœ‰æ•ˆ, è¿˜æœ‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾å‡ºä¸€äº›æ— æ³•è¢«å½“å‰æµ‹è¯•æ‰€é˜²æ­¢çš„æ½œåœ¨é”™è¯¯.</p><p><br></p><h2 id="30-æ‚²è§‚æµ‹è¯•-negative-testing"><a href="#30-æ‚²è§‚æµ‹è¯•-negative-testing" class="headerlink" title="30) æ‚²è§‚æµ‹è¯•(Negative Testing)"></a>30) æ‚²è§‚æµ‹è¯•(Negative Testing)</h2><p>æ‚²è§‚æµ‹è¯•å’Œä¹è§‚è·¯çº¿æµ‹è¯•ç›¸å, å®ƒè¦æ±‚æµ‹è¯•è€…è¦å…·æœ‰â€œæ‰“ç ´â€å¸¸è§„çš„æ€åº¦ï¼Œè€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µ, ä½¿ç”¨å„ç§é‚ªæ¶çš„ğŸ‘¿ã€ä¸æ€€å¥½æ„ã€ä¸åˆæ³•çš„æ“ä½œæ¥æµ‹è¯•ç³»ç»Ÿã€‚æ‚²è§‚æµ‹è¯•ä¼šä½¿ç”¨ä¸æ­£ç¡®çš„æ•°æ®ã€æ— æ•ˆæ•°æ®æˆ–è¾“å…¥æ¥è¿›è¡ŒéªŒè¯ã€‚å®ƒéªŒè¯ç³»ç»Ÿæ˜¯å¦å¯ä»¥è¯†åˆ«å¼‚å¸¸æƒ…å†µï¼Œå¹¶æŒ‰é¢„æœŸè¿è¡Œã€‚</p><p><br></p><h2 id="31-éåŠŸèƒ½æµ‹è¯•-non-functional-testing"><a href="#31-éåŠŸèƒ½æµ‹è¯•-non-functional-testing" class="headerlink" title="31) éåŠŸèƒ½æµ‹è¯•(Non-Functional Testing)"></a>31) éåŠŸèƒ½æµ‹è¯•(Non-Functional Testing)</h2><p>æ¯ä¸ªå¤§å‹çš„ç»„ç»‡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å›¢é˜Ÿï¼Œé€šå¸¸ç§°ä¸ºéåŠŸèƒ½æµ‹è¯•ï¼ˆNFTï¼‰å›¢é˜Ÿæˆ–æ€§èƒ½å›¢é˜Ÿã€‚</p><p>éåŠŸèƒ½æ€§æµ‹è¯•æ¶‰åŠæµ‹è¯•éåŠŸèƒ½æ€§éœ€æ±‚ï¼Œå¦‚è´Ÿè½½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€å®‰å…¨æ€§ã€å®¹é‡ï¼Œæ¢å¤æµ‹è¯•ç­‰ç­‰. NFTæµ‹è¯•çš„ç›®æ ‡æ˜¯ç¡®ä¿è½¯ä»¶æˆ–åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´æ˜¯å¦æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p><p>ä¾‹å¦‚åŠ è½½ä»»ä½•é¡µé¢æˆ–ç³»ç»Ÿéƒ½ä¸åº”è¯¥èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œå¹¶ä¸”åœ¨è´Ÿè½½å³°å€¼æœŸé—´åº”è¯¥ç»´æŒè‰¯å¥½è¿è¡ŒçŠ¶æ€ã€‚</p><p><br></p><h2 id="32-æ€§èƒ½æµ‹è¯•-performance-testing"><a href="#32-æ€§èƒ½æµ‹è¯•-performance-testing" class="headerlink" title="32) æ€§èƒ½æµ‹è¯•(Performance Testing)"></a>32) æ€§èƒ½æµ‹è¯•(Performance Testing)</h2><p>è¿™ä¸ªæœ¯è¯­é€šå¸¸ä¸â€œå‹åŠ›â€å’Œâ€œè´Ÿè½½â€æµ‹è¯•äº’æ¢ä½¿ç”¨ã€‚<a href="https://en.wikipedia.org/wiki/Software_performance_testing" target="_blank" rel="noopener">æ€§èƒ½æµ‹è¯•</a>ç”¨äºæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ»¡è¶³æ€§èƒ½è¦æ±‚ã€‚å®ƒä¼šä½¿ç”¨ä¸åŒçš„æ€§èƒ½å’Œè´Ÿè½½å·¥å…·æ¥æ‰§è¡Œæ­¤æµ‹è¯•ã€‚</p><p><a href="https://www.softwaretestinghelp.com/introduction-to-performance-testing-loadrunner-training-tutorial-part-1/" target="_blank" rel="noopener">æ€§èƒ½æµ‹è¯•</a>è¿™ä¸ªèŒƒå›´æ¯”è¾ƒå¤§ï¼Œ<strong>å¹¿ä¹‰ä¸Šçš„æ€§èƒ½æµ‹è¯•åŒ…æ‹¬äº†ä¸Šæ–‡æåˆ°çš„è´Ÿè½½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€ç¨³å®šæ€§æµ‹è¯•ã€å®¹é‡æµ‹è¯•ç­‰ç­‰ã€‚ç‹­ä¹‰çš„æ€§èƒ½æµ‹è¯•åˆ™æ˜¯æŒ‡åœ¨ç‰¹å®šèµ„æºæ¡ä»¶ä¸‹ï¼Œæµ‹è¯•ç³»ç»Ÿèƒ½å¦è¾¾åˆ°æœŸæœ›å€¼, ä¹Ÿå°±æ˜¯åŸºçº¿æµ‹è¯•(Baseline Test).</strong></p><p>æ€»ç»“ä¸€ä¸‹æ€§èƒ½æµ‹è¯•çš„ç±»å‹:</p><ul><li><strong>åŸºçº¿æµ‹è¯•(Baseline Test)</strong>: åœ¨ç»™å®šçš„èµ„æºä¸‹ï¼Œæµ‹è¯•æœ€ä½³çš„æ€§èƒ½ï¼Œç”¨ä½œåç»­æµ‹é‡çš„å‚è€ƒâ€˜åŸºçº¿â€™ã€‚æ³¨æ„åŸºçº¿æµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•æ˜¯æœ‰åŒºåˆ«çš„, è¿™ä¹ˆç†è§£ï¼ŒåŸºå‡†æ˜¯ä½ æƒ³è¾¾åˆ°çš„ï¼Œæ¯”å¦‚100çŸ­è·‘ä¸–ç•Œçºªå½•ï¼ŒåŸºçº¿æ˜¯ä½ çš„æˆç»©ã€‚</li><li><strong>è´Ÿè½½æµ‹è¯•(Load Test)</strong>: åœ¨é¢„æœŸå³°å€¼çš„ç”Ÿäº§è´Ÿè½½ä¸‹æµ‹é‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚ä¸Šæ–‡è´Ÿè½½æµ‹è¯•å·²ç»å¤§æ¦‚ä»‹ç»äº†</li><li><strong>ç¨³å®šæ€§æµ‹è¯•(Endurance Test)</strong>: åœ¨æŒ‡å®šè´Ÿè½½ä¸‹ï¼Œé•¿æ—¶é—´æµ‹é‡ç³»ç»Ÿçš„ç¨³å®šæ€§</li><li><strong>å‹åŠ›æµ‹è¯•(Stress Test)</strong>: æµ‹è¯•æç«¯æ¡ä»¶ä¸‹çš„ç³»ç»Ÿæ€§èƒ½</li></ul><p><br></p><h2 id="33-æ¢å¤æµ‹è¯•-recovery-testing"><a href="#33-æ¢å¤æµ‹è¯•-recovery-testing" class="headerlink" title="33) æ¢å¤æµ‹è¯•(Recovery Testing)"></a>33) æ¢å¤æµ‹è¯•(Recovery Testing)</h2><p>æ¢å¤æµ‹è¯•ç”¨äºéªŒè¯åº”ç”¨æˆ–ç³»ç»Ÿä¸­å´©æºƒæˆ–ç¾éš¾ä¸­æ¢å¤çš„ç¨‹åº¦. ç¡®å®šç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿåœ¨ç¾éš¾å‘ç”Ÿåç»§ç»­è¿è¡Œã€‚</p><p>æ¯”å¦‚åº”ç”¨é€šè¿‡ç½‘ç»œç”µç¼†æ¥æ”¶æ•°æ®ï¼Œçªç„¶æ–­å¼€äº†ç½‘ç»œç”µç¼†çš„è¿æ¥, è¿‡ä¸€æ®µæ—¶é—´ï¼Œå†æ’ä¸Šç½‘çº¿, ç³»ç»Ÿåº”è¯¥å¼€å§‹æ¢å¤ç”±äºç½‘ç»œç”µç¼†æ‹”å‡ºè€Œä¸¢å¤±è¿æ¥çš„æ•°æ®</p><p><br></p><h2 id="34-å›å½’æµ‹è¯•-regression-testing"><a href="#34-å›å½’æµ‹è¯•-regression-testing" class="headerlink" title="34) å›å½’æµ‹è¯•(Regression Testing)"></a>34) å›å½’æµ‹è¯•(Regression Testing)</h2><p>åœ¨ä¿®æ”¹ä»»æ„æ¨¡å—æˆ–è€…åŠŸèƒ½åï¼Œå°†åº”ç”¨ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæµ‹è¯•ï¼Œç§°ä¸ºå›å½’æµ‹è¯•ã€‚<strong>å›å½’æµ‹è¯•çš„ç›®çš„å°±æ˜¯éªŒè¯åœ¨è½¯ä»¶åŸæœ‰çš„åŠŸèƒ½å˜åŠ¨åæ˜¯å¦ä¿æŒå®Œæ•´æ€§</strong>. </p><p><img src="/images/typeof-testing/bug-fix.gif" alt></p><p><strong>æœ‰è§‚ç‚¹è®¤ä¸ºå›å½’æµ‹è¯•å°±æ˜¯å›å½’æµ‹è¯•æ˜¯æŒ‡é‡å¤æ‰§è¡Œä»¥å‰çš„å…¨éƒ¨æˆ–éƒ¨åˆ†ç›¸åŒçš„æµ‹è¯•å·¥ä½œ, å…¶å®ä¸æ˜¯ä¸æ— é“ç†ã€‚è€Œä¸”å› ä¸ºå±€éƒ¨ä¿®æ”¹è€Œç‰µä¸€å‘åŠ¨å…¨èº«çš„æ„å¤–åœ¨å¹³æ—¶å¼€å‘ä¸­å¹¶ä¸å°‘è§ï¼Œè¿™ç§æ„å¤–æ€§å°±æ˜¯å›å½’æµ‹è¯•çš„å­˜åœ¨çš„ç›®çš„</strong>.</p><p>å› ä¸ºåœ¨å›å½’æµ‹è¯•ä¸­å¾ˆéš¾è¦†ç›–æ‰€æœ‰ç³»ç»Ÿï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·è¿›è¡Œè¿™äº›ç±»æµ‹è¯•ã€‚æ¯”å¦‚æ¯æ¬¡ä¿®æ”¹å®Œä»£ç ï¼Œè·‘å•å…ƒæµ‹è¯•æ¥ç¡®ä¿ä¸å½±å“ç¡®ä¿å…¶ä»–è½¯ä»¶å•å…ƒã€‚</p><p>åœ¨å‰ç«¯ä¸­<a href="https://jestjs.io/docs/en/snapshot-testing" target="_blank" rel="noopener">ç»„ä»¶å¿«ç…§æµ‹è¯•(Snapshot Testing)</a>å’Œä¸€äº›<a href="https://github.com/HuddleEng/PhantomCSS" target="_blank" rel="noopener">CSS UIæµ‹è¯•</a>ï¼Œéƒ½æ˜¯å±äºå›å½’æµ‹è¯•ç±»å‹,å®ƒä»¬çš„åŸç†éƒ½æ˜¯å’Œä¸Šä¸€æ¬¡æµ‹è¯•ç”Ÿæˆçš„ç»“æœè¿›è¡Œæ¯”å¯¹ï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ„å¤–çš„ä¿®æ”¹:</p><p><img src="/images/typeof-testing/phantomcss.png" alt></p><p><br></p><h2 id="35-åŸºäºé£é™©çš„æµ‹è¯•-risk-based-testing-rbt"><a href="#35-åŸºäºé£é™©çš„æµ‹è¯•-risk-based-testing-rbt" class="headerlink" title="35) åŸºäºé£é™©çš„æµ‹è¯•(Risk-Based Testing (RBT))"></a>35) åŸºäºé£é™©çš„æµ‹è¯•(Risk-Based Testing (RBT))</h2><p>åœ¨åŸºäºé£é™©çš„æµ‹è¯•ä¸­ï¼ŒåŠŸèƒ½æˆ–éœ€æ±‚å°†æ ¹æ®å…¶ä¼˜å…ˆçº§è¿›è¡Œæµ‹è¯•ã€‚åŸºäºé£é™©çš„æµ‹è¯•ä¼šä¼˜å…ˆæµ‹è¯•é«˜åº¦å…³é”®çš„åŠŸèƒ½ï¼Œå› ä¸ºè¿™äº›åŠŸèƒ½å¯¹ä¸šåŠ¡å½±å“æœ€å¤§æˆ–è€…æ•…éšœæ¦‚ç‡éå¸¸é«˜. è€Œä¼˜å…ˆçº§ç”±ä¸šåŠ¡éœ€æ±‚å†³å®šï¼Œå› æ­¤ä¸€æ—¦ä¸ºæ‰€æœ‰åŠŸèƒ½è®¾ç½®äº†ä¼˜å…ˆçº§ï¼Œåˆ™åº”è¯¥é¦–å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§åŠŸèƒ½æˆ–æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åå†æ‰§è¡Œä½ä¼˜å…ˆçº§åŠŸèƒ½ã€‚ ä½ä¼˜å…ˆçº§åŠŸèƒ½å¯ä»¥åœ¨æ—¶é—´å……è£•æ—¶æµ‹è¯•ï¼Œæˆ–è€…ä¸æµ‹è¯•ã€‚</p><p><strong>åŸºäºé£é™©çš„æµ‹è¯•åº”è¯¥åœ¨â€˜ä¸å¤Ÿæ—¶é—´æ¥æµ‹è¯•æ•´ä¸ªåº”ç”¨ï¼Œä½†æ˜¯åˆè¦æŒ‰æ—¶äº¤ä»˜è½¯ä»¶â€™çš„æƒ…å†µä¸‹æ‰§è¡Œ</strong>ï¼Œé€šå¸¸è¿˜éœ€è¦å®¢æˆ·å’Œé«˜çº§ç®¡ç†å±‚çš„è®¨è®ºå’Œæ‰¹å‡†ä¹‹åæ‰è¿›è¡Œ</p><p><br></p><h2 id="36-å®Œæ•´æ€§æµ‹è¯•-sanity-testing"><a href="#36-å®Œæ•´æ€§æµ‹è¯•-sanity-testing" class="headerlink" title="36) å®Œæ•´æ€§æµ‹è¯•(Sanity Testing)"></a>36) å®Œæ•´æ€§æµ‹è¯•(Sanity Testing)</h2><p>å®Œæ•´æ€§æµ‹è¯•ç”¨äºç¡®å®šä¸€ä¸ªæ–°çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å¼€å§‹è¿›è¡Œæ­£å¼çš„æµ‹è¯•ï¼Œå¦‚æœä¸€ä¸ªåº”è¯¥åœ¨ä¸€å¼€å§‹ä½¿ç”¨æ—¶å°±å´©æºƒï¼Œé‚£ä¹ˆå°±è¯´æ˜ç³»ç»Ÿè¿˜ä¸å¤Ÿç¨³å®šï¼Œæ²¡æœ‰å¿…è¦è¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•ã€‚è¿™ç§æƒ…å†µåº”è¯¥æ‰“å›ç»™å¼€å‘ï¼Œä»¥å…æµªè´¹æ—¶é—´</p><p>ä»¥æˆ‘ä»¬å…¬å¸ä¸ºä¾‹:</p><p><img src="/images/typeof-testing/smoke.png" alt></p><ul><li>åœ¨è½¯ä»¶è®¾è®¡é˜¶æ®µï¼Œæµ‹è¯•å›¢é˜Ÿå°±ä¼šä¸ºç¼–å†™å†’çƒŸæµ‹è¯•ç”¨ä¾‹; </li><li>å¼€å‘å›¢é˜Ÿåœ¨æäº¤ç‰ˆæœ¬ç»™æµ‹è¯•ä¹‹å‰ä¼šè‡ªå·±è·‘ä¸€ä¸‹å†’çƒŸç”¨ä¾‹, ç¡®ä¿æ²¡æœ‰é‡å¤§æ•…éšœï¼›</li><li>å°†ç‰ˆæœ¬æäº¤ç»™æµ‹è¯•å›¢é˜Ÿåï¼Œæµ‹è¯•å›¢é˜Ÿå°±ä¼šå…ˆè·‘ä¸€ä¸‹å®Œæ•´æ€§æµ‹è¯•ï¼Œæ£€æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰é‡å¤§çš„ï¼Œå½±å“æµ‹è¯•è¿›ç¨‹çš„bugï¼Œå¦‚æœæœ‰åˆ™é€€å›å¼€å‘</li><li>å¦‚æœé€šè¿‡äº†å®Œæ•´æ€§æµ‹è¯•, åˆ™è¿›è¡Œå†’çƒŸæµ‹è¯•ï¼Œå¦‚æœå†’çƒŸæµ‹è¯•æ²¡æœ‰é€šè¿‡ä¹Ÿä¼šç«‹å³æ‰“å›å¼€å‘ã€‚</li><li>é¡ºåˆ©é€šè¿‡å®Œæ•´æ€§æµ‹è¯•å’Œå†’çƒŸæµ‹è¯•ä¹‹åæ‰ä¼šè¿›å…¥æ­£å¼æµ‹è¯•é˜¶æ®µã€‚</li></ul><p>è¿™ä¹ˆåšçš„ç›®çš„ä¹‹ä¸€å°±æ˜¯ä¸ºäº†é™ä½æµ‹è¯•å›¢é˜Ÿçš„å·¥ä½œè´Ÿæ‹…ï¼Œå› ä¸ºä»–ä»¬è¦å¯¹æ¥å¤šä¸ªå¼€å‘å›¢é˜Ÿçš„æµ‹è¯•ä»»åŠ¡ã€‚</p><p><br></p><h2 id="37-å®‰å…¨æµ‹è¯•-security-testing"><a href="#37-å®‰å…¨æµ‹è¯•-security-testing" class="headerlink" title="37) å®‰å…¨æµ‹è¯•(Security Testing)"></a>37) å®‰å…¨æµ‹è¯•(Security Testing)</h2><p><img src="/images/typeof-testing/sec.png" alt></p><p>å®‰å…¨ä¹Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„å­¦ç§‘ï¼Œè€Œä¸”çŸ¥è¯†æ¯å¤©éƒ½åœ¨æ›´æ–°ï¼Œæ‰€ä»¥å®‰å…¨æµ‹è¯•ä¸€èˆ¬ç”±ç‰¹æ®Šçš„å®‰å…¨å›¢é˜Ÿæ‰§è¡Œï¼Œä»–ä»¬ä»¥å„ç§é»‘å®¢æ‰‹æ®µå¯¹ç³»ç»Ÿè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚</p><p>å®‰å…¨æµ‹è¯•æ—¨åœ¨ç¡®ä¿åº”ç”¨æˆ–ç½‘ç«™å…å—å†…éƒ¨å’Œå¤–éƒ¨å¨èƒçš„ä¾µå®³ã€‚è¿™ä¸ªæµ‹è¯•åŒ…æ‹¬é¢„é˜²æ¶æ„ç¨‹åºã€ç—…æ¯’ï¼› æ£€éªŒæˆæƒå’Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</p><p>å®ƒè¿˜ä¼šæ£€æŸ¥è½¯ä»¶å¯¹ä»»ä½•é»‘å®¢æ”»å‡»å’Œæ¶æ„ç¨‹åºçš„ååº”æ–¹å¼ï¼Œä»¥åŠåœ¨é­åˆ°é»‘å®¢æ”»å‡»åå¦‚ä½•ç»´æŠ¤è½¯ä»¶ä»¥ä¿æŠ¤æ•°æ®å®‰å…¨</p><p><br></p><h2 id="38-å†’çƒŸæµ‹è¯•-smoke-testing"><a href="#38-å†’çƒŸæµ‹è¯•-smoke-testing" class="headerlink" title="38) å†’çƒŸæµ‹è¯•(Smoke Testing)"></a>38) å†’çƒŸæµ‹è¯•(Smoke Testing)</h2><p><img src="/images/typeof-testing/note7.jpg" alt></p><p>å†’çƒŸæµ‹è¯•ï¼Œæ¯å½“å¼€å‘å›¢é˜Ÿæäº¤æ–°çš„æ„å»ºæ—¶ï¼Œè½¯ä»¶æµ‹è¯•å›¢é˜Ÿå°±ä¼šå…ˆéªŒè¯æ„å»º, å¹¶ç¡®ä¿ä¸å­˜åœ¨é‡å¤§é—®é¢˜, å¦‚æœå­˜åœ¨é‡å¤§é—®é¢˜ä¼šç›´æ¥æ‰“å›å¼€å‘å›¢é˜Ÿ.</p><p>å¦‚ä½•é€šä¿—åœ°ç†è§£å†’çƒŸæµ‹è¯•å‘¢ï¼Ÿè¿™ä¸ªå±äºæ¥æºäºç¡¬ä»¶è¡Œä¸šï¼Œå¯¹ä¸€ä¸ªç¡¬ä»¶æˆ–ç¡¬ä»¶ç»„ä»¶è¿›è¡Œæ›´æ”¹æˆ–ä¿®å¤åï¼Œç›´æ¥ç»™è®¾å¤‡åŠ ç”µã€‚å¦‚æœæ²¡æœ‰å†’çƒŸï¼Œåˆ™è¯¥ç»„ä»¶å°±é€šè¿‡äº†æµ‹è¯•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç»™ä¸‰æ˜ŸNote7åŠ ç”µï¼Œå¦‚æœæ²¡çˆ†ç‚¸ï¼Œå°±è¯´æ˜é€šè¿‡äº†â€˜å†’çƒŸæµ‹è¯•â€™(æ„Ÿè§‰å½“æ‰‹æœºæµ‹è¯•è€…ä¸å®¹æ˜“ï¼Œå®¹æ˜“æœ‰ç”Ÿå‘½å±é™©ğŸ˜‚)?</p><p>æµ‹è¯•å›¢é˜Ÿåœ¨ç¡®ä¿æ„å»ºç¨³å®šåæ‰ä¼šè¿›ä¸€æ­¥æ‰§è¡Œè¯¦ç»†çš„æµ‹è¯•ã€‚ å†’çƒŸæ£€æŸ¥ä¼šæ£€æŸ¥æ„å»ºä¸­æ˜¯å¦å­˜åœ¨ä¸­æ–­ç¼ºé™·(stopper defect, å³å½±å“ç»§ç»­æµ‹è¯•çš„ç¼ºé™·)ï¼Œè¿™å°†é˜»æ­¢æµ‹è¯•å›¢é˜Ÿè¿›ä¸€æ­¥è¯¦ç»†æµ‹è¯•ã€‚ å³å¦‚æœæµ‹è¯•äººå‘˜å‘ç°ä¸»è¦åŠŸèƒ½ä¸èƒ½å·¥ä½œï¼Œä»–ä»¬ä¼šæ‹’ç»è¿™æ¬¡æ„å»ºï¼Œå¹¶é€€å›ç»™å¼€å‘å›¢é˜Ÿã€‚</p><p>å†’çƒŸæµ‹è¯•ä¸€èˆ¬åœ¨å›å½’æµ‹è¯•æˆ–å…¶ä»–è¯¦ç»†æµ‹è¯•ä¹‹å‰è¿›è¡Œ</p><p><br></p><h2 id="39-é™æ€æµ‹è¯•-static-testing"><a href="#39-é™æ€æµ‹è¯•-static-testing" class="headerlink" title="39) é™æ€æµ‹è¯•(Static Testing)"></a>39) é™æ€æµ‹è¯•(Static Testing)</h2><p><img src="/images/typeof-testing/review.jpg" alt></p><p>é™æ€æµ‹è¯•æœ‰ç‚¹ç±»ä¼¼äºä»£ç Reviewï¼Œåœ¨ä¸æ‰§è¡Œä»»ä½•ä»£ç çš„æƒ…å†µä¸‹æ‰§è¡Œ(ä¹Ÿå°±æ˜¯ä¸è¿è¡Œåº”ç”¨)ï¼Œå®ƒæ¶‰åŠå¯¹å¯äº¤ä»˜æˆæœå®¡æŸ¥(inspection)ã€reviewå’Œæ¼”ç»ƒ(walkthrough). æ¯”å¦‚æ£€æŸ¥ä»£ç è¯­æ³•ã€å‘½åçº¦å®šã€é¡¹ç›®ç»„ç»‡ã€‚</p><p>é™æ€æµ‹è¯•ä¸ä»…é€‚ç”¨äºä»£ç , ä¹Ÿé€‚ç”¨äºæµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•è®¡åˆ’å’Œè®¾è®¡æ–‡æ¡£. å¦‚æœåœ¨é™æ€æµ‹è¯•é˜¶æ®µå‘ç°ç¼ºé™·ï¼Œå¯ä»¥å°†ç¼ºé™·æˆæœ¬é™åˆ°æœ€ä½ã€‚æ¯”å¦‚åœ¨è®¾è®¡é˜¶æ®µå°±å‘ç°é—®é¢˜ï¼Œç›¸æ¯”åˆ°å¼€å‘é˜¶æ®µç”šè‡³åˆ°ç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜è¦å¥½è§£å†³</p><p>ä¸¾å‰ç«¯çš„ä¾‹å­ï¼Œé™æ€æµ‹è¯•å¯èƒ½åŒ…æ‹¬:</p><ul><li>ä½¿ç”¨Lintå·¥å…·å¯¹ç¨‹åºè¿›è¡Œè§„èŒƒæ£€æŸ¥ï¼Œç›¸å…³çš„å·¥å…·æœ‰ESLintã€TSLintã€Stylintç­‰, ç”šè‡³Typescriptè¿™äº›ç±»å‹æ£€æŸ¥å™¨ä¹Ÿå¯ä»¥å½’åˆ°è¿™ä¸ªèŒƒç•´</li><li>ä»£ç Reviewã€‚æœ‰ä¸€äº›é—®é¢˜æ˜¯æ— æ³•é€šè¿‡Lintå·¥å…·è¦†ç›–çš„ï¼Œæ¯”å¦‚ä»£ç é€»è¾‘ã€å¼‚å¸¸æ•è·ã€é¡¹ç›®ç»„ç»‡ã€å†…å­˜æ³„éœ²ç­‰ç­‰ï¼Œè¿™äº›éœ€è¦äººå·¥è¿›è¡Œèµ°æŸ¥Review</li><li>æ£€æŸ¥ä»£ç æ˜¯å¦ä¸è®¾è®¡ä¸€è‡´ï¼Œæ˜¯å¦ç¬¦åˆè½¯ä»¶éœ€æ±‚ã€æ¦‚è¦å’Œè¯¦ç»†è®¾è®¡ï¼Œè¿™ä¸ä»…å¯ä»¥çœ‹å‡ºä»£ç é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥æ›´æ—©å‘ç°éœ€æ±‚æˆ–è®¾è®¡æ˜¯å¦æ­£ç¡®ã€‚</li></ul><p><br></p><h2 id="40-å‹åŠ›æµ‹è¯•-stress-testing"><a href="#40-å‹åŠ›æµ‹è¯•-stress-testing" class="headerlink" title="40) å‹åŠ›æµ‹è¯•(Stress Testing)"></a>40) å‹åŠ›æµ‹è¯•(Stress Testing)</h2><p><img src="/images/typeof-testing/str.jpg" alt></p><p><strong>é€šè¿‡å‹åŠ›æµ‹è¯•ï¼Œæ¨¡æ‹Ÿç³»ç»Ÿå—åˆ°è¶…å‡ºå…¶è§„æ ¼çš„å‹åŠ›æ—¶å¤±è´¥çš„æ–¹å¼å’Œæ—¶é—´, æ‰¾å‡ºç³»ç»Ÿçš„å´©æºƒç‚¹</strong>. è¿™ä¸ªæµ‹è¯•åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹æ‰§è¡Œçš„ï¼Œä¾‹å¦‚å­˜å–è¶…è¿‡å®¹é‡é™åˆ¶çš„æ•°æ®ã€æ‰§è¡Œå¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢ã€è¿ç»­æš´åŠ›è¾“å…¥åˆ°ç³»ç»Ÿæˆ–åŠ è½½åˆ°æ•°æ®åº“ã€‚</p><p><br></p><h2 id="41-ç³»ç»Ÿæµ‹è¯•-system-testing"><a href="#41-ç³»ç»Ÿæµ‹è¯•-system-testing" class="headerlink" title="41) ç³»ç»Ÿæµ‹è¯•(System Testing)"></a>41) ç³»ç»Ÿæµ‹è¯•(System Testing)</h2><p>ç³»ç»Ÿæµ‹è¯•åœ¨å®Œæ•´çš„é›†æˆç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>ç³»ç»Ÿæµ‹è¯•ä¸€èˆ¬åœ¨é›†æˆæµ‹è¯•ä¹‹åè¿›è¡Œï¼Œé›†æˆæµ‹è¯•ä¹‹åç³»ç»Ÿæˆä¸ºäº†ä¸€ä¸ªæ•´ä½“ï¼Œç³»ç»Ÿæµ‹è¯•åœ¨è¿™ä¸ªåŸºç¡€ä¸Šã€åœ¨çœŸå®çš„è¿è¡Œç¯å¢ƒä¸­éªŒè¯ç³»ç»Ÿæ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚</strong>ã€‚ è¿™æ˜¯ä¸€ç§é»‘ç›’å‹æµ‹è¯•ï¼ŒåŸºäºæ€»ä½“éœ€æ±‚è§„èŒƒï¼Œæ¶µç›–ç³»ç»Ÿçš„æ‰€æœ‰ç»„åˆéƒ¨åˆ†ã€‚</p><p>ç³»ç»Ÿæµ‹è¯•å…¶å®ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æµ‹è¯•æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ä¸ªæµ‹è¯•é˜¶æ®µã€‚ è¿™ä¸ªé˜¶æ®µä¼šè¿›è¡Œå¾ˆå¤šç§æµ‹è¯•ï¼Œä¸€èˆ¬å…¬å¸çš„æµ‹è¯•å›¢é˜Ÿçš„å·¥ä½œå°±é›†ä¸­åœ¨è¿™ä¸€å—ã€‚ ä¸€èˆ¬åŒ…å«:</p><ul><li><strong>åŠŸèƒ½æµ‹è¯•</strong>: å³ä¸Šé¢è®²çš„ï¼Œä»ç³»ç»Ÿçš„æ•´ä½“ä¸Šæµ‹è¯•æ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚</li><li><strong>å„ç§éåŠŸèƒ½æµ‹è¯•</strong>ï¼šä¾‹å¦‚æ¢å¤æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€å®‰å…¨æµ‹è¯•ç­‰ç­‰ã€‚</li></ul><p>å½’çº³ä¸€ä¸‹<strong>ç³»ç»Ÿæµ‹è¯•çš„ç›®çš„</strong>:</p><ul><li>ç¡®ä¿åº”ç”¨<strong>ä½œä¸ºä¸€ä¸ªæ•´ä½“</strong>å¯ä»¥è‰¯å¥½åœ°è¿è¡Œ.</li><li>ç¡®ä¿åº”ç”¨ç¬¦åˆä¸šåŠ¡éœ€æ±‚</li><li>ç¡®ä¿åº”ç”¨åœ¨çœŸå®çš„ç¯å¢ƒå¯ä»¥è‰¯å¥½åœ°è¿è¡Œã€‚æ¯”å¦‚è¿›è¡Œä¸€äº›éåŠŸèƒ½æµ‹è¯•ï¼ŒéªŒè¯ç³»ç»Ÿçš„å¥å£®æ€§</li></ul><p>å…¶å®ç³»ç»Ÿæµ‹è¯•å’Œä¸Šæ–‡è¯´çš„ç«¯åˆ°ç«¯æµ‹è¯•å¾ˆåƒï¼Œå®ƒä»¬è¦æ±‚ç³»ç»Ÿä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥ç®€å•å±•å¼€å¯¹æ¯”ä¸€ä¸‹</p><table><thead><tr><th></th><th>ç³»ç»Ÿæµ‹è¯•</th><th>ç«¯åˆ°ç«¯æµ‹è¯•</th></tr></thead><tbody><tr><td>æµ‹è¯•èŒƒå›´</td><td>ä¸€èˆ¬é’ˆå¯¹è¢«æµ‹åº”ç”¨æœ¬èº«</td><td>ä¸€èˆ¬é’ˆå¯¹è¢«æµ‹åº”ç”¨ä»¥åŠå…¶ä¾èµ–çš„å…¶ä»–ç³»ç»Ÿã€‚æ­£å¦‚å…¶åï¼Œç«¯åˆ°ç«¯ï¼Œå³ä»ä¸€ç«¯ç‚¹åˆ°å¦ä¸€ç«¯ç‚¹ã€‚é‡ç‚¹å…³æ³¨å‰ç«¯ã€åç«¯ä»¥åŠä¸­é—´ä»¶ä¹‹é—´çš„å¤„ç†æµç¨‹</td></tr><tr><td>æµ‹è¯•ç±»å‹</td><td>åŒ…å«åŠŸèƒ½æµ‹è¯•å’ŒéåŠŸèƒ½æµ‹è¯•</td><td>ä¸€èˆ¬æ¶µç›–æ‰€æœ‰æºç³»ç»Ÿå’Œç›®æ ‡ç³»ç»Ÿä¹‹é—´çš„æ¥å£çº§åˆ«çš„æµ‹è¯•</td></tr><tr><td>æµ‹è¯•æ—¶æœº</td><td>ä¸€èˆ¬åœ¨é›†æˆæµ‹è¯•ä¹‹å</td><td>ä¸€èˆ¬åœ¨ç³»ç»Ÿæµ‹è¯•ä¹‹å</td></tr></tbody></table><p><br></p><h2 id="42-å•å…ƒæµ‹è¯•-unit-testing"><a href="#42-å•å…ƒæµ‹è¯•-unit-testing" class="headerlink" title="42) å•å…ƒæµ‹è¯•(Unit Testing)"></a>42) å•å…ƒæµ‹è¯•(Unit Testing)</h2><p><img src="/images/typeof-testing/unit-test.png" alt></p><p><strong>æµ‹è¯•ç‹¬ç«‹çš„è½¯ä»¶å•å…ƒæˆ–æ¨¡å—ç§°ä¸ºå•å…ƒæµ‹è¯•</strong>ã€‚å®ƒé€šå¸¸ç”±å¼€å‘è€…å®Œæˆï¼Œè€Œä¸æ˜¯ç”±æµ‹è¯•äººå‘˜å®Œæˆï¼Œå› ä¸ºå®ƒéœ€è¦è¯¦ç»†äº†è§£å†…éƒ¨ç¨‹åºè®¾è®¡å’Œä»£ç ã€‚</p><p>å•å…ƒæµ‹è¯•æ˜¯å’Œæˆ‘ä»¬å¼€å‘è€…æœ€å¯†åˆ‡ç›¸å…³çš„æµ‹è¯•ç±»å‹ã€‚å®ƒçš„æµ‹è¯•å¯¹è±¡æ˜¯è½¯ä»¶å•å…ƒã€‚<strong>è½¯ä»¶å•å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°/æ–¹æ³•ã€ä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªGUIç»„ä»¶ç­‰</strong>ã€‚</p><p>è¿™æ˜¯ä¸€ç§ç™½ç›’æµ‹è¯•ï¼Œæ‰€ä»¥è¦æ±‚ç”±å¼€å‘è€…è‡ªå·±è¿›è¡Œï¼Œå› ä¸ºåªæœ‰å¼€å‘è€…æ‰çŸ¥é“å•å…ƒçš„å†…éƒ¨å®ç°ã€‚<strong>å•å…ƒæµ‹è¯•ä¸€èˆ¬ä¼šä½¿ç”¨æµ‹è¯•è¦†ç›–ç‡æ¥éªŒè¯å•å…ƒæµ‹è¯•çš„å®Œæˆåº¦</strong>. </p><p>å‰ç«¯å¸¸è§çš„å•å…ƒæµ‹è¯•å·¥å…·æœ‰Jestã€Mochaã€Jasmineç­‰ç­‰. ä¸‹é¢æ˜¯å…¸å‹çš„BDDé£æ ¼çš„å•å…ƒæµ‹è¯•ç»„ç»‡:</p><p><img src="/images/typeof-testing/bdd.png" alt></p><p><br></p><h2 id="43-å¯ç”¨æ€§æµ‹è¯•-usability-testing"><a href="#43-å¯ç”¨æ€§æµ‹è¯•-usability-testing" class="headerlink" title="43) å¯ç”¨æ€§æµ‹è¯•(Usability Testing)"></a>43) å¯ç”¨æ€§æµ‹è¯•(Usability Testing)</h2><p>å¯ç”¨æ€§æµ‹è¯•ç”¨äºæ£€æµ‹åº”ç”¨çš„ç”¨æˆ·å‹å¥½ç¨‹åº¦(User-friendliness). å®ƒä¼šéªŒè¯æ–°ç”¨æˆ·å—å¯ä»¥è½»æ¾ç†è§£åº”ç”¨æµç¨‹ï¼Œå¦‚æœç”¨æˆ·é™·å…¥éº»çƒ¦ï¼Œæµ‹è¯•äººå‘˜è¦è®°å½•å¥½å¹¶æä¾›å¸®åŠ©ã€‚å¯ä»¥è®¤ä¸ºå¯ç”¨æ€§æµ‹è¯•æ˜¯åœ¨æ£€æŸ¥ç³»ç»Ÿçš„å¯¼èˆªæ€§(navigation)</p><p><br></p><h2 id="44-æ¼æ´æµ‹è¯•-vulnerability-testing"><a href="#44-æ¼æ´æµ‹è¯•-vulnerability-testing" class="headerlink" title="44) æ¼æ´æµ‹è¯•(Vulnerability Testing)"></a>44) æ¼æ´æµ‹è¯•(Vulnerability Testing)</h2><p>æ¼æ´æµ‹è¯•ï¼Œæ¶‰åŠè¯†åˆ«è½¯ä»¶ã€ç¡¬ä»¶å’Œç½‘ç»œä¸­çš„æ¼æ´ã€‚å¦‚æœæ¼æ´å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œæˆ–è€…å®¹æ˜“å—åˆ°ç—…æ¯’å’Œè •è™«æ„ŸæŸ“ï¼Œé»‘å®¢æˆ–æ¶æ„ç¨‹åºå°±å¯ä»¥æ§åˆ¶ç³»ç»Ÿã€‚</p><p>å› æ­¤æœ‰å¿…è¦åœ¨æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä¹‹å‰æ£€æŸ¥è¿™äº›ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ¼æ´ã€‚</p><p><br></p><h2 id="45-å®¹é‡æµ‹è¯•-volume-testing"><a href="#45-å®¹é‡æµ‹è¯•-volume-testing" class="headerlink" title="45) å®¹é‡æµ‹è¯•(Volume Testing)"></a>45) å®¹é‡æµ‹è¯•(Volume Testing)</h2><p>å®¹é‡æµ‹è¯•æ˜¯ç”±æ€§èƒ½æµ‹è¯•å›¢é˜Ÿæ‰§è¡Œçš„ä¸€ç§éåŠŸèƒ½æµ‹è¯•ã€‚å®¹é‡æµ‹è¯•ä¼šæ£€æŸ¥åº”ç”¨ç¨‹åºé‡åˆ°å¤§é‡çš„æ•°æ®æ—¶çš„ç³»ç»Ÿè¡Œä¸ºå’Œå“åº”æ—¶é—´ã€‚è¿™ç§å¤§é‡æ•°æ®å¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå¤„ç†æ—¶é—´çš„é€Ÿåº¦ã€‚</p><p><br></p><h2 id="46-ç™½ç›’æµ‹è¯•-white-box-testing"><a href="#46-ç™½ç›’æµ‹è¯•-white-box-testing" class="headerlink" title="46) ç™½ç›’æµ‹è¯•(White Box Testing)"></a>46) ç™½ç›’æµ‹è¯•(White Box Testing)</h2><p><img src="/images/typeof-testing/glassbox.jpg" alt></p><p>ç™½ç›’æµ‹è¯•, å®ƒä¹Ÿè¢«ç§°ä¸ºç»ç’ƒç›’æµ‹è¯•ã€ç»“æ„æµ‹è¯•ã€é€»è¾‘é©±åŠ¨æµ‹è¯•æˆ–åŸºäºä»£ç çš„æµ‹è¯•, åŸºäºåº”ç”¨ç¨‹åºä»£ç çš„å†…éƒ¨é€»è¾‘ã€‚å³æµ‹è¯•äººå‘˜åº”è¯¥çŸ¥é“å†…éƒ¨è½¯ä»¶å’Œä»£ç æ˜¯å¦‚ä½•å·¥ä½œçš„, å¯¹æ‰€æœ‰çš„é€»è¾‘è·¯å¾„è¿›è¡Œè¦†ç›–æµ‹è¯•ã€‚ä¸Šé¢æåˆ°çš„å•å…ƒæµ‹è¯•å’Œé™æ€æµ‹è¯•å°±æ˜¯å…¸å‹çš„ç™½ç›’æµ‹è¯•, åŸºæœ¬ä¸Šç™½ç›’æµ‹è¯•å¯ä»¥ç­‰ä»·äºå•å…ƒæµ‹è¯•</p><p><strong>é€»è¾‘è·¯å¾„åŒ…æ‹¬è¯­å¥è¦†ç›–ã€åˆ¤å®šè¦†ç›–ã€æ¡ä»¶è¦†ç›–ã€åˆ¤å®š/æ¡ä»¶è¦†ç›–ã€æ¡ä»¶ç»„åˆè¦†ç›–å’Œè·¯å¾„è¦†ç›–ç­‰ç­‰</strong>.</p><p><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="/images/typeof-testing/all.png" alt></p><p>ä¸Šé¢æåˆ°çš„è½¯ä»¶æµ‹è¯•ç±»å‹åªæ˜¯æµ‹è¯•ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®é™…æœ‰è¶…è¿‡100ç§çš„æµ‹è¯•ç±»å‹ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰æµ‹è¯•ç±»å‹éƒ½ä¼šè¢«æ‰€æœ‰é¡¹ç›®ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œåªæ˜¯åˆ—ä¸¾ä¸€äº›æ¯”è¾ƒå¸¸è§çš„è½¯ä»¶æµ‹è¯•ç±»å‹ã€‚</p><p>å¦å¤–ä¸åŒçš„ç»„ç»‡ä¸­å¯èƒ½ä¼šæœ‰ä¸åŒçš„å®šä¹‰æˆ–è¿‡ç¨‹ï¼Œä½†æ˜¯åŸºæœ¬æ¦‚å¿µåœ¨ä»»ä½•åœ°æ–¹éƒ½æ˜¯ç›¸åŒçš„ã€‚å½“é¡¹ç›®ã€éœ€æ±‚å’ŒèŒƒå›´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›æµ‹è¯•ç±»å‹ã€è¿‡ç¨‹åŠå…¶å®ç°æ–¹æ³•ä¼šä¸æ–­æ¼”å˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡é“¾æ¥: &lt;a href=&quot;https://www.softwaretestinghelp.com/types-of-software-testing/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Types Of Software Testing: 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½ å¯èƒ½ä¸çŸ¥é“çš„æµè§ˆå™¨å®æ—¶é€šä¿¡æ–¹æ¡ˆ</title>
    <link href="https://bobi.ink/2019/07/07/sockjs/"/>
    <id>https://bobi.ink/2019/07/07/sockjs/</id>
    <published>2019-07-06T16:00:00.000Z</published>
    <updated>2019-07-10T08:30:04.800Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ¢è®¨ç°é˜¶æ®µæµè§ˆå™¨ç«¯å¯è¡Œçš„å®æ—¶é€šä¿¡æ–¹æ¡ˆï¼Œä»¥åŠå®ƒä»¬çš„å‘å±•å†å²ã€‚</p><p>è¿™é‡Œä»¥<a href="https://github.com/sockjs/sockjs-client" target="_blank" rel="noopener"><code>sockjs</code></a>ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„æµè§ˆå™¨å®æ—¶é€šä¿¡åº“ï¼Œæä¾›äº†â€™ç±»Websocketâ€™ã€ä¸€è‡´æ€§ã€è·¨å¹³å°çš„APIï¼Œæ—¨åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´åˆ›å»ºä¸€ä¸ªä½å»¶è¿Ÿã€å…¨åŒå·¥ã€æ”¯æŒè·¨åŸŸçš„å®æ—¶é€šä¿¡ä¿¡é“. <strong>ä¸»è¦ç‰¹ç‚¹å°±æ˜¯ä»¿ç”ŸWebsocketï¼Œå®ƒä¼šä¼˜å…ˆä½¿ç”¨Websocketä½œä¸ºä¼ è¾“å±‚ï¼Œåœ¨ä¸æ”¯æŒWebSocketçš„ç¯å¢ƒå›é€€ä½¿ç”¨å…¶ä»–è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚XHR-Streamã€è½®è¯¢</strong>. </p><p>æ‰€ä»¥<code>sockjs</code>æœ¬èº«å°±æ˜¯æµè§ˆå™¨å®æ—¶é€šä¿¡æ–¹æ¡ˆçš„ç¼–å¹´å², æœ¬æ–‡ä¹Ÿæ˜¯æŒ‰ç…§ç”±æ–°åˆ°è€è¿™æ ·çš„é¡ºåºæ¥ä»‹ç»è¿™äº›è§£å†³æ–¹æ¡ˆ. </p><blockquote><p>ç±»ä¼¼sockjsçš„è§£å†³æ–¹æ¡ˆè¿˜æœ‰ <a href="https://socket.io/" target="_blank" rel="noopener">socket.io</a></p></blockquote><blockquote><p>å¦‚æœä½ è§‰å¾—æ–‡ç« ä¸é”™ï¼Œè¯·ä¸è¦åæƒœä½ çš„ç‚¹èµğŸ‘ï¼Œé¼“åŠ±ç¬”è€…å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« </p></blockquote><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#websocket">WebSocket</a></li><li><a href="#xhr-streaming">XHR-streaming</a></li><li><a href="#eventsource">EventSource</a></li><li><a href="#htmlfile">HtmlFile</a></li><li><a href="#polling">Polling</a></li><li><a href="#long-polling">Long polling</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><hr><p><br></p><h2 id="websocket"><a href="#websocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>WebSocketå…¶å®ä¸æ˜¯æœ¬æ–‡çš„ä¸»è§’ï¼Œè€Œä¸”ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ä»‹ç»WebSocketä¹‹å¤–çš„ä¸€äº›å›é€€æ–¹æ¡ˆï¼Œåœ¨æµè§ˆå™¨ä¸æ”¯æŒWebsocketçš„æƒ…å†µä¸‹, å¯ä»¥é€‰æ‹©å›é€€åˆ°è¿™äº›æ–¹æ¡ˆ.</p><p>åœ¨æ­¤ä»‹ç»Websocketä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€äº›HTTPçš„åŸºç¡€çŸ¥è¯†ï¼Œæ¯•ç«ŸWebSocketæœ¬èº«æ˜¯å€Ÿç”¨HTTPåè®®å®ç°çš„ã€‚</p><p>HTTPåè®®æ˜¯åŸºäºTCP/IPä¹‹ä¸Šçš„åº”ç”¨å±‚åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´HTTPåœ¨TCPè¿æ¥ä¸­è¿›è¡Œè¯·æ±‚å’Œå“åº”çš„ï¼Œ<strong>æµè§ˆå™¨ä¼šä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œè¯·æ±‚ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œåœ¨æœåŠ¡ç«¯å“åº”åå…³é—­è¿æ¥</strong>:</p><p><img src="/images/sockjs/base-http.png" alt></p><p>åæ¥äººä»¬å‘ç°ä¸ºæ¯ä¸ªHTTPè¯·æ±‚éƒ½å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œå¤ªæµªè´¹èµ„æºäº†ï¼Œèƒ½ä¸èƒ½ä¸è¦ç€æ€¥å…³é—­TCPè¿æ¥ï¼Œè€Œæ˜¯å°†å®ƒå¤ç”¨èµ·æ¥, åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­è¿›è¡Œå¤šæ¬¡è¯·æ±‚ã€‚</p><p><strong>è¿™å°±æœ‰äº†HTTPæŒä¹…è¿æ¥(HTTP persistent connection, ä¹Ÿç§°ä¸ºHTTP keep-alive), å®ƒåˆ©ç”¨åŒä¸€ä¸ªTCPè¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚/å“åº”ã€‚æŒä¹…è¿æ¥çš„æ–¹å¼å¯ä»¥å¤§å¤§å‡å°‘ç­‰å¾…æ—¶é—´, åŒæ–¹ä¸éœ€è¦é‡æ–°è¿è¡ŒTCPæ¡æ‰‹ï¼Œè¿™å¯¹å‰ç«¯é™æ€èµ„æºçš„åŠ è½½ä¹Ÿæœ‰å¾ˆå¤§æ„ä¹‰</strong>:</p><p><img src="/images/sockjs/http-keep-alive.png" alt></p><p>Ok, ç°åœ¨å›åˆ°WebSocket, <strong>æµè§ˆå™¨ç«¯ç”¨æˆ·ç¨‹åºå¹¶ä¸æ”¯æŒå’ŒæœåŠ¡ç«¯ç›´æ¥å»ºç«‹TCPè¿æ¥ï¼Œä½†æ˜¯ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šå»ºç«‹TCPè¿æ¥, TCPæ˜¯å¯é çš„ã€å…¨åŒå·¥çš„æ•°æ®é€šä¿¡é€šé“ï¼Œé‚£æˆ‘ä»¬ä½•ä¸ç›´æ¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œå®æ—¶é€šä¿¡ï¼Ÿ è¿™å°±æ˜¯Websocketçš„åŸç†!</strong> </p><p>æˆ‘ä»¬è¿™é‡Œé€šè¿‡ä¸€å¼ å›¾ï¼Œé€šä¿—åœ°ç†è§£ä¸€ä¸‹Websocketçš„åŸç†:</p><p><img src="/images/sockjs/websocket.png" alt></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œ<strong>WebSocketé™¤æœ€åˆå»ºç«‹è¿æ¥æ—¶éœ€è¦å€ŸåŠ©äºç°æœ‰çš„HTTPåè®®ï¼Œå…¶ä»–æ—¶å€™ç›´æ¥åŸºäºTCPå®Œæˆé€šä¿¡</strong>ã€‚è¿™æ˜¯æµè§ˆå™¨ä¸­æœ€é è¿‘å¥—æ¥å­—çš„APIï¼Œå¯ä»¥å®æ—¶å’ŒæœåŠ¡ç«¯è¿›è¡Œå…¨åŒå·¥é€šä¿¡. WebSocketç›¸æ¯”ä¼ ç»Ÿçš„æµè§ˆå™¨çš„<a href="https://en.wikipedia.org/wiki/Comet_(programming" target="_blank" rel="noopener">Comet</a>)(ä¸‹æ–‡ä»‹ç»)æŠ€æœ¯, æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼š</p><ul><li>æ›´å¼ºçš„å®æ—¶æ€§ã€‚åŸºäºTCPåè®®çš„å…¨åŒå·¥é€šä¿¡</li><li>æ›´é«˜æ•ˆã€‚ä¸€æ–¹é¢æ˜¯æ•°æ®åŒ…ç›¸å¯¹è¾ƒå°ï¼Œå¦ä¸€æ–¹é¢ç›¸æ¯”ä¼ ç»ŸXHR-Streamingå’Œè½®è¯¢æ–¹å¼æ›´åŠ é«˜æ•ˆï¼Œä¸éœ€è¦é‡å¤å»ºç«‹TCPè¿æ¥</li><li>æ›´å¥½çš„äºŒè¿›åˆ¶æ”¯æŒã€‚ Websocketå®šä¹‰äº†äºŒè¿›åˆ¶å¸§ï¼Œç›¸å¯¹HTTPï¼Œå¯ä»¥æ›´è½»æ¾åœ°å¤„ç†äºŒè¿›åˆ¶å†…å®¹</li><li>ä¿æŒè¿æ¥çŠ¶æ€ã€‚ ç›¸æ¯”HTTPæ— çŠ¶æ€çš„åè®®ï¼ŒWebSocketåªéœ€è¦åœ¨å»ºç«‹è¿æ¥æ—¶æºå¸¦è®¤è¯ä¿¡æ¯ï¼Œåç»­çš„é€šä¿¡éƒ½åœ¨è¿™ä¸ªä¼šè¯å†…è¿›è¡Œ</li><li>å¯ä»¥æ”¯æŒæ‰©å±•ã€‚Websocketå®šä¹‰äº†æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•åè®®ã€å®ç°éƒ¨åˆ†è‡ªå®šä¹‰çš„å­åè®®ã€‚å¦‚éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒå‹ç¼©ç­‰</li></ul><p><br></p><p>å®ƒçš„æ¥å£ä¹Ÿéå¸¸ç®€å•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8080/socket'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line">ws.onerror = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123; ... &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥å…³é—­</span></span><br><span class="line">ws.onclose = <span class="function"><span class="params">()</span> =&gt;</span> &#123; ... &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥å»ºç«‹</span></span><br><span class="line">ws.onopen = <span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">  ws.send(<span class="string">"ping"</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">ws.onmessage = <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123; </span><br><span class="line">  <span class="keyword">if</span>(msg.data <span class="keyword">instanceof</span> Blob) &#123; </span><br><span class="line">  <span class="comment">// å¤„ç†äºŒè¿›åˆ¶ä¿¡æ¯</span></span><br><span class="line">    processBlob(msg.data);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line">    processText(msg.data); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸ä¼šæ·±å…¥è§£æWebsocketçš„åè®®ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹ä¸‹åˆ—æ–‡ç« :</p><ul><li><a href="https://zh.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener">WebSocket</a></li><li><a href="https://mp.weixin.qq.com/s/7aXMdnajINt0C5dcJy2USg?" target="_blank" rel="noopener">WebSocket æµ…æ</a></li><li><a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">é˜®ä¸€å³°ï¼šWebSocket æ•™ç¨‹</a></li></ul><p><br></p><p>å¦‚æœä¸è€ƒè™‘ä½ç‰ˆæœ¬IEï¼ŒåŸºæœ¬ä¸ŠWebSocketä¸ä¼šæœ‰ä»€ä¹ˆå…¼å®¹æ€§ä¸Šé¢çš„é¡¾è™‘. ä¸‹é¢åˆ—ä¸¾äº†Websocketä¸€äº›å¸¸è§çš„é—®é¢˜, å½“æ— æ³•æ­£å¸¸ä½¿ç”¨Websocketæ—¶ï¼Œå¯ä»¥åˆ©ç”¨sockjsæˆ–è€…socket.ioè¿™äº›æ–¹æ¡ˆå›é€€åˆ°ä¼ ç»Ÿçš„CometæŠ€æœ¯æ–¹æ¡ˆ.</p><ol><li>æµè§ˆå™¨å…¼å®¹æ€§ã€‚<ul><li>IE10ä»¥ä¸‹ä¸æ”¯æŒ</li><li>Safari ä¸‹ä¸å…è®¸ä½¿ç”¨éæ ‡å‡†æ¥å£å»ºç«‹è¿æ¥</li></ul></li><li>å¿ƒè·³. WebSocketæœ¬èº«ä¸ä¼šç»´æŠ¤å¿ƒè·³æœºåˆ¶ï¼Œä¸€äº›Websocketå®ç°åœ¨ç©ºé—²ä¸€æ®µæ—¶é—´ä¼šè‡ªåŠ¨æ–­å¼€ã€‚æ‰€ä»¥sockjsè¿™äº›åº“ä¼šå¸®ä½ ç»´æŠ¤å¿ƒè·³</li><li>ä¸€äº›è´Ÿè½½å‡è¡¡æˆ–ä»£ç†ä¸æ”¯æŒWebsocketã€‚</li><li>ä¼šè¯å’Œæ¶ˆæ¯é˜Ÿåˆ—ç»´æŠ¤ã€‚è¿™äº›ä¸æ˜¯Websocketåè®®çš„èŒè´£ï¼Œè€Œæ˜¯åº”ç”¨çš„èŒè´£ã€‚sockjsä¼šä¸ºæ¯ä¸ªWebsocketè¿æ¥ç»´æŠ¤ä¸€ä¸ªä¼šè¯ï¼Œä¸”è¿™ä¸ªä¼šè¯é‡Œé¢ä¼šç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå½“Websocketæ„å¤–æ–­å¼€æ—¶ï¼Œä¸è‡³äºä¸¢å¤±æ•°æ®</li></ol><p><br></p><hr><p><br></p><h2 id="xhr-streaming"><a href="#xhr-streaming" class="headerlink" title="XHR-streaming"></a>XHR-streaming</h2><p>XHR-Streming, ä¸­æ–‡åç§°â€˜XHRæµâ€™, è¿™æ˜¯WebSocketçš„æœ€ä½³æ›¿è¡¥æ–¹æ¡ˆ. XHR-streamingçš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼š<strong>æœåŠ¡ç«¯ä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç (Chunked transfer encoding)çš„HTTPä¼ è¾“æœºåˆ¶è¿›è¡Œå“åº”ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯ä¸ç»ˆæ­¢HTTPå“åº”æµï¼Œè®©HTTPå§‹ç»ˆå¤„äºæŒä¹…è¿æ¥çŠ¶æ€ï¼Œå½“æœ‰æ•°æ®éœ€è¦å‘é€ç»™å®¢æˆ·ç«¯æ—¶å†è¿›è¡Œå†™å…¥æ•°æ®</strong>ã€‚</p><p>æ²¡ç†è§£ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥, å…ˆæ¥çœ‹ä¸€ä¸‹æ­£å¸¸çš„HTTPè¯·æ±‚å¤„ç†æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Node.jsä»£ç </span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>, <span class="comment">// è®¾ç½®å†…å®¹æ ¼å¼</span></span><br><span class="line">    <span class="string">'Content-Length'</span>: <span class="number">11</span>, <span class="comment">// è®¾ç½®å†…å®¹é•¿åº¦</span></span><br><span class="line">  &#125;)</span><br><span class="line">  res.end(<span class="string">'hello world'</span>) <span class="comment">// å“åº” </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¼šç«‹å³æ¥æ”¶åˆ°å“åº”:</p><p><img src="/images/sockjs/http-req.png" alt></p><p><br></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81" target="_blank" rel="noopener"><strong>åˆ†å—ä¼ è¾“ç¼–ç </strong></a>å‘¢?</p><p><strong>åœ¨HTTP/1.0ä¹‹å‰, å“åº”æ˜¯å¿…é¡»ä½œä¸ºä¸€æ•´å—æ•°æ®è¿”å›å®¢æˆ·ç«¯çš„(å¦‚ä¸Šä¾‹)ï¼Œè¿™è¦æ±‚æœåŠ¡ç«¯åœ¨å‘é€å“åº”ä¹‹å‰å¿…é¡»è®¾ç½®<code>Content-Length</code>, æµè§ˆå™¨çŸ¥é“æ•°æ®çš„å¤§å°åæ‰èƒ½ç¡®å®šå“åº”çš„ç»“æŸæ—¶é—´</strong>ã€‚è¿™è®©æœåŠ¡å™¨å“åº”åŠ¨æ€çš„å†…å®¹å˜å¾—éå¸¸ä½æ•ˆï¼Œå®ƒå¿…é¡»ç­‰å¾…æ‰€æœ‰åŠ¨æ€å†…å®¹ç”Ÿæˆå®Œï¼Œå†è®¡ç®—Content-Length, æ‰å¯ä»¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå“åº”çš„å†…å®¹ä½“ç§¯å¾ˆå¤§ï¼Œéœ€è¦å ç”¨å¾ˆå¤šå†…å­˜ç©ºé—´.</p><p><strong>HTTP/1.1å¼•å…¥äº†<code>Transfer-Encoding: chunked;</code>æŠ¥å¤´ã€‚ å®ƒå…è®¸æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯åº”ç”¨çš„æ•°æ®å¯ä»¥åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†, å¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªå—å‘é€ï¼Œè¿™æ ·æœåŠ¡å™¨å¯ä»¥å‘é€æ•°æ®è€Œä¸éœ€è¦æå‰è®¡ç®—å‘é€å†…å®¹çš„æ€»å¤§å°</strong>ã€‚</p><p><strong>æœ‰äº†åˆ†å—ä¼ è¾“æœºåˆ¶åï¼ŒåŠ¨æ€ç”Ÿæˆå†…å®¹çš„æœåŠ¡å™¨å°±å¯ä»¥ç»´æŒHTTPé•¿è¿æ¥, ä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨å“åº”æµä¸ç»“æŸï¼ŒTCPè¿æ¥å°±ä¸ä¼šæ–­å¼€</strong>. </p><p><br></p><p>ç°åœ¨æˆ‘ä»¬åˆ‡æ¢ä¸ºåˆ†å—ä¼ è¾“ç¼–ç æ¨¡å¼ï¼Œ ä¸”æˆ‘ä»¬ä¸ç»ˆæ­¢å“åº”æµï¼Œçœ‹ä¼šæœ‰ä»€ä¹ˆæƒ…å†µ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></span><br><span class="line">    <span class="comment">// 'Content-Length': 11, // ğŸ”´å°†Content-LengthæŠ¥å¤´å»æ‰ï¼ŒNode.jsé»˜è®¤å°±æ˜¯ä½¿ç”¨åˆ†å—ç¼–ç ä¼ è¾“çš„</span></span><br><span class="line">  &#125;)</span><br><span class="line">  res.write(<span class="string">'hello world'</span>)</span><br><span class="line">  <span class="comment">// res.end() // ğŸ”´ä¸ç»ˆæ­¢è¾“å‡ºæµ</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°è¯·æ±‚ä¼šä¸€ç›´å¤„äºPendingçŠ¶æ€(ç»¿è‰²ä¸‹è½½å›¾æ ‡)ï¼Œ<strong>é™¤éå‡ºç°å¼‚å¸¸ã€æœåŠ¡å™¨å…³é—­æˆ–æ˜¾å¼å…³é—­è¿æ¥(æ¯”å¦‚è®¾ç½®è¶…æ—¶æœºåˆ¶)ï¼Œè¯·æ±‚æ˜¯æ°¸è¿œä¸ä¼šç»ˆæ­¢çš„ã€‚ä½†æ˜¯å³ä½¿å¤„äºPendingçŠ¶æ€å®¢æˆ·ç«¯è¿˜æ˜¯å¯ä»¥æ¥æ”¶æ•°æ®ï¼Œä¸å¿…ç­‰å¾…è¯·æ±‚ç»“æŸ</strong>:</p><p><img src="/images/sockjs/http-pending-req.png" alt></p><p><br></p><p>åŸºäºè¿™ä¸ªåŸç†æˆ‘ä»¬å†æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ping-pongæœåŠ¡å™¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/ping'</span>) &#123;</span><br><span class="line">    <span class="comment">// pingè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (pendingResponse == <span class="literal">null</span>) &#123;</span><br><span class="line">      res.writeHead(<span class="number">500</span>);</span><br><span class="line">      res.write(<span class="string">'session not found'</span>);</span><br><span class="line">      res.end();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(<span class="number">200</span>)</span><br><span class="line">    res.end()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»™å®¢æˆ·ç«¯æ¨æµ</span></span><br><span class="line">    pendingResponse.write(<span class="string">'pong\n'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜å¥æŸ„</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(<span class="string">'welcome to ping\n'</span>);</span><br><span class="line">    pendingResponse = res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨å¦ä¸€ä¸ªçª—å£è®¿é—®<code>/ping</code>è·¯å¾„ï¼š</p><p><img src="/images/sockjs/http-stream-ping.png" alt></p><p>Ok! è¿™å°±æ˜¯XHR-Streaming!</p><p><br></p><p>é‚£ä¹ˆAjaxæ€ä¹ˆæ¥æ”¶è¿™äº›æ•°æ®å‘¢ï¼Ÿ â‘ ä¸€ç§åšæ³•æ˜¯åœ¨<code>XMLHttpRequest</code>çš„<code>onreadystatechange</code>äº‹ä»¶å¤„ç†å™¨ä¸­åˆ¤æ–­<code>readyState</code>æ˜¯å¦ç­‰äº<code>XMLHttpRequest.LOADING</code>ï¼›â‘¡å¦å¤–ä¸€ç§åšæ³•æ˜¯åœ¨<code>xhr.onprogress</code>äº‹ä»¶å¤„ç†å™¨ä¸­å¤„ç†ã€‚ä¸‹é¢æ˜¯pingå®¢æˆ·ç«¯å®ç°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.onprogress = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„responseTextæ˜¯è·å–æœåŠ¡ç«¯å‘é€çš„æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœè¦è·å–æœªè¯»æ•°æ®ï¼Œåˆ™éœ€è¦è¿›è¡Œåˆ’åˆ†</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'progress'</span>, xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, HOST);</span><br><span class="line">  xhr.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ping</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, HOST + <span class="string">'/ping'</span>);</span><br><span class="line">  xhr.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">listen();</span><br><span class="line">setInterval(ping, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><p><br></p><p>æ…¢ç€ï¼Œä¸è¦é«˜å…´å¾—å¤ªæ—©ğŸ˜°. å¦‚æœè¿è¡Œä¸Šé¢çš„ä»£ç ä¼šå‘ç°<code>onprogress</code>å¹¶æ²¡æœ‰è¢«æ­£å¸¸çš„è§¦å‘, å…·ä½“åŸå› ç¬”è€…ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œæˆ‘å‘ç°sockjsçš„æœåŠ¡å™¨æºç é‡Œé¢ä¼šé¢„å…ˆå†™å…¥2049ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸è§¦å‘onprogressäº‹ä»¶äº†:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/ping'</span>) &#123;</span><br><span class="line">    <span class="comment">// pingè¯·æ±‚</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜å¥æŸ„</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(<span class="built_in">Array</span>(<span class="number">2049</span>).join(<span class="string">'h'</span>) + <span class="string">'\n'</span>);</span><br><span class="line">    pendingResponse = res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>æœ€åå†å›¾è§£ä¸€ä¸‹XHR-streamingçš„åŸç†:</p><p><img src="/images/sockjs/xhr-stream.png" alt></p><p>æ€»ç»“ä¸€ä¸‹XHR-Streamingçš„ç‰¹ç‚¹:</p><ul><li>åˆ©ç”¨åˆ†å—ä¼ è¾“ç¼–ç æœºåˆ¶å®ç°æŒä¹…åŒ–è¿æ¥(persistent connection): æœåŠ¡å™¨ä¸å…³é—­å“åº”æµï¼Œè¿æ¥å°±ä¸ä¼šå…³é—­</li><li>å•å·¥(unidirectional): åªå…è®¸æœåŠ¡å™¨å‘æµè§ˆå™¨å•å‘çš„æ¨é€æ•°æ®</li></ul><p><strong>é€šè¿‡XHR-Streamingï¼Œå¯ä»¥å…è®¸æœåŠ¡ç«¯è¿ç»­åœ°å‘é€æ¶ˆæ¯ï¼Œæ— éœ€æ¯æ¬¡å“åº”åå†å»å»ºç«‹ä¸€ä¸ªè¿æ¥, æ‰€ä»¥å®ƒæ˜¯é™¤äº†Websocketä¹‹å¤–æœ€ä¸ºé«˜æ•ˆçš„å®æ—¶é€šä¿¡æ–¹æ¡ˆ. ä½†å®ƒä¹Ÿå¹¶ä¸æ˜¯å®Œç¾æ— ç¼º</strong>ã€‚</p><p>æ¯”å¦‚XHR-streamingè¿æ¥çš„æ—¶é—´è¶Šé•¿ï¼Œæµè§ˆå™¨ä¼šå ç”¨è¿‡å¤šå†…å­˜ï¼Œè€Œä¸”åœ¨æ¯ä¸€æ¬¡æ–°çš„æ•°æ®åˆ°æ¥æ—¶ï¼Œéœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œåˆ’åˆ†ï¼Œå‰”é™¤æ‰å·²ç»æ¥æ”¶çš„æ•°æ®. å› æ­¤sockjså¯¹å®ƒè¿›è¡Œäº†ä¸€ç‚¹ä¼˜åŒ–, ä¾‹å¦‚sockjsé»˜è®¤åªå…è®¸æ¯ä¸ªxhr-streamingè¿æ¥è¾“å‡º128kbæ•°æ®ï¼Œè¶…è¿‡è¿™ä¸ªå¤§å°æ—¶ä¼šå…³é—­è¾“å‡ºæµï¼Œè®©æµè§ˆå™¨é‡æ–°å‘èµ·è¯·æ±‚.</p><p><br></p><hr><p><br></p><h2 id="eventsource"><a href="#eventsource" class="headerlink" title="EventSource"></a>EventSource</h2><p>äº†è§£äº†XHR-Streaming, å°±ä¼šè§‰å¾—<a href="https://developer.mozilla.org/zh-CN/docs/Server-sent_events/EventSource" target="_blank" rel="noopener"><code>EventSource</code></a>å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œç©æ„: å®ƒå°±æ˜¯ä¸Šé¢è®²çš„<code>XHR-streaming</code>, åªä¸è¿‡æµè§ˆå™¨ç»™å®ƒæä¾›äº†æ ‡å‡†çš„APIå°è£…å’Œåè®®, ä½ æŠ“åŒ…ä¸€çœ‹å’ŒXHR-streamingæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«:</p><p><img src="/images/sockjs/eventsource.png" alt></p><p><br></p><p>ä¸Šé¢å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„<code>Accept</code>ä¸º<code>text/event-stream</code>, ä¸”æœåŠ¡ç«¯å†™å…¥çš„æ•°æ®éƒ½æœ‰æ ‡å‡†çš„çº¦å®š, å³è½½è·éœ€è¦è¿™æ ·ç»„ç»‡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="string">`data: <span class="subst">$&#123;payload&#125;</span>\r\n\r\n`</span></span><br></pre></td></tr></table></figure><p><br></p><p>EventSourceçš„APIå’ŒWebsocketç±»ä¼¼, å®ä¾‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> evtSource = <span class="keyword">new</span> EventSource(<span class="string">'sse.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æ‰“å¼€</span></span><br><span class="line">evtSource.onopen = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å—æ¶ˆæ¯</span></span><br><span class="line">evtSource.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"message: "</span> + e.data)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…³é—­æµ</span></span><br><span class="line">  evtSource.close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚å¸¸</span></span><br><span class="line">evtSource.onerror = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å› ä¸ºæ˜¯æ ‡å‡†çš„ï¼Œæµè§ˆå™¨è°ƒè¯•ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æŠ“åŒ…å·¥å…·:</p><p><img src="/images/sockjs/eventsource-inspect.png" alt></p><p><br></p><hr><p><br></p><h2 id="htmlfile"><a href="#htmlfile" class="headerlink" title="HtmlFile"></a>HtmlFile</h2><p>è¿™æ˜¯ä¸€ç§å¤è€çš„â€˜ç§˜æœ¯â€™ğŸ˜‚ï¼Œè™½ç„¶æˆ‘ä»¬å¯èƒ½æ°¸è¿œéƒ½ä¸ä¼šå†ç”¨åˆ°å®ƒï¼Œä½†æ˜¯å®ƒçš„å®ç°æ–¹å¼æ¯”è¾ƒæœ‰æ„æ€(ç±»ä¼¼äºJSONPè¿™ç§é»‘ç§‘æŠ€), æ‰€ä»¥è¿˜æ˜¯å€¼å¾—è®²ä¸€ä¸‹ã€‚</p><p>HtmlFileçš„å¦ä¸€ä¸ªåå­—å«åš<code>æ°¸ä¹…å¸§(forever-frame)</code>, é¡¾åæ€ä¹‰, æµè§ˆå™¨ä¼šæ‰“å¼€ä¸€ä¸ªéšè—çš„iframeï¼Œè¿™ä¸ªiframeä¼šè¯·æ±‚ä¸€ä¸ªåˆ†å—ä¼ è¾“ç¼–ç çš„htmlæ–‡ä»¶(Transfer-Encoding: chunked), å’ŒXHR-Streamingä¸€æ ·ï¼Œè¿™ä¸ªè¯·æ±‚æ°¸è¿œéƒ½ä¸ä¼šç»“æŸï¼ŒæœåŠ¡å™¨ä¼šä¸æ–­åœ¨è¿™ä¸ªæ–‡æ¡£ä¸Šè¾“å‡ºå†…å®¹ã€‚<strong>è¿™é‡Œé¢çš„è¦ç‚¹æ˜¯ç°ä»£æµè§ˆå™¨éƒ½ä¼šå¢é‡æ¸²æŸ“htmlæ–‡ä»¶ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¯ä»¥é€šè¿‡æ·»åŠ scriptæ ‡ç­¾åœ¨å®¢æˆ·ç«¯æ‰§è¡ŒæŸäº›ä»£ç </strong>ï¼Œå…ˆæ¥çœ‹ä¸ªæŠ“åŒ…çš„å®ä¾‹:</p><p><img src="/images/sockjs/htmlfile.png" alt></p><p><br></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º:</p><ul><li>â‘  è¿™é‡Œä¼šç»™æœåŠ¡å™¨ä¼ é€’ä¸€ä¸ªcallbackï¼Œé€šè¿‡è¿™ä¸ªcallbackå°†æ•°æ®ä¼ é€’ç»™çˆ¶æ–‡æ¡£</li><li>â‘¡ æœåŠ¡å™¨æ¯å½“æœ‰æ–°çš„æ•°æ®ï¼Œå°±å‘æ–‡æ¡£è¿½åŠ ä¸€ä¸ª<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œscriptçš„ä»£ç å°±æ˜¯å°†æ•°æ®ä¼ é€’ç»™callbackã€‚åˆ©ç”¨æµè§ˆå™¨ä¼šè¢«ä¸‹è½½è¾¹è§£æHTMLæ–‡æ¡£çš„ç‰¹æ€§ï¼Œæ–°å¢çš„scriptä¼šé©¬ä¸Šè¢«æ‰§è¡Œ</li></ul><p><br></p><p>æœ€åè¿˜æ˜¯ç”¨æµç¨‹å›¾æè¿°ä¸€ä¸‹ï¼š</p><p><img src="/images/sockjs/htmlfile-progress.png" alt></p><p>é™¤äº†IE6ã€7ä»¥ä¸‹ä¸æ”¯æŒï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ”¯æŒè¿™ä¸ªæ–¹æ¡ˆï¼Œå½“æµè§ˆå™¨ä¸æ”¯æŒ<code>XHR-streaming</code>æ—¶ï¼Œå¯ä»¥ä½œä¸ºæœ€ä½³å¤‡èƒã€‚</p><p><br></p><hr><p><br></p><h2 id="polling"><a href="#polling" class="headerlink" title="Polling"></a>Polling</h2><p>è½®è¯¢æ˜¯æœ€ç²—æš´(æˆ–è€…è¯´æœ€ç®€å•)ï¼Œä¹Ÿæ˜¯æ•ˆç‡æœ€ä½ä¸‹çš„â€˜å®æ—¶â€™é€šä¿¡æ–¹æ¡ˆï¼Œè¿™ç§æ–¹å¼çš„åŸç†å°±æ˜¯å®šæœŸå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚, æ‹‰å–æœ€æ–°çš„æ¶ˆæ¯é˜Ÿåˆ—:</p><p><img src="/images/sockjs/polling2.png" alt></p><p>è¿™ç§è½®è¯¢æ–¹å¼æ¯”è¾ƒåˆé€‚<strong>æœåŠ¡å™¨çš„ä¿¡æ¯å®šæœŸæ›´æ–°</strong>çš„åœºæ™¯ï¼Œå¦‚å¤©æ°”å’Œè‚¡ç¥¨è¡Œæƒ…ä¿¡æ¯ã€‚ä¸¾ä¸ªä¾‹å­è‚¡ç¥¨ä¿¡æ¯æ¯éš”5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯å®šæœŸè½®è¯¢, ä¸”è½®è¯¢é—´éš”å’ŒæœåŠ¡ç«¯æ›´æ–°é¢‘ç‡ä¿æŒä¸€è‡´æ˜¯ä¸€ç§ç†æƒ³çš„æ–¹å¼ã€‚</p><p>ä½†æ˜¯å¦‚æœè¿½æ±‚å®æ—¶æ€§ï¼Œè½®è¯¢ä¼šå¯¼è‡´ä¸€äº›ä¸¥é‡çš„é—®é¢˜:</p><ul><li>èµ„æºæµªè´¹ã€‚æ¯”å¦‚è½®è¯¢çš„é—´éš”å°äºæœåŠ¡å™¨ä¿¡æ¯æ›´æ–°çš„é¢‘ç‡ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šHTTPè¯·æ±‚, æ¶ˆè€—å®è´µçš„CPUæ—¶é—´å’Œå¸¦å®½</li><li>å®¹æ˜“å¯¼è‡´è¯·æ±‚è½°ç‚¸ã€‚æ¯”å¦‚å½“æœåŠ¡å™¨è´Ÿè½½æ¯”è¾ƒé«˜æ—¶ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿˜æ²¡å¤„ç†å®Œæˆï¼Œè¿™æ—¶å€™ç¬¬äºŒã€ç¬¬ä¸‰ä¸ªè¯·æ±‚æ¥è¸µè€Œæ¥ï¼Œæ— ç”¨çš„é¢å¤–è¯·æ±‚å¯¹æœåŠ¡ç«¯è¿›è¡Œäº†è½°ç‚¸ã€‚</li></ul><p><br></p><hr><p><br></p><h2 id="long-polling"><a href="#long-polling" class="headerlink" title="Long polling"></a>Long polling</h2><p>è¿˜æœ‰ä¸€ç§ä¼˜åŒ–çš„è½®è¯¢æ–¹æ³•ï¼Œç§°ä¸ºé•¿è½®è¯¢(Long Polling)ï¼Œsockjså°±æ˜¯ä½¿ç”¨è¿™ç§è½®è¯¢æ–¹å¼, <strong>é•¿è½®è¯¢æŒ‡çš„æ˜¯æµè§ˆå™¨å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åªæœ‰åœ¨æœ‰å¯ç”¨çš„æ–°æ•°æ®æ—¶æ‰å“åº”</strong>ï¼š</p><p><img src="/images/sockjs/polling.png" alt></p><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªæ¶ˆæ¯è·å–è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šå°†å½“å‰çš„æ¶ˆæ¯é˜Ÿåˆ—è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå…³é—­è¿æ¥ã€‚<strong>å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒæœåŠ¡ç«¯ä¸ä¼šç«‹å³å…³é—­è¿æ¥ï¼Œè€Œæ˜¯ç­‰å¾…æŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´é—´éš”å†…æ²¡æœ‰æ–°çš„æ¶ˆæ¯ï¼Œåˆ™ç”±å®¢æˆ·ç«¯ä¸»åŠ¨è¶…æ—¶å…³é—­è¿æ¥</strong>ã€‚</p><p>å¦å¤–ä¸€ä¸ªè¦ç‚¹æ˜¯ï¼Œ<strong>å®¢æˆ·ç«¯çš„è½®è¯¢è¯·æ±‚åªæœ‰åœ¨ä¸Šä¸€ä¸ªè¯·æ±‚è¿æ¥å…³é—­åæ‰ä¼šé‡æ–°å‘èµ·</strong>ã€‚è¿™å°±è§£å†³äº†ä¸Šæ–‡çš„è¯·æ±‚è½°ç‚¸é—®é¢˜ã€‚æœåŠ¡ç«¯å¯ä»¥æ§åˆ¶å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶åºï¼Œå› ä¸ºåœ¨æœåŠ¡ç«¯æœªå“åº”ä¹‹å‰ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€é¢å¤–çš„è¯·æ±‚(åœ¨è¶…æ—¶æœŸé—´å†…)ã€‚</p><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API" target="_blank" rel="noopener">WebRTC</a> è¿™æ˜¯æµè§ˆå™¨çš„å®æ—¶é€šä¿¡æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œåº”ç”¨æˆ–è€…ç«™ç‚¹ï¼Œåœ¨ä¸å€ŸåŠ©ä¸­é—´åª’ä»‹çš„æƒ…å†µä¸‹ï¼Œå»ºç«‹æµè§ˆå™¨ä¹‹é—´ç‚¹å¯¹ç‚¹ï¼ˆPeer-to-Peerï¼‰çš„è¿æ¥ï¼Œå®ç°è§†é¢‘æµå’Œï¼ˆæˆ–ï¼‰éŸ³é¢‘æµæˆ–è€…å…¶ä»–ä»»æ„æ•°æ®çš„ä¼ è¾“ã€‚</li><li><a href="https://github.com/meteor/meteor/tree/devel/packages/ddp" target="_blank" rel="noopener">metetor DDP</a> DDP(Distributed Data Protocol), è¿™æ˜¯ä¸€ä¸ªâ€™æœ‰çŠ¶æ€çš„â€™å®æ—¶é€šä¿¡åè®®ï¼Œè¿™ä¸ªæ˜¯<a href="https://github.com/meteor/meteor" target="_blank" rel="noopener">Meteor</a>æ¡†æ¶çš„åŸºç¡€, å®ƒå°±æ˜¯ä½¿ç”¨è¿™ä¸ªåè®®æ¥è¿›è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡. ä»–åªæ˜¯ä¸€ä¸ªåè®®ï¼Œè€Œä¸æ˜¯é€šä¿¡æŠ€æœ¯ï¼Œæ¯”å¦‚å®ƒçš„åº•å±‚å¯ä»¥åŸºäºWebsocketã€XHR-Streamingã€é•¿è½®è¯¢ç”šè‡³æ˜¯WebRTC</li><li><a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html" target="_blank" rel="noopener">Server-Sent Events æ•™ç¨‹</a></li><li><a href="https://medium.com/@chijianqiang/ç¨‹åºå‘˜æ€ä¹ˆä¼šä¸çŸ¥é“-c10k-é—®é¢˜å‘¢-d024cb7880f3" target="_blank" rel="noopener">ç¨‹åºå‘˜æ€ä¹ˆä¼šä¸çŸ¥é“C10K é—®é¢˜å‘¢ï¼Ÿ - æ± å»ºå¼º- Medium</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ä¸»è¦æ¢è®¨ç°é˜¶æ®µæµè§ˆå™¨ç«¯å¯è¡Œçš„å®æ—¶é€šä¿¡æ–¹æ¡ˆï¼Œä»¥åŠå®ƒä»¬çš„å‘å±•å†å²ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»¥&lt;a href=&quot;https://github.com/sockjs/sockjs-client&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;sockjs
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>[è¯‘] ä¸å®¹é”™è¿‡çš„CSSå˜é‡</title>
    <link href="https://bobi.ink/2019/07/06/css-variable/"/>
    <id>https://bobi.ink/2019/07/06/css-variable/</id>
    <published>2019-07-05T16:00:00.000Z</published>
    <updated>2019-07-06T04:54:51.625Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡é“¾æ¥: <a href="https://dev.to/timdeschryver/don-t-miss-out-on-css-variables-4708" target="_blank" rel="noopener">Donâ€™t miss out on css variables</a></p><p>å½“æˆ‘ç¬¬ä¸€æ¬¡å¬è¯´<a href="https://www.w3.org/TR/css-variables/" target="_blank" rel="noopener">CSSå˜é‡</a>æ—¶ï¼Œæˆ‘æ˜¯æŠ±ç€æ€€ç–‘å¤ªå¤šçš„ã€‚scssã€sassã€lesså’Œstylusè¿™äº›CSSé¢„å¤„ç†å™¨ä¸æ˜¯éƒ½æœ‰å˜é‡æœºåˆ¶å—? ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨å®ƒï¼Ÿè¿‡äº†å‡ å¹´ï¼Œæˆ‘å‘ç°è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹è®¨è®ºå’Œä½¿ç”¨å®ƒï¼Œæˆ‘è§‰å¾—æˆ‘æ˜¯é”™è¿‡äº†ä»€ä¹ˆâ€¦â€¦ è™½ç„¶èŠ±è´¹äº†ä¸€ç‚¹åŠŸå¤«ï¼Œä½†åœ¨ä½¿ç”¨åï¼Œæˆ‘ç¡®å®è¢«å®ƒå¸å¼•ä½äº†ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä¼šé˜è¿°åˆ°åº•æ˜¯ä»€ä¹ˆæ¨åŠ¨æˆ‘è¿›ä¸€æ­¥å»æ¢ç´¢CSSå˜é‡ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚</p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p>åœ¨é€‰æ‹©å™¨é‡Œé¢å£°æ˜å˜é‡ï¼Œå˜é‡åä»¥<code>--</code>ä½œä¸ºå‰ç¼€:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">--bgColor</span>: deeppink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæµè¡Œçš„æ–¹å¼æ˜¯åœ¨<code>:root</code>é€‰æ‹©å™¨ä¸­å®šä¹‰å˜é‡ï¼Œè¿™ç›¸å½“äºå®šäºå…¨å±€å˜é‡:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">--bgColor</span>: teal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>var()</code>å‡½æ•°æ¥å¼•ç”¨å˜é‡:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--bgColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>var()</code>å‡½æ•°è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œç”¨ä½œå˜é‡çš„é»˜è®¤å€¼ï¼Œå½“å˜é‡æœªå®šä¹‰æ—¶å›é€€åˆ°è¿™ä¸ªé»˜è®¤å€¼:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--bgColor);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color, beige);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹:</p><p><img src="/images/css-variable/0.png" alt></p><h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><p>åˆ©ç”¨CSSå˜é‡ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°ä¸»é¢˜æœºåˆ¶.</p><p>åœ¨bodyå…ƒç´ ä¸Šä¸ºä¸åŒçš„ä¸»é¢˜åˆ›å»ºä¸åŒçš„ç±»åï¼Œå¹¶å®šä¹‰åˆé€‚çš„å˜é‡å€¼:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span><span class="selector-class">.sunrise</span> &#123;</span><br><span class="line">  <span class="attribute">--background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">--text-color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span><span class="selector-class">.sunset</span> &#123;</span><br><span class="line">  <span class="attribute">--background-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">--text-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™äº›å˜é‡:</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--background-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨åˆ‡æ¢bodyå…ƒç´ çš„ç±»ååˆ°sunriseæˆ–sunseï¼ŒCSSå˜é‡ä¼šå å±‚åº”ç”¨åˆ°æ‰€æœ‰é€‰æ‹©å™¨. æ•ˆæœå¦‚ä¸‹:</p><p><img src="/images/css-variable/1.gif" alt></p><h2 id="javascript-api"><a href="#javascript-api" class="headerlink" title="Javascript API"></a>Javascript API</h2><p>æˆ‘è§‰å¾—è¿™æ˜¯CSSå˜é‡æœ€å¥½çš„éƒ¨åˆ† â€”â€” CSSå˜é‡å¯ä»¥é€šè¿‡Javascript APIæ¥è·å–å’Œè®¾ç½®ã€‚SCSS/Lessè¿™äº›é¢„å¤„ç†å™¨çš„å˜é‡å¯åšä¸åˆ°(éƒ¨åˆ†é¢„å¤„ç†å™¨å·²æ”¯æŒç¼–è¯‘åˆ°åˆ°CSSå˜é‡)ã€‚</p><p>é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleDeclaration/getPropertyValue" target="_blank" rel="noopener"><code>getPropertyValue</code></a>æ–¹æ³•æ¥è·å–å˜é‡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getComputedStyle(<span class="built_in">document</span>.documentElement).getPropertyValue(<span class="string">'--color'</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦è·å–å…·ä½“å…ƒç´ çš„çš„å˜é‡å€¼, å…ˆé€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector" target="_blank" rel="noopener"><code>querySelector</code></a>è·å–å…ƒç´ ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getComputedStyle(<span class="built_in">document</span>.querySelector(<span class="string">'h1'</span>)).getPropertyValue(<span class="string">'--color'</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleDeclaration/setProperty" target="_blank" rel="noopener"><code>style.setProperty</code></a>æ¥è®¾ç½®å˜é‡å€¼ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(<span class="string">'--color'</span>, <span class="string">'red'</span>)</span><br></pre></td></tr></table></figure><p>è®¾ç½®å…·ä½“å…ƒç´ çš„å˜é‡å€¼:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'h1'</span>).style.setProperty(<span class="string">'--color'</span>, <span class="string">'blue'</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªAPIæä¾›äº†ä¸€ä¸ªç®€æ´çš„æ–¹å¼æ¥ä½¿ç”¨CSSå˜é‡.</p><p>å‡ å¤©å‰, æˆ‘é€šè¿‡<a href="https://twitter.com/DavidKPiano" target="_blank" rel="noopener">David K</a>çš„<a href="https://codepen.io/davidkpiano/pen/zWrRye" target="_blank" rel="noopener">XState DEMO</a>æ¥è§¦åˆ°äº†è¿™ä¸ªä½¿ç”¨åœºæ™¯: å½“ç”¨æˆ·é¼ æ ‡æ‹–æ‹½æ—¶, é€šè¿‡CSSå˜é‡æ¥ç¡®å®šé€‰æ‹©æ¡†çš„å®šä½(åŸºäºé¼ æ ‡çš„å¼€å§‹ä½ç½®å’Œå½“å‰ä½ç½®):</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.selectbox</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="built_in">calc</span>(var(--mouse-x1));</span><br><span class="line">  <span class="attribute">top</span>: <span class="built_in">calc</span>(var(--mouse-y1));</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>((var(--mouse-x2) - <span class="built_in">var</span>(--mouse-x1)));</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>((var(--mouse-y2) - <span class="built_in">var</span>(--mouse-y1)));</span><br><span class="line"></span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(255, 255, 255, 0.5);</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(0, 0, 0, 0.1);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid currentColor;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.3s</span> ease-in-out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é¼ æ ‡äº‹ä»¶å¤„ç†å™¨ä¸­æ›´æ–°CSSå˜é‡ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-x1'</span>,</span><br><span class="line">  ctx.selectArea.x1 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-y1'</span>,</span><br><span class="line">  ctx.selectArea.y1 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-x2'</span>,</span><br><span class="line">  ctx.selectArea.x2 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--mouse-y2'</span>,</span><br><span class="line">  ctx.selectArea.y2 + <span class="string">'px'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/css-variable/2.gif" alt></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¦‚æœä½ åƒæˆ‘ä¸€æ ·è§‰å¾—CSSå˜é‡æ²¡æœ‰ç”¨ï¼Œæˆ–è€…å‹æ ¹ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥ä¸ºä½ å¼€å¯ä¸€æ‰‡é—¨ï¼Œæ¥æ¢ç´¢å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>Javascript APIè®©æˆ‘è¸©äº†ä¸å°‘å‘ï¼Œä½†æ˜¯å®ƒç¡®å®è®©æˆ‘å¼€äº†çœ¼ç•Œï¼Œæˆ‘æœŸå¾…æœªæ¥èƒ½å¤Ÿæ›´å¤šä½¿ç”¨å’Œäº†è§£å®ƒä»¬ã€‚</p><blockquote><p>è¯‘è€…æ³¨:<br><br>æœ¬æ–‡å¹¶éå®Œå…¨ç…§æ¬åŸæ–‡ï¼Œå³æ„è¯‘. å¦å¤–å¥³æœ‹å‹ä¹Ÿç»™æˆ‘æ ¡éªŒè¿‡äº†ï¼Œç¡®ä¿å¤§ä½“æ²¡æœ‰æé”™ğŸ˜‚<br><br>å› ä¸ºç¬”è€…è‡ªå·±åŸåˆ›çš„æ–‡ç« é˜…è¯»é‡æ¯”è¾ƒæƒ¨æ·¡ï¼Œæ‰€ä»¥ç¬”è€…è¿‘æœŸä¼šå°è¯•ç¿»è¯‘ä¸€äº›æ–‡ç« ï¼Œå­¦ä¹ è¿™äº›æ–‡ç« æ˜¯æ€ä¹ˆå†™çš„ï¼Œä¹Ÿç§¯æ”’ç‚¹äººæ°”ï¼Œä»¥ä¾¿åé¢åŸåˆ›æ–‡ç« æœ‰æ›´å¤šé˜…è¯»é‡</p></blockquote><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Using_CSS_custom_properties" target="_blank" rel="noopener">ä½¿ç”¨CSSå˜é‡</a></li><li><a href="https://caniuse.com/#feat=css-variables" target="_blank" rel="noopener">Caniuse: CSS Variables (Custom Properties)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸæ–‡é“¾æ¥: &lt;a href=&quot;https://dev.to/timdeschryver/don-t-miss-out-on-css-variables-4708&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Donâ€™t miss out on css va
      
    
    </summary>
    
      <category term="å‰ç«¯,CSS" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF-CSS/"/>
    
    
  </entry>
  
  <entry>
    <title>[æŠ€æœ¯åœ°å›¾] CodeSandbox å¦‚ä½•å·¥ä½œ? ä¸Šç¯‡</title>
    <link href="https://bobi.ink/2019/06/20/codesandbox/"/>
    <id>https://bobi.ink/2019/06/20/codesandbox/</id>
    <published>2019-06-19T16:00:00.000Z</published>
    <updated>2019-07-04T14:28:21.865Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æœŸæ¥å…³æ³¨ä¸€ä¸‹<a href="https://codesandbox.io" target="_blank" rel="noopener"><code>CodeSandbox</code></a>, è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„æ²™ç›’è¿è¡Œç¯å¢ƒï¼Œæ”¯æŒå¤šç§æµè¡Œçš„æ„å»ºæ¨¡æ¿ï¼Œä¾‹å¦‚ <code>create-react-app</code>ã€ <code>vue-cli</code>ã€<code>parcel</code>ç­‰ç­‰ã€‚ å¯ä»¥ç”¨äºå¿«é€ŸåŸå‹å¼€å‘ã€DEMO å±•ç¤ºã€Bug è¿˜åŸç­‰ç­‰.</p><p>ç›¸ä¼¼çš„äº§å“æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚<a href="https://codepen.io/pen" target="_blank" rel="noopener"><code>codepen</code></a>ã€<a href="https://jsfiddle.net" target="_blank" rel="noopener"><code>JSFiddle</code></a>ã€<a href="https://webpackbin-prod.firebaseapp.com" target="_blank" rel="noopener"><code>WebpackBin</code></a>(å·²åºŸå¼ƒ).</p><p>CodeSandbox åˆ™æ›´åŠ å¼ºå¤§ï¼Œå¯ä»¥è§†ä½œæ˜¯æµè§ˆå™¨ç«¯çš„ Webpack è¿è¡Œç¯å¢ƒ, ç”šè‡³åœ¨ V3 ç‰ˆæœ¬å·²ç»æ”¯æŒ VsCode æ¨¡å¼ï¼Œæ”¯æŒ Vscode çš„æ’ä»¶å’Œ Vim æ¨¡å¼ã€è¿˜æœ‰ä¸»é¢˜.</p><p>å¦å¤– CodeSandbox æ”¯æŒç¦»çº¿è¿è¡Œ(PWA)ã€‚åŸºæœ¬ä¸Šå¯ä»¥æ¥è¿‘æœ¬åœ° VSCode çš„ç¼–ç¨‹ä½“éªŒ. æœ‰ iPad çš„åŒå­¦ï¼Œä¹Ÿå¯ä»¥å°è¯•åŸºäºå®ƒæ¥è¿›è¡Œå¼€å‘ã€‚æ‰€ä»¥å¿«é€Ÿçš„åŸå‹å¼€å‘æˆ‘ä¸€èˆ¬ä¼šç›´æ¥ä½¿ç”¨ CodeSandbox</p><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#å¼•">å¼•</a></li><li><a href="#åŸºæœ¬ç›®å½•ç»“æ„">åŸºæœ¬ç›®å½•ç»“æ„</a></li><li><a href="#é¡¹ç›®æ„å»ºè¿‡ç¨‹">é¡¹ç›®æ„å»ºè¿‡ç¨‹</a><ul><li><a href="#packager">Packager</a><ul><li><a href="#webpackdllplugin">WebpackDllPlugin</a></li><li><a href="#åœ¨çº¿æ‰“åŒ…æœåŠ¡">åœ¨çº¿æ‰“åŒ…æœåŠ¡</a></li><li><a href="#å›é€€æ–¹æ¡ˆ">å›é€€æ–¹æ¡ˆ</a></li></ul></li><li><a href="#transpilation">Transpilation</a><ul><li><a href="#åŸºæœ¬å¯¹è±¡">åŸºæœ¬å¯¹è±¡</a></li><li><a href="#manager">Manager</a></li><li><a href="#transpiledmodule">TranspiledModule</a></li><li><a href="#transpiler">Transpiler</a></li><li><a href="#babeltranspiler">BabelTranspiler</a></li></ul></li><li><a href="#evaluation">Evaluation</a></li></ul></li><li><a href="#æŠ€æœ¯åœ°å›¾">æŠ€æœ¯åœ°å›¾</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br><br><br></p><h2 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h2><center><br>  <img src="/images/08/codesandbox.png" width="800"><br></center><p><br></p><p>ç¬”è€…å¯¹ CodeSandbox çš„ç¬¬ä¸€å°è±¡æ˜¯è¿™ç©æ„æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨çš„å§ï¼Ÿ æ¯”å¦‚ <code>create-react-app</code> è¦è¿è¡Œèµ·æ¥éœ€è¦ node ç¯å¢ƒï¼Œéœ€è¦é€šè¿‡ npm å®‰è£…ä¸€å¤§å †ä¾èµ–ï¼Œç„¶åé€šè¿‡ Webpack è¿›è¡Œæ‰“åŒ…ï¼Œæœ€åè¿è¡Œä¸€ä¸ªå¼€å‘æœåŠ¡å™¨æ‰èƒ½åœ¨æµè§ˆå™¨è·‘èµ·æ¥.</p><p><strong>å®é™…ä¸Š CodeSandbox æ‰“åŒ…å’Œè¿è¡Œå¹¶ä¸ä¾èµ–äºæœåŠ¡å™¨, å®ƒæ˜¯å®Œå…¨åœ¨æµè§ˆå™¨è¿›è¡Œçš„</strong>. å¤§æ¦‚çš„ç»“æ„å¦‚ä¸‹:</p><center><br> <img src="/images/08/codesandbox-arch.png" width="600"><br></center><ul><li><strong>Editor</strong>: ç¼–è¾‘å™¨ã€‚ä¸»è¦ç”¨äºä¿®æ”¹æ–‡ä»¶ï¼ŒCodeSandboxè¿™é‡Œé›†æˆäº† <code>VsCode</code>, æ–‡ä»¶å˜åŠ¨åä¼šé€šçŸ¥ <code>Sandbox</code> è¿›è¡Œè½¬è¯‘. è®¡åˆ’ä¼šæœ‰æ–‡ç« ä¸“é—¨ä»‹ç»CodeSandboxçš„ç¼–è¾‘å™¨å®ç°</li><li><strong>Sandbox</strong>: ä»£ç è¿è¡Œå™¨ã€‚<strong>Sandbox åœ¨ä¸€ä¸ªå•ç‹¬çš„ iframe ä¸­è¿è¡Œ, è´Ÿè´£ä»£ç çš„è½¬è¯‘(Transpiler)å’Œè¿è¡Œ(Evalation)</strong>. å¦‚æœ€ä¸Šé¢çš„å›¾ï¼Œå·¦è¾¹æ˜¯Editorï¼Œå³è¾¹æ˜¯Sandbox</li><li><strong>Packager</strong> åŒ…ç®¡ç†å™¨ã€‚ç±»ä¼¼äºyarnå’Œnpmï¼Œè´Ÿè´£æ‹‰å–å’Œç¼“å­˜ npm ä¾èµ–</li></ul><p><br></p><p>CodeSandbox çš„ä½œè€… <a href="https://twitter.com/CompuIves" target="_blank" rel="noopener">Ives van Hoorne</a> ä¹Ÿå°è¯•è¿‡å°† <code>Webpack</code> ç§»æ¤åˆ°æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œå› ä¸ºç°åœ¨å‡ ä¹æ‰€æœ‰çš„ CLI éƒ½æ˜¯ä½¿ç”¨ Webpack è¿›è¡Œæ„å»ºçš„ï¼Œå¦‚æœèƒ½å°† Webpack ç§»æ¤åˆ°æµè§ˆå™¨ä¸Š, å¯ä»¥åˆ©ç”¨ Webpack å¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿå’Œè½¬è¯‘æœºåˆ¶(loader/plugin)ï¼Œä½æˆæœ¬å…¼å®¹å„ç§ CLI.</p><p>ç„¶è€Œ Webpack å¤ªé‡äº†ğŸ˜±ï¼Œå‹ç¼©è¿‡åçš„å¤§å°å°±å¾— 3.5MBï¼Œè¿™è¿˜ç®—å‹‰å¼ºå¯ä»¥æ¥å—å§ï¼›æ›´å¤§çš„é—®é¢˜æ˜¯è¦åœ¨æµè§ˆå™¨ç«¯æ¨¡æ‹Ÿ Node è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªæˆæœ¬å¤ªé«˜äº†ï¼Œå¾—ä¸å¿å¤±ã€‚</p><p>æ‰€ä»¥ CodeSandbox å†³å®šè‡ªå·±é€ ä¸ªæ‰“åŒ…å™¨ï¼Œè¿™ä¸ªæ‰“åŒ…å™¨æ›´è½»é‡ï¼Œå¹¶ä¸”é’ˆå¯¹ CodeSandbox å¹³å°è¿›è¡Œä¼˜åŒ–. æ¯”å¦‚ CodeSandbox åªå…³å¿ƒå¼€å‘ç¯å¢ƒçš„ä»£ç æ„å»º, ç›®æ ‡å°±æ˜¯èƒ½è·‘èµ·æ¥å°±è¡Œäº†, è·Ÿ Webpack ç›¸æ¯”è£å‰ªæ‰äº†ä»¥ä¸‹ç‰¹æ€§:</p><ul><li>ç”Ÿäº§æ¨¡å¼. CodeSandbox åªè€ƒè™‘ development æ¨¡å¼ï¼Œä¸éœ€è¦è€ƒè™‘ productionä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚<ul><li>ä»£ç å‹ç¼©ï¼Œä¼˜åŒ–</li><li>Tree-shaking</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>ä»£ç åˆ†å‰²</li></ul></li><li>æ–‡ä»¶è¾“å‡º. ä¸éœ€è¦æ‰“åŒ…æˆchunk</li><li>æœåŠ¡å™¨é€šä¿¡. Sandboxç›´æ¥åŸåœ°è½¬è¯‘å’Œè¿è¡Œ, è€ŒWebpack éœ€è¦å’Œå¼€å‘æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥ç”¨äºæ¥æ”¶æŒ‡ä»¤ï¼Œä¾‹å¦‚ HMR.</li><li>é™æ€æ–‡ä»¶å¤„ç†(å¦‚å›¾ç‰‡). è¿™äº›å›¾ç‰‡éœ€è¦ä¸Šä¼ åˆ° CodeSandbox çš„æœåŠ¡å™¨</li><li>æ’ä»¶æœºåˆ¶ç­‰ç­‰.</li></ul><p>æ‰€ä»¥å¯ä»¥è®¤ä¸º<strong>CodeSandboxæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„Webpack, ä¸”é’ˆå¯¹æµè§ˆå™¨ç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨workeræ¥è¿›è¡Œå¹¶è¡Œè½¬è¯‘</strong></p><p>CodeSandbox çš„æ‰“åŒ…å™¨ä½¿ç”¨äº†æ¥è¿‘ <code>Webpack Loader</code> çš„ API, è¿™æ ·å¯ä»¥å¾ˆå®¹æ˜“åœ°å°† Webpack çš„ä¸€äº› loader ç§»æ¤è¿‡æ¥. ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯ <code>create-react-app</code> çš„å®ç°(æŸ¥çœ‹<a href="https://github.com/codesandbox/codesandbox-client/blob/84972fd027fe36c53652c22f6775e1e6d3c51145/packages/app/src/sandbox/eval/presets/create-react-app/index.js#L1" target="_blank" rel="noopener">æºç </a>):</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> stylesTranspiler <span class="keyword">from</span> <span class="string">"../../transpilers/style"</span>;</span><br><span class="line"><span class="keyword">import</span> babelTranspiler <span class="keyword">from</span> <span class="string">"../../transpilers/babe"</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> sassTranspiler <span class="keyword">from</span> <span class="string">"../../transpilers/sass"</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preset = <span class="keyword">new</span> Preset(</span><br><span class="line">  <span class="string">"create-react-app"</span>,</span><br><span class="line">  [<span class="string">"web.js"</span>, <span class="string">"js"</span>, <span class="string">"json"</span>, <span class="string">"web.jsx"</span>, <span class="string">"jsx"</span>, <span class="string">"ts"</span>, <span class="string">"tsx"</span>],</span><br><span class="line">  &#123;</span><br><span class="line">    hasDotEnv: <span class="literal">true</span>,</span><br><span class="line">    setup: <span class="function"><span class="params">manager</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> babelOptions = &#123;</span><br><span class="line">        <span class="comment">/*..*/</span></span><br><span class="line">      &#125;;</span><br><span class="line">      preset.registerTranspiler(</span><br><span class="line">        <span class="built_in">module</span> =&gt;</span><br><span class="line">          /\.(t|j)sx?$/.test(<span class="built_in">module</span>.path) &amp;&amp; !<span class="built_in">module</span>.path.endsWith(<span class="string">".d.ts"</span>),</span><br><span class="line">        [</span><br><span class="line">          &#123;</span><br><span class="line">            transpiler: babelTranspiler,</span><br><span class="line">            options: babelOptions</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      );</span><br><span class="line">      preset.registerTranspiler(</span><br><span class="line">        <span class="built_in">module</span> =&gt; <span class="regexp">/\.svg$/</span>.test(<span class="built_in">module</span>.path),</span><br><span class="line">        [</span><br><span class="line">          &#123; <span class="attr">transpiler</span>: svgrTranspiler &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            transpiler: babelTranspiler,</span><br><span class="line">            options: babelOptions</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><br></p><p>å¯ä»¥çœ‹å‡º, CodeSandboxçš„Presetå’ŒWebpackçš„é…ç½®é•¿çš„å·®ä¸å¤š. <strong>ä¸è¿‡, ç›®å‰ä½ åªèƒ½ä½¿ç”¨ CodeSandbox é¢„å®šä¹‰çš„ Preset, ä¸æ”¯æŒåƒ Webpack ä¸€æ ·è¿›è¡Œé…ç½®, ä¸ªäººè§‰å¾—è¿™ä¸ªæ˜¯ç¬¦åˆ CodeSandbox å®šä½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„åŸå‹å¼€å‘å·¥å…·ï¼Œä½ è¿˜æŠ˜è…¾ Webpack å¹²å˜›ï¼Ÿ</strong></p><p>ç›®å‰æ”¯æŒè¿™äº›Preset:</p><center><br> <img src="/images/08/presets.png" width="600"><br></center><p><br></p><hr><p><br></p><h2 id="åŸºæœ¬ç›®å½•ç»“æ„"><a href="#åŸºæœ¬ç›®å½•ç»“æ„" class="headerlink" title="åŸºæœ¬ç›®å½•ç»“æ„"></a>åŸºæœ¬ç›®å½•ç»“æ„</h2><p>CodeSandbox çš„å®¢æˆ·ç«¯æ˜¯å¼€æºçš„ï¼Œä¸ç„¶å°±æ²¡æœ‰æœ¬æ–‡äº†ï¼Œå®ƒçš„åŸºæœ¬ç›®å½•ç»“æ„å¦‚ä¸‹:</p><ul><li><strong>packages</strong><ul><li><strong>app</strong> CodeSandboxåº”ç”¨<ul><li><strong>app</strong> ç¼–è¾‘å™¨å®ç°</li><li><strong>embed</strong> ç½‘é¡µå†…åµŒè¿è¡Œ codesandbox</li><li><strong>sandbox</strong> è¿è¡Œæ²™ç›’ï¼Œåœ¨è¿™é‡Œæ‰§è¡Œä»£ç æ„å»ºå’Œé¢„è§ˆï¼Œç›¸å½“äºä¸€ä¸ªç¼©ç•¥ç‰ˆçš„ Webpack. è¿è¡Œåœ¨å•ç‹¬çš„ iframe ä¸­<ul><li>eval<ul><li>preset<ul><li>create-react-app</li><li>parcel</li><li>vue-cli</li><li>â€¦</li></ul></li><li>transpiler<ul><li>babel</li><li>sass</li><li>vue</li><li>â€¦</li></ul></li></ul></li><li>compile.ts ç¼–è¯‘å™¨</li></ul></li></ul></li><li><strong>common</strong> æ”¾ç½®é€šç”¨çš„ç»„ä»¶ã€å·¥å…·æ–¹æ³•ã€èµ„æº</li><li><strong>codesandbox-api</strong>: å°è£…äº†ç»Ÿä¸€çš„åè®®ï¼Œç”¨äº sandbox å’Œ editor ä¹‹é—´é€šä¿¡(åŸºäºpostmessage)</li><li><strong>codesandbox-browserfs</strong>: è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„â€˜æ–‡ä»¶ç³»ç»Ÿâ€™ï¼Œæ¨¡æ‹Ÿäº† NodeJS çš„æ–‡ä»¶ç³»ç»Ÿ APIï¼Œæ”¯æŒåœ¨æœ¬åœ°æˆ–ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­å­˜å‚¨æˆ–è·å–æ–‡ä»¶.</li><li><strong>react-sandpack</strong>: codesandboxå…¬å¼€çš„SDKï¼Œå¯ä»¥ç”¨äºè‡ªå®šä¹‰è‡ªå·±çš„codesandbox</li></ul></li></ul><p><a href="https://github.com/codesandbox/codesandbox-client" target="_blank" rel="noopener">æºç åœ¨è¿™</a></p><p><br></p><hr><p><br></p><h2 id="é¡¹ç›®æ„å»ºè¿‡ç¨‹"><a href="#é¡¹ç›®æ„å»ºè¿‡ç¨‹" class="headerlink" title="é¡¹ç›®æ„å»ºè¿‡ç¨‹"></a>é¡¹ç›®æ„å»ºè¿‡ç¨‹</h2><p><code>packager -&gt; transpilation -&gt; evaluation</code></p><p>Sandbox æ„å»ºåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:</p><ul><li><strong>Packager</strong> åŒ…åŠ è½½é˜¶æ®µï¼Œä¸‹è½½å’Œå¤„ç†æ‰€æœ‰npmæ¨¡å—ä¾èµ–</li><li><strong>Transpilation</strong> è½¬è¯‘é˜¶æ®µï¼Œè½¬è¯‘æ‰€æœ‰å˜åŠ¨çš„ä»£ç , æ„å»ºæ¨¡å—ä¾èµ–å›¾</li><li><strong>Evaluation</strong> æ‰§è¡Œé˜¶æ®µï¼Œä½¿ç”¨ <code>eval</code> è¿è¡Œæ¨¡å—ä»£ç è¿›è¡Œé¢„è§ˆ</li></ul><p>ä¸‹é¢ä¼šæŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤æ¥æè¿°å…¶ä¸­çš„æŠ€æœ¯ç‚¹</p><p><br><br><br></p><h3 id="packager"><a href="#packager" class="headerlink" title="Packager"></a>Packager</h3><p>å°½ç®¡ npm æ˜¯ä¸ªâ€™é»‘æ´â€™ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç¦»ä¸å¼€å®ƒã€‚ å…¶å®å¤§æ¦‚åˆ†æä¸€ä¸‹å‰ç«¯é¡¹ç›®çš„ <code>node_modules</code>ï¼Œ80%æ˜¯å„ç§å¼€å‘ä¾èµ–ç»„æˆçš„. </p><p>ç”±äº CodeSandbox å·²ç»åŒ…æ½äº†ä»£ç æ„å»ºçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦<code>devDependencies</code>, ä¹Ÿå°±æ˜¯è¯´ <strong>åœ¨CodeSandbox ä¸­æˆ‘ä»¬åªéœ€è¦å®‰è£…æ‰€æœ‰å®é™…ä»£ç è¿è¡Œéœ€è¦çš„ä¾èµ–ï¼Œè¿™å¯ä»¥å‡å°‘æˆç™¾ä¸Šåƒçš„ä¾èµ–ä¸‹è½½. æ‰€ä»¥æš‚ä¸”ä¸ç”¨æ‹…å¿ƒæµè§ˆå™¨ä¼šæ‰›ä¸ä½</strong>.</p><p><br></p><h4 id="webpackdllplugin"><a href="#webpackdllplugin" class="headerlink" title="WebpackDllPlugin"></a>WebpackDllPlugin</h4><p>CodeSandbox çš„ä¾èµ–æ‰“åŒ…æ–¹å¼å— <code>WebpackDllPlugin</code> å¯å‘ï¼ŒDllPlugin ä¼šå°†æ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åˆ°ä¸€ä¸ª<code>dll</code>æ–‡ä»¶ä¸­ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª <code>manifest</code> æ–‡ä»¶æ¥æè¿°dllçš„å…ƒæ•°æ®(å¦‚ä¸‹å›¾).</p><p>Webpack è½¬è¯‘æ—¶æˆ–è€… è¿è¡Œæ—¶å¯ä»¥æ ¹æ® manifest ä¸­çš„æ¨¡å—ç´¢å¼•(ä¾‹å¦‚<code>__webpack_require__(&#39;../node_modules/react/index.js&#39;)</code>)æ¥åŠ è½½ dll ä¸­çš„æ¨¡å—ã€‚ å› ä¸º<code>WebpackDllPlugin</code>æ˜¯åœ¨è¿è¡Œæˆ–è½¬è¯‘ä¹‹å‰é¢„å…ˆå¯¹ä¾èµ–çš„è¿›è¡Œè½¬è¯‘ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®ä»£ç è½¬è¯‘é˜¶æ®µå¯ä»¥å¿½ç•¥æ‰è¿™éƒ¨åˆ†ä¾èµ–ä»£ç ï¼Œè¿™æ ·å¯ä»¥æé«˜æ„å»ºçš„é€Ÿåº¦(çœŸå®åœºæ™¯å¯¹npmä¾èµ–è¿›è¡ŒDllæ‰“åŒ…æé€Ÿæ•ˆæœå¹¶ä¸å¤§):</p><center><br>  <img src="/images/08/dll.png"><br></center><p>manifestæ–‡ä»¶</p><center><br>  <img src="/images/08/webpack-dll-manifest.png" width="500"><br></center><p><br></p><h4 id="åœ¨çº¿æ‰“åŒ…æœåŠ¡"><a href="#åœ¨çº¿æ‰“åŒ…æœåŠ¡" class="headerlink" title="åœ¨çº¿æ‰“åŒ…æœåŠ¡"></a>åœ¨çº¿æ‰“åŒ…æœåŠ¡</h4><p>åŸºäºè¿™ä¸ªæ€æƒ³, CodeSandbox æ„å»ºäº†è‡ªå·±çš„åœ¨çº¿æ‰“åŒ…æœåŠ¡, å’ŒWebpackDllPluginä¸ä¸€æ ·çš„æ˜¯ï¼ŒCodeSandboxæ˜¯åœ¨æœåŠ¡ç«¯é¢„å…ˆæ„å»ºManifestæ–‡ä»¶çš„, è€Œä¸”ä¸åŒºåˆ†Dllå’Œmanifestæ–‡ä»¶ã€‚ å…·ä½“æ€è·¯å¦‚ä¸‹:</p><center><br> <img src="/images/08/packager1.png" width="800"><br></center><p>ç®€è€Œè¨€ä¹‹ï¼ŒCodeSandbox å®¢æˆ·ç«¯æ‹¿åˆ°<code>package.json</code>ä¹‹åï¼Œå°†<code>dependencies</code>è½¬æ¢ä¸ºä¸€ä¸ªç”±ä¾èµ–å’Œç‰ˆæœ¬å·ç»„æˆçš„<code>Combination</code>(æ ‡è¯†ç¬¦, ä¾‹å¦‚ <a href="https://d1jyvh0kxilfa7.cloudfront.net/v1/combinations/babel-runtime@7.3.1%2Bcsbbust@1.0.0%2Breact@16.8.4%2Breact-dom@16.8.4%2Breact-router@5.0.1%2Breact-router-dom@5.0.1%2Breact-split-pane@0.1.87.json" target="_blank" rel="noopener"><code>v1/combinations/babel-runtime@7.3.1&amp;csbbust@1.0.0&amp;react@16.8.4&amp;react-dom@16.8.4&amp;react-router@5.0.1&amp;react-router-dom@5.0.1&amp;react-split-pane@0.1.87.json</code></a>), å†æ‹¿è¿™ä¸ª Combination åˆ°æœåŠ¡å™¨è¯·æ±‚ã€‚æœåŠ¡å™¨ä¼šæ ¹æ® Combination ä½œä¸ºç¼“å­˜é”®æ¥ç¼“å­˜æ‰“åŒ…ç»“æœï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œåˆ™è¿›è¡Œæ‰“åŒ….</p><p><strong>æ‰“åŒ…å®é™…ä¸Šè¿˜æ˜¯ä½¿ç”¨<code>yarn</code>æ¥ä¸‹è½½æ‰€æœ‰ä¾èµ–ï¼Œåªä¸è¿‡è¿™é‡Œä¸ºäº†å‰”é™¤ npm æ¨¡å—ä¸­å¤šä½™çš„æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯è¿˜éå†äº†æ‰€æœ‰ä¾èµ–çš„å…¥å£æ–‡ä»¶(package.json#main), è§£æ AST ä¸­çš„ require è¯­å¥ï¼Œé€’å½’è§£æè¢« require æ¨¡å—. æœ€ç»ˆå½¢æˆä¸€ä¸ªä¾èµ–å›¾, åªä¿ç•™å¿…è¦çš„æ–‡ä»¶</strong>. </p><p>æœ€ç»ˆè¾“å‡º Manifest æ–‡ä»¶ï¼Œå®ƒçš„ç»“æ„å¤§æ¦‚å¦‚ä¸‹, ä»–å°±ç›¸å½“äºWebpackDllPluginçš„dll.js+manifest.jsonçš„ç»“åˆä½“:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ¨¡å—å†…å®¹</span></span><br><span class="line">  <span class="string">"contents"</span>: &#123;</span><br><span class="line">    <span class="string">"/node_modules/react/index.js"</span>: &#123;</span><br><span class="line">      <span class="string">"content"</span>: <span class="string">"'use strict';â†µâ†µif ...."</span>, <span class="comment">// ä»£ç å†…å®¹</span></span><br><span class="line">      <span class="string">"requires"</span>: [                        <span class="comment">// ä¾èµ–çš„å…¶ä»–æ¨¡å—</span></span><br><span class="line">        <span class="string">"./cjs/react.development.js"</span>,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"/node_modules/react-dom/index.js"</span>: &#123;<span class="comment">/*..*/</span>&#125;,</span><br><span class="line">    <span class="string">"/node_modules/react/package.json"</span>: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æ¨¡å—å…·ä½“å®‰è£…ç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="string">"dependencies"</span>: [&#123;<span class="attr">name</span>: <span class="string">"@babel/runtime"</span>, <span class="attr">version</span>: <span class="string">"7.3.1"</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">"csbbust"</span>, <span class="attr">version</span>: <span class="string">"1.0.0"</span>&#125;,<span class="comment">/*â€¦*/</span>],</span><br><span class="line">  <span class="comment">// æ¨¡å—åˆ«å, æ¯”å¦‚å°†reactä½œä¸ºpreact-compatçš„åˆ«å</span></span><br><span class="line">  <span class="string">"dependencyAliases"</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// ä¾èµ–çš„ä¾èµ–, å³é—´æ¥ä¾èµ–ä¿¡æ¯. è¿™äº›ä¿¡æ¯å¯ä»¥ä»yarn.lockè·å–</span></span><br><span class="line">  <span class="string">"dependencyDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"object-assign"</span>: &#123;</span><br><span class="line">      <span class="string">"entries"</span>: [<span class="string">"object-assign"</span>], <span class="comment">// æ¨¡å—å…¥å£</span></span><br><span class="line">      <span class="string">"parents"</span>: [<span class="string">"react"</span>, <span class="string">"prop-types"</span>, <span class="string">"scheduler"</span>, <span class="string">"react-dom"</span>], <span class="comment">// çˆ¶æ¨¡å—</span></span><br><span class="line">      <span class="string">"resolved"</span>: <span class="string">"4.1.1"</span>,</span><br><span class="line">      <span class="string">"semver"</span>: <span class="string">"^4.1.1"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p><strong>Serverless æ€æƒ³</strong><br><br><br>å€¼å¾—ä¸€æçš„æ˜¯ CodeSandbox çš„ Packager åç«¯ä½¿ç”¨äº† Serverless(åŸºäº AWS Lambda)ï¼ŒåŸºäº Serverless çš„æ¶æ„è®© Packager æœåŠ¡æ›´å…·ä¼¸ç¼©æ€§ï¼Œå¯ä»¥çµæ´»åœ°åº”ä»˜é«˜å¹¶å‘çš„åœºæ™¯ã€‚ä½¿ç”¨ Serverless ä¹‹å Packager çš„å“åº”æ—¶é—´æ˜¾è‘—æé«˜ï¼Œè€Œä¸”è´¹ç”¨ä¹Ÿä¸‹å»äº†ã€‚</p></blockquote><blockquote><p>Packager ä¹Ÿæ˜¯å¼€æºçš„, <a href="https://github.com/codesandbox/dependency-packager" target="_blank" rel="noopener">å›´è§‚</a></p></blockquote><p><br></p><h4 id="å›é€€æ–¹æ¡ˆ"><a href="#å›é€€æ–¹æ¡ˆ" class="headerlink" title="å›é€€æ–¹æ¡ˆ"></a>å›é€€æ–¹æ¡ˆ</h4><p>AWS Lambdaå‡½æ•°æ˜¯æœ‰å±€é™æ€§çš„, æ¯”å¦‚<code>/tmp</code>æœ€å¤šåªèƒ½æœ‰ 500MB çš„ç©ºé—´. å°½ç®¡å¤§éƒ¨åˆ†ä¾èµ–æ‰“åŒ…åœºæ™¯ä¸ä¼šè¶…è¿‡è¿™ä¸ªé™é¢, ä¸ºäº†å¢å¼ºå¯é æ€§(æ¯”å¦‚ä¸Šè¿°çš„æ–¹æ¡ˆå¯èƒ½å‡ºé”™ï¼Œä¹Ÿå¯èƒ½æ¼æ‰ä¸€äº›æ¨¡å—), Packagerè¿˜æœ‰å›é€€æ–¹æ¡ˆ.</p><p>åæ¥CodeSanboxä½œè€…å¼€å‘äº†æ–°çš„Sandboxï¼Œæ”¯æŒæŠŠåŒ…ç®¡ç†çš„æ­¥éª¤æ”¾ç½®åˆ°æµè§ˆå™¨ç«¯, å’Œä¸Šé¢çš„æ‰“åŒ…æ–¹å¼ç»“åˆç€ä½¿ç”¨ã€‚åŸç†ä¹Ÿæ¯”è¾ƒç®€å•: <strong>åœ¨è½¬è¯‘ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå¦‚æœå‘ç°æ¨¡å—ä¾èµ–çš„npmæ¨¡å—æœªæ‰¾åˆ°ï¼Œåˆ™æƒ°æ€§ä»è¿œç¨‹ä¸‹è½½å›æ¥</strong>. æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå¤„ç†çš„:</p><center><br> <img src="/images/08/packager2.png"><br></center><p>åœ¨å›é€€æ–¹æ¡ˆä¸­CodeSandbox å¹¶ä¸ä¼šå°† package.json ä¸­æ‰€æœ‰çš„åŒ…éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œè€Œæ˜¯åœ¨æ¨¡å—æŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œæƒ°æ€§çš„å»åŠ è½½ã€‚æ¯”å¦‚åœ¨è½¬è¯‘å…¥å£æ–‡ä»¶æ—¶ï¼Œå‘ç° react è¿™ä¸ªæ¨¡å—æ²¡æœ‰åœ¨æœ¬åœ°ç¼“å­˜æ¨¡å—é˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶å€™å°±ä¼šåˆ°è¿œç¨‹å°†å®ƒä¸‹è½½å›æ¥ï¼Œç„¶åæ¥ç€è½¬è¯‘ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå› ä¸ºåœ¨è½¬è¯‘é˜¶æ®µä¼šé™æ€åˆ†ææ¨¡å—çš„ä¾èµ–ï¼Œåªéœ€è¦å°†çœŸæ­£ä¾èµ–çš„æ–‡ä»¶ä¸‹è½½å›æ¥ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªnpmåŒ…ä¸‹è½½å›æ¥ï¼ŒèŠ‚çœäº†ç½‘ç»œä¼ è¾“çš„æˆæœ¬.</p><p>CodeSandbox é€šè¿‡ <code>unpkg.com</code> æˆ– <code>cdn.jsdelivr.net</code> æ¥è·å–æ¨¡å—çš„ä¿¡æ¯ä»¥åŠä¸‹è½½æ–‡ä»¶, ä¾‹å¦‚</p><ul><li>è·å– package.json: <code>https://unpkg.com/react@latest/package.json</code></li><li>åŒ…ç›®å½•ç»“æ„è·å–: <code>https://unpkg.com/antd@3.17.0/?meta</code> è¿™ä¸ªä¼šé€’å½’è¿”å›è¯¥åŒ…çš„æ‰€æœ‰ç›®å½•ä¿¡æ¯</li><li>å…·ä½“æ–‡ä»¶ä¸‹è½½: <code>https://unpkg.com/react@16.8.6/cjs/react.production.min.js</code> æˆ–è€… <code>https://cdn.jsdelivr.net/npm/@babel/runtime@7.3.1/helpers/interopRequireDefault.js</code></li></ul><p><br></p><hr><p><br></p><h3 id="transpilation"><a href="#transpilation" class="headerlink" title="Transpilation"></a>Transpilation</h3><p>è®²å®Œ Packager ç°åœ¨æ¥çœ‹ä¸€ä¸‹ Transpilation, è¿™ä¸ªé˜¶æ®µ<strong>ä»åº”ç”¨çš„å…¥å£æ–‡ä»¶å¼€å§‹, å¯¹æºä»£ç è¿›è¡Œè½¬è¯‘, è§£æASTï¼Œæ‰¾å‡ºä¸‹çº§ä¾èµ–æ¨¡å—ï¼Œç„¶åé€’å½’è½¬è¯‘ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªâ€™ä¾èµ–å›¾â€™</strong>:</p><center><br>  <img src="/images/08/transpile-dependency-graph.png"><br></center><p>CodeSandbox çš„æ•´ä¸ªè½¬è¯‘å™¨æ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„ iframe ä¸­è¿è¡Œçš„ï¼š</p><center><br>  <img src="/images/08/editor-vs-compiler.png"><br></center><p>Editor è´Ÿè´£å˜æ›´æºä»£ç ï¼Œæºä»£ç å˜æ›´ä¼šé€šè¿‡ postmessage ä¼ é€’ç»™ Compilerï¼Œè¿™é‡Œé¢ä¼šæºå¸¦ <code>Module+template</code></p><ul><li><strong>Module</strong> ä¸­åŒ…å«æ‰€æœ‰æºä»£ç å†…å®¹å’Œæ¨¡å—è·¯å¾„ï¼Œå…¶ä¸­è¿˜åŒ…å« package.json, Compiler ä¼šæ ¹æ® package.json æ¥è¯»å– npm ä¾èµ–;</li><li><strong>template</strong> è¡¨ç¤º Compiler çš„ Presetï¼Œä¾‹å¦‚<code>create-react-app</code>ã€<code>vue-cli</code>, å®šä¹‰äº†ä¸€äº› loader è§„åˆ™ï¼Œç”¨æ¥è½¬è¯‘ä¸åŒç±»å‹çš„æ–‡ä»¶, å¦å¤–presetä¹Ÿå†³å®šäº†åº”ç”¨çš„æ¨¡æ¿å’Œå…¥å£æ–‡ä»¶ã€‚ é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“, è¿™äº› template ç›®å‰çš„é¢„å®šä¹‰çš„.</li></ul><p><br></p><h4 id="åŸºæœ¬å¯¹è±¡"><a href="#åŸºæœ¬å¯¹è±¡" class="headerlink" title="åŸºæœ¬å¯¹è±¡"></a>åŸºæœ¬å¯¹è±¡</h4><p>åœ¨è¯¦ç»†ä»‹ç» Transpilation ä¹‹å‰å…ˆå¤§æ¦‚çœ‹ä¸€äº›åŸºæœ¬å¯¹è±¡ï¼Œäº†è§£è¿™äº›å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼š</p><center><br> <img src="/images/08/baseobj.png"><br></center><ul><li><strong>Manager</strong> è¿™æ˜¯ Sandbox çš„æ ¸å¿ƒå¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç†é…ç½®ä¿¡æ¯(Preset)ã€é¡¹ç›®ä¾èµ–(Manifest)ã€ä»¥åŠç»´æŠ¤é¡¹ç›®æ‰€æœ‰æ¨¡å—(TranspilerModule)</li><li><strong>Manifest</strong> é€šè¿‡ä¸Šæ–‡çš„ Packager æˆ‘ä»¬çŸ¥é“ï¼ŒManifest ç»´æŠ¤æ‰€æœ‰ä¾èµ–çš„ npm æ¨¡å—ä¿¡æ¯</li><li><strong>TranspiledModule</strong> è¡¨ç¤ºæ¨¡å—æœ¬èº«ã€‚è¿™é‡Œé¢ç»´æŠ¤è½¬è¯‘çš„ç»“æœã€ä»£ç æ‰§è¡Œçš„ç»“æœã€ä¾èµ–çš„æ¨¡å—ä¿¡æ¯ï¼Œè´Ÿè´£é©±åŠ¨å…·ä½“æ¨¡å—çš„è½¬è¯‘(è°ƒç”¨ Transpiler)å’Œæ‰§è¡Œ</li><li><strong>Preset</strong> ä¸€ä¸ªé¡¹ç›®æ„å»ºæ¨¡æ¿ï¼Œä¾‹å¦‚ <code>vue-cli</code>ã€<code>create-react-app</code>. é…ç½®äº†é¡¹ç›®æ–‡ä»¶çš„è½¬è¯‘è§„åˆ™, ä»¥åŠåº”ç”¨çš„ç›®å½•ç»“æ„(å…¥å£æ–‡ä»¶)</li><li><strong>Transpiler</strong> ç­‰ä»·äº Webpack çš„ loaderï¼Œè´Ÿè´£å¯¹æŒ‡å®šç±»å‹çš„æ–‡ä»¶è¿›è¡Œè½¬è¯‘ã€‚ä¾‹å¦‚ babelã€typescriptã€pugã€sass ç­‰ç­‰</li><li><strong>WorkerTranspiler</strong> è¿™æ˜¯ Transpiler çš„å­ç±»ï¼Œè°ƒåº¦ä¸€ä¸ª Workeræ± æ¥æ‰§è¡Œè½¬è¯‘ä»»åŠ¡ï¼Œä»è€Œæé«˜è½¬è¯‘çš„æ€§èƒ½</li></ul><p><br></p><h4 id="manager"><a href="#manager" class="headerlink" title="Manager"></a>Manager</h4><p>Manageræ˜¯ä¸€ä¸ªç®¡ç†è€…çš„è§’è‰²ï¼Œä»å¤§å±€ä¸ŠæŠŠæ§æ•´ä¸ªè½¬è¯‘å’Œæ‰§è¡Œçš„æµç¨‹. ç°åœ¨æ¥çœ‹çœ‹æ•´ä½“çš„è½¬è¯‘æµç¨‹ï¼š</p><center><br> <img src="/images/08/compiler.png"><br></center><p>å¤§å±€ä¸ŠåŸºæœ¬ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å››ä¸ªé˜¶æ®µ:</p><ul><li><strong>é…ç½®é˜¶æ®µ</strong>ï¼šé…ç½®é˜¶æ®µä¼šåˆ›å»º Preset å¯¹è±¡ï¼Œç¡®å®šå…¥å£æ–‡ä»¶ç­‰ç­‰. CodeSandbox ç›®å‰åªæ”¯æŒé™å®šçš„å‡ ç§åº”ç”¨æ¨¡æ¿ï¼Œä¾‹å¦‚ vue-cliã€create-react-appã€‚ä¸åŒæ¨¡æ¿ä¹‹é—´ç›®å½•ç»“æ„çš„çº¦å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¾‹å¦‚å…¥å£æ–‡ä»¶å’Œ html æ¨¡æ¿æ–‡ä»¶ã€‚å¦å¤–æ–‡ä»¶å¤„ç†çš„è§„åˆ™ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ vue-cli éœ€è¦å¤„ç†<code>.vue</code>æ–‡ä»¶ã€‚</li><li><strong>ä¾èµ–ä¸‹è½½é˜¶æ®µ</strong>ï¼š å³ Packager é˜¶æ®µï¼Œä¸‹è½½é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œç”Ÿæˆ Manifest å¯¹è±¡</li><li><strong>å˜åŠ¨è®¡ç®—é˜¶æ®µ</strong>ï¼šæ ¹æ® Editor ä¼ é€’è¿‡æ¥çš„æºä»£ç ï¼Œè®¡ç®—æ–°å¢ã€æ›´æ–°ã€ç§»é™¤çš„æ¨¡å—ã€‚</li><li><strong>è½¬è¯‘é˜¶æ®µ</strong>ï¼šçœŸæ­£å¼€å§‹è½¬è¯‘äº†ï¼Œé¦–å…ˆé‡æ–°è½¬è¯‘ä¸Šä¸ªé˜¶æ®µè®¡ç®—å‡ºæ¥çš„éœ€è¦æ›´æ–°çš„æ¨¡å—ã€‚æ¥ç€ä»å…¥å£æ–‡ä»¶ä½œä¸ºå‡ºå‘ç‚¹ï¼Œè½¬è¯‘å’Œæ„å»ºæ–°çš„ä¾èµ–å›¾ã€‚è¿™é‡Œä¸ä¼šé‡å¤è½¬è¯‘æ²¡æœ‰å˜åŒ–çš„æ¨¡å—ä»¥åŠå…¶å­æ¨¡å—</li></ul><p><br><br><br></p><h4 id="transpiledmodule"><a href="#transpiledmodule" class="headerlink" title="TranspiledModule"></a>TranspiledModule</h4><p>TranspiledModuleç”¨äºç®¡ç†æŸä¸ªå…·ä½“çš„æ¨¡å—ï¼Œè¿™é‡Œé¢ä¼šç»´æŠ¤è½¬è¯‘å’Œè¿è¡Œçš„ç»“æœã€æ¨¡å—çš„ä¾èµ–ä¿¡æ¯ï¼Œå¹¶é©±åŠ¨æ¨¡å—çš„è½¬è¯‘å’Œæ‰§è¡Œï¼š</p><center><br> <img src="/images/08/transpiled-module.png"><br></center><p>TranspiledModule ä¼šä»Presetä¸­è·å–åŒ¹é…å½“å‰æ¨¡å—çš„Transpileråˆ—è¡¨çš„ï¼Œéå†Transpilerå¯¹æºä»£ç è¿›è¡Œè½¬è¯‘ï¼Œè½¬è¯‘çš„è¿‡ç¨‹ä¸­ä¼šè§£æASTï¼Œåˆ†ææ¨¡å—å¯¼å…¥è¯­å¥, æ”¶é›†æ–°çš„ä¾èµ–; å½“æ¨¡å—è½¬è¯‘å®Œæˆåï¼Œä¼šé€’å½’è½¬è¯‘ä¾èµ–åˆ—è¡¨ã€‚ æ¥çœ‹çœ‹å¤§æ¦‚çš„ä»£ç ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> transpile(manager: Manager) &#123;</span><br><span class="line">  <span class="comment">// å·²è½¬è¯‘</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.source)  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  <span class="comment">// é¿å…é‡å¤è½¬è¯‘, ä¸€ä¸ªæ¨¡å—åªè½¬è¯‘ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">if</span> (manager.transpileJobs[<span class="keyword">this</span>.getId()]) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  manager.transpileJobs[<span class="keyword">this</span>.getId()] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...é‡ç½®çŠ¶æ€ </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ä»Presetè·å–Transpileråˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> transpilers = manager.preset.getLoaders(<span class="keyword">this</span>.module, <span class="keyword">this</span>.query);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ é“¾å¼è°ƒç”¨Transpiler</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; transpilers.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> transpilerConfig = transpilers[i];</span><br><span class="line">    <span class="comment">// ğŸ”´æ„å»ºLoaderContextï¼Œè§ä¸‹æ–‡</span></span><br><span class="line">    <span class="keyword">const</span> loaderContext = <span class="keyword">this</span>.getLoaderContext(</span><br><span class="line">      manager,</span><br><span class="line">      transpilerConfig.options || &#123;&#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”´è°ƒç”¨Transpilerè½¬è¯‘æºä»£ç </span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      transpiledCode,</span><br><span class="line">      sourceMap,</span><br><span class="line">    &#125; = <span class="keyword">await</span> transpilerConfig.transpiler.transpile(code, loaderContext); <span class="comment">// eslint-disable-line no-await-in-loop</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.errors.length) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">this</span>.errors[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.logWarnings();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">    <span class="keyword">this</span>.asyncDependencies.map(<span class="keyword">async</span> p =&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tModule = <span class="keyword">await</span> p;</span><br><span class="line">        <span class="keyword">this</span>.dependencies.add(tModule);</span><br><span class="line">        tModule.initiators.add(<span class="keyword">this</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">/* let this handle at evaluation */</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">this</span>.asyncDependencies = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´é€’å½’è½¬è¯‘ä¾èµ–çš„æ¨¡å—</span></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">    flattenDeep([</span><br><span class="line">      ...Array.from(<span class="keyword">this</span>.transpilationInitiators).map(<span class="function"><span class="params">t</span> =&gt;</span></span><br><span class="line">        t.transpile(manager)</span><br><span class="line">      ),</span><br><span class="line">      ...Array.from(<span class="keyword">this</span>.dependencies).map(<span class="function"><span class="params">t</span> =&gt;</span> t.transpile(manager)),</span><br><span class="line">    ])</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h4 id="transpiler"><a href="#transpiler" class="headerlink" title="Transpiler"></a>Transpiler</h4><p>Transpilerç­‰ä»·äºwebpackçš„loaderï¼Œå®ƒé…ç½®æ–¹å¼ä»¥åŠåŸºæœ¬APIä¹Ÿå’Œwebpack(æŸ¥çœ‹<a href="https://webpack.docschina.org/api/loaders/" target="_blank" rel="noopener">webpackçš„loader API</a>)å¤§æ¦‚ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚é“¾å¼è½¬è¯‘å’Œloader-context. æ¥çœ‹ä¸€ä¸‹Transpilerçš„åŸºæœ¬å®šä¹‰ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">abstract</span> <span class="keyword">class</span> Transpiler &#123;</span><br><span class="line">  initialize() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  dispose() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  cleanModule(loaderContext: LoaderContext) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ ä»£ç è½¬æ¢</span></span><br><span class="line">  transpile(</span><br><span class="line">    code: <span class="built_in">string</span>,</span><br><span class="line">    loaderContext: LoaderContext</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;TranspilerResult&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.doTranspilation(code, loaderContext);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ğŸ”´ æŠ½è±¡æ–¹æ³•ï¼Œç”±å…·ä½“å­ç±»å®ç°</span></span><br><span class="line">  <span class="keyword">abstract</span> doTranspilation(</span><br><span class="line">    code: <span class="built_in">string</span>,</span><br><span class="line">    loaderContext: LoaderContext</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;TranspilerResult&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Transpilerçš„æ¥å£å¾ˆç®€å•ï¼Œ<code>transpile</code>æ¥å—ä¸¤ä¸ªå‚æ•°: </p><ul><li><code>code</code>å³æºä»£ç .</li><li><p><code>loaderContext</code> ç”±TranspiledModuleæä¾›, å¯ä»¥ç”¨æ¥è®¿é—®ä¸€ä¸‹è½¬è¯‘ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚Transpilerçš„é…ç½®ã€ æ¨¡å—æŸ¥æ‰¾ã€æ³¨å†Œä¾èµ–ç­‰ç­‰ã€‚å¤§æ¦‚å¤–å½¢å¦‚ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LoaderContext = &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´ ä¿¡æ¯æŠ¥å‘Š</span></span><br><span class="line">  emitWarning: <span class="function">(<span class="params">warning: WarningStructure</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  emitError: <span class="function">(<span class="params">error: <span class="built_in">Error</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  emitModule: <span class="function">(<span class="params">title: <span class="built_in">string</span>, code: <span class="built_in">string</span>, currentPath?: <span class="built_in">string</span>, overwrite?: <span class="built_in">boolean</span>, isChild?: <span class="built_in">boolean</span></span>) =&gt;</span> TranspiledModule;</span><br><span class="line">  emitFile: <span class="function">(<span class="params">name: <span class="built_in">string</span>, content: <span class="built_in">string</span>, sourceMap: SourceMap</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// ğŸ”´ é…ç½®ä¿¡æ¯</span></span><br><span class="line">  options: &#123;</span><br><span class="line">    context: <span class="built_in">string</span>;</span><br><span class="line">    config?: object;</span><br><span class="line">    [key: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  sourceMap: <span class="built_in">boolean</span>;</span><br><span class="line">  target: <span class="built_in">string</span>;</span><br><span class="line">  path: <span class="built_in">string</span>;</span><br><span class="line">  addTranspilationDependency: <span class="function">(<span class="params">depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; isEntry?: <span class="built_in">boolean</span>; &#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  resolveTranspiledModule: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; ignoredExtensions?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;; &#125;</span>) =&gt;</span> TranspiledModule;</span><br><span class="line">  resolveTranspiledModuleAsync: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; ignoredExtensions?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;; &#125;</span>) =&gt;</span> <span class="built_in">Promise</span>&lt;TranspiledModule&gt;;</span><br><span class="line">   <span class="comment">// ğŸ”´ ä¾èµ–æ”¶é›†</span></span><br><span class="line">  addDependency: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; isEntry?: <span class="built_in">boolean</span>; &#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  addDependenciesInDirectory: <span class="function">(<span class="params"> depPath: <span class="built_in">string</span>, options?: &#123; isAbsolute?: <span class="built_in">boolean</span>; isEntry?: <span class="built_in">boolean</span>; &#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  _module: TranspiledModule;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><p><br><br><br></p><p>å…ˆä»ç®€å•çš„å¼€å§‹ï¼Œæ¥çœ‹çœ‹JSONæ¨¡å—çš„Transpilerå®ç°, æ¯ä¸ªTranspilerå­ç±»éœ€è¦å®ç°doTranspilationï¼Œæ¥æ”¶æºä»£ç ï¼Œå¹¶å¼‚æ­¥è¿”å›å¤„ç†ç»“æœï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> JSONTranspiler <span class="keyword">extends</span> Transpiler &#123;</span><br><span class="line">  doTranspilation(code: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="string">`</span></span><br><span class="line"><span class="string">      module.exports = JSON.parse(<span class="subst">$&#123;JSON.stringify(code || '')&#125;</span>)</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(&#123;</span><br><span class="line">      transpiledCode: result,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h4 id="babeltranspiler"><a href="#babeltranspiler" class="headerlink" title="BabelTranspiler"></a>BabelTranspiler</h4><p>å¹¶ä¸æ˜¯æ‰€æœ‰æ¨¡å—éƒ½åƒJSONè¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚Typescriptå’ŒBabelã€‚ ä¸ºäº†æé«˜è½¬è¯‘çš„æ•ˆç‡ï¼ŒCodesandboxä¼šåˆ©ç”¨Workeræ¥è¿›è¡Œå¤šè¿›ç¨‹è½¬è¯‘ï¼Œå¤šWorkerçš„è°ƒåº¦å·¥ä½œç”±<code>WorkerTranspiler</code>å®Œæˆï¼Œè¿™æ˜¯Transpilerçš„å­ç±»ï¼Œç»´æŠ¤äº†ä¸€ä¸ªWorkeræ± ã€‚Babelã€Typescriptã€Sassè¿™ç±»å¤æ‚çš„è½¬è¯‘ä»»åŠ¡éƒ½æ˜¯åŸºäºWorkerTranspilerå®ç°çš„ï¼š</p><center><br> <img src="/images/08/transpiler.png"><br></center><p><br></p><p>å…¶ä¸­æ¯”è¾ƒå…¸å‹çš„å®ç°æ˜¯BabelTranspiler, åœ¨Sandboxå¯åŠ¨æ—¶å°±ä¼šé¢„å…ˆforkä¸‰ä¸ªworkerï¼Œæ¥æé«˜è½¬è¯‘å¯åŠ¨çš„é€Ÿåº¦, BabelTranspilerä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸‰ä¸ªworkeræ¥åˆå§‹åŒ–Workeræ± ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨worker-loader forkä¸‰ä¸ªloaderï¼Œç”¨äºå¤„ç†babelç¼–è¯‘</span></span><br><span class="line"><span class="keyword">import</span> BabelWorker <span class="keyword">from</span> <span class="string">'worker-loader?publicPath=/&amp;name=babel-transpiler.[hash:8].worker.js!./eval/transpilers/babel/worker/index.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.babelworkers = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">window</span>.babelworkers.push(<span class="keyword">new</span> BabelWorker());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿™é‡Œé¢ä½¿ç”¨åˆ°äº†webpackçš„<a href="https://github.com/webpack-contrib/worker-loader" target="_blank" rel="noopener">worker-loader</a>, å°†æŒ‡å®šæ¨¡å—å°è£…ä¸º Worker å¯¹è±¡ã€‚è®© Worker æ›´å®¹æ˜“ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> Worker <span class="keyword">from</span> <span class="string">"./file.worker.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> Worker();</span><br><span class="line"></span><br><span class="line">worker.postMessage(&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;);</span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">worker.addEventListener(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>BabelTranpilerå…·ä½“çš„æµç¨‹å¦‚ä¸‹:</p><center><br><img src="/images/08/babel-transpiler.png"><br></center><p>WorkerTranspilerä¼šç»´æŠ¤<code>ç©ºé—²çš„Workeré˜Ÿåˆ—</code>å’Œä¸€ä¸ª<code>ä»»åŠ¡é˜Ÿåˆ—</code>, å®ƒçš„å·¥ä½œå°±æ˜¯é©±åŠ¨Workeræ¥æ¶ˆè´¹ä»»åŠ¡é˜Ÿåˆ—ã€‚å…·ä½“çš„è½¬è¯‘å·¥ä½œåœ¨Workerä¸­è¿›è¡Œï¼š</p><center><br><img src="/images/08/babel-worker.png"><br></center><p><br></p><hr><p><br></p><h3 id="evaluation"><a href="#evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h3><p>è™½ç„¶ç§°ä¸ºæ‰“åŒ…å™¨(bundler), ä½†æ˜¯ CodeSandbox å¹¶ä¸ä¼šè¿›è¡Œæ‰“åŒ…ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä¸ä¼šåƒ Webpack ä¸€æ ·ï¼Œå°†æ‰€æœ‰çš„æ¨¡å—éƒ½æ‰“åŒ…åˆå¹¶æˆ chunks æ–‡ä»¶.</p><p><code>Transpilation</code>ä»<code>å…¥å£æ–‡ä»¶</code>å¼€å§‹è½¬è¯‘, å†åˆ†ææ–‡ä»¶çš„æ¨¡å—å¯¼å…¥è§„åˆ™ï¼Œé€’å½’è½¬è¯‘ä¾èµ–çš„æ¨¡å—. åˆ°<code>Evaluation</code>é˜¶æ®µï¼ŒCodeSandbox å·²ç»æ„å»ºå‡ºäº†ä¸€ä¸ªå®Œæ•´çš„<strong>ä¾èµ–å›¾</strong>. ç°åœ¨è¦æŠŠåº”ç”¨è·‘èµ·æ¥äº†ğŸƒ</p><p><img src="/images/08/dependency-graph.png" alt></p><p>Evaluation çš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå’Œ Transpilation ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä»å…¥å£æ–‡ä»¶å¼€å§‹: <strong>ä½¿ç”¨<code>eval</code>æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨äº†<code>require</code>ï¼Œåˆ™é€’å½’ eval è¢«ä¾èµ–çš„æ¨¡å—</strong>ã€‚</p><p>å¦‚æœä½ äº†è§£è¿‡ Node çš„æ¨¡å—å¯¼å…¥åŸç†ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="/images/08/evaluation.png" alt></p><ul><li>â‘  é¦–å…ˆè¦åˆå§‹åŒ– htmlï¼Œæ‰¾åˆ°<code>index.html</code>æ–‡ä»¶ï¼Œå°† document.body.innerHTML è®¾ç½®ä¸º html æ¨¡æ¿çš„ body å†…å®¹.</li><li>â‘¡ æ³¨å…¥å¤–éƒ¨èµ„æºã€‚ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ä¸€äº›å¤–éƒ¨é™æ€æ–‡ä»¶ï¼Œä¾‹å¦‚ css å’Œ jsï¼Œè¿™äº›éœ€è¦ append åˆ° head ä¸­</li><li>â‘¢ evaluate å…¥å£æ¨¡å—</li><li><p>â‘£ æ‰€æœ‰æ¨¡å—éƒ½ä¼šè¢«è½¬è¯‘æˆ CommonJS æ¨¡å—è§„èŒƒã€‚æ‰€ä»¥éœ€è¦æ¨¡æ‹Ÿè¿™ä¸ªæ¨¡å—ç¯å¢ƒã€‚å¤§æ¦‚çœ‹ä¸€ä¸‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°requireæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path: string</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... æ‹¦æˆªä¸€äº›ç‰¹æ®Šæ¨¡å—</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨Managerå¯¹è±¡ä¸­æŸ¥æ‰¾æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> requiredTranspiledModule = manager.resolveTranspiledModule(</span><br><span class="line">    path,</span><br><span class="line">    localModule.path</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¨¡å—ç¼“å­˜, å¦‚æœå­˜åœ¨ç¼“å­˜åˆ™è¯´æ˜ä¸éœ€è¦é‡æ–°æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">const</span> cache = requiredTranspiledModule.compilation;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> cache</span><br><span class="line">    ? cache.exports</span><br><span class="line">    : <span class="comment">// ğŸ”´é€’å½’evaluate</span></span><br><span class="line">      manager.evaluateTranspiledModule(</span><br><span class="line">        requiredTranspiledModule,</span><br><span class="line">        transpiledModule</span><br><span class="line">      );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°require.resolve</span></span><br><span class="line"><span class="built_in">require</span>.resolve = <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">path: string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> manager.resolveModule(path, localModule.path).path;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿä¸€äº›å…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> globals = &#123;&#125;;</span><br><span class="line">globals.__dirname = pathUtils.dirname(<span class="keyword">this</span>.module.path);</span><br><span class="line">globals.__filename = <span class="keyword">this</span>.module.path;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´æ”¾ç½®æ‰§è¡Œç»“æœï¼Œå³CommonJSçš„moduleå¯¹è±¡</span></span><br><span class="line"><span class="keyword">this</span>.compilation = &#123;</span><br><span class="line">  id: <span class="keyword">this</span>.getId(),</span><br><span class="line">  exports: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´eval</span></span><br><span class="line"><span class="keyword">const</span> exports = evaluate(</span><br><span class="line">  <span class="keyword">this</span>.source.compiledCode,</span><br><span class="line">  <span class="built_in">require</span>,</span><br><span class="line">  <span class="keyword">this</span>.compilation,</span><br><span class="line">  manager.envVariables,</span><br><span class="line">  globals</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>â‘¤ ä½¿ç”¨ eval æ¥æ‰§è¡Œæ¨¡å—ã€‚åŒæ ·çœ‹çœ‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">code, require, module, env = &#123;&#125;, globals = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> exports = <span class="built_in">module</span>.exports;</span><br><span class="line">  <span class="keyword">const</span> global = g;</span><br><span class="line">  <span class="keyword">const</span> process = buildProcess(env);</span><br><span class="line">  g.global = global;</span><br><span class="line">  <span class="keyword">const</span> allGlobals = &#123;</span><br><span class="line">    <span class="built_in">require</span>,</span><br><span class="line">    <span class="built_in">module</span>,</span><br><span class="line">    exports,</span><br><span class="line">    process,</span><br><span class="line">    setImmediate: requestFrame,</span><br><span class="line">    global,</span><br><span class="line">    ...globals</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> allGlobalKeys = <span class="built_in">Object</span>.keys(allGlobals);</span><br><span class="line">  <span class="keyword">const</span> globalsCode = allGlobalKeys.length ? allGlobalKeys.join(<span class="string">", "</span>) : <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">const</span> globalsValues = allGlobalKeys.map(<span class="function"><span class="params">k</span> =&gt;</span> allGlobals[k]);</span><br><span class="line">  <span class="comment">// ğŸ”´å°†ä»£ç å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸‹é¢ï¼Œå…¨å±€å˜é‡ä»¥å‡½æ•°å½¢å¼ä¼ å…¥</span></span><br><span class="line">  <span class="keyword">const</span> newCode = <span class="string">`(function evaluate(`</span> + globalsCode + <span class="string">`) &#123;`</span> + code + <span class="string">`\n&#125;)`</span>;</span><br><span class="line">  (<span class="number">0</span>, <span class="built_in">eval</span>)(newCode).apply(<span class="keyword">this</span>, globalsValues);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>Okï¼åˆ°è¿™é‡Œ Evaluation å°±è§£é‡Šå®Œäº†ï¼Œå®é™…çš„ä»£ç æ¯”è¿™é‡Œè¦å¤æ‚å¾—å¤šï¼Œæ¯”å¦‚ HMR(hot module replacement)æ”¯æŒ, æœ‰å…´è¶£çš„è¯»è€…ï¼Œå¯ä»¥è‡ªå·±å»çœ‹ CodeSandbox çš„æºç .</p><p><br></p><hr><p><br></p><h2 id="æŠ€æœ¯åœ°å›¾"><a href="#æŠ€æœ¯åœ°å›¾" class="headerlink" title="æŠ€æœ¯åœ°å›¾"></a>æŠ€æœ¯åœ°å›¾</h2><p>ä¸€ä¸å°å¿ƒåˆå†™äº†ä¸€ç¯‡é•¿æ–‡ï¼Œè¦æŠŠè¿™ä¹ˆå¤æ‚ä»£ç è®²æ¸…æ¥šçœŸæ˜¯ä¸€ä¸ªæŒ‘æˆ˜, æˆ‘è¿˜åšçš„ä¸å¤Ÿå¥½ï¼ŒæŒ‰ç…§ä»¥å¾€çš„ç»éªŒï¼Œè¿™åˆæ˜¯ä¸€ç¯‡æ— äººé—®æ´¥çš„æ–‡ç« , åˆ«è¯´æ˜¯ä½ ä»¬, æˆ‘è‡ªå·±éƒ½ä¸æ€ä¹ˆæœ‰è€å¿ƒçœ‹è¿™ç±»æ–‡ç« , åé¢è¿˜æ˜¯å°½é‡é¿å…å§!</p><ul><li>worker-loader: å°†æŒ‡å®šæ¨¡å—å°è£…ä¸ºWorker</li><li>babel: JavaScriptä»£ç è½¬è¯‘ï¼Œæ”¯æŒES, Flow, Typescript</li><li>browserfs: åœ¨æµè§ˆå™¨ä¸­æ¨¡æ‹ŸNodeç¯å¢ƒ</li><li>localForage: å®¢æˆ·ç«¯å­˜å‚¨åº“ï¼Œä¼˜å…ˆä½¿ç”¨(IndexedDB or WebSQL)è¿™äº›å¼‚æ­¥å­˜å‚¨æ–¹æ¡ˆï¼Œæä¾›ç±»LocalStorageçš„æ¥å£</li><li>lru-cache: least-recently-usedç¼“å­˜</li></ul><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://hackernoon.com/how-i-created-a-parallel-offline-extensible-browser-based-bundler-886db508cc31" target="_blank" rel="noopener">Creating a parallel, offline, extensible, browser based bundler for CodeSandbox</a></li><li><a href="https://www.youtube.com/watch?v=qURPenhndYA" target="_blank" rel="noopener">year of CodeSandbox - Ives van Hoorne aka @CompuIves at @ReactEurope 2018</a></li><li><a href="https://hackernoon.com/how-we-make-npm-packages-work-in-the-browser-announcing-the-new-packager-6ce16aa4cee6" target="_blank" rel="noopener">How we make npm packages work in the browser</a></li><li><a href="https://github.com/codesandbox/dependency-packager" target="_blank" rel="noopener">codesandbox/dependency-packager</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æœŸæ¥å…³æ³¨ä¸€ä¸‹&lt;a href=&quot;https://codesandbox.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;CodeSandbox&lt;/code&gt;&lt;/a&gt;, è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„æ²™ç›’è¿è¡Œç¯å¢ƒï¼Œæ”¯æŒå¤šç§æµè¡Œçš„æ„å»ºæ¨¡æ¿ï¼Œä¾‹å¦‚ &lt;code
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Reactæ€§èƒ½æµ‹é‡å’Œåˆ†æ</title>
    <link href="https://bobi.ink/2019/06/16/react-performance-analyze/"/>
    <id>https://bobi.ink/2019/06/16/react-performance-analyze/</id>
    <published>2019-06-15T16:00:00.000Z</published>
    <updated>2019-06-16T23:00:08.422Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡<a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">æ–‡ç« </a>è®²äº† React æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ–¹å‘å’Œæ‰‹æ®µï¼Œè¿™ç¯‡æ–‡ç« å†è¡¥å……è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œæ€§èƒ½æµ‹é‡å’Œåˆ†æ, ä»‹ç» React æ€§èƒ½åˆ†æçš„ä¸€äº›å·¥å…·å’Œæ–¹æ³•.</p><p>è¿›è¡Œä»»ä½•æ€§èƒ½ä¼˜åŒ–çš„å‰ææ˜¯ä½ è¦æ‰¾å‡ºâ€™æ€§èƒ½é—®é¢˜â€˜ï¼Œè¿™æ ·æ‰èƒ½é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ã€‚æˆ‘è§‰å¾—å¯¹äº React çš„æ€§èƒ½ä¼˜åŒ–å¯ä»¥åˆ†ä¸¤ä¸ªé˜¶æ®µ:</p><ul><li><p><strong>1. åˆ†æé˜¶æ®µ</strong></p><ul><li>é€šè¿‡åˆ†æå™¨(Profiler)æ‰¾å‡ºé‡æ–°æ¸²æŸ“çš„ç»„ä»¶ã€é‡æ–°æ¸²æŸ“çš„æ¬¡æ•°ã€ä»¥åŠé‡æ–°æ¸²æŸ“è€—è´¹çš„èµ„æºä¸æ—¶é—´</li><li>å˜åŠ¨æ£€æµ‹. é€šè¿‡åˆ†æå™¨æˆ‘ä»¬å¯ä»¥çŸ¥é“â€™ä»€ä¹ˆè¢«é‡æ–°æ¸²æŸ“, é‡æ–°æ¸²æŸ“çš„ä»£ä»·â€™ï¼Œé‚£ä¹ˆå˜åŠ¨æ£€æµ‹å›ç­”çš„é—®é¢˜å°±æ˜¯ï¼š â€™ä¸ºä»€ä¹ˆè¿™äº›è¿›è¡Œäº†é‡æ–°æ¸²æŸ“?â€™</li></ul></li><li><p><strong>2. ä¼˜åŒ–é˜¶æ®µ</strong>. ä¼˜åŒ–é˜¶æ®µæˆ‘ä»¬é’ˆå¯¹åˆ†æé˜¶æ®µæŠ›å‡ºçš„é—®é¢˜è¿›è¡Œè§£å†³ï¼Œè§£å†³çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡çš„å§Šå¦¹ç¯‡&lt;<a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a>&gt;</p></li></ul><p><br></p><p><strong>æœ¬æ–‡å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#åˆ†æå™¨">åˆ†æå™¨</a><ul><li><a href="#react-devtool">React Devtool</a><ul><li><a href="#é«˜äº®æ›´æ–°">é«˜äº®æ›´æ–°</a></li><li><a href="#åˆ†æå™¨-1">åˆ†æå™¨</a></li></ul></li><li><a href="#chrome-performance-å·¥å…·">Chrome Performance å·¥å…·</a></li><li><a href="#å…¶ä»–å·¥å…·">å…¶ä»–å·¥å…·</a></li></ul></li><li><a href="#å˜åŠ¨æ£€æµ‹">å˜åŠ¨æ£€æµ‹</a><ul><li><a href="#props-å˜åŠ¨æ£€æµ‹">props å˜åŠ¨æ£€æµ‹</a></li><li><a href="#mobx-å˜åŠ¨æ£€æµ‹">mobx å˜åŠ¨æ£€æµ‹</a></li><li><a href="#context-å˜æ›´æ£€æµ‹">Context å˜æ›´æ£€æµ‹</a></li><li><a href="#react-devtool-çš„-interactions">React Devtool çš„ Interactions</a></li></ul></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><p>ä¸‹é¢æœ¬æ–‡æµ‹è¯•çš„æ ·æ¿ä»£ç .</p><blockquote><p>æ¨èç‚¹å‡» Preview é¢æ¿çš„<code>Open In New Window</code>, æˆ–è€…ç›´æ¥ç‚¹å‡»è¯¥<a href="https://igz9h.codesandbox.io/" target="_blank" rel="noopener">é“¾æ¥</a>ï¼Œåœ¨çº¿åŠ¨æ‰‹å®è·µ</p></blockquote><iframe src="https://codesandbox.io/embed/react-performance-analyze-demo-igz9h?autoresize=1&fontsize=14" title="React-Performance-Analyze-Demo" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><a href="https://codesandbox.io/s/react-performance-analyze-demo-igz9h?fontsize=14" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit React-Performance-Analyze-Demo"></a></p><p><br><br><br></p><h2 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h2><p>åˆ†æå“ªäº›ç»„ä»¶è¿›è¡Œäº†æ¸²æŸ“ï¼Œä»¥åŠæ¸²æŸ“æ¶ˆè€—çš„æ—¶é—´ä»¥åŠèµ„æºã€‚ä¸»è¦å·¥å…·æœ‰ React å®˜æ–¹çš„å¼€å‘è€…å·¥å…·ä»¥åŠ Chrome çš„ Performance å·¥å…·ã€‚</p><h3 id="react-devtool"><a href="#react-devtool" class="headerlink" title="React Devtool"></a>React Devtool</h3><p>æœ€å…ˆåº”è¯¥ä½¿ç”¨çš„è‚¯å®šæ˜¯å®˜æ–¹æä¾›çš„å¼€å‘è€…å·¥å…·ï¼ŒReact v16.5 å¼•å…¥äº†æ–°çš„ Profiler åŠŸèƒ½ï¼Œè®©åˆ†æç»„ä»¶æ¸²æŸ“è¿‡ç¨‹å˜å¾—æ›´åŠ ç®€å•ï¼Œè€Œä¸”å¯ä»¥å¾ˆç›´è§‚åœ°æŸ¥çœ‹å“ªäº›ç»„ä»¶è¢«æ¸²æŸ“.</p><h4 id="é«˜äº®æ›´æ–°"><a href="#é«˜äº®æ›´æ–°" class="headerlink" title="é«˜äº®æ›´æ–°"></a>é«˜äº®æ›´æ–°</h4><p><strong>é¦–å…ˆæœ€ç®€å•ä¹Ÿæ˜¯æœ€æ–¹ä¾¿çš„åˆ¤æ–­ç»„ä»¶æ˜¯å¦è¢«é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ˜¯â€™é«˜äº®æ›´æ–°(Hightlight Updates)â€™</strong>.</p><p>â‘  å¼€å¯é«˜äº®æ›´æ–°:</p><center><br> <img src="/images/10/hightlight-update.png"><br></center><p>â‘¡ è¿è¡Œæ•ˆæœå¦‚ä¸‹:</p><center><br>  <img src="/images/10/hightlight-update.gif"><br></center><p>â‘¢ é€šè¿‡é«˜äº®æ›´æ–°ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šå“ªäº›ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“. æ‰€ä»¥ç°åœ¨æˆ‘ä»¬ç»™ ListItem åŠ ä¸Š React.memo(æŸ¥çœ‹ PureList ç¤ºä¾‹), çœ‹ä¸€ä¸‹æ•ˆæœ:</p><center><br> <img src="/images/10/hightlight-update-pure.gif"><br></center><p>æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œç°åœ¨åªæœ‰é€’å¢çš„ ListItem ä¼šè¢«æ›´æ–°ï¼Œè€Œä¸”å½“æ•°ç»„æ’åºæ—¶åªæœ‰ List ç»„ä»¶ä¼šè¢«åˆ·æ–°. æ‰€ä»¥è¯´â€˜çº¯ç»„ä»¶â€™æ˜¯ React ä¼˜åŒ–çš„ç¬¬ä¸€å¼ ç‰Œ, ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„ä¸€å¼ ç‰Œ.</p><p><br><br><br></p><h4 id="åˆ†æå™¨-1"><a href="#åˆ†æå™¨-1" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h4><p>å¦‚æœ<code>é«˜äº®æ›´æ–°</code>æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæ¯”å¦‚<strong>ä½ éœ€è¦çŸ¥é“å…·ä½“å“ªäº›ç»„ä»¶è¢«æ¸²æŸ“ã€æ¸²æŸ“æ¶ˆè€—å¤šå°‘æ—¶é—´ã€è¿›è¡Œäº†å¤šå°‘æ¬¡çš„æäº¤(æ¸²æŸ“)ç­‰ç­‰</strong>, è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°åˆ†æå™¨äº†.</p><p>â‘  é¦–å…ˆé€‰æ‹©éœ€è¦æ”¶é›†æµ‹é‡ä¿¡æ¯çš„èŠ‚ç‚¹(ä¸€èˆ¬é»˜è®¤é€‰ä¸­æ ¹èŠ‚ç‚¹ï¼Œæœ‰ä¸€äº›åº”ç”¨å¯èƒ½å­˜åœ¨å¤šä¸ªç»„ä»¶æ ‘ï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨é€‰æ‹©):</p><center><br> <img src="/images/10/select-profile.png"><br></center><p>â‘¡ Okï¼Œç‚¹å‡» Record å¼€å§‹æµ‹é‡</p><center><br> <img src="/images/10/start-record.gif"><br></center><p><br></p><p>â‘¢ çœ‹çœ‹æµ‹é‡çš„ç»“æœï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹ Profiler é¢æ¿çš„åŸºæœ¬ç»“æ„:</p><center><br> <img src="/images/10/profile-outline.png"><br></center><ul><li><p><strong>1ï¸âƒ£ è¿™æ˜¯ä¸€ä¸ª commit åˆ—è¡¨</strong>ã€‚commit åˆ—è¡¨è¡¨ç¤ºå½•åˆ¶æœŸé—´å‘ç”Ÿçš„ commit(å¯ä»¥è®¤ä¸ºæ˜¯æ¸²æŸ“) æ“ä½œï¼Œè¦ç†è§£ commit çš„æ„æ€è¿˜éœ€è¦äº†è§£ React æ¸²æŸ“çš„åŸºæœ¬åŸç†.</p><p>åœ¨ v16 å React ç»„ä»¶æ¸²æŸ“ä¼šåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œå³ render å’Œ commit é˜¶æ®µã€‚</p><ul><li><strong>render é˜¶æ®µå†³å®šéœ€è¦è¿›è¡Œå“ªäº›å˜æ›´ï¼Œæ¯”å¦‚ DOM</strong>ã€‚é¡¾åæ€ä¹‰, è¿™ä¸ªé˜¶æ®µ React ä¼šè°ƒç”¨ render å‡½æ•°ï¼Œå¹¶å°†ç»“æœå’Œä¸Šä¸€æ¬¡ render çš„ç»“æœè¿›è¡Œ diff, è®¡ç®—å‡ºéœ€è¦è¿›è¡Œå˜æ›´çš„æ“ä½œé˜Ÿåˆ—</li><li><strong>commit é˜¶æ®µ</strong>ã€‚æˆ–è€…ç§°ä¸ºæäº¤é˜¶æ®µ, åœ¨è¿™ä¸ªé˜¶æ®µä¼šæ‰§è¡Œ render é˜¶æ®µ diff å‡ºæ¥çš„å˜æ›´è¯·æ±‚ã€‚æ¯”å¦‚ DOM æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ã€æ’åºç­‰ç­‰ã€‚åœ¨è¿™ä¸ªé˜¶æ®µ React è¿˜ä¼šè°ƒç”¨ componentDidMount å’Œ componentDidUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°.</li></ul><p>åœ¨ v16 ä¹‹å‰ï¼Œæˆ–è€…åœ¨ Preact è¿™äº›â€™ç±» Reactâ€™ æ¡†æ¶ä¸­ï¼Œå¹¶ä¸åŒºåˆ† render é˜¶æ®µå’Œ commit é˜¶æ®µï¼Œä¹Ÿå°±è¯´è¿™ä¸¤ä¸ªé˜¶æ®µç³…åˆåœ¨ä¸€èµ·ï¼Œä¸€è¾¹ diff ä¸€è¾¹ commitã€‚æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹ç¬”è€…ä¹‹å‰å†™çš„<a href="https://juejin.im/post/5cfa29e151882539c33e4f5e" target="_blank" rel="noopener">ä» Preact ä¸­äº†è§£ç»„ä»¶å’Œ hooks åŸºæœ¬åŸç†</a><br><br></p><p>åˆ‡æ¢ commit:</p><p><img src="/images/10/profile-commit.gif" alt><br><br></p></li><li><p><strong>2ï¸âƒ£ é€‰æ‹©å…¶ä»–å›¾å½¢å±•ç¤ºå½¢å¼</strong>ï¼Œä¾‹å¦‚ <code>Ranked è§†å›¾</code>ï¼Œè¿™ä¸ªè§†å›¾æŒ‰ç…§æ¸²æŸ“æ¶ˆè€—æ—¶é—´å¯¹ç»„ä»¶è¿›è¡Œæ’åºï¼š</p><p><img src="/images/10/ranked.png" alt></p><p><br></p></li><li><p><strong>3ï¸âƒ£ ç«ç„°å›¾</strong> è¿™ä¸ªå›¾å…¶å®å°±æ˜¯<strong>ç»„ä»¶æ ‘</strong>ï¼ŒProfiler ä½¿ç”¨é¢œè‰²æ¥æ ‡è®°å“ªäº›ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“ã€‚<strong>å’Œ commit åˆ—è¡¨ä»¥åŠ Ranked å›¾ä¸€æ ·ï¼Œé¢œè‰²åœ¨è¿™é‡Œæ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ¯”å¦‚ç°è‰²è¡¨ç¤ºæ²¡æœ‰é‡æ–°æ¸²æŸ“ï¼›ä»æ¸²æŸ“æ¶ˆè€—çš„æ—¶é—´ä¸Šçœ‹çš„è¯: <code>é»‘è‰² &gt; é»„è‰² &gt; è“è‰²</code>, é€šè¿‡ ğŸ‘†Ranked å›¾å¯ä»¥ç›´è§‚æ„Ÿå—åˆ°ä¸åŒé¢œè‰²ä¹‹é—´çš„æ„ä¹‰</strong></p><p><img src="/images/10/profile-framegraph.gif" alt></p><p><br></p></li><li><p><strong>4ï¸âƒ£ å½“å‰é€‰ä¸­ç»„ä»¶æˆ–è€… Commit çš„è¯¦æƒ…</strong>, å¯ä»¥æŸ¥çœ‹è¯¥ç»„ä»¶æ¸²æŸ“æ—¶çš„ props å’Œ state</p><p><img src="/images/10/profile-props.gif" alt></p><p>åŒå‡»å…·ä½“ç»„ä»¶å¯ä»¥è¯¦ç»†æ¯”å¯¹æ¯ä¸€æ¬¡ commit æ¶ˆè€—çš„æ—¶é—´:</p><p><img src="/images/10/profile-component-detail.png" alt></p><p><br></p></li><li><p><strong>5ï¸âƒ£ è®¾ç½®</strong></p><p>å¦å¤–å¯ä»¥é€šè¿‡è®¾ç½®ï¼Œç­›é€‰ Commitï¼Œä»¥åŠæ˜¯å¦æ˜¾ç¤ºåŸç”Ÿå…ƒç´ :</p><p><img src="/images/10/profile-settings.png" alt></p></li></ul><p><br></p><p>â‘£ ç°åœ¨ä½¿ç”¨ Profiler æ¥åˆ†æä¸€ä¸‹ PureList çš„æ¸²æŸ“è¿‡ç¨‹:</p><p><img src="/images/10/profile-demo.png" alt></p><p><br></p><blockquote><p>å…³äº Profiler çš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™ç¯‡å®˜æ–¹åšå®¢&lt;<a href="https://zh-hans.reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html" target="_blank" rel="noopener">Introducing the React Profiler</a>&gt;</p></blockquote><p><br><br><br></p><h3 id="chrome-performance-å·¥å…·"><a href="#chrome-performance-å·¥å…·" class="headerlink" title="Chrome Performance å·¥å…·"></a>Chrome Performance å·¥å…·</h3><p>åœ¨ v16.5 ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯åˆ©ç”¨ Chrome è‡ªå¸¦çš„ Performance æ¥è¿›è¡Œ React æ€§èƒ½æµ‹é‡:</p><p><img src="/images/10/chrome-performance.png" alt></p><p><br></p><p>React ä½¿ç”¨æ ‡å‡†çš„<code>User Timing API</code>(æ‰€æœ‰æ”¯æŒè¯¥æ ‡å‡†çš„æµè§ˆå™¨éƒ½å¯ä»¥ç”¨æ¥åˆ†æ React)æ¥è®°å½•æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ Timings æ ‡ç­¾ä¸­æŸ¥çœ‹ React çš„æ¸²æŸ“è¿‡ç¨‹ã€‚React è¿˜ç‰¹æ„ä½¿ç”¨ emoji æ ‡è®°.</p><p>ç›¸å¯¹ React Devtool è€Œè¨€ Performance å·¥å…·å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œä½†æ˜¯å®ƒéå¸¸å¼ºå¤§ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ<strong>å¦‚æœè¯´ React-Devtool æ˜¯<a href="https://www.telerik.com/fiddler" target="_blank" rel="noopener">Fiddler</a>, é‚£ä¹ˆ Performance å°±æ˜¯<a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a>. ä½¿ç”¨ Performance å¯ä»¥ç”¨æ¥å®šä½ä¸€äº›æ¯”è¾ƒæ·±å±‚æ¬¡çš„é—®é¢˜ï¼Œè¿™å¯èƒ½éœ€è¦ä½ å¯¹ React çš„å®ç°åŸç†æœ‰ä¸€å®šäº†è§£, å°±åƒä½¿ç”¨ Wireshark ä½ éœ€è¦æ‡‚ç‚¹ç½‘ç»œåè®®ä¸€æ ·</strong></p><p>æ‰€ä»¥è¯´ä½¿ç”¨ Performance å·¥å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿:</p><ul><li>å¯ä»¥æµ‹é‡åˆ†ææ•´ä¸ªæ¸²æŸ“çš„è¿‡ç¨‹ç»†èŠ‚. å®ƒå¯ä»¥å®šä½æŸäº›å…·ä½“æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹å’Œæ¶ˆè€—, æ–¹ä¾¿å®šä½ä¸€äº›æ·±å±‚æ¬¡é—®é¢˜.</li><li>å¯ä»¥æµ‹é‡åˆ†æåº•å±‚ DOM çš„ç»˜åˆ¶ã€å¸ƒå±€ã€åˆæˆç­‰ç»†èŠ‚ã€‚æ–¹ä¾¿å®šä½æµè§ˆå™¨æ€§èƒ½é—®é¢˜</li></ul><p>å…¶å® Performance æ˜¯ä¸€ä¸ªé€šç”¨çš„æ€§èƒ½æ£€æµ‹å·¥å…·ï¼Œæ‰€ä»¥å…¶ç»†èŠ‚ä¸åœ¨æœ¬æ–‡è®¨è®ºè®¿é—®ã€‚ è¯¦ç»†å‚è€ƒ</p><ul><li><a href="https://calibreapp.com/blog/react-performance-profiling-optimization/" target="_blank" rel="noopener">Profiling React performance with React 16 and Chrome Devtools</a></li><li><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/" target="_blank" rel="noopener">Chrome å®˜æ–¹çš„ Performance ä½¿ç”¨æ–‡æ¡£</a></li></ul><p><br></p><h3 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h3><p>ä¸Šé¢ä»‹ç»çš„è¿™äº›å·¥å…·åŸºæœ¬ä¸Šå·²ç»å¤Ÿç”¨äº†ã€‚ç¤¾åŒºä¸Šè¿˜æœ‰ä¸€äº›æ¯”è¾ƒæµè¡Œçš„å·¥å…·ï¼Œä¸è¿‡è¿™äº›å·¥å…·è¿Ÿæ—©/å·²ç»è¦è¢«å®˜æ–¹å–ä»£(æ‹›å®‰)ï¼Œè€Œä¸”å®ƒä»¬ä¹Ÿè·Ÿä¸ä¸Š React çš„æ›´æ–°ã€‚</p><ul><li><a href="https://reactjs.org/docs/perf.html" target="_blank" rel="noopener">react-addons-perf</a> React v16 ä¸æ”¯æŒäº†ï¼Œä¸è¯´äº†ã€‚è€ç‰ˆæœ¬å¯ç”¨</li><li><a href="https://github.com/nitin42/react-perf-devtool" target="_blank" rel="noopener">react-perf-devtool</a> ä¹Ÿä¸æ´»è·ƒäº†ï¼Œä¸æ¨èä½¿ç”¨</li></ul><p><br></p><hr><p><br></p><h2 id="å˜åŠ¨æ£€æµ‹"><a href="#å˜åŠ¨æ£€æµ‹" class="headerlink" title="å˜åŠ¨æ£€æµ‹"></a>å˜åŠ¨æ£€æµ‹</h2><p>OK, æˆ‘ä»¬é€šè¿‡åˆ†æå·¥å…·å·²ç»çŸ¥é“æˆ‘ä»¬çš„åº”ç”¨å­˜åœ¨å“ªäº›é—®é¢˜äº†ï¼Œè¯Šæ–­å‡ºäº†å“ªäº›ç»„ä»¶è¢«æ— æ„ä¹‰çš„æ¸²æŸ“ã€‚ä¸‹ä¸€æ­¥æ“ä½œå°±æ˜¯æ‰¾å‡ºç»„ä»¶é‡æ–°æ¸²æŸ“çš„å…ƒå‡¶, æ£€æµ‹ä¸ºä»€ä¹ˆç»„ä»¶è¿›è¡Œäº†æ›´æ–°.</p><p><strong>æˆ‘ä»¬å…ˆå‡è®¾æˆ‘ä»¬çš„ç»„ä»¶æ˜¯ä¸€ä¸ªâ€™çº¯ç»„ä»¶â€˜ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¤ä¸ºåªæœ‰ç»„ä»¶ä¾èµ–çš„çŠ¶æ€å˜æ›´æ—¶ï¼Œç»„ä»¶æ‰ä¼šé‡æ–°æ¸²æŸ“</strong>. éçº¯ç»„ä»¶æ²¡æœ‰è®¨è®ºçš„æ„ä¹‰ï¼Œå› ä¸ºåªè¦çŠ¶æ€å˜æ›´æˆ–çˆ¶çº§å˜æ›´ä»–éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚</p><p><strong>é‚£ä¹ˆå¯¹äºä¸€ä¸ªâ€™çº¯ç»„ä»¶â€˜æ¥è¯´ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸‹é¢è¿™äº›å› ç´ éƒ½å¯èƒ½å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>:</p><ul><li><strong>props + state</strong> æ¯«æ— ç–‘é—®. è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨<strong>æ¥æºäºå¤–éƒ¨çš„ props</strong>. å†…éƒ¨ state å˜åŠ¨ä¸€èˆ¬æ˜¯äººä¸ºè§¦å‘çš„ï¼Œæ¯”è¾ƒå®¹æ˜“å‘ç°</li><li><strong>Mobx observable value</strong>. å¦‚æœè®¿é—®äº† mobx ä¼ è¿›æ¥çš„å“åº”å¼æ•°æ®ï¼Œå°±ä¼šå»ºç«‹ä¸€ä¸ªçŠ¶æ€ä¾èµ–å…³ç³»ï¼Œè¿™ä¸ªç›¸å¯¹äº props å’Œ context æ¥è¯´æ˜¯éšå¼çš„ï¼Œæ£€æµ‹å®ƒçš„å˜åŠ¨æˆ‘ä»¬å¯èƒ½éœ€è¦åˆ©ç”¨ mobx æä¾›çš„ä¸€äº›å·¥å…·</li><li><strong>Context</strong>ã€‚ Context çš„ value çš„å˜æ›´ä¼šå¼ºåˆ¶é‡æ–°æ¸²æŸ“ç»„ä»¶</li></ul><p><br></p><h3 id="props-å˜åŠ¨æ£€æµ‹"><a href="#props-å˜åŠ¨æ£€æµ‹" class="headerlink" title="props å˜åŠ¨æ£€æµ‹"></a>props å˜åŠ¨æ£€æµ‹</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘å°±å»ºè®®ç®€åŒ– propsï¼Œç®€å•ç»„ä»¶çš„ props çš„å˜æ›´å¾ˆå®¹æ˜“é¢„æµ‹, ç”šè‡³ä½ è‚‰çœ¼éƒ½å¯ä»¥å¯Ÿè§‰å‡ºæ¥ã€‚å¦å¤–å¦‚æœä½ ä½¿ç”¨ Reduxï¼Œå¦‚æœä¸¥æ ¼æŒ‰ç…§ Redux çš„æœ€ä½³å®è·µï¼Œé…åˆ Redux çš„å¼€å‘è€…å·¥å…·ï¼Œä¹Ÿå¯ä»¥å¾ˆç›´è§‚åœ°åˆ¤æ–­å“ªäº›çŠ¶æ€å‘ç”Ÿäº†å˜æ›´ã€‚</p><p>å¦‚æœä½ æ²¡åŠæ³•æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå¯èƒ½å°±å¾—ä¾èµ–å·¥å…·äº†ã€‚ä¹‹å‰æœ‰ä¸€ä¸ª<a href="https://github.com/maicki/why-did-you-update" target="_blank" rel="noopener">why-did-you-update</a>çš„åº“ï¼Œ<strong>å¾ˆå¯æƒœç°åœ¨å·²ç»æ²¡æ€ä¹ˆç»´æŠ¤äº†(æ—§ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨å®ƒ)</strong>ã€‚è¿™ä¸ªåº“ä½¿ç”¨çŒ´è¡¥ä¸(monkey patches)æ¥æ‰©å±• Reactï¼Œæ¯”å¯¹æ£€æµ‹å“ªäº› props å’Œ state å‘ç”Ÿäº†å˜åŒ–ï¼š</p><p><img src="/images/10/wdyu.png" alt></p><p>åé¢ä¹Ÿæœ‰äººå€Ÿé‰´ why-did-you-update å†™äº†ä¸ª<a href="https://github.com/welldone-software/why-did-you-render" target="_blank" rel="noopener">why-did-you-render</a>. ä¸è¿‡ç¬”è€…è¿˜æ˜¯ä¸çœ‹å¥½è¿™äº›é€šè¿‡çŒ´è¡¥ä¸æ‰©å±• React çš„å®ç°ï¼Œä¾èµ–äº React çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ï¼Œè·Ÿä¸ä¸Š React æ›´æ–°åŸºæœ¬å°±åºŸäº†.</p><p>å¦‚æœä½ ç°åœ¨ä½¿ç”¨ hook çš„è¯ï¼Œè‡ªå·±æ‰‹å†™ä¸€ä¸ªä¹Ÿå¾ˆç®€å•, è¿™ä¸ª idea æ¥æºäº<a href="https://github.com/devhubapp/devhub/blob/master/packages/components/src/hooks/use-why-did-you-update.ts" target="_blank" rel="noopener">use-why-did-you-update</a>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useWhyDidYouUpdate</span>(<span class="params">name: <span class="built_in">string</span>, props: Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸ä¿å­˜ä¸Šä¸€ä¸ªprops</span></span><br><span class="line">  <span class="keyword">const</span> latestProps = useRef(props);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'development'</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> allKeys = <span class="built_in">Object</span>.keys(&#123; ...latestProps.current, ...props &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> changesObj: Record&lt;<span class="built_in">string</span>, &#123; <span class="keyword">from</span>: <span class="built_in">any</span>; to: <span class="built_in">any</span> &#125;&gt; = &#123;&#125;;</span><br><span class="line">    allKeys.forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (latestProps.current[key] !== props[key]) &#123;</span><br><span class="line">        changesObj[key] = &#123; <span class="keyword">from</span>: latestProps.current[key], to: props[key] &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(changesObj).length) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[why-did-you-update]'</span>, name, changesObj);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å…¶ä»–åŸå› å¯¼è‡´ç»„ä»¶æ¸²æŸ“</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    latestProps.current = props;</span><br><span class="line">  &#125;, <span class="built_in">Object</span>.values(props));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Counter = React.memo(props =&gt; &#123;</span><br><span class="line">  useWhyDidYouUpdate(&apos;Counter&apos;, props);</span><br><span class="line">  return &lt;div style=&#123;props.style&#125;&gt;&#123;props.count&#125;&lt;/div&gt;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œå¯ä»¥åœ¨<code>componentDidUpdate</code>ä½¿ç”¨ç±»ä¼¼ä¸Šé¢çš„æ–¹å¼æ¥æ¯”è¾ƒ props</p><p><br></p><h3 id="mobx-å˜åŠ¨æ£€æµ‹"><a href="#mobx-å˜åŠ¨æ£€æµ‹" class="headerlink" title="mobx å˜åŠ¨æ£€æµ‹"></a>mobx å˜åŠ¨æ£€æµ‹</h3><p>æ’é™¤äº† props å˜æ›´å¯¼è‡´çš„é‡æ–°æ¸²æŸ“ï¼Œç°åœ¨æ¥çœ‹çœ‹æ˜¯å¦æ˜¯ mobx å“åº”å¼æ•°æ®å¯¼è‡´çš„å˜æ›´. å¦‚æœä½ ä»¬å›¢é˜Ÿä¸ä½¿ç”¨ mobxï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚</p><p><strong>é¦–å…ˆä¸ç®¡æ˜¯ Redux å’Œ Mobxï¼Œæˆ‘ä»¬éƒ½åº”è¯¥è®©çŠ¶æ€çš„å˜åŠ¨å˜å¾—å¯é¢„æµ‹</strong>. å› ä¸º Mobx æ²¡æœ‰ Redux é‚£æ ·å›ºåŒ–çš„æ•°æ®å˜æ›´æ¨¡å¼ï¼ŒMobx å¹¶ä¸å®¹æ˜“è‡ªåŠ¨åŒ–åœ°ç›‘æµ‹æ•°æ®æ˜¯å¦‚ä½•è¢«å˜æ›´çš„ã€‚åœ¨ mobx ä¸­æˆ‘ä»¬ä½¿ç”¨<code>@action</code> æ¥æ ‡å¿—çŠ¶æ€çš„å˜æ›´æ“ä½œï¼Œä½†æ˜¯å®ƒæ‹¿å¼‚æ­¥æ“ä½œæ²¡åŠæ³•ã€‚å¥½åœ¨åé¢ mobx æ¨å‡ºäº† <code>flow</code> APIğŸ‘ã€‚</p><p>å¯¹äº Mobx é¦–å…ˆå»ºè®®å¼€å¯ä¸¥æ ¼æ¨¡å¼, è¦æ±‚æ‰€æœ‰æ•°æ®å˜æ›´éƒ½æ”¾åœ¨@action æˆ– flow ä¸­:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line">configure(&#123; <span class="attr">enforceActions</span>: <span class="string">'always'</span> &#125;);</span><br></pre></td></tr></table></figure><p>å®šä¹‰çŠ¶æ€å˜æ›´æ“ä½œ</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observable, action, flow &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterStore</span> </span>&#123;</span><br><span class="line">  @observable count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒæ­¥æ“ä½œ</span></span><br><span class="line">  @action(<span class="string">'increment count'</span>)</span><br><span class="line">  increment = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.count++;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼‚æ­¥æ“ä½œ</span></span><br><span class="line">  <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œç±»ä¼¼äºsagaçš„æœºåˆ¶</span></span><br><span class="line">  fetchCount = flow(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="keyword">yield</span> getCount();</span><br><span class="line">    <span class="keyword">this</span>.count = count;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ok æœ‰äº†ä¸Šé¢çš„çº¦å®šï¼Œç°åœ¨å¯ä»¥åœ¨æ§åˆ¶å°(é€šè¿‡ mobx-logger)æˆ–è€… <a href="https://github.com/mobxjs/mobx-devtools" target="_blank" rel="noopener">Mobx å¼€å‘è€…å·¥å…·</a>ä¸­è·Ÿè¸ª Mobx å“åº”å¼æ•°æ®çš„å˜åŠ¨äº†ã€‚</p><p><img src="/images/10/mobx-devtool.png" alt></p><p><br></p><p>å¦‚æœä¸æŒ‰ç…§è§„èŒƒæ¥ï¼Œå‡ºç°é—®é¢˜ä¼šæ¯”è¾ƒæµªè´¹æ—¶é—´, ä½†ä¹Ÿä¸æ˜¯æ²¡åŠæ³•è§£å†³ã€‚Mobx è¿˜æä¾›äº†ä¸€ä¸ª<a href="https://mobx.js.org/best/trace.html" target="_blank" rel="noopener">trace</a>å‡½æ•°, ç”¨æ¥æ£€æµ‹ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ SideEffect:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ListItem = observer(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; item, onShiftDown &#125; = props;</span><br><span class="line">  trace();</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"list-item"</span>&gt;</span>&#123;/*...*/&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœ(é€’å¢äº† value å€¼):</p><p><img src="/images/10/mobx-trace.png" alt="mobx-trace"></p><p><br></p><h3 id="context-å˜æ›´æ£€æµ‹"><a href="#context-å˜æ›´æ£€æµ‹" class="headerlink" title="Context å˜æ›´æ£€æµ‹"></a>Context å˜æ›´æ£€æµ‹</h3><p>Ok, å¦‚æœæ’é™¤äº† props å’Œ mobx æ•°æ®å˜æ›´è¿˜ä¼šé‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆ 100%æ˜¯ Context å¯¼è‡´çš„ï¼Œå› ä¸ºä¸€æ—¦ Context æ•°æ®å˜åŠ¨ï¼Œç»„ä»¶å°±ä¼šè¢«å¼ºåˆ¶æ¸²æŸ“ã€‚ç¬”è€…åœ¨<a href="https://juejin.im/post/5d045350f265da1b695d5bf2#heading-14" target="_blank" rel="noopener">æµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a>æåˆ°äº† ContextAPI çš„ä¸€äº›é™·é˜±ã€‚å…ˆæ’é™¤ä¸€ä¸‹æ˜¯å¦æ˜¯è¿™äº›åŸå› å¯¼è‡´çš„.</p><p>ç°åœ¨å¹¶æ²¡æœ‰åˆé€‚çš„è·Ÿè¸ª context å˜åŠ¨çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–åƒä¸Šæ–‡çš„<code>useWhyDidYouUpdate</code>ä¸€æ ·çš„æ–¹å¼æ¥æ¯”å¯¹ Context çš„å€¼ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useIsContextUpdate</span>(<span class="params">contexts: object = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> latestContexts = useRef(contexts);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'development'</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> changedContexts: string[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> contexts) &#123;</span><br><span class="line">      <span class="keyword">if</span> (contexts[key] !== latestContexts.current[key]) &#123;</span><br><span class="line">        changedContexts.push(key);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (changedContexts.length) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`[is-context-update]: <span class="subst">$&#123;changedContexts.join(<span class="string">', '</span>)&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    latestContexts.current = contexts;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æ³•:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = useRouter();</span><br><span class="line"><span class="keyword">const</span> myContext = useContext(MyContext);</span><br><span class="line"></span><br><span class="line">useIsContextUpdate(&#123;</span><br><span class="line">  router,</span><br><span class="line">  myContext,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="react-devtool-çš„-interactions"><a href="#react-devtool-çš„-interactions" class="headerlink" title="React Devtool çš„ Interactions"></a>React Devtool çš„ Interactions</h3><p>è¿™æ˜¯ React Devtool çš„ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼ŒInteractions ç¿»è¯‘ä¸ºä¸­æ–‡æ˜¯â€˜äº¤äº’â€™ï¼Ÿè¿™ä¸ªä¸œè¥¿ç›®çš„å…¶å®å°±æ˜¯ä¸ºäº†è·Ÿè¸ªâ€˜ä»€ä¹ˆå¯¼è‡´äº†æ›´æ–°â€™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„å˜åŠ¨æ£€æµ‹ã€‚Reactå¸Œæœ›æä¾›ä¸€ä¸ªé€šç”¨çš„APIç»™å¼€å‘è€…æˆ–ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæ–¹ä¾¿å¼€å‘è€…ç›´è§‚åœ°å®šä½æ›´æ–°çš„åŸå› :</p><p><img src="/images/10/interaction.png" alt></p><p>ä¸Šå›¾è¡¨ç¤ºåœ¨è®°å½•æœŸé—´è·Ÿè¸ªåˆ°äº†å››ä¸ªäº¤äº’ï¼Œä»¥åŠäº¤äº’è§¦å‘çš„æ—¶é—´å’Œè€—æ—¶ã€‚å› ä¸ºè¿˜æ˜¯ä¸€ä¸ªIdeaé˜¶æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æŒ‘é€‰ä¸€äº›APIä»£ç éšä¾¿çœ‹çœ‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** è·Ÿè¸ªçŠ¶æ€å˜æ›´ **/</span></span><br><span class="line"><span class="keyword">import</span> &#123; unstable_trace <span class="keyword">as</span> trace &#125; <span class="keyword">from</span> <span class="string">"scheduler/tracing"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleLoginButtonClick = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è·Ÿè¸ªsetState</span></span><br><span class="line">    trace(<span class="string">"Login button click"</span>, performance.now(), () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">isLoggingIn</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è·Ÿè¸ªå¼‚æ­¥æ“ä½œ **/</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  unstable_trace <span class="keyword">as</span> trace,</span><br><span class="line">  unstable_wrap <span class="keyword">as</span> wrap</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"scheduler/tracing"</span>;</span><br><span class="line"></span><br><span class="line">trace(<span class="string">"Some event"</span>, performance.now(), () =&gt; &#123;</span><br><span class="line">  setTimeout(</span><br><span class="line">    wrap(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// Do some async work</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è·Ÿè¸ªåˆå§‹åŒ–æ¸²æŸ“ **/</span></span><br><span class="line">trace(<span class="string">"initial render"</span>, performance.now(), () =&gt; render(<span class="xml"><span class="tag">&lt;<span class="name">Application</span> /&gt;</span>));</span></span><br></pre></td></tr></table></figure><p>å¥½äº†è¡Œæ–‡ç»“æŸï¼Œå¦‚æœè§‰å¾—å¯ä»¥å°±ç‚¹ä¸ª ğŸ‘ å§</p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://zh-hans.reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html" target="_blank" rel="noopener">Introducing the React Profiler</a></li><li><a href="https://calibreapp.com/blog/react-performance-profiling-optimization/" target="_blank" rel="noopener">Profiling React performance with React 16 and Chrome Devtools.</a></li><li><a href="https://www.youtube.com/watch?v=nl8VVig_9aM" target="_blank" rel="noopener">Tools For Measuring React Performance - Brenda Jimenez @ ReactNYC</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šä¸€ç¯‡&lt;a href=&quot;https://juejin.im/post/5d045350f265da1b695d5bf2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ–‡ç« &lt;/a&gt;è®²äº† React æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ–¹å‘å’Œæ‰‹æ®µï¼Œè¿™ç¯‡æ–‡ç« å†è¡¥å……è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œæ€§èƒ½æµ‹
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</title>
    <link href="https://bobi.ink/2019/06/14/react-performance/"/>
    <id>https://bobi.ink/2019/06/14/react-performance/</id>
    <published>2019-06-13T16:00:00.000Z</published>
    <updated>2019-06-16T01:03:44.939Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ¥æºäºå…¬å¸å†…éƒ¨çš„ä¸€æ¬¡é—ªç”µåˆ†äº«ï¼Œç¨ä½œæ¶¦è‰²åˆ†äº«å‡ºæ¥ã€‚ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚<strong>å¦‚æœä½ è§‰å¾—å¯ä»¥ï¼Œè¯·å¤šç‚¹èµï¼Œé¼“åŠ±æˆ‘å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« </strong>ğŸ™ã€‚</p><p><br></p><p>React æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ä¸‰ä¸ªæ–¹å‘ï¼Œå…¶å®ä¹Ÿé€‚ç”¨äºå…¶ä»–è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œè¿™ä¸‰ä¸ªæ–¹å‘åˆ†åˆ«æ˜¯:</p><ul><li><strong>å‡å°‘è®¡ç®—çš„é‡</strong>ã€‚ -&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ æˆ–è€… é™ä½ç»„ä»¶æ¸²æŸ“çš„å¤æ‚åº¦</strong></li><li><strong>åˆ©ç”¨ç¼“å­˜</strong>ã€‚-&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>å¦‚ä½•é¿å…é‡æ–°æ¸²æŸ“ï¼Œåˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ memo æ–¹å¼æ¥é¿å…ç»„ä»¶é‡æ–°æ¸²æŸ“</strong></li><li><strong>ç²¾ç¡®é‡æ–°è®¡ç®—çš„èŒƒå›´</strong>ã€‚ å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>ç»‘å®šç»„ä»¶å’ŒçŠ¶æ€å…³ç³», ç²¾ç¡®åˆ¤æ–­æ›´æ–°çš„â€™æ—¶æœºâ€™å’Œâ€™èŒƒå›´â€™. åªé‡æ–°æ¸²æŸ“â€™è„â€™çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´é™ä½æ¸²æŸ“èŒƒå›´</strong></li></ul><p><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹é™ä½æ¸²æŸ“è®¡ç®—é‡å¤æ‚åº¦">å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡(å¤æ‚åº¦)</a><ul><li><a href="#0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—">0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</a></li><li><a href="#1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—">1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—</a></li><li><a href="#2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨">2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨</a></li><li><a href="#3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“">3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“</a></li><li><a href="#4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ">4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ</a></li></ul></li><li><a href="#é¿å…é‡æ–°æ¸²æŸ“">é¿å…é‡æ–°æ¸²æŸ“</a><ul><li><a href="#0ï¸âƒ£-ç®€åŒ–-props">0ï¸âƒ£ ç®€åŒ– props</a></li><li><a href="#1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨">1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</a></li><li><a href="#2ï¸âƒ£-ä¸å¯å˜æ•°æ®">2ï¸âƒ£ ä¸å¯å˜æ•°æ®</a></li><li><a href="#3ï¸âƒ£-ç®€åŒ–-state">3ï¸âƒ£ ç®€åŒ– state</a></li><li><a href="#4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹">4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹</a></li></ul></li><li><a href="#ç²¾ç»†åŒ–æ¸²æŸ“">ç²¾ç»†åŒ–æ¸²æŸ“</a><ul><li><a href="#0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“">0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“</a></li><li><a href="#1ï¸âƒ£-ä¸è¦æ»¥ç”¨-context">1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context</a></li></ul></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br><br><br></p><h2 id="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡-å¤æ‚åº¦"><a href="#å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡-å¤æ‚åº¦" class="headerlink" title="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡(å¤æ‚åº¦)"></a>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹/é™ä½æ¸²æŸ“è®¡ç®—é‡(å¤æ‚åº¦)</h2><p>é¦–å…ˆä»è®¡ç®—çš„é‡ä¸Šä¸‹åŠŸå¤«ï¼Œå‡å°‘èŠ‚ç‚¹æ¸²æŸ“çš„æ•°é‡æˆ–è€…é™ä½æ¸²æŸ“çš„è®¡ç®—é‡å¯ä»¥æ˜¾è‘—çš„æé«˜ç»„ä»¶æ¸²æŸ“æ€§èƒ½ã€‚</p><p><br></p><h3 id="0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—"><a href="#0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—" class="headerlink" title="0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—"></a>0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</h3><p>æ¯”å¦‚ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°(render)ä¸­è¿›è¡Œæ•°ç»„æ’åºã€æ•°æ®è½¬æ¢ã€è®¢é˜…äº‹ä»¶ã€åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ç­‰ç­‰. <strong>æ¸²æŸ“å‡½æ•°ä¸­ä¸åº”è¯¥æ”¾ç½®å¤ªå¤šå‰¯ä½œç”¨</strong></p><p><br></p><h3 id="1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—"><a href="#1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—" class="headerlink" title="1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—"></a>1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—</h3><center><br> <img src="/images/09/styled-components.png"><br></center><p>æˆ‘ä»¬å›¢é˜Ÿæ˜¯é‡åº¦çš„ <code>styled-components</code> ç”¨æˆ·ï¼Œ<strong>å…¶å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸éœ€è¦è¿™ä¸ªç©æ„</strong>ï¼Œæ¯”å¦‚çº¯é™æ€çš„æ ·å¼è§„åˆ™ï¼Œä»¥åŠéœ€è¦é‡åº¦æ€§èƒ½ä¼˜åŒ–çš„åœºæ™¯ã€‚é™¤äº†æ€§èƒ½é—®é¢˜ï¼Œå¦å¤–ä¸€ä¸ªå›°æ‰°æˆ‘ä»¬çš„æ˜¯å®ƒå¸¦æ¥çš„èŠ‚ç‚¹åµŒå¥—åœ°ç‹±(å¦‚ä¸Šå›¾)ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç†æ€§åœ°é€‰æ‹©ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚ä½¿ç”¨åŸç”Ÿçš„ CSSï¼Œå‡å°‘ React è¿è¡Œæ—¶çš„è´Ÿæ‹….</p><p><strong>ä¸€èˆ¬ä¸å¿…è¦çš„èŠ‚ç‚¹åµŒå¥—éƒ½æ˜¯æ»¥ç”¨é«˜é˜¶ç»„ä»¶/RenderProps å¯¼è‡´çš„ã€‚æ‰€ä»¥è¿˜æ˜¯é‚£å¥è¯â€˜åªæœ‰åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ xxxâ€™</strong>ã€‚ æœ‰å¾ˆå¤šç§æ–¹å¼æ¥ä»£æ›¿é«˜é˜¶ç»„ä»¶/RenderPropsï¼Œä¾‹å¦‚ä¼˜å…ˆä½¿ç”¨ propsã€React Hooks</p><p><br></p><h3 id="2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨"><a href="#2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨"></a>2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨</h3><p>è™šæ‹Ÿåˆ—è¡¨æ˜¯å¸¸è§çš„â€˜é•¿åˆ—è¡¨â€™å’Œâ€™å¤æ‚ç»„ä»¶æ ‘â€™ä¼˜åŒ–æ–¹å¼ï¼Œå®ƒä¼˜åŒ–çš„æœ¬è´¨å°±æ˜¯å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚</p><p>è™šæ‹Ÿåˆ—è¡¨åªæ¸²æŸ“å½“å‰è§†å£å¯è§å…ƒç´ :</p><center><br> <img src="/images/09/vl.png" width="500"><br></center><p>è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“æ€§èƒ½å¯¹æ¯”:</p><center><br> <img src="/images/09/vl-compare.png" width="500"><br></center><p>è™šæ‹Ÿåˆ—è¡¨å¸¸ç”¨äºä»¥ä¸‹ç»„ä»¶åœºæ™¯:</p><ul><li>æ— é™æ»šåŠ¨åˆ—è¡¨ï¼Œgrid, è¡¨æ ¼ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼Œspreadsheets</li><li>æ— é™åˆ‡æ¢çš„æ—¥å†æˆ–è½®æ’­å›¾</li><li>å¤§æ•°æ®é‡æˆ–æ— é™åµŒå¥—çš„æ ‘</li><li>èŠå¤©çª—ï¼Œæ•°æ®æµ(feed), æ—¶é—´è½´</li><li>ç­‰ç­‰</li></ul><p>ç›¸å…³ç»„ä»¶æ–¹æ¡ˆ:</p><ul><li><a href="https://github.com/bvaughn/react-virtualized" target="_blank" rel="noopener">react-virtualized</a></li><li><a href="https://github.com/bvaughn/react-window" target="_blank" rel="noopener">react-window</a> æ›´è½»é‡çš„ react-virtualized, åŒå‡ºä¸€ä¸ªä½œè€…</li><li><a href="https://github.com/bvaughn/react-virtualized#friends" target="_blank" rel="noopener">æ›´å¤š</a></li></ul><p>æ‰©å±•ï¼š</p><ul><li><a href="https://bvaughn.github.io/forward-js-2017/#/0/0" target="_blank" rel="noopener">Creating more efficient React views with windowing</a></li><li><a href="https://addyosmani.com/blog/react-window/" target="_blank" rel="noopener">Rendering large lists with react-window</a></li></ul><p><br><br><br></p><h3 id="3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“"><a href="#3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“" class="headerlink" title="3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“"></a>3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“</h3><p><strong>æƒ°æ€§æ¸²æŸ“çš„åˆè¡·æœ¬è´¨ä¸Šå’Œè™šè¡¨ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªåœ¨å¿…è¦æ—¶æ‰å»æ¸²æŸ“å¯¹åº”çš„èŠ‚ç‚¹</strong>ã€‚</p><p>ä¸¾ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸¸ç”¨ Tab ç»„ä»¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸€å¼€å§‹å°±å°†æ‰€æœ‰ Tab çš„ panel éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œè€Œæ˜¯ç­‰åˆ°è¯¥ Tab è¢«æ¿€æ´»æ—¶æ‰å»æƒ°æ€§æ¸²æŸ“ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šåœºæ™¯ä¼šç”¨åˆ°æƒ°æ€§æ¸²æŸ“ï¼Œä¾‹å¦‚æ ‘å½¢é€‰æ‹©å™¨ï¼Œæ¨¡æ€å¼¹çª—ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼ŒæŠ˜å ç»„ä»¶ç­‰ç­‰ã€‚</p><p>è¿™é‡Œå°±ä¸ä¸¾å…·ä½“çš„ä»£ç ä¾‹å­äº†ï¼Œç•™ç»™è¯»è€…å»æ€è€ƒ.</p><p><br></p><h3 id="4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ"><a href="#4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ" class="headerlink" title="4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ"></a>4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ</h3><center><br>  <img src="/images/09/style-compare.png" width="500"><br></center><p>å¦‚å›¾(å›¾ç‰‡æ¥æºäº<a href="https://blog.primehammer.com/the-performance-of-styled-react-components/" target="_blank" rel="noopener">THE PERFORMANCE OF STYLED REACT COMPONENTS</a>), è¿™ä¸ªå›¾ç‰‡æ˜¯17å¹´çš„äº†ï¼Œä½†æ˜¯å¤§æŠµçš„è¶‹åŠ¿è¿˜æ˜¯è¿™æ ·ã€‚</p><p>æ‰€ä»¥åœ¨æ ·å¼è¿è¡Œæ—¶æ€§èƒ½æ–¹é¢å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼š<code>CSS &gt; å¤§éƒ¨åˆ†CSS-in-js &gt; inline style</code></p><p><br></p><hr><p><br></p><h2 id="é¿å…é‡æ–°æ¸²æŸ“"><a href="#é¿å…é‡æ–°æ¸²æŸ“" class="headerlink" title="é¿å…é‡æ–°æ¸²æŸ“"></a>é¿å…é‡æ–°æ¸²æŸ“</h2><p>å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ä¹Ÿæ˜¯ React ç»„ä»¶æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹å‘. ä¸ºäº†é¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ–°æ¸²æŸ“éœ€è¦åœ¨åšåˆ°ä¸¤ç‚¹:</p><ol><li>ä¿è¯ç»„ä»¶çº¯ç²¹æ€§ã€‚å³æ§åˆ¶ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œå¦‚æœç»„ä»¶æœ‰å‰¯ä½œç”¨åˆ™æ— æ³•å®‰å…¨åœ°ç¼“å­˜æ¸²æŸ“ç»“æœ</li><li>é€šè¿‡<code>shouldComponentUpdate</code>ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ¥æ¯”å¯¹ state å’Œ props, ç¡®å®šæ˜¯å¦è¦é‡æ–°æ¸²æŸ“ã€‚å¯¹äºå‡½æ•°ç»„ä»¶å¯ä»¥ä½¿ç”¨<code>React.memo</code>åŒ…è£…</li></ol><p>å¦å¤–è¿™äº›æªæ–½ä¹Ÿå¯ä»¥å¸®åŠ©ä½ æ›´å®¹æ˜“åœ°ä¼˜åŒ–ç»„ä»¶é‡æ–°æ¸²æŸ“:</p><p><br></p><h3 id="0ï¸âƒ£-ç®€åŒ–-props"><a href="#0ï¸âƒ£-ç®€åŒ–-props" class="headerlink" title="0ï¸âƒ£ ç®€åŒ– props"></a>0ï¸âƒ£ ç®€åŒ– props</h3><p><strong>â‘  å¦‚æœä¸€ä¸ªç»„ä»¶çš„ props å¤ªå¤æ‚ä¸€èˆ¬æ„å‘³ç€è¿™ä¸ªç»„ä»¶å·²ç»è¿èƒŒäº†â€˜å•ä¸€èŒè´£â€™ï¼Œé¦–å…ˆåº”è¯¥å°è¯•å¯¹ç»„ä»¶è¿›è¡Œæ‹†è§£</strong>.<br><strong>â‘¡ å¦å¤–å¤æ‚çš„ props ä¹Ÿä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤, æ¯”å¦‚ä¼šå½±å“<code>shallowCompare</code>æ•ˆç‡, è¿˜ä¼šè®©ç»„ä»¶çš„å˜åŠ¨å˜å¾—éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•</strong>.</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­, ä¸ºäº†åˆ¤æ–­åˆ—è¡¨é¡¹æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œè¿™é‡Œä¼ å…¥äº†ä¸€ä¸ªå½“å‰æ¿€æ´»çš„ id:</p>  <center><br>    <img src="/images/09/list.png" width="500"><br>  </center><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡ï¼Œä¸€æ—¦æ¿€æ´» id å˜åŠ¨ï¼Œæ‰€æœ‰åˆ—è¡¨é¡¹éƒ½ä¼šé‡æ–°åˆ·æ–°. æ›´å¥½çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ç±»ä¼¼<code>actived</code>è¿™æ ·çš„å¸ƒå°”å€¼ prop. actived ç°åœ¨åªæœ‰ä¸¤ç§å˜åŠ¨æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´æ¿€æ´» id çš„å˜åŠ¨ï¼Œæœ€å¤šåªæœ‰ä¸¤ä¸ªç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“.</p><p><strong>ç®€åŒ–çš„ props æ›´å®¹æ˜“ç†è§£, ä¸”å¯ä»¥æé«˜ç»„ä»¶ç¼“å­˜çš„å‘½ä¸­ç‡</strong></p><p><br></p><h3 id="1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨"><a href="#1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨" class="headerlink" title="1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨"></a>1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</h3><p>â‘ <strong>é¿å…ä½¿ç”¨ç®­å¤´å‡½æ•°å½¢å¼çš„äº‹ä»¶å¤„ç†å™¨</strong>, ä¾‹å¦‚:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;ComplexComponent onClick=&#123;evt =&gt; onClick(evt.id)&#125; otherProps=&#123;values&#125; /&gt;</span><br></pre></td></tr></table></figure><p>å‡è®¾ ComplexComponent æ˜¯ä¸€ä¸ªå¤æ‚çš„ PureComponent, è¿™é‡Œä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå…¶å®æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¼šå¯¼è‡´ ComplexComponent å§‹ç»ˆä¼šè¢«é‡æ–°æ¸²æŸ“.</p><p>æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨å®ä¾‹æ–¹æ³•:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    &lt;ComplexComponent onClick=&#123;<span class="keyword">this</span>.handleClick&#125; otherProps=&#123;values&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <br></p><p>â‘¡ å³ä½¿ç°åœ¨ä½¿ç”¨<code>hooks</code>ï¼Œæˆ‘ä¾ç„¶ä¼š<strong>ä½¿ç”¨<code>useCallback</code>æ¥åŒ…è£…äº‹ä»¶å¤„ç†å™¨</strong>ï¼Œå°½é‡ç»™ä¸‹çº§ç»„ä»¶æš´éœ²ä¸€ä¸ªé™æ€çš„å‡½æ•°:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ComplexComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> <span class="attr">otherProps</span>=<span class="string">&#123;values&#125;</span> /&gt;</span>;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœ<code>useCallback</code>ä¾èµ–äºå¾ˆå¤šçŠ¶æ€ï¼Œä½ çš„<code>useCallback</code>å¯èƒ½ä¼šå˜æˆè¿™æ ·:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  <span class="comment">// ğŸ¤­</span></span><br><span class="line">&#125;, [foo, bar, baz, bazz, bazzzz]);</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•å®åœ¨è®©äººéš¾ä»¥æ¥å—ï¼Œè¿™æ—¶å€™è°è¿˜ç®¡ä»€ä¹ˆå‡½æ•°å¼éå‡½æ•°å¼çš„ã€‚æˆ‘æ˜¯è¿™æ ·å¤„ç†çš„:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRefProps</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: T</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef &lt; T &gt; props;</span><br><span class="line">  <span class="comment">// æ¯æ¬¡æ¸²æŸ“æ›´æ–°props</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ref.current = props;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComp</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> propsRef = useRefProps(props);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç°åœ¨handleClickæ˜¯å§‹ç»ˆä¸å˜çš„</span></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; foo, bar, baz, bazz, bazzzz &#125; = propsRef.current;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>â‘¢<strong>è®¾è®¡æ›´æ–¹ä¾¿å¤„ç†çš„ Event Props</strong>. æœ‰æ—¶å€™æˆ‘ä»¬ä¼šè¢«é€¼çš„ä¸å¾—ä¸ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥ä½œä¸ºäº‹ä»¶å¤„ç†å™¨ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;List&gt;</span><br><span class="line">  &#123;list.map(<span class="function"><span class="params">i</span> =&gt;</span> (</span><br><span class="line">    &lt;Item key=&#123;i.id&#125; onClick=&#123;() =&gt; handleDelete(i.id)&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">  ))&#125;</span><br><span class="line">&lt;<span class="regexp">/List&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ onClick æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å®ç°ï¼Œå®ƒæ²¡æœ‰æºå¸¦ä»»ä½•ä¿¡æ¯æ¥æ ‡è¯†äº‹ä»¶æ¥æºï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½ä½¿ç”¨é—­åŒ…å½¢å¼ï¼Œæ›´å¥½çš„è®¾è®¡å¯èƒ½æ˜¯è¿™æ ·çš„:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// onClickä¼ é€’äº‹ä»¶æ¥æºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> handleDelete = useCallback(<span class="function">(<span class="params">id: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*åˆ é™¤æ“ä½œ*/</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;List&gt;</span><br><span class="line">    &#123;list.map(<span class="function"><span class="params">i</span> =&gt;</span> (</span><br><span class="line">      &lt;Item key=&#123;i.id&#125; id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;<span class="regexp">/List&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶æˆ–è€… DOM ç»„ä»¶å‘¢? å®åœ¨ä¸è¡Œï¼Œçœ‹èƒ½ä¸èƒ½ä¼ é€’<code>data-*</code>å±æ€§:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleDelete = useCallback(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = event.dataset.id;</span><br><span class="line">  <span class="comment">/*åˆ é™¤æ“ä½œ*/</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;list.map(<span class="function"><span class="params">i</span> =&gt;</span> (</span><br><span class="line">      &lt;li key=&#123;i.id&#125; data-id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="2ï¸âƒ£-ä¸å¯å˜æ•°æ®"><a href="#2ï¸âƒ£-ä¸å¯å˜æ•°æ®" class="headerlink" title="2ï¸âƒ£ ä¸å¯å˜æ•°æ®"></a>2ï¸âƒ£ ä¸å¯å˜æ•°æ®</h3><p>ä¸å¯å˜æ•°æ®å¯ä»¥è®©çŠ¶æ€å˜å¾—å¯é¢„æµ‹ï¼Œä¹Ÿè®© shouldComponentUpdate â€˜æµ…æ¯”è¾ƒâ€™å˜å¾—æ›´å¯é å’Œé«˜æ•ˆ. ç¬”è€…åœ¨<a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-8" target="_blank" rel="noopener">React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 04 - ç»„ä»¶çš„æ€ç»´</a>ä»‹ç»è¿‡ä¸å¯å˜æ•°æ®ï¼Œæœ‰å…´è¶£è¯»è€…å¯ä»¥çœ‹çœ‹.</p><p>ç›¸å…³çš„å·¥å…·æœ‰<a href="https://github.com/facebook/immutable-js" target="_blank" rel="noopener">Immutable.js</a>ã€<a href="https://github.com/mweststrate/immer" target="_blank" rel="noopener">Immer</a>ã€immutability-helper ä»¥åŠ seamless-immutableã€‚</p><p><br></p><h3 id="3ï¸âƒ£-ç®€åŒ–-state"><a href="#3ï¸âƒ£-ç®€åŒ–-state" class="headerlink" title="3ï¸âƒ£ ç®€åŒ– state"></a>3ï¸âƒ£ ç®€åŒ– state</h3><p><strong>ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ”¾åœ¨ç»„ä»¶çš„ state ä¸­</strong>. ä¾‹å¦‚ç¼“å­˜æ•°æ®ã€‚æŒ‰ç…§æˆ‘çš„åŸåˆ™æ˜¯ï¼š<strong>å¦‚æœéœ€è¦ç»„ä»¶å“åº”å®ƒçš„å˜åŠ¨, æˆ–è€…éœ€è¦æ¸²æŸ“åˆ°è§†å›¾ä¸­çš„æ•°æ®æ‰åº”è¯¥æ”¾åˆ° state ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ•°æ®å˜åŠ¨å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“.</strong></p><p><br></p><h3 id="4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹"><a href="#4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹" class="headerlink" title="4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹"></a>4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹</h3><p>å°½ç®¡ hooks å‡ºæ¥åï¼Œrecompose å®£ç§°ä¸å†æ›´æ–°äº†ï¼Œä½†è¿˜æ˜¯ä¸å½±å“æˆ‘ä»¬ä½¿ç”¨ recompose æ¥æ§åˆ¶<code>shouldComponentUpdate</code>æ–¹æ³•, æ¯”å¦‚å®ƒæä¾›äº†ä»¥ä¸‹æ–¹æ³•æ¥ç²¾ç»†æ§åˆ¶åº”è¯¥æ¯”è¾ƒå“ªäº› props:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ç›¸å½“äºReact.memo */</span></span><br><span class="line">pure()</span><br><span class="line"><span class="comment">/* è‡ªå®šä¹‰æ¯”è¾ƒ */</span></span><br><span class="line">shouldUpdate(test: <span class="function">(<span class="params">props: <span class="built_in">Object</span>, nextProps: <span class="built_in">Object</span></span>) =&gt;</span> <span class="built_in">boolean</span>): HigherOrderComponent</span><br><span class="line"><span class="comment">/* åªæ¯”è¾ƒæŒ‡å®škey */</span></span><br><span class="line">onlyUpdateForKeys( propKeys: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;): HigherOrderComponent</span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜å¯ä»¥å†æ‰©å±•ä¸€ä¸‹ï¼Œæ¯”å¦‚<code>omitUpdateForKeys</code>å¿½ç•¥æ¯”å¯¹æŸäº› key.</p><p><br><br><br></p><h2 id="ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="ç²¾ç»†åŒ–æ¸²æŸ“"></a>ç²¾ç»†åŒ–æ¸²æŸ“</h2><p>æ‰€è°“ç²¾ç»†åŒ–æ¸²æŸ“æŒ‡çš„æ˜¯<strong>åªæœ‰ä¸€ä¸ªæ•°æ®æ¥æºå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>, æ¯”å¦‚è¯´ A åªä¾èµ–äº a æ•°æ®ï¼Œé‚£ä¹ˆåªæœ‰åœ¨ a æ•°æ®å˜åŠ¨æ—¶æ‰æ¸²æŸ“ A, å…¶ä»–çŠ¶æ€å˜åŒ–ä¸åº”è¯¥å½±å“ç»„ä»¶ Aã€‚</p><p>Vue å’Œ Mobx å®£ç§°è‡ªå·±æ€§èƒ½å¥½çš„ä¸€éƒ¨åˆ†åŸå› æ˜¯å®ƒä»¬çš„â€™å“åº”å¼ç³»ç»Ÿâ€™, <strong>å®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€äº›â€˜å“åº”å¼æ•°æ®â€™ï¼Œå½“è¿™äº›å“åº”æ•°æ®å˜åŠ¨æ—¶ï¼Œä¾èµ–è¿™äº›å“åº”å¼æ•°æ®è§†å›¾å°±ä¼šé‡æ–°æ¸²æŸ“</strong>. æ¥çœ‹çœ‹ Vue å®˜æ–¹æ˜¯å¦‚ä½•æè¿°çš„:</p><center><br>  <img src="/images/09/vue-compare.png" width="500"><br></center><p><br></p><h3 id="0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“"></a>0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“</h3><p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå“åº”å¼æ•°æ®å¯ä»¥å®ç°è§†å›¾ç²¾ç»†åŒ–çš„æ¸²æŸ“, ä½†å®ƒè¿˜æ˜¯ä¸èƒ½é¿å…å¼€å‘è€…å†™å‡ºä½æ•ˆçš„ç¨‹åº</strong>. <strong>æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºç»„ä»¶è¿èƒŒâ€˜å•ä¸€èŒè´£â€™</strong>.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰ä¸€ä¸ª MyComponent ç»„ä»¶ï¼Œä¾èµ–äº Aã€Bã€C ä¸‰ä¸ªæ•°æ®æºï¼Œæ¥æ„å»ºä¸€ä¸ª vdom æ ‘ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç°åœ¨åªè¦ Aã€Bã€C ä»»æ„ä¸€ä¸ªå˜åŠ¨ï¼Œé‚£ä¹ˆ MyComponent æ•´ä¸ªå°±ä¼šé‡æ–°æ¸²æŸ“:</p><center><br>  <img src="/images/09/my-component1.png" width="300"><br></center><p>æ›´å¥½çš„åšæ³•æ˜¯è®©ç»„ä»¶çš„èŒè´£æ›´å•ä¸€ï¼Œç²¾ç»†åŒ–åœ°ä¾èµ–å“åº”å¼æ•°æ®ï¼Œæˆ–è€…è¯´å¯¹å“åº”å¼æ•°æ®è¿›è¡Œâ€˜éš”ç¦»â€™. å¦‚ä¸‹å›¾, Aã€Bã€C éƒ½æŠ½å–å„è‡ªçš„ç»„ä»¶ä¸­äº†ï¼Œç°åœ¨ A å˜åŠ¨åªä¼šæ¸²æŸ“ A ç»„ä»¶æœ¬èº«ï¼Œè€Œä¸ä¼šå½±å“çˆ¶ç»„ä»¶å’Œ Bã€C ç»„ä»¶:</p><center><br>  <img src="/images/09/my-component2.png" width="480"><br></center><p><br></p><p>ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œåˆ—è¡¨æ¸²æŸ“:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observable &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">'mobx-react-lite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialList = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  initialList.push(&#123; <span class="attr">id</span>: i, <span class="attr">name</span>: <span class="string">`name-<span class="subst">$&#123;i&#125;</span>`</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = observable(&#123;</span><br><span class="line">  list: initialList,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> List = observer(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> list = store.list;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Listæ¸²æŸ“'</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-container"</span>&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map(<span class="function">(<span class="params">i, idx</span>) =&gt;</span> (</span><br><span class="line">          &lt;div className=<span class="string">"list-item"</span> key=&#123;i.id&#125;&gt;</span><br><span class="line">            &#123;<span class="comment">/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */</span>&#125;</span><br><span class="line">            &#123;<span class="built_in">console</span>.log(<span class="string">'render'</span>, i.id)&#125;</span><br><span class="line">            &lt;span className=<span class="string">"list-item-name"</span>&gt;&#123;i.name&#125; &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;span className="list-item-value"&gt;&#123;i.value&#125; &lt;/</span>span&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              className=<span class="string">"list-item-increment"</span></span><br><span class="line">              onClick=&#123;() =&gt; &#123;</span><br><span class="line">                i.value++;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'é€’å¢'</span>);</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              é€’å¢</span><br><span class="line">            &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;button</span></span><br><span class="line"><span class="regexp">              className="list-item-increment"</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                if (idx &lt; list.length - 1) &#123;</span></span><br><span class="line"><span class="regexp">                  console.log('ç§»ä½');</span></span><br><span class="line"><span class="regexp">                  let t = list[idx];</span></span><br><span class="line"><span class="regexp">                  list[idx] = list[idx + 1];</span></span><br><span class="line"><span class="regexp">                  list[idx + 1] = t;</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">              &#125;&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              ä¸‹ç§»</span></span><br><span class="line"><span class="regexp">            &lt;/</span>button&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        ))&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/u</span>l&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure><p><br></p><p>ä¸Šè¿°çš„ä¾‹å­æ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜çš„ï¼Œå•ä¸ª list-item çš„é€’å¢å’Œç§»ä½éƒ½ä¼šå¯¼è‡´æ•´ä¸ªåˆ—è¡¨çš„é‡æ–°æ¸²æŸ“:</p><center><br>  <img src="/images/09/list-demo.png" width="380"><br></center><p>åŸå› å¤§æ¦‚èƒ½çŒœå‡ºæ¥å§? å¯¹äº Vue æˆ–è€… Mobx æ¥è¯´ï¼Œ<strong>ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“å‡½æ•°å°±æ˜¯ä¸€ä¸ªä¾èµ–æ”¶é›†çš„ä¸Šä¸‹æ–‡</strong>ã€‚ä¸Šé¢ List ç»„ä»¶æ¸²æŸ“å‡½æ•°å†…â€™è®¿é—®â€™äº†æ‰€æœ‰çš„åˆ—è¡¨é¡¹æ•°æ®ï¼Œé‚£ä¹ˆ Vue æˆ– Mobx å°±ä¼šè®¤ä¸ºä½ è¿™ä¸ªç»„ä»¶ä¾èµ–äºæ‰€æœ‰çš„åˆ—è¡¨é¡¹ï¼Œè¿™æ ·å°±å¯¼è‡´ï¼Œåªè¦ä»»æ„ä¸€ä¸ªåˆ—è¡¨é¡¹çš„å±æ€§å€¼å˜åŠ¨å°±ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ª List ç»„ä»¶ã€‚</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†æ•°æ®éš”ç¦»æŠ½å–åˆ°å•ä¸€èŒè´£çš„ç»„ä»¶ä¸­ã€‚<strong>å¯¹äº Vue æˆ– Mobx æ¥è¯´ï¼Œè¶Šç»†ç²’åº¦çš„ç»„ä»¶ï¼Œå¯ä»¥æ”¶è·æ›´é«˜çš„æ€§èƒ½ä¼˜åŒ–æ•ˆæœ</strong>:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ListItem = observer(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; item, onShiftDown &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-item"</span>&gt;</span><br><span class="line">      &#123;<span class="built_in">console</span>.log(<span class="string">'render'</span>, item.id)&#125;</span><br><span class="line">      &#123;<span class="comment">/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */</span>&#125;</span><br><span class="line">      &lt;span className=<span class="string">"list-item-name"</span>&gt;&#123;item.name&#125; &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span className="list-item-value"&gt;&#123;item.value&#125; &lt;/</span>span&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        className=<span class="string">"list-item-increment"</span></span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          item.value++;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'é€’å¢'</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        é€’å¢</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button className="list-item-increment" onClick=&#123;() =&gt; onShiftDown(item)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        ä¸‹ç§»</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export const List = observer(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const list = store.list;</span></span><br><span class="line"><span class="regexp">  const handleShiftDown = useCallback(item =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const idx = list.findIndex(i =&gt; i.id === item.id);</span></span><br><span class="line"><span class="regexp">    if (idx !== -1 &amp;&amp; idx &lt; list.length - 1) &#123;</span></span><br><span class="line"><span class="regexp">      console.log('ç§»ä½');</span></span><br><span class="line"><span class="regexp">      let t = list[idx];</span></span><br><span class="line"><span class="regexp">      list[idx] = list[idx + 1];</span></span><br><span class="line"><span class="regexp">      list[idx + 1] = t;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ eslint-disable-next-line react-hooks/</span>exhaustive-deps</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'List æ¸²æŸ“'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-container"</span>&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map(<span class="function">(<span class="params">i, idx</span>) =&gt;</span> (</span><br><span class="line">          &lt;ListItem key=&#123;i.id&#125; item=&#123;i&#125; onShiftDown=&#123;handleShiftDown&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¾ˆæ˜æ˜¾, list-item é€’å¢åªä¼šé‡æ–°æ¸²æŸ“æœ¬èº«; è€Œç§»ä½åªä¼šé‡æ–°æ¸²æŸ“ Listï¼Œ å› ä¸ºåˆ—è¡¨é¡¹æ²¡æœ‰å˜åŠ¨, æ‰€ä»¥ä¸‹çº§ list-item ä¹Ÿä¸éœ€è¦é‡æ–°æ¸²æŸ“:</p><center><br>  <img src="/images/09/list-demo2.png" width="380"><br></center><p><br><br><br></p><h3 id="1ï¸âƒ£-ä¸è¦æ»¥ç”¨-context"><a href="#1ï¸âƒ£-ä¸è¦æ»¥ç”¨-context" class="headerlink" title="1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context"></a>1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context</h3><p><strong>å…¶å® Context çš„ç”¨æ³•å’Œå“åº”å¼æ•°æ®æ­£å¥½ç›¸å</strong>ã€‚ç¬”è€…ä¹Ÿçœ‹è¿‡ä¸å°‘æ»¥ç”¨ Context API çš„ä¾‹å­, è¯´åˆ°åº•è¿˜æ˜¯æ²¡æœ‰å¤„ç†å¥½â€˜çŠ¶æ€çš„ä½œç”¨åŸŸé—®é¢˜â€™.</p><p>é¦–å…ˆè¦ç†è§£ Context API çš„æ›´æ–°ç‰¹ç‚¹ï¼Œ<strong>å®ƒæ˜¯å¯ä»¥ç©¿é€<code>React.memo</code>æˆ–è€…<code>shouldComponentUpdate</code>çš„æ¯”å¯¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdate</strong>.</p><p><strong>è¿™ä¸ªå’Œ Mobx å’Œ Vue çš„å“åº”å¼ç³»ç»Ÿä¸åŒï¼ŒContext API å¹¶ä¸èƒ½ç»†ç²’åº¦åœ°æ£€æµ‹å“ªäº›ç»„ä»¶ä¾èµ–å“ªäº›çŠ¶æ€ï¼Œæ‰€ä»¥è¯´ä¸ŠèŠ‚æåˆ°çš„â€˜ç²¾ç»†åŒ–æ¸²æŸ“â€™ç»„ä»¶æ¨¡å¼ï¼Œåœ¨ Context è¿™é‡Œå°±æˆä¸ºäº†â€˜åæ¨¡å¼â€™</strong>.</p><p>æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ Context API è¦éµå¾ªä¸€ä¸‹åŸåˆ™:</p><p><br></p><ul><li><p><strong>æ˜ç¡®çŠ¶æ€ä½œç”¨åŸŸ, Context åªæ”¾ç½®å¿…è¦çš„ï¼Œå…³é”®çš„ï¼Œè¢«å¤§å¤šæ•°ç»„ä»¶æ‰€å…±äº«çš„çŠ¶æ€</strong>ã€‚æ¯”è¾ƒå…¸å‹çš„æ˜¯é‰´æƒçŠ¶æ€</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><center><br>  <img src="/images/09/use-context1.png" width="400"><br></center><center><br>  <img src="/images/09/use-context2.png" width="650"><br></center><p>æ‰©å±•ï¼šContextå…¶å®æœ‰ä¸ªå®éªŒæ€§æˆ–è€…è¯´éå…¬å¼€çš„é€‰é¡¹<code>observedBits</code>, å¯ä»¥ç”¨äºæ§åˆ¶ContextConsumeræ˜¯å¦éœ€è¦æ›´æ–°. è¯¦ç»†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« &lt;<a href="https://zhuanlan.zhihu.com/p/51073183" target="_blank" rel="noopener">ObservedBits: React Contextçš„ç§˜å¯†åŠŸèƒ½</a>&gt;. ä¸è¿‡ä¸æ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªAPIä¹Ÿæ¯”è¾ƒéš¾ç”¨ï¼Œä¸å¦‚ç›´æ¥ä¸Šmobxã€‚</p></li><li><p><strong>ç²—ç²’åº¦åœ°è®¢é˜… Context</strong></p><p>å¦‚ä¸‹å›¾. ç»†ç²’åº¦çš„ Context è®¢é˜…ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“, æ‰€ä»¥è¿™é‡Œæ¨èç²—ç²’åº¦çš„è®¢é˜…. æ¯”å¦‚åœ¨çˆ¶çº§è®¢é˜… Contextï¼Œç„¶åå†é€šè¿‡ props ä¼ é€’ç»™ä¸‹çº§ã€‚</p><center><br>  <img src="/images/09/context-vs-props.png" width="600"><br></center></li></ul><p><br></p><p>å¦å¤–ç¨‹å¢¨ Morgan åœ¨<a href="https://zhuanlan.zhihu.com/p/50336226" target="_blank" rel="noopener">é¿å… React Context å¯¼è‡´çš„é‡å¤æ¸²æŸ“</a>ä¸€æ–‡ä¸­ä¹Ÿæåˆ° ContextAPI çš„ä¸€ä¸ªé™·é˜±:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Context.Provider</span><br><span class="line">  value=&#123;&#123; <span class="attr">theme</span>: <span class="keyword">this</span>.state.theme, <span class="attr">switchTheme</span>: <span class="keyword">this</span>.switchTheme &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;Content /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Context.Provider&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»„ä»¶ä¼šåœ¨ state å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œè‡³äºä¸ºä»€ä¹ˆç•™ç»™è¯»è€…å»æ€è€ƒã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¸ä¼šè£¸éœ²åœ°ä½¿ç”¨ Context.Provider, è€Œæ˜¯å°è£…ä¸ºç‹¬ç«‹çš„ Provider ç»„ä»¶:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ é¡ºä¾¿æš´éœ²useTheme, è®©å¤–éƒ¨å¿…é¡»ç›´æ¥ä½¿ç”¨Context</span></span><br><span class="line"><span class="regexp">export function useTheme() &#123;</span></span><br><span class="line"><span class="regexp">  return useContext(Context);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ theme å˜åŠ¨å°±ä¸ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå› ä¸º props.children ç”±å¤–éƒ¨ä¼ é€’è¿›æ¥ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ã€‚</p><p><strong>å…¶å®ä¸Šé¢çš„ä»£ç è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¯”è¾ƒéš¾å‘ç°çš„é™·é˜±(å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰<a href="https://zh-hans.reactjs.org/docs/context.html#caveats" target="_blank" rel="noopener">æåˆ°</a>)</strong>:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &#123;<span class="comment">/* ğŸ‘‡ ğŸ’£è¿™é‡Œæ¯ä¸€æ¬¡æ¸²æŸ“ThemeProvider, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„value(å³ä½¿themeå’ŒswitchThemeæ²¡æœ‰å˜åŠ¨),</span></span><br><span class="line"><span class="comment">        ä»è€Œå¯¼è‡´å¼ºåˆ¶æ¸²æŸ“æ‰€æœ‰ä¾èµ–è¯¥Contextçš„ç»„ä»¶ */</span>&#125;</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<strong>ä¼ é€’ç»™ Context çš„ value æœ€å¥½åšä¸€ä¸‹ç¼“å­˜</strong>:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  <span class="keyword">const</span> value = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> (&#123; theme, switchTheme &#125;), [theme]);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://react.docschina.org/docs/optimizing-performance.html" target="_blank" rel="noopener">Optimizing Performance</a> React å®˜æ–¹æ–‡æ¡£ï¼Œæœ€å¥½çš„æ•™ç¨‹, åˆ©ç”¨å¥½ React çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚</li><li><a href="https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3" target="_blank" rel="noopener">Twitter Lite and High Performance React Progressive Web Apps at Scale</a> çœ‹çœ‹ Twitter å¦‚ä½•ä¼˜åŒ–çš„</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡æ¥æºäºå…¬å¸å†…éƒ¨çš„ä¸€æ¬¡é—ªç”µåˆ†äº«ï¼Œç¨ä½œæ¶¦è‰²åˆ†äº«å‡ºæ¥ã€‚ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚&lt;strong&gt;å¦‚æœä½ è§‰å¾—å¯ä»¥ï¼Œè¯·å¤šç‚¹èµï¼Œé¼“åŠ±æˆ‘å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« &lt;/strong&gt;ğŸ™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;React æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ä¸‰ä¸ªæ–¹å‘ï¼Œå…¶å®
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
</feed>
